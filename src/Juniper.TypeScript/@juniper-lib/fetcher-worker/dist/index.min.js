var Ut=Object.defineProperty;var Ht=(r,e,t)=>e in r?Ut(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>(Ht(r,typeof e!="symbol"?e+"":e,t),t),ht=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var he=(r,e,t)=>(ht(r,e,"read from private field"),t?t.call(r):e.get(r)),pe=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},fe=(r,e,t,n)=>(ht(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function J(r,e){return r.splice(e,1)[0]}function k(r){return r.splice(0)}function H(r,e){let t=r.indexOf(e);return t>-1?(J(r,t),!0):!1}function pt(r,...e){for(let t of e)if(u(t))for(let[n,s]of t)r.set(n,s);return r}var Te=class{constructor(e){a(this,"items",new Map);a(this,"defaultItems",new Array);if(u(e))for(let[t,n]of e)this.add(t,n)}add(e,t){if(b(e))this.defaultItems.push(t);else{let n=this.items.get(e);b(n)&&this.items.set(e,n=[]),n.push(t)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let e of this.defaultItems)yield e;for(let e of this.items.values())for(let t of e)yield t}has(e){return u(e)?this.items.has(e):this.defaultItems.length>0}get(e){return b(e)?this.defaultItems:this.items.get(e)||[]}count(e){if(b(e))return this.defaultItems.length;let t=this.get(e);return u(t)?t.length:0}get size(){let e=this.defaultItems.length;for(let t of this.items.values())e+=t.length;return e}delete(e){return b(e)?k(this.defaultItems).length>0:this.items.delete(e)}remove(e,t){if(b(e))H(this.defaultItems,t);else{let n=this.items.get(e);u(n)&&(H(n,t),n.length===0&&this.items.delete(e))}}clear(){this.items.clear(),k(this.defaultItems)}};var be=class{constructor(e){a(this,"items",new Map);if(u(e))for(let[t,n,s]of e)this.add(t,n,s)}add(e,t,n){let s=this.items.get(e);return b(s)&&this.items.set(e,s=new Map),s.set(t,n),this}*entries(){for(let[e,t]of this.items)for(let[n,s]of t)yield[e,n,s]}keys(e){return b(e)?this.items.keys():this.items.get(e).keys()}*values(){for(let e of this.items.values())for(let t of e.values())yield t}has(e,t){return this.items.has(e)&&(b(t)||this.items.get(e).has(t))}get(e,t){return b(t)?this.items.get(e):this.items.has(e)?this.items.get(e).get(t):null}count(e){return this.items.has(e)?this.items.get(e).size:null}get size(){let e=0;for(let t of this.items.values())e+=t.size;return e}delete(e,t){return b(t)?this.items.delete(e):this.items.has(e)?this.items.get(e).delete(t):!1}clear(){this.items.clear()}};var Ee=class{constructor(){a(this,"listeners",new Map);a(this,"listenerOptions",new Map)}addEventListener(e,t,n){if(P(t)){let s=this.listeners.get(e);s||(s=new Array,this.listeners.set(e,s)),s.find(i=>i===t)||(s.push(t),n&&this.listenerOptions.set(t,n))}}removeEventListener(e,t){if(P(t)){let n=this.listeners.get(e);n&&this.removeListener(n,t)}}clearEventListeners(e){for(let[t,n]of this.listeners)if(b(e)||e===t){for(let s of n)this.removeEventListener(e,s);k(n),this.listeners.delete(t)}}removeListener(e,t){let n=e.findIndex(s=>s===t);n>=0&&(J(e,n),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(e){let t=this.listeners.get(e.type);if(t)for(let n of t){let s=this.listenerOptions.get(n);u(s)&&!G(s)&&s.once&&this.removeListener(t,n),n.call(this,e)}return!e.defaultPrevented}};var ge=class extends Ee{constructor(){super(...arguments);a(this,"bubblers",new Set);a(this,"scopes",new WeakMap)}addBubbler(t){this.bubblers.add(t)}removeBubbler(t){this.bubblers.delete(t)}addEventListener(t,n,s){super.addEventListener(t,n,s)}removeEventListener(t,n){super.removeEventListener(t,n)}clearEventListeners(t){return super.clearEventListeners(t)}addScopedEventListener(t,n,s,i){this.scopes.has(t)||this.scopes.set(t,[]),this.scopes.get(t).push([n,s]),this.addEventListener(n,s,i)}removeScope(t){let n=this.scopes.get(t);if(n){this.scopes.delete(t);for(let[s,i]of n)this.removeEventListener(s,i)}}dispatchEvent(t){if(!super.dispatchEvent(t))return!1;for(let n of this.bubblers)if(!n.dispatchEvent(t))return!1;return!0}};var K=class{constructor(e,t,n=!0){a(this,"promise");a(this,"_resolve",null);a(this,"_reject",null);a(this,"_result",null);a(this,"_error",null);a(this,"_started",!1);a(this,"_finished",!1);a(this,"resolve",null);a(this,"reject",null);let s=Re,i=Re;P(e)&&(s=e),P(t)&&(i=t),G(e)?n=e:G(t)&&(n=t),this.resolve=o=>{u(this._resolve)&&this._resolve(o)},this.reject=o=>{u(this._reject)&&this._reject(o)},this.promise=new Promise((o,c)=>{this._resolve=m=>{s(m)&&(this._result=m,this._finished=!0,o(m))},this._reject=m=>{i(m)&&(this._error=m,this._finished=!0,c(m))}}),n&&this.start()}get result(){if(u(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}start(){this._started=!0}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var dt=class{constructor(e,t,n){a(this,"promise");a(this,"callback",null);this.promise=new Promise((s,i)=>{this.callback=(...o)=>{e(...o)?s(t(...o)):i(n(...o))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var $t=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,_e=navigator.userAgent.match($t),ye=!!_e,eo=ye&&{major:parseFloat(_e[1]),minor:parseFloat(_e[2]),patch:parseFloat(_e[3])},to=ye&&/pacific/i.test(navigator.userAgent),ro=ye&&/quest/i.test(navigator.userAgent),no=ye&&/quest 2/i.test(navigator.userAgent);var so=!("Document"in globalThis);var Wt=298.257223563,Yt=6378137;var ze=1/Wt,Me=1-ze,p=ze/(2-ze),io=Yt/(1+p)*(1+p*p/4+p*p*p*p/64),xe=Math.sqrt(1-Me*Me),M=1-Me*Me,ao=xe*xe/(1-xe*xe),uo=1-M*(.25+M*(3/64+5*M/256)),lo=M*(3/8+M*(3/32+45*M/1024)),co=M*M*(15/256+M*45/1024),mo=M*M*M*(35/3072),ho=[p/2-2*p*p/3+37*p*p*p/96,p*p/48+p*p*p/15,17*p*p*p/480],po=[2*p-2*p*p/3,7*p*p/3-8*p*p*p/5,56*p*p*p/15];function de(r){return r}function Re(){return!0}var Bo=2*Math.PI;function Tt(r,e,t){return(1-t)*r+t*e}function Ie(r,e,t){return typeof r===e||r instanceof t}function P(r){return Ie(r,"function",Function)}function Q(r){return Ie(r,"string",String)}function G(r){return Ie(r,"boolean",Boolean)}function ve(r){return u(r)&&Ie(r,"object",Object)}function bt(r){return r instanceof Array}function qe(r,e){throw new Error((e||"Unexpected object: ")+r)}function b(r){return r==null}function u(r){return!b(r)}function Et(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Int16Array||r instanceof Uint32Array||r instanceof Int32Array||r instanceof Float32Array||r instanceof Float64Array||"BigUint64Array"in globalThis&&r instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&r instanceof globalThis.BigInt64Array}function gt(r){return r&&typeof ArrayBuffer!="undefined"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}var U=class extends ge{constructor(){super(...arguments);a(this,"attached",new Array);a(this,"soFar",null);a(this,"total",null);a(this,"msg",null);a(this,"est",null)}get p(){return this.total>0?this.soFar/this.total:0}report(t,n,s,i){this.soFar=t,this.total=n,this.msg=s,this.est=i;for(let o of this.attached)o.report(t,n,s,i)}attach(t){this.attached.push(t),t.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(t){this.report(0,1,t||"starting")}end(t){this.report(1,1,t||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,k(this.attached)}};var Z=class extends U{constructor(t,n){super();this.i=t;this.prog=n}report(t,n,s,i){super.report(t,n,s,i),this.prog.update(this.i,t,n,s)}};var ee=class{constructor(e){this.prog=e;a(this,"weightTotal",0);a(this,"start");a(this,"subProgressCallbacks",new Array);a(this,"subProgressWeights",new Array);a(this,"subProgressValues",new Array);this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new Z(t,this)}addSubProgress(e){e=e||1,this.weightTotal+=e,this.subProgressWeights.push(e),this.subProgressValues.push(0);let t=new Z(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(e,t,n,s){if(this.prog){this.subProgressValues[e]=t/n;let i=0;for(let h=0;h<this.subProgressWeights.length;++h)i+=this.subProgressValues[h]*this.subProgressWeights[h];let o=performance.now(),c=o-this.start,m=this.start-o+c*this.weightTotal/i;this.prog.report(i,this.weightTotal,s,m)}}};function We(r,e){return new $e(e,r).subProgressCallbacks}function Rt(r,e){let t=new Array(e);for(let n=0;n<e;++n)t[n]=1;return We(r,t)}var $e=class extends ee{constructor(e,t){super(t);for(let n of e)this.addSubProgress(n)}};var Ye=class{constructor(){a(this,"t",0);a(this,"dt",0);a(this,"sdt",0);a(this,"fps",0)}set(e,t){this.t=e,this.dt=t,this.sdt=Tt(this.sdt,t,.01),t>0&&(this.fps=1e3/t)}},Pe=class extends Ye{constructor(){super(),Object.seal(this)}};var re,te=class{constructor(e){a(this,"timer",null);a(this,"onTick");a(this,"lt",-1);a(this,"tickHandlers",new Array);pe(this,re,null);this.targetFPS=e;let t=new Pe,n=0;this.onTick=s=>{this.lt>=0&&(n=s-this.lt,t.set(s,n),this.tick(t)),this.lt=s}}get targetFPS(){return he(this,re)}set targetFPS(e){fe(this,re,e)}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){H(this.tickHandlers,e)}tick(e){for(let t of this.tickHandlers)t(e)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};re=new WeakMap;function Xe(r){return u(r)&&r.length>0?parseFloat(r):null}var _t=class{constructor(e,t){a(this,"_url",null);a(this,"_base");a(this,"_protocol",null);a(this,"_host",null);a(this,"_hostName",null);a(this,"_userName",null);a(this,"_password",null);a(this,"_port",null);a(this,"_pathName",null);a(this,"_hash",null);a(this,"_query",new Map);e!==void 0&&(this._url=new URL(e,t),this.rehydrate())}rehydrate(){u(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),u(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),u(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),u(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),u(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),u(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),u(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),u(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[e,t]of this._query)this._url.searchParams.set(e,t);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=Xe(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((e,t)=>this._query.set(t,e))}refresh(){if(this._url===null){if(u(this._protocol)&&(u(this._host)||u(this._hostName))){if(u(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=Xe(this._url.port),this.rehydrate(),!1;if(u(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(u(this._pathName)&&u(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return u(this._url)}base(e){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=e,this.refresh(),this}protocol(e){return this._protocol=e,this.refresh()&&(this._url.protocol=e),this}host(e){return this._host=e,this.refresh()&&(this._url.host=e,this._hostName=this._url.hostname,this._port=Xe(this._url.port)),this}hostName(e){return this._hostName=e,this.refresh()&&(this._url.hostname=e,this._host=`${this._url.hostname}:${this._url.port}`),this}port(e){return this._port=e,this.refresh()&&(this._url.port=e.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(e){return this._userName=e,this.refresh()&&(this._url.username=e),this}password(e){return this._password=e,this.refresh()&&(this._url.password=e),this}path(e){return this._pathName=e,this.refresh()&&(this._url.pathname=e),this}pathPop(e){return e=e||/\/[^\/]+\/?$/,this.path(this._pathName.replace(e,""))}pathPush(e){let t=this._pathName;return t.endsWith("/")||(t+="/"),t+=e,this.path(t)}query(e,t){return this._query.set(e,t),this.refresh()&&this._url.searchParams.set(e,t),this}hash(e){return this._hash=e,this.refresh()&&(this._url.hash=e),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function Je(r){let e=new Map;for(let[t,n]of r)e.set(n,t);return e}var Jt=new Map([[1,"KiB"],[2,"MiB"],[3,"GiB"],[4,"TiB"]]),Qt=new Map([[1,"KB"],[2,"MB"],[3,"GB"],[4,"TB"]]),Ya=Je(Jt),Xa=Je(Qt);var yt=304.79999999999995,Qa=yt*3,Zt=10*100,er=yt*16.5,tr=er*40,Za=Zt*1e3,eu=tr*8,xt=2.54*4,Mt=xt*3,tu=Mt*3,rr=Mt*16.5,nr=rr*40,ru=100*1e3,nu=nr*8,Qe=4*3,sr=Qe*3,Ze=100/2.54,or=Qe*16.5,ir=or*40,su=Ze*1e3,ou=ir*8,iu=3*3,ar=100/xt,ur=3*16.5,lr=ur*40,au=ar*1e3,uu=lr*8,vt=Ze/Qe,cr=16.5*40,lu=vt*1e3,cu=cr*8,mr=Ze/sr,hr=16.5/3,pr=hr*40,mu=mr*1e3,hu=pr*8,It=16.5/vt,Pt=It*40,pu=Pt*8,fu=1e3/It,du=40*8,fr=1e3/Pt,Tu=8/fr;function et(r,...e){if(!ve(r))return!1;r=r;for(let t of e){if(!(t in r))return!1;let n=r[t];if(!P(n))return!1}return!0}function dr(r){return et(r,"dispose")}function Tr(r){return et(r,"destroy")}function br(r){return et(r,"close")}function Er(r){dr(r)&&r.dispose(),br(r)&&r.close(),Tr(r)&&r.destroy()}function St(r,e){try{return e(r)}finally{Er(r)}}function ne(r,e){return r.splice(e,1)[0]}function j(r){return r.splice(0)}function tt(r,e){for(let t=0;t<r.length;++t)if(r[t]!==e[t])return t;return-1}function z(r,e){let t=r.indexOf(e);return t>-1?(ne(r,t),!0):!1}function se(r,e,t){return new Map(r.map(n=>[e(n),t(n)]))}var $=class{constructor(e){this.items=new Map;this.defaultItems=new Array;if(l(e))for(let[t,n]of e)this.add(t,n)}add(e,t){if(T(e))this.defaultItems.push(t);else{let n=this.items.get(e);T(n)&&this.items.set(e,n=[]),n.push(t)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let e of this.defaultItems)yield e;for(let e of this.items.values())for(let t of e)yield t}has(e){return l(e)?this.items.has(e):this.defaultItems.length>0}get(e){return T(e)?this.defaultItems:this.items.get(e)||[]}count(e){if(T(e))return this.defaultItems.length;let t=this.get(e);return l(t)?t.length:null}get size(){let e=this.defaultItems.length;for(let t of this.items.values())e+=t.length;return e}delete(e){return T(e)?j(this.defaultItems).length>0:this.items.delete(e)}remove(e,t){if(T(e))z(this.defaultItems,t);else{let n=this.items.get(e);l(n)&&(z(n,t),n.length===0&&this.items.delete(e))}}clear(){this.items.clear(),j(this.defaultItems)}};var ie=class{constructor(e){this.items=new Map;if(l(e))for(let[t,n,s]of e)this.add(t,n,s)}add(e,t,n){let s=this.items.get(e);return T(s)&&this.items.set(e,s=new Map),s.set(t,n),this}*entries(){for(let[e,t]of this.items)for(let[n,s]of t)yield[e,n,s]}keys(e){return T(e)?this.items.keys():this.items.get(e).keys()}*values(){for(let e of this.items.values())for(let t of e.values())yield t}has(e,t){return this.items.has(e)&&(T(t)||this.items.get(e).has(t))}get(e,t){return T(t)?this.items.get(e):this.items.has(e)?this.items.get(e).get(t):null}count(e){return this.items.has(e)?this.items.get(e).size:null}get size(){let e=0;for(let t of this.items.values())e+=t.size;return e}delete(e,t){return T(t)?this.items.delete(e):this.items.has(e)?this.items.get(e).delete(t):!1}clear(){this.items.clear()}};var Se=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(e,t,n){if(w(t)){let s=this.listeners.get(e);s||(s=new Array,this.listeners.set(e,s)),s.find(i=>i===t)||(s.push(t),n&&this.listenerOptions.set(t,n))}}removeEventListener(e,t){if(w(t)){let n=this.listeners.get(e);n&&this.removeListener(n,t)}}clearEventListeners(e){for(let[t,n]of this.listeners)if(T(e)||e===t){for(let s of n)this.removeEventListener(e,s);j(n),this.listeners.delete(t)}}removeListener(e,t){let n=e.findIndex(s=>s===t);n>=0&&(ne(e,n),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(e){let t=this.listeners.get(e.type);if(t)for(let n of t){let s=this.listenerOptions.get(n);l(s)&&!q(s)&&s.once&&this.removeListener(t,n),n.call(this,e)}return!e.defaultPrevented}};var L=class{constructor(e,t,n=!0){this._resolve=null;this._reject=null;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;let s=ae,i=ae;w(e)&&(s=e),w(t)&&(i=t),q(e)?n=e:q(t)&&(n=t),this.resolve=o=>{l(this._resolve)&&this._resolve(o)},this.reject=o=>{l(this._reject)&&this._reject(o)},this.promise=new Promise((o,c)=>{this._resolve=m=>{s(m)&&(this._result=m,this._finished=!0,o(m))},this._reject=m=>{i(m)&&(this._error=m,this._finished=!0,c(m))}}),n&&this.start()}get result(){if(l(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}start(){this._started=!0}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};function Nt(r,e){return"on"+e in r}function D(r,e,t,...n){T(n)&&(n=[]);let s;if(C(t)?n.unshift(t):le(t)&&(s=t),!(r instanceof Se)){if(!Nt(r,e))throw new ue(`Target does not have a ${e} rejection event`);for(let h of n)if(!Nt(r,h))throw new ue(`Target does not have a ${h} rejection event`)}let i=new L;if(le(s)){let h=setTimeout(i.reject,s,`'${e}' has timed out.`);i.finally(clearTimeout.bind(globalThis,h))}let o=(h,R)=>{r.addEventListener(h,R),i.finally(()=>r.removeEventListener(h,R))},c=h=>i.resolve(h),m=h=>i.reject(h);o(e,c);for(let h of n)o(h,m);return i}function S(r){return r.then(ae).catch(Ot)}var wt=class{constructor(e,t,n){this.callback=null;this.promise=new Promise((s,i)=>{this.callback=(...o)=>{e(...o)?s(t(...o)):i(n(...o))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var ue=class extends Error{constructor(t,n=null){super(t);this.innerError=n}};var yr=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,Ne=navigator.userAgent.match(yr),Oe=!!Ne,Hc=Oe&&{major:parseFloat(Ne[1]),minor:parseFloat(Ne[2]),patch:parseFloat(Ne[3])},Gc=Oe&&/pacific/i.test(navigator.userAgent),jc=Oe&&/quest/i.test(navigator.userAgent),zc=Oe&&/quest 2/i.test(navigator.userAgent);var qc=!("Document"in globalThis);var xr=298.257223563,Mr=6378137;var rt=1/xr,Le=1-rt,f=rt/(2-rt),Wc=Mr/(1+f)*(1+f*f/4+f*f*f*f/64),we=Math.sqrt(1-Le*Le),v=1-Le*Le,Yc=we*we/(1-we*we),Xc=1-v*(.25+v*(3/64+5*v/256)),Jc=v*(3/8+v*(3/32+45*v/1024)),Qc=v*v*(15/256+v*45/1024),Zc=v*v*v*(35/3072),em=[f/2-2*f*f/3+37*f*f*f/96,f*f/48+f*f*f/15,17*f*f*f/480],tm=[2*f-2*f*f/3,7*f*f/3-8*f*f*f/5,56*f*f*f/15];function oe(r){return r}function ae(){return!0}function Ot(){return!1}var Pm=2*Math.PI;function Dt(r,e,t){return(1-t)*r+t*e}function Ce(r,e,t){return typeof r===e||r instanceof t}function w(r){return Ce(r,"function",Function)}function C(r){return Ce(r,"string",String)}function q(r){return Ce(r,"boolean",Boolean)}function le(r){return Ce(r,"number",Number)}function De(r){return r instanceof Array}function T(r){return r==null}function l(r){return!T(r)}var nt=class{constructor(){this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(e,t){this.t=e,this.dt=t,this.sdt=Dt(this.sdt,t,.01),t>0&&(this.fps=1e3/t)}},Fe=class extends nt{constructor(){super(),Object.seal(this)}};var me,ce=class{constructor(e){this.timer=null;this.lt=-1;this.tickHandlers=new Array;pe(this,me,null);this.targetFPS=e;let t=new Fe,n=0;this.onTick=s=>{this.lt>=0&&(n=s-this.lt,t.set(s,n),this.tick(t)),this.lt=s}}get targetFPS(){return he(this,me)}set targetFPS(e){fe(this,me,e)}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){z(this.tickHandlers,e)}tick(e){for(let t of this.tickHandlers)t(e)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};me=new WeakMap;function st(r){return l(r)&&r.length>0?parseFloat(r):null}var Ct=class{constructor(e,t){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;e!==void 0&&(this._url=new URL(e,t),this.rehydrate())}rehydrate(){l(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),l(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),l(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),l(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),l(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),l(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),l(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),l(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[e,t]of this._query)this._url.searchParams.set(e,t);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=st(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((e,t)=>this._query.set(t,e))}refresh(){if(this._url===null){if(l(this._protocol)&&(l(this._host)||l(this._hostName))){if(l(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=st(this._url.port),this.rehydrate(),!1;if(l(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(l(this._pathName)&&l(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return l(this._url)}base(e){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=e,this.refresh(),this}protocol(e){return this._protocol=e,this.refresh()&&(this._url.protocol=e),this}host(e){return this._host=e,this.refresh()&&(this._url.host=e,this._hostName=this._url.hostname,this._port=st(this._url.port)),this}hostName(e){return this._hostName=e,this.refresh()&&(this._url.hostname=e,this._host=`${this._url.hostname}:${this._url.port}`),this}port(e){return this._port=e,this.refresh()&&(this._url.port=e.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(e){return this._userName=e,this.refresh()&&(this._url.username=e),this}password(e){return this._password=e,this.refresh()&&(this._url.password=e),this}path(e){return this._pathName=e,this.refresh()&&(this._url.pathname=e),this}pathPop(e){return e=e||/\/[^\/]+\/?$/,this.path(this._pathName.replace(e,""))}pathPush(e){let t=this._pathName;return t.endsWith("/")||(t+="/"),t+=e,this.path(t)}query(e,t){return this._query.set(e,t),this.refresh()&&this._url.searchParams.set(e,t),this}hash(e){return this._hash=e,this.refresh()&&(this._url.hash=e),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function ot(r){let e=new Map;for(let[t,n]of r)e.set(n,t);return e}var Nr=new Map([[1,"KiB"],[2,"MiB"],[3,"GiB"],[4,"TiB"]]),Or=new Map([[1,"KB"],[2,"MB"],[3,"GB"],[4,"TB"]]),Hp=ot(Nr),Gp=ot(Or);var Ft=304.79999999999995,zp=Ft*3,wr=10*100,Lr=Ft*16.5,Dr=Lr*40,qp=wr*1e3,$p=Dr*8,Vt=2.54*4,Bt=Vt*3,Wp=Bt*3,Cr=Bt*16.5,Fr=Cr*40,Yp=100*1e3,Xp=Fr*8,it=4*3,Vr=it*3,at=100/2.54,Br=it*16.5,Ar=Br*40,Jp=at*1e3,Qp=Ar*8,Zp=3*3,kr=100/Vt,Kr=3*16.5,Ur=Kr*40,ef=kr*1e3,tf=Ur*8,At=at/it,Hr=16.5*40,rf=At*1e3,nf=Hr*8,Gr=at/Vr,jr=16.5/3,zr=jr*40,sf=Gr*1e3,of=zr*8,kt=16.5/At,Kt=kt*40,af=Kt*8,uf=1e3/kt,lf=40*8,qr=1e3/Kt,cf=8/qr;var W=class{constructor(e){this.db=e}static async getCurrentVersion(e){if(l(indexedDB.databases)){let t=await indexedDB.databases();for(let{name:n,version:s}of t)if(n===e)return s}return null}static delete(e){let t=indexedDB.deleteDatabase(e),n=D(t,"success","error","blocked");return S(n)}static async open(e,...t){let n=se(t,_=>_.name,oe),s=new ie(t.filter(_=>l(_.indexes)).flatMap(_=>_.indexes.map(x=>[_.name,x.name,x]))),i=new Array,o=new Array,c=new Array,m=new $,h=new $,R=await this.getCurrentVersion(e);if(T(R)){i.push(...n.keys());for(let _ of t)if(l(_.indexes))for(let x of _.indexes)m.add(_.name,x.name)}else{let _=indexedDB.open(e);if(await S(D(_,"success","error","blocked"))){let x=_.result,V=new Array;for(let E of Array.from(x.objectStoreNames))n.has(E)||o.push(E);for(let E of n.keys())x.objectStoreNames.contains(E)?V.push(E):i.push(E);if(V.length>0){let E=x.transaction(V),B=D(E,"complete","error","abort"),A=S(B);for(let g of V){let je=E.objectStore(g);for(let O of Array.from(je.indexNames))s.has(g,O)||(c.indexOf(g)===-1&&c.push(g),h.add(g,O));if(s.has(g))for(let O of s.get(g).keys())if(!je.indexNames.contains(O))c.indexOf(g)===-1&&c.push(g),m.add(g,O);else{let Y=s.get(g,O),X=je.index(O);(C(Y.keyPath)!==C(X.keyPath)||C(Y.keyPath)&&C(X.keyPath)&&Y.keyPath!==X.keyPath||De(Y.keyPath)&&De(X.keyPath)&&tt(Y.keyPath,X.keyPath))&&(c.indexOf(g)===-1&&c.push(g),h.add(g,O),m.add(g,O))}}E.commit(),await A}x.close()}(i.length>0||o.length>0||m.size>0||h.size>0)&&++R}let y=new L,d=l(R)?indexedDB.open(e,R):indexedDB.open(e),I=D(d,"success","error","blocked"),F=S(y),Ge=S(I),mt=()=>y.resolve(!1);if(d.addEventListener("success",mt),d.addEventListener("upgradeneeded",()=>{let _=D(d.transaction,"complete","error","abort"),x=d.result;for(let E of o)x.deleteObjectStore(E);let V=new Map;for(let E of i){let B=n.get(E),A=x.createObjectStore(E,B.options);V.set(E,A)}for(let E of c){let B=d.transaction.objectStore(E);V.set(E,B)}for(let[E,B]of V){for(let A of h.get(E))B.deleteIndex(A);for(let A of m.get(E)){let g=s.get(E,A);B.createIndex(A,g.keyPath,g.options)}}S(_).then(y.resolve).catch(y.reject).finally(()=>d.removeEventListener("success",mt))}),!await F)throw y.error;if(!await Ge)throw I.error;return new W(d.result)}dispose(){this.db.close()}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(e){return new ut(this.db,e)}},ut=class{constructor(e,t){this.db=e;this.storeName=t}async request(e,t){let n=this.db.transaction(this.storeName,t),s=D(n,"complete","error"),i=n.objectStore(this.storeName),o=e(i),c=D(o,"success","error");if(!await S(c))throw n.abort(),c.error;if(n.commit(),!await S(s))throw s.error;return o.result}add(e,t){return this.request(n=>n.add(e,t),"readwrite")}clear(){return this.request(e=>e.clear(),"readwrite")}getCount(e){return this.request(t=>t.count(e),"readonly")}delete(e){return this.request(t=>t.delete(e),"readwrite")}get(e){return this.request(t=>t.get(e),"readonly")}getAll(){return this.request(e=>e.getAll(),"readonly")}getAllKeys(){return this.request(e=>e.getAllKeys(),"readonly")}getKey(e){return this.request(t=>t.getKey(e),"readonly")}openCursor(e,t){return this.request(n=>n.openCursor(e,t),"readonly")}openKeyCursor(e,t){return this.request(n=>n.openKeyCursor(e,t),"readonly")}put(e,t){return this.request(n=>n.put(e,t),"readwrite")}};async function N(r,e){let{status:t,path:n,content:s,contentType:i,contentLength:o,fileName:c,headers:m,date:h}=r;return{status:t,path:n,content:await e(s),contentType:i,contentLength:o,fileName:c,headers:m,date:h}}function $r(r){return Q(r)||Et(r)||r instanceof Blob||r instanceof FormData||gt(r)||r instanceof ReadableStream||"Document"in globalThis&&r instanceof Document}function Ve(r,e,t,n,s,i){let o=!i;i&&i.then(()=>o=!0);let c=!1,m=s,h=new K(()=>m&&c,()=>o);t.addEventListener("loadstart",()=>{o&&!c&&n&&n.start(r)}),t.addEventListener("progress",y=>{if(o&&!c){let d=y;n&&n.report(d.loaded,Math.max(d.loaded,d.total),r),d.loaded===d.total&&(m=!0,h.resolve())}}),t.addEventListener("load",()=>{o&&!c&&(n&&n.end(r),c=!0,h.resolve())});let R=y=>()=>h.reject(`${y} (${e.status})`);return t.addEventListener("error",R("error")),t.addEventListener("abort",R("abort")),t.addEventListener("timeout",R("timeout")),h}function lt(r,e,t,n,s,i){if(r.open(e,t),r.responseType="blob",r.timeout=n,s)for(let[o,c]of s)r.setRequestHeader(o,c);u(i)?r.send(i):r.send()}function Be(r,e,t){if(!r.has(e))return null;let n=r.get(e);try{let s=t(n);return r.delete(e),s}catch(s){console.warn(e,s)}return null}var Wr=/filename=\"(.+)\"(;|$)/,Yr="Juniper:Fetcher:Cache",Ae=class{constructor(){this.cache=null;this.store=null;this.tasks=new be;this.cacheReady=this.openCache()}async drawImageToCanvas(e,t,n){let s=await this.sendNothingGetSomething("blob",e,n),i=s.content;return St(await createImageBitmap(i,{imageOrientation:"none"}),o=>(t.width=o.width,t.height=o.height,t.getContext("2d").drawImage(o,0,0),N(s,()=>null)))}async openCache(){this.cache=await W.open(Yr,{name:"files",options:{keyPath:"path"}}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async readResponseHeaders(e,t){let n=t.getAllResponseHeaders().split(/[\r\n]+/).map(d=>d.trim()).filter(d=>d.length>0).map(d=>{let I=d.split(": "),F=I.shift().toLowerCase(),Ge=I.join(": ");return[F,Ge]}),s=new Te(n),i=Array.from(s.keys()).map(d=>[d,s.get(d).join(", ")]),o=new Map(i),c=Be(o,"content-type",de),m=Be(o,"content-length",parseFloat),h=Be(o,"date",d=>new Date(d)),R=Be(o,"content-disposition",d=>{if(u(d)){let I=d.match(Wr);if(u(I))return I[1]}return null});return{status:t.status,path:e,content:void 0,contentType:c,contentLength:m,fileName:R,date:h,headers:o}}async readResponse(e,t){let{status:n,contentType:s,contentLength:i,fileName:o,date:c,headers:m}=await this.readResponseHeaders(e,t),h={path:e,status:n,contentType:s,contentLength:i,fileName:o,date:c,headers:m,content:t.response};return u(h.content)&&(h.contentType=h.contentType||h.content.type,h.contentLength=h.contentLength||h.content.size),h}async decodeContent(e,t){return N(t,async n=>{if(e==="")return null;if(b(t.contentType)){let s=Array.from(t.headers.entries()).map(i=>i.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+s)}else{if(e==="blob")return n;if(e==="arraybuffer")return await n.arrayBuffer();if(e==="json"){let s=await n.text();return s.length>0?JSON.parse(s):null}else if(e==="document"){let s=new DOMParser;if(t.contentType==="application/xhtml+xml"||t.contentType==="text/html"||t.contentType==="application/xml"||t.contentType==="image/svg+xml"||t.contentType==="text/xml")return s.parseFromString(await n.text(),t.contentType);throw new Error("Couldn't parse document")}else{if(e==="text")return await n.text();qe(e)}}})}async withCachedTask(e,t){return e.method!=="GET"&&e.method!=="HEAD"&&e.method!=="OPTIONS"?await t():(this.tasks.has(e.method,e.path)||this.tasks.add(e.method,e.path,t().finally(()=>this.tasks.delete(e.method,e.path))),this.tasks.get(e.method,e.path))}sendNothingGetNothing(e){return this.withCachedTask(e,async()=>{let t=new XMLHttpRequest,n=Ve(`requesting: ${e.path}`,t,t,null,!0);return lt(t,e.method,e.path,e.timeout,e.headers),await n,await this.readResponseHeaders(e.path,t)})}sendNothingGetSomething(e,t,n){return this.withCachedTask(t,async()=>{let s=null,i=t.useCache&&t.method==="GET";i&&(u(n)&&n.start(),await this.cacheReady,s=await this.store.get(t.path));let o=b(s);if(o){let m=new XMLHttpRequest,h=Ve(`requesting: ${t.path}`,m,m,n,!0);lt(m,t.method,t.path,t.timeout,t.headers),await h,s=await this.readResponse(t.path,m),i&&await this.store.add(s)}let c=await this.decodeContent(e,s);return o&&u(n)&&n.end(),c})}async sendSomethingGetSomething(e,t,n,s){let i=null,o=pt(new Map,n,t.headers);if(t.body instanceof FormData&&u(o)){let I=new Array;for(let F of o.keys())F.toLowerCase()==="content-type"&&I.push(F);for(let F of I)o.delete(F)}$r(t.body)&&!Q(t.body)?i=t.body:u(t.body)&&(i=JSON.stringify(t.body));let c=Rt(s,2),m=new XMLHttpRequest,h=u(i)?Ve("uploading",m,m.upload,c.shift(),!1):Promise.resolve(),R=c.shift(),y=Ve("saving",m,m,R,!0,h);lt(m,t.method,t.path,t.timeout,o,i),await h,await y;let d=await this.readResponse(t.path,m);return await this.decodeContent(e,d)}};var ke=class{constructor(e){this.impl=e;this.defaultPostHeaders=new Map}setRequestVerificationToken(e){this.defaultPostHeaders.set("RequestVerificationToken",e)}clearCache(){return this.impl.clearCache()}sendNothingGetNothing(e){return this.impl.sendNothingGetNothing(e)}sendNothingGetBlob(e,t){return this.impl.sendNothingGetSomething("blob",e,t)}sendObjectGetBlob(e,t){return this.impl.sendSomethingGetSomething("blob",e,this.defaultPostHeaders,t)}sendNothingGetBuffer(e,t){return this.impl.sendNothingGetSomething("arraybuffer",e,t)}sendObjectGetBuffer(e,t){return this.impl.sendSomethingGetSomething("arraybuffer",e,this.defaultPostHeaders,t)}sendNothingGetText(e,t){return this.impl.sendNothingGetSomething("text",e,t)}sendObjectGetText(e,t){return this.impl.sendSomethingGetSomething("text",e,this.defaultPostHeaders,t)}async sendNothingGetObject(e,t){return(await this.impl.sendNothingGetSomething("json",e,t)).content}async sendObjectGetObject(e,t){return(await this.impl.sendSomethingGetSomething("json",e,this.defaultPostHeaders,t)).content}sendObjectGetNothing(e,t){return this.impl.sendSomethingGetSomething("",e,this.defaultPostHeaders,t)}drawImageToCanvas(e,t,n){return this.impl.drawImageToCanvas(e,t,n)}async sendNothingGetFile(e,t){return N(await this.sendNothingGetBlob(e,t),URL.createObjectURL)}async sendObjectGetFile(e,t){return N(await this.sendObjectGetBlob(e,t),URL.createObjectURL)}async sendNothingGetXml(e,t){return N(await this.impl.sendNothingGetSomething("document",e,t),n=>n.documentElement)}async sendObjectGetXml(e,t){return N(await this.impl.sendSomethingGetSomething("document",e,this.defaultPostHeaders,t),n=>n.documentElement)}async sendNothingGetImageBitmap(e,t){return N(await this.sendNothingGetBlob(e,t),createImageBitmap)}async sendObjectGetImageBitmap(e,t){return N(await this.sendObjectGetBlob(e,t),createImageBitmap)}};var ct=class extends U{constructor(t,n){super();this.server=t;this.taskID=n}report(t,n,s,i){let o={type:"progress",taskID:this.taskID,soFar:t,total:n,msg:s,est:i};this.server.postMessage(o)}},Ke=class{constructor(e){this.self=e;a(this,"methods",new Map);this.self.addEventListener("message",t=>{let n=t.data;this.callMethod(n)})}postMessage(e,t){u(t)?this.self.postMessage(e,t):this.self.postMessage(e)}callMethod(e){let t=this.methods.get(e.methodName);if(t)try{bt(e.params)?t(e.taskID,...e.params):u(e.params)?t(e.taskID,e.params):t(e.taskID)}catch(n){this.onError(e.taskID,`method invocation error: ${e.methodName}(${n.message||n})`)}else this.onError(e.taskID,`method not found: ${e.methodName}`)}onError(e,t){let n={type:"error",taskID:e,errorMessage:t};this.postMessage(n)}onReturn(e,t,n){let s=null;if(t===void 0?s={type:"return",taskID:e}:s={type:"return",taskID:e,returnValue:t},u(n)){let i=n(t);this.postMessage(s,i)}else this.postMessage(s)}addMethodInternal(e,t,n){if(this.methods.has(e))throw new Error(`${e} method has already been mapped.`);this.methods.set(e,async(s,...i)=>{let o=new ct(this,s);try{let c=await t(...i,o);this.onReturn(s,c,n)}catch(c){console.error(c),this.onError(s,c.message||c)}})}addFunction(e,t,n){this.addMethodInternal(e,t,n)}addVoidFunction(e,t){this.addMethodInternal(e,t)}addMethod(e,t,n,s){this.addFunction(t,n.bind(e),s)}addVoidMethod(e,t,n){this.addVoidFunction(t,n.bind(e))}addEvent(e,t,n,s){e.addEventListener(t,i=>{let o=null;if(u(n)?o={type:"event",eventName:t,data:n(i)}:o={type:"event",eventName:t},o.data!==void 0&&u(s)){let c=s(o.data);this.postMessage(o,c)}else this.postMessage(o)})}};var He=class extends Ke{constructor(e,t){super(e);let n=new ke(t);Xr(this,n)}};function Ue(r){return[r.content]}function Xr(r,e){r.addVoidMethod(e,"setRequestVerificationToken",e.setRequestVerificationToken),r.addMethod(e,"clearCache",e.clearCache),r.addMethod(e,"sendNothingGetNothing",e.sendNothingGetNothing),r.addMethod(e,"sendNothingGetBuffer",e.sendNothingGetBuffer,Ue),r.addMethod(e,"sendNothingGetImageBitmap",e.sendNothingGetImageBitmap,Ue),r.addMethod(e,"sendNothingGetObject",e.sendNothingGetObject),r.addMethod(e,"sendNothingGetFile",e.sendNothingGetFile),r.addMethod(e,"sendNothingGetText",e.sendNothingGetText),r.addMethod(e,"sendObjectGetNothing",e.sendObjectGetNothing),r.addMethod(e,"sendObjectGetImageBitmap",e.sendObjectGetImageBitmap,Ue),r.addMethod(e,"sendObjectGetBuffer",e.sendObjectGetBuffer,Ue),r.addMethod(e,"sendObjectGetObject",e.sendObjectGetObject),r.addMethod(e,"sendObjectGetFile",e.sendObjectGetFile),r.addMethod(e,"sendObjectGetText",e.sendObjectGetText),r.addMethod(e,"drawImageToCanvas",e.drawImageToCanvas)}globalThis.server=new He(globalThis,new Ae);
//# sourceMappingURL=index.min.js.map
