{
  "version": 3,
  "sources": ["../../../node_modules/cardboard-vr-display/dist/cardboard-vr-display.js", "../../tslib/collections/arrayBinarySearch.ts", "../../tslib/collections/arrayRemoveAt.ts", "../../tslib/collections/arrayClear.ts", "../../tslib/collections/arrayCompare.ts", "../../tslib/collections/arrayInsertAt.ts", "../../tslib/collections/arrayRemove.ts", "../../tslib/collections/arrayReplace.ts", "../../tslib/collections/arrayScan.ts", "../../tslib/collections/arraySortedInsert.ts", "../../tslib/collections/BaseGraphNode.ts", "../../tslib/collections/GraphNode.ts", "../../tslib/collections/mapMap.ts", "../../tslib/collections/makeLookup.ts", "../../tslib/collections/PriorityList.ts", "../../tslib/collections/PriorityMap.ts", "../../tslib/events/EventBase.ts", "../../tslib/events/Task.ts", "../../tslib/events/once.ts", "../../tslib/events/Promisifier.ts", "../../tslib/Exception.ts", "../../tslib/flags.ts", "../../tslib/gis/Datum.ts", "../../../node_modules/gl-matrix/esm/common.js", "../../../node_modules/gl-matrix/esm/vec3.js", "../../tslib/identity.ts", "../../tslib/math/angleClamp.ts", "../../tslib/math/clamp.ts", "../../tslib/math/deg2rad.ts", "../../tslib/math/lerp.ts", "../../tslib/math/powerOf2.ts", "../../tslib/math/rad2deg.ts", "../../tslib/math/truncate.ts", "../../tslib/progress/BaseProgress.ts", "../../tslib/progress/ChildProgressCallback.ts", "../../tslib/progress/BaseParentProgressCallback.ts", "../../tslib/progress/progressSplit.ts", "../../tslib/progress/progressPopper.ts", "../../tslib/progress/progressTasks.ts", "../../tslib/typeChecks.ts", "../../tslib/singleton.ts", "../../tslib/strings/stringRandom.ts", "../../tslib/strings/stringToName.ts", "../../tslib/timers/ITimer.ts", "../../tslib/timers/BaseTimer.ts", "../../tslib/timers/SetTimeoutTimer.ts", "../../tslib/collections/mapInvert.ts", "../../tslib/units/fileSize.ts", "../../tslib/units/length.ts", "../../tslib/URLBuilder.ts", "../../tslib/using.ts", "../../dom/attrs.ts", "../../dom/css.ts", "../../dom/tags.ts", "../../dom/canvas.ts", "../../graphics2d/CanvasImage.ts", "../../graphics2d/ArtificialHorizon.ts", "../../dom/fonts.ts", "../../graphics2d/BatteryImage.ts", "../../graphics2d/TextImage.ts", "../../graphics2d/ClockImage.ts", "../../dom/onUserGesture.ts", "../../audio/nodes.ts", "../../audio/Pose.ts", "../../audio/BaseAudioElement.ts", "../../audio/BaseSpatializer.ts", "../../audio/sources/spatializers/BaseEmitter.ts", "../../audio/sources/spatializers/NoSpatializationNode.ts", "../../audio/destinations/AudioDestination.ts", "../../audio/destinations/spatializers/BaseListener.ts", "../../audio/destinations/spatializers/WebAudioListenerNew.ts", "../../audio/destinations/spatializers/WebAudioListenerOld.ts", "../../audio/DeviceManager.ts", "../../audio/effects/EchoEffect.ts", "../../audio/effects/RadioEffect.ts", "../../audio/effects/WallEffect.ts", "../../audio/effects/index.ts", "../../audio/sources/BaseAudioSource.ts", "../../audio/sources/IPlayable.ts", "../../audio/sources/AudioElementSource.ts", "../../audio/sources/AudioStreamSource.ts", "../../audio/sources/spatializers/BaseWebAudioPanner.ts", "../../audio/sources/spatializers/WebAudioPannerNew.ts", "../../audio/sources/spatializers/WebAudioPannerOld.ts", "../../audio/AudioManager.ts", "../../audio/sources/IPlayer.ts", "../../audio/sources/AudioPlayer.ts", "../../webrtc/constants.ts", "../../threejs/ButtonFactory.ts", "../../graphics2d/animation/Animator.ts", "../../graphics2d/animation/tween.ts", "../../widgets/DialogBox.ts", "../../threejs/typeChecks.ts", "../../threejs/objects.ts", "../../threejs/examples/lines/LineMaterial.js", "../../threejs/materials.ts", "../../threejs/eventSystem/RayTarget.ts", "../../threejs/animation/scaleOnHover.ts", "../../threejs/cleanup.ts", "../../threejs/objectGetRelativePose.ts", "../../threejs/Plane.ts", "../../threejs/TexturedMesh.ts", "../../threejs/Image2DMesh.ts", "../../threejs/TextMesh.ts", "../../threejs/TextMeshLabel.ts", "../../threejs/TextMeshButton.ts", "../../threejs/ConfirmationDialog.ts", "../../threejs/eventSystem/InteractionAudio.ts", "../../threejs/ScreenMode.ts", "../../threejs/ScreenUI.ts", "../../threejs/SpaceUI.ts", "../../mediatypes/util.ts", "../../mediatypes/image.ts", "../../mediatypes/video.ts", "../../video/data.ts", "../../video/BaseVideoPlayer.ts", "../../threejs/CustomGeometry.ts", "../../threejs/VideoPlayer3D.ts", "../../threejs/MeshLabel.ts", "../../threejs/MeshButton.ts", "../../threejs/widgets/ButtonImageWidget.ts", "../../threejs/widgets/CanvasImageMesh.ts", "../../dom/elementSetClass.ts", "../../dom/buttonSetEnabled.ts", "../../threejs/widgets/ToggleButton.ts", "../../threejs/widgets/ScreenModeToggleButton.ts", "../../threejs/widgets/widgets.ts", "../../threejs/environment/ApplicationLoader.ts", "../../threejs/animation/lookAngles.ts", "../../threejs/animation/BodyFollower.ts", "../../dom/evts.ts", "../../threejs/eventSystem/AvatarMovedEvent.ts", "../../threejs/resolveCamera.ts", "../../threejs/setRightUpFwdPosFromMatrix.ts", "../../threejs/AvatarLocal.ts", "../../threejs/CameraFOVControl.ts", "../../threejs/layers.ts", "../../threejs/eventSystem/BaseCursor.ts", "../../threejs/eventSystem/Cursor3D.ts", "../../threejs/eventSystem/ObjectMovedEvent.ts", "../../threejs/eventSystem/EventSystemEvent.ts", "../../widgets/EventedGamepad.ts", "../../threejs/examples/loaders/GLTFLoader.js", "../../threejs/examples/webxr/motion-controllers.module.js", "../../threejs/examples/webxr/XRControllerModelFactory.js", "../../threejs/examples/webxr/XRHandPrimitiveModel.js", "../../threejs/examples/webxr/XRHandMeshModel.js", "../../threejs/examples/webxr/XRHandModelFactory.js", "../../threejs/eventSystem/PointerState.ts", "../../threejs/setGeometryUVsForCubemaps.ts", "../../threejs/Cube.ts", "../../threejs/eventSystem/CursorColor.ts", "../../threejs/eventSystem/CursorSystem.ts", "../../threejs/eventSystem/CursorXRMouse.ts", "../../threejs/eventSystem/BasePointer.ts", "../../threejs/examples/lines/LineSegmentsGeometry.js", "../../threejs/examples/lines/LineSegments2.js", "../../threejs/examples/lines/LineGeometry.js", "../../threejs/examples/lines/Line2.js", "../../threejs/eventSystem/Laser.ts", "../../threejs/eventSystem/PointerHand.ts", "../../threejs/eventSystem/BaseScreenPointer.ts", "../../threejs/eventSystem/BaseScreenPointerSinglePoint.ts", "../../threejs/eventSystem/PointerMouse.ts", "../../threejs/eventSystem/PointerMultiTouch.ts", "../../threejs/eventSystem/PointerPen.ts", "../../threejs/eventSystem/EventSystem.ts", "../../threejs/Fader.ts", "../../threejs/LoadingBar.ts", "../../dom/fullscreen.ts", "../../../node_modules/webxr-polyfill/src/lib/global.js", "../../../node_modules/webxr-polyfill/src/lib/EventTarget.js", "../../../node_modules/webxr-polyfill/node_modules/gl-matrix/src/gl-matrix/common.js", "../../../node_modules/webxr-polyfill/node_modules/gl-matrix/src/gl-matrix/mat4.js", "../../../node_modules/webxr-polyfill/node_modules/gl-matrix/src/gl-matrix/vec3.js", "../../../node_modules/webxr-polyfill/node_modules/gl-matrix/src/gl-matrix/mat3.js", "../../../node_modules/webxr-polyfill/node_modules/gl-matrix/src/gl-matrix/vec4.js", "../../../node_modules/webxr-polyfill/node_modules/gl-matrix/src/gl-matrix/quat.js", "../../../node_modules/webxr-polyfill/src/api/XRRigidTransform.js", "../../../node_modules/webxr-polyfill/src/api/XRSpace.js", "../../../node_modules/webxr-polyfill/src/api/XRReferenceSpace.js", "../../../node_modules/webxr-polyfill/src/api/XRSystem.js", "../../../node_modules/webxr-polyfill/src/lib/now.js", "../../../node_modules/webxr-polyfill/src/api/XRPose.js", "../../../node_modules/webxr-polyfill/src/api/XRViewerPose.js", "../../../node_modules/webxr-polyfill/src/api/XRViewport.js", "../../../node_modules/webxr-polyfill/src/api/XRView.js", "../../../node_modules/webxr-polyfill/src/api/XRFrame.js", "../../../node_modules/webxr-polyfill/src/api/XRRenderState.js", "../../../node_modules/webxr-polyfill/src/constants.js", "../../../node_modules/webxr-polyfill/src/api/XRWebGLLayer.js", "../../../node_modules/webxr-polyfill/src/api/XRInputSourceEvent.js", "../../../node_modules/webxr-polyfill/src/api/XRSessionEvent.js", "../../../node_modules/webxr-polyfill/src/api/XRInputSourcesChangeEvent.js", "../../../node_modules/webxr-polyfill/src/api/XRSession.js", "../../../node_modules/webxr-polyfill/src/api/XRInputSource.js", "../../../node_modules/webxr-polyfill/src/api/XRReferenceSpaceEvent.js", "../../../node_modules/webxr-polyfill/src/api/index.js", "../../../node_modules/webxr-polyfill/src/polyfill-globals.js", "../../../node_modules/webxr-polyfill/src/utils.js", "../../../node_modules/webxr-polyfill/src/devices/CardboardXRDevice.js", "../../../node_modules/webxr-polyfill/src/devices/XRDevice.js", "../../../node_modules/webxr-polyfill/src/devices/GamepadMappings.js", "../../../node_modules/webxr-polyfill/src/lib/OrientationArmModel.js", "../../../node_modules/webxr-polyfill/src/devices/GamepadXRInputSource.js", "../../../node_modules/webxr-polyfill/src/devices/WebVRDevice.js", "../../../node_modules/webxr-polyfill/src/devices/InlineDevice.js", "../../../node_modules/webxr-polyfill/src/devices.js", "../../../node_modules/webxr-polyfill/src/WebXRPolyfill.js", "../../threejs/ScreenControl.ts", "../../threejs/Skybox.ts", "../../threejs/environment/XRTimer.ts", "../../threejs/environment/BaseEnvironment.ts", "../../webrtc/ActivityDetector.ts", "../../widgets/InputRangeWithNumber.ts", "../../widgets/PropertyList.ts", "../../threejs/environment/DeviceDialog.ts", "../../threejs/environment/Environment.ts", "../src/index.ts"],
  "sourcesContent": ["/**\n * @license\n * cardboard-vr-display\n * Copyright (c) 2015-2017 Google\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @license\n * gl-preserve-state\n * Copyright (c) 2016, Brandon Jones.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * @license\n * webvr-polyfill-dpdb\n * Copyright (c) 2015-2017 Google\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @license\n * nosleep.js\n * Copyright (c) 2017, Rich Tibbett\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.CardboardVRDisplay = factory());\n}(this, (function () { 'use strict';\n\nvar asyncGenerator = function () {\n  function AwaitValue(value) {\n    this.value = value;\n  }\n\n  function AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function (resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n\n        if (value instanceof AwaitValue) {\n          Promise.resolve(value.value).then(function (arg) {\n            resume(\"next\", arg);\n          }, function (arg) {\n            resume(\"throw\", arg);\n          });\n        } else {\n          settle(result.done ? \"return\" : \"normal\", result.value);\n        }\n      } catch (err) {\n        settle(\"throw\", err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case \"return\":\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case \"throw\":\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== \"function\") {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === \"function\" && Symbol.asyncIterator) {\n    AsyncGenerator.prototype[Symbol.asyncIterator] = function () {\n      return this;\n    };\n  }\n\n  AsyncGenerator.prototype.next = function (arg) {\n    return this._invoke(\"next\", arg);\n  };\n\n  AsyncGenerator.prototype.throw = function (arg) {\n    return this._invoke(\"throw\", arg);\n  };\n\n  AsyncGenerator.prototype.return = function (arg) {\n    return this._invoke(\"return\", arg);\n  };\n\n  return {\n    wrap: function (fn) {\n      return function () {\n        return new AsyncGenerator(fn.apply(this, arguments));\n      };\n    },\n    await: function (value) {\n      return new AwaitValue(value);\n    }\n  };\n}();\n\n\n\n\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nvar MIN_TIMESTEP = 0.001;\nvar MAX_TIMESTEP = 1;\nvar dataUri = function dataUri(mimeType, svg) {\n  return 'data:' + mimeType + ',' + encodeURIComponent(svg);\n};\n\nvar lerp = function lerp(a, b, t) {\n  return a + (b - a) * t;\n};\nvar isIOS = function () {\n  var isIOS = /iPad|iPhone|iPod/.test(navigator.platform);\n  return function () {\n    return isIOS;\n  };\n}();\nvar isWebViewAndroid = function () {\n  var isWebViewAndroid = navigator.userAgent.indexOf('Version') !== -1 && navigator.userAgent.indexOf('Android') !== -1 && navigator.userAgent.indexOf('Chrome') !== -1;\n  return function () {\n    return isWebViewAndroid;\n  };\n}();\nvar isSafari = function () {\n  var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n  return function () {\n    return isSafari;\n  };\n}();\nvar isFirefoxAndroid = function () {\n  var isFirefoxAndroid = navigator.userAgent.indexOf('Firefox') !== -1 && navigator.userAgent.indexOf('Android') !== -1;\n  return function () {\n    return isFirefoxAndroid;\n  };\n}();\nvar getChromeVersion = function () {\n  var match = navigator.userAgent.match(/.*Chrome\\/([0-9]+)/);\n  var value = match ? parseInt(match[1], 10) : null;\n  return function () {\n    return value;\n  };\n}();\nvar isSafariWithoutDeviceMotion = function () {\n  var value = false;\n  value = isIOS() && isSafari() && navigator.userAgent.indexOf('13_4') !== -1;\n  return function () {\n    return value;\n  };\n}();\nvar isChromeWithoutDeviceMotion = function () {\n  var value = false;\n  if (getChromeVersion() === 65) {\n    var match = navigator.userAgent.match(/.*Chrome\\/([0-9\\.]*)/);\n    if (match) {\n      var _match$1$split = match[1].split('.'),\n          _match$1$split2 = slicedToArray(_match$1$split, 4),\n          major = _match$1$split2[0],\n          minor = _match$1$split2[1],\n          branch = _match$1$split2[2],\n          build = _match$1$split2[3];\n      value = parseInt(branch, 10) === 3325 && parseInt(build, 10) < 148;\n    }\n  }\n  return function () {\n    return value;\n  };\n}();\nvar isR7 = function () {\n  var isR7 = navigator.userAgent.indexOf('R7 Build') !== -1;\n  return function () {\n    return isR7;\n  };\n}();\nvar isLandscapeMode = function isLandscapeMode() {\n  var rtn = window.orientation == 90 || window.orientation == -90;\n  return isR7() ? !rtn : rtn;\n};\nvar isTimestampDeltaValid = function isTimestampDeltaValid(timestampDeltaS) {\n  if (isNaN(timestampDeltaS)) {\n    return false;\n  }\n  if (timestampDeltaS <= MIN_TIMESTEP) {\n    return false;\n  }\n  if (timestampDeltaS > MAX_TIMESTEP) {\n    return false;\n  }\n  return true;\n};\nvar getScreenWidth = function getScreenWidth() {\n  return Math.max(window.screen.width, window.screen.height) * window.devicePixelRatio;\n};\nvar getScreenHeight = function getScreenHeight() {\n  return Math.min(window.screen.width, window.screen.height) * window.devicePixelRatio;\n};\nvar requestFullscreen = function requestFullscreen(element) {\n  if (isWebViewAndroid()) {\n    return false;\n  }\n  if (element.requestFullscreen) {\n    element.requestFullscreen();\n  } else if (element.webkitRequestFullscreen) {\n    element.webkitRequestFullscreen();\n  } else if (element.mozRequestFullScreen) {\n    element.mozRequestFullScreen();\n  } else if (element.msRequestFullscreen) {\n    element.msRequestFullscreen();\n  } else {\n    return false;\n  }\n  return true;\n};\nvar exitFullscreen = function exitFullscreen() {\n  if (document.exitFullscreen) {\n    document.exitFullscreen();\n  } else if (document.webkitExitFullscreen) {\n    document.webkitExitFullscreen();\n  } else if (document.mozCancelFullScreen) {\n    document.mozCancelFullScreen();\n  } else if (document.msExitFullscreen) {\n    document.msExitFullscreen();\n  } else {\n    return false;\n  }\n  return true;\n};\nvar getFullscreenElement = function getFullscreenElement() {\n  return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;\n};\nvar linkProgram = function linkProgram(gl, vertexSource, fragmentSource, attribLocationMap) {\n  var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n  gl.shaderSource(vertexShader, vertexSource);\n  gl.compileShader(vertexShader);\n  var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n  gl.shaderSource(fragmentShader, fragmentSource);\n  gl.compileShader(fragmentShader);\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  for (var attribName in attribLocationMap) {\n    gl.bindAttribLocation(program, attribLocationMap[attribName], attribName);\n  }gl.linkProgram(program);\n  gl.deleteShader(vertexShader);\n  gl.deleteShader(fragmentShader);\n  return program;\n};\nvar getProgramUniforms = function getProgramUniforms(gl, program) {\n  var uniforms = {};\n  var uniformCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  var uniformName = '';\n  for (var i = 0; i < uniformCount; i++) {\n    var uniformInfo = gl.getActiveUniform(program, i);\n    uniformName = uniformInfo.name.replace('[0]', '');\n    uniforms[uniformName] = gl.getUniformLocation(program, uniformName);\n  }\n  return uniforms;\n};\nvar orthoMatrix = function orthoMatrix(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right),\n      bt = 1 / (bottom - top),\n      nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n};\n\nvar isMobile = function isMobile() {\n  var check = false;\n  (function (a) {\n    if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true;\n  })(navigator.userAgent || navigator.vendor || window.opera);\n  return check;\n};\nvar extend = function extend(dest, src) {\n  for (var key in src) {\n    if (src.hasOwnProperty(key)) {\n      dest[key] = src[key];\n    }\n  }\n  return dest;\n};\nvar safariCssSizeWorkaround = function safariCssSizeWorkaround(canvas) {\n  if (isIOS()) {\n    var width = canvas.style.width;\n    var height = canvas.style.height;\n    canvas.style.width = parseInt(width) + 1 + 'px';\n    canvas.style.height = parseInt(height) + 'px';\n    setTimeout(function () {\n      canvas.style.width = width;\n      canvas.style.height = height;\n    }, 100);\n  }\n  window.canvas = canvas;\n};\nvar frameDataFromPose = function () {\n  var piOver180 = Math.PI / 180.0;\n  var rad45 = Math.PI * 0.25;\n  function mat4_perspectiveFromFieldOfView(out, fov, near, far) {\n    var upTan = Math.tan(fov ? fov.upDegrees * piOver180 : rad45),\n        downTan = Math.tan(fov ? fov.downDegrees * piOver180 : rad45),\n        leftTan = Math.tan(fov ? fov.leftDegrees * piOver180 : rad45),\n        rightTan = Math.tan(fov ? fov.rightDegrees * piOver180 : rad45),\n        xScale = 2.0 / (leftTan + rightTan),\n        yScale = 2.0 / (upTan + downTan);\n    out[0] = xScale;\n    out[1] = 0.0;\n    out[2] = 0.0;\n    out[3] = 0.0;\n    out[4] = 0.0;\n    out[5] = yScale;\n    out[6] = 0.0;\n    out[7] = 0.0;\n    out[8] = -((leftTan - rightTan) * xScale * 0.5);\n    out[9] = (upTan - downTan) * yScale * 0.5;\n    out[10] = far / (near - far);\n    out[11] = -1.0;\n    out[12] = 0.0;\n    out[13] = 0.0;\n    out[14] = far * near / (near - far);\n    out[15] = 0.0;\n    return out;\n  }\n  function mat4_fromRotationTranslation(out, q, v) {\n    var x = q[0],\n        y = q[1],\n        z = q[2],\n        w = q[3],\n        x2 = x + x,\n        y2 = y + y,\n        z2 = z + z,\n        xx = x * x2,\n        xy = x * y2,\n        xz = x * z2,\n        yy = y * y2,\n        yz = y * z2,\n        zz = z * z2,\n        wx = w * x2,\n        wy = w * y2,\n        wz = w * z2;\n    out[0] = 1 - (yy + zz);\n    out[1] = xy + wz;\n    out[2] = xz - wy;\n    out[3] = 0;\n    out[4] = xy - wz;\n    out[5] = 1 - (xx + zz);\n    out[6] = yz + wx;\n    out[7] = 0;\n    out[8] = xz + wy;\n    out[9] = yz - wx;\n    out[10] = 1 - (xx + yy);\n    out[11] = 0;\n    out[12] = v[0];\n    out[13] = v[1];\n    out[14] = v[2];\n    out[15] = 1;\n    return out;\n  }\n  function mat4_translate(out, a, v) {\n    var x = v[0],\n        y = v[1],\n        z = v[2],\n        a00,\n        a01,\n        a02,\n        a03,\n        a10,\n        a11,\n        a12,\n        a13,\n        a20,\n        a21,\n        a22,\n        a23;\n    if (a === out) {\n      out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n      out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n      out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n      out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n    } else {\n      a00 = a[0];a01 = a[1];a02 = a[2];a03 = a[3];\n      a10 = a[4];a11 = a[5];a12 = a[6];a13 = a[7];\n      a20 = a[8];a21 = a[9];a22 = a[10];a23 = a[11];\n      out[0] = a00;out[1] = a01;out[2] = a02;out[3] = a03;\n      out[4] = a10;out[5] = a11;out[6] = a12;out[7] = a13;\n      out[8] = a20;out[9] = a21;out[10] = a22;out[11] = a23;\n      out[12] = a00 * x + a10 * y + a20 * z + a[12];\n      out[13] = a01 * x + a11 * y + a21 * z + a[13];\n      out[14] = a02 * x + a12 * y + a22 * z + a[14];\n      out[15] = a03 * x + a13 * y + a23 * z + a[15];\n    }\n    return out;\n  }\n  function mat4_invert(out, a) {\n    var a00 = a[0],\n        a01 = a[1],\n        a02 = a[2],\n        a03 = a[3],\n        a10 = a[4],\n        a11 = a[5],\n        a12 = a[6],\n        a13 = a[7],\n        a20 = a[8],\n        a21 = a[9],\n        a22 = a[10],\n        a23 = a[11],\n        a30 = a[12],\n        a31 = a[13],\n        a32 = a[14],\n        a33 = a[15],\n        b00 = a00 * a11 - a01 * a10,\n        b01 = a00 * a12 - a02 * a10,\n        b02 = a00 * a13 - a03 * a10,\n        b03 = a01 * a12 - a02 * a11,\n        b04 = a01 * a13 - a03 * a11,\n        b05 = a02 * a13 - a03 * a12,\n        b06 = a20 * a31 - a21 * a30,\n        b07 = a20 * a32 - a22 * a30,\n        b08 = a20 * a33 - a23 * a30,\n        b09 = a21 * a32 - a22 * a31,\n        b10 = a21 * a33 - a23 * a31,\n        b11 = a22 * a33 - a23 * a32,\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    if (!det) {\n      return null;\n    }\n    det = 1.0 / det;\n    out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n    out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n    out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n    out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n    out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n    out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n    out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n    out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n    out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n    out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n    out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n    out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n    out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n    out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n    out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n    out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n    return out;\n  }\n  var defaultOrientation = new Float32Array([0, 0, 0, 1]);\n  var defaultPosition = new Float32Array([0, 0, 0]);\n  function updateEyeMatrices(projection, view, pose, fov, offset, vrDisplay) {\n    mat4_perspectiveFromFieldOfView(projection, fov || null, vrDisplay.depthNear, vrDisplay.depthFar);\n    var orientation = pose.orientation || defaultOrientation;\n    var position = pose.position || defaultPosition;\n    mat4_fromRotationTranslation(view, orientation, position);\n    if (offset) mat4_translate(view, view, offset);\n    mat4_invert(view, view);\n  }\n  return function (frameData, pose, vrDisplay) {\n    if (!frameData || !pose) return false;\n    frameData.pose = pose;\n    frameData.timestamp = pose.timestamp;\n    updateEyeMatrices(frameData.leftProjectionMatrix, frameData.leftViewMatrix, pose, vrDisplay._getFieldOfView(\"left\"), vrDisplay._getEyeOffset(\"left\"), vrDisplay);\n    updateEyeMatrices(frameData.rightProjectionMatrix, frameData.rightViewMatrix, pose, vrDisplay._getFieldOfView(\"right\"), vrDisplay._getEyeOffset(\"right\"), vrDisplay);\n    return true;\n  };\n}();\nvar isInsideCrossOriginIFrame = function isInsideCrossOriginIFrame() {\n  var isFramed = window.self !== window.top;\n  var refOrigin = getOriginFromUrl(document.referrer);\n  var thisOrigin = getOriginFromUrl(window.location.href);\n  return isFramed && refOrigin !== thisOrigin;\n};\nvar getOriginFromUrl = function getOriginFromUrl(url) {\n  var domainIdx;\n  var protoSepIdx = url.indexOf(\"://\");\n  if (protoSepIdx !== -1) {\n    domainIdx = protoSepIdx + 3;\n  } else {\n    domainIdx = 0;\n  }\n  var domainEndIdx = url.indexOf('/', domainIdx);\n  if (domainEndIdx === -1) {\n    domainEndIdx = url.length;\n  }\n  return url.substring(0, domainEndIdx);\n};\nvar getQuaternionAngle = function getQuaternionAngle(quat) {\n  if (quat.w > 1) {\n    console.warn('getQuaternionAngle: w > 1');\n    return 0;\n  }\n  var angle = 2 * Math.acos(quat.w);\n  return angle;\n};\nvar warnOnce = function () {\n  var observedWarnings = {};\n  return function (key, message) {\n    if (observedWarnings[key] === undefined) {\n      console.warn('webvr-polyfill: ' + message);\n      observedWarnings[key] = true;\n    }\n  };\n}();\nvar deprecateWarning = function deprecateWarning(deprecated, suggested) {\n  var alternative = suggested ? 'Please use ' + suggested + ' instead.' : '';\n  warnOnce(deprecated, deprecated + ' has been deprecated. ' + 'This may not work on native WebVR displays. ' + alternative);\n};\n\nfunction WGLUPreserveGLState(gl, bindings, callback) {\n  if (!bindings) {\n    callback(gl);\n    return;\n  }\n  var boundValues = [];\n  var activeTexture = null;\n  for (var i = 0; i < bindings.length; ++i) {\n    var binding = bindings[i];\n    switch (binding) {\n      case gl.TEXTURE_BINDING_2D:\n      case gl.TEXTURE_BINDING_CUBE_MAP:\n        var textureUnit = bindings[++i];\n        if (textureUnit < gl.TEXTURE0 || textureUnit > gl.TEXTURE31) {\n          console.error(\"TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit\");\n          boundValues.push(null, null);\n          break;\n        }\n        if (!activeTexture) {\n          activeTexture = gl.getParameter(gl.ACTIVE_TEXTURE);\n        }\n        gl.activeTexture(textureUnit);\n        boundValues.push(gl.getParameter(binding), null);\n        break;\n      case gl.ACTIVE_TEXTURE:\n        activeTexture = gl.getParameter(gl.ACTIVE_TEXTURE);\n        boundValues.push(null);\n        break;\n      default:\n        boundValues.push(gl.getParameter(binding));\n        break;\n    }\n  }\n  callback(gl);\n  for (var i = 0; i < bindings.length; ++i) {\n    var binding = bindings[i];\n    var boundValue = boundValues[i];\n    switch (binding) {\n      case gl.ACTIVE_TEXTURE:\n        break;\n      case gl.ARRAY_BUFFER_BINDING:\n        gl.bindBuffer(gl.ARRAY_BUFFER, boundValue);\n        break;\n      case gl.COLOR_CLEAR_VALUE:\n        gl.clearColor(boundValue[0], boundValue[1], boundValue[2], boundValue[3]);\n        break;\n      case gl.COLOR_WRITEMASK:\n        gl.colorMask(boundValue[0], boundValue[1], boundValue[2], boundValue[3]);\n        break;\n      case gl.CURRENT_PROGRAM:\n        gl.useProgram(boundValue);\n        break;\n      case gl.ELEMENT_ARRAY_BUFFER_BINDING:\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, boundValue);\n        break;\n      case gl.FRAMEBUFFER_BINDING:\n        gl.bindFramebuffer(gl.FRAMEBUFFER, boundValue);\n        break;\n      case gl.RENDERBUFFER_BINDING:\n        gl.bindRenderbuffer(gl.RENDERBUFFER, boundValue);\n        break;\n      case gl.TEXTURE_BINDING_2D:\n        var textureUnit = bindings[++i];\n        if (textureUnit < gl.TEXTURE0 || textureUnit > gl.TEXTURE31)\n          break;\n        gl.activeTexture(textureUnit);\n        gl.bindTexture(gl.TEXTURE_2D, boundValue);\n        break;\n      case gl.TEXTURE_BINDING_CUBE_MAP:\n        var textureUnit = bindings[++i];\n        if (textureUnit < gl.TEXTURE0 || textureUnit > gl.TEXTURE31)\n          break;\n        gl.activeTexture(textureUnit);\n        gl.bindTexture(gl.TEXTURE_CUBE_MAP, boundValue);\n        break;\n      case gl.VIEWPORT:\n        gl.viewport(boundValue[0], boundValue[1], boundValue[2], boundValue[3]);\n        break;\n      case gl.BLEND:\n      case gl.CULL_FACE:\n      case gl.DEPTH_TEST:\n      case gl.SCISSOR_TEST:\n      case gl.STENCIL_TEST:\n        if (boundValue) {\n          gl.enable(binding);\n        } else {\n          gl.disable(binding);\n        }\n        break;\n      default:\n        console.log(\"No GL restore behavior for 0x\" + binding.toString(16));\n        break;\n    }\n    if (activeTexture) {\n      gl.activeTexture(activeTexture);\n    }\n  }\n}\nvar glPreserveState = WGLUPreserveGLState;\n\nvar distortionVS = ['attribute vec2 position;', 'attribute vec3 texCoord;', 'varying vec2 vTexCoord;', 'uniform vec4 viewportOffsetScale[2];', 'void main() {', '  vec4 viewport = viewportOffsetScale[int(texCoord.z)];', '  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;', '  gl_Position = vec4( position, 1.0, 1.0 );', '}'].join('\\n');\nvar distortionFS = ['precision mediump float;', 'uniform sampler2D diffuse;', 'varying vec2 vTexCoord;', 'void main() {', '  gl_FragColor = texture2D(diffuse, vTexCoord);', '}'].join('\\n');\nfunction CardboardDistorter(gl, cardboardUI, bufferScale, dirtySubmitFrameBindings) {\n  this.gl = gl;\n  this.cardboardUI = cardboardUI;\n  this.bufferScale = bufferScale;\n  this.dirtySubmitFrameBindings = dirtySubmitFrameBindings;\n  this.ctxAttribs = gl.getContextAttributes();\n  this.instanceExt = gl.getExtension('ANGLE_instanced_arrays');\n  this.meshWidth = 20;\n  this.meshHeight = 20;\n  this.bufferWidth = gl.drawingBufferWidth;\n  this.bufferHeight = gl.drawingBufferHeight;\n  this.realBindFramebuffer = gl.bindFramebuffer;\n  this.realEnable = gl.enable;\n  this.realDisable = gl.disable;\n  this.realColorMask = gl.colorMask;\n  this.realClearColor = gl.clearColor;\n  this.realViewport = gl.viewport;\n  if (!isIOS()) {\n    this.realCanvasWidth = Object.getOwnPropertyDescriptor(gl.canvas.__proto__, 'width');\n    this.realCanvasHeight = Object.getOwnPropertyDescriptor(gl.canvas.__proto__, 'height');\n  }\n  this.isPatched = false;\n  this.lastBoundFramebuffer = null;\n  this.cullFace = false;\n  this.depthTest = false;\n  this.blend = false;\n  this.scissorTest = false;\n  this.stencilTest = false;\n  this.viewport = [0, 0, 0, 0];\n  this.colorMask = [true, true, true, true];\n  this.clearColor = [0, 0, 0, 0];\n  this.attribs = {\n    position: 0,\n    texCoord: 1\n  };\n  this.program = linkProgram(gl, distortionVS, distortionFS, this.attribs);\n  this.uniforms = getProgramUniforms(gl, this.program);\n  this.viewportOffsetScale = new Float32Array(8);\n  this.setTextureBounds();\n  this.vertexBuffer = gl.createBuffer();\n  this.indexBuffer = gl.createBuffer();\n  this.indexCount = 0;\n  this.renderTarget = gl.createTexture();\n  this.framebuffer = gl.createFramebuffer();\n  this.depthStencilBuffer = null;\n  this.depthBuffer = null;\n  this.stencilBuffer = null;\n  if (this.ctxAttribs.depth && this.ctxAttribs.stencil) {\n    this.depthStencilBuffer = gl.createRenderbuffer();\n  } else if (this.ctxAttribs.depth) {\n    this.depthBuffer = gl.createRenderbuffer();\n  } else if (this.ctxAttribs.stencil) {\n    this.stencilBuffer = gl.createRenderbuffer();\n  }\n  this.patch();\n  this.onResize();\n}\nCardboardDistorter.prototype.destroy = function () {\n  var gl = this.gl;\n  this.unpatch();\n  gl.deleteProgram(this.program);\n  gl.deleteBuffer(this.vertexBuffer);\n  gl.deleteBuffer(this.indexBuffer);\n  gl.deleteTexture(this.renderTarget);\n  gl.deleteFramebuffer(this.framebuffer);\n  if (this.depthStencilBuffer) {\n    gl.deleteRenderbuffer(this.depthStencilBuffer);\n  }\n  if (this.depthBuffer) {\n    gl.deleteRenderbuffer(this.depthBuffer);\n  }\n  if (this.stencilBuffer) {\n    gl.deleteRenderbuffer(this.stencilBuffer);\n  }\n  if (this.cardboardUI) {\n    this.cardboardUI.destroy();\n  }\n};\nCardboardDistorter.prototype.onResize = function () {\n  var gl = this.gl;\n  var self = this;\n  var glState = [gl.RENDERBUFFER_BINDING, gl.TEXTURE_BINDING_2D, gl.TEXTURE0];\n  glPreserveState(gl, glState, function (gl) {\n    self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, null);\n    if (self.scissorTest) {\n      self.realDisable.call(gl, gl.SCISSOR_TEST);\n    }\n    self.realColorMask.call(gl, true, true, true, true);\n    self.realViewport.call(gl, 0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n    self.realClearColor.call(gl, 0, 0, 0, 1);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, self.framebuffer);\n    gl.bindTexture(gl.TEXTURE_2D, self.renderTarget);\n    gl.texImage2D(gl.TEXTURE_2D, 0, self.ctxAttribs.alpha ? gl.RGBA : gl.RGB, self.bufferWidth, self.bufferHeight, 0, self.ctxAttribs.alpha ? gl.RGBA : gl.RGB, gl.UNSIGNED_BYTE, null);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, self.renderTarget, 0);\n    if (self.ctxAttribs.depth && self.ctxAttribs.stencil) {\n      gl.bindRenderbuffer(gl.RENDERBUFFER, self.depthStencilBuffer);\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, self.bufferWidth, self.bufferHeight);\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.RENDERBUFFER, self.depthStencilBuffer);\n    } else if (self.ctxAttribs.depth) {\n      gl.bindRenderbuffer(gl.RENDERBUFFER, self.depthBuffer);\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, self.bufferWidth, self.bufferHeight);\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, self.depthBuffer);\n    } else if (self.ctxAttribs.stencil) {\n      gl.bindRenderbuffer(gl.RENDERBUFFER, self.stencilBuffer);\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.STENCIL_INDEX8, self.bufferWidth, self.bufferHeight);\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.STENCIL_ATTACHMENT, gl.RENDERBUFFER, self.stencilBuffer);\n    }\n    if (!gl.checkFramebufferStatus(gl.FRAMEBUFFER) === gl.FRAMEBUFFER_COMPLETE) {\n      console.error('Framebuffer incomplete!');\n    }\n    self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, self.lastBoundFramebuffer);\n    if (self.scissorTest) {\n      self.realEnable.call(gl, gl.SCISSOR_TEST);\n    }\n    self.realColorMask.apply(gl, self.colorMask);\n    self.realViewport.apply(gl, self.viewport);\n    self.realClearColor.apply(gl, self.clearColor);\n  });\n  if (this.cardboardUI) {\n    this.cardboardUI.onResize();\n  }\n};\nCardboardDistorter.prototype.patch = function () {\n  if (this.isPatched) {\n    return;\n  }\n  var self = this;\n  var canvas = this.gl.canvas;\n  var gl = this.gl;\n  if (!isIOS()) {\n    canvas.width = getScreenWidth() * this.bufferScale;\n    canvas.height = getScreenHeight() * this.bufferScale;\n    Object.defineProperty(canvas, 'width', {\n      configurable: true,\n      enumerable: true,\n      get: function get() {\n        return self.bufferWidth;\n      },\n      set: function set(value) {\n        self.bufferWidth = value;\n        self.realCanvasWidth.set.call(canvas, value);\n        self.onResize();\n      }\n    });\n    Object.defineProperty(canvas, 'height', {\n      configurable: true,\n      enumerable: true,\n      get: function get() {\n        return self.bufferHeight;\n      },\n      set: function set(value) {\n        self.bufferHeight = value;\n        self.realCanvasHeight.set.call(canvas, value);\n        self.onResize();\n      }\n    });\n  }\n  this.lastBoundFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n  if (this.lastBoundFramebuffer == null) {\n    this.lastBoundFramebuffer = this.framebuffer;\n    this.gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\n  }\n  this.gl.bindFramebuffer = function (target, framebuffer) {\n    self.lastBoundFramebuffer = framebuffer ? framebuffer : self.framebuffer;\n    self.realBindFramebuffer.call(gl, target, self.lastBoundFramebuffer);\n  };\n  this.cullFace = gl.getParameter(gl.CULL_FACE);\n  this.depthTest = gl.getParameter(gl.DEPTH_TEST);\n  this.blend = gl.getParameter(gl.BLEND);\n  this.scissorTest = gl.getParameter(gl.SCISSOR_TEST);\n  this.stencilTest = gl.getParameter(gl.STENCIL_TEST);\n  gl.enable = function (pname) {\n    switch (pname) {\n      case gl.CULL_FACE:\n        self.cullFace = true;break;\n      case gl.DEPTH_TEST:\n        self.depthTest = true;break;\n      case gl.BLEND:\n        self.blend = true;break;\n      case gl.SCISSOR_TEST:\n        self.scissorTest = true;break;\n      case gl.STENCIL_TEST:\n        self.stencilTest = true;break;\n    }\n    self.realEnable.call(gl, pname);\n  };\n  gl.disable = function (pname) {\n    switch (pname) {\n      case gl.CULL_FACE:\n        self.cullFace = false;break;\n      case gl.DEPTH_TEST:\n        self.depthTest = false;break;\n      case gl.BLEND:\n        self.blend = false;break;\n      case gl.SCISSOR_TEST:\n        self.scissorTest = false;break;\n      case gl.STENCIL_TEST:\n        self.stencilTest = false;break;\n    }\n    self.realDisable.call(gl, pname);\n  };\n  this.colorMask = gl.getParameter(gl.COLOR_WRITEMASK);\n  gl.colorMask = function (r, g, b, a) {\n    self.colorMask[0] = r;\n    self.colorMask[1] = g;\n    self.colorMask[2] = b;\n    self.colorMask[3] = a;\n    self.realColorMask.call(gl, r, g, b, a);\n  };\n  this.clearColor = gl.getParameter(gl.COLOR_CLEAR_VALUE);\n  gl.clearColor = function (r, g, b, a) {\n    self.clearColor[0] = r;\n    self.clearColor[1] = g;\n    self.clearColor[2] = b;\n    self.clearColor[3] = a;\n    self.realClearColor.call(gl, r, g, b, a);\n  };\n  this.viewport = gl.getParameter(gl.VIEWPORT);\n  gl.viewport = function (x, y, w, h) {\n    self.viewport[0] = x;\n    self.viewport[1] = y;\n    self.viewport[2] = w;\n    self.viewport[3] = h;\n    self.realViewport.call(gl, x, y, w, h);\n  };\n  this.isPatched = true;\n  safariCssSizeWorkaround(canvas);\n};\nCardboardDistorter.prototype.unpatch = function () {\n  if (!this.isPatched) {\n    return;\n  }\n  var gl = this.gl;\n  var canvas = this.gl.canvas;\n  if (!isIOS()) {\n    Object.defineProperty(canvas, 'width', this.realCanvasWidth);\n    Object.defineProperty(canvas, 'height', this.realCanvasHeight);\n  }\n  canvas.width = this.bufferWidth;\n  canvas.height = this.bufferHeight;\n  gl.bindFramebuffer = this.realBindFramebuffer;\n  gl.enable = this.realEnable;\n  gl.disable = this.realDisable;\n  gl.colorMask = this.realColorMask;\n  gl.clearColor = this.realClearColor;\n  gl.viewport = this.realViewport;\n  if (this.lastBoundFramebuffer == this.framebuffer) {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  }\n  this.isPatched = false;\n  setTimeout(function () {\n    safariCssSizeWorkaround(canvas);\n  }, 1);\n};\nCardboardDistorter.prototype.setTextureBounds = function (leftBounds, rightBounds) {\n  if (!leftBounds) {\n    leftBounds = [0, 0, 0.5, 1];\n  }\n  if (!rightBounds) {\n    rightBounds = [0.5, 0, 0.5, 1];\n  }\n  this.viewportOffsetScale[0] = leftBounds[0];\n  this.viewportOffsetScale[1] = leftBounds[1];\n  this.viewportOffsetScale[2] = leftBounds[2];\n  this.viewportOffsetScale[3] = leftBounds[3];\n  this.viewportOffsetScale[4] = rightBounds[0];\n  this.viewportOffsetScale[5] = rightBounds[1];\n  this.viewportOffsetScale[6] = rightBounds[2];\n  this.viewportOffsetScale[7] = rightBounds[3];\n};\nCardboardDistorter.prototype.submitFrame = function () {\n  var gl = this.gl;\n  var self = this;\n  var glState = [];\n  if (!this.dirtySubmitFrameBindings) {\n    glState.push(gl.CURRENT_PROGRAM, gl.ARRAY_BUFFER_BINDING, gl.ELEMENT_ARRAY_BUFFER_BINDING, gl.TEXTURE_BINDING_2D, gl.TEXTURE0);\n  }\n  glPreserveState(gl, glState, function (gl) {\n    self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, null);\n    var positionDivisor = 0;\n    var texCoordDivisor = 0;\n    if (self.instanceExt) {\n      positionDivisor = gl.getVertexAttrib(self.attribs.position, self.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE);\n      texCoordDivisor = gl.getVertexAttrib(self.attribs.texCoord, self.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE);\n    }\n    if (self.cullFace) {\n      self.realDisable.call(gl, gl.CULL_FACE);\n    }\n    if (self.depthTest) {\n      self.realDisable.call(gl, gl.DEPTH_TEST);\n    }\n    if (self.blend) {\n      self.realDisable.call(gl, gl.BLEND);\n    }\n    if (self.scissorTest) {\n      self.realDisable.call(gl, gl.SCISSOR_TEST);\n    }\n    if (self.stencilTest) {\n      self.realDisable.call(gl, gl.STENCIL_TEST);\n    }\n    self.realColorMask.call(gl, true, true, true, true);\n    self.realViewport.call(gl, 0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n    if (self.ctxAttribs.alpha || isIOS()) {\n      self.realClearColor.call(gl, 0, 0, 0, 1);\n      gl.clear(gl.COLOR_BUFFER_BIT);\n    }\n    gl.useProgram(self.program);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, self.indexBuffer);\n    gl.bindBuffer(gl.ARRAY_BUFFER, self.vertexBuffer);\n    gl.enableVertexAttribArray(self.attribs.position);\n    gl.enableVertexAttribArray(self.attribs.texCoord);\n    gl.vertexAttribPointer(self.attribs.position, 2, gl.FLOAT, false, 20, 0);\n    gl.vertexAttribPointer(self.attribs.texCoord, 3, gl.FLOAT, false, 20, 8);\n    if (self.instanceExt) {\n      if (positionDivisor != 0) {\n        self.instanceExt.vertexAttribDivisorANGLE(self.attribs.position, 0);\n      }\n      if (texCoordDivisor != 0) {\n        self.instanceExt.vertexAttribDivisorANGLE(self.attribs.texCoord, 0);\n      }\n    }\n    gl.activeTexture(gl.TEXTURE0);\n    gl.uniform1i(self.uniforms.diffuse, 0);\n    gl.bindTexture(gl.TEXTURE_2D, self.renderTarget);\n    gl.uniform4fv(self.uniforms.viewportOffsetScale, self.viewportOffsetScale);\n    gl.drawElements(gl.TRIANGLES, self.indexCount, gl.UNSIGNED_SHORT, 0);\n    if (self.cardboardUI) {\n      self.cardboardUI.renderNoState();\n    }\n    self.realBindFramebuffer.call(self.gl, gl.FRAMEBUFFER, self.framebuffer);\n    if (!self.ctxAttribs.preserveDrawingBuffer) {\n      self.realClearColor.call(gl, 0, 0, 0, 0);\n      gl.clear(gl.COLOR_BUFFER_BIT);\n    }\n    if (!self.dirtySubmitFrameBindings) {\n      self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, self.lastBoundFramebuffer);\n    }\n    if (self.cullFace) {\n      self.realEnable.call(gl, gl.CULL_FACE);\n    }\n    if (self.depthTest) {\n      self.realEnable.call(gl, gl.DEPTH_TEST);\n    }\n    if (self.blend) {\n      self.realEnable.call(gl, gl.BLEND);\n    }\n    if (self.scissorTest) {\n      self.realEnable.call(gl, gl.SCISSOR_TEST);\n    }\n    if (self.stencilTest) {\n      self.realEnable.call(gl, gl.STENCIL_TEST);\n    }\n    self.realColorMask.apply(gl, self.colorMask);\n    self.realViewport.apply(gl, self.viewport);\n    if (self.ctxAttribs.alpha || !self.ctxAttribs.preserveDrawingBuffer) {\n      self.realClearColor.apply(gl, self.clearColor);\n    }\n    if (self.instanceExt) {\n      if (positionDivisor != 0) {\n        self.instanceExt.vertexAttribDivisorANGLE(self.attribs.position, positionDivisor);\n      }\n      if (texCoordDivisor != 0) {\n        self.instanceExt.vertexAttribDivisorANGLE(self.attribs.texCoord, texCoordDivisor);\n      }\n    }\n  });\n  if (isIOS()) {\n    var canvas = gl.canvas;\n    if (canvas.width != self.bufferWidth || canvas.height != self.bufferHeight) {\n      self.bufferWidth = canvas.width;\n      self.bufferHeight = canvas.height;\n      self.onResize();\n    }\n  }\n};\nCardboardDistorter.prototype.updateDeviceInfo = function (deviceInfo) {\n  var gl = this.gl;\n  var self = this;\n  var glState = [gl.ARRAY_BUFFER_BINDING, gl.ELEMENT_ARRAY_BUFFER_BINDING];\n  glPreserveState(gl, glState, function (gl) {\n    var vertices = self.computeMeshVertices_(self.meshWidth, self.meshHeight, deviceInfo);\n    gl.bindBuffer(gl.ARRAY_BUFFER, self.vertexBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n    if (!self.indexCount) {\n      var indices = self.computeMeshIndices_(self.meshWidth, self.meshHeight);\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, self.indexBuffer);\n      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);\n      self.indexCount = indices.length;\n    }\n  });\n};\nCardboardDistorter.prototype.computeMeshVertices_ = function (width, height, deviceInfo) {\n  var vertices = new Float32Array(2 * width * height * 5);\n  var lensFrustum = deviceInfo.getLeftEyeVisibleTanAngles();\n  var noLensFrustum = deviceInfo.getLeftEyeNoLensTanAngles();\n  var viewport = deviceInfo.getLeftEyeVisibleScreenRect(noLensFrustum);\n  var vidx = 0;\n  for (var e = 0; e < 2; e++) {\n    for (var j = 0; j < height; j++) {\n      for (var i = 0; i < width; i++, vidx++) {\n        var u = i / (width - 1);\n        var v = j / (height - 1);\n        var s = u;\n        var t = v;\n        var x = lerp(lensFrustum[0], lensFrustum[2], u);\n        var y = lerp(lensFrustum[3], lensFrustum[1], v);\n        var d = Math.sqrt(x * x + y * y);\n        var r = deviceInfo.distortion.distortInverse(d);\n        var p = x * r / d;\n        var q = y * r / d;\n        u = (p - noLensFrustum[0]) / (noLensFrustum[2] - noLensFrustum[0]);\n        v = (q - noLensFrustum[3]) / (noLensFrustum[1] - noLensFrustum[3]);\n        u = (viewport.x + u * viewport.width - 0.5) * 2.0;\n        v = (viewport.y + v * viewport.height - 0.5) * 2.0;\n        vertices[vidx * 5 + 0] = u;\n        vertices[vidx * 5 + 1] = v;\n        vertices[vidx * 5 + 2] = s;\n        vertices[vidx * 5 + 3] = t;\n        vertices[vidx * 5 + 4] = e;\n      }\n    }\n    var w = lensFrustum[2] - lensFrustum[0];\n    lensFrustum[0] = -(w + lensFrustum[0]);\n    lensFrustum[2] = w - lensFrustum[2];\n    w = noLensFrustum[2] - noLensFrustum[0];\n    noLensFrustum[0] = -(w + noLensFrustum[0]);\n    noLensFrustum[2] = w - noLensFrustum[2];\n    viewport.x = 1 - (viewport.x + viewport.width);\n  }\n  return vertices;\n};\nCardboardDistorter.prototype.computeMeshIndices_ = function (width, height) {\n  var indices = new Uint16Array(2 * (width - 1) * (height - 1) * 6);\n  var halfwidth = width / 2;\n  var halfheight = height / 2;\n  var vidx = 0;\n  var iidx = 0;\n  for (var e = 0; e < 2; e++) {\n    for (var j = 0; j < height; j++) {\n      for (var i = 0; i < width; i++, vidx++) {\n        if (i == 0 || j == 0) continue;\n        if (i <= halfwidth == j <= halfheight) {\n          indices[iidx++] = vidx;\n          indices[iidx++] = vidx - width - 1;\n          indices[iidx++] = vidx - width;\n          indices[iidx++] = vidx - width - 1;\n          indices[iidx++] = vidx;\n          indices[iidx++] = vidx - 1;\n        } else {\n          indices[iidx++] = vidx - 1;\n          indices[iidx++] = vidx - width;\n          indices[iidx++] = vidx;\n          indices[iidx++] = vidx - width;\n          indices[iidx++] = vidx - 1;\n          indices[iidx++] = vidx - width - 1;\n        }\n      }\n    }\n  }\n  return indices;\n};\nCardboardDistorter.prototype.getOwnPropertyDescriptor_ = function (proto, attrName) {\n  var descriptor = Object.getOwnPropertyDescriptor(proto, attrName);\n  if (descriptor.get === undefined || descriptor.set === undefined) {\n    descriptor.configurable = true;\n    descriptor.enumerable = true;\n    descriptor.get = function () {\n      return this.getAttribute(attrName);\n    };\n    descriptor.set = function (val) {\n      this.setAttribute(attrName, val);\n    };\n  }\n  return descriptor;\n};\n\nvar uiVS = ['attribute vec2 position;', 'uniform mat4 projectionMat;', 'void main() {', '  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );', '}'].join('\\n');\nvar uiFS = ['precision mediump float;', 'uniform vec4 color;', 'void main() {', '  gl_FragColor = color;', '}'].join('\\n');\nvar DEG2RAD = Math.PI / 180.0;\nvar kAnglePerGearSection = 60;\nvar kOuterRimEndAngle = 12;\nvar kInnerRimBeginAngle = 20;\nvar kOuterRadius = 1;\nvar kMiddleRadius = 0.75;\nvar kInnerRadius = 0.3125;\nvar kCenterLineThicknessDp = 4;\nvar kButtonWidthDp = 28;\nvar kTouchSlopFactor = 1.5;\nfunction CardboardUI(gl) {\n  this.gl = gl;\n  this.attribs = {\n    position: 0\n  };\n  this.program = linkProgram(gl, uiVS, uiFS, this.attribs);\n  this.uniforms = getProgramUniforms(gl, this.program);\n  this.vertexBuffer = gl.createBuffer();\n  this.gearOffset = 0;\n  this.gearVertexCount = 0;\n  this.arrowOffset = 0;\n  this.arrowVertexCount = 0;\n  this.projMat = new Float32Array(16);\n  this.listener = null;\n  this.onResize();\n}\nCardboardUI.prototype.destroy = function () {\n  var gl = this.gl;\n  if (this.listener) {\n    gl.canvas.removeEventListener('click', this.listener, false);\n  }\n  gl.deleteProgram(this.program);\n  gl.deleteBuffer(this.vertexBuffer);\n};\nCardboardUI.prototype.listen = function (optionsCallback, backCallback) {\n  var canvas = this.gl.canvas;\n  this.listener = function (event) {\n    var midline = canvas.clientWidth / 2;\n    var buttonSize = kButtonWidthDp * kTouchSlopFactor;\n    if (event.clientX > midline - buttonSize && event.clientX < midline + buttonSize && event.clientY > canvas.clientHeight - buttonSize) {\n      optionsCallback(event);\n    }\n    else if (event.clientX < buttonSize && event.clientY < buttonSize) {\n        backCallback(event);\n      }\n  };\n  canvas.addEventListener('click', this.listener, false);\n};\nCardboardUI.prototype.onResize = function () {\n  var gl = this.gl;\n  var self = this;\n  var glState = [gl.ARRAY_BUFFER_BINDING];\n  glPreserveState(gl, glState, function (gl) {\n    var vertices = [];\n    var midline = gl.drawingBufferWidth / 2;\n    var physicalPixels = Math.max(screen.width, screen.height) * window.devicePixelRatio;\n    var scalingRatio = gl.drawingBufferWidth / physicalPixels;\n    var dps = scalingRatio * window.devicePixelRatio;\n    var lineWidth = kCenterLineThicknessDp * dps / 2;\n    var buttonSize = kButtonWidthDp * kTouchSlopFactor * dps;\n    var buttonScale = kButtonWidthDp * dps / 2;\n    var buttonBorder = (kButtonWidthDp * kTouchSlopFactor - kButtonWidthDp) * dps;\n    vertices.push(midline - lineWidth, buttonSize);\n    vertices.push(midline - lineWidth, gl.drawingBufferHeight);\n    vertices.push(midline + lineWidth, buttonSize);\n    vertices.push(midline + lineWidth, gl.drawingBufferHeight);\n    self.gearOffset = vertices.length / 2;\n    function addGearSegment(theta, r) {\n      var angle = (90 - theta) * DEG2RAD;\n      var x = Math.cos(angle);\n      var y = Math.sin(angle);\n      vertices.push(kInnerRadius * x * buttonScale + midline, kInnerRadius * y * buttonScale + buttonScale);\n      vertices.push(r * x * buttonScale + midline, r * y * buttonScale + buttonScale);\n    }\n    for (var i = 0; i <= 6; i++) {\n      var segmentTheta = i * kAnglePerGearSection;\n      addGearSegment(segmentTheta, kOuterRadius);\n      addGearSegment(segmentTheta + kOuterRimEndAngle, kOuterRadius);\n      addGearSegment(segmentTheta + kInnerRimBeginAngle, kMiddleRadius);\n      addGearSegment(segmentTheta + (kAnglePerGearSection - kInnerRimBeginAngle), kMiddleRadius);\n      addGearSegment(segmentTheta + (kAnglePerGearSection - kOuterRimEndAngle), kOuterRadius);\n    }\n    self.gearVertexCount = vertices.length / 2 - self.gearOffset;\n    self.arrowOffset = vertices.length / 2;\n    function addArrowVertex(x, y) {\n      vertices.push(buttonBorder + x, gl.drawingBufferHeight - buttonBorder - y);\n    }\n    var angledLineWidth = lineWidth / Math.sin(45 * DEG2RAD);\n    addArrowVertex(0, buttonScale);\n    addArrowVertex(buttonScale, 0);\n    addArrowVertex(buttonScale + angledLineWidth, angledLineWidth);\n    addArrowVertex(angledLineWidth, buttonScale + angledLineWidth);\n    addArrowVertex(angledLineWidth, buttonScale - angledLineWidth);\n    addArrowVertex(0, buttonScale);\n    addArrowVertex(buttonScale, buttonScale * 2);\n    addArrowVertex(buttonScale + angledLineWidth, buttonScale * 2 - angledLineWidth);\n    addArrowVertex(angledLineWidth, buttonScale - angledLineWidth);\n    addArrowVertex(0, buttonScale);\n    addArrowVertex(angledLineWidth, buttonScale - lineWidth);\n    addArrowVertex(kButtonWidthDp * dps, buttonScale - lineWidth);\n    addArrowVertex(angledLineWidth, buttonScale + lineWidth);\n    addArrowVertex(kButtonWidthDp * dps, buttonScale + lineWidth);\n    self.arrowVertexCount = vertices.length / 2 - self.arrowOffset;\n    gl.bindBuffer(gl.ARRAY_BUFFER, self.vertexBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);\n  });\n};\nCardboardUI.prototype.render = function () {\n  var gl = this.gl;\n  var self = this;\n  var glState = [gl.CULL_FACE, gl.DEPTH_TEST, gl.BLEND, gl.SCISSOR_TEST, gl.STENCIL_TEST, gl.COLOR_WRITEMASK, gl.VIEWPORT, gl.CURRENT_PROGRAM, gl.ARRAY_BUFFER_BINDING];\n  glPreserveState(gl, glState, function (gl) {\n    gl.disable(gl.CULL_FACE);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.BLEND);\n    gl.disable(gl.SCISSOR_TEST);\n    gl.disable(gl.STENCIL_TEST);\n    gl.colorMask(true, true, true, true);\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n    self.renderNoState();\n  });\n};\nCardboardUI.prototype.renderNoState = function () {\n  var gl = this.gl;\n  gl.useProgram(this.program);\n  gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n  gl.enableVertexAttribArray(this.attribs.position);\n  gl.vertexAttribPointer(this.attribs.position, 2, gl.FLOAT, false, 8, 0);\n  gl.uniform4f(this.uniforms.color, 1.0, 1.0, 1.0, 1.0);\n  orthoMatrix(this.projMat, 0, gl.drawingBufferWidth, 0, gl.drawingBufferHeight, 0.1, 1024.0);\n  gl.uniformMatrix4fv(this.uniforms.projectionMat, false, this.projMat);\n  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  gl.drawArrays(gl.TRIANGLE_STRIP, this.gearOffset, this.gearVertexCount);\n  gl.drawArrays(gl.TRIANGLE_STRIP, this.arrowOffset, this.arrowVertexCount);\n};\n\nfunction Distortion(coefficients) {\n  this.coefficients = coefficients;\n}\nDistortion.prototype.distortInverse = function (radius) {\n  var r0 = 0;\n  var r1 = 1;\n  var dr0 = radius - this.distort(r0);\n  while (Math.abs(r1 - r0) > 0.0001             ) {\n    var dr1 = radius - this.distort(r1);\n    var r2 = r1 - dr1 * ((r1 - r0) / (dr1 - dr0));\n    r0 = r1;\n    r1 = r2;\n    dr0 = dr1;\n  }\n  return r1;\n};\nDistortion.prototype.distort = function (radius) {\n  var r2 = radius * radius;\n  var ret = 0;\n  for (var i = 0; i < this.coefficients.length; i++) {\n    ret = r2 * (ret + this.coefficients[i]);\n  }\n  return (ret + 1) * radius;\n};\n\nvar degToRad = Math.PI / 180;\nvar radToDeg = 180 / Math.PI;\n\nvar Vector3 = function Vector3(x, y, z) {\n  this.x = x || 0;\n  this.y = y || 0;\n  this.z = z || 0;\n};\nVector3.prototype = {\n  constructor: Vector3,\n  set: function set(x, y, z) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    return this;\n  },\n  copy: function copy(v) {\n    this.x = v.x;\n    this.y = v.y;\n    this.z = v.z;\n    return this;\n  },\n  length: function length() {\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n  },\n  normalize: function normalize() {\n    var scalar = this.length();\n    if (scalar !== 0) {\n      var invScalar = 1 / scalar;\n      this.multiplyScalar(invScalar);\n    } else {\n      this.x = 0;\n      this.y = 0;\n      this.z = 0;\n    }\n    return this;\n  },\n  multiplyScalar: function multiplyScalar(scalar) {\n    this.x *= scalar;\n    this.y *= scalar;\n    this.z *= scalar;\n  },\n  applyQuaternion: function applyQuaternion(q) {\n    var x = this.x;\n    var y = this.y;\n    var z = this.z;\n    var qx = q.x;\n    var qy = q.y;\n    var qz = q.z;\n    var qw = q.w;\n    var ix = qw * x + qy * z - qz * y;\n    var iy = qw * y + qz * x - qx * z;\n    var iz = qw * z + qx * y - qy * x;\n    var iw = -qx * x - qy * y - qz * z;\n    this.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n    this.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n    this.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n    return this;\n  },\n  dot: function dot(v) {\n    return this.x * v.x + this.y * v.y + this.z * v.z;\n  },\n  crossVectors: function crossVectors(a, b) {\n    var ax = a.x,\n        ay = a.y,\n        az = a.z;\n    var bx = b.x,\n        by = b.y,\n        bz = b.z;\n    this.x = ay * bz - az * by;\n    this.y = az * bx - ax * bz;\n    this.z = ax * by - ay * bx;\n    return this;\n  }\n};\nvar Quaternion = function Quaternion(x, y, z, w) {\n  this.x = x || 0;\n  this.y = y || 0;\n  this.z = z || 0;\n  this.w = w !== undefined ? w : 1;\n};\nQuaternion.prototype = {\n  constructor: Quaternion,\n  set: function set(x, y, z, w) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.w = w;\n    return this;\n  },\n  copy: function copy(quaternion) {\n    this.x = quaternion.x;\n    this.y = quaternion.y;\n    this.z = quaternion.z;\n    this.w = quaternion.w;\n    return this;\n  },\n  setFromEulerXYZ: function setFromEulerXYZ(x, y, z) {\n    var c1 = Math.cos(x / 2);\n    var c2 = Math.cos(y / 2);\n    var c3 = Math.cos(z / 2);\n    var s1 = Math.sin(x / 2);\n    var s2 = Math.sin(y / 2);\n    var s3 = Math.sin(z / 2);\n    this.x = s1 * c2 * c3 + c1 * s2 * s3;\n    this.y = c1 * s2 * c3 - s1 * c2 * s3;\n    this.z = c1 * c2 * s3 + s1 * s2 * c3;\n    this.w = c1 * c2 * c3 - s1 * s2 * s3;\n    return this;\n  },\n  setFromEulerYXZ: function setFromEulerYXZ(x, y, z) {\n    var c1 = Math.cos(x / 2);\n    var c2 = Math.cos(y / 2);\n    var c3 = Math.cos(z / 2);\n    var s1 = Math.sin(x / 2);\n    var s2 = Math.sin(y / 2);\n    var s3 = Math.sin(z / 2);\n    this.x = s1 * c2 * c3 + c1 * s2 * s3;\n    this.y = c1 * s2 * c3 - s1 * c2 * s3;\n    this.z = c1 * c2 * s3 - s1 * s2 * c3;\n    this.w = c1 * c2 * c3 + s1 * s2 * s3;\n    return this;\n  },\n  setFromAxisAngle: function setFromAxisAngle(axis, angle) {\n    var halfAngle = angle / 2,\n        s = Math.sin(halfAngle);\n    this.x = axis.x * s;\n    this.y = axis.y * s;\n    this.z = axis.z * s;\n    this.w = Math.cos(halfAngle);\n    return this;\n  },\n  multiply: function multiply(q) {\n    return this.multiplyQuaternions(this, q);\n  },\n  multiplyQuaternions: function multiplyQuaternions(a, b) {\n    var qax = a.x,\n        qay = a.y,\n        qaz = a.z,\n        qaw = a.w;\n    var qbx = b.x,\n        qby = b.y,\n        qbz = b.z,\n        qbw = b.w;\n    this.x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\n    this.y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\n    this.z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\n    this.w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\n    return this;\n  },\n  inverse: function inverse() {\n    this.x *= -1;\n    this.y *= -1;\n    this.z *= -1;\n    this.normalize();\n    return this;\n  },\n  normalize: function normalize() {\n    var l = Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\n    if (l === 0) {\n      this.x = 0;\n      this.y = 0;\n      this.z = 0;\n      this.w = 1;\n    } else {\n      l = 1 / l;\n      this.x = this.x * l;\n      this.y = this.y * l;\n      this.z = this.z * l;\n      this.w = this.w * l;\n    }\n    return this;\n  },\n  slerp: function slerp(qb, t) {\n    if (t === 0) return this;\n    if (t === 1) return this.copy(qb);\n    var x = this.x,\n        y = this.y,\n        z = this.z,\n        w = this.w;\n    var cosHalfTheta = w * qb.w + x * qb.x + y * qb.y + z * qb.z;\n    if (cosHalfTheta < 0) {\n      this.w = -qb.w;\n      this.x = -qb.x;\n      this.y = -qb.y;\n      this.z = -qb.z;\n      cosHalfTheta = -cosHalfTheta;\n    } else {\n      this.copy(qb);\n    }\n    if (cosHalfTheta >= 1.0) {\n      this.w = w;\n      this.x = x;\n      this.y = y;\n      this.z = z;\n      return this;\n    }\n    var halfTheta = Math.acos(cosHalfTheta);\n    var sinHalfTheta = Math.sqrt(1.0 - cosHalfTheta * cosHalfTheta);\n    if (Math.abs(sinHalfTheta) < 0.001) {\n      this.w = 0.5 * (w + this.w);\n      this.x = 0.5 * (x + this.x);\n      this.y = 0.5 * (y + this.y);\n      this.z = 0.5 * (z + this.z);\n      return this;\n    }\n    var ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta,\n        ratioB = Math.sin(t * halfTheta) / sinHalfTheta;\n    this.w = w * ratioA + this.w * ratioB;\n    this.x = x * ratioA + this.x * ratioB;\n    this.y = y * ratioA + this.y * ratioB;\n    this.z = z * ratioA + this.z * ratioB;\n    return this;\n  },\n  setFromUnitVectors: function () {\n    var v1, r;\n    var EPS = 0.000001;\n    return function (vFrom, vTo) {\n      if (v1 === undefined) v1 = new Vector3();\n      r = vFrom.dot(vTo) + 1;\n      if (r < EPS) {\n        r = 0;\n        if (Math.abs(vFrom.x) > Math.abs(vFrom.z)) {\n          v1.set(-vFrom.y, vFrom.x, 0);\n        } else {\n          v1.set(0, -vFrom.z, vFrom.y);\n        }\n      } else {\n        v1.crossVectors(vFrom, vTo);\n      }\n      this.x = v1.x;\n      this.y = v1.y;\n      this.z = v1.z;\n      this.w = r;\n      this.normalize();\n      return this;\n    };\n  }()\n};\n\nfunction Device(params) {\n  this.width = params.width || getScreenWidth();\n  this.height = params.height || getScreenHeight();\n  this.widthMeters = params.widthMeters;\n  this.heightMeters = params.heightMeters;\n  this.bevelMeters = params.bevelMeters;\n}\nvar DEFAULT_ANDROID = new Device({\n  widthMeters: 0.110,\n  heightMeters: 0.062,\n  bevelMeters: 0.004\n});\nvar DEFAULT_IOS = new Device({\n  widthMeters: 0.1038,\n  heightMeters: 0.0584,\n  bevelMeters: 0.004\n});\nvar Viewers = {\n  CardboardV1: new CardboardViewer({\n    id: 'CardboardV1',\n    label: 'Cardboard I/O 2014',\n    fov: 40,\n    interLensDistance: 0.060,\n    baselineLensDistance: 0.035,\n    screenLensDistance: 0.042,\n    distortionCoefficients: [0.441, 0.156],\n    inverseCoefficients: [-0.4410035, 0.42756155, -0.4804439, 0.5460139, -0.58821183, 0.5733938, -0.48303202, 0.33299083, -0.17573841, 0.0651772, -0.01488963, 0.001559834]\n  }),\n  CardboardV2: new CardboardViewer({\n    id: 'CardboardV2',\n    label: 'Cardboard I/O 2015',\n    fov: 60,\n    interLensDistance: 0.064,\n    baselineLensDistance: 0.035,\n    screenLensDistance: 0.039,\n    distortionCoefficients: [0.34, 0.55],\n    inverseCoefficients: [-0.33836704, -0.18162185, 0.862655, -1.2462051, 1.0560602, -0.58208317, 0.21609078, -0.05444823, 0.009177956, -9.904169E-4, 6.183535E-5, -1.6981803E-6]\n  })\n};\nfunction DeviceInfo(deviceParams, additionalViewers) {\n  this.viewer = Viewers.CardboardV2;\n  this.updateDeviceParams(deviceParams);\n  this.distortion = new Distortion(this.viewer.distortionCoefficients);\n  for (var i = 0; i < additionalViewers.length; i++) {\n    var viewer = additionalViewers[i];\n    Viewers[viewer.id] = new CardboardViewer(viewer);\n  }\n}\nDeviceInfo.prototype.updateDeviceParams = function (deviceParams) {\n  this.device = this.determineDevice_(deviceParams) || this.device;\n};\nDeviceInfo.prototype.getDevice = function () {\n  return this.device;\n};\nDeviceInfo.prototype.setViewer = function (viewer) {\n  this.viewer = viewer;\n  this.distortion = new Distortion(this.viewer.distortionCoefficients);\n};\nDeviceInfo.prototype.determineDevice_ = function (deviceParams) {\n  if (!deviceParams) {\n    if (isIOS()) {\n      console.warn('Using fallback iOS device measurements.');\n      return DEFAULT_IOS;\n    } else {\n      console.warn('Using fallback Android device measurements.');\n      return DEFAULT_ANDROID;\n    }\n  }\n  var METERS_PER_INCH = 0.0254;\n  var metersPerPixelX = METERS_PER_INCH / deviceParams.xdpi;\n  var metersPerPixelY = METERS_PER_INCH / deviceParams.ydpi;\n  var width = getScreenWidth();\n  var height = getScreenHeight();\n  return new Device({\n    widthMeters: metersPerPixelX * width,\n    heightMeters: metersPerPixelY * height,\n    bevelMeters: deviceParams.bevelMm * 0.001\n  });\n};\nDeviceInfo.prototype.getDistortedFieldOfViewLeftEye = function () {\n  var viewer = this.viewer;\n  var device = this.device;\n  var distortion = this.distortion;\n  var eyeToScreenDistance = viewer.screenLensDistance;\n  var outerDist = (device.widthMeters - viewer.interLensDistance) / 2;\n  var innerDist = viewer.interLensDistance / 2;\n  var bottomDist = viewer.baselineLensDistance - device.bevelMeters;\n  var topDist = device.heightMeters - bottomDist;\n  var outerAngle = radToDeg * Math.atan(distortion.distort(outerDist / eyeToScreenDistance));\n  var innerAngle = radToDeg * Math.atan(distortion.distort(innerDist / eyeToScreenDistance));\n  var bottomAngle = radToDeg * Math.atan(distortion.distort(bottomDist / eyeToScreenDistance));\n  var topAngle = radToDeg * Math.atan(distortion.distort(topDist / eyeToScreenDistance));\n  return {\n    leftDegrees: Math.min(outerAngle, viewer.fov),\n    rightDegrees: Math.min(innerAngle, viewer.fov),\n    downDegrees: Math.min(bottomAngle, viewer.fov),\n    upDegrees: Math.min(topAngle, viewer.fov)\n  };\n};\nDeviceInfo.prototype.getLeftEyeVisibleTanAngles = function () {\n  var viewer = this.viewer;\n  var device = this.device;\n  var distortion = this.distortion;\n  var fovLeft = Math.tan(-degToRad * viewer.fov);\n  var fovTop = Math.tan(degToRad * viewer.fov);\n  var fovRight = Math.tan(degToRad * viewer.fov);\n  var fovBottom = Math.tan(-degToRad * viewer.fov);\n  var halfWidth = device.widthMeters / 4;\n  var halfHeight = device.heightMeters / 2;\n  var verticalLensOffset = viewer.baselineLensDistance - device.bevelMeters - halfHeight;\n  var centerX = viewer.interLensDistance / 2 - halfWidth;\n  var centerY = -verticalLensOffset;\n  var centerZ = viewer.screenLensDistance;\n  var screenLeft = distortion.distort((centerX - halfWidth) / centerZ);\n  var screenTop = distortion.distort((centerY + halfHeight) / centerZ);\n  var screenRight = distortion.distort((centerX + halfWidth) / centerZ);\n  var screenBottom = distortion.distort((centerY - halfHeight) / centerZ);\n  var result = new Float32Array(4);\n  result[0] = Math.max(fovLeft, screenLeft);\n  result[1] = Math.min(fovTop, screenTop);\n  result[2] = Math.min(fovRight, screenRight);\n  result[3] = Math.max(fovBottom, screenBottom);\n  return result;\n};\nDeviceInfo.prototype.getLeftEyeNoLensTanAngles = function () {\n  var viewer = this.viewer;\n  var device = this.device;\n  var distortion = this.distortion;\n  var result = new Float32Array(4);\n  var fovLeft = distortion.distortInverse(Math.tan(-degToRad * viewer.fov));\n  var fovTop = distortion.distortInverse(Math.tan(degToRad * viewer.fov));\n  var fovRight = distortion.distortInverse(Math.tan(degToRad * viewer.fov));\n  var fovBottom = distortion.distortInverse(Math.tan(-degToRad * viewer.fov));\n  var halfWidth = device.widthMeters / 4;\n  var halfHeight = device.heightMeters / 2;\n  var verticalLensOffset = viewer.baselineLensDistance - device.bevelMeters - halfHeight;\n  var centerX = viewer.interLensDistance / 2 - halfWidth;\n  var centerY = -verticalLensOffset;\n  var centerZ = viewer.screenLensDistance;\n  var screenLeft = (centerX - halfWidth) / centerZ;\n  var screenTop = (centerY + halfHeight) / centerZ;\n  var screenRight = (centerX + halfWidth) / centerZ;\n  var screenBottom = (centerY - halfHeight) / centerZ;\n  result[0] = Math.max(fovLeft, screenLeft);\n  result[1] = Math.min(fovTop, screenTop);\n  result[2] = Math.min(fovRight, screenRight);\n  result[3] = Math.max(fovBottom, screenBottom);\n  return result;\n};\nDeviceInfo.prototype.getLeftEyeVisibleScreenRect = function (undistortedFrustum) {\n  var viewer = this.viewer;\n  var device = this.device;\n  var dist = viewer.screenLensDistance;\n  var eyeX = (device.widthMeters - viewer.interLensDistance) / 2;\n  var eyeY = viewer.baselineLensDistance - device.bevelMeters;\n  var left = (undistortedFrustum[0] * dist + eyeX) / device.widthMeters;\n  var top = (undistortedFrustum[1] * dist + eyeY) / device.heightMeters;\n  var right = (undistortedFrustum[2] * dist + eyeX) / device.widthMeters;\n  var bottom = (undistortedFrustum[3] * dist + eyeY) / device.heightMeters;\n  return {\n    x: left,\n    y: bottom,\n    width: right - left,\n    height: top - bottom\n  };\n};\nDeviceInfo.prototype.getFieldOfViewLeftEye = function (opt_isUndistorted) {\n  return opt_isUndistorted ? this.getUndistortedFieldOfViewLeftEye() : this.getDistortedFieldOfViewLeftEye();\n};\nDeviceInfo.prototype.getFieldOfViewRightEye = function (opt_isUndistorted) {\n  var fov = this.getFieldOfViewLeftEye(opt_isUndistorted);\n  return {\n    leftDegrees: fov.rightDegrees,\n    rightDegrees: fov.leftDegrees,\n    upDegrees: fov.upDegrees,\n    downDegrees: fov.downDegrees\n  };\n};\nDeviceInfo.prototype.getUndistortedFieldOfViewLeftEye = function () {\n  var p = this.getUndistortedParams_();\n  return {\n    leftDegrees: radToDeg * Math.atan(p.outerDist),\n    rightDegrees: radToDeg * Math.atan(p.innerDist),\n    downDegrees: radToDeg * Math.atan(p.bottomDist),\n    upDegrees: radToDeg * Math.atan(p.topDist)\n  };\n};\nDeviceInfo.prototype.getUndistortedViewportLeftEye = function () {\n  var p = this.getUndistortedParams_();\n  var viewer = this.viewer;\n  var device = this.device;\n  var eyeToScreenDistance = viewer.screenLensDistance;\n  var screenWidth = device.widthMeters / eyeToScreenDistance;\n  var screenHeight = device.heightMeters / eyeToScreenDistance;\n  var xPxPerTanAngle = device.width / screenWidth;\n  var yPxPerTanAngle = device.height / screenHeight;\n  var x = Math.round((p.eyePosX - p.outerDist) * xPxPerTanAngle);\n  var y = Math.round((p.eyePosY - p.bottomDist) * yPxPerTanAngle);\n  return {\n    x: x,\n    y: y,\n    width: Math.round((p.eyePosX + p.innerDist) * xPxPerTanAngle) - x,\n    height: Math.round((p.eyePosY + p.topDist) * yPxPerTanAngle) - y\n  };\n};\nDeviceInfo.prototype.getUndistortedParams_ = function () {\n  var viewer = this.viewer;\n  var device = this.device;\n  var distortion = this.distortion;\n  var eyeToScreenDistance = viewer.screenLensDistance;\n  var halfLensDistance = viewer.interLensDistance / 2 / eyeToScreenDistance;\n  var screenWidth = device.widthMeters / eyeToScreenDistance;\n  var screenHeight = device.heightMeters / eyeToScreenDistance;\n  var eyePosX = screenWidth / 2 - halfLensDistance;\n  var eyePosY = (viewer.baselineLensDistance - device.bevelMeters) / eyeToScreenDistance;\n  var maxFov = viewer.fov;\n  var viewerMax = distortion.distortInverse(Math.tan(degToRad * maxFov));\n  var outerDist = Math.min(eyePosX, viewerMax);\n  var innerDist = Math.min(halfLensDistance, viewerMax);\n  var bottomDist = Math.min(eyePosY, viewerMax);\n  var topDist = Math.min(screenHeight - eyePosY, viewerMax);\n  return {\n    outerDist: outerDist,\n    innerDist: innerDist,\n    topDist: topDist,\n    bottomDist: bottomDist,\n    eyePosX: eyePosX,\n    eyePosY: eyePosY\n  };\n};\nfunction CardboardViewer(params) {\n  this.id = params.id;\n  this.label = params.label;\n  this.fov = params.fov;\n  this.interLensDistance = params.interLensDistance;\n  this.baselineLensDistance = params.baselineLensDistance;\n  this.screenLensDistance = params.screenLensDistance;\n  this.distortionCoefficients = params.distortionCoefficients;\n  this.inverseCoefficients = params.inverseCoefficients;\n}\nDeviceInfo.Viewers = Viewers;\n\nvar format = 1;\nvar last_updated = \"2019-11-09T17:36:14Z\";\nvar devices = [{\"type\":\"android\",\"rules\":[{\"mdmh\":\"asus/*/Nexus 7/*\"},{\"ua\":\"Nexus 7\"}],\"dpi\":[320.8,323],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"asus/*/ASUS_X00PD/*\"},{\"ua\":\"ASUS_X00PD\"}],\"dpi\":245,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"asus/*/ASUS_X008D/*\"},{\"ua\":\"ASUS_X008D\"}],\"dpi\":282,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"asus/*/ASUS_Z00AD/*\"},{\"ua\":\"ASUS_Z00AD\"}],\"dpi\":[403,404.6],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Google/*/Pixel 2 XL/*\"},{\"ua\":\"Pixel 2 XL\"}],\"dpi\":537.9,\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Google/*/Pixel 3 XL/*\"},{\"ua\":\"Pixel 3 XL\"}],\"dpi\":[558.5,553.8],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Google/*/Pixel XL/*\"},{\"ua\":\"Pixel XL\"}],\"dpi\":[537.9,533],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Google/*/Pixel 3/*\"},{\"ua\":\"Pixel 3\"}],\"dpi\":442.4,\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Google/*/Pixel 2/*\"},{\"ua\":\"Pixel 2\"}],\"dpi\":441,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Google/*/Pixel/*\"},{\"ua\":\"Pixel\"}],\"dpi\":[432.6,436.7],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"HTC/*/HTC6435LVW/*\"},{\"ua\":\"HTC6435LVW\"}],\"dpi\":[449.7,443.3],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"HTC/*/HTC One XL/*\"},{\"ua\":\"HTC One XL\"}],\"dpi\":[315.3,314.6],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"htc/*/Nexus 9/*\"},{\"ua\":\"Nexus 9\"}],\"dpi\":289,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"HTC/*/HTC One M9/*\"},{\"ua\":\"HTC One M9\"}],\"dpi\":[442.5,443.3],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"HTC/*/HTC One_M8/*\"},{\"ua\":\"HTC One_M8\"}],\"dpi\":[449.7,447.4],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"HTC/*/HTC One/*\"},{\"ua\":\"HTC One\"}],\"dpi\":472.8,\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Huawei/*/Nexus 6P/*\"},{\"ua\":\"Nexus 6P\"}],\"dpi\":[515.1,518],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Huawei/*/BLN-L24/*\"},{\"ua\":\"HONORBLN-L24\"}],\"dpi\":480,\"bw\":4,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Huawei/*/BKL-L09/*\"},{\"ua\":\"BKL-L09\"}],\"dpi\":403,\"bw\":3.47,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LENOVO/*/Lenovo PB2-690Y/*\"},{\"ua\":\"Lenovo PB2-690Y\"}],\"dpi\":[457.2,454.713],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/Nexus 5X/*\"},{\"ua\":\"Nexus 5X\"}],\"dpi\":[422,419.9],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/LGMS345/*\"},{\"ua\":\"LGMS345\"}],\"dpi\":[221.7,219.1],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/LG-D800/*\"},{\"ua\":\"LG-D800\"}],\"dpi\":[422,424.1],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/LG-D850/*\"},{\"ua\":\"LG-D850\"}],\"dpi\":[537.9,541.9],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/VS985 4G/*\"},{\"ua\":\"VS985 4G\"}],\"dpi\":[537.9,535.6],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/Nexus 5/*\"},{\"ua\":\"Nexus 5 B\"}],\"dpi\":[442.4,444.8],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/Nexus 4/*\"},{\"ua\":\"Nexus 4\"}],\"dpi\":[319.8,318.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/LG-P769/*\"},{\"ua\":\"LG-P769\"}],\"dpi\":[240.6,247.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/LGMS323/*\"},{\"ua\":\"LGMS323\"}],\"dpi\":[206.6,204.6],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"LGE/*/LGLS996/*\"},{\"ua\":\"LGLS996\"}],\"dpi\":[403.4,401.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Micromax/*/4560MMX/*\"},{\"ua\":\"4560MMX\"}],\"dpi\":[240,219.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Micromax/*/A250/*\"},{\"ua\":\"Micromax A250\"}],\"dpi\":[480,446.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Micromax/*/Micromax AQ4501/*\"},{\"ua\":\"Micromax AQ4501\"}],\"dpi\":240,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/G5/*\"},{\"ua\":\"Moto G (5) Plus\"}],\"dpi\":[403.4,403],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/DROID RAZR/*\"},{\"ua\":\"DROID RAZR\"}],\"dpi\":[368.1,256.7],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT830C/*\"},{\"ua\":\"XT830C\"}],\"dpi\":[254,255.9],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1021/*\"},{\"ua\":\"XT1021\"}],\"dpi\":[254,256.7],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1023/*\"},{\"ua\":\"XT1023\"}],\"dpi\":[254,256.7],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1028/*\"},{\"ua\":\"XT1028\"}],\"dpi\":[326.6,327.6],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1034/*\"},{\"ua\":\"XT1034\"}],\"dpi\":[326.6,328.4],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1053/*\"},{\"ua\":\"XT1053\"}],\"dpi\":[315.3,316.1],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1562/*\"},{\"ua\":\"XT1562\"}],\"dpi\":[403.4,402.7],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/Nexus 6/*\"},{\"ua\":\"Nexus 6 B\"}],\"dpi\":[494.3,489.7],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1063/*\"},{\"ua\":\"XT1063\"}],\"dpi\":[295,296.6],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1064/*\"},{\"ua\":\"XT1064\"}],\"dpi\":[295,295.6],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1092/*\"},{\"ua\":\"XT1092\"}],\"dpi\":[422,424.1],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/XT1095/*\"},{\"ua\":\"XT1095\"}],\"dpi\":[422,423.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"motorola/*/G4/*\"},{\"ua\":\"Moto G (4)\"}],\"dpi\":401,\"bw\":4,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/A0001/*\"},{\"ua\":\"A0001\"}],\"dpi\":[403.4,401],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONE E1001/*\"},{\"ua\":\"ONE E1001\"}],\"dpi\":[442.4,441.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONE E1003/*\"},{\"ua\":\"ONE E1003\"}],\"dpi\":[442.4,441.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONE E1005/*\"},{\"ua\":\"ONE E1005\"}],\"dpi\":[442.4,441.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONE A2001/*\"},{\"ua\":\"ONE A2001\"}],\"dpi\":[391.9,405.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONE A2003/*\"},{\"ua\":\"ONE A2003\"}],\"dpi\":[391.9,405.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONE A2005/*\"},{\"ua\":\"ONE A2005\"}],\"dpi\":[391.9,405.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONEPLUS A3000/*\"},{\"ua\":\"ONEPLUS A3000\"}],\"dpi\":401,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONEPLUS A3003/*\"},{\"ua\":\"ONEPLUS A3003\"}],\"dpi\":401,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONEPLUS A3010/*\"},{\"ua\":\"ONEPLUS A3010\"}],\"dpi\":401,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONEPLUS A5000/*\"},{\"ua\":\"ONEPLUS A5000 \"}],\"dpi\":[403.411,399.737],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONE A5010/*\"},{\"ua\":\"ONEPLUS A5010\"}],\"dpi\":[403,400],\"bw\":2,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONEPLUS A6000/*\"},{\"ua\":\"ONEPLUS A6000\"}],\"dpi\":401,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONEPLUS A6003/*\"},{\"ua\":\"ONEPLUS A6003\"}],\"dpi\":401,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONEPLUS A6010/*\"},{\"ua\":\"ONEPLUS A6010\"}],\"dpi\":401,\"bw\":2,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OnePlus/*/ONEPLUS A6013/*\"},{\"ua\":\"ONEPLUS A6013\"}],\"dpi\":401,\"bw\":2,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"OPPO/*/X909/*\"},{\"ua\":\"X909\"}],\"dpi\":[442.4,444.1],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/GT-I9082/*\"},{\"ua\":\"GT-I9082\"}],\"dpi\":[184.7,185.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G360P/*\"},{\"ua\":\"SM-G360P\"}],\"dpi\":[196.7,205.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/Nexus S/*\"},{\"ua\":\"Nexus S\"}],\"dpi\":[234.5,229.8],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/GT-I9300/*\"},{\"ua\":\"GT-I9300\"}],\"dpi\":[304.8,303.9],\"bw\":5,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-T230NU/*\"},{\"ua\":\"SM-T230NU\"}],\"dpi\":216,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SGH-T399/*\"},{\"ua\":\"SGH-T399\"}],\"dpi\":[217.7,231.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SGH-M919/*\"},{\"ua\":\"SGH-M919\"}],\"dpi\":[440.8,437.7],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-N9005/*\"},{\"ua\":\"SM-N9005\"}],\"dpi\":[386.4,387],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SAMSUNG-SM-N900A/*\"},{\"ua\":\"SAMSUNG-SM-N900A\"}],\"dpi\":[386.4,387.7],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/GT-I9500/*\"},{\"ua\":\"GT-I9500\"}],\"dpi\":[442.5,443.3],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/GT-I9505/*\"},{\"ua\":\"GT-I9505\"}],\"dpi\":439.4,\"bw\":4,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G900F/*\"},{\"ua\":\"SM-G900F\"}],\"dpi\":[415.6,431.6],\"bw\":5,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G900M/*\"},{\"ua\":\"SM-G900M\"}],\"dpi\":[415.6,431.6],\"bw\":5,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G800F/*\"},{\"ua\":\"SM-G800F\"}],\"dpi\":326.8,\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G906S/*\"},{\"ua\":\"SM-G906S\"}],\"dpi\":[562.7,572.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/GT-I9300/*\"},{\"ua\":\"GT-I9300\"}],\"dpi\":[306.7,304.8],\"bw\":5,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-T535/*\"},{\"ua\":\"SM-T535\"}],\"dpi\":[142.6,136.4],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-N920C/*\"},{\"ua\":\"SM-N920C\"}],\"dpi\":[515.1,518.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-N920P/*\"},{\"ua\":\"SM-N920P\"}],\"dpi\":[386.3655,390.144],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-N920W8/*\"},{\"ua\":\"SM-N920W8\"}],\"dpi\":[515.1,518.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/GT-I9300I/*\"},{\"ua\":\"GT-I9300I\"}],\"dpi\":[304.8,305.8],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/GT-I9195/*\"},{\"ua\":\"GT-I9195\"}],\"dpi\":[249.4,256.7],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SPH-L520/*\"},{\"ua\":\"SPH-L520\"}],\"dpi\":[249.4,255.9],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SAMSUNG-SGH-I717/*\"},{\"ua\":\"SAMSUNG-SGH-I717\"}],\"dpi\":285.8,\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SPH-D710/*\"},{\"ua\":\"SPH-D710\"}],\"dpi\":[217.7,204.2],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/GT-N7100/*\"},{\"ua\":\"GT-N7100\"}],\"dpi\":265.1,\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SCH-I605/*\"},{\"ua\":\"SCH-I605\"}],\"dpi\":265.1,\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/Galaxy Nexus/*\"},{\"ua\":\"Galaxy Nexus\"}],\"dpi\":[315.3,314.2],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-N910H/*\"},{\"ua\":\"SM-N910H\"}],\"dpi\":[515.1,518],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-N910C/*\"},{\"ua\":\"SM-N910C\"}],\"dpi\":[515.2,520.2],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G130M/*\"},{\"ua\":\"SM-G130M\"}],\"dpi\":[165.9,164.8],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G928I/*\"},{\"ua\":\"SM-G928I\"}],\"dpi\":[515.1,518.4],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G920F/*\"},{\"ua\":\"SM-G920F\"}],\"dpi\":580.6,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G920P/*\"},{\"ua\":\"SM-G920P\"}],\"dpi\":[522.5,577],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G925F/*\"},{\"ua\":\"SM-G925F\"}],\"dpi\":580.6,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G925V/*\"},{\"ua\":\"SM-G925V\"}],\"dpi\":[522.5,576.6],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G930F/*\"},{\"ua\":\"SM-G930F\"}],\"dpi\":576.6,\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G935F/*\"},{\"ua\":\"SM-G935F\"}],\"dpi\":533,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G950F/*\"},{\"ua\":\"SM-G950F\"}],\"dpi\":[562.707,565.293],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G955U/*\"},{\"ua\":\"SM-G955U\"}],\"dpi\":[522.514,525.762],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G955F/*\"},{\"ua\":\"SM-G955F\"}],\"dpi\":[522.514,525.762],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G960F/*\"},{\"ua\":\"SM-G960F\"}],\"dpi\":[569.575,571.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G9600/*\"},{\"ua\":\"SM-G9600\"}],\"dpi\":[569.575,571.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G960T/*\"},{\"ua\":\"SM-G960T\"}],\"dpi\":[569.575,571.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G960N/*\"},{\"ua\":\"SM-G960N\"}],\"dpi\":[569.575,571.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G960U/*\"},{\"ua\":\"SM-G960U\"}],\"dpi\":[569.575,571.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G9608/*\"},{\"ua\":\"SM-G9608\"}],\"dpi\":[569.575,571.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G960FD/*\"},{\"ua\":\"SM-G960FD\"}],\"dpi\":[569.575,571.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G960W/*\"},{\"ua\":\"SM-G960W\"}],\"dpi\":[569.575,571.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G965F/*\"},{\"ua\":\"SM-G965F\"}],\"dpi\":529,\"bw\":2,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Sony/*/C6903/*\"},{\"ua\":\"C6903\"}],\"dpi\":[442.5,443.3],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Sony/*/D6653/*\"},{\"ua\":\"D6653\"}],\"dpi\":[428.6,427.6],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Sony/*/E6653/*\"},{\"ua\":\"E6653\"}],\"dpi\":[428.6,425.7],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Sony/*/E6853/*\"},{\"ua\":\"E6853\"}],\"dpi\":[403.4,401.9],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Sony/*/SGP321/*\"},{\"ua\":\"SGP321\"}],\"dpi\":[224.7,224.1],\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"TCT/*/ALCATEL ONE TOUCH Fierce/*\"},{\"ua\":\"ALCATEL ONE TOUCH Fierce\"}],\"dpi\":[240,247.5],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"THL/*/thl 5000/*\"},{\"ua\":\"thl 5000\"}],\"dpi\":[480,443.3],\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Fly/*/IQ4412/*\"},{\"ua\":\"IQ4412\"}],\"dpi\":307.9,\"bw\":3,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"ZTE/*/ZTE Blade L2/*\"},{\"ua\":\"ZTE Blade L2\"}],\"dpi\":240,\"bw\":3,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"BENEVE/*/VR518/*\"},{\"ua\":\"VR518\"}],\"dpi\":480,\"bw\":3,\"ac\":500},{\"type\":\"ios\",\"rules\":[{\"res\":[640,960]}],\"dpi\":[325.1,328.4],\"bw\":4,\"ac\":1000},{\"type\":\"ios\",\"rules\":[{\"res\":[640,1136]}],\"dpi\":[317.1,320.2],\"bw\":3,\"ac\":1000},{\"type\":\"ios\",\"rules\":[{\"res\":[750,1334]}],\"dpi\":326.4,\"bw\":4,\"ac\":1000},{\"type\":\"ios\",\"rules\":[{\"res\":[1242,2208]}],\"dpi\":[453.6,458.4],\"bw\":4,\"ac\":1000},{\"type\":\"ios\",\"rules\":[{\"res\":[1125,2001]}],\"dpi\":[410.9,415.4],\"bw\":4,\"ac\":1000},{\"type\":\"ios\",\"rules\":[{\"res\":[1125,2436]}],\"dpi\":458,\"bw\":4,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Huawei/*/EML-L29/*\"},{\"ua\":\"EML-L29\"}],\"dpi\":428,\"bw\":3.45,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"Nokia/*/Nokia 7.1/*\"},{\"ua\":\"Nokia 7.1\"}],\"dpi\":[432,431.9],\"bw\":3,\"ac\":500},{\"type\":\"ios\",\"rules\":[{\"res\":[1242,2688]}],\"dpi\":458,\"bw\":4,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G570M/*\"},{\"ua\":\"SM-G570M\"}],\"dpi\":320,\"bw\":3.684,\"ac\":1000},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G970F/*\"},{\"ua\":\"SM-G970F\"}],\"dpi\":438,\"bw\":2.281,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G973F/*\"},{\"ua\":\"SM-G973F\"}],\"dpi\":550,\"bw\":2.002,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G975F/*\"},{\"ua\":\"SM-G975F\"}],\"dpi\":522,\"bw\":2.054,\"ac\":500},{\"type\":\"android\",\"rules\":[{\"mdmh\":\"samsung/*/SM-G977F/*\"},{\"ua\":\"SM-G977F\"}],\"dpi\":505,\"bw\":2.334,\"ac\":500},{\"type\":\"ios\",\"rules\":[{\"res\":[828,1792]}],\"dpi\":326,\"bw\":5,\"ac\":500}];\nvar DPDB_CACHE = {\n\tformat: format,\n\tlast_updated: last_updated,\n\tdevices: devices\n};\n\nfunction Dpdb(url, onDeviceParamsUpdated) {\n  this.dpdb = DPDB_CACHE;\n  this.recalculateDeviceParams_();\n  if (url) {\n    this.onDeviceParamsUpdated = onDeviceParamsUpdated;\n    var xhr = new XMLHttpRequest();\n    var obj = this;\n    xhr.open('GET', url, true);\n    xhr.addEventListener('load', function () {\n      obj.loading = false;\n      if (xhr.status >= 200 && xhr.status <= 299) {\n        obj.dpdb = JSON.parse(xhr.response);\n        obj.recalculateDeviceParams_();\n      } else {\n        console.error('Error loading online DPDB!');\n      }\n    });\n    xhr.send();\n  }\n}\nDpdb.prototype.getDeviceParams = function () {\n  return this.deviceParams;\n};\nDpdb.prototype.recalculateDeviceParams_ = function () {\n  var newDeviceParams = this.calcDeviceParams_();\n  if (newDeviceParams) {\n    this.deviceParams = newDeviceParams;\n    if (this.onDeviceParamsUpdated) {\n      this.onDeviceParamsUpdated(this.deviceParams);\n    }\n  } else {\n    console.error('Failed to recalculate device parameters.');\n  }\n};\nDpdb.prototype.calcDeviceParams_ = function () {\n  var db = this.dpdb;\n  if (!db) {\n    console.error('DPDB not available.');\n    return null;\n  }\n  if (db.format != 1) {\n    console.error('DPDB has unexpected format version.');\n    return null;\n  }\n  if (!db.devices || !db.devices.length) {\n    console.error('DPDB does not have a devices section.');\n    return null;\n  }\n  var userAgent = navigator.userAgent || navigator.vendor || window.opera;\n  var width = getScreenWidth();\n  var height = getScreenHeight();\n  if (!db.devices) {\n    console.error('DPDB has no devices section.');\n    return null;\n  }\n  for (var i = 0; i < db.devices.length; i++) {\n    var device = db.devices[i];\n    if (!device.rules) {\n      console.warn('Device[' + i + '] has no rules section.');\n      continue;\n    }\n    if (device.type != 'ios' && device.type != 'android') {\n      console.warn('Device[' + i + '] has invalid type.');\n      continue;\n    }\n    if (isIOS() != (device.type == 'ios')) continue;\n    var matched = false;\n    for (var j = 0; j < device.rules.length; j++) {\n      var rule = device.rules[j];\n      if (this.ruleMatches_(rule, userAgent, width, height)) {\n        matched = true;\n        break;\n      }\n    }\n    if (!matched) continue;\n    var xdpi = device.dpi[0] || device.dpi;\n    var ydpi = device.dpi[1] || device.dpi;\n    return new DeviceParams({ xdpi: xdpi, ydpi: ydpi, bevelMm: device.bw });\n  }\n  console.warn('No DPDB device match.');\n  return null;\n};\nDpdb.prototype.ruleMatches_ = function (rule, ua, screenWidth, screenHeight) {\n  if (!rule.ua && !rule.res) return false;\n  if (rule.ua && rule.ua.substring(0, 2) === 'SM') rule.ua = rule.ua.substring(0, 7);\n  if (rule.ua && ua.indexOf(rule.ua) < 0) return false;\n  if (rule.res) {\n    if (!rule.res[0] || !rule.res[1]) return false;\n    var resX = rule.res[0];\n    var resY = rule.res[1];\n    if (Math.min(screenWidth, screenHeight) != Math.min(resX, resY) || Math.max(screenWidth, screenHeight) != Math.max(resX, resY)) {\n      return false;\n    }\n  }\n  return true;\n};\nfunction DeviceParams(params) {\n  this.xdpi = params.xdpi;\n  this.ydpi = params.ydpi;\n  this.bevelMm = params.bevelMm;\n}\n\nfunction SensorSample(sample, timestampS) {\n  this.set(sample, timestampS);\n}\nSensorSample.prototype.set = function (sample, timestampS) {\n  this.sample = sample;\n  this.timestampS = timestampS;\n};\nSensorSample.prototype.copy = function (sensorSample) {\n  this.set(sensorSample.sample, sensorSample.timestampS);\n};\n\nfunction ComplementaryFilter(kFilter, isDebug) {\n  this.kFilter = kFilter;\n  this.isDebug = isDebug;\n  this.currentAccelMeasurement = new SensorSample();\n  this.currentGyroMeasurement = new SensorSample();\n  this.previousGyroMeasurement = new SensorSample();\n  if (isIOS()) {\n    this.filterQ = new Quaternion(-1, 0, 0, 1);\n  } else {\n    this.filterQ = new Quaternion(1, 0, 0, 1);\n  }\n  this.previousFilterQ = new Quaternion();\n  this.previousFilterQ.copy(this.filterQ);\n  this.accelQ = new Quaternion();\n  this.isOrientationInitialized = false;\n  this.estimatedGravity = new Vector3();\n  this.measuredGravity = new Vector3();\n  this.gyroIntegralQ = new Quaternion();\n}\nComplementaryFilter.prototype.addAccelMeasurement = function (vector, timestampS) {\n  this.currentAccelMeasurement.set(vector, timestampS);\n};\nComplementaryFilter.prototype.addGyroMeasurement = function (vector, timestampS) {\n  this.currentGyroMeasurement.set(vector, timestampS);\n  var deltaT = timestampS - this.previousGyroMeasurement.timestampS;\n  if (isTimestampDeltaValid(deltaT)) {\n    this.run_();\n  }\n  this.previousGyroMeasurement.copy(this.currentGyroMeasurement);\n};\nComplementaryFilter.prototype.run_ = function () {\n  if (!this.isOrientationInitialized) {\n    this.accelQ = this.accelToQuaternion_(this.currentAccelMeasurement.sample);\n    this.previousFilterQ.copy(this.accelQ);\n    this.isOrientationInitialized = true;\n    return;\n  }\n  var deltaT = this.currentGyroMeasurement.timestampS - this.previousGyroMeasurement.timestampS;\n  var gyroDeltaQ = this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample, deltaT);\n  this.gyroIntegralQ.multiply(gyroDeltaQ);\n  this.filterQ.copy(this.previousFilterQ);\n  this.filterQ.multiply(gyroDeltaQ);\n  var invFilterQ = new Quaternion();\n  invFilterQ.copy(this.filterQ);\n  invFilterQ.inverse();\n  this.estimatedGravity.set(0, 0, -1);\n  this.estimatedGravity.applyQuaternion(invFilterQ);\n  this.estimatedGravity.normalize();\n  this.measuredGravity.copy(this.currentAccelMeasurement.sample);\n  this.measuredGravity.normalize();\n  var deltaQ = new Quaternion();\n  deltaQ.setFromUnitVectors(this.estimatedGravity, this.measuredGravity);\n  deltaQ.inverse();\n  if (this.isDebug) {\n    console.log('Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)', radToDeg * getQuaternionAngle(deltaQ), this.estimatedGravity.x.toFixed(1), this.estimatedGravity.y.toFixed(1), this.estimatedGravity.z.toFixed(1), this.measuredGravity.x.toFixed(1), this.measuredGravity.y.toFixed(1), this.measuredGravity.z.toFixed(1));\n  }\n  var targetQ = new Quaternion();\n  targetQ.copy(this.filterQ);\n  targetQ.multiply(deltaQ);\n  this.filterQ.slerp(targetQ, 1 - this.kFilter);\n  this.previousFilterQ.copy(this.filterQ);\n};\nComplementaryFilter.prototype.getOrientation = function () {\n  return this.filterQ;\n};\nComplementaryFilter.prototype.accelToQuaternion_ = function (accel) {\n  var normAccel = new Vector3();\n  normAccel.copy(accel);\n  normAccel.normalize();\n  var quat = new Quaternion();\n  quat.setFromUnitVectors(new Vector3(0, 0, -1), normAccel);\n  quat.inverse();\n  return quat;\n};\nComplementaryFilter.prototype.gyroToQuaternionDelta_ = function (gyro, dt) {\n  var quat = new Quaternion();\n  var axis = new Vector3();\n  axis.copy(gyro);\n  axis.normalize();\n  quat.setFromAxisAngle(axis, gyro.length() * dt);\n  return quat;\n};\n\nfunction PosePredictor(predictionTimeS, isDebug) {\n  this.predictionTimeS = predictionTimeS;\n  this.isDebug = isDebug;\n  this.previousQ = new Quaternion();\n  this.previousTimestampS = null;\n  this.deltaQ = new Quaternion();\n  this.outQ = new Quaternion();\n}\nPosePredictor.prototype.getPrediction = function (currentQ, gyro, timestampS) {\n  if (!this.previousTimestampS) {\n    this.previousQ.copy(currentQ);\n    this.previousTimestampS = timestampS;\n    return currentQ;\n  }\n  var axis = new Vector3();\n  axis.copy(gyro);\n  axis.normalize();\n  var angularSpeed = gyro.length();\n  if (angularSpeed < degToRad * 20) {\n    if (this.isDebug) {\n      console.log('Moving slowly, at %s deg/s: no prediction', (radToDeg * angularSpeed).toFixed(1));\n    }\n    this.outQ.copy(currentQ);\n    this.previousQ.copy(currentQ);\n    return this.outQ;\n  }\n  var predictAngle = angularSpeed * this.predictionTimeS;\n  this.deltaQ.setFromAxisAngle(axis, predictAngle);\n  this.outQ.copy(this.previousQ);\n  this.outQ.multiply(this.deltaQ);\n  this.previousQ.copy(currentQ);\n  this.previousTimestampS = timestampS;\n  return this.outQ;\n};\n\nfunction FusionPoseSensor(kFilter, predictionTime, yawOnly, isDebug) {\n  this.yawOnly = yawOnly;\n  this.accelerometer = new Vector3();\n  this.gyroscope = new Vector3();\n  this.filter = new ComplementaryFilter(kFilter, isDebug);\n  this.posePredictor = new PosePredictor(predictionTime, isDebug);\n  this.isFirefoxAndroid = isFirefoxAndroid();\n  this.isIOS = isIOS();\n  var chromeVersion = getChromeVersion();\n  this.isDeviceMotionInRadians = !this.isIOS && chromeVersion && chromeVersion < 66;\n  this.isWithoutDeviceMotion = isChromeWithoutDeviceMotion() || isSafariWithoutDeviceMotion();\n  this.filterToWorldQ = new Quaternion();\n  if (isIOS()) {\n    this.filterToWorldQ.setFromAxisAngle(new Vector3(1, 0, 0), Math.PI / 2);\n  } else {\n    this.filterToWorldQ.setFromAxisAngle(new Vector3(1, 0, 0), -Math.PI / 2);\n  }\n  this.inverseWorldToScreenQ = new Quaternion();\n  this.worldToScreenQ = new Quaternion();\n  this.originalPoseAdjustQ = new Quaternion();\n  this.originalPoseAdjustQ.setFromAxisAngle(new Vector3(0, 0, 1), -window.orientation * Math.PI / 180);\n  this.setScreenTransform_();\n  if (isLandscapeMode()) {\n    this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);\n  }\n  this.resetQ = new Quaternion();\n  this.orientationOut_ = new Float32Array(4);\n  this.start();\n}\nFusionPoseSensor.prototype.getPosition = function () {\n  return null;\n};\nFusionPoseSensor.prototype.getOrientation = function () {\n  var orientation = void 0;\n  if (this.isWithoutDeviceMotion && this._deviceOrientationQ) {\n    this.deviceOrientationFixQ = this.deviceOrientationFixQ || function () {\n      var z = new Quaternion().setFromAxisAngle(new Vector3(0, 0, -1), 0);\n      var y = new Quaternion();\n      if (window.orientation === -90) {\n        y.setFromAxisAngle(new Vector3(0, 1, 0), Math.PI / -2);\n      } else {\n        y.setFromAxisAngle(new Vector3(0, 1, 0), Math.PI / 2);\n      }\n      return z.multiply(y);\n    }();\n    this.deviceOrientationFilterToWorldQ = this.deviceOrientationFilterToWorldQ || function () {\n      var q = new Quaternion();\n      q.setFromAxisAngle(new Vector3(1, 0, 0), -Math.PI / 2);\n      return q;\n    }();\n    orientation = this._deviceOrientationQ;\n    var out = new Quaternion();\n    out.copy(orientation);\n    out.multiply(this.deviceOrientationFilterToWorldQ);\n    out.multiply(this.resetQ);\n    out.multiply(this.worldToScreenQ);\n    out.multiplyQuaternions(this.deviceOrientationFixQ, out);\n    if (this.yawOnly) {\n      out.x = 0;\n      out.z = 0;\n      out.normalize();\n    }\n    this.orientationOut_[0] = out.x;\n    this.orientationOut_[1] = out.y;\n    this.orientationOut_[2] = out.z;\n    this.orientationOut_[3] = out.w;\n    return this.orientationOut_;\n  } else {\n    var filterOrientation = this.filter.getOrientation();\n    orientation = this.posePredictor.getPrediction(filterOrientation, this.gyroscope, this.previousTimestampS);\n  }\n  var out = new Quaternion();\n  out.copy(this.filterToWorldQ);\n  out.multiply(this.resetQ);\n  out.multiply(orientation);\n  out.multiply(this.worldToScreenQ);\n  if (this.yawOnly) {\n    out.x = 0;\n    out.z = 0;\n    out.normalize();\n  }\n  this.orientationOut_[0] = out.x;\n  this.orientationOut_[1] = out.y;\n  this.orientationOut_[2] = out.z;\n  this.orientationOut_[3] = out.w;\n  return this.orientationOut_;\n};\nFusionPoseSensor.prototype.resetPose = function () {\n  this.resetQ.copy(this.filter.getOrientation());\n  this.resetQ.x = 0;\n  this.resetQ.y = 0;\n  this.resetQ.z *= -1;\n  this.resetQ.normalize();\n  if (isLandscapeMode()) {\n    this.resetQ.multiply(this.inverseWorldToScreenQ);\n  }\n  this.resetQ.multiply(this.originalPoseAdjustQ);\n};\nFusionPoseSensor.prototype.onDeviceOrientation_ = function (e) {\n  this._deviceOrientationQ = this._deviceOrientationQ || new Quaternion();\n  var alpha = e.alpha,\n      beta = e.beta,\n      gamma = e.gamma;\n  alpha = (alpha || 0) * Math.PI / 180;\n  beta = (beta || 0) * Math.PI / 180;\n  gamma = (gamma || 0) * Math.PI / 180;\n  this._deviceOrientationQ.setFromEulerYXZ(beta, alpha, -gamma);\n};\nFusionPoseSensor.prototype.onDeviceMotion_ = function (deviceMotion) {\n  this.updateDeviceMotion_(deviceMotion);\n};\nFusionPoseSensor.prototype.updateDeviceMotion_ = function (deviceMotion) {\n  var accGravity = deviceMotion.accelerationIncludingGravity;\n  var rotRate = deviceMotion.rotationRate;\n  var timestampS = deviceMotion.timeStamp / 1000;\n  var deltaS = timestampS - this.previousTimestampS;\n  if (deltaS < 0) {\n    warnOnce('fusion-pose-sensor:invalid:non-monotonic', 'Invalid timestamps detected: non-monotonic timestamp from devicemotion');\n    this.previousTimestampS = timestampS;\n    return;\n  } else if (deltaS <= MIN_TIMESTEP || deltaS > MAX_TIMESTEP) {\n    warnOnce('fusion-pose-sensor:invalid:outside-threshold', 'Invalid timestamps detected: Timestamp from devicemotion outside expected range.');\n    this.previousTimestampS = timestampS;\n    return;\n  }\n  this.accelerometer.set(-accGravity.x, -accGravity.y, -accGravity.z);\n  if (rotRate) {\n    if (isR7()) {\n      this.gyroscope.set(-rotRate.beta, rotRate.alpha, rotRate.gamma);\n    } else {\n      this.gyroscope.set(rotRate.alpha, rotRate.beta, rotRate.gamma);\n    }\n    if (!this.isDeviceMotionInRadians) {\n      this.gyroscope.multiplyScalar(Math.PI / 180);\n    }\n    this.filter.addGyroMeasurement(this.gyroscope, timestampS);\n  }\n  this.filter.addAccelMeasurement(this.accelerometer, timestampS);\n  this.previousTimestampS = timestampS;\n};\nFusionPoseSensor.prototype.onOrientationChange_ = function (screenOrientation) {\n  this.setScreenTransform_();\n};\nFusionPoseSensor.prototype.onMessage_ = function (event) {\n  var message = event.data;\n  if (!message || !message.type) {\n    return;\n  }\n  var type = message.type.toLowerCase();\n  if (type !== 'devicemotion') {\n    return;\n  }\n  this.updateDeviceMotion_(message.deviceMotionEvent);\n};\nFusionPoseSensor.prototype.setScreenTransform_ = function () {\n  this.worldToScreenQ.set(0, 0, 0, 1);\n  switch (window.orientation) {\n    case 0:\n      break;\n    case 90:\n      this.worldToScreenQ.setFromAxisAngle(new Vector3(0, 0, 1), -Math.PI / 2);\n      break;\n    case -90:\n      this.worldToScreenQ.setFromAxisAngle(new Vector3(0, 0, 1), Math.PI / 2);\n      break;\n    case 180:\n      break;\n  }\n  this.inverseWorldToScreenQ.copy(this.worldToScreenQ);\n  this.inverseWorldToScreenQ.inverse();\n};\nFusionPoseSensor.prototype.start = function () {\n  this.onDeviceMotionCallback_ = this.onDeviceMotion_.bind(this);\n  this.onOrientationChangeCallback_ = this.onOrientationChange_.bind(this);\n  this.onMessageCallback_ = this.onMessage_.bind(this);\n  this.onDeviceOrientationCallback_ = this.onDeviceOrientation_.bind(this);\n  if (isIOS() && isInsideCrossOriginIFrame()) {\n    window.addEventListener('message', this.onMessageCallback_);\n  }\n  window.addEventListener('orientationchange', this.onOrientationChangeCallback_);\n  if (this.isWithoutDeviceMotion) {\n    window.addEventListener('deviceorientation', this.onDeviceOrientationCallback_);\n  } else {\n    window.addEventListener('devicemotion', this.onDeviceMotionCallback_);\n  }\n};\nFusionPoseSensor.prototype.stop = function () {\n  window.removeEventListener('devicemotion', this.onDeviceMotionCallback_);\n  window.removeEventListener('deviceorientation', this.onDeviceOrientationCallback_);\n  window.removeEventListener('orientationchange', this.onOrientationChangeCallback_);\n  window.removeEventListener('message', this.onMessageCallback_);\n};\n\nvar SENSOR_FREQUENCY = 60;\nvar X_AXIS = new Vector3(1, 0, 0);\nvar Z_AXIS = new Vector3(0, 0, 1);\nvar SENSOR_TO_VR = new Quaternion();\nSENSOR_TO_VR.setFromAxisAngle(X_AXIS, -Math.PI / 2);\nSENSOR_TO_VR.multiply(new Quaternion().setFromAxisAngle(Z_AXIS, Math.PI / 2));\nvar PoseSensor = function () {\n  function PoseSensor(config) {\n    classCallCheck(this, PoseSensor);\n    this.config = config;\n    this.sensor = null;\n    this.fusionSensor = null;\n    this._out = new Float32Array(4);\n    this.api = null;\n    this.errors = [];\n    this._sensorQ = new Quaternion();\n    this._outQ = new Quaternion();\n    this._onSensorRead = this._onSensorRead.bind(this);\n    this._onSensorError = this._onSensorError.bind(this);\n    this.init();\n  }\n  createClass(PoseSensor, [{\n    key: 'init',\n    value: function init() {\n      var sensor = null;\n      try {\n        sensor = new RelativeOrientationSensor({\n          frequency: SENSOR_FREQUENCY,\n          referenceFrame: 'screen'\n        });\n        sensor.addEventListener('error', this._onSensorError);\n      } catch (error) {\n        this.errors.push(error);\n        if (error.name === 'SecurityError') {\n          console.error('Cannot construct sensors due to the Feature Policy');\n          console.warn('Attempting to fall back using \"devicemotion\"; however this will ' + 'fail in the future without correct permissions.');\n          this.useDeviceMotion();\n        } else if (error.name === 'ReferenceError') {\n          this.useDeviceMotion();\n        } else {\n          console.error(error);\n        }\n      }\n      if (sensor) {\n        this.api = 'sensor';\n        this.sensor = sensor;\n        this.sensor.addEventListener('reading', this._onSensorRead);\n        this.sensor.start();\n      }\n    }\n  }, {\n    key: 'useDeviceMotion',\n    value: function useDeviceMotion() {\n      this.api = 'devicemotion';\n      this.fusionSensor = new FusionPoseSensor(this.config.K_FILTER, this.config.PREDICTION_TIME_S, this.config.YAW_ONLY, this.config.DEBUG);\n      if (this.sensor) {\n        this.sensor.removeEventListener('reading', this._onSensorRead);\n        this.sensor.removeEventListener('error', this._onSensorError);\n        this.sensor = null;\n      }\n    }\n  }, {\n    key: 'getOrientation',\n    value: function getOrientation() {\n      if (this.fusionSensor) {\n        return this.fusionSensor.getOrientation();\n      }\n      if (!this.sensor || !this.sensor.quaternion) {\n        this._out[0] = this._out[1] = this._out[2] = 0;\n        this._out[3] = 1;\n        return this._out;\n      }\n      var q = this.sensor.quaternion;\n      this._sensorQ.set(q[0], q[1], q[2], q[3]);\n      var out = this._outQ;\n      out.copy(SENSOR_TO_VR);\n      out.multiply(this._sensorQ);\n      if (this.config.YAW_ONLY) {\n        out.x = out.z = 0;\n        out.normalize();\n      }\n      this._out[0] = out.x;\n      this._out[1] = out.y;\n      this._out[2] = out.z;\n      this._out[3] = out.w;\n      return this._out;\n    }\n  }, {\n    key: '_onSensorError',\n    value: function _onSensorError(event) {\n      this.errors.push(event.error);\n      if (event.error.name === 'NotAllowedError') {\n        console.error('Permission to access sensor was denied');\n      } else if (event.error.name === 'NotReadableError') {\n        console.error('Sensor could not be read');\n      } else {\n        console.error(event.error);\n      }\n      this.useDeviceMotion();\n    }\n  }, {\n    key: '_onSensorRead',\n    value: function _onSensorRead() {}\n  }]);\n  return PoseSensor;\n}();\n\nvar rotateInstructionsAsset = \"<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>\";\n\nfunction RotateInstructions() {\n  this.loadIcon_();\n  var overlay = document.createElement('div');\n  var s = overlay.style;\n  s.position = 'fixed';\n  s.top = 0;\n  s.right = 0;\n  s.bottom = 0;\n  s.left = 0;\n  s.backgroundColor = 'gray';\n  s.fontFamily = 'sans-serif';\n  s.zIndex = 1000000;\n  var img = document.createElement('img');\n  img.src = this.icon;\n  var s = img.style;\n  s.marginLeft = '25%';\n  s.marginTop = '25%';\n  s.width = '50%';\n  overlay.appendChild(img);\n  var text = document.createElement('div');\n  var s = text.style;\n  s.textAlign = 'center';\n  s.fontSize = '16px';\n  s.lineHeight = '24px';\n  s.margin = '24px 25%';\n  s.width = '50%';\n  text.innerHTML = 'Place your phone into your Cardboard viewer.';\n  overlay.appendChild(text);\n  var snackbar = document.createElement('div');\n  var s = snackbar.style;\n  s.backgroundColor = '#CFD8DC';\n  s.position = 'fixed';\n  s.bottom = 0;\n  s.width = '100%';\n  s.height = '48px';\n  s.padding = '14px 24px';\n  s.boxSizing = 'border-box';\n  s.color = '#656A6B';\n  overlay.appendChild(snackbar);\n  var snackbarText = document.createElement('div');\n  snackbarText.style.float = 'left';\n  snackbarText.innerHTML = 'No Cardboard viewer?';\n  var snackbarButton = document.createElement('a');\n  snackbarButton.href = 'https://www.google.com/get/cardboard/get-cardboard/';\n  snackbarButton.innerHTML = 'get one';\n  snackbarButton.target = '_blank';\n  var s = snackbarButton.style;\n  s.float = 'right';\n  s.fontWeight = 600;\n  s.textTransform = 'uppercase';\n  s.borderLeft = '1px solid gray';\n  s.paddingLeft = '24px';\n  s.textDecoration = 'none';\n  s.color = '#656A6B';\n  snackbar.appendChild(snackbarText);\n  snackbar.appendChild(snackbarButton);\n  this.overlay = overlay;\n  this.text = text;\n  this.hide();\n}\nRotateInstructions.prototype.show = function (parent) {\n  if (!parent && !this.overlay.parentElement) {\n    document.body.appendChild(this.overlay);\n  } else if (parent) {\n    if (this.overlay.parentElement && this.overlay.parentElement != parent) this.overlay.parentElement.removeChild(this.overlay);\n    parent.appendChild(this.overlay);\n  }\n  this.overlay.style.display = 'block';\n  var img = this.overlay.querySelector('img');\n  var s = img.style;\n  if (isLandscapeMode()) {\n    s.width = '20%';\n    s.marginLeft = '40%';\n    s.marginTop = '3%';\n  } else {\n    s.width = '50%';\n    s.marginLeft = '25%';\n    s.marginTop = '25%';\n  }\n};\nRotateInstructions.prototype.hide = function () {\n  this.overlay.style.display = 'none';\n};\nRotateInstructions.prototype.showTemporarily = function (ms, parent) {\n  this.show(parent);\n  this.timer = setTimeout(this.hide.bind(this), ms);\n};\nRotateInstructions.prototype.disableShowTemporarily = function () {\n  clearTimeout(this.timer);\n};\nRotateInstructions.prototype.update = function () {\n  this.disableShowTemporarily();\n  if (!isLandscapeMode() && isMobile()) {\n    this.show();\n  } else {\n    this.hide();\n  }\n};\nRotateInstructions.prototype.loadIcon_ = function () {\n  this.icon = dataUri('image/svg+xml', rotateInstructionsAsset);\n};\n\nvar DEFAULT_VIEWER = 'CardboardV1';\nvar VIEWER_KEY = 'WEBVR_CARDBOARD_VIEWER';\nvar CLASS_NAME = 'webvr-polyfill-viewer-selector';\nfunction ViewerSelector(defaultViewer) {\n  try {\n    this.selectedKey = localStorage.getItem(VIEWER_KEY);\n  } catch (error) {\n    console.error('Failed to load viewer profile: %s', error);\n  }\n  if (!this.selectedKey) {\n    this.selectedKey = defaultViewer || DEFAULT_VIEWER;\n  }\n  this.dialog = this.createDialog_(DeviceInfo.Viewers);\n  this.root = null;\n  this.onChangeCallbacks_ = [];\n}\nViewerSelector.prototype.show = function (root) {\n  this.root = root;\n  root.appendChild(this.dialog);\n  var selected = this.dialog.querySelector('#' + this.selectedKey);\n  selected.checked = true;\n  this.dialog.style.display = 'block';\n};\nViewerSelector.prototype.hide = function () {\n  if (this.root && this.root.contains(this.dialog)) {\n    this.root.removeChild(this.dialog);\n  }\n  this.dialog.style.display = 'none';\n};\nViewerSelector.prototype.getCurrentViewer = function () {\n  return DeviceInfo.Viewers[this.selectedKey];\n};\nViewerSelector.prototype.getSelectedKey_ = function () {\n  var input = this.dialog.querySelector('input[name=field]:checked');\n  if (input) {\n    return input.id;\n  }\n  return null;\n};\nViewerSelector.prototype.onChange = function (cb) {\n  this.onChangeCallbacks_.push(cb);\n};\nViewerSelector.prototype.fireOnChange_ = function (viewer) {\n  for (var i = 0; i < this.onChangeCallbacks_.length; i++) {\n    this.onChangeCallbacks_[i](viewer);\n  }\n};\nViewerSelector.prototype.onSave_ = function () {\n  this.selectedKey = this.getSelectedKey_();\n  if (!this.selectedKey || !DeviceInfo.Viewers[this.selectedKey]) {\n    console.error('ViewerSelector.onSave_: this should never happen!');\n    return;\n  }\n  this.fireOnChange_(DeviceInfo.Viewers[this.selectedKey]);\n  try {\n    localStorage.setItem(VIEWER_KEY, this.selectedKey);\n  } catch (error) {\n    console.error('Failed to save viewer profile: %s', error);\n  }\n  this.hide();\n};\nViewerSelector.prototype.createDialog_ = function (options) {\n  var container = document.createElement('div');\n  container.classList.add(CLASS_NAME);\n  container.style.display = 'none';\n  var overlay = document.createElement('div');\n  var s = overlay.style;\n  s.position = 'fixed';\n  s.left = 0;\n  s.top = 0;\n  s.width = '100%';\n  s.height = '100%';\n  s.background = 'rgba(0, 0, 0, 0.3)';\n  overlay.addEventListener('click', this.hide.bind(this));\n  var width = 280;\n  var dialog = document.createElement('div');\n  var s = dialog.style;\n  s.boxSizing = 'border-box';\n  s.position = 'fixed';\n  s.top = '24px';\n  s.left = '50%';\n  s.marginLeft = -width / 2 + 'px';\n  s.width = width + 'px';\n  s.padding = '24px';\n  s.overflow = 'hidden';\n  s.background = '#fafafa';\n  s.fontFamily = \"'Roboto', sans-serif\";\n  s.boxShadow = '0px 5px 20px #666';\n  dialog.appendChild(this.createH1_('Select your viewer'));\n  for (var id in options) {\n    dialog.appendChild(this.createChoice_(id, options[id].label));\n  }\n  dialog.appendChild(this.createButton_('Save', this.onSave_.bind(this)));\n  container.appendChild(overlay);\n  container.appendChild(dialog);\n  return container;\n};\nViewerSelector.prototype.createH1_ = function (name) {\n  var h1 = document.createElement('h1');\n  var s = h1.style;\n  s.color = 'black';\n  s.fontSize = '20px';\n  s.fontWeight = 'bold';\n  s.marginTop = 0;\n  s.marginBottom = '24px';\n  h1.innerHTML = name;\n  return h1;\n};\nViewerSelector.prototype.createChoice_ = function (id, name) {\n  var div = document.createElement('div');\n  div.style.marginTop = '8px';\n  div.style.color = 'black';\n  var input = document.createElement('input');\n  input.style.fontSize = '30px';\n  input.setAttribute('id', id);\n  input.setAttribute('type', 'radio');\n  input.setAttribute('value', id);\n  input.setAttribute('name', 'field');\n  var label = document.createElement('label');\n  label.style.marginLeft = '4px';\n  label.setAttribute('for', id);\n  label.innerHTML = name;\n  div.appendChild(input);\n  div.appendChild(label);\n  return div;\n};\nViewerSelector.prototype.createButton_ = function (label, onclick) {\n  var button = document.createElement('button');\n  button.innerHTML = label;\n  var s = button.style;\n  s.float = 'right';\n  s.textTransform = 'uppercase';\n  s.color = '#1094f7';\n  s.fontSize = '14px';\n  s.letterSpacing = 0;\n  s.border = 0;\n  s.background = 'none';\n  s.marginTop = '16px';\n  button.addEventListener('click', onclick);\n  return button;\n};\n\nvar commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\n\n\nfunction unwrapExports (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar NoSleep = createCommonjsModule(function (module, exports) {\n(function webpackUniversalModuleDefinition(root, factory) {\n\tmodule.exports = factory();\n})(commonjsGlobal, function() {\nreturn          (function(modules) {\n         \tvar installedModules = {};\n         \tfunction __webpack_require__(moduleId) {\n         \t\tif(installedModules[moduleId]) {\n         \t\t\treturn installedModules[moduleId].exports;\n         \t\t}\n         \t\tvar module = installedModules[moduleId] = {\n         \t\t\ti: moduleId,\n         \t\t\tl: false,\n         \t\t\texports: {}\n         \t\t};\n         \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n         \t\tmodule.l = true;\n         \t\treturn module.exports;\n         \t}\n         \t__webpack_require__.m = modules;\n         \t__webpack_require__.c = installedModules;\n         \t__webpack_require__.d = function(exports, name, getter) {\n         \t\tif(!__webpack_require__.o(exports, name)) {\n         \t\t\tObject.defineProperty(exports, name, {\n         \t\t\t\tconfigurable: false,\n         \t\t\t\tenumerable: true,\n         \t\t\t\tget: getter\n         \t\t\t});\n         \t\t}\n         \t};\n         \t__webpack_require__.n = function(module) {\n         \t\tvar getter = module && module.__esModule ?\n         \t\t\tfunction getDefault() { return module['default']; } :\n         \t\t\tfunction getModuleExports() { return module; };\n         \t\t__webpack_require__.d(getter, 'a', getter);\n         \t\treturn getter;\n         \t};\n         \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n         \t__webpack_require__.p = \"\";\n         \treturn __webpack_require__(__webpack_require__.s = 0);\n         })\n         ([\n      (function(module, exports, __webpack_require__) {\n\"use strict\";\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nvar mediaFile = __webpack_require__(1);\nvar oldIOS = typeof navigator !== 'undefined' && parseFloat(('' + (/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent) || [0, ''])[1]).replace('undefined', '3_2').replace('_', '.').replace('_', '')) < 10 && !window.MSStream;\nvar NoSleep = function () {\n  function NoSleep() {\n    _classCallCheck(this, NoSleep);\n    if (oldIOS) {\n      this.noSleepTimer = null;\n    } else {\n      this.noSleepVideo = document.createElement('video');\n      this.noSleepVideo.setAttribute('playsinline', '');\n      this.noSleepVideo.setAttribute('src', mediaFile);\n      this.noSleepVideo.addEventListener('timeupdate', function (e) {\n        if (this.noSleepVideo.currentTime > 0.5) {\n          this.noSleepVideo.currentTime = Math.random();\n        }\n      }.bind(this));\n    }\n  }\n  _createClass(NoSleep, [{\n    key: 'enable',\n    value: function enable() {\n      if (oldIOS) {\n        this.disable();\n        this.noSleepTimer = window.setInterval(function () {\n          window.location.href = '/';\n          window.setTimeout(window.stop, 0);\n        }, 15000);\n      } else {\n        this.noSleepVideo.play();\n      }\n    }\n  }, {\n    key: 'disable',\n    value: function disable() {\n      if (oldIOS) {\n        if (this.noSleepTimer) {\n          window.clearInterval(this.noSleepTimer);\n          this.noSleepTimer = null;\n        }\n      } else {\n        this.noSleepVideo.pause();\n      }\n    }\n  }]);\n  return NoSleep;\n}();\n\nmodule.exports = NoSleep;\n      }),\n      (function(module, exports, __webpack_require__) {\n\"use strict\";\nmodule.exports = 'data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQAD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';\n      })\n         ]);\n});\n});\nvar NoSleep$1 = unwrapExports(NoSleep);\n\nvar nextDisplayId = 1000;\nvar defaultLeftBounds = [0, 0, 0.5, 1];\nvar defaultRightBounds = [0.5, 0, 0.5, 1];\nvar raf = window.requestAnimationFrame;\nvar caf = window.cancelAnimationFrame;\nfunction VRFrameData() {\n  this.leftProjectionMatrix = new Float32Array(16);\n  this.leftViewMatrix = new Float32Array(16);\n  this.rightProjectionMatrix = new Float32Array(16);\n  this.rightViewMatrix = new Float32Array(16);\n  this.pose = null;\n}\nfunction VRDisplayCapabilities(config) {\n  Object.defineProperties(this, {\n    hasPosition: {\n      writable: false, enumerable: true, value: config.hasPosition\n    },\n    hasExternalDisplay: {\n      writable: false, enumerable: true, value: config.hasExternalDisplay\n    },\n    canPresent: {\n      writable: false, enumerable: true, value: config.canPresent\n    },\n    maxLayers: {\n      writable: false, enumerable: true, value: config.maxLayers\n    },\n    hasOrientation: {\n      enumerable: true, get: function get() {\n        deprecateWarning('VRDisplayCapabilities.prototype.hasOrientation', 'VRDisplay.prototype.getFrameData');\n        return config.hasOrientation;\n      }\n    }\n  });\n}\nfunction VRDisplay(config) {\n  config = config || {};\n  var USE_WAKELOCK = 'wakelock' in config ? config.wakelock : true;\n  this.isPolyfilled = true;\n  this.displayId = nextDisplayId++;\n  this.displayName = '';\n  this.depthNear = 0.01;\n  this.depthFar = 10000.0;\n  this.isPresenting = false;\n  Object.defineProperty(this, 'isConnected', {\n    get: function get() {\n      deprecateWarning('VRDisplay.prototype.isConnected', 'VRDisplayCapabilities.prototype.hasExternalDisplay');\n      return false;\n    }\n  });\n  this.capabilities = new VRDisplayCapabilities({\n    hasPosition: false,\n    hasOrientation: false,\n    hasExternalDisplay: false,\n    canPresent: false,\n    maxLayers: 1\n  });\n  this.stageParameters = null;\n  this.waitingForPresent_ = false;\n  this.layer_ = null;\n  this.originalParent_ = null;\n  this.fullscreenElement_ = null;\n  this.fullscreenWrapper_ = null;\n  this.fullscreenElementCachedStyle_ = null;\n  this.fullscreenEventTarget_ = null;\n  this.fullscreenChangeHandler_ = null;\n  this.fullscreenErrorHandler_ = null;\n  if (USE_WAKELOCK && isMobile()) {\n    this.wakelock_ = new NoSleep$1();\n  }\n}\nVRDisplay.prototype.getFrameData = function (frameData) {\n  return frameDataFromPose(frameData, this._getPose(), this);\n};\nVRDisplay.prototype.getPose = function () {\n  deprecateWarning('VRDisplay.prototype.getPose', 'VRDisplay.prototype.getFrameData');\n  return this._getPose();\n};\nVRDisplay.prototype.resetPose = function () {\n  deprecateWarning('VRDisplay.prototype.resetPose');\n  return this._resetPose();\n};\nVRDisplay.prototype.getImmediatePose = function () {\n  deprecateWarning('VRDisplay.prototype.getImmediatePose', 'VRDisplay.prototype.getFrameData');\n  return this._getPose();\n};\nVRDisplay.prototype.requestAnimationFrame = function (callback) {\n  return raf(callback);\n};\nVRDisplay.prototype.cancelAnimationFrame = function (id) {\n  return caf(id);\n};\nVRDisplay.prototype.wrapForFullscreen = function (element) {\n  if (isIOS()) {\n    return element;\n  }\n  if (!this.fullscreenWrapper_) {\n    this.fullscreenWrapper_ = document.createElement('div');\n    var cssProperties = ['height: ' + Math.min(screen.height, screen.width) + 'px !important', 'top: 0 !important', 'left: 0 !important', 'right: 0 !important', 'border: 0', 'margin: 0', 'padding: 0', 'z-index: 999999 !important', 'position: fixed'];\n    this.fullscreenWrapper_.setAttribute('style', cssProperties.join('; ') + ';');\n    this.fullscreenWrapper_.classList.add('webvr-polyfill-fullscreen-wrapper');\n  }\n  if (this.fullscreenElement_ == element) {\n    return this.fullscreenWrapper_;\n  }\n  if (this.fullscreenElement_) {\n    if (this.originalParent_) {\n      this.originalParent_.appendChild(this.fullscreenElement_);\n    } else {\n      this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_);\n    }\n  }\n  this.fullscreenElement_ = element;\n  this.originalParent_ = element.parentElement;\n  if (!this.originalParent_) {\n    document.body.appendChild(element);\n  }\n  if (!this.fullscreenWrapper_.parentElement) {\n    var parent = this.fullscreenElement_.parentElement;\n    parent.insertBefore(this.fullscreenWrapper_, this.fullscreenElement_);\n    parent.removeChild(this.fullscreenElement_);\n  }\n  this.fullscreenWrapper_.insertBefore(this.fullscreenElement_, this.fullscreenWrapper_.firstChild);\n  this.fullscreenElementCachedStyle_ = this.fullscreenElement_.getAttribute('style');\n  var self = this;\n  function applyFullscreenElementStyle() {\n    if (!self.fullscreenElement_) {\n      return;\n    }\n    var cssProperties = ['position: absolute', 'top: 0', 'left: 0', 'width: ' + Math.max(screen.width, screen.height) + 'px', 'height: ' + Math.min(screen.height, screen.width) + 'px', 'border: 0', 'margin: 0', 'padding: 0'];\n    self.fullscreenElement_.setAttribute('style', cssProperties.join('; ') + ';');\n  }\n  applyFullscreenElementStyle();\n  return this.fullscreenWrapper_;\n};\nVRDisplay.prototype.removeFullscreenWrapper = function () {\n  if (!this.fullscreenElement_) {\n    return;\n  }\n  var element = this.fullscreenElement_;\n  if (this.fullscreenElementCachedStyle_) {\n    element.setAttribute('style', this.fullscreenElementCachedStyle_);\n  } else {\n    element.removeAttribute('style');\n  }\n  this.fullscreenElement_ = null;\n  this.fullscreenElementCachedStyle_ = null;\n  var parent = this.fullscreenWrapper_.parentElement;\n  this.fullscreenWrapper_.removeChild(element);\n  if (this.originalParent_ === parent) {\n    parent.insertBefore(element, this.fullscreenWrapper_);\n  }\n  else if (this.originalParent_) {\n      this.originalParent_.appendChild(element);\n    }\n  parent.removeChild(this.fullscreenWrapper_);\n  return element;\n};\nVRDisplay.prototype.requestPresent = function (layers) {\n  var wasPresenting = this.isPresenting;\n  var self = this;\n  if (!(layers instanceof Array)) {\n    deprecateWarning('VRDisplay.prototype.requestPresent with non-array argument', 'an array of VRLayers as the first argument');\n    layers = [layers];\n  }\n  return new Promise(function (resolve, reject) {\n    if (!self.capabilities.canPresent) {\n      reject(new Error('VRDisplay is not capable of presenting.'));\n      return;\n    }\n    if (layers.length == 0 || layers.length > self.capabilities.maxLayers) {\n      reject(new Error('Invalid number of layers.'));\n      return;\n    }\n    var incomingLayer = layers[0];\n    if (!incomingLayer.source) {\n      resolve();\n      return;\n    }\n    var leftBounds = incomingLayer.leftBounds || defaultLeftBounds;\n    var rightBounds = incomingLayer.rightBounds || defaultRightBounds;\n    if (wasPresenting) {\n      var layer = self.layer_;\n      if (layer.source !== incomingLayer.source) {\n        layer.source = incomingLayer.source;\n      }\n      for (var i = 0; i < 4; i++) {\n        layer.leftBounds[i] = leftBounds[i];\n        layer.rightBounds[i] = rightBounds[i];\n      }\n      self.wrapForFullscreen(self.layer_.source);\n      self.updatePresent_();\n      resolve();\n      return;\n    }\n    self.layer_ = {\n      predistorted: incomingLayer.predistorted,\n      source: incomingLayer.source,\n      leftBounds: leftBounds.slice(0),\n      rightBounds: rightBounds.slice(0)\n    };\n    self.waitingForPresent_ = false;\n    if (self.layer_ && self.layer_.source) {\n      var fullscreenElement = self.wrapForFullscreen(self.layer_.source);\n      var onFullscreenChange = function onFullscreenChange() {\n        var actualFullscreenElement = getFullscreenElement();\n        self.isPresenting = fullscreenElement === actualFullscreenElement;\n        if (self.isPresenting) {\n          if (screen.orientation && screen.orientation.lock) {\n            screen.orientation.lock('landscape-primary').catch(function (error) {\n              console.error('screen.orientation.lock() failed due to', error.message);\n            });\n          }\n          self.waitingForPresent_ = false;\n          self.beginPresent_();\n          resolve();\n        } else {\n          if (screen.orientation && screen.orientation.unlock) {\n            screen.orientation.unlock();\n          }\n          self.removeFullscreenWrapper();\n          self.disableWakeLock();\n          self.endPresent_();\n          self.removeFullscreenListeners_();\n        }\n        self.fireVRDisplayPresentChange_();\n      };\n      var onFullscreenError = function onFullscreenError() {\n        if (!self.waitingForPresent_) {\n          return;\n        }\n        self.removeFullscreenWrapper();\n        self.removeFullscreenListeners_();\n        self.disableWakeLock();\n        self.waitingForPresent_ = false;\n        self.isPresenting = false;\n        reject(new Error('Unable to present.'));\n      };\n      self.addFullscreenListeners_(fullscreenElement, onFullscreenChange, onFullscreenError);\n      if (requestFullscreen(fullscreenElement)) {\n        self.enableWakeLock();\n        self.waitingForPresent_ = true;\n      } else if (isIOS() || isWebViewAndroid()) {\n        self.enableWakeLock();\n        self.isPresenting = true;\n        self.beginPresent_();\n        self.fireVRDisplayPresentChange_();\n        resolve();\n      }\n    }\n    if (!self.waitingForPresent_ && !isIOS()) {\n      exitFullscreen();\n      reject(new Error('Unable to present.'));\n    }\n  });\n};\nVRDisplay.prototype.exitPresent = function () {\n  var wasPresenting = this.isPresenting;\n  var self = this;\n  this.isPresenting = false;\n  this.layer_ = null;\n  this.disableWakeLock();\n  return new Promise(function (resolve, reject) {\n    if (wasPresenting) {\n      if (!exitFullscreen() && isIOS()) {\n        self.endPresent_();\n        self.fireVRDisplayPresentChange_();\n      }\n      if (isWebViewAndroid()) {\n        self.removeFullscreenWrapper();\n        self.removeFullscreenListeners_();\n        self.endPresent_();\n        self.fireVRDisplayPresentChange_();\n      }\n      resolve();\n    } else {\n      reject(new Error('Was not presenting to VRDisplay.'));\n    }\n  });\n};\nVRDisplay.prototype.getLayers = function () {\n  if (this.layer_) {\n    return [this.layer_];\n  }\n  return [];\n};\nVRDisplay.prototype.fireVRDisplayPresentChange_ = function () {\n  var event = new CustomEvent('vrdisplaypresentchange', { detail: { display: this } });\n  window.dispatchEvent(event);\n};\nVRDisplay.prototype.fireVRDisplayConnect_ = function () {\n  var event = new CustomEvent('vrdisplayconnect', { detail: { display: this } });\n  window.dispatchEvent(event);\n};\nVRDisplay.prototype.addFullscreenListeners_ = function (element, changeHandler, errorHandler) {\n  this.removeFullscreenListeners_();\n  this.fullscreenEventTarget_ = element;\n  this.fullscreenChangeHandler_ = changeHandler;\n  this.fullscreenErrorHandler_ = errorHandler;\n  if (changeHandler) {\n    if (document.fullscreenEnabled) {\n      element.addEventListener('fullscreenchange', changeHandler, false);\n    } else if (document.webkitFullscreenEnabled) {\n      element.addEventListener('webkitfullscreenchange', changeHandler, false);\n    } else if (document.mozFullScreenEnabled) {\n      document.addEventListener('mozfullscreenchange', changeHandler, false);\n    } else if (document.msFullscreenEnabled) {\n      element.addEventListener('msfullscreenchange', changeHandler, false);\n    }\n  }\n  if (errorHandler) {\n    if (document.fullscreenEnabled) {\n      element.addEventListener('fullscreenerror', errorHandler, false);\n    } else if (document.webkitFullscreenEnabled) {\n      element.addEventListener('webkitfullscreenerror', errorHandler, false);\n    } else if (document.mozFullScreenEnabled) {\n      document.addEventListener('mozfullscreenerror', errorHandler, false);\n    } else if (document.msFullscreenEnabled) {\n      element.addEventListener('msfullscreenerror', errorHandler, false);\n    }\n  }\n};\nVRDisplay.prototype.removeFullscreenListeners_ = function () {\n  if (!this.fullscreenEventTarget_) return;\n  var element = this.fullscreenEventTarget_;\n  if (this.fullscreenChangeHandler_) {\n    var changeHandler = this.fullscreenChangeHandler_;\n    element.removeEventListener('fullscreenchange', changeHandler, false);\n    element.removeEventListener('webkitfullscreenchange', changeHandler, false);\n    document.removeEventListener('mozfullscreenchange', changeHandler, false);\n    element.removeEventListener('msfullscreenchange', changeHandler, false);\n  }\n  if (this.fullscreenErrorHandler_) {\n    var errorHandler = this.fullscreenErrorHandler_;\n    element.removeEventListener('fullscreenerror', errorHandler, false);\n    element.removeEventListener('webkitfullscreenerror', errorHandler, false);\n    document.removeEventListener('mozfullscreenerror', errorHandler, false);\n    element.removeEventListener('msfullscreenerror', errorHandler, false);\n  }\n  this.fullscreenEventTarget_ = null;\n  this.fullscreenChangeHandler_ = null;\n  this.fullscreenErrorHandler_ = null;\n};\nVRDisplay.prototype.enableWakeLock = function () {\n  if (this.wakelock_) {\n    this.wakelock_.enable();\n  }\n};\nVRDisplay.prototype.disableWakeLock = function () {\n  if (this.wakelock_) {\n    this.wakelock_.disable();\n  }\n};\nVRDisplay.prototype.beginPresent_ = function () {\n};\nVRDisplay.prototype.endPresent_ = function () {\n};\nVRDisplay.prototype.submitFrame = function (pose) {\n};\nVRDisplay.prototype.getEyeParameters = function (whichEye) {\n  return null;\n};\n\nvar config = {\n  ADDITIONAL_VIEWERS: [],\n  DEFAULT_VIEWER: '',\n  MOBILE_WAKE_LOCK: true,\n  DEBUG: false,\n  DPDB_URL: 'https://dpdb.webvr.rocks/dpdb.json',\n  K_FILTER: 0.98,\n  PREDICTION_TIME_S: 0.040,\n  CARDBOARD_UI_DISABLED: false,\n  ROTATE_INSTRUCTIONS_DISABLED: false,\n  YAW_ONLY: false,\n  BUFFER_SCALE: 0.5,\n  DIRTY_SUBMIT_FRAME_BINDINGS: false\n};\n\nvar Eye = {\n  LEFT: 'left',\n  RIGHT: 'right'\n};\nfunction CardboardVRDisplay(config$$1) {\n  var defaults = extend({}, config);\n  config$$1 = extend(defaults, config$$1 || {});\n  VRDisplay.call(this, {\n    wakelock: config$$1.MOBILE_WAKE_LOCK\n  });\n  this.config = config$$1;\n  this.displayName = 'Cardboard VRDisplay';\n  this.capabilities = new VRDisplayCapabilities({\n    hasPosition: false,\n    hasOrientation: true,\n    hasExternalDisplay: false,\n    canPresent: true,\n    maxLayers: 1\n  });\n  this.stageParameters = null;\n  this.bufferScale_ = this.config.BUFFER_SCALE;\n  this.poseSensor_ = new PoseSensor(this.config);\n  this.distorter_ = null;\n  this.cardboardUI_ = null;\n  this.dpdb_ = new Dpdb(this.config.DPDB_URL, this.onDeviceParamsUpdated_.bind(this));\n  this.deviceInfo_ = new DeviceInfo(this.dpdb_.getDeviceParams(), config$$1.ADDITIONAL_VIEWERS);\n  this.viewerSelector_ = new ViewerSelector(config$$1.DEFAULT_VIEWER);\n  this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));\n  this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());\n  if (!this.config.ROTATE_INSTRUCTIONS_DISABLED) {\n    this.rotateInstructions_ = new RotateInstructions();\n  }\n  if (isIOS()) {\n    window.addEventListener('resize', this.onResize_.bind(this));\n  }\n}\nCardboardVRDisplay.prototype = Object.create(VRDisplay.prototype);\nCardboardVRDisplay.prototype._getPose = function () {\n  return {\n    position: null,\n    orientation: this.poseSensor_.getOrientation(),\n    linearVelocity: null,\n    linearAcceleration: null,\n    angularVelocity: null,\n    angularAcceleration: null\n  };\n};\nCardboardVRDisplay.prototype._resetPose = function () {\n  if (this.poseSensor_.resetPose) {\n    this.poseSensor_.resetPose();\n  }\n};\nCardboardVRDisplay.prototype._getFieldOfView = function (whichEye) {\n  var fieldOfView;\n  if (whichEye == Eye.LEFT) {\n    fieldOfView = this.deviceInfo_.getFieldOfViewLeftEye();\n  } else if (whichEye == Eye.RIGHT) {\n    fieldOfView = this.deviceInfo_.getFieldOfViewRightEye();\n  } else {\n    console.error('Invalid eye provided: %s', whichEye);\n    return null;\n  }\n  return fieldOfView;\n};\nCardboardVRDisplay.prototype._getEyeOffset = function (whichEye) {\n  var offset;\n  if (whichEye == Eye.LEFT) {\n    offset = [-this.deviceInfo_.viewer.interLensDistance * 0.5, 0.0, 0.0];\n  } else if (whichEye == Eye.RIGHT) {\n    offset = [this.deviceInfo_.viewer.interLensDistance * 0.5, 0.0, 0.0];\n  } else {\n    console.error('Invalid eye provided: %s', whichEye);\n    return null;\n  }\n  return offset;\n};\nCardboardVRDisplay.prototype.getEyeParameters = function (whichEye) {\n  var offset = this._getEyeOffset(whichEye);\n  var fieldOfView = this._getFieldOfView(whichEye);\n  var eyeParams = {\n    offset: offset,\n    renderWidth: this.deviceInfo_.device.width * 0.5 * this.bufferScale_,\n    renderHeight: this.deviceInfo_.device.height * this.bufferScale_\n  };\n  Object.defineProperty(eyeParams, 'fieldOfView', {\n    enumerable: true,\n    get: function get() {\n      deprecateWarning('VRFieldOfView', 'VRFrameData\\'s projection matrices');\n      return fieldOfView;\n    }\n  });\n  return eyeParams;\n};\nCardboardVRDisplay.prototype.onDeviceParamsUpdated_ = function (newParams) {\n  if (this.config.DEBUG) {\n    console.log('DPDB reported that device params were updated.');\n  }\n  this.deviceInfo_.updateDeviceParams(newParams);\n  if (this.distorter_) {\n    this.distorter_.updateDeviceInfo(this.deviceInfo_);\n  }\n};\nCardboardVRDisplay.prototype.updateBounds_ = function () {\n  if (this.layer_ && this.distorter_ && (this.layer_.leftBounds || this.layer_.rightBounds)) {\n    this.distorter_.setTextureBounds(this.layer_.leftBounds, this.layer_.rightBounds);\n  }\n};\nCardboardVRDisplay.prototype.beginPresent_ = function () {\n  var gl = this.layer_.source.getContext('webgl');\n  if (!gl) gl = this.layer_.source.getContext('experimental-webgl');\n  if (!gl) gl = this.layer_.source.getContext('webgl2');\n  if (!gl) return;\n  if (this.layer_.predistorted) {\n    if (!this.config.CARDBOARD_UI_DISABLED) {\n      gl.canvas.width = getScreenWidth() * this.bufferScale_;\n      gl.canvas.height = getScreenHeight() * this.bufferScale_;\n      this.cardboardUI_ = new CardboardUI(gl);\n    }\n  } else {\n    if (!this.config.CARDBOARD_UI_DISABLED) {\n      this.cardboardUI_ = new CardboardUI(gl);\n    }\n    this.distorter_ = new CardboardDistorter(gl, this.cardboardUI_, this.config.BUFFER_SCALE, this.config.DIRTY_SUBMIT_FRAME_BINDINGS);\n    this.distorter_.updateDeviceInfo(this.deviceInfo_);\n  }\n  if (this.cardboardUI_) {\n    this.cardboardUI_.listen(function (e) {\n      this.viewerSelector_.show(this.layer_.source.parentElement);\n      e.stopPropagation();\n      e.preventDefault();\n    }.bind(this), function (e) {\n      this.exitPresent();\n      e.stopPropagation();\n      e.preventDefault();\n    }.bind(this));\n  }\n  if (this.rotateInstructions_) {\n    if (isLandscapeMode() && isMobile()) {\n      this.rotateInstructions_.showTemporarily(3000, this.layer_.source.parentElement);\n    } else {\n      this.rotateInstructions_.update();\n    }\n  }\n  this.orientationHandler = this.onOrientationChange_.bind(this);\n  window.addEventListener('orientationchange', this.orientationHandler);\n  this.vrdisplaypresentchangeHandler = this.updateBounds_.bind(this);\n  window.addEventListener('vrdisplaypresentchange', this.vrdisplaypresentchangeHandler);\n  this.fireVRDisplayDeviceParamsChange_();\n};\nCardboardVRDisplay.prototype.endPresent_ = function () {\n  if (this.distorter_) {\n    this.distorter_.destroy();\n    this.distorter_ = null;\n  }\n  if (this.cardboardUI_) {\n    this.cardboardUI_.destroy();\n    this.cardboardUI_ = null;\n  }\n  if (this.rotateInstructions_) {\n    this.rotateInstructions_.hide();\n  }\n  this.viewerSelector_.hide();\n  window.removeEventListener('orientationchange', this.orientationHandler);\n  window.removeEventListener('vrdisplaypresentchange', this.vrdisplaypresentchangeHandler);\n};\nCardboardVRDisplay.prototype.updatePresent_ = function () {\n  this.endPresent_();\n  this.beginPresent_();\n};\nCardboardVRDisplay.prototype.submitFrame = function (pose) {\n  if (this.distorter_) {\n    this.updateBounds_();\n    this.distorter_.submitFrame();\n  } else if (this.cardboardUI_ && this.layer_) {\n    var gl = this.layer_.source.getContext('webgl');\n    if (!gl) gl = this.layer_.source.getContext('experimental-webgl');\n    if (!gl) gl = this.layer_.source.getContext('webgl2');\n    var canvas = gl.canvas;\n    if (canvas.width != this.lastWidth || canvas.height != this.lastHeight) {\n      this.cardboardUI_.onResize();\n    }\n    this.lastWidth = canvas.width;\n    this.lastHeight = canvas.height;\n    this.cardboardUI_.render();\n  }\n};\nCardboardVRDisplay.prototype.onOrientationChange_ = function (e) {\n  this.viewerSelector_.hide();\n  if (this.rotateInstructions_) {\n    this.rotateInstructions_.update();\n  }\n  this.onResize_();\n};\nCardboardVRDisplay.prototype.onResize_ = function (e) {\n  if (this.layer_) {\n    var gl = this.layer_.source.getContext('webgl');\n    if (!gl) gl = this.layer_.source.getContext('experimental-webgl');\n    if (!gl) gl = this.layer_.source.getContext('webgl2');\n    var cssProperties = ['position: absolute', 'top: 0', 'left: 0',\n    'width: 100vw', 'height: 100vh', 'border: 0', 'margin: 0',\n    'padding: 0px', 'box-sizing: content-box'];\n    gl.canvas.setAttribute('style', cssProperties.join('; ') + ';');\n    safariCssSizeWorkaround(gl.canvas);\n  }\n};\nCardboardVRDisplay.prototype.onViewerChanged_ = function (viewer) {\n  this.deviceInfo_.setViewer(viewer);\n  if (this.distorter_) {\n    this.distorter_.updateDeviceInfo(this.deviceInfo_);\n  }\n  this.fireVRDisplayDeviceParamsChange_();\n};\nCardboardVRDisplay.prototype.fireVRDisplayDeviceParamsChange_ = function () {\n  var event = new CustomEvent('vrdisplaydeviceparamschange', {\n    detail: {\n      vrdisplay: this,\n      deviceInfo: this.deviceInfo_\n    }\n  });\n  window.dispatchEvent(event);\n};\nCardboardVRDisplay.VRFrameData = VRFrameData;\nCardboardVRDisplay.VRDisplay = VRDisplay;\n\nreturn CardboardVRDisplay;\n\n})));\n", "import { isDefined, isNullOrUndefined } from \"../\";\r\n\r\nfunction defaultKeySelector<T>(obj: T): any {\r\n    return obj;\r\n}\r\n\r\nexport function arrayBinarySearchFind<T, V>(arr: T[], key: V, keySelector: (obj: T) => V): T | undefined {\r\n    const idx = arrayBinarySearchByKey(arr, key, keySelector);\r\n    if (Number.isInteger(idx)) {\r\n        return arr[idx - 1];\r\n    }\r\n\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Performs a binary search on a list to find where the item should be inserted.\r\n *\r\n * If the item is found, the returned index will be an exact integer.\r\n *\r\n * If the item is not found, the returned insertion index will be 0.5 greater than\r\n * the index at which it should be inserted.\r\n */\r\nexport function arrayBinarySearchByKey<T, V>(arr: T[], itemKey: V, keySelector: (obj: T) => V): number {\r\n    let left = 0;\r\n    let right = arr.length;\r\n    let idx = Math.floor((left + right) / 2);\r\n    let found = false;\r\n    while (left < right && idx < arr.length) {\r\n        const compareTo = arr[idx];\r\n        const compareToKey = isNullOrUndefined(compareTo)\r\n            ? null\r\n            : keySelector(compareTo);\r\n        if (isDefined(compareToKey)\r\n            && itemKey < compareToKey) {\r\n            right = idx;\r\n        }\r\n        else {\r\n            if (itemKey === compareToKey) {\r\n                found = true;\r\n            }\r\n            left = idx + 1;\r\n        }\r\n\r\n        idx = Math.floor((left + right) / 2);\r\n    }\r\n\r\n    if (!found) {\r\n        idx += 0.5;\r\n    }\r\n\r\n    return idx;\r\n}\r\n\r\n/**\r\n * Performs a binary search on a list to find where the item should be inserted.\r\n *\r\n * If the item is found, the returned index will be an exact integer.\r\n *\r\n * If the item is not found, the returned insertion index will be 0.5 greater than\r\n * the index at which it should be inserted.\r\n */\r\nexport function arrayBinarySearch<T, V>(arr: T[], item: T, keySelector?: (obj: T) => V): number {\r\n    keySelector = keySelector || defaultKeySelector;\r\n    const itemKey = keySelector(item);\r\n    return arrayBinarySearchByKey(arr, itemKey, keySelector);\r\n}\r\n\r\nexport function arrayBinaryContains<T, V>(arr: T[], item: T, keySelector?: (obj: T) => V): boolean {\r\n    return Number.isInteger(arrayBinarySearch(arr, item, keySelector));\r\n}", "/**\r\n * Removes an item at the given index from an array.\r\n */\r\nexport function arrayRemoveAt<T>(arr: T[], idx: number) {\r\n    return arr.splice(idx, 1)[0];\r\n}", "/**\r\n * Empties out an array, returning the items that were in the array.\r\n * \r\n * @param arr the array to empty\r\n */\r\nexport function arrayClear<T>(arr: T[]) {\r\n    return arr.splice(0);\r\n}", "\uFEFF/**\r\n * Checks to see if two arrays contain the same elements\r\n * @returns -1 if the arrays match, the index of the first mismatched item if they don't.\r\n * @param arr1\r\n * @param arr2\r\n */\r\n\r\nexport function arrayCompare<T>(arr1: ReadonlyArray<T>, arr2: ReadonlyArray<T>): number {\r\n    for (let i = 0; i < arr1.length; ++i) {\r\n        if (arr1[i] !== arr2[i]) {\r\n            return i;\r\n        }\r\n    }\r\n\r\n    return -1;\r\n}\r\n", "\uFEFF/**\r\n * Inserts an item at the given index into an array.\r\n * @param arr\r\n * @param item\r\n * @param idx\r\n */\r\n\r\nexport function arrayInsertAt<T>(arr: T[], item: T, idx: number) {\r\n    arr.splice(idx, 0, item);\r\n}\r\n", "import { arrayRemoveAt } from \"./arrayRemoveAt\";\r\n\r\n/**\r\n * Removes a given item from an array, returning true if the item was removed.\r\n */\r\nexport function arrayRemove<T>(arr: T[], value: T) {\r\n    const idx = arr.indexOf(value);\r\n    if (idx > -1) {\r\n        arrayRemoveAt(arr, idx);\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nexport function arrayFilter<T>(arr: T[], predicate: (v: T) => boolean): T | null {\r\n    for (let i = arr.length - 1; i >= 0; --i) {\r\n        if (predicate(arr[i])) {\r\n            return arrayRemoveAt(arr, i);\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport function arrayRemoveByKey<T, K>(arr: T[], key: K, getKey: (v: T) => K): T | null {\r\n    return arrayFilter(arr, (v) => getKey(v) === key);\r\n}", "/**\r\n * Replaces all of the items in an array with the given items.\r\n *\r\n * This helps reduce GC pressure as you're not creating arrays\r\n * and then dropping them on the floor.\r\n * \r\n * @param arr the array to fill\r\n * @param items the items to put into the array\r\n */\r\nexport function arrayReplace<T>(arr: T[], ...items: T[]) {\r\n    arr.splice(0, arr.length, ...items);\r\n}\r\n", "/**\r\n * Scans through a series of filters to find an item that matches\r\n * any of the filters. The first item of the first filter that matches\r\n * will be returned.\r\n */\r\nexport function arrayScan<T>(arr: readonly T[], ...tests: ((val: T) => boolean)[]) {\r\n    for (const test of tests) {\r\n        for (const item of arr) {\r\n            if (test(item)) {\r\n                return item;\r\n            }\r\n        }\r\n    }\r\n\r\n    return null;\r\n}", "import { isBoolean, isDefined, isFunction, isNullOrUndefined } from \"../\";\r\nimport { arrayBinarySearch } from \"./arrayBinarySearch\";\r\nimport { arrayInsertAt } from \"./arrayInsertAt\";\r\n\r\n/**\r\n * Performs an insert operation that maintains the sort\r\n * order of the array, returning the index at which the\r\n * item was inserted.\r\n */\r\nexport function arraySortedInsert<T>(arr: T[], item: T): number;\r\nexport function arraySortedInsert<T, V>(arr: T[], item: T, keySelector?: (obj: T) => V): number;\r\nexport function arraySortedInsert<T>(arr: T[], item: T, allowDuplicates?: boolean): number;\r\nexport function arraySortedInsert<T, V>(arr: T[], item: T, keySelector?: (obj: T) => V, allowDuplicates?: boolean): number;\r\nexport function arraySortedInsert<T, V>(arr: T[], item: T, keySelector?: ((obj: T) => V) | boolean, allowDuplicates?: boolean): number {\r\n    let ks: ((obj: T) => V) | undefined;\r\n\r\n    if (isFunction(keySelector)) {\r\n        ks = keySelector;\r\n    }\r\n    else if (isBoolean(keySelector)) {\r\n        allowDuplicates = keySelector;\r\n    }\r\n\r\n    if (isNullOrUndefined(allowDuplicates)) {\r\n        allowDuplicates = true;\r\n    }\r\n\r\n    return arraySortedInsertInternal<T, V>(arr, item, ks, allowDuplicates);\r\n}\r\n\r\nfunction arraySortedInsertInternal<T, V>(arr: T[], item: T, ks: ((obj: T) => V) | undefined, allowDuplicates: boolean) {\r\n    let idx = arrayBinarySearch(arr, item, ks);\r\n    const found = (idx % 1) === 0;\r\n    idx = idx | 0;\r\n    if (!found || allowDuplicates) {\r\n        arrayInsertAt(arr, item, idx);\r\n    }\r\n\r\n    return idx;\r\n}\r\n\r\n/**\r\n * Creates a new array that is sorted by the key extracted\r\n * by the keySelector callback, not modifying the input array,\r\n * (unlike JavaScript's own Array.prototype.sort).\r\n * @param arr\r\n * @param keySelector\r\n */\r\nexport function arraySortByKey<T, V>(arr: ReadonlyArray<T>, keySelector: (obj: T) => V): T[] {\r\n    const newArr = Array.from(arr);\r\n    arraySortByKeyInPlace<T, V>(newArr, keySelector);\r\n    return newArr;\r\n}\r\n\r\n/**\r\n * Sorts an existing array by the key extracted by the keySelector\r\n * callback, without creating a new array.\r\n * @param arr\r\n * @param keySelector\r\n */\r\nexport function arraySortByKeyInPlace<T, V>(newArr: T[], keySelector: (obj: T) => V) {\r\n    newArr.sort((a, b) => {\r\n        const keyA = keySelector(a);\r\n        const keyB = keySelector(b);\r\n        if (keyA < keyB) {\r\n            return -1;\r\n        }\r\n        else if (keyA > keyB) {\r\n            return 1;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    });\r\n}\r\n\r\nconst numericPattern = /^(\\d+)/;\r\n/**\r\n * Creates a new array that is sorted by the key extracted\r\n * by the keySelector callback, not modifying the input array,\r\n * (unlike JavaScript's own Array.prototype.sort).\r\n *\r\n * If the values have a number at the beginning, they'll be sorted\r\n * by that number.\r\n * @param arr\r\n * @param keySelector\r\n */\r\nexport function arraySortNumericByKey<T>(arr: ReadonlyArray<T>, keySelector: (obj: T) => string): T[] {\r\n    const newArr = Array.from(arr);\r\n    newArr.sort((a, b) => {\r\n        const keyA = keySelector(a);\r\n        const keyB = keySelector(b);\r\n        const matchA = keyA.match(numericPattern);\r\n        const matchB = keyB.match(numericPattern);\r\n        if (isDefined(matchA)\r\n            && isDefined(matchB)) {\r\n            const numberA = parseFloat(matchA[1]);\r\n            const numberB = parseFloat(matchB[1]);\r\n\r\n            if (numberA < numberB) {\r\n                return -1;\r\n            }\r\n            else if (numberA > numberB) {\r\n                return 1;\r\n            }\r\n        }\r\n\r\n        if (keyA < keyB) {\r\n            return -1;\r\n        }\r\n        else if (keyA > keyB) {\r\n            return 1;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    });\r\n\r\n    return newArr;\r\n}", "import { isDefined } from \"../\";\r\nimport { arrayInsertAt } from \"./arrayInsertAt\";\r\nimport { arrayRemove } from \"./arrayRemove\";\r\nimport { arraySortedInsert } from \"./arraySortedInsert\";\r\n\r\nexport abstract class BaseGraphNode<ValueT> {\r\n\r\n    protected readonly _forward = new Array<BaseGraphNode<ValueT>>();\r\n    protected readonly _reverse = new Array<BaseGraphNode<ValueT>>();\r\n\r\n    constructor(public readonly value: ValueT) {\r\n    }\r\n\r\n    connectSorted<KeyT>(child: BaseGraphNode<ValueT>, keySelector: (value: ValueT) => KeyT): void {\r\n        if (isDefined(keySelector)) {\r\n            arraySortedInsert(this._forward, child, (n) => keySelector(n.value));\r\n            child._reverse.push(this);\r\n        }\r\n        else {\r\n            this.connectTo(child);\r\n        }\r\n    }\r\n\r\n    connectTo(child: BaseGraphNode<ValueT>) {\r\n        this.connectAt(child, this._forward.length);\r\n    }\r\n\r\n    connectAt(child: BaseGraphNode<ValueT>, index: number) {\r\n        arrayInsertAt(this._forward, child, index);\r\n        child._reverse.push(this);\r\n    }\r\n\r\n    disconnectFrom(child: BaseGraphNode<ValueT>) {\r\n        arrayRemove(this._forward, child);\r\n        arrayRemove(child._reverse, this);\r\n    }\r\n\r\n    isConnectedTo(node: BaseGraphNode<ValueT>): boolean {\r\n        return this._forward.indexOf(node) >= 0\r\n            || this._reverse.indexOf(node) >= 0;\r\n    }\r\n\r\n    flatten(): BaseGraphNode<ValueT>[] {\r\n        const nodes = new Set<BaseGraphNode<ValueT>>();\r\n        const queue: BaseGraphNode<ValueT>[] = [this];\r\n        while (queue.length > 0) {\r\n            const here = queue.shift();\r\n            if (isDefined(here) && !nodes.has(here)) {\r\n                nodes.add(here);\r\n                queue.push(...here._forward);\r\n            }\r\n        }\r\n\r\n        return Array.from(nodes);\r\n    }\r\n\r\n    protected get _isEntryPoint() {\r\n        return this._reverse.length === 0;\r\n    }\r\n\r\n    protected get _isExitPoint() {\r\n        return this._forward.length === 0;\r\n    }\r\n\r\n    get isDisconnected() {\r\n        return this._isEntryPoint\r\n            && this._isExitPoint;\r\n    }\r\n\r\n    get isConnected() {\r\n        return !this._isExitPoint\r\n            || !this._isEntryPoint;\r\n    }\r\n\r\n    get isTerminus() {\r\n        return this._isEntryPoint\r\n            || this._isExitPoint;\r\n    }\r\n\r\n    get isInternal() {\r\n        return !this._isEntryPoint\r\n            && !this._isExitPoint;\r\n    }\r\n}", "import { BaseGraphNode } from \"./BaseGraphNode\";\r\n\r\nexport class GraphNode<ValueT> extends BaseGraphNode<ValueT>{\r\n\r\n    override connectTo(node: GraphNode<ValueT>): void {\r\n        super.connectTo(node);\r\n    }\r\n\r\n    override connectAt(child: GraphNode<ValueT>, index: number): void {\r\n        super.connectAt(child, index);\r\n    }\r\n\r\n    override connectSorted<KeyT>(child: GraphNode<ValueT>, sortKey: (value: ValueT) => KeyT): void {\r\n        super.connectSorted(child, sortKey);\r\n    }\r\n\r\n    override disconnectFrom(node: GraphNode<ValueT>): void {\r\n        super.disconnectFrom(node);\r\n    }\r\n\r\n    override isConnectedTo(node: GraphNode<ValueT>): boolean {\r\n        return super.isConnectedTo(node);\r\n    }\r\n\r\n    override flatten(): GraphNode<ValueT>[] {\r\n        return super.flatten() as GraphNode<ValueT>[];\r\n    }\r\n\r\n    get connections(): GraphNode<ValueT>[] {\r\n        return this._forward as GraphNode<ValueT>[];\r\n    }\r\n\r\n    get isEntryPoint() {\r\n        return this._isEntryPoint;\r\n    }\r\n\r\n    get isExitPoint() {\r\n        return this._isExitPoint;\r\n    }\r\n}", "\r\nexport function mapMap<T, U, V>(items: T[], makeID: (item: T) => U, makeValue: (item: T) => V) {\r\n    return new Map(items.map((item) => [makeID(item), makeValue(item)]));\r\n}", "import { identity } from \"../\";\r\nimport { mapMap } from \"./mapMap\";\r\n\r\nexport function makeLookup<T, U>(items: T[], makeID: (item: T) => U): Map<U, T> {\r\n    return mapMap(items, makeID, identity);\r\n}", "import { isDefined, isNullOrUndefined } from \"../\";\r\nimport { arrayClear } from \"./arrayClear\";\r\nimport { arrayRemove } from \"./arrayRemove\";\r\n\r\nexport class PriorityList<KeyT, ValueT> {\r\n    private readonly items = new Map<KeyT, ValueT[]>();\r\n    private readonly defaultItems = new Array<ValueT>();\r\n\r\n    constructor(init?: [KeyT, ValueT][]) {\r\n        if (isDefined(init)) {\r\n            for (const [key, value] of init) {\r\n                this.add(key, value);\r\n            }\r\n        }\r\n    }\r\n\r\n    add(key: KeyT, value: ValueT): this {\r\n        if (isNullOrUndefined(key)) {\r\n            this.defaultItems.push(value);\r\n        }\r\n        else {\r\n            let list = this.items.get(key);\r\n            if (isNullOrUndefined(list)) {\r\n                this.items.set(key, list = []);\r\n            }\r\n\r\n            list.push(value);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    entries(): IterableIterator<[KeyT, ValueT[]]> {\r\n        return this.items.entries();\r\n    }\r\n\r\n    [Symbol.iterator]() {\r\n        return this.entries();\r\n    }\r\n\r\n    keys(): IterableIterator<KeyT> {\r\n        return this.items.keys();\r\n    }\r\n\r\n    *values(): IterableIterator<ValueT> {\r\n        for (const item of this.defaultItems) {\r\n            yield item;\r\n        }\r\n        for (const list of this.items.values()) {\r\n            for (const item of list) {\r\n                yield item;\r\n            }\r\n        }\r\n    }\r\n\r\n    has(key: KeyT): boolean {\r\n        if (isDefined(key)) {\r\n            return this.items.has(key);\r\n        }\r\n        else {\r\n            return this.defaultItems.length > 0;\r\n        }\r\n    }\r\n\r\n    get(key: KeyT): ValueT[] {\r\n        if (isNullOrUndefined(key)) {\r\n            return this.defaultItems;\r\n        }\r\n\r\n        return this.items.get(key) || [];\r\n    }\r\n\r\n    count(key: KeyT): number {\r\n        if (isNullOrUndefined(key)) {\r\n            return this.defaultItems.length;\r\n        }\r\n\r\n        const list = this.get(key);\r\n        if (isDefined(list)) {\r\n            return list.length;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    get size(): number {\r\n        let size = this.defaultItems.length;\r\n        for (const list of this.items.values()) {\r\n            size += list.length;\r\n        }\r\n        return size;\r\n    }\r\n\r\n    delete(key: KeyT) {\r\n        if (isNullOrUndefined(key)) {\r\n            return arrayClear(this.defaultItems).length > 0;\r\n        }\r\n        else {\r\n            return this.items.delete(key);\r\n        }\r\n    }\r\n\r\n    remove(key: KeyT, value: ValueT) {\r\n        if (isNullOrUndefined(key)) {\r\n            arrayRemove(this.defaultItems, value);\r\n        }\r\n        else {\r\n            const list = this.items.get(key);\r\n            if (isDefined(list)) {\r\n                arrayRemove(list, value);\r\n                if (list.length === 0) {\r\n                    this.items.delete(key);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    clear(): void {\r\n        this.items.clear();\r\n        arrayClear(this.defaultItems);\r\n    }\r\n}\r\n\r\n\r\n", "import { isDefined, isNullOrUndefined } from \"../\";\r\n\r\n\r\n\r\nexport class PriorityMap<Key1T, Key2T, ValueT> {\r\n    private readonly items = new Map<Key1T, Map<Key2T, ValueT>>();\r\n\r\n    constructor(init?: Iterable<[Key1T, Key2T, ValueT]>) {\r\n        if (isDefined(init)) {\r\n            for (const [key1, key2, value] of init) {\r\n                this.add(key1, key2, value);\r\n            }\r\n        }\r\n    }\r\n\r\n    add(key1: Key1T, key2: Key2T, value: ValueT): this {\r\n        let level1 = this.items.get(key1);\r\n        if (isNullOrUndefined(level1)) {\r\n            this.items.set(key1, level1 = new Map());\r\n        }\r\n\r\n        level1.set(key2, value);\r\n\r\n        return this;\r\n    }\r\n\r\n    *entries(): IterableIterator<[Key1T, Key2T, ValueT]> {\r\n        for (const [key1, level1] of this.items) {\r\n            for (const [key2, value] of level1) {\r\n                yield [key1, key2, value];\r\n            }\r\n        }\r\n    }\r\n    keys(): IterableIterator<Key1T>;\r\n    keys(key1: Key1T): IterableIterator<Key2T>;\r\n    keys(key1?: Key1T): IterableIterator<Key1T | Key2T> {\r\n        if (isNullOrUndefined(key1)) {\r\n            return this.items.keys();\r\n        }\r\n        else {\r\n            return this.items.get(key1).keys();\r\n        }\r\n    }\r\n\r\n    *values(): IterableIterator<ValueT> {\r\n        for (const level1 of this.items.values()) {\r\n            for (const value of level1.values()) {\r\n                yield value;\r\n            }\r\n        }\r\n    }\r\n\r\n    has(key1: Key1T, key2?: Key2T): boolean {\r\n        return this.items.has(key1)\r\n            && (isNullOrUndefined(key2)\r\n                || this.items.get(key1).has(key2));\r\n    }\r\n\r\n    get(key1: Key1T): Map<Key2T, ValueT>;\r\n    get(key1: Key1T, key2: Key2T): ValueT;\r\n    get(key1: Key1T, key2?: Key2T): ValueT | Map<Key2T, ValueT> {\r\n        if (isNullOrUndefined(key2)) {\r\n            return this.items.get(key1);\r\n        }\r\n        else if (this.items.has(key1)) {\r\n            return this.items.get(key1).get(key2);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    count(key1: Key1T): number {\r\n        if (this.items.has(key1)) {\r\n            return this.items.get(key1).size;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    get size(): number {\r\n        let size = 0;\r\n        for (const list of this.items.values()) {\r\n            size += list.size;\r\n        }\r\n        return size;\r\n    }\r\n\r\n    delete(key1: Key1T, key2?: Key2T) {\r\n        if (isNullOrUndefined(key2)) {\r\n            return this.items.delete(key1);\r\n        }\r\n        else if (this.items.has(key1)) {\r\n            return this.items.get(key1).delete(key2);\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    clear(): void {\r\n        this.items.clear();\r\n    }\r\n}\r\n", "import { arrayClear, arrayRemoveAt, isBoolean, isDefined, isFunction, isNullOrUndefined } from \"../\";\r\n\r\ntype EventCallback = (evt: Event) => any;\r\n\r\nexport class EventBase implements EventTarget {\r\n    private readonly listeners = new Map<string, EventCallback[]>();\r\n    private readonly listenerOptions = new Map<EventCallback, boolean | AddEventListenerOptions>();\r\n\r\n    addEventListener(type: string, callback: (evt: Event) => any, options?: boolean | AddEventListenerOptions): void {\r\n        if (isFunction(callback)) {\r\n            let listeners = this.listeners.get(type);\r\n            if (!listeners) {\r\n                listeners = new Array<EventCallback>();\r\n                this.listeners.set(type, listeners);\r\n            }\r\n\r\n            if (!listeners.find((c) => c === callback)) {\r\n                listeners.push(callback);\r\n\r\n                if (options) {\r\n                    this.listenerOptions.set(callback, options);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    removeEventListener(type: string, callback: (evt: Event) => any) {\r\n        if (isFunction(callback)) {\r\n            const listeners = this.listeners.get(type);\r\n            if (listeners) {\r\n                this.removeListener(listeners, callback);\r\n            }\r\n        }\r\n    }\r\n\r\n    clearEventListeners(type?: string) {\r\n        for (const [evtName, handlers] of this.listeners) {\r\n            if (isNullOrUndefined(type) || type === evtName) {\r\n                for (const handler of handlers) {\r\n                    this.removeEventListener(type, handler);\r\n                }\r\n                arrayClear(handlers);\r\n                this.listeners.delete(evtName);\r\n            }\r\n        }\r\n    }\r\n\r\n    private removeListener(listeners: EventCallback[], callback: EventCallback) {\r\n        const idx = listeners.findIndex((c) => c === callback);\r\n        if (idx >= 0) {\r\n            arrayRemoveAt(listeners, idx);\r\n            if (this.listenerOptions.has(callback)) {\r\n                this.listenerOptions.delete(callback);\r\n            }\r\n        }\r\n    }\r\n\r\n    dispatchEvent(evt: Event): boolean {\r\n        const listeners = this.listeners.get(evt.type);\r\n        if (listeners) {\r\n            for (const callback of listeners) {\r\n                const options = this.listenerOptions.get(callback);\r\n                if (isDefined(options)\r\n                    && !isBoolean(options)\r\n                    && options.once) {\r\n                    this.removeListener(listeners, callback);\r\n                }\r\n\r\n                callback.call(this, evt);\r\n            }\r\n        }\r\n        return !evt.defaultPrevented;\r\n    }\r\n}\r\n\r\nexport class TypedEvent<T extends string> extends Event {\r\n\r\n    override get type(): T {\r\n        return super.type as T;\r\n    }\r\n\r\n    constructor(type: T) {\r\n        super(type);\r\n    }\r\n}\r\n\r\nexport class TypedEventBase<EventsT> extends EventBase {\r\n    private readonly bubblers = new Set<TypedEventBase<EventsT>>();\r\n    private readonly scopes = new WeakMap<object, Array<[any, any]>>();\r\n\r\n    addBubbler(bubbler: TypedEventBase<EventsT>) {\r\n        this.bubblers.add(bubbler);\r\n    }\r\n\r\n    removeBubbler(bubbler: TypedEventBase<EventsT>) {\r\n        this.bubblers.delete(bubbler);\r\n    }\r\n\r\n    override addEventListener<K extends keyof EventsT & string>(type: K, callback: (evt: TypedEvent<K> & EventsT[K]) => any, options?: boolean | AddEventListenerOptions): void {\r\n        super.addEventListener(type, callback as any, options);\r\n    }\r\n\r\n    override removeEventListener<K extends keyof EventsT & string>(type: K, callback: (evt: TypedEvent<K> & EventsT[K]) => any) {\r\n        super.removeEventListener(type, callback as any);\r\n    }\r\n\r\n    override clearEventListeners<K extends keyof EventsT & string>(type?: K): void {\r\n        return super.clearEventListeners(type);\r\n    }\r\n\r\n    addScopedEventListener<K extends keyof EventsT & string>(scope: object, type: K, callback: (evt: TypedEvent<K> & EventsT[K]) => any, options?: boolean | AddEventListenerOptions): void {\r\n        if (!this.scopes.has(scope)) {\r\n            this.scopes.set(scope, []);\r\n        }\r\n        this.scopes.get(scope).push([type, callback]);\r\n        this.addEventListener(type, callback as any, options);\r\n    }\r\n\r\n    removeScope<K extends keyof EventsT & string>(scope: object) {\r\n        const listeners = this.scopes.get(scope);\r\n        if (listeners) {\r\n            this.scopes.delete(scope);\r\n            for (const [type, listener] of listeners) {\r\n                this.removeEventListener(type as K, listener);\r\n            }\r\n        }\r\n    }\r\n\r\n    override dispatchEvent<T extends Event>(evt: T): boolean {\r\n        if (!super.dispatchEvent(evt)) {\r\n            return false;\r\n        }\r\n\r\n        for (const bubbler of this.bubblers) {\r\n            if (!bubbler.dispatchEvent(evt)) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}", "import { alwaysTrue, isBoolean, isDefined, isFunction } from \"../\";\r\nimport { Predicate } from \"./Predicate\";\r\n\r\nexport class Task<ResultsT = void, ErrorT = unknown> implements Promise<ResultsT> {\r\n\r\n    private readonly promise: Promise<ResultsT>;\r\n\r\n    private _resolve: (value: ResultsT) => void = null;\r\n    private _reject: (reason: ErrorT) => void = null;\r\n    private _result: ResultsT = null;\r\n    private _error: ErrorT = null;\r\n    private _started = false;\r\n    private _finished = false;\r\n\r\n    get result(): ResultsT {\r\n        if (isDefined(this.error)) {\r\n            throw this.error;\r\n        }\r\n\r\n        return this._result;\r\n    }\r\n\r\n    get error(): ErrorT {\r\n        return this._error;\r\n    }\r\n\r\n    get started(): boolean {\r\n        return this._started;\r\n    }\r\n\r\n    get finished(): boolean {\r\n        return this._finished;\r\n    }\r\n\r\n    readonly resolve: (value: ResultsT) => void = null;\r\n    readonly reject: (reason: ErrorT) => void = null;\r\n\r\n    constructor(autoStart?: boolean);\r\n    constructor(resolveTest: Predicate<ResultsT>, autoStart?: boolean)\r\n    constructor(resolveTest: Predicate<ResultsT>, rejectTest: Predicate<ErrorT>, autoStart?: boolean);\r\n    constructor(resolveTestOrAutoStart?: boolean | Predicate<ResultsT>, rejectTestOrAutoStart?: boolean | Predicate<ErrorT>, autoStart = true) {\r\n        let resolveTest: Predicate<ResultsT> = alwaysTrue;\r\n        let rejectTest: Predicate<ErrorT> = alwaysTrue;\r\n\r\n        if (isFunction(resolveTestOrAutoStart)) {\r\n            resolveTest = resolveTestOrAutoStart;\r\n        }\r\n\r\n        if (isFunction(rejectTestOrAutoStart)) {\r\n            rejectTest = rejectTestOrAutoStart;\r\n        }\r\n\r\n        if (isBoolean(resolveTestOrAutoStart)) {\r\n            autoStart = resolveTestOrAutoStart;\r\n        }\r\n        else if (isBoolean(rejectTestOrAutoStart)) {\r\n            autoStart = rejectTestOrAutoStart;\r\n        }\r\n\r\n        this.resolve = (value: ResultsT): void => {\r\n            if (isDefined(this._resolve)) {\r\n                this._resolve(value);\r\n            }\r\n        };\r\n\r\n        this.reject = (reason: ErrorT): void => {\r\n            if (isDefined(this._reject)) {\r\n                this._reject(reason);\r\n            }\r\n        };\r\n\r\n        this.promise = new Promise((resolve, reject) => {\r\n            this._resolve = (value: ResultsT) => {\r\n                if (resolveTest(value)) {\r\n                    this._result = value;\r\n                    this._finished = true;\r\n                    resolve(value);\r\n                }\r\n            };\r\n\r\n            this._reject = (reason: ErrorT) => {\r\n                if (rejectTest(reason)) {\r\n                    this._error = reason;\r\n                    this._finished = true;\r\n                    reject(reason);\r\n                }\r\n            };\r\n        });\r\n\r\n        if (autoStart) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    start() {\r\n        this._started = true;\r\n    }\r\n\r\n    get [Symbol.toStringTag](): string {\r\n        return this.promise.toString();\r\n    }\r\n\r\n    then<TResult1 = ResultsT, TResult2 = never>(onfulfilled?: (value: ResultsT) => TResult1 | PromiseLike<TResult1>, onrejected?: (reason: any) => TResult2 | PromiseLike<TResult2>): Promise<TResult1 | TResult2> {\r\n        return this.promise.then(onfulfilled, onrejected);\r\n    }\r\n\r\n    catch<TResult = never>(onrejected?: (reason: any) => TResult | PromiseLike<TResult>): Promise<ResultsT | TResult> {\r\n        return this.promise.catch(onrejected);\r\n    }\r\n\r\n    finally(onfinally?: () => void): Promise<ResultsT> {\r\n        return this.promise.finally(onfinally);\r\n    }\r\n}", "import { alwaysFalse, alwaysTrue, Exception, isNullOrUndefined, isNumber, isString } from \"../\";\r\nimport { EventBase, TypedEventBase } from \"./EventBase\";\r\nimport { Task } from \"./Task\";\r\n\r\nfunction targetValidateEvent(target: EventTarget, type: string) {\r\n    return (\"on\" + type) in target;\r\n}\r\n\r\n/**\r\n * Wait for a specific event, one time.\r\n * @param target - the event target.\r\n * @param resolveEvt - the name of the event that will resolve the Promise this method creates.\r\n * @param [rejectEvt] - the name of the event that could reject the Promise this method creates.\r\n * @param [timeout] - the number of milliseconds to wait for the resolveEvt, before rejecting.\r\n */\r\nexport function once<EventsT>(target: TypedEventBase<EventsT> | EventTarget, resolveEvt: keyof EventsT & string, timeout: number, ...rejectEvts: (keyof EventsT & string)[]): Task<EventsT[typeof resolveEvt], EventsT[keyof EventsT]>;\r\nexport function once<EventsT>(target: TypedEventBase<EventsT> | EventTarget, resolveEvt: keyof EventsT & string, ...rejectEvts: (keyof EventsT & string)[]): Task<EventsT[typeof resolveEvt], EventsT[keyof EventsT]>;\r\nexport function once<EventsT>(target: EventTarget, resolveEvt: keyof EventsT & string, rejectEvtOrTimeout?: number | (keyof EventsT & string), ...rejectEvts: (keyof EventsT & string)[]): Task<EventsT[typeof resolveEvt], EventsT[keyof EventsT]> {\r\n\r\n    if (isNullOrUndefined(rejectEvts)) {\r\n        rejectEvts = [];\r\n    }\r\n\r\n    let timeout: number = undefined;\r\n    if (isString(rejectEvtOrTimeout)) {\r\n        rejectEvts.unshift(rejectEvtOrTimeout);\r\n    }\r\n    else if (isNumber(rejectEvtOrTimeout)) {\r\n        timeout = rejectEvtOrTimeout;\r\n    }\r\n\r\n    if (!(target instanceof EventBase)) {\r\n        if (!targetValidateEvent(target, resolveEvt)) {\r\n            throw new Exception(`Target does not have a ${resolveEvt} rejection event`);\r\n        }\r\n\r\n        for (const evt of rejectEvts) {\r\n            if (!targetValidateEvent(target, evt)) {\r\n                throw new Exception(`Target does not have a ${evt} rejection event`);\r\n            }\r\n        }\r\n    }\r\n\r\n    const task = new Task<EventsT[typeof resolveEvt], EventsT[keyof EventsT]>();\r\n\r\n    if (isNumber(timeout)) {\r\n        const timeoutHandle = setTimeout(task.reject, timeout, `'${resolveEvt}' has timed out.`);\r\n        task.finally(clearTimeout.bind(globalThis, timeoutHandle));\r\n    }\r\n\r\n    const register = (evt: keyof EventsT & string, callback: (evt: Event) => void) => {\r\n        target.addEventListener(evt, callback);\r\n        task.finally(() => target.removeEventListener(evt, callback));\r\n    }\r\n\r\n    const onResolve = (evt: Event) => task.resolve(evt as any as EventsT[typeof resolveEvt]);\r\n    const onReject = (evt: Event) => task.reject(evt as any as EventsT[keyof EventsT]);\r\n    register(resolveEvt, onResolve);\r\n\r\n    for (const rejectEvt of rejectEvts) {\r\n        register(rejectEvt, onReject);\r\n    }\r\n\r\n    return task;\r\n}\r\n\r\nexport function success<T, E>(task: Task<T, E>): Promise<boolean> {\r\n    return task.then(alwaysTrue)\r\n        .catch(alwaysFalse);\r\n};", "export class Promisifier<T = void> implements Promise<T> {\r\n\r\n    private readonly promise: Promise<T>;\r\n\r\n    callback: (...args: any[]) => void = null;\r\n\r\n    constructor(\r\n        resolveRejectTest: (...args: any[]) => boolean,\r\n        selectValue: (...args: any[]) => T,\r\n        selectRejectionReason: (...args: any[]) => any) {\r\n        this.promise = new Promise((resolve, reject) => {\r\n            this.callback = (...args: any[]) => {\r\n                if (resolveRejectTest(...args)) {\r\n                    resolve(selectValue(...args));\r\n                }\r\n                else {\r\n                    reject(selectRejectionReason(...args));\r\n                }\r\n            };\r\n        });\r\n\r\n    }\r\n\r\n    get [Symbol.toStringTag](): string {\r\n        return this.promise.toString();\r\n    }\r\n\r\n    then<TResult1 = T, TResult2 = never>(onfulfilled?: (value: T) => TResult1 | PromiseLike<TResult1>, onrejected?: (reason: any) => TResult2 | PromiseLike<TResult2>): Promise<TResult1 | TResult2> {\r\n        return this.promise.then(onfulfilled, onrejected);\r\n    }\r\n\r\n    catch<TResult = never>(onrejected?: (reason: any) => TResult | PromiseLike<TResult>): Promise<T | TResult> {\r\n        return this.promise.catch(onrejected);\r\n    }\r\n\r\n    finally(onfinally?: () => void): Promise<T> {\r\n        return this.promise.finally(onfinally);\r\n    }\r\n}", "export class Exception extends Error {\r\n    constructor(message: string, public readonly innerError: any = null) {\r\n        super(message);\r\n    }\r\n}", "\r\nexport function isChrome() {\r\n    return \"chrome\" in globalThis && !navigator.userAgent.match(\"CriOS\");\r\n}\r\n\r\nexport function isFirefox() {\r\n    return \"InstallTrigger\" in globalThis;\r\n}\r\n\r\nexport function isSafari() {\r\n    return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n}\r\n\r\nexport function isMacOS() {\r\n    return /^mac/i.test(navigator.platform);\r\n}\r\n\r\nexport function isIOS() {\r\n    return /iP(ad|hone|od)/.test(navigator.platform)\r\n        || /Macintosh(.*?) FxiOS(.*?)\\//.test(navigator.platform)\r\n        || isMacOS()\r\n            && \"maxTouchPoints\" in navigator\r\n            && (navigator as any).maxTouchPoints > 2;\r\n}\r\n\r\nexport function isApple() {\r\n    return isIOS()\r\n        || isMacOS();\r\n}\r\n\r\nexport function isMobileVR() {\r\n    return /Mobile VR/.test(navigator.userAgent)\r\n        || /Pico Neo 3 Link/.test(navigator.userAgent)\r\n        || isOculusBrowser;\r\n}\r\n\r\nexport function hasWebXR() {\r\n    return \"xr\" in navigator\r\n        && \"isSessionSupported\" in (navigator as any).xr;\r\n}\r\n\r\nexport function hasWebVR() {\r\n    return \"getVRDisplays\" in navigator;\r\n}\r\n\r\nexport function hasVR() {\r\n    return hasWebXR() || hasWebVR();\r\n}\r\n\r\nexport function isMobile() {\r\n    return /Android/.test(navigator.userAgent)\r\n        || /BlackBerry/.test(navigator.userAgent)\r\n        || /(UC Browser |UCWEB)/.test(navigator.userAgent)\r\n        || isIOS()\r\n        || isMobileVR();\r\n}\r\n\r\nexport function isDesktop() {\r\n    return !isMobile();\r\n}\r\n\r\nconst oculusBrowserPattern = /OculusBrowser\\/(\\d+)\\.(\\d+)\\.(\\d+)/i;\r\nconst oculusMatch = navigator.userAgent.match(oculusBrowserPattern);\r\nexport const isOculusBrowser = !!oculusMatch;\r\nexport const oculusBrowserVersion: { major: number, minor: number, patch: number } = isOculusBrowser && {\r\n    major: parseFloat(oculusMatch[1]),\r\n    minor: parseFloat(oculusMatch[2]),\r\n    patch: parseFloat(oculusMatch[3])\r\n};\r\n\r\nexport const isOculusGo = isOculusBrowser && /pacific/i.test(navigator.userAgent);\r\nexport const isOculusQuest = isOculusBrowser && /quest/i.test(navigator.userAgent);\r\nexport const isOculusQuest2 = isOculusBrowser && /quest 2/i.test(navigator.userAgent);\r\nexport const isOculusQuest1 = isOculusBrowser && !isOculusQuest2;\r\n\r\nexport const isWorker = !(\"Document\" in globalThis);", "const FalseNorthing: number = 10000000;\r\nconst invF: number = 298.257223563;\r\nconst equatorialRadius: number = 6378137;\r\nconst pointScaleFactor: number = 0.9996;\r\nconst E0: number = 500000;\r\n\r\nconst flattening: number = 1 / invF;\r\nconst flatteningComp: number = 1 - flattening;\r\nconst n: number = flattening / (2 - flattening);\r\nconst A: number = (equatorialRadius / (1 + n)) * (1 + (n * n / 4) + (n * n * n * n / 64));\r\n\r\nconst e: number = Math.sqrt(1 - (flatteningComp * flatteningComp));\r\nconst esq: number = 1 - (flatteningComp * flatteningComp);\r\nconst e0sq: number = e * e / (1 - (e * e));\r\n\r\nconst alpha1: number = 1 - (esq * (0.25 + (esq * ((3 / 64) + (5 * esq / 256)))));\r\nconst alpha2: number = esq * ((3 / 8) + (esq * ((3 / 32) + (45 * esq / 1024))));\r\nconst alpha3: number = esq * esq * ((15 / 256) + (esq * 45 / 1024));\r\nconst alpha4: number = esq * esq * esq * (35 / 3072);\r\n\r\nconst beta: number[] = [\r\n    (n / 2) - (2 * n * n / 3) + (37 * n * n * n / 96),\r\n    (n * n / 48) + (n * n * n / 15),\r\n    17 * n * n * n / 480\r\n];\r\n\r\nconst delta: number[] = [\r\n    (2 * n) - (2 * n * n / 3),\r\n    (7 * n * n / 3) - (8 * n * n * n / 5),\r\n    56 * n * n * n / 15\r\n];\r\n\r\nexport const DatumWGS_84 = {\r\n    FalseNorthing,\r\n    equatorialRadius,\r\n    pointScaleFactor,\r\n    E0,\r\n\r\n    A,\r\n    flattening,\r\n    \r\n    e,\r\n    esq,\r\n    e0sq,\r\n\r\n    alpha1,\r\n    alpha2,\r\n    alpha3,\r\n    alpha4,\r\n\r\n    beta,\r\n    delta\r\n};", "/**\n * Common utilities\n * @module glMatrix\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};", "import * as glMatrix from \"./common.js\";\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\n\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\n\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec3} out\n */\n\nexport function transformQuat(out, a, q) {\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3];\n  var x = a[0],\n      y = a[1],\n      z = a[2]; // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n\n  var uvx = qy * z - qz * y,\n      uvy = qz * x - qx * z,\n      uvz = qx * y - qy * x; // var uuv = vec3.cross([], qvec, uv);\n\n  var uuvx = qy * uvz - qz * uvy,\n      uuvy = qz * uvx - qx * uvz,\n      uuvz = qx * uvy - qy * uvx; // vec3.scale(uv, uv, 2 * w);\n\n  var w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2; // vec3.scale(uuv, uuv, 2);\n\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2; // return vec3.add(out, a, vec3.add(out, uv, uuv));\n\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2]; //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      bx = b[0],\n      by = b[1],\n      bz = b[2],\n      mag1 = Math.sqrt(ax * ax + ay * ay + az * az),\n      mag2 = Math.sqrt(bx * bx + by * by + bz * bz),\n      mag = mag1 * mag2,\n      cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec3.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 3;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n\n    return a;\n  };\n}();", "export function identity<T>(item: T): T {\r\n    return item;\r\n}\r\n\r\nexport function nothing(): void {\r\n}\r\n\r\nexport function negate(value: number) {\r\n    return -value;\r\n}\r\n\r\nexport function alwaysTrue(): true {\r\n    return true;\r\n}\r\n\r\nexport function alwaysFalse(): false {\r\n    return false;\r\n}\r\n\r\nexport function not(value: boolean) {\r\n    return !value;\r\n}\r\n\r\nexport function and(a: boolean, b: boolean): boolean {\r\n    return a && b;\r\n}\r\n\r\nexport function or(a: boolean, b: boolean): boolean {\r\n    return a || b;\r\n}\r\n\r\nexport function xor(a: boolean, b: boolean): boolean {\r\n    return a !== b;\r\n}\r\n\r\nexport function nand(a: boolean, b: boolean): boolean {\r\n    return not(and(a, b));\r\n}\r\n\r\nexport function nor(a: boolean, b: boolean): boolean {\r\n    return not(or(a, b));\r\n}\r\n\r\nexport function equal<T>(a: T, b: T): boolean {\r\n    return a === b;\r\n}\r\n\r\nexport type AsyncCallback = () => Promise<void>;", "const Tau = 2 * Math.PI;\r\n\r\nexport function angleClamp(v: number) {\r\n    return ((v % Tau) + Tau) % Tau;\r\n}\r\n", "/**\r\n * Force a value onto a range\r\n */\r\nexport function clamp(v: number, min: number, max: number) {\r\n    return Math.min(max, Math.max(min, v));\r\n}", "export function deg2rad(deg: number) {\r\n    return deg * Math.PI / 180;\r\n}", "/**\r\n * Pick a value that is proportionally between two values.\r\n */\r\nexport function lerp(a: number, b: number, p: number) {\r\n    return (1 - p) * a + p * b;\r\n}\r\n", "export function isPowerOf2(v: number) {\r\n    return ((v != 0) && !(v & (v - 1)));\r\n}\r\n\r\nexport function nextPowerOf2(v: number) {\r\n    return Math.pow(2, Math.ceil(Math.log2(v)));\r\n}\r\n\r\nexport function prevPowerOf2(v: number) {\r\n    return Math.pow(2, Math.floor(Math.log2(v)));\r\n}\r\n\r\nexport function closestPowerOf2(v: number) {\r\n    return Math.pow(2, Math.round(Math.log2(v)));\r\n}", "export function rad2deg(rad: number) {\r\n    return rad * 180 / Math.PI;\r\n}\r\n", "export function truncate(v: number): number {\r\n    if (Math.abs(v) > 0.0001) {\r\n        return v;\r\n    }\r\n\r\n    return 0;\r\n}\r\n", "import { arrayClear, TypedEventBase } from \"../\";\r\nimport type { IProgress } from \"./IProgress\";\r\n\r\nexport class BaseProgress<T = void>\r\n    extends TypedEventBase<T>\r\n    implements IProgress {\r\n    private readonly attached = new Array<IProgress>();\r\n    private soFar: number = null;\r\n    private total: number = null;\r\n    private msg: string = null;\r\n    private est: number = null;\r\n\r\n    protected get p() {\r\n        return this.total > 0\r\n            ? this.soFar / this.total\r\n            : 0;\r\n    }\r\n\r\n    report(soFar: number, total: number, msg?: string, est?: number): void {\r\n        this.soFar = soFar;\r\n        this.total = total;\r\n        this.msg = msg;\r\n        this.est = est;\r\n        for (const attach of this.attached) {\r\n            attach.report(soFar, total, msg, est);\r\n        }\r\n    }\r\n\r\n    attach(prog: IProgress): void {\r\n        this.attached.push(prog);\r\n        prog.report(this.soFar, this.total, this.msg, this.est);\r\n    }\r\n\r\n    clear() {\r\n        this.report(0, 0);\r\n        this._clear();\r\n    }\r\n\r\n    start(msg?: string) {\r\n        this.report(0, 1, msg || \"starting\");\r\n    }\r\n\r\n    end(msg?: string) {\r\n        this.report(1, 1, msg || \"done\");\r\n        this._clear();\r\n    }\r\n\r\n    private _clear() {\r\n        this.soFar = null;\r\n        this.total = null;\r\n        this.msg = null;\r\n        this.est = null;\r\n        arrayClear(this.attached);\r\n    }\r\n}", "import type { BaseParentProgressCallback } from \"./BaseParentProgressCallback\";\r\nimport { BaseProgress } from \"./BaseProgress\";\r\n\r\nexport class ChildProgressCallback extends BaseProgress {\r\n    constructor(private readonly i: number, private readonly prog: BaseParentProgressCallback) {\r\n        super();\r\n    }\r\n\r\n    override report(soFar: number, total: number, msg?: string, est?: number) {\r\n        super.report(soFar, total, msg, est);\r\n        this.prog.update(this.i, soFar, total, msg);\r\n    }\r\n}\r\n", "import { ChildProgressCallback } from \"./ChildProgressCallback\";\r\nimport type { IProgress } from \"./IProgress\";\r\n\r\nexport class BaseParentProgressCallback {\r\n    private weightTotal = 0;\r\n    private readonly start: number;\r\n\r\n    readonly subProgressCallbacks = new Array<IProgress>();\r\n    private readonly subProgressWeights = new Array<number>();\r\n    private readonly subProgressValues = new Array<number>();\r\n\r\n    constructor(private readonly prog: IProgress) {\r\n        this.start = performance.now();\r\n\r\n        for (let i = 0; i < this.subProgressWeights.length; ++i) {\r\n            this.subProgressValues[i] = 0;\r\n            this.subProgressCallbacks[i] = new ChildProgressCallback(i, this);\r\n        }\r\n    }\r\n\r\n    protected addSubProgress(weight?: number): IProgress {\r\n        weight = weight || 1;\r\n        this.weightTotal += weight;\r\n        this.subProgressWeights.push(weight);\r\n        this.subProgressValues.push(0);\r\n        const child = new ChildProgressCallback(this.subProgressCallbacks.length, this);\r\n        this.subProgressCallbacks.push(child);\r\n        return child;\r\n    }\r\n\r\n\r\n    update(i: number, subSoFar: number, subTotal: number, msg?: string) {\r\n        if (this.prog) {\r\n            this.subProgressValues[i] = subSoFar / subTotal;\r\n            let soFar = 0;\r\n            for (let j = 0; j < this.subProgressWeights.length; ++j) {\r\n                soFar += this.subProgressValues[j] * this.subProgressWeights[j];\r\n            }\r\n\r\n            const end = performance.now();\r\n            const delta = end - this.start;\r\n            const est = this.start - end + delta * this.weightTotal / soFar;\r\n            this.prog.report(soFar, this.weightTotal, msg, est);\r\n        }\r\n    };\r\n}\r\n", "import { BaseParentProgressCallback } from \"./BaseParentProgressCallback\";\r\nimport { IProgress } from \"./IProgress\";\r\n\r\nexport function progressSplitWeighted(prog: IProgress, subProgressWeights: number[]) {\r\n    const subProg = new WeightedParentProgressCallback(subProgressWeights, prog);\r\n    return subProg.subProgressCallbacks;\r\n}\r\n\r\n\r\nexport function progressSplit(prog: IProgress, taskCount: number) {\r\n    const subProgressWeights = new Array<number>(taskCount);\r\n    for (let i = 0; i < taskCount; ++i) {\r\n        subProgressWeights[i] = 1;\r\n    }\r\n\r\n    return progressSplitWeighted(prog, subProgressWeights);\r\n}\r\n\r\nclass WeightedParentProgressCallback extends BaseParentProgressCallback {\r\n\r\n    constructor(subProgressWeights: number[], prog: IProgress) {\r\n        super(prog);\r\n\r\n        for (const weight of subProgressWeights) {\r\n            this.addSubProgress(weight);\r\n        }\r\n    }\r\n}\r\n", "import { BaseParentProgressCallback } from \"./BaseParentProgressCallback\";\r\nimport { IProgress } from \"./IProgress\";\r\n\r\nexport function progressPopper(progress: IProgress) {\r\n    return new PoppableParentProgressCallback(progress);\r\n}\r\n\r\nexport class PoppableParentProgressCallback extends BaseParentProgressCallback {\r\n    pop(weight?: number) {\r\n        return this.addSubProgress(weight);\r\n    }\r\n}\r\n", "import { IProgress } from \"./IProgress\";\r\nimport { progressSplitWeighted } from \"./progressSplit\";\r\n\r\nexport type subProgressCallback = (prog: IProgress) => Promise<any>;\r\n\r\nexport type TaskDef = [weight: number, task: subProgressCallback];\r\n\r\nexport async function progressTasksWeighted(prog: IProgress, taskDefs: TaskDef[]) {\r\n    const weights = new Array<number>(taskDefs.length);\r\n    const callbacks = new Array<subProgressCallback>(taskDefs.length);\r\n    for (let i = 0; i < taskDefs.length; ++i) {\r\n        const taskDef = taskDefs[i];\r\n        weights[i] = taskDef[0];\r\n        callbacks[i] = taskDef[1];\r\n    }\r\n\r\n    const progs = progressSplitWeighted(prog, weights);\r\n    const tasks = new Array<Promise<any>>(taskDefs.length);\r\n    for (let i = 0; i < taskDefs.length; ++i) {\r\n        tasks[i] = callbacks[i](progs[i]);\r\n    }\r\n\r\n    return await Promise.all(tasks);\r\n}\r\n\r\nexport function progressTasks(prog: IProgress, ...subTaskDef: subProgressCallback[]) {\r\n    const taskDefs = subTaskDef.map<TaskDef>((t) => [1, t]);\r\n    return progressTasksWeighted(prog, taskDefs);\r\n}", "function t(o: any, s: string, c: Function) {\r\n    return typeof o === s\r\n        || o instanceof c;\r\n}\r\n\r\nexport function isFunction(obj: any): obj is Function {\r\n    return t(obj, \"function\", Function);\r\n}\r\n\r\nexport function isString(obj: any): obj is string {\r\n    return t(obj, \"string\", String);\r\n}\r\n\r\nexport function isBoolean(obj: any): obj is boolean {\r\n    return t(obj, \"boolean\", Boolean);\r\n}\r\n\r\nexport function isNumber(obj: any): obj is number {\r\n    return t(obj, \"number\", Number);\r\n}\r\n\r\n/**\r\n * Check a value to see if it is of a number type\r\n * and is not the special NaN value.\r\n */\r\nexport function isGoodNumber(obj: any): obj is number {\r\n    return isNumber(obj)\r\n        && !Number.isNaN(obj);\r\n}\r\n\r\nexport function isObject(obj: any): obj is object {\r\n    return isDefined(obj)\r\n        && t(obj, \"object\", Object);\r\n}\r\n\r\nexport function isPromise<T>(obj: any): obj is Promise<T> {\r\n    return obj instanceof Promise;\r\n}\r\n\r\nexport function isDate(obj: any): obj is Date {\r\n    return obj instanceof Date;\r\n}\r\n\r\nexport function isArray(obj: any): obj is Array<any> {\r\n    return obj instanceof Array;\r\n}\r\n\r\nexport function assertNever(x: never, msg?: string): never {\r\n    throw new Error((msg || \"Unexpected object: \") + x);\r\n}\r\n\r\nexport function isNullOrUndefined<T>(obj: T | null | undefined): obj is null | undefined {\r\n    return obj === null\r\n        || obj === undefined;\r\n}\r\n\r\nexport function isDefined<T>(obj: T | null | undefined): obj is T {\r\n    return !isNullOrUndefined(obj);\r\n}\r\n\r\nexport function isEventListener(obj: EventListenerOrEventListenerObject): obj is EventListener {\r\n    return isFunction(obj);\r\n}\r\n\r\nexport function isEventListenerObject(obj: EventListenerOrEventListenerObject): obj is EventListenerObject {\r\n    return !isEventListener(obj);\r\n}\r\n\r\nexport function isArrayBufferView(obj: any): obj is ArrayBufferView {\r\n    return obj instanceof Uint8Array\r\n        || obj instanceof Uint8ClampedArray\r\n        || obj instanceof Int8Array\r\n        || obj instanceof Uint16Array\r\n        || obj instanceof Int16Array\r\n        || obj instanceof Uint32Array\r\n        || obj instanceof Int32Array\r\n        || obj instanceof Float32Array\r\n        || obj instanceof Float64Array\r\n        || \"BigUint64Array\" in globalThis && obj instanceof globalThis[\"BigUint64Array\"]\r\n        || \"BigInt64Array\" in globalThis && obj instanceof globalThis[\"BigInt64Array\"];\r\n}\r\n\r\nexport function isArrayBuffer(val: any): val is ArrayBuffer {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}", "import { isNullOrUndefined } from \"./typeChecks\";\r\n\r\nexport function singleton<T>(name: string, create?: () => T): T {\r\n    const box = globalThis as any;\r\n    let value = box[name] as T;\r\n    if (isNullOrUndefined(value)) {\r\n        if (isNullOrUndefined(create)) {\r\n            throw new Error(`No value ${name} found`);\r\n        }\r\n        value = create();\r\n        box[name] = value;\r\n    }\r\n    return value;\r\n}", "import { isNullOrUndefined } from \"../\";\r\n\r\nconst DEFAULT_CHAR_SET = \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ\";\r\n\r\nexport function stringRandom(length: number, charSet?: string): string {\r\n    if (length < 0) {\r\n        throw new Error(\"Length must be greater than 0\");\r\n    }\r\n\r\n    if (isNullOrUndefined(charSet)) {\r\n        charSet = DEFAULT_CHAR_SET;\r\n    }\r\n\r\n    let str = \"\";\r\n    for (let i = 0; i < length; ++i) {\r\n        const idx = Math.floor(Math.random() * charSet.length);\r\n        str += charSet[idx];\r\n    }\r\n\r\n    return str;\r\n}", "import { isDefined } from \"../\";\r\n\r\nexport function stringToName(...parts: string[]): string {\r\n    const goodParts = [];\r\n    for (const part of parts) {\r\n        if (isDefined(part)\r\n            && part.length > 0\r\n            && goodParts.indexOf(part) === -1) {\r\n            goodParts.push(part);\r\n        }\r\n    }\r\n\r\n    return goodParts.join(\"-\");\r\n}\r\n", "import { lerp } from \"../\";\r\n\r\nexport abstract class BaseTimerTickEvent {\r\n    t = 0;\r\n    dt = 0;\r\n    sdt = 0;\r\n    fps: number = 0;\r\n\r\n    set(t: number, dt: number) {\r\n        this.t = t;\r\n        this.dt = dt;\r\n        this.sdt = lerp(this.sdt, dt, 0.01);\r\n        if (dt > 0) {\r\n            this.fps = 1000 / dt;\r\n        }\r\n    }\r\n}\r\n\r\nexport class TimerTickEvent extends BaseTimerTickEvent {\r\n    constructor() {\r\n        super();\r\n        Object.seal(this);\r\n    }\r\n}\r\n\r\nexport interface ITimer {\r\n    isRunning: boolean;\r\n    start(): void;\r\n    stop(): void;\r\n    restart(): void;\r\n    addTickHandler(onTick: (evt: TimerTickEvent) => void): void;\r\n    removeTickHandler(onTick: (evt: TimerTickEvent) => void): void;\r\n}\r\n", "import { arrayRemove } from \"../\";\r\nimport { ITimer, TimerTickEvent } from \"./ITimer\";\r\n\r\nexport abstract class BaseTimer<TimerT>\r\n    implements ITimer {\r\n    protected timer: TimerT = null;\r\n    protected onTick: (t: number) => void;\r\n    private lt: number = -1;\r\n    private tickHandlers = new Array<(evt: TimerTickEvent) => void>();\r\n\r\n    constructor(targetFrameRate?: number) {\r\n        this.targetFPS = targetFrameRate;\r\n        const tickEvt = new TimerTickEvent();\r\n        let dt = 0;\r\n        this.onTick = (t: number) => {\r\n            if (this.lt >= 0) {\r\n                dt = t - this.lt;\r\n                tickEvt.set(t, dt);\r\n                this.tick(tickEvt);\r\n            }\r\n            this.lt = t;\r\n        };\r\n    }\r\n\r\n\r\n    private _targetFPS: number = null;\r\n    get targetFPS() {\r\n        return this._targetFPS;\r\n    }\r\n\r\n    set targetFPS(v: number) {\r\n        this._targetFPS = v;\r\n    }\r\n\r\n    addTickHandler(onTick: (evt: TimerTickEvent) => void): void {\r\n        this.tickHandlers.push(onTick);\r\n    }\r\n\r\n    removeTickHandler(onTick: (evt: TimerTickEvent) => void): void {\r\n        arrayRemove(this.tickHandlers, onTick);\r\n    }\r\n\r\n    private tick(evt: TimerTickEvent): void {\r\n        for (const handler of this.tickHandlers) {\r\n            handler(evt);\r\n        }\r\n    }\r\n\r\n    restart() {\r\n        this.stop();\r\n        this.start();\r\n    }\r\n\r\n    get isRunning() {\r\n        return this.timer != null;\r\n    }\r\n\r\n    abstract start(): void;\r\n\r\n    stop() {\r\n        this.timer = null;\r\n        this.lt = -1;\r\n    }\r\n\r\n    protected get targetFrameTime() {\r\n        return 1000 / this.targetFPS;\r\n    }\r\n}", "import { BaseTimer } from \"./BaseTimer\";\r\n\r\nexport class SetTimeoutTimer extends BaseTimer<number> {\r\n\r\n    constructor(targetFrameRate: number) {\r\n        super(targetFrameRate);\r\n    }\r\n\r\n    start() {\r\n        const updater = () => {\r\n            this.timer = setTimeout(updater, this.targetFrameTime) as any as number;\r\n            this.onTick(performance.now());\r\n        };\r\n        this.timer = setTimeout(updater, this.targetFrameTime) as any as number;\r\n    }\r\n\r\n    override stop() {\r\n        if (this.isRunning) {\r\n            clearTimeout(this.timer);\r\n            super.stop();\r\n        }\r\n    }\r\n}\r\n", "export function mapInvert<T, U>(map: Map<T, U>): Map<U, T> {\r\n    const mapOut = new Map<U, T>();\r\n    for (const [key, value] of map) {\r\n        mapOut.set(value, key);\r\n    }\r\n    return mapOut;\r\n}\r\n\r\n", "import { mapInvert } from \"../collections/mapInvert\";\r\nimport { assertNever } from \"../typeChecks\";\r\n\r\ntype Base = 2 | 10;\r\n\r\ntype Base2Units = \"KiB\"\r\n    | \"MiB\"\r\n    | \"GiB\"\r\n    | \"TiB\";\r\n\r\ntype Base10Units = \"KB\"\r\n    | \"MB\"\r\n    | \"GB\"\r\n    | \"TB\";\r\n\r\ntype Units = \"B\"\r\n    | Base2Units\r\n    | Base10Units;\r\n\r\nfunction isBase2Units(label: Units): label is Base2Units {\r\n    return label !== \"B\"\r\n        && label[1] === 'i';\r\n}\r\n\r\nfunction isBase10Units(label: Units): label is Base10Units {\r\n    return label !== \"B\"\r\n        && !isBase10Units(label);\r\n}\r\n\r\nconst base2Labels = new Map<number, Base2Units>([\r\n    [1, \"KiB\"],\r\n    [2, \"MiB\"],\r\n    [3, \"GiB\"],\r\n    [4, \"TiB\"]\r\n]);\r\n\r\nconst base10Labels = new Map<number, Base10Units>([\r\n    [1, \"KB\"],\r\n    [2, \"MB\"],\r\n    [3, \"GB\"],\r\n    [4, \"TB\"]\r\n]);\r\n\r\nconst base2Sizes = mapInvert(base2Labels);\r\nconst base10Sizes = mapInvert(base10Labels);\r\n\r\nconst labels = new Map<Base, Map<number, Units>>([\r\n    [2, base2Labels],\r\n    [10, base10Labels]\r\n]);\r\n\r\nexport function formatBytes(value: number, base: 2 | 10 = 10) {\r\n    const isNegative = value < 0;\r\n    value = Math.abs(value);\r\n\r\n    const systemBase = base === 2 ? 1024 : 1000;\r\n    let size = Math.min(4, Math.floor(Math.log(value) / Math.log(systemBase)));\r\n    let divisor = Math.pow(systemBase, size);\r\n    if (2 * value >= systemBase * divisor && size < 4) {\r\n        size++;\r\n        divisor *= systemBase;\r\n    }\r\n\r\n    let label: string;\r\n    if (size === 0) {\r\n        label = \"B\";\r\n    }\r\n    else {\r\n        const levels = labels.get(base);\r\n        label = levels.get(size);\r\n        value /= divisor;\r\n    }\r\n\r\n    const isExact = (value % 1) === 0;\r\n    const str = `${isNegative ? \"-\" : \"\"}${value.toFixed(isExact ? 0 : 2)} ${label}`;\r\n\r\n    return str;\r\n}\r\n\r\nexport function toBytes(value: number, units: Units): number {\r\n    if (units === \"B\") {\r\n        return value;\r\n    }\r\n    else {\r\n        let systemBase: number;\r\n        let size: number;\r\n        if (isBase2Units(units)) {\r\n            systemBase = 1024;\r\n            size = base2Sizes.get(units);\r\n        }\r\n        else if (isBase10Units(units)) {\r\n            systemBase = 1000;\r\n            size = base10Sizes.get(units);\r\n        }\r\n        else {\r\n            assertNever(units);\r\n        }\r\n\r\n        const multiplier = Math.pow(systemBase, size);\r\n        return value * multiplier;\r\n    }\r\n}", "const MICROMETERS_PER_MILLIMETER = 1000;\r\nconst MILLIMETERS_PER_CENTIMETER = 10;\r\nconst CENTIMETERS_PER_INCH = 2.54;\r\nconst CENTIMETERS_PER_METER = 100;\r\nconst INCHES_PER_HAND = 4;\r\nconst HANDS_PER_FOOT = 3;\r\nconst FEET_PER_YARD = 3;\r\nconst FEET_PER_ROD = 16.5;\r\nconst METERS_PER_KILOMETER = 1000;\r\nconst RODS_PER_FURLONG = 40;\r\nconst FURLONGS_PER_MILE = 8;\r\n\r\nconst MICROMETERS_PER_CENTIMETER = MICROMETERS_PER_MILLIMETER * MILLIMETERS_PER_CENTIMETER;\r\nconst MICROMETERS_PER_INCH = MICROMETERS_PER_CENTIMETER * CENTIMETERS_PER_INCH;\r\nconst MICROMETERS_PER_HAND = MICROMETERS_PER_INCH * INCHES_PER_HAND;\r\nconst MICROMETERS_PER_FOOT = MICROMETERS_PER_HAND * HANDS_PER_FOOT;\r\nconst MICROMETERS_PER_YARD = MICROMETERS_PER_FOOT * FEET_PER_YARD;\r\nconst MICROMETERS_PER_METER = MICROMETERS_PER_CENTIMETER * CENTIMETERS_PER_METER;\r\nconst MICROMETERS_PER_ROD = MICROMETERS_PER_FOOT * FEET_PER_ROD;\r\nconst MICROMETERS_PER_FURLONG = MICROMETERS_PER_ROD * RODS_PER_FURLONG;\r\nconst MICROMETERS_PER_KILOMETER = MICROMETERS_PER_METER * METERS_PER_KILOMETER;\r\nconst MICROMETERS_PER_MILE = MICROMETERS_PER_FURLONG * FURLONGS_PER_MILE;\r\n\r\nconst MILLIMETERS_PER_INCH = MILLIMETERS_PER_CENTIMETER * CENTIMETERS_PER_INCH;\r\nconst MILLIMETERS_PER_HAND = MILLIMETERS_PER_INCH * INCHES_PER_HAND;\r\nconst MILLIMETERS_PER_FOOT = MILLIMETERS_PER_HAND * HANDS_PER_FOOT;\r\nconst MILLIMETERS_PER_YARD = MILLIMETERS_PER_FOOT * FEET_PER_YARD;\r\nconst MILLIMETERS_PER_METER = MILLIMETERS_PER_CENTIMETER * CENTIMETERS_PER_METER;\r\nconst MILLIMETERS_PER_ROD = MILLIMETERS_PER_FOOT * FEET_PER_ROD;\r\nconst MILLIMETERS_PER_FURLONG = MILLIMETERS_PER_ROD * RODS_PER_FURLONG;\r\nconst MILLIMETERS_PER_KILOMETER = MILLIMETERS_PER_METER * METERS_PER_KILOMETER;\r\nconst MILLIMETERS_PER_MILE = MILLIMETERS_PER_FURLONG * FURLONGS_PER_MILE;\r\n\r\nconst CENTIMETERS_PER_HAND = CENTIMETERS_PER_INCH * INCHES_PER_HAND;\r\nconst CENTIMETERS_PER_FOOT = CENTIMETERS_PER_HAND * HANDS_PER_FOOT;\r\nconst CENTIMETERS_PER_YARD = CENTIMETERS_PER_FOOT * FEET_PER_YARD;\r\nconst CENTIMETERS_PER_ROD = CENTIMETERS_PER_FOOT * FEET_PER_ROD;\r\nconst CENTIMETERS_PER_FURLONG = CENTIMETERS_PER_ROD * RODS_PER_FURLONG;\r\nconst CENTIMETERS_PER_KILOMETER = CENTIMETERS_PER_METER * METERS_PER_KILOMETER;\r\nconst CENTIMETERS_PER_MILE = CENTIMETERS_PER_FURLONG * FURLONGS_PER_MILE;\r\n\r\nconst INCHES_PER_FOOT = INCHES_PER_HAND * HANDS_PER_FOOT;\r\nconst INCHES_PER_YARD = INCHES_PER_FOOT * FEET_PER_YARD;\r\nconst INCHES_PER_METER = CENTIMETERS_PER_METER / CENTIMETERS_PER_INCH;\r\nconst INCHES_PER_ROD = INCHES_PER_FOOT * FEET_PER_ROD;\r\nconst INCHES_PER_FURLONG = INCHES_PER_ROD * RODS_PER_FURLONG;\r\nconst INCHES_PER_KILOMETER = INCHES_PER_METER * METERS_PER_KILOMETER;\r\nconst INCHES_PER_MILE = INCHES_PER_FURLONG * FURLONGS_PER_MILE;\r\n\r\nconst HANDS_PER_YARD = HANDS_PER_FOOT * FEET_PER_YARD;\r\nconst HANDS_PER_METER = CENTIMETERS_PER_METER / CENTIMETERS_PER_HAND;\r\nconst HANDS_PER_ROD = HANDS_PER_FOOT * FEET_PER_ROD;\r\nconst HANDS_PER_FURLONG = HANDS_PER_ROD * RODS_PER_FURLONG;\r\nconst HANDS_PER_KILOMETER = HANDS_PER_METER * METERS_PER_KILOMETER;\r\nconst HANDS_PER_MILE = HANDS_PER_FURLONG * FURLONGS_PER_MILE;\r\n\r\nconst FEET_PER_METER = INCHES_PER_METER / INCHES_PER_FOOT;\r\nconst FEET_PER_FURLONG = FEET_PER_ROD * RODS_PER_FURLONG;\r\nconst FEET_PER_KILOMETER = FEET_PER_METER * METERS_PER_KILOMETER;\r\nconst FEET_PER_MILE = FEET_PER_FURLONG * FURLONGS_PER_MILE;\r\n\r\nconst YARDS_PER_METER = INCHES_PER_METER / INCHES_PER_YARD;\r\nconst YARDS_PER_ROD = FEET_PER_ROD / FEET_PER_YARD;\r\nconst YARDS_PER_FURLONG = YARDS_PER_ROD * RODS_PER_FURLONG;\r\nconst YARDS_PER_KILOMETER = YARDS_PER_METER * METERS_PER_KILOMETER;\r\nconst YARDS_PER_MILE = YARDS_PER_FURLONG * FURLONGS_PER_MILE;\r\n\r\nconst METERS_PER_ROD = FEET_PER_ROD / FEET_PER_METER;\r\nconst METERS_PER_FURLONG = METERS_PER_ROD * RODS_PER_FURLONG;\r\nconst METERS_PER_MILE = METERS_PER_FURLONG * FURLONGS_PER_MILE;\r\n\r\nconst RODS_PER_KILOMETER = METERS_PER_KILOMETER / METERS_PER_ROD;\r\nconst RODS_PER_MILE = RODS_PER_FURLONG * FURLONGS_PER_MILE;\r\n\r\nconst FURLONGS_PER_KILOMETER = METERS_PER_KILOMETER /METERS_PER_FURLONG;\r\n\r\nconst KILOMETERS_PER_MILE = FURLONGS_PER_MILE / FURLONGS_PER_KILOMETER;\r\n\r\n\r\nexport function centimeters2Micrometers(centimeters: number): number {\r\n    return centimeters * MICROMETERS_PER_CENTIMETER;\r\n}\r\n\r\nexport function centimeters2Millimeters(centimeters: number): number {\r\n    return centimeters * MILLIMETERS_PER_CENTIMETER;\r\n}\r\n\r\nexport function centimeters2Inches(centimeters: number): number {\r\n    return centimeters / CENTIMETERS_PER_INCH;\r\n}\r\n\r\nexport function centimeters2Hands(centimeters: number): number {\r\n    return centimeters / CENTIMETERS_PER_HAND;\r\n}\r\n\r\nexport function centimeters2Feet(centimeters: number): number {\r\n    return centimeters / CENTIMETERS_PER_FOOT;\r\n}\r\n\r\nexport function centimeters2Yards(centimeters: number): number {\r\n    return centimeters / CENTIMETERS_PER_YARD;\r\n}\r\n\r\nexport function centimeters2Meters(centimeters: number): number {\r\n    return centimeters / CENTIMETERS_PER_METER;\r\n}\r\n\r\nexport function centimeters2Rods(centimeters: number): number {\r\n    return centimeters / CENTIMETERS_PER_ROD;\r\n}\r\n\r\nexport function centimeters2Furlongs(centimeters: number): number {\r\n    return centimeters / CENTIMETERS_PER_FURLONG;\r\n}\r\n\r\nexport function centimeters2Kilometers(centimeters: number): number {\r\n    return centimeters / CENTIMETERS_PER_KILOMETER;\r\n}\r\n\r\nexport function centimeters2Miles(centimeters: number): number {\r\n    return centimeters / CENTIMETERS_PER_MILE;\r\n}\r\n\r\nexport function feet2Micrometers(feet: number): number {\r\n    return feet * MICROMETERS_PER_FOOT;\r\n}\r\n\r\nexport function feet2Millimeters(feet: number): number {\r\n    return feet * MILLIMETERS_PER_FOOT;\r\n}\r\n\r\nexport function feet2Centimeters(feet: number): number {\r\n    return feet * CENTIMETERS_PER_FOOT;\r\n}\r\n\r\nexport function feet2Inches(feet: number): number {\r\n    return feet * INCHES_PER_FOOT;\r\n}\r\n\r\nexport function feet2Hands(feet: number): number {\r\n    return feet * HANDS_PER_FOOT;\r\n}\r\n\r\nexport function feet2Yards(feet: number): number {\r\n    return feet / FEET_PER_YARD;\r\n}\r\n\r\nexport function feet2Meters(feet: number): number {\r\n    return feet / FEET_PER_METER;\r\n}\r\n\r\nexport function feet2Rods(feet: number): number {\r\n    return feet / FEET_PER_ROD;\r\n}\r\n\r\nexport function feet2Furlongs(feet: number): number {\r\n    return feet / FEET_PER_FURLONG;\r\n}\r\n\r\nexport function feet2Kilometers(feet: number): number {\r\n    return feet / FEET_PER_KILOMETER;\r\n}\r\n\r\nexport function feet2Miles(feet: number): number {\r\n    return feet / FEET_PER_MILE;\r\n}\r\n\r\nexport function furlongs2Micrometers(furlongs: number): number {\r\n    return furlongs * MICROMETERS_PER_FURLONG;\r\n}\r\n\r\nexport function furlongs2Millimeters(furlongs: number): number {\r\n    return furlongs * MILLIMETERS_PER_FURLONG;\r\n}\r\n\r\nexport function furlongs2Centimeters(furlongs: number): number {\r\n    return furlongs * CENTIMETERS_PER_FURLONG;\r\n}\r\n\r\nexport function furlongs2Inches(furlongs: number): number {\r\n    return furlongs * INCHES_PER_FURLONG;\r\n}\r\n\r\nexport function furlongs2Hands(furlongs: number): number {\r\n    return furlongs * HANDS_PER_FURLONG;\r\n}\r\n\r\nexport function furlongs2Feet(furlongs: number): number {\r\n    return furlongs * FEET_PER_FURLONG;\r\n}\r\n\r\nexport function furlongs2Yards(furlongs: number): number {\r\n    return furlongs * YARDS_PER_FURLONG;\r\n}\r\n\r\nexport function furlongs2Meters(furlongs: number): number {\r\n    return furlongs * METERS_PER_FURLONG;\r\n}\r\n\r\nexport function furlongs2Rods(furlongs: number): number {\r\n    return furlongs * RODS_PER_FURLONG;\r\n}\r\n\r\nexport function furlongs2Kilometers(furlongs: number): number {\r\n    return furlongs / FURLONGS_PER_KILOMETER;\r\n}\r\n\r\nexport function furlongs2Miles(furlongs: number): number {\r\n    return furlongs / FURLONGS_PER_MILE;\r\n}\r\n\r\nexport function hands2Micrometers(hands: number): number {\r\n    return hands * MICROMETERS_PER_HAND;\r\n}\r\n\r\nexport function hands2Millimeters(hands: number): number {\r\n    return hands * MILLIMETERS_PER_HAND;\r\n}\r\n\r\nexport function hands2Centimeters(hands: number): number {\r\n    return hands * CENTIMETERS_PER_HAND;\r\n}\r\n\r\nexport function hands2Inches(hands: number): number {\r\n    return hands * INCHES_PER_HAND;\r\n}\r\n\r\nexport function hands2Feet(hands: number): number {\r\n    return hands / HANDS_PER_FOOT;\r\n}\r\n\r\nexport function hands2Yards(hands: number): number {\r\n    return hands / HANDS_PER_YARD;\r\n}\r\n\r\nexport function hands2Meters(hands: number): number {\r\n    return hands / HANDS_PER_METER;\r\n}\r\n\r\nexport function hands2Rods(hands: number): number {\r\n    return hands / HANDS_PER_ROD;\r\n}\r\n\r\nexport function hands2Furlongs(hands: number): number {\r\n    return hands / HANDS_PER_FURLONG;\r\n}\r\n\r\nexport function hands2Kilometers(hands: number): number {\r\n    return hands / HANDS_PER_KILOMETER;\r\n}\r\n\r\nexport function hands2Miles(hands: number): number {\r\n    return hands / HANDS_PER_MILE;\r\n}\r\n\r\nexport function inches2Micrometers(inches: number): number {\r\n    return inches * MICROMETERS_PER_INCH;\r\n}\r\n\r\nexport function inches2Millimeters(inches: number): number {\r\n    return inches * MILLIMETERS_PER_INCH;\r\n}\r\n\r\nexport function inches2Centimeters(inches: number): number {\r\n    return inches * CENTIMETERS_PER_INCH;\r\n}\r\n\r\nexport function inches2Hands(inches: number): number {\r\n    return inches / INCHES_PER_HAND;\r\n}\r\n\r\nexport function inches2Feet(inches: number): number {\r\n    return inches / INCHES_PER_FOOT;\r\n}\r\n\r\nexport function inches2Yards(inches: number): number {\r\n    return inches / INCHES_PER_YARD;\r\n}\r\n\r\nexport function inches2Meters(inches: number): number {\r\n    return inches / INCHES_PER_METER;\r\n}\r\n\r\nexport function inches2Rods(inches: number): number {\r\n    return inches / INCHES_PER_ROD;\r\n}\r\n\r\nexport function inches2Furlongs(inches: number): number {\r\n    return inches / INCHES_PER_FURLONG;\r\n}\r\n\r\nexport function inches2Kilometers(inches: number): number {\r\n    return inches / INCHES_PER_KILOMETER;\r\n}\r\n\r\nexport function inches2Miles(inches: number): number {\r\n    return inches / INCHES_PER_MILE;\r\n}\r\n\r\nexport function kilometers2Micrometers(kilometers: number): number {\r\n    return kilometers * MICROMETERS_PER_KILOMETER;\r\n}\r\n\r\nexport function kilometers2Millimeters(kilometers: number): number {\r\n    return kilometers * MILLIMETERS_PER_KILOMETER;\r\n}\r\n\r\nexport function kilometers2Centimeters(kilometers: number): number {\r\n    return kilometers * CENTIMETERS_PER_KILOMETER;\r\n}\r\n\r\nexport function kilometers2Inches(kilometers: number): number {\r\n    return kilometers * INCHES_PER_KILOMETER;\r\n}\r\n\r\nexport function kilometers2Hands(kilometers: number): number {\r\n    return kilometers * HANDS_PER_KILOMETER;\r\n}\r\n\r\nexport function kilometers2Feet(kilometers: number): number {\r\n    return kilometers * FEET_PER_KILOMETER;\r\n}\r\n\r\nexport function kilometers2Yards(kilometers: number): number {\r\n    return kilometers * YARDS_PER_KILOMETER;\r\n}\r\n\r\nexport function kilometers2Meters(kilometers: number): number {\r\n    return kilometers * METERS_PER_KILOMETER;\r\n}\r\n\r\nexport function kilometers2Rods(kilometers: number): number {\r\n    return kilometers * RODS_PER_KILOMETER;\r\n}\r\nexport function kilometers2Furlongs(kilometers: number): number {\r\n    return kilometers * FURLONGS_PER_KILOMETER;\r\n}\r\n\r\nexport function kilometers2Miles(kilometers: number): number {\r\n    return kilometers / KILOMETERS_PER_MILE;\r\n}\r\n\r\nexport function meters2Micrometers(meters: number): number {\r\n    return meters * MICROMETERS_PER_METER;\r\n}\r\n\r\nexport function meters2Millimeters(meters: number): number {\r\n    return meters * MILLIMETERS_PER_METER;\r\n}\r\n\r\nexport function meters2Centimeters(meters: number): number {\r\n    return meters * CENTIMETERS_PER_METER;\r\n}\r\n\r\nexport function meters2Inches(meters: number): number {\r\n    return meters * INCHES_PER_METER;\r\n}\r\n\r\nexport function meters2Hands(meters: number): number {\r\n    return meters * HANDS_PER_METER;\r\n}\r\n\r\nexport function meters2Feet(meters: number): number {\r\n    return meters * FEET_PER_METER;\r\n}\r\n\r\nexport function meters2Yards(meters: number): number {\r\n    return meters * YARDS_PER_METER;\r\n}\r\n\r\nexport function meters2Rods(meters: number): number {\r\n    return meters / METERS_PER_ROD;\r\n}\r\n\r\nexport function meters2Furlongs(meters: number): number {\r\n    return meters / METERS_PER_FURLONG;\r\n}\r\n\r\nexport function meters2Kilometers(meters: number): number {\r\n    return meters / METERS_PER_KILOMETER;\r\n}\r\n\r\nexport function meters2Miles(meters: number): number {\r\n    return meters / METERS_PER_MILE;\r\n}\r\n\r\nexport function micrometers2Millimeters(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_MILLIMETER;\r\n}\r\n\r\nexport function micrometers2Centimeters(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_CENTIMETER;\r\n}\r\n\r\nexport function micrometers2Inches(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_INCH;\r\n}\r\n\r\nexport function micrometers2Hands(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_HAND;\r\n}\r\n\r\nexport function micrometers2Feet(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_FOOT;\r\n}\r\n\r\nexport function micrometers2Yards(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_YARD;\r\n}\r\n\r\nexport function micrometers2Meters(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_METER;\r\n}\r\n\r\nexport function micrometers2Rods(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_ROD;\r\n}\r\n\r\nexport function micrometers2Furlongs(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_FURLONG;\r\n}\r\n\r\nexport function micrometers2Kilometers(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_KILOMETER;\r\n}\r\n\r\nexport function micrometers2Miles(micrometers: number): number {\r\n    return micrometers / MICROMETERS_PER_MILE;\r\n}\r\n\r\nexport function miles2Micrometers(miles: number): number {\r\n    return miles * MICROMETERS_PER_MILE;\r\n}\r\n\r\nexport function miles2Millimeters(miles: number): number {\r\n    return miles * MILLIMETERS_PER_MILE;\r\n}\r\n\r\nexport function miles2Centimeters(miles: number): number {\r\n    return miles * CENTIMETERS_PER_MILE;\r\n}\r\n\r\nexport function miles2Inches(miles: number): number {\r\n    return miles * INCHES_PER_MILE;\r\n}\r\n\r\nexport function miles2Hands(miles: number): number {\r\n    return miles * HANDS_PER_MILE;\r\n}\r\n\r\nexport function miles2Feet(miles: number): number {\r\n    return miles * FEET_PER_MILE;\r\n}\r\n\r\nexport function miles2Yards(miles: number): number {\r\n    return miles * YARDS_PER_MILE;\r\n}\r\n\r\nexport function miles2Meters(miles: number): number {\r\n    return miles * METERS_PER_MILE;\r\n}\r\n\r\nexport function miles2Rods(miles: number): number {\r\n    return miles * RODS_PER_MILE;\r\n}\r\n\r\nexport function miles2Furlongs(miles: number): number {\r\n    return miles * FURLONGS_PER_MILE;\r\n}\r\n\r\nexport function miles2Kilometers(miles: number): number {\r\n    return miles * KILOMETERS_PER_MILE;\r\n}\r\n\r\nexport function millimeters2Micrometers(millimeters: number): number {\r\n    return millimeters * MICROMETERS_PER_MILLIMETER;\r\n}\r\n\r\nexport function millimeters2Centimeters(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_CENTIMETER;\r\n}\r\n\r\nexport function millimeters2Inches(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_INCH;\r\n}\r\n\r\nexport function millimeters2Hands(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_HAND;\r\n}\r\n\r\nexport function millimeters2Feet(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_FOOT;\r\n}\r\n\r\nexport function millimeters2Yards(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_YARD;\r\n}\r\n\r\nexport function millimeters2Meters(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_METER;\r\n}\r\n\r\nexport function millimeters2Rods(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_ROD;\r\n}\r\n\r\nexport function millimeters2Furlongs(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_FURLONG;\r\n}\r\n\r\nexport function millimeters2Kilometers(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_KILOMETER;\r\n}\r\n\r\nexport function millimeters2Miles(millimeters: number): number {\r\n    return millimeters / MILLIMETERS_PER_MILE;\r\n}\r\n\r\nexport function rods2Micrometers(rods: number): number {\r\n    return rods * MICROMETERS_PER_ROD;\r\n}\r\n\r\nexport function rods2Millimeters(rods: number): number {\r\n    return rods * MILLIMETERS_PER_ROD;\r\n}\r\n\r\nexport function rods2Centimeters(rods: number): number {\r\n    return rods * CENTIMETERS_PER_ROD;\r\n}\r\n\r\nexport function rods2Inches(rods: number): number {\r\n    return rods * INCHES_PER_ROD;\r\n}\r\n\r\nexport function rods2Hands(rods: number): number {\r\n    return rods * HANDS_PER_ROD;\r\n}\r\n\r\nexport function rods2Feet(rods: number): number {\r\n    return rods * FEET_PER_ROD;\r\n}\r\n\r\nexport function rods2Yards(rods: number): number {\r\n    return rods * YARDS_PER_ROD;\r\n}\r\n\r\nexport function rods2Meters(rods: number): number {\r\n    return rods * METERS_PER_ROD;\r\n}\r\n\r\nexport function rods2Furlongs(rods: number): number {\r\n    return rods / RODS_PER_FURLONG;\r\n}\r\n\r\nexport function rods2Kilometers(rods: number): number {\r\n    return rods / RODS_PER_KILOMETER;\r\n}\r\n\r\nexport function rods2Miles(rods: number): number {\r\n    return rods / RODS_PER_MILE;\r\n}\r\n\r\nexport function yards2Micrometers(yards: number): number {\r\n    return yards * MICROMETERS_PER_YARD;\r\n}\r\n\r\nexport function yards2Millimeters(yards: number): number {\r\n    return yards * MILLIMETERS_PER_YARD;\r\n}\r\n\r\nexport function yards2Centimeters(yards: number): number {\r\n    return yards * CENTIMETERS_PER_YARD;\r\n}\r\n\r\nexport function yards2Inches(yards: number): number {\r\n    return yards * INCHES_PER_YARD;\r\n}\r\n\r\nexport function yards2Hands(yards: number): number {\r\n    return yards * HANDS_PER_YARD;\r\n}\r\n\r\nexport function yards2Feet(yards: number): number {\r\n    return yards * FEET_PER_YARD;\r\n}\r\n\r\nexport function yards2Meters(yards: number): number {\r\n    return yards / YARDS_PER_METER;\r\n}\r\n\r\nexport function yards2Rods(yards: number): number {\r\n    return yards / YARDS_PER_ROD;\r\n}\r\n\r\nexport function yards2Furlongs(yards: number): number {\r\n    return yards / YARDS_PER_FURLONG;\r\n}\r\n\r\nexport function yards2Kilometers(yards: number): number {\r\n    return yards / YARDS_PER_KILOMETER;\r\n}\r\n\r\nexport function yards2Miles(yards: number): number {\r\n    return yards / YARDS_PER_MILE;\r\n}", "import { isDefined } from \"./typeChecks\";\r\n\r\ntype ProtocolType = `${string}:`;\r\n\r\nfunction parsePort(portString: string): number {\r\n    if (isDefined(portString) && portString.length > 0) {\r\n        return parseFloat(portString);\r\n    }\r\n    return null;\r\n}\r\n\r\nexport class URLBuilder {\r\n    private _url: URL = null;\r\n    private _base: string | URL = undefined;\r\n    private _protocol: string = null\r\n    private _host: string = null;\r\n    private _hostName: string = null;\r\n    private _userName: string = null;\r\n    private _password: string = null;\r\n    private _port: number = null;\r\n    private _pathName: string = null;\r\n    private _hash: string = null;\r\n    private readonly _query = new Map<string, string>();\r\n\r\n    constructor(url?: string | URL, base?: string | URL) {\r\n        if (url !== undefined) {\r\n            this._url = new URL(url, base);\r\n            this.rehydrate();\r\n        }\r\n    }\r\n\r\n    private rehydrate(): void {\r\n        if (isDefined(this._protocol) && this._protocol !== this._url.protocol) {\r\n            this._url.protocol = this._protocol;\r\n        }\r\n\r\n        if (isDefined(this._host) && this._host !== this._url.host) {\r\n            this._url.host = this._host;\r\n        }\r\n\r\n        if (isDefined(this._hostName) && this._hostName !== this._url.hostname) {\r\n            this._url.hostname = this._hostName;\r\n        }\r\n\r\n        if (isDefined(this._userName) && this._userName !== this._url.username) {\r\n            this._url.username = this._userName;\r\n        }\r\n\r\n        if (isDefined(this._password) && this._password !== this._url.password) {\r\n            this._url.password = this._password;\r\n        }\r\n\r\n        if (isDefined(this._port) && this._port.toFixed(0) !== this._url.port) {\r\n            this._url.port = this._port.toFixed(0);\r\n        }\r\n\r\n        if (isDefined(this._pathName) && this._pathName !== this._url.pathname) {\r\n            this._url.pathname = this._pathName;\r\n        }\r\n\r\n        if (isDefined(this._hash) && this._hash !== this._url.hash) {\r\n            this._url.hash = this._hash;\r\n        }\r\n\r\n        for (const [k, v] of this._query) {\r\n            this._url.searchParams.set(k, v);\r\n        }\r\n\r\n        this._protocol = this._url.protocol;\r\n        this._host = this._url.host;\r\n        this._hostName = this._url.hostname;\r\n        this._userName = this._url.username;\r\n        this._password = this._url.password;\r\n        this._port = parsePort(this._url.port);\r\n        this._pathName = this._url.pathname;\r\n        this._hash = this._url.hash;\r\n        this._url.searchParams.forEach((v, k) =>\r\n            this._query.set(k, v));\r\n    }\r\n\r\n    private refresh(): boolean {\r\n        if (this._url === null) {\r\n            if (isDefined(this._protocol)\r\n                && (isDefined(this._host) || isDefined(this._hostName))) {\r\n                if (isDefined(this._host)) {\r\n                    this._url = new URL(`${this._protocol}//${this._host}`, this._base);\r\n                    this._port = parsePort(this._url.port);\r\n                    this.rehydrate();\r\n                    return false;\r\n                }\r\n                else if (isDefined(this._hostName)) {\r\n                    this._url = new URL(`${this._protocol}//${this._hostName}`, this._base);\r\n                    this.rehydrate();\r\n                    return false;\r\n                }\r\n            }\r\n            else if (isDefined(this._pathName) && isDefined(this._base)) {\r\n                this._url = new URL(this._pathName, this._base);\r\n                this.rehydrate();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return isDefined(this._url);\r\n    }\r\n\r\n    base(base: string | URL) {\r\n        if (this._url !== null) {\r\n            throw new Error(\"Cannot redefine base after defining the protocol and domain\")\r\n        }\r\n\r\n        this._base = base;\r\n        this.refresh();\r\n        return this;\r\n    }\r\n\r\n    protocol(protocol: ProtocolType) {\r\n        this._protocol = protocol;\r\n        if (this.refresh()) {\r\n            this._url.protocol = protocol;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    host(host: string) {\r\n        this._host = host;\r\n        if (this.refresh()) {\r\n            this._url.host = host;\r\n            this._hostName = this._url.hostname;\r\n            this._port = parsePort(this._url.port);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    hostName(hostName: string) {\r\n        this._hostName = hostName;\r\n        if (this.refresh()) {\r\n            this._url.hostname = hostName;\r\n            this._host = `${this._url.hostname}:${this._url.port}`;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    port(port: number) {\r\n        this._port = port;\r\n        if (this.refresh()) {\r\n            this._url.port = port.toFixed(0);\r\n            this._host = `${this._url.hostname}:${this._url.port}`;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    userName(userName: string) {\r\n        this._userName = userName;\r\n        if (this.refresh()) {\r\n            this._url.username = userName;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    password(password: string) {\r\n        this._password = password;\r\n        if (this.refresh()) {\r\n            this._url.password = password;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    path(path: string) {\r\n        this._pathName = path;\r\n        if (this.refresh()) {\r\n            this._url.pathname = path;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    pathPop(pattern?: RegExp) {\r\n        pattern = pattern || /\\/[^\\/]+\\/?$/;\r\n        return this.path(this._pathName.replace(pattern, \"\"));\r\n    }\r\n\r\n    pathPush(part: string) {\r\n        let path = this._pathName;\r\n        if (!path.endsWith('/')) {\r\n            path += '/';\r\n        }\r\n\r\n        path += part;\r\n\r\n        return this.path(path);\r\n    }\r\n\r\n    query(name: string, value: string) {\r\n        this._query.set(name, value);\r\n        if (this.refresh()) {\r\n            this._url.searchParams.set(name, value);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    hash(hash: string) {\r\n        this._hash = hash;\r\n        if (this.refresh()) {\r\n            this._url.hash = hash;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    toURL() {\r\n        return this._url;\r\n    }\r\n\r\n    toString() {\r\n        return this._url.href;\r\n    }\r\n\r\n    [Symbol.toStringTag]() {\r\n        return this.toString();\r\n    }\r\n}", "import { isDefined, isFunction, isObject } from \"./typeChecks\";\r\n\r\nexport interface IDisposable {\r\n    dispose(): void;\r\n}\r\n\r\nexport interface IClosable {\r\n    close(): void;\r\n}\r\n\r\nexport interface ICloneable {\r\n    clone(): unknown;\r\n}\r\n\r\nexport interface IDestroyable {\r\n    destroy(): void;\r\n}\r\n\r\nfunction interfaceSigCheck<T>(obj: any, ...funcNames: string[]): obj is T {\r\n    if (!isObject(obj)) {\r\n        return false;\r\n    }\r\n\r\n    obj = obj as any;\r\n\r\n    for (const funcName of funcNames) {\r\n        if (!(funcName in obj)) {\r\n            return false;\r\n        }\r\n\r\n        const func = obj[funcName];\r\n        if (!isFunction(func)) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport function isDisposable(obj: any): obj is IDisposable {\r\n    return interfaceSigCheck(obj, \"dispose\");\r\n}\r\n\r\nexport function isDestroyable(obj: any): obj is IDestroyable {\r\n    return interfaceSigCheck(obj, \"destroy\");\r\n}\r\n\r\nexport function isClosable(obj: any): obj is IClosable {\r\n    return interfaceSigCheck(obj, \"close\");\r\n}\r\n\r\nexport function isCloneable(obj: any): obj is ICloneable {\r\n    return interfaceSigCheck(obj, \"clone\");\r\n}\r\n\r\nexport function dispose(val: any): void {\r\n    if (isDisposable(val)) {\r\n        val.dispose();\r\n    }\r\n\r\n    if (isClosable(val)) {\r\n        val.close();\r\n    }\r\n\r\n    if (isDestroyable(val)) {\r\n        val.destroy();\r\n    }\r\n}\r\n\r\ntype Cleanupable = IDisposable | IClosable | IDestroyable;\r\n\r\nexport function using<T extends Cleanupable, U>(val: T, thunk: (val: T) => U): U {\r\n    try {\r\n        return thunk(val);\r\n    } finally {\r\n        dispose(val);\r\n    }\r\n}\r\n\r\nexport function usingArray<T extends Cleanupable, U>(vals: T[], thunk: (val: T[]) => U): U {\r\n    try {\r\n        return thunk(vals);\r\n    } finally {\r\n        if (isDefined(vals)) {\r\n            for (const val of vals) {\r\n                dispose(val);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport async function usingAsync<T extends Cleanupable, U>(val: T, thunk: (val: T) => Promise<U>): Promise<U> {\r\n    try {\r\n        return await thunk(val);\r\n    } finally {\r\n        dispose(val);\r\n    }\r\n}\r\n\r\n\r\nexport async function usingArrayAsync<T extends Cleanupable, U>(vals: T[], thunk: (val: T[]) => Promise<U>): Promise<U> {\r\n    try {\r\n        return await thunk(vals);\r\n    } finally {\r\n        if (isDefined(vals)) {\r\n            for (const val of vals) {\r\n                dispose(val);\r\n            }\r\n        }\r\n    }\r\n}", "import type { MediaType } from \"@juniper-lib/mediatypes\";\r\nimport { isBoolean, isString } from \"@juniper-lib/tslib\";\r\n\r\n/**\r\n * A setter functor for HTML attributes.\r\n **/\r\nexport class Attr {\r\n    readonly tags: readonly string[];\r\n    /**\r\n     * Creates a new setter functor for HTML Attributes\r\n     * @param key - the attribute name.\r\n     * @param value - the value to set for the attribute.\r\n     * @param tags - the HTML tags that support this attribute.\r\n     */\r\n    constructor(\r\n        public readonly key: string,\r\n        public readonly value: any,\r\n        private readonly bySetAttribute: boolean,\r\n        ...tags: string[]) {\r\n        this.tags = tags.map((t) => t.toLocaleUpperCase());\r\n        Object.freeze(this);\r\n    }\r\n\r\n    /**\r\n     * Set the attribute value on an HTMLElement\r\n     * @param elem - the element on which to set the attribute.\r\n     */\r\n    applyToElement(elem: HTMLElement) {\r\n        const isDataSet = this.key.startsWith(\"data-\");\r\n        const isValid = this.tags.length === 0\r\n            || this.tags.indexOf(elem.tagName) > -1\r\n            || isDataSet;\r\n\r\n        if (!isValid) {\r\n            console.warn(`Element ${elem.tagName} does not support Attribute ${this.key}`);\r\n        }\r\n        else if (isDataSet) {\r\n            const subkey = this.key.substring(5);\r\n            elem.dataset[subkey] = this.value;\r\n        }\r\n        else if (this.key === \"style\") {\r\n            Object.assign(elem.style, this.value);\r\n        }\r\n        else if (this.key === \"classList\") {\r\n            (this.value as string[])\r\n                .forEach((v) => elem.classList.add(v));\r\n        }\r\n        else if (this.bySetAttribute) {\r\n            elem.setAttribute(this.key, this.value);\r\n        }\r\n        else if (this.key in elem) {\r\n            (elem as any)[this.key] = this.value;\r\n        }\r\n        else if (this.value === false) {\r\n            elem.removeAttribute(this.key);\r\n        }\r\n        else if (this.value === true) {\r\n            elem.setAttribute(this.key, \"\");\r\n        }\r\n        else {\r\n            elem.setAttribute(this.key, this.value);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * a list of types the server accepts, typically a file type.\r\n * @param value - the value to set on the attribute.\r\n **/\r\nexport function accept(value: string) { return new Attr(\"accept\", value, false, \"form\", \"input\"); }\r\n\r\n/**\r\n * The accessKey attribute\r\n **/\r\nexport function accessKey(value: string) { return new Attr(\"accessKey\", value, false, \"input\", \"button\"); }\r\n\r\n/**\r\n * specifying the horizontal alignment of the element.\r\n **/\r\nexport function align(value: string) { return new Attr(\"align\", value, false, \"applet\", \"caption\", \"col\", \"colgroup\", \"hr\", \"iframe\", \"img\", \"table\", \"tbody\", \"td\", \"tfoot\", \"th\", \"thead\", \"tr\"); }\r\n\r\n/**\r\n * Specifies a feature-policy for the iframe.\r\n **/\r\nexport function allow(value: string) { return new Attr(\"allow\", value, false, \"iframe\"); }\r\n\r\n/**\r\n * Whether or not to allow an IFrame to open full screen elements.\r\n */\r\nexport function allowFullscreen(value: boolean) { return new Attr(\"allowfullscreen\", value, false, \"iframe\"); }\r\n\r\n/**\r\n * Alternative text in case an image can't be displayed.\r\n **/\r\nexport function alt(value: string) { return new Attr(\"alt\", value, false, \"applet\", \"area\", \"img\", \"input\"); }\r\n\r\n/**\r\n * Identifies the currently active element when DOM focus is on a composite widget, textbox, group, or application.\r\n **/\r\nexport function ariaActiveDescendant(value: string) { return new Attr(\"ariaActiveDescendant\", value, false); }\r\n\r\n/**\r\n * Indicates whether assistive technologies will present all, or only parts of, the changed region based on the change notifications defined by the aria-relevant attribute.\r\n **/\r\nexport function ariaAtomic(value: boolean) { return new Attr(\"ariaAtomic\", value, false); }\r\n\r\n/**\r\n * Indicates whether inputting text could trigger display of one or more predictions of the user's intended value for an input and specifies how predictions would be presented if they are made.\r\n **/\r\nexport function ariaAutoComplete(value: string) { return new Attr(\"ariaAutoComplete\", value, false); }\r\n\r\n/**\r\n * Indicates an element is being modified and that assistive technologies MAY want to wait until the modifications are complete before exposing them to the user.\r\n **/\r\nexport function ariaBusy(value: boolean) { return new Attr(\"ariaBusy\", value, false); }\r\n\r\n/**\r\n * Indicates the current \"checked\" state of checkboxes, radio buttons, and other widgets. See related aria-pressed and aria-selected.\r\n **/\r\nexport function ariaChecked(value: boolean) { return new Attr(\"ariaChecked\", value, false); }\r\n\r\n/**\r\n * Defines the total number of columns in a table, grid, or treegrid. See related aria-colindex.\r\n  **/\r\nexport function ariaColCount(value: number) { return new Attr(\"ariaColCount\", value, false); }\r\n\r\n/**\r\n * Defines an element's column index or position with respect to the total number of columns within a table, grid, or treegrid. See related aria-colcount and aria-colspan.\r\n  **/\r\nexport function ariaColIndex(value: number) { return new Attr(\"ariaColIndex\", value, false); }\r\n\r\n/**\r\n * Defines the number of columns spanned by a cell or gridcell within a table, grid, or treegrid. See related aria-colindex and aria-rowspan.\r\n  **/\r\nexport function ariaColSpan(value: number) { return new Attr(\"ariaColSpan\", value, false); }\r\n\r\n/**\r\n * Identifies the element (or elements) whose contents or presence are controlled by the current element. See related aria-owns.\r\n  **/\r\nexport function ariaControls(value: string) { return new Attr(\"ariaControls\", value, false); }\r\n\r\n/**\r\n * Indicates the element that represents the current item within a container or set of related elements.\r\n  **/\r\nexport function ariaCurrent(value: string) { return new Attr(\"ariaCurrent\", value, false); }\r\n\r\n/**\r\n * Identifies the element (or elements) that describes the object. See related aria-labelledby.\r\n  **/\r\nexport function ariaDescribedBy(value: string) { return new Attr(\"ariaDescribedBy\", value, false); }\r\n\r\n/**\r\n * Identifies the element that provides a detailed, extended description for the object. See related aria-describedby.\r\n  **/\r\nexport function ariaDetails(value: string) { return new Attr(\"ariaDetails\", value, false); }\r\n\r\n/**\r\n * Indicates that the element is perceivable but disabled, so it is not editable or otherwise operable. See related aria-hidden and aria-readonly.\r\n  **/\r\nexport function ariaDisabled(value: boolean) { return new Attr(\"ariaDisabled\", value, false); }\r\n\r\n/**\r\n * Identifies the element that provides an error message for the object. See related aria-invalid and aria-describedby.\r\n  **/\r\nexport function ariaErrorMessage(value: string) { return new Attr(\"ariaErrorMessage\", value, false); }\r\n\r\n/**\r\n * Indicates whether the element, or another grouping element it controls, is currently expanded or collapsed.\r\n **/\r\nexport function ariaExpanded(value: boolean) { return new Attr(\"ariaExpanded\", value, false); }\r\n\r\n/**\r\n * Identifies the next element (or elements) in an alternate reading order of content which, at the user's discretion, allows assistive technology to override the general default of reading in document source order.\r\n  **/\r\nexport function ariaFlowTo(value: string) { return new Attr(\"ariaFlowTo\", value, false); }\r\n\r\n/**\r\n * Indicates the availability and type of interactive popup element, such as menu or dialog, that can be triggered by an element.\r\n  **/\r\nexport function ariaHasPopup(value: string) { return new Attr(\"ariaHasPopup\", value, false); }\r\n\r\n/**\r\n * Indicates whether the element is exposed to an accessibility API. See related aria-disabled.\r\n **/\r\nexport function ariaHidden(value: boolean) { return new Attr(\"ariaHidden\", value, false); }\r\n\r\n/**\r\n * Indicates the entered value does not conform to the format expected by the application. See related aria-errormessage.\r\n  **/\r\nexport function ariaInvalid(value: string) { return new Attr(\"ariaInvalid\", value, false); }\r\n\r\n/**\r\n * Indicates keyboard shortcuts that an author has implemented to activate or give focus to an element.\r\n  **/\r\nexport function ariaKeyShortcuts(value: string) { return new Attr(\"ariaKeyShortcuts\", value, false); }\r\n\r\n/**\r\n * Defines a string value that labels the current element. See related aria-labelledby.\r\n  **/\r\nexport function ariaLabel(value: string) { return new Attr(\"ariaLabel\", value, false); }\r\n\r\n/**\r\n * Identifies the element (or elements) that labels the current element. See related aria-describedby.\r\n  **/\r\nexport function ariaLabelledBy(value: string) { return new Attr(\"ariaLabelledBy\", value, false); }\r\n\r\n/**\r\n * Defines the hierarchical level of an element within a structure.\r\n  **/\r\nexport function ariaLevel(value: number) { return new Attr(\"ariaLevel\", value, false); }\r\n\r\n/**\r\n * Indicates that an element will be updated, and describes the types of updates the user agents, assistive technologies, and user can expect from the live region.\r\n  **/\r\nexport function ariaLive(value: string) { return new Attr(\"ariaLive\", value, false); }\r\n\r\n/**\r\n * Indicates whether an element is modal when displayed\r\n  **/\r\nexport function ariaModal(value: boolean) { return new Attr(\"ariaModal\", value, false); }\r\n\r\n/**\r\n * Indicates whether a text box accepts multiple lines of input or only a single line.\r\n  **/\r\nexport function ariaMultiline(value: boolean) { return new Attr(\"ariaMultiline\", value, false); }\r\n\r\n/**\r\n * Indicates that the user may select more than one item from the current selectable descendants.\r\n  **/\r\nexport function ariaMultiSelectable(value: boolean) { return new Attr(\"ariaMultiSelectable\", value, false); }\r\n\r\n/**\r\n * Indicates that the user may select more than one item from the current selectable descendants.\r\n  **/\r\nexport function ariaOrientation(value: string) { return new Attr(\"ariaOrientation\", value, false); }\r\n\r\n/**\r\n * Identifies an element (or elements) in order to define a visual, functional, or contextual parent/child relationship between DOM elements where the DOM hierarchy cannot be used to represent the relationship. See related aria-controls.\r\n  **/\r\nexport function ariaOwns(value: string) { return new Attr(\"ariaOwns\", value, false); }\r\n\r\n/**\r\n * Defines a short hint (a word or short phrase) intended to aid the user with data entry when the control has no value. A hint could be a sample value or a brief description of the expected format.\r\n  **/\r\nexport function ariaPlaceholder(value: string) { return new Attr(\"ariaPlaceholder\", value, false); }\r\n\r\n/**\r\n * Defines an element's number or position in the current set of listitems or treeitems. Not required if all elements in the set are present in the DOM. See related aria-setsize.\r\n  **/\r\nexport function ariaPosInSet(value: number) { return new Attr(\"ariaPosInSet\", value, false); }\r\n\r\n/**\r\n * Indicates the current \"pressed\" state of toggle buttons. See related aria-checked and aria-selected.\r\n **/\r\nexport function ariaPressed(value: boolean) { return new Attr(\"ariaPressed\", value, false); }\r\n\r\n/**\r\n * Indicates that the element is not editable, but is otherwise operable. See related aria-disabled.\r\n  **/\r\nexport function ariaReadOnly(value: boolean) { return new Attr(\"ariaReadOnly\", value, false); }\r\n\r\n/**\r\n * Indicates what notifications the user agent will trigger when the accessibility tree within a live region is modified. See related aria-atomic.\r\n  **/\r\nexport function ariaRelevant(value: string) { return new Attr(\"ariaRelevant\", value, false); }\r\n\r\n/**\r\n * Indicates that user input is required on the element before a form may be submitted.\r\n  **/\r\nexport function ariaRequired(value: boolean) { return new Attr(\"ariaRequired\", value, false); }\r\n\r\n/**\r\n * Defines a human-readable, author-localized description for the role of an element.\r\n  **/\r\nexport function ariaRoleDescription(value: string) { return new Attr(\"ariaRoleDescription\", value, false); }\r\n\r\n/**\r\n * Defines the total number of rows in a table, grid, or treegrid. See related aria-rowindex.\r\n  **/\r\nexport function ariaRowCount(value: number) { return new Attr(\"ariaRowCount\", value, false); }\r\n\r\n/**\r\n * Defines an element's row index or position with respect to the total number of rows within a table, grid, or treegrid. See related aria-rowcount and aria-rowspan.\r\n  **/\r\nexport function ariaRowIndex(value: number) { return new Attr(\"ariaRowIndex\", value, false); }\r\n\r\n/**\r\n Defines the number of rows spanned by a cell or gridcell within a table, grid, or treegrid. See related aria-rowindex and aria-colspan.\r\n  **/\r\nexport function ariaRowSpan(value: number) { return new Attr(\"ariaRowSpan\", value, false); }\r\n\r\n/**\r\n * Indicates the current \"selected\" state of various widgets. See related aria-checked and aria-pressed.\r\n **/\r\nexport function ariaSelected(value: boolean) { return new Attr(\"ariaSelected\", value, false); }\r\n\r\n/**\r\n * Defines the number of items in the current set of listitems or treeitems. Not required if all elements in the set are present in the DOM. See related aria-posinset.\r\n  **/\r\nexport function ariaSetSize(value: number) { return new Attr(\"ariaSetsize\", value, false); }\r\n\r\n/**\r\n * Indicates if items in a table or grid are sorted in ascending or descending order.\r\n  **/\r\nexport function ariaSort(value: string) { return new Attr(\"ariaSort\", value, false); }\r\n\r\n/**\r\n * Defines the maximum allowed value for a range widget.\r\n  **/\r\nexport function ariaValueMax(value: number) { return new Attr(\"ariaValueMax\", value, false); }\r\n\r\n/**\r\n * Defines the minimum allowed value for a range widget.\r\n  **/\r\nexport function ariaValueMin(value: number) { return new Attr(\"ariaValueMin\", value, false); }\r\n\r\n/**\r\n * Defines the current value for a range widget. See related aria-valuetext.\r\n  **/\r\nexport function ariaValueNow(value: number) { return new Attr(\"ariaValueNow\", value, false); }\r\n\r\n/**\r\n * Defines the human readable text alternative of aria-valuenow for a range widget.\r\n  **/\r\nexport function ariaValueText(value: string) { return new Attr(\"ariaValueText\", value, false); }\r\n\r\n/**\r\n * Executes the script asynchronously.\r\n  **/\r\nexport function async(value: string) { return new Attr(\"async\", value, false, \"script\"); }\r\n\r\n/**\r\n * Sets whether input is automatically capitalized when entered by user\r\n  **/\r\nexport function autoCapitalize(value: boolean) { return new Attr(\"autocapitalize\", value, false); }\r\n\r\n/**\r\n * Indicates whether controls in this form can by default have their values automatically completed by the browser.\r\n  **/\r\nexport function autoComplete(value: boolean) { return new Attr(\"autocomplete\", value ? \"on\" : \"off\", false, \"form\", \"input\", \"select\", \"textarea\"); }\r\n\r\n/**\r\n * The element should be automatically focused after the page loaded.\r\n  **/\r\nexport function autoFocus(value: boolean) { return new Attr(\"autofocus\", value, false, \"button\", \"input\", \"keygen\", \"select\", \"textarea\"); }\r\n\r\n/**\r\n * The audio or video should play as soon as possible.\r\n  **/\r\nexport function autoPlay(value: boolean) { return new Attr(\"autoplay\", value, false, \"audio\", \"video\"); }\r\n\r\n/**\r\n * Contains the time range of already buffered media.\r\n  **/\r\nexport function buffered(value: boolean) { return new Attr(\"buffered\", value, false, \"audio\", \"video\"); }\r\n\r\n/**\r\n * From the HTML Media Capture\r\n  **/\r\nexport function capture(value: boolean) { return new Attr(\"capture\", value, false, \"input\"); }\r\n\r\n/**\r\n * Declares the character encoding of the page or script.\r\n  **/\r\nexport function charSet(value: string) { return new Attr(\"charset\", value, false, \"meta\", \"script\"); }\r\n\r\n/**\r\n * Indicates whether the element should be checked on page load.\r\n  **/\r\nexport function checked(value: boolean) { return new Attr(\"checked\", value, false, \"command\", \"input\"); }\r\n\r\n/**\r\n * Contains a URI which points to the source of the quote or change.\r\n  **/\r\nexport function cite(value: string) { return new Attr(\"cite\", value, false, \"blockquote\", \"del\", \"ins\", \"q\"); }\r\n\r\n/**\r\n * Often used with CSS to style elements with common properties.\r\n  **/\r\nexport function className(value: string) { return new Attr(\"className\", value, false); }\r\n\r\n/**\r\n * Often used with CSS to style elements with common properties.\r\n  **/\r\nexport function classList(...values: string[]) { return new Attr(\"classList\", values, false); }\r\n\r\n/**\r\n * Specifies the URL of the applet's class file to be loaded and executed.\r\n  **/\r\nexport function code(value: string) { return new Attr(\"code\", value, false, \"applet\"); }\r\n\r\n/**\r\n * This attribute gives the absolute or relative URL of the directory where applets' .class files referenced by the code attribute are stored.\r\n  **/\r\nexport function codeBase(value: string) { return new Attr(\"codebase\", value, false, \"applet\"); }\r\n\r\n/**\r\n * Defines the number of columns in a textarea.\r\n  **/\r\nexport function cols(value: number) { return new Attr(\"cols\", value, false, \"textarea\"); }\r\n\r\n/**\r\n * The colspan attribute defines the number of columns a cell should span.\r\n  **/\r\nexport function colSpan(value: number) { return new Attr(\"colspan\", value, false, \"td\", \"th\"); }\r\n\r\n/**\r\n * A value associated with http-equiv or name depending on the context.\r\n  **/\r\nexport function content(value: string) { return new Attr(\"content\", value, false, \"meta\"); }\r\n\r\n/**\r\n * Indicates whether the element's content is editable.\r\n  **/\r\nexport function contentEditable(value: string) { return new Attr(\"contenteditable\", value, false); }\r\n\r\n/**\r\n * Defines the ID of a <menu> element which will serve as the element's context menu.\r\n  **/\r\nexport function contextMenu(value: string) { return new Attr(\"contextmenu\", value, false); }\r\n\r\n/**\r\n * Indicates whether the browser should show playback controls to the user.\r\n  **/\r\nexport function controls(value: boolean) { return new Attr(\"controls\", value, false, \"audio\", \"video\"); }\r\n\r\n/**\r\n * A set of values specifying the coordinates of the hot-spot region.\r\n  **/\r\nexport function coords(value: string) { return new Attr(\"coords\", value, false, \"area\"); }\r\n\r\n/**\r\n * How the element handles cross-origin requests\r\n  **/\r\nexport function crossOrigin(value: string) { return new Attr(\"crossorigin\", value, false, \"audio\", \"img\", \"link\", \"script\", \"video\"); }\r\n\r\n/**\r\n * Specifies the Content Security Policy that an embedded document must agree to enforce upon itself.\r\n  **/\r\nexport function csp(value: string) { return new Attr(\"csp\", value, false, \"iframe\"); }\r\n\r\n/**\r\n * Specifies the URL of the resource.\r\n  **/\r\nexport function data(value: string) { return new Attr(\"data\", value, false, \"object\"); }\r\n\r\n/**\r\n * Lets you attach custom attributes to an HTML element.\r\n */\r\nexport function customData(name: string, value: any) { return new Attr(\"data-\" + name, value, false); }\r\n\r\n/**\r\n * Indicates the date and time associated with the element.\r\n  **/\r\nexport function dateTime(value: Date) { return new Attr(\"datetime\", value, false, \"del\", \"ins\", \"time\"); }\r\n\r\n/**\r\n * Indicates the preferred method to decode the image.\r\n  **/\r\nexport function decoding(value: string) { return new Attr(\"decoding\", value, false, \"img\"); }\r\n\r\n/**\r\n * Indicates that the track should be enabled unless the user's preferences indicate something different.\r\n  **/\r\nexport function htmlDefault(value: boolean | string) { return new Attr(\"default\", value, false, \"track\"); }\r\n\r\n/**\r\n * Indicates that the script should be executed after the page has been parsed.\r\n  **/\r\nexport function defer(value: boolean) { return new Attr(\"defer\", value, false, \"script\"); }\r\n\r\n/**\r\n * Defines the text direction. Allowed values are ltr (Left-To-Right) or rtl (Right-To-Left)\r\n  **/\r\nexport function dir(value: string) { return new Attr(\"dir\", value, false); }\r\n\r\n/**\r\n * Indicates whether the user can interact with the element.\r\n  **/\r\nexport function disabled(value: boolean) { return new Attr(\"disabled\", value, false, \"button\", \"command\", \"fieldset\", \"input\", \"keygen\", \"optgroup\", \"option\", \"select\", \"textarea\"); }\r\n\r\n/**\r\n * ??? \r\n  **/\r\nexport function dirName(value: string) { return new Attr(\"dirname\", value, false, \"input\", \"textarea\"); }\r\n\r\n/**\r\n * Indicates that the hyperlink is to be used for downloading a resource.\r\n  **/\r\nexport function download(value: boolean) { return new Attr(\"download\", value, false, \"a\", \"area\"); }\r\n\r\n/**\r\n * Defines whether the element can be dragged.\r\n  **/\r\nexport function draggable(value: boolean) { return new Attr(\"draggable\", value, false); }\r\n\r\n/**\r\n * Indicates that the element accepts the dropping of content onto it.\r\n  **/\r\nexport function dropZone(value: string) { return new Attr(\"dropzone\", value, false); }\r\n\r\n/**\r\n * Defines the content type of the form data when the method is POST.\r\n  **/\r\nexport function encType(value: string) { return new Attr(\"enctype\", value, false, \"form\"); }\r\n\r\n/**\r\n * The enterkeyhint specifies what action label (or icon) to present for the enter key on virtual keyboards. The attribute can be used with form controls (such as the value of textarea elements), or in elements in an editing host (e.g., using contenteditable attribute).\r\n  **/\r\nexport function enterKeyHint(value: string) { return new Attr(\"enterkeyhint\", value, false, \"textarea\"); }\r\n\r\n/**\r\n * Describes elements which belongs to this one.\r\n  **/\r\nexport function htmlFor(value: string) { return new Attr(\"htmlFor\", value, false, \"label\", \"output\"); }\r\n\r\n/**\r\n * Indicates the form that is the owner of the element.\r\n  **/\r\nexport function form(value: string) { return new Attr(\"form\", value, false, \"button\", \"fieldset\", \"input\", \"keygen\", \"label\", \"meter\", \"object\", \"output\", \"progress\", \"select\", \"textarea\"); }\r\n\r\n/**\r\n * Indicates the action of the element, overriding the action defined in the <form>.\r\n  **/\r\nexport function formAction(value: string) { return new Attr(\"formaction\", value, false, \"input\", \"button\"); }\r\n\r\n/**\r\n * If the button/input is a submit button (type=\"submit\"), this attribute sets the encoding type to use during form submission. If this attribute is specified, it overrides the enctype attribute of the button's form owner.\r\n  **/\r\nexport function formEncType(value: string) { return new Attr(\"formenctype\", value, false, \"button\", \"input\"); }\r\n\r\n/**\r\n * If the button/input is a submit button (type=\"submit\"), this attribute sets the submission method to use during form submission (GET, POST, etc.). If this attribute is specified, it overrides the method attribute of the button's form owner.\r\n  **/\r\nexport function formMethod(value: string) { return new Attr(\"formmethod\", value, false, \"button\", \"input\"); }\r\n\r\n/**\r\n * If the button/input is a submit button (type=\"submit\"), this boolean attribute specifies that the form is not to be validated when it is submitted. If this attribute is specified, it overrides the novalidate attribute of the button's form owner.\r\n  **/\r\nexport function formNoValidate(value: boolean) { return new Attr(\"formnovalidate\", value, false, \"button\", \"input\"); }\r\n\r\n/**\r\n * If the button/input is a submit button (type=\"submit\"), this attribute specifies the browsing context (for example, tab, window, or inline frame) in which to display the response that is received after submitting the form. If this attribute is specified, it overrides the target attribute of the button's form owner.\r\n  **/\r\nexport function formTarget(value: string) { return new Attr(\"formtarget\", value, false, \"button\", \"input\"); }\r\n\r\n/**\r\n * Width of the border to put around an IFrame.\r\n */\r\nexport function frameBorder(value: string | number) { return new Attr(\"frameborder\", value, false, \"iframe\"); }\r\n\r\n/**\r\n * IDs of the <th> elements which applies to this element.\r\n  **/\r\nexport function headers(value: string) { return new Attr(\"headers\", value, false, \"td\", \"th\"); }\r\n\r\n/**\r\n * Specifies the height of elements listed here. For all other elements, use the CSS height property.\r\n  **/\r\nexport function htmlHeight(value: number | string) { return new Attr(\"height\", value, false, \"canvas\", \"embed\", \"iframe\", \"img\", \"input\", \"object\", \"video\"); }\r\n\r\n/**\r\n * Prevents rendering of given element, while keeping child elements, e.g. script elements, active.\r\n  **/\r\nexport function hidden(value: boolean) { return new Attr(\"hidden\", value, false); }\r\n\r\n/**\r\n * Indicates the lower bound of the upper range.\r\n  **/\r\nexport function high(value: number) { return new Attr(\"high\", value, false, \"meter\"); }\r\n\r\n/**\r\n * The URL of a linked resource.\r\n  **/\r\nexport function href(value: string | URL) { return new Attr(\"href\", unpackURL(value), false, \"a\", \"area\", \"base\", \"link\"); }\r\n\r\n/**\r\n * Specifies the language of the linked resource.\r\n  **/\r\nexport function hrefLang(value: string) { return new Attr(\"hreflang\", value, false, \"a\", \"area\", \"link\"); }\r\n\r\n/**\r\n * Defines a pragma directive.\r\n  **/\r\nexport function httpEquiv(value: string) { return new Attr(\"httpEquiv\", value, false, \"meta\"); }\r\n\r\n/**\r\n * Specifies a picture which represents the command.\r\n  **/\r\nexport function icon(value: string) { return new Attr(\"icon\", value, false, \"command\"); }\r\n\r\n/**\r\n * Often used with CSS to style a specific element. The value of this attribute must be unique.\r\n  **/\r\nexport function id(value: string) { return new Attr(\"id\", value, false); }\r\n\r\n/**\r\n * Indicates the relative fetch priority for the resource.\r\n  **/\r\nexport function importance(value: string) { return new Attr(\"importance\", value, false, \"iframe\", \"img\", \"link\", \"script\"); }\r\n\r\n/**\r\n * Provides a hint as to the type of data that might be entered by the user while editing the element or its contents. The attribute can be used with form controls (such as the value of textarea elements), or in elements in an editing host (e.g., using contenteditable attribute).\r\n  **/\r\nexport function inputMode(value: string) { return new Attr(\"inputmode\", value, false, \"textarea\"); }\r\n\r\n/**\r\n * Specifies a Subresource Integrity value that allows browsers to verify what they fetch.\r\n  **/\r\nexport function integrity(value: string) { return new Attr(\"integrity\", value, false, \"link\", \"script\"); }\r\n\r\n/**\r\n * This attribute tells the browser to ignore the actual intrinsic size of the image and pretend it\u2019s the size specified in the attribute.\r\n  **/\r\nexport function intrinsicSize(value: string) { return new Attr(\"intrinsicsize\", value, false, \"img\"); }\r\n\r\n/**\r\n * Indicates that the image is part of a server-side image map.\r\n  **/\r\nexport function isMap(value: boolean) { return new Attr(\"ismap\", value, false, \"img\"); }\r\n\r\n/**\r\n * Specifies the type of key generated.\r\n  **/\r\nexport function keyType(value: string) { return new Attr(\"keytype\", value, false, \"keygen\"); }\r\n\r\n/**\r\n * The itemprop attribute\r\n  **/\r\nexport function itemProp(value: string) { return new Attr(\"itemprop\", value, false); }\r\n\r\n/**\r\n * Specifies the kind of text track.\r\n  **/\r\nexport function kind(value: string) { return new Attr(\"kind\", value, false, \"track\"); }\r\n\r\n/**\r\n * Specifies a user-readable title of the element.\r\n  **/\r\nexport function label(value: string) { return new Attr(\"label\", value, false, \"optgroup\", \"option\", \"track\"); }\r\n\r\n/**\r\n * Defines the language used in the element.\r\n  **/\r\nexport function lang(value: string) { return new Attr(\"lang\", value, false); }\r\n\r\n/**\r\n * Defines the script language used in the element.\r\n  **/\r\nexport function language(value: string) { return new Attr(\"language\", value, false, \"script\"); }\r\n\r\n/**\r\n * Identifies a list of pre-defined options to suggest to the user.\r\n  **/\r\nexport function list(value: string) { return new Attr(\"list\", value, true, \"input\"); }\r\n\r\n/**\r\n * Indicates whether the media should start playing from the start when it's finished.\r\n  **/\r\nexport function loop(value: boolean) { return new Attr(\"loop\", value, false, \"audio\", \"bgsound\", \"marquee\", \"video\"); }\r\n\r\n/**\r\n * Indicates the upper bound of the lower range.\r\n  **/\r\nexport function low(value: number) { return new Attr(\"low\", value, false, \"meter\"); }\r\n\r\n/**\r\n * Indicates the maximum value allowed.\r\n  **/\r\nexport function max(value: number) { return new Attr(\"max\", value, false, \"input\", \"meter\", \"progress\"); }\r\n\r\n/**\r\n * Defines the maximum number of characters allowed in the element.\r\n  **/\r\nexport function maxLength(value: number) { return new Attr(\"maxlength\", value, false, \"input\", \"textarea\"); }\r\n\r\n/**\r\n * Defines the minimum number of characters allowed in the element.\r\n  **/\r\nexport function minLength(value: number) { return new Attr(\"minlength\", value, false, \"input\", \"textarea\"); }\r\n\r\n/**\r\n * Specifies a hint of the media for which the linked resource was designed.\r\n  **/\r\nexport function media(value: string) { return new Attr(\"media\", value, false, \"a\", \"area\", \"link\", \"source\", \"style\"); }\r\n\r\n/**\r\n * Defines which HTTP method to use when submitting the form. Can be GET (default) or POST.\r\n  **/\r\nexport function method(value: string) { return new Attr(\"method\", value, false, \"form\"); }\r\n\r\n/**\r\n * Indicates the minimum value allowed.\r\n  **/\r\nexport function min(value: number) { return new Attr(\"min\", value, false, \"input\", \"meter\"); }\r\n\r\n/**\r\n * Indicates whether multiple values can be entered in an input of the type email or file.\r\n  **/\r\nexport function multiple(value: boolean) { return new Attr(\"multiple\", value, false, \"input\", \"select\"); }\r\n\r\n/**\r\n * Indicates whether the audio will be initially silenced on page load.\r\n  **/\r\nexport function muted(value: boolean) { return new Attr(\"muted\", value, false, \"audio\", \"video\"); }\r\n\r\n/**\r\n * Name of the element. For example used by the server to identify the fields in form submits.\r\n  **/\r\nexport function name(value: string) { return new Attr(\"name\", value, false, \"button\", \"form\", \"fieldset\", \"iframe\", \"input\", \"keygen\", \"object\", \"output\", \"select\", \"textarea\", \"map\", \"meta\", \"param\"); }\r\n\r\n/**\r\n * This attribute indicates that the form shouldn't be validated when submitted.\r\n  **/\r\nexport function noValidate(value: boolean) { return new Attr(\"novalidate\", value, false, \"form\"); }\r\n\r\n/**\r\n * Indicates whether the details will be shown on page load.\r\n  **/\r\nexport function open(value: string) { return new Attr(\"open\", value, false, \"details\"); }\r\n\r\n/**\r\n * Indicates the optimal numeric value.\r\n  **/\r\nexport function optimum(value: number) { return new Attr(\"optimum\", value, false, \"meter\"); }\r\n\r\n/**\r\n * Defines a regular expression which the element's value will be validated against.\r\n  **/\r\nexport function pattern(value: string) { return new Attr(\"pattern\", value, false, \"input\"); }\r\n\r\n/**\r\n * The ping attribute specifies a space-separated list of URLs to be notified if a user follows the hyperlink.\r\n  **/\r\nexport function ping(value: string) { return new Attr(\"ping\", value, false, \"a\", \"area\"); }\r\n\r\n/**\r\n * Provides a hint to the user of what can be entered in the field.\r\n  **/\r\nexport function placeHolder(value: string) { return new Attr(\"placeholder\", value, false, \"input\", \"textarea\"); }\r\n\r\n/**\r\n * Indicates that the media element should play automatically on iOS.\r\n  **/\r\nexport function playsInline(value: boolean) { return new Attr(\"playsInline\", value, false, \"audio\", \"video\"); }\r\n\r\n/**\r\n * A URL indicating a poster frame to show until the user plays or seeks.\r\n  **/\r\nexport function poster(value: string) { return new Attr(\"poster\", value, false, \"video\"); }\r\n\r\n/**\r\n * Indicates whether the whole resource, parts of it or nothing should be preloaded.\r\n  **/\r\nexport function preload(value: boolean | string) { return new Attr(\"preload\", value, false, \"audio\", \"video\"); }\r\n\r\n/**\r\n * Indicates whether the element can be edited.\r\n  **/\r\nexport function readOnly(value: boolean) { return new Attr(\"readonly\", value, false, \"input\", \"textarea\"); }\r\n\r\n/**\r\n * The radiogroup attribute\r\n  **/\r\nexport function radioGroup(value: string) { return new Attr(\"radiogroup\", value, false, \"command\"); }\r\n\r\n/**\r\n * Specifies which referrer is sent when fetching the resource.\r\n  **/\r\nexport function referrerPolicy(value: string) { return new Attr(\"referrerpolicy\", value, false, \"a\", \"area\", \"iframe\", \"img\", \"link\", \"script\"); }\r\n\r\n/**\r\n * Specifies the relationship of the target object to the link object.\r\n  **/\r\nexport function rel(value: string) { return new Attr(\"rel\", value, false, \"a\", \"area\", \"link\"); }\r\n\r\n/**\r\n * Indicates whether this element is required to fill out or not.\r\n  **/\r\nexport function required(value: boolean) { return new Attr(\"required\", value, false, \"input\", \"select\", \"textarea\"); }\r\n\r\n/**\r\n * Indicates whether the list should be displayed in a descending order instead of a ascending.\r\n  **/\r\nexport function reversed(value: boolean) { return new Attr(\"reversed\", value, false, \"ol\"); }\r\n\r\n/**\r\n * Defines the number of rows in a text area.\r\n  **/\r\nexport function role(value: string) { return new Attr(\"role\", value, false); }\r\n\r\n/**\r\n * The rows attribute\r\n  **/\r\nexport function rows(value: number) { return new Attr(\"rows\", value, false, \"textarea\"); }\r\n\r\n/**\r\n * Defines the number of rows a table cell should span over.\r\n  **/\r\nexport function rowSpan(value: number) { return new Attr(\"rowspan\", value, false, \"td\", \"th\"); }\r\n\r\n/**\r\n * Stops a document loaded in an iframe from using certain features (such as submitting forms or opening new windows).\r\n  **/\r\nexport function sandbox(value: string) { return new Attr(\"sandbox\", value, false, \"iframe\"); }\r\n\r\n/**\r\n * Defines the cells that the header test (defined in the th element) relates to.\r\n  **/\r\nexport function scope(value: string) { return new Attr(\"scope\", value, false, \"th\"); }\r\n\r\n/**\r\n * The scoped attribute\r\n  **/\r\nexport function scoped(value: boolean) { return new Attr(\"scoped\", value, false, \"style\"); }\r\n\r\n/**\r\n * Defines a value which will be selected on page load.\r\n  **/\r\nexport function selected(value: boolean) { return new Attr(\"selected\", value, false, \"option\"); }\r\n\r\n/**\r\n * The shape attribute\r\n  **/\r\nexport function shape(value: string) { return new Attr(\"shape\", value, false, \"a\", \"area\"); }\r\n\r\n/**\r\n * Defines the width of the element (in pixels). If the element's type attribute is text or password then it's the number of characters.\r\n  **/\r\nexport function size(value: number) { return new Attr(\"size\", value, false, \"input\", \"select\"); }\r\n\r\n/**\r\n * Assigns a slot in a shadow DOM shadow tree to an element.\r\n  **/\r\nexport function slot(value: string) { return new Attr(\"slot\", value, false); }\r\n\r\n/**\r\n * The sizes attribute\r\n  **/\r\nexport function sizes(value: string) { return new Attr(\"sizes\", value, false, \"link\", \"img\", \"source\"); }\r\n\r\n/**\r\n * The span attribute\r\n  **/\r\nexport function span(value: string) { return new Attr(\"span\", value, false, \"col\", \"colgroup\"); }\r\n\r\n/**\r\n * Indicates whether spell checking is allowed for the element.\r\n  **/\r\nexport function spellCheck(value: boolean) { return new Attr(\"spellcheck\", value, false); }\r\n\r\nfunction unpackURL(value: string | URL) {\r\n    if (value instanceof URL) {\r\n        value = value.href;\r\n    }\r\n\r\n    return value;\r\n}\r\n\r\n/**\r\n * The URL of the embeddable content.\r\n  **/\r\nexport function src(value: string | URL) {\r\n    return new Attr(\"src\", unpackURL(value), false, \"audio\", \"embed\", \"iframe\", \"img\", \"input\", \"script\", \"source\", \"track\", \"video\");\r\n}\r\n\r\n/**\r\n * The srcdoc attribute\r\n  **/\r\nexport function srcDoc(value: string) { return new Attr(\"srcdoc\", value, false, \"iframe\"); }\r\n\r\n/**\r\n * The srclang attribute\r\n  **/\r\nexport function srcLang(value: string) { return new Attr(\"srclang\", value, false, \"track\"); }\r\n\r\n/**\r\n * A MediaStream object to use as a source for an HTML video or audio element\r\n  **/\r\nexport function srcObject(value: MediaProvider) { return new Attr(\"srcObject\", value, false, \"audio\", \"video\"); }\r\n\r\n/**\r\n * One or more responsive image candidates.\r\n  **/\r\nexport function srcSet(value: string) { return new Attr(\"srcset\", value, false, \"img\", \"source\"); }\r\n\r\n/**\r\n * Defines the first number if other than 1.\r\n  **/\r\nexport function start(value: number) { return new Attr(\"start\", value, false, \"ol\"); }\r\n\r\n/**\r\n * Defines CSS styles which will override styles previously set.\r\n *\r\n * NOTE: DO NOT USE THIS. You should use `styles()` instead.\r\n **/\r\nexport function __deprecated__style__deprecated__(value: any) {\r\n    for (let k in value) {\r\n        if (!value[k] && !isBoolean(value[k])) {\r\n            delete value[k];\r\n        }\r\n    }\r\n    return new Attr(\"style\", value, false);\r\n}\r\n\r\n/**\r\n * The step attribute\r\n  **/\r\nexport function step(value: number) { return new Attr(\"step\", value, false, \"input\"); }\r\n\r\n/**\r\n * The summary attribute\r\n  **/\r\nexport function summary(value: string) { return new Attr(\"summary\", value, false, \"table\"); }\r\n\r\n/**\r\n * Overrides the browser's default tab order and follows the one specified instead.\r\n  **/\r\nexport function tabIndex(value: number) { return new Attr(\"tabindex\", value, false); }\r\n\r\n/**\r\n * Text to be displayed in a tooltip when hovering over the element.\r\n  **/\r\nexport function title(value: string) { return new Attr(\"title\", value, false); }\r\n\r\n/**\r\n * The target attribute\r\n  **/\r\nexport function target(value: string) { return new Attr(\"target\", value, false, \"a\", \"area\", \"base\", \"form\"); }\r\n\r\n/**\r\n * Specify whether an element\u2019s attribute values and the values of its Text node children are to be translated when the page is localized, or whether to leave them unchanged.\r\n  **/\r\nexport function translate(value: boolean) { return new Attr(\"translate\", value, false); }\r\n\r\n/**\r\n * Defines the type of the element.\r\n  **/\r\nexport function type(value: string | MediaType) {\r\n    if (!isString(value)) {\r\n        value = value.value;\r\n    }\r\n    return new Attr(\"type\", value, false, \"button\", \"input\", \"command\", \"embed\", \"link\", \"object\", \"script\", \"source\", \"style\", \"menu\");\r\n}\r\n\r\n/**\r\n * Defines a default value which will be displayed in the element on page load.\r\n  **/\r\nexport function value(value: string | number) { return new Attr(\"value\", value, false, \"button\", \"data\", \"input\", \"li\", \"meter\", \"option\", \"progress\", \"param\"); }\r\n\r\n/**\r\n * Defines a default value which will be displayed in the element on page load.\r\n  **/\r\nexport function valueAsNumber(value: number) { return new Attr(\"valueAsNumber\", value, false, \"input\"); }\r\n\r\n/**\r\n * Defines a default value which will be displayed in the element on page load.\r\n  **/\r\nexport function valueAsDate(value: Date) { return new Attr(\"valueAsDate\", value, false, \"input\"); }\r\n\r\n/**\r\n * setting the volume at which a media element plays.\r\n  **/\r\nexport function volume(value: number) { return new Attr(\"volume\", value, false, \"audio\", \"video\"); }\r\n\r\n/**\r\n * The usemap attribute\r\n  **/\r\nexport function useMap(value: boolean) { return new Attr(\"usemap\", value, false, \"img\", \"input\", \"object\"); }\r\n\r\n/**\r\n * For the elements listed here, this establishes the element's width.\r\n  **/\r\nexport function htmlWidth(value: number | string) { return new Attr(\"width\", value, false, \"canvas\", \"embed\", \"iframe\", \"img\", \"input\", \"object\", \"video\"); }\r\n\r\n/**\r\n * Indicates whether the text should be wrapped.\r\n  **/\r\nexport function wrap(value: boolean) { return new Attr(\"wrap\", value, false, \"textarea\"); }", "import { isDefined, isNumber, isString } from \"@juniper-lib/tslib\";\r\nimport { IElementAppliable } from \"./tags\";\r\n\r\nexport class CssProp implements IElementAppliable {\r\n    public readonly name: string;\r\n    constructor(\r\n        public readonly key: string,\r\n        public readonly value: string | number) {\r\n        this.name = key.replace(/[A-Z]/g, (m) => `-${m.toLocaleLowerCase()}`);\r\n    }\r\n\r\n    /**\r\n     * Set the attribute value on an HTMLElement\r\n     * @param elem - the element on which to set the attribute.\r\n     */\r\n    applyToElement(elem: HTMLElement) {\r\n        (elem.style as any)[this.key] = this.value;\r\n    }\r\n}\r\n\r\nexport class CssPropSet implements IElementAppliable {\r\n    private rest: (CssProp | CssPropSet)[];\r\n    constructor(...rest: (CssProp | CssPropSet)[]) {\r\n        this.rest = rest;\r\n    }\r\n\r\n    /**\r\n     * Set the attribute value on an HTMLElement\r\n     * @param style - the element on which to set the attribute.\r\n     */\r\n    applyToElement(elem: HTMLElement) {\r\n        for (const prop of this.rest) {\r\n            prop.applyToElement(elem);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Combine style properties.\r\n **/\r\nexport function styles(...rest: (CssProp | CssPropSet)[]) {\r\n    return new CssPropSet(...rest);\r\n}\r\n\r\ntype CSSImportant<T extends string | number> = T | `${T} !important`;\r\n\r\ntype CSSGlobalValues = \"inherit\"\r\n    | \"initial\"\r\n    | \"revert\"\r\n    | \"unset\";\r\n\r\ntype CSSUrl = `url(${string})`;\r\n\r\ntype CSSPercentage = `${number}%`;\r\ntype CSSNumberPercentage = number | CSSPercentage;\r\n\r\ntype CSSAngle = number\r\n    | `${number}deg`\r\n    | `${number}rad`\r\n    | `${number}grad`\r\n    | `${number}turn`;\r\n\r\ntype CSSFontRelativeLength = `${number}cap`\r\n    | `${number}ch`\r\n    | `${number}em`\r\n    | `${number}ex`\r\n    | `${number}ic`\r\n    | `${number}lh`\r\n    | `${number}rem`\r\n    | `${number}rlh`;\r\n\r\ntype CSSViewportPercentageLength = `${number}vh`\r\n    | `${number}vw`\r\n    | `${number}vi`\r\n    | `${number}vb`\r\n    | `${number}vmin`\r\n    | `${number}vmax`;\r\n\r\ntype CSSAbsoluteLength = `${number}px`\r\n    | `${number}cm`\r\n    | `${number}mm`\r\n    | `${number}Q`\r\n    | `${number}in`\r\n    | `${number}pc`\r\n    | `${number}pt`;\r\n\r\ntype CSSLength = CSSFontRelativeLength\r\n    | CSSViewportPercentageLength\r\n    | CSSAbsoluteLength;\r\n\r\ntype CSSLengthPercentage = CSSLength\r\n    | CSSPercentage\r\n    | 0\r\n    | \"0\";\r\n\r\ntype CSSCalcStatement = `calc(${string})`;\r\n\r\ntype CSSSizePropertyValue = CSSGlobalValues\r\n    | 0\r\n    | \"0\"\r\n    | CSSLengthPercentage\r\n    | \"auto\"\r\n    | \"max-content\"\r\n    | \"min-content\"\r\n    | `fit-content(${CSSLengthPercentage})`\r\n    | CSSCalcStatement;\r\n\r\ntype CSSAlignItemsValue = CSSGlobalValues\r\n    | \"center\"\r\n    | \"start\"\r\n    | \"end\"\r\n    | \"flex-start\"\r\n    | \"flex-end\"\r\n    | \"normal\"\r\n    | \"baseline\"\r\n    | \"first baseline\"\r\n    | \"last baseline\"\r\n    | \"stretch\"\r\n    | \"safe center\"\r\n    | \"unsafe center\";\r\nexport function alignItems(v: CSSAlignItemsValue) { return new CssProp(\"alignItems\", v); }\r\n\r\ntype CSSAlignContentValue = CSSAlignItemsValue\r\n    | \"space-between\"\r\n    | \"space-around\"\r\n    | \"space-evenly\";\r\nexport function alignContent(v: CSSAlignContentValue) { return new CssProp(\"alignContent\", v); }\r\n\r\ntype CSSAlignSelfValue = CSSAlignItemsValue\r\n    | \"auto\"\r\n    | \"self-start\"\r\n    | \"self-end\";\r\nexport function alignSelf(v: CSSAlignSelfValue) { return new CssProp(\"alignSelf\", v); }\r\n\r\nexport function all(v: CSSGlobalValues) { return new CssProp(\"all\", v); }\r\n\r\nexport function alignmentBaseline(v: string) { return new CssProp(\"alignmentBaseline\", v); }\r\n\r\nexport function animation(v: string) { return new CssProp(\"animation\", v); }\r\n\r\ntype CSSTimeSecondsValue = `${number}s`;\r\ntype CSSTimeMillisecondsValue = `${number}ms`;\r\ntype CSSTimeValue = CSSTimeSecondsValue | CSSTimeMillisecondsValue;\r\nexport function animationDelay(v: CSSGlobalValues): CssProp;\r\nexport function animationDelay(...v: CSSTimeValue[]): CssProp;\r\nexport function animationDelay(...v: string[]) { return new CssProp(\"animationDelay\", v.join(\", \")); }\r\n\r\nexport function animationDuration(v: CSSGlobalValues): CssProp;\r\nexport function animationDuration(...v: CSSTimeValue[]): CssProp;\r\nexport function animationDuration(...v: string[]) { return new CssProp(\"animationDuration\", v.join(\", \")); }\r\n\r\ntype CSSAnimationDirectionValue = \"normal\"\r\n    | \"reverse\"\r\n    | \"alternate\"\r\n    | \"alternate-reverse\";\r\nexport function animationDirection(v: CSSGlobalValues): CssProp;\r\nexport function animationDirection(...v: CSSAnimationDirectionValue[]): CssProp;\r\nexport function animationDirection(...v: string[]): CssProp { return new CssProp(\"animationDirection\", v.join(\", \")); }\r\n\r\ntype CSSFillModeValue = \"none\"\r\n    | \"forwards\"\r\n    | \"backwards\"\r\n    | \"both\";\r\nexport function animationFillMode(v: CSSGlobalValues): CssProp;\r\nexport function animationFillMode(...v: CSSFillModeValue[]): CssProp;\r\nexport function animationFillMode(...v: string[]): CssProp { return new CssProp(\"animationFillMode\", v.join(\", \")); }\r\n\r\ntype CSSIterationCountValue = number | \"infinite\"\r\nexport function animationIterationCount(v: CSSGlobalValues): CssProp;\r\nexport function animationIterationCount(...v: CSSIterationCountValue[]): CssProp;\r\nexport function animationIterationCount(...v: (number | string)[]): CssProp { return new CssProp(\"animationIterationCount\", v.join(\", \")); }\r\n\r\nexport function animationName(v: CSSGlobalValues): CssProp;\r\nexport function animationName(...v: string[]): CssProp;\r\nexport function animationName(...v: string[]) { return new CssProp(\"animationName\", v.join(\", \")); }\r\n\r\ntype CSSPlayStateValue = \"running\" | \"paused\";\r\nexport function animationPlayState(v: CSSGlobalValues): CssProp;\r\nexport function animationPlayState(...v: CSSPlayStateValue[]): CssProp;\r\nexport function animationPlayState(...v: string[]) { return new CssProp(\"animationPlayState\", v.join(\", \")); }\r\n\r\ntype CSSTimingFunctionKeyword = \"ease\"\r\n    | \"ease-in\"\r\n    | \"ease-out\"\r\n    | \"ease-in-out\"\r\n    | \"linear\"\r\n    | \"step-start\"\r\n    | \"step-end\";\r\ntype CSSTimingFunctionCubicBezier = `cubic-bezier(${number}, ${number}, ${number}, ${number})`;\r\ntype CSSTimingFunctionSteps = `steps(${number}, ${CSSTimingFunctionKeyword})`;\r\ntype CSSTimingFunctionValue = CSSTimingFunctionKeyword\r\n    | CSSTimingFunctionCubicBezier\r\n    | CSSTimingFunctionSteps;\r\nexport function animationTimingFunction(v: CSSGlobalValues): CssProp;\r\nexport function animationTimingFunction(...v: CSSTimingFunctionValue[]): CssProp;\r\nexport function animationTimingFunction(v: string) { return new CssProp(\"animationTimingFunction\", v); }\r\n\r\ntype CSSAppearanceValue = CSSGlobalValues\r\n    | \"none\"\r\n    | \"auto\"\r\n    | \"menulist-button\"\r\n    | \"textfield\"\r\n    | \"button\"\r\n    | \"checkbox\"\r\n    | \"listbox\"\r\n    | \"menulist\"\r\n    | \"meter\"\r\n    | \"progress-bar\"\r\n    | \"push-button\"\r\n    | \"radio\"\r\n    | \"searchfield\"\r\n    | \"slider-horizontal\"\r\n    | \"square-button\"\r\n    | \"textarea\";\r\n\r\nexport function appearance(v: CSSAppearanceValue) { return new CssProp(\"appearance\", v); }\r\n\r\ntype CSSFilterFunction = `blur(${CSSLength})`\r\n    | `brightness(${CSSNumberPercentage})`\r\n    | `contrast(${CSSNumberPercentage})`\r\n    | `drop-shadow(${CSSLength} ${CSSLength})`\r\n    | `drop-shadow(${CSSLength} ${CSSLength} ${string})`\r\n    | `drop-shadow(${CSSLength} ${CSSLength} ${CSSLength} ${string})`\r\n    | `grayscale(${CSSNumberPercentage})`\r\n    | `hue-rotate(${CSSAngle})`\r\n    | `invert(${CSSNumberPercentage})`\r\n    | `opacity(${CSSNumberPercentage})`\r\n    | `saturate(${CSSNumberPercentage})`\r\n    | `sepia(${CSSNumberPercentage})`\r\n    | CSSUrl;\r\nexport function backdropFilter(v: \"none\" | CSSGlobalValues): CssProp;\r\nexport function backdropFilter(...v: CSSFilterFunction[]): CssProp;\r\nexport function backdropFilter(...v: string[]): CssProp { return new CssProp(\"backdropFilter\", v.join(' ')); }\r\n\r\ntype CSSBackfaceVisibilityValue = CSSGlobalValues\r\n    | \"visible\"\r\n    | \"hiden\";\r\nexport function backfaceVisibility(v: CSSBackfaceVisibilityValue) { return new CssProp(\"backfaceVisibility\", v); }\r\n\r\nexport function background(v: string) { return new CssProp(\"background\", v); }\r\n\r\ntype CSSBackgroundAttachmentValue = CSSGlobalValues\r\n    | \"scroll\"\r\n    | \"fixed\"\r\n    | \"local\";\r\nexport function backgroundAttachment(v: CSSBackgroundAttachmentValue) { return new CssProp(\"backgroundAttachment\", v); }\r\n\r\ntype CSSBlendModeValue = \"normal\"\r\n    | \"multiply\"\r\n    | \"screen\"\r\n    | \"overlay\"\r\n    | \"darken\"\r\n    | \"lighten\"\r\n    | \"color-dodge\"\r\n    | \"color-burn\"\r\n    | \"hard-light\"\r\n    | \"soft-light\"\r\n    | \"difference\"\r\n    | \"exclusion\"\r\n    | \"hue\"\r\n    | \"saturation\"\r\n    | \"color\"\r\n    | \"luminosity\";\r\nexport function backgroundBlendMode(v: CSSGlobalValues): CssProp;\r\nexport function backgroundBlendMode(...v: CSSBlendModeValue[]): CssProp;\r\nexport function backgroundBlendMode(...v: string[]): CssProp { return new CssProp(\"backgroundBlendMode\", v.join(\", \")); }\r\n\r\ntype CSSBoxType = CSSGlobalValues\r\n    | \"border-box\"\r\n    | \"padding-box\"\r\n    | \"content-box\";\r\n\r\ntype CSSClipValue = CSSBoxType\r\n    | \"text\";\r\nexport function backgroundClip(v: CSSClipValue): CssProp { return new CssProp(\"backgroundClip\", v); }\r\n\r\nexport function backgroundColor(v: string) { return new CssProp(\"backgroundColor\", v); }\r\n\r\ntype CSSGradient = `linear-gradient(${string})`\r\n    | `radial-gradient(${string})`\r\n    | `repeating-linear-gradient(${string})`\r\n    | `repeating-radial-gradient(${string})`\r\n    | `conic-gradient(${string})`;\r\n\r\ntype CSSImage = CSSUrl\r\n    | CSSGradient\r\n    | `element(${string})`\r\n    | `cross-fade(${string})`\r\n    | `image-set(${string})`;\r\nexport function backgroundImage(v: CSSGlobalValues): CssProp;\r\nexport function backgroundImage(...v: CSSImage[]): CssProp;\r\nexport function backgroundImage(...v: string[]): CssProp { return new CssProp(\"backgroundImage\", v.join(\", \")); }\r\n\r\nexport function backgroundOrigin(v: CSSBoxType): CssProp { return new CssProp(\"backgroundOrigin\", v); }\r\n\r\ntype CSSPositionKeyword = \"top\"\r\n    | \"bottom\"\r\n    | \"left\"\r\n    | \"right\"\r\n    | \"center\";\r\ntype CSSPosition = CSSPositionKeyword\r\n    | CSSLengthPercentage;\r\n\r\ntype CSSPositionValue = CSSPosition\r\n    | `${CSSPosition} ${CSSPosition}`\r\n    | `${CSSPositionKeyword} ${CSSPositionKeyword} ${CSSLengthPercentage}`\r\n    | `${CSSPositionKeyword} ${CSSLengthPercentage} ${CSSPositionKeyword} ${CSSLengthPercentage}`;\r\nexport function backgroundPosition(v: CSSGlobalValues): CssProp;\r\nexport function backgroundPosition(...v: CSSPositionValue[]): CssProp;\r\nexport function backgroundPosition(...v: (string | number)[]): CssProp { return new CssProp(\"backgroundPosition\", v.join(\", \")); }\r\n\r\ntype CSSPositionXYValue = CSSPosition\r\n    | `${CSSPositionKeyword} ${CSSLengthPercentage}`;\r\nexport function backgroundPositionX(v: CSSGlobalValues): CssProp;\r\nexport function backgroundPositionX(...v: CSSPositionXYValue[]): CssProp;\r\nexport function backgroundPositionX(...v: (string | number)[]): CssProp { return new CssProp(\"backgroundPositionX\", v.join(\", \")); }\r\n\r\nexport function backgroundPositionY(v: CSSGlobalValues): CssProp;\r\nexport function backgroundPositionY(...v: CSSPositionXYValue[]): CssProp;\r\nexport function backgroundPositionY(...v: (string | number)[]): CssProp { return new CssProp(\"backgroundPositionY\", v.join(\", \")); }\r\n\r\ntype CSSBasicRepeat = \"repeat\"\r\n    | \"space\"\r\n    | \"round\"\r\n    | \"no-repeat\";\r\n\r\ntype CSSRepeatValue = CSSGlobalValues\r\n    | \"repeat-x\"\r\n    | \"repeat-y\"\r\n    | CSSBasicRepeat\r\n    | `${CSSBasicRepeat} ${CSSBasicRepeat}`;\r\nexport function backgroundRepeat(v: CSSRepeatValue) { return new CssProp(\"backgroundRepeat\", v); }\r\n\r\nexport function backgroundRepeatX(v: CSSGlobalValues | CSSBasicRepeat) { return new CssProp(\"backgroundRepeatX\", v); }\r\nexport function backgroundRepeatY(v: CSSGlobalValues | CSSBasicRepeat) { return new CssProp(\"backgroundRepeatY\", v); }\r\n\r\ntype CSSBackgroundSizeValue = \"contain\"\r\n    | \"cover\"\r\n    | \"auto\"\r\n    | CSSLengthPercentage\r\n    | \"auto auto\"\r\n    | `${CSSLengthPercentage} auto`\r\n    | `auto ${CSSLengthPercentage}`\r\n    | `${CSSLengthPercentage} ${CSSLengthPercentage}`\r\nexport function backgroundSize(v: CSSGlobalValues): CssProp;\r\nexport function backgroundSize(...v: CSSBackgroundSizeValue[]): CssProp;\r\nexport function backgroundSize(...v: (string | number)[]): CssProp { return new CssProp(\"backgroundSize\", v.join(\", \")); }\r\n\r\nexport function baselineShift(v: string) { return new CssProp(\"baselineShift\", v); }\r\nexport function blockSize(v: string) { return new CssProp(\"blockSize\", v); }\r\nexport function border(v: string | 0) { return new CssProp(\"border\", v); }\r\nexport function borderBlockEnd(v: string) { return new CssProp(\"borderBlockEnd\", v); }\r\nexport function borderBlockEndColor(v: string) { return new CssProp(\"borderBlockEndColor\", v); }\r\nexport function borderBlockEndStyle(v: string) { return new CssProp(\"borderBlockEndStyle\", v); }\r\nexport function borderBlockEndWidth(v: string) { return new CssProp(\"borderBlockEndWidth\", v); }\r\nexport function borderBlockStart(v: string) { return new CssProp(\"borderBlockStart\", v); }\r\nexport function borderBlockStartColor(v: string) { return new CssProp(\"borderBlockStartColor\", v); }\r\nexport function borderBlockStartStyle(v: string) { return new CssProp(\"borderBlockStartStyle\", v); }\r\nexport function borderBlockStartWidth(v: string) { return new CssProp(\"borderBlockStartWidth\", v); }\r\nexport function borderBottom(v: string) { return new CssProp(\"borderBottom\", v); }\r\nexport function borderBottomColor(v: string) { return new CssProp(\"borderBottomColor\", v); }\r\nexport function borderBottomLeftRadius(v: string) { return new CssProp(\"borderBottomLeftRadius\", v); }\r\nexport function borderBottomRightRadius(v: string) { return new CssProp(\"borderBottomRightRadius\", v); }\r\nexport function borderBottomStyle(v: string) { return new CssProp(\"borderBottomStyle\", v); }\r\nexport function borderBottomWidth(v: string) { return new CssProp(\"borderBottomWidth\", v); }\r\nexport function borderCollapse(v: string) { return new CssProp(\"borderCollapse\", v); }\r\nexport function borderColor(v: string) { return new CssProp(\"borderColor\", v); }\r\nexport function borderImage(v: string) { return new CssProp(\"borderImage\", v); }\r\nexport function borderImageOutset(v: string) { return new CssProp(\"borderImageOutset\", v); }\r\nexport function borderImageRepeat(v: string) { return new CssProp(\"borderImageRepeat\", v); }\r\nexport function borderImageSlice(v: string) { return new CssProp(\"borderImageSlice\", v); }\r\nexport function borderImageSource(v: string) { return new CssProp(\"borderImageSource\", v); }\r\nexport function borderImageWidth(v: string) { return new CssProp(\"borderImageWidth\", v); }\r\nexport function borderInlineEnd(v: string) { return new CssProp(\"borderInlineEnd\", v); }\r\nexport function borderInlineEndColor(v: string) { return new CssProp(\"borderInlineEndColor\", v); }\r\nexport function borderInlineEndStyle(v: string) { return new CssProp(\"borderInlineEndStyle\", v); }\r\nexport function borderInlineEndWidth(v: string) { return new CssProp(\"borderInlineEndWidth\", v); }\r\nexport function borderInlineStart(v: string) { return new CssProp(\"borderInlineStart\", v); }\r\nexport function borderInlineStartColor(v: string) { return new CssProp(\"borderInlineStartColor\", v); }\r\nexport function borderInlineStartStyle(v: string) { return new CssProp(\"borderInlineStartStyle\", v); }\r\nexport function borderInlineStartWidth(v: string) { return new CssProp(\"borderInlineStartWidth\", v); }\r\nexport function borderLeft(v: string) { return new CssProp(\"borderLeft\", v); }\r\nexport function borderLeftColor(v: string) { return new CssProp(\"borderLeftColor\", v); }\r\nexport function borderLeftStyle(v: string) { return new CssProp(\"borderLeftStyle\", v); }\r\nexport function borderLeftWidth(v: string) { return new CssProp(\"borderLeftWidth\", v); }\r\nexport function borderRadius(v: string | 0) { return new CssProp(\"borderRadius\", v); }\r\nexport function borderRight(v: string) { return new CssProp(\"borderRight\", v); }\r\nexport function borderRightColor(v: string) { return new CssProp(\"borderRightColor\", v); }\r\nexport function borderRightStyle(v: string) { return new CssProp(\"borderRightStyle\", v); }\r\nexport function borderRightWidth(v: string) { return new CssProp(\"borderRightWidth\", v); }\r\nexport function borderSpacing(v: string) { return new CssProp(\"borderSpacing\", v); }\r\nexport function borderStyle(v: string) { return new CssProp(\"borderStyle\", v); }\r\nexport function borderTop(v: string) { return new CssProp(\"borderTop\", v); }\r\nexport function borderTopColor(v: string) { return new CssProp(\"borderTopColor\", v); }\r\nexport function borderTopLeftRadius(v: string) { return new CssProp(\"borderTopLeftRadius\", v); }\r\nexport function borderTopRightRadius(v: string) { return new CssProp(\"borderTopRightRadius\", v); }\r\nexport function borderTopStyle(v: string) { return new CssProp(\"borderTopStyle\", v); }\r\nexport function borderTopWidth(v: string) { return new CssProp(\"borderTopWidth\", v); }\r\nexport function borderWidth(v: string | 0) { return new CssProp(\"borderWidth\", v); }\r\n\r\ntype CSSElementPositionValue = CSSGlobalValues\r\n    | \"auto\"\r\n    | CSSLengthPercentage;\r\nexport function bottom(v: CSSElementPositionValue) { return new CssProp(\"bottom\", v); }\r\nexport function boxShadow(v: string) { return new CssProp(\"boxShadow\", v); }\r\nexport function boxSizing(v: string) { return new CssProp(\"boxSizing\", v); }\r\nexport function breakAfter(v: string) { return new CssProp(\"breakAfter\", v); }\r\nexport function breakBefore(v: string) { return new CssProp(\"breakBefore\", v); }\r\nexport function breakInside(v: string) { return new CssProp(\"breakInside\", v); }\r\nexport function bufferedRendering(v: string) { return new CssProp(\"bufferedRendering\", v); }\r\nexport function captionSide(v: string) { return new CssProp(\"captionSide\", v); }\r\nexport function caretColor(v: string) { return new CssProp(\"caretColor\", v); }\r\nexport function clear(v: string) { return new CssProp(\"clear\", v); }\r\nexport function clip(v: string) { return new CssProp(\"clip\", v); }\r\nexport function clipPath(v: string) { return new CssProp(\"clipPath\", v); }\r\nexport function clipRule(v: string) { return new CssProp(\"clipRule\", v); }\r\nexport function color(v: string) { return new CssProp(\"color\", v); }\r\nexport function colorInterpolation(v: string) { return new CssProp(\"colorInterpolation\", v); }\r\nexport function colorInterpolationFilters(v: string) { return new CssProp(\"colorInterpolationFilters\", v); }\r\nexport function colorRendering(v: string) { return new CssProp(\"colorRendering\", v); }\r\nexport function colorScheme(v: string) { return new CssProp(\"colorScheme\", v); }\r\nexport function columnCount(v: string) { return new CssProp(\"columnCount\", v); }\r\nexport function columnFill(v: string) { return new CssProp(\"columnFill\", v); }\r\nexport function columnGap(v: string) { return new CssProp(\"columnGap\", v); }\r\nexport function columnRule(v: string) { return new CssProp(\"columnRule\", v); }\r\nexport function columnRuleColor(v: string) { return new CssProp(\"columnRuleColor\", v); }\r\nexport function columnRuleStyle(v: string) { return new CssProp(\"columnRuleStyle\", v); }\r\nexport function columnRuleWidth(v: string) { return new CssProp(\"columnRuleWidth\", v); }\r\nexport function columnSpan(v: string) { return new CssProp(\"columnSpan\", v); }\r\nexport function columnWidth(v: string) { return new CssProp(\"columnWidth\", v); }\r\nexport function columns(v: string) { return new CssProp(\"columns\", v); }\r\nexport function contain(v: string) { return new CssProp(\"contain\", v); }\r\nexport function containIntrinsicSize(v: string) { return new CssProp(\"containIntrinsicSize\", v); }\r\nexport function counterIncrement(v: string) { return new CssProp(\"counterIncrement\", v); }\r\nexport function counterReset(v: string) { return new CssProp(\"counterReset\", v); }\r\n\r\nexport type CSSCursorValue = CSSGlobalValues\r\n    | \"auto\"\r\n    | \"default\"\r\n    | \"none\"\r\n    | \"context-menu\"\r\n    | \"help\"\r\n    | \"pointer\"\r\n    | \"progress\"\r\n    | \"wait\"\r\n    | \"cell\"\r\n    | \"crosshair\"\r\n    | \"text\"\r\n    | \"vertical-text\"\r\n    | \"alias\"\r\n    | \"copy\"\r\n    | \"move\"\r\n    | \"no-drop\"\r\n    | \"not-allowed\"\r\n    | \"grab\"\r\n    | \"grabbing\"\r\n    | \"all-scroll\"\r\n    | \"col-resize\"\r\n    | \"row-resize\"\r\n    | \"n-resize\"\r\n    | \"e-resize\"\r\n    | \"s-resize\"\r\n    | \"w-resize\"\r\n    | \"ne-resize\"\r\n    | \"nw-resize\"\r\n    | \"se-resize\"\r\n    | \"sw-resize\"\r\n    | \"ew-resize\"\r\n    | \"ns-resize\"\r\n    | \"nesw-resize\"\r\n    | \"nwse-resize\"\r\n    | \"zoom-in\"\r\n    | \"zoom-out\";\r\nexport function cursor(v: CSSCursorValue) { return new CssProp(\"cursor\", v); }\r\n\r\nexport function cx(v: string) { return new CssProp(\"cx\", v); }\r\nexport function cy(v: string) { return new CssProp(\"cy\", v); }\r\nexport function d(v: string) { return new CssProp(\"d\", v); }\r\nexport function direction(v: string) { return new CssProp(\"direction\", v); }\r\n\r\nexport type CSSDisplayValues = CSSGlobalValues\r\n    | \"none\"\r\n    | \"contents\"\r\n    | \"block\"\r\n    | \"inline\"\r\n    | \"inline-block\"\r\n    | \"flex\"\r\n    | \"inline-flex\"\r\n    | \"inline flex\"\r\n    | \"block flex\"\r\n    | \"grid\"\r\n    | \"inline-grid\"\r\n    | \"inline grid\"\r\n    | \"block grid\"\r\n    | \"flow-root\"\r\n    | \"inline flow-root\"\r\n    | \"block flow-root\"\r\n    | \"block flow\"\r\n    | \"inline flow\"\r\n    | \"table\"\r\n    | \"table-row\"\r\n    | \"list-item\";\r\nexport function display(v: CSSImportant<CSSDisplayValues>) { return new CssProp(\"display\", v); }\r\n\r\nexport function dominantBaseline(v: string) { return new CssProp(\"dominantBaseline\", v); }\r\nexport function emptyCells(v: string) { return new CssProp(\"emptyCells\", v); }\r\nexport function fill(v: string) { return new CssProp(\"fill\", v); }\r\nexport function fillOpacity(v: string) { return new CssProp(\"fillOpacity\", v); }\r\nexport function fillRule(v: string) { return new CssProp(\"fillRule\", v); }\r\nexport function filter(v: string) { return new CssProp(\"filter\", v); }\r\nexport function flex(v: string) { return new CssProp(\"flex\", v); }\r\nexport function flexBasis(v: string) { return new CssProp(\"flexBasis\", v); }\r\nexport function flexDirection(v: string) { return new CssProp(\"flexDirection\", v); }\r\nexport function flexFlow(v: string) { return new CssProp(\"flexFlow\", v); }\r\nexport function flexGrow(v: string) { return new CssProp(\"flexGrow\", v); }\r\nexport function flexShrink(v: string) { return new CssProp(\"flexShrink\", v); }\r\nexport function flexWrap(v: string) { return new CssProp(\"flexWrap\", v); }\r\nexport function float(v: string) { return new CssProp(\"float\", v); }\r\nexport function floodColor(v: string) { return new CssProp(\"floodColor\", v); }\r\nexport function floodOpacity(v: string) { return new CssProp(\"floodOpacity\", v); }\r\nexport function font(v: string) { return new CssProp(\"font\", v); }\r\nexport function fontDisplay(v: string) { return new CssProp(\"fontDisplay\", v); }\r\nexport function fontFamily(v: string) { return new CssProp(\"fontFamily\", v); }\r\nexport function fontFeatureSettings(v: string) { return new CssProp(\"fontFeatureSettings\", v); }\r\nexport function fontKerning(v: string) { return new CssProp(\"fontKerning\", v); }\r\nexport function fontOpticalSizing(v: string) { return new CssProp(\"fontOpticalSizing\", v); }\r\nexport function fontSize(v: string) { return new CssProp(\"fontSize\", v); }\r\nexport function fontStretch(v: string) { return new CssProp(\"fontStretch\", v); }\r\nexport function fontStyle(v: string) { return new CssProp(\"fontStyle\", v); }\r\nexport function fontVariant(v: string) { return new CssProp(\"fontVariant\", v); }\r\nexport function fontVariantCaps(v: string) { return new CssProp(\"fontVariantCaps\", v); }\r\nexport function fontVariantEastAsian(v: string) { return new CssProp(\"fontVariantEastAsian\", v); }\r\nexport function fontVariantLigatures(v: string) { return new CssProp(\"fontVariantLigatures\", v); }\r\nexport function fontVariantNumeric(v: string) { return new CssProp(\"fontVariantNumeric\", v); }\r\nexport function fontVariationSettings(v: string) { return new CssProp(\"fontVariationSettings\", v); }\r\nexport function fontWeight(v: string) { return new CssProp(\"fontWeight\", v); }\r\nexport function forcedColorAdjust(v: string) { return new CssProp(\"forcedColorAdjust\", v); }\r\nexport function gap(v: string) { return new CssProp(\"gap\", v); }\r\nexport function grid(v: string) { return new CssProp(\"grid\", v); }\r\n\r\nexport function gridArea(v: string): CssProp;\r\nexport function gridArea(rowStart: number, colStart?: number, rowEnd?: number, colEnd?: number): CssProp;\r\nexport function gridArea(vOrRowStart: string | number, colStart?: number, rowEnd?: number, colEnd?: number): CssProp {\r\n    if (!isString(vOrRowStart)) {\r\n        vOrRowStart = [vOrRowStart, colStart, rowEnd, colEnd]\r\n            .filter(isDefined)\r\n            .join('/');\r\n    }\r\n\r\n    return new CssProp(\"gridArea\", vOrRowStart);\r\n}\r\nexport function gridAutoColumns(v: string) { return new CssProp(\"gridAutoColumns\", v); }\r\n\r\ntype CSSGridAutoFlowValues = CSSGlobalValues\r\n    | \"row\"\r\n    | \"column\"\r\n    | \"dense\"\r\n    | \"row dense\"\r\n    | \"column dense\";\r\nexport function gridAutoFlow(v: CSSGridAutoFlowValues) { return new CssProp(\"gridAutoFlow\", v); }\r\n\r\nexport function gridAutoRows(v: string) { return new CssProp(\"gridAutoRows\", v); }\r\n\r\nexport function gridColumn(v: string): CssProp\r\nexport function gridColumn(colStart: number, colEnd?: number): CssProp\r\nexport function gridColumn(vOrColStart: string | number, colEnd?: number): CssProp {\r\n    if (!isString(vOrColStart)) {\r\n        vOrColStart = [vOrColStart, colEnd]\r\n            .filter(isDefined)\r\n            .join('/');\r\n    }\r\n    return new CssProp(\"gridColumn\", vOrColStart);\r\n}\r\n\r\nexport function gridColumnEnd(v: string | number) { return new CssProp(\"gridColumnEnd\", v); }\r\nexport function gridColumnGap(v: CSSLengthPercentage) { return new CssProp(\"gridColumnGap\", v); }\r\nexport function gridColumnStart(v: string | number) { return new CssProp(\"gridColumnStart\", v); }\r\nexport function gridGap(v: CSSLengthPercentage) { return new CssProp(\"gridGap\", v); }\r\n\r\nexport function gridRow(v: string): CssProp\r\nexport function gridRow(rowStart: number, rowEnd?: number): CssProp\r\nexport function gridRow(vOrRowStart: string | number, rowEnd?: number): CssProp {\r\n    if (!isString(vOrRowStart)) {\r\n        vOrRowStart = [vOrRowStart, rowEnd]\r\n            .filter(isDefined)\r\n            .join('/');\r\n    }\r\n    return new CssProp(\"gridRow\", vOrRowStart);\r\n}\r\n\r\nexport function gridRowEnd(v: string | number) { return new CssProp(\"gridRowEnd\", v); }\r\nexport function gridRowGap(v: CSSLengthPercentage) { return new CssProp(\"gridRowGap\", v); }\r\nexport function gridRowStart(v: string | number) { return new CssProp(\"gridRowStart\", v); }\r\nexport function gridTemplate(v: string) { return new CssProp(\"gridTemplate\", v); }\r\n\r\nexport function gridTemplateAreas(...v: string[]) { return new CssProp(\"gridTemplateAreas\", v.map((r) => '\"' + r + '\"').join('\\n')); }\r\n\r\nexport function gridTemplateColumns(v: string) { return new CssProp(\"gridTemplateColumns\", v); }\r\nexport function gridTemplateRows(v: string) { return new CssProp(\"gridTemplateRows\", v); }\r\nexport function height(v: CSSImportant<CSSSizePropertyValue>) { return new CssProp(\"height\", v); }\r\nexport function hyphens(v: string) { return new CssProp(\"hyphens\", v); }\r\nexport function imageOrientation(v: string) { return new CssProp(\"imageOrientation\", v); }\r\nexport function imageRendering(v: string) { return new CssProp(\"imageRendering\", v); }\r\nexport function inlineSize(v: string) { return new CssProp(\"inlineSize\", v); }\r\nexport function isolation(v: string) { return new CssProp(\"isolation\", v); }\r\nexport function justifyContent(v: string) { return new CssProp(\"justifyContent\", v); }\r\nexport function justifyItems(v: string) { return new CssProp(\"justifyItems\", v); }\r\nexport function justifySelf(v: string) { return new CssProp(\"justifySelf\", v); }\r\nexport function left(v: CSSElementPositionValue) { return new CssProp(\"left\", v); }\r\nexport function letterSpacing(v: string) { return new CssProp(\"letterSpacing\", v); }\r\nexport function lightingColor(v: string) { return new CssProp(\"lightingColor\", v); }\r\nexport function lineBreak(v: string) { return new CssProp(\"lineBreak\", v); }\r\nexport function lineHeight(v: string) { return new CssProp(\"lineHeight\", v); }\r\nexport function listStyle(v: string) { return new CssProp(\"listStyle\", v); }\r\nexport function listStyleImage(v: string) { return new CssProp(\"listStyleImage\", v); }\r\nexport function listStylePosition(v: string) { return new CssProp(\"listStylePosition\", v); }\r\nexport function listStyleType(v: string) { return new CssProp(\"listStyleType\", v); }\r\nexport function margin(v: string | 0) { return new CssProp(\"margin\", v); }\r\nexport function marginBlockEnd(v: string) { return new CssProp(\"marginBlockEnd\", v); }\r\nexport function marginBlockStart(v: string) { return new CssProp(\"marginBlockStart\", v); }\r\nexport function marginBottom(v: string | 0) { return new CssProp(\"marginBottom\", v); }\r\nexport function marginInlineEnd(v: string) { return new CssProp(\"marginInlineEnd\", v); }\r\nexport function marginInlineStart(v: string) { return new CssProp(\"marginInlineStart\", v); }\r\nexport function marginLeft(v: string | 0) { return new CssProp(\"marginLeft\", v); }\r\nexport function marginRight(v: string | 0) { return new CssProp(\"marginRight\", v); }\r\nexport function marginTop(v: string | 0) { return new CssProp(\"marginTop\", v); }\r\nexport function marker(v: string) { return new CssProp(\"marker\", v); }\r\nexport function markerEnd(v: string) { return new CssProp(\"markerEnd\", v); }\r\nexport function markerMid(v: string) { return new CssProp(\"markerMid\", v); }\r\nexport function markerStart(v: string) { return new CssProp(\"markerStart\", v); }\r\nexport function mask(v: string) { return new CssProp(\"mask\", v); }\r\nexport function maskType(v: string) { return new CssProp(\"maskType\", v); }\r\nexport function maxBlockSize(v: string) { return new CssProp(\"maxBlockSize\", v); }\r\nexport function maxHeight(v: string | 0) { return new CssProp(\"maxHeight\", v); }\r\nexport function maxInlineSize(v: string) { return new CssProp(\"maxInlineSize\", v); }\r\nexport function maxWidth(v: string | 0) { return new CssProp(\"maxWidth\", v); }\r\nexport function maxZoom(v: string) { return new CssProp(\"maxZoom\", v); }\r\nexport function minBlockSize(v: string) { return new CssProp(\"minBlockSize\", v); }\r\nexport function minHeight(v: string | 0) { return new CssProp(\"minHeight\", v); }\r\nexport function minInlineSize(v: string) { return new CssProp(\"minInlineSize\", v); }\r\nexport function minWidth(v: string | 0) { return new CssProp(\"minWidth\", v); }\r\nexport function minZoom(v: string) { return new CssProp(\"minZoom\", v); }\r\nexport function mixBlendMode(v: string) { return new CssProp(\"mixBlendMode\", v); }\r\nexport function objectFit(v: string) { return new CssProp(\"objectFit\", v); }\r\nexport function objectPosition(v: string) { return new CssProp(\"objectPosition\", v); }\r\nexport function offset(v: string) { return new CssProp(\"offset\", v); }\r\nexport function offsetDistance(v: string) { return new CssProp(\"offsetDistance\", v); }\r\nexport function offsetPath(v: string) { return new CssProp(\"offsetPath\", v); }\r\nexport function offsetRotate(v: string) { return new CssProp(\"offsetRotate\", v); }\r\n\r\nexport function opacity(v: CSSGlobalValues | CSSNumberPercentage) { return new CssProp(\"opacity\", v); }\r\n\r\nexport function order(v: string) { return new CssProp(\"order\", v); }\r\nexport function orientation(v: string) { return new CssProp(\"orientation\", v); }\r\nexport function orphans(v: string) { return new CssProp(\"orphans\", v); }\r\nexport function outline(v: string) { return new CssProp(\"outline\", v); }\r\nexport function outlineColor(v: string) { return new CssProp(\"outlineColor\", v); }\r\nexport function outlineOffset(v: string) { return new CssProp(\"outlineOffset\", v); }\r\nexport function outlineStyle(v: string) { return new CssProp(\"outlineStyle\", v); }\r\nexport function outlineWidth(v: string | 0) { return new CssProp(\"outlineWidth\", v); }\r\nexport function overflow(v: string) { return new CssProp(\"overflow\", v); }\r\nexport function overflowAnchor(v: string) { return new CssProp(\"overflowAnchor\", v); }\r\nexport function overflowWrap(v: string) { return new CssProp(\"overflowWrap\", v); }\r\nexport function overflowX(v: string) { return new CssProp(\"overflowX\", v); }\r\nexport function overflowY(v: string) { return new CssProp(\"overflowY\", v); }\r\nexport function overscrollBehavior(v: string) { return new CssProp(\"overscrollBehavior\", v); }\r\nexport function overscrollBehaviorBlock(v: string) { return new CssProp(\"overscrollBehaviorBlock\", v); }\r\nexport function overscrollBehaviorInline(v: string) { return new CssProp(\"overscrollBehaviorInline\", v); }\r\nexport function overscrollBehaviorX(v: string) { return new CssProp(\"overscrollBehaviorX\", v); }\r\nexport function overscrollBehaviorY(v: string) { return new CssProp(\"overscrollBehaviorY\", v); }\r\nexport function padding(...v: CSSLengthPercentage[]) { return new CssProp(\"padding\", v.join(\" \")); }\r\nexport function paddingBlockEnd(v: string) { return new CssProp(\"paddingBlockEnd\", v); }\r\nexport function paddingBlockStart(v: string) { return new CssProp(\"paddingBlockStart\", v); }\r\nexport function paddingBottom(v: CSSLengthPercentage) { return new CssProp(\"paddingBottom\", v); }\r\nexport function paddingInlineEnd(v: string) { return new CssProp(\"paddingInlineEnd\", v); }\r\nexport function paddingInlineStart(v: string) { return new CssProp(\"paddingInlineStart\", v); }\r\nexport function paddingLeft(v: CSSLengthPercentage) { return new CssProp(\"paddingLeft\", v); }\r\nexport function paddingRight(v: CSSLengthPercentage) { return new CssProp(\"paddingRight\", v); }\r\nexport function paddingTop(v: CSSLengthPercentage) { return new CssProp(\"paddingTop\", v); }\r\nexport function pageBreakAfter(v: string) { return new CssProp(\"pageBreakAfter\", v); }\r\nexport function pageBreakBefore(v: string) { return new CssProp(\"pageBreakBefore\", v); }\r\nexport function pageBreakInside(v: string) { return new CssProp(\"pageBreakInside\", v); }\r\nexport function paintOrder(v: string) { return new CssProp(\"paintOrder\", v); }\r\nexport function perspective(v: string) { return new CssProp(\"perspective\", v); }\r\nexport function perspectiveOrigin(v: string) { return new CssProp(\"perspectiveOrigin\", v); }\r\nexport function placeContent(v: string) { return new CssProp(\"placeContent\", v); }\r\nexport function placeItems(v: string) { return new CssProp(\"placeItems\", v); }\r\nexport function placeSelf(v: string) { return new CssProp(\"placeSelf\", v); }\r\n\r\ntype CSSPointerEventsValue = CSSGlobalValues\r\n    | \"auto\"\r\n    | \"none\";\r\nexport function pointerEvents(v: CSSPointerEventsValue) { return new CssProp(\"pointerEvents\", v); }\r\n\r\ntype CSSPositionValues = CSSGlobalValues\r\n    | \"static\"\r\n    | \"absolute\"\r\n    | \"fixed\"\r\n    | \"relative\"\r\n    | \"sticky\";\r\nexport function position(v: CSSImportant<CSSPositionValues>) { return new CssProp(\"position\", v); }\r\n\r\nexport function quotes(v: string) { return new CssProp(\"quotes\", v); }\r\nexport function r(v: string) { return new CssProp(\"r\", v); }\r\nexport function resize(v: string) { return new CssProp(\"resize\", v); }\r\nexport function right(v: CSSElementPositionValue) { return new CssProp(\"right\", v); }\r\nexport function rowGap(v: string | 0) { return new CssProp(\"rowGap\", v); }\r\nexport function rubyPosition(v: string) { return new CssProp(\"rubyPosition\", v); }\r\nexport function rx(v: string) { return new CssProp(\"rx\", v); }\r\nexport function ry(v: string) { return new CssProp(\"ry\", v); }\r\nexport function scrollBehavior(v: string) { return new CssProp(\"scrollBehavior\", v); }\r\nexport function scrollMargin(v: string | 0) { return new CssProp(\"scrollMargin\", v); }\r\nexport function scrollMarginBlock(v: string) { return new CssProp(\"scrollMarginBlock\", v); }\r\nexport function scrollMarginBlockEnd(v: string) { return new CssProp(\"scrollMarginBlockEnd\", v); }\r\nexport function scrollMarginBlockStart(v: string) { return new CssProp(\"scrollMarginBlockStart\", v); }\r\nexport function scrollMarginBottom(v: string | 0) { return new CssProp(\"scrollMarginBottom\", v); }\r\nexport function scrollMarginInline(v: string) { return new CssProp(\"scrollMarginInline\", v); }\r\nexport function scrollMarginInlineEnd(v: string) { return new CssProp(\"scrollMarginInlineEnd\", v); }\r\nexport function scrollMarginInlineStart(v: string) { return new CssProp(\"scrollMarginInlineStart\", v); }\r\nexport function scrollMarginLeft(v: string | 0) { return new CssProp(\"scrollMarginLeft\", v); }\r\nexport function scrollMarginRight(v: string | 0) { return new CssProp(\"scrollMarginRight\", v); }\r\nexport function scrollMarginTop(v: string | 0) { return new CssProp(\"scrollMarginTop\", v); }\r\nexport function scrollPadding(v: string | 0) { return new CssProp(\"scrollPadding\", v); }\r\nexport function scrollPaddingBlock(v: string) { return new CssProp(\"scrollPaddingBlock\", v); }\r\nexport function scrollPaddingBlockEnd(v: string) { return new CssProp(\"scrollPaddingBlockEnd\", v); }\r\nexport function scrollPaddingBlockStart(v: string) { return new CssProp(\"scrollPaddingBlockStart\", v); }\r\nexport function scrollPaddingBottom(v: string | 0) { return new CssProp(\"scrollPaddingBottom\", v); }\r\nexport function scrollPaddingInline(v: string) { return new CssProp(\"scrollPaddingInline\", v); }\r\nexport function scrollPaddingInlineEnd(v: string) { return new CssProp(\"scrollPaddingInlineEnd\", v); }\r\nexport function scrollPaddingInlineStart(v: string) { return new CssProp(\"scrollPaddingInlineStart\", v); }\r\nexport function scrollPaddingLeft(v: string | 0) { return new CssProp(\"scrollPaddingLeft\", v); }\r\nexport function scrollPaddingRight(v: string | 0) { return new CssProp(\"scrollPaddingRight\", v); }\r\nexport function scrollPaddingTop(v: string | 0) { return new CssProp(\"scrollPaddingTop\", v); }\r\nexport function scrollSnapAlign(v: string) { return new CssProp(\"scrollSnapAlign\", v); }\r\nexport function scrollSnapStop(v: string) { return new CssProp(\"scrollSnapStop\", v); }\r\nexport function scrollSnapType(v: string) { return new CssProp(\"scrollSnapType\", v); }\r\nexport function shapeImageThreshold(v: string) { return new CssProp(\"shapeImageThreshold\", v); }\r\nexport function shapeMargin(v: string) { return new CssProp(\"shapeMargin\", v); }\r\nexport function shapeOutside(v: string) { return new CssProp(\"shapeOutside\", v); }\r\nexport function shapeRendering(v: string) { return new CssProp(\"shapeRendering\", v); }\r\nexport function speak(v: string) { return new CssProp(\"speak\", v); }\r\nexport function stopColor(v: string) { return new CssProp(\"stopColor\", v); }\r\nexport function stopOpacity(v: string) { return new CssProp(\"stopOpacity\", v); }\r\nexport function stroke(v: string) { return new CssProp(\"stroke\", v); }\r\nexport function strokeDasharray(v: string) { return new CssProp(\"strokeDasharray\", v); }\r\nexport function strokeDashoffset(v: string) { return new CssProp(\"strokeDashoffset\", v); }\r\nexport function strokeLinecap(v: string) { return new CssProp(\"strokeLinecap\", v); }\r\nexport function strokeLinejoin(v: string) { return new CssProp(\"strokeLinejoin\", v); }\r\nexport function strokeMiterlimit(v: string) { return new CssProp(\"strokeMiterlimit\", v); }\r\nexport function strokeOpacity(v: string) { return new CssProp(\"strokeOpacity\", v); }\r\nexport function strokeWidth(v: string | 0) { return new CssProp(\"strokeWidth\", v); }\r\nexport function tabSize(v: string) { return new CssProp(\"tabSize\", v); }\r\nexport function tableLayout(v: string) { return new CssProp(\"tableLayout\", v); }\r\nexport function textAlign(v: string) { return new CssProp(\"textAlign\", v); }\r\nexport function textAlignLast(v: string) { return new CssProp(\"textAlignLast\", v); }\r\nexport function textAnchor(v: string) { return new CssProp(\"textAnchor\", v); }\r\nexport function textCombineUpright(v: string) { return new CssProp(\"textCombineUpright\", v); }\r\nexport function textDecoration(v: string) { return new CssProp(\"textDecoration\", v); }\r\nexport function textDecorationColor(v: string) { return new CssProp(\"textDecorationColor\", v); }\r\nexport function textDecorationLine(v: string) { return new CssProp(\"textDecorationLine\", v); }\r\nexport function textDecorationSkipInk(v: string) { return new CssProp(\"textDecorationSkipInk\", v); }\r\nexport function textDecorationStyle(v: string) { return new CssProp(\"textDecorationStyle\", v); }\r\nexport function textIndent(v: string) { return new CssProp(\"textIndent\", v); }\r\nexport function textOrientation(v: string) { return new CssProp(\"textOrientation\", v); }\r\nexport function textOverflow(v: string) { return new CssProp(\"textOverflow\", v); }\r\nexport function textRendering(v: string) { return new CssProp(\"textRendering\", v); }\r\nexport function textShadow(v: string) { return new CssProp(\"textShadow\", v); }\r\nexport function textSizeAdjust(v: string) { return new CssProp(\"textSizeAdjust\", v); }\r\nexport function textTransform(v: string) { return new CssProp(\"textTransform\", v); }\r\nexport function textUnderlinePosition(v: string) { return new CssProp(\"textUnderlinePosition\", v); }\r\nexport function top(v: CSSElementPositionValue) { return new CssProp(\"top\", v); }\r\n\r\ntype CSSTouchActionValues = CSSGlobalValues\r\n    | \"auto\"\r\n    | \"none\"\r\n    | \"pan-x\"\r\n    | \"pan-left\"\r\n    | \"pan-right\"\r\n    | \"pan-y\"\r\n    | \"pan-up\"\r\n    | \"pan-down\"\r\n    | \"pinch-zoom\"\r\n    | \"manipulation\";\r\nexport function touchAction(v: CSSImportant<CSSTouchActionValues>) { return new CssProp(\"touchAction\", v); }\r\n\r\nexport function transform(v: string) { return new CssProp(\"transform\", v); }\r\nexport function transformBox(v: string) { return new CssProp(\"transformBox\", v); }\r\nexport function transformOrigin(v: string) { return new CssProp(\"transformOrigin\", v); }\r\nexport function transformStyle(v: string) { return new CssProp(\"transformStyle\", v); }\r\nexport function transition(v: string) { return new CssProp(\"transition\", v); }\r\nexport function transitionDelay(v: string | 0) { return new CssProp(\"transitionDelay\", v); }\r\nexport function transitionDuration(v: string | 0) { return new CssProp(\"transitionDuration\", v); }\r\nexport function transitionProperty(v: string) { return new CssProp(\"transitionProperty\", v); }\r\nexport function transitionTimingFunction(v: string) { return new CssProp(\"transitionTimingFunction\", v); }\r\nexport function unicodeBidi(v: string) { return new CssProp(\"unicodeBidi\", v); }\r\nexport function unicodeRange(v: string) { return new CssProp(\"unicodeRange\", v); }\r\nexport function userSelect(v: string) { return new CssProp(\"userSelect\", v); }\r\nexport function userZoom(v: string) { return new CssProp(\"userZoom\", v); }\r\nexport function vectorEffect(v: string) { return new CssProp(\"vectorEffect\", v); }\r\nexport function verticalAlign(v: string) { return new CssProp(\"verticalAlign\", v); }\r\nexport function visibility(v: string) { return new CssProp(\"visibility\", v); }\r\nexport function whiteSpace(v: string) { return new CssProp(\"whiteSpace\", v); }\r\nexport function widows(v: string) { return new CssProp(\"widows\", v); }\r\nexport function width(v: CSSImportant<CSSSizePropertyValue>) { return new CssProp(\"width\", v); }\r\nexport function willChange(v: string) { return new CssProp(\"willChange\", v); }\r\nexport function wordBreak(v: string) { return new CssProp(\"wordBreak\", v); }\r\nexport function wordSpacing(v: string) { return new CssProp(\"wordSpacing\", v); }\r\nexport function wordWrap(v: string) { return new CssProp(\"wordWrap\", v); }\r\nexport function writingMode(v: string) { return new CssProp(\"writingMode\", v); }\r\nexport function x(v: CSSImportant<CSSSizePropertyValue>) { return new CssProp(\"x\", v); }\r\nexport function y(v: CSSImportant<CSSSizePropertyValue>) { return new CssProp(\"y\", v); }\r\nexport function zIndex(v: CSSImportant<number>) { return new CssProp(\"zIndex\", isNumber(v) ? v.toFixed(0) : v); }\r\nexport function zoom(v: CSSImportant<number>) { return new CssProp(\"zoom\", isNumber(v) ? v.toFixed(0) : v); }\r\n\r\n\r\n/**\r\n * A selection of fonts for preferred monospace rendering.\r\n **/\r\nexport function getMonospaceFonts() {\r\n    return \"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace\";\r\n}\r\n\r\n/**\r\n * A selection of fonts for preferred monospace rendering.\r\n **/\r\nexport function getMonospaceFamily() {\r\n    return fontFamily(getMonospaceFonts());\r\n}\r\n\r\n/**\r\n * A selection of fonts that should match whatever the user's operating system normally uses.\r\n **/\r\nexport function getSystemFonts() {\r\n    return \"system-ui, -apple-system, '.SFNSText-Regular', 'San Francisco', 'Segoe UI', 'Ubuntu', 'Roboto', 'Noto Sans' 'Droid Sans', sans-serif\";\r\n}\r\n\r\n/**\r\n * A selection of fonts that should match whatever the user's operating system normally uses.\r\n **/\r\nexport function getSystemFamily() {\r\n    return fontFamily(getSystemFonts());\r\n}\r\n\r\n/**\r\n * A selection of serif fonts.\r\n **/\r\nexport function getSerifFonts() {\r\n    return \"Georgia, Cambria, 'Times New Roman', Times, serif\";\r\n}\r\n\r\nexport function getSerifFamily() {\r\n    return fontFamily(getSerifFonts());\r\n}\r\n\r\n\r\nexport class CSSInJSRule {\r\n    constructor(private selector: string, private props: CssProp[]) {\r\n    }\r\n\r\n    apply(sheet: CSSStyleSheet) {\r\n        const style = this.props\r\n            .map((prop) => `${prop.name}: ${prop.value};`)\r\n            .join(\"\");\r\n        sheet.insertRule(\r\n            `${this.selector} {${style}}`,\r\n            sheet.cssRules.length);\r\n    }\r\n}\r\n\r\nexport function rule(selector: string, ...props: CssProp[]): CSSInJSRule {\r\n    return new CSSInJSRule(selector, props);\r\n}", "import { IProgress, isBoolean, isDate, isDefined, isFunction, isNumber, isObject, isString, once } from \"@juniper-lib/tslib\";\r\nimport { Attr, autoPlay, classList, className, controls, htmlFor, loop, muted, playsInline, type } from \"./attrs\";\r\nimport { CSSInJSRule, display, margin, styles } from \"./css\";\r\n\r\nexport interface ErsatzElement {\r\n    element: HTMLElement;\r\n}\r\n\r\nexport function isErsatzElement(obj: any): obj is ErsatzElement {\r\n    if (!isObject(obj)) {\r\n        return false;\r\n    }\r\n\r\n    const elem = obj as ErsatzElement;\r\n    return elem.element instanceof Node;\r\n}\r\n\r\nexport type Elements = HTMLElement | ErsatzElement;\r\n\r\nexport interface ErsatzElements {\r\n    elements: Elements[];\r\n}\r\n\r\nexport function isErsatzElements(obj: any): obj is ErsatzElements {\r\n    return isObject(obj)\r\n        && \"elements\" in obj\r\n        && (obj as any).elements instanceof Array;\r\n}\r\n\r\n\r\nexport function resolveElement(elem: Elements): HTMLElement {\r\n    if (isErsatzElement(elem)) {\r\n        return elem.element;\r\n    }\r\n\r\n    return elem;\r\n}\r\n\r\nexport interface IElementAppliable {\r\n    applyToElement(x: Elements): void;\r\n}\r\n\r\nexport function isIElementAppliable(obj: any): obj is IElementAppliable {\r\n    return isObject(obj)\r\n        && \"applyToElement\" in obj\r\n        && isFunction((obj as any).applyToElement);\r\n}\r\n\r\nexport type ElementChild = Node\r\n    | Elements\r\n    | ErsatzElements\r\n    | IElementAppliable\r\n    | string\r\n    | number\r\n    | boolean\r\n    | Date;\r\n\r\nexport function isElementChild(obj: any): obj is ElementChild {\r\n    return obj instanceof Node\r\n        || isErsatzElement(obj)\r\n        || isErsatzElements(obj)\r\n        || isIElementAppliable(obj)\r\n        || isString(obj)\r\n        || isNumber(obj)\r\n        || isBoolean(obj)\r\n        || isDate(obj);\r\n}\r\n\r\nexport interface IFocusable {\r\n    focus(): void;\r\n}\r\n\r\nexport function isFocusable(elem: any): elem is IFocusable {\r\n    return \"focus\" in elem && isFunction((elem as IFocusable).focus);\r\n}\r\n\r\nexport function elementSetDisplay(elem: Elements, visible: boolean, visibleDisplayType: string = \"block\"): void {\r\n    elem = resolveElement(elem);\r\n    elem.style.display = visible ? visibleDisplayType : \"none\";\r\n}\r\n\r\nexport function elementIsDisplayed(elem: Elements): boolean {\r\n    elem = resolveElement(elem);\r\n    return elem.style.display !== \"none\";\r\n}\r\n\r\nexport function elementToggleDisplay(elem: Elements, visibleDisplayType: string = \"block\"): void {\r\n    elementSetDisplay(elem, !elementIsDisplayed(elem), visibleDisplayType);\r\n}\r\n\r\nexport function elementInsertBefore(parent: Elements, newElem: Elements, refElem: Elements): void {\r\n    parent = resolveElement(parent);\r\n    newElem = resolveElement(newElem);\r\n    refElem = resolveElement(refElem);\r\n    if (parent && newElem) {\r\n        parent.insertBefore(newElem, refElem);\r\n    }\r\n}\r\n\r\nexport function elementGetIndexInParent(elem: Elements): number {\r\n    elem = resolveElement(elem);\r\n\r\n    if (elem.parentElement) {\r\n        for (let i = 0; i < elem.parentElement.childElementCount; ++i) {\r\n            if (elem.parentElement.children[i] === elem) {\r\n                return i;\r\n            }\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport function elementApply(elem: Elements, ...children: ElementChild[]): Elements {\r\n    elem = resolveElement(elem);\r\n\r\n    for (const child of children) {\r\n        if (isDefined(child)) {\r\n            if (child instanceof Node) {\r\n                elem.append(child);\r\n            }\r\n            else if (isErsatzElement(child)) {\r\n                elem.append(resolveElement(child));\r\n            }\r\n            else if (isErsatzElements(child)) {\r\n                elem.append(...child.elements.map(resolveElement));\r\n            }\r\n            else if (isIElementAppliable(child)) {\r\n                child.applyToElement(elem);\r\n            }\r\n            else {\r\n                elem.append(document.createTextNode(child.toLocaleString()));\r\n            }\r\n        }\r\n    }\r\n\r\n    return elem;\r\n}\r\n\r\nexport function elementReplace(elem: Elements, ...elems: Elements[]): Elements {\r\n    elem = resolveElement(elem);\r\n    elem.replaceWith(...elems.map(resolveElement));\r\n    return elem;\r\n}\r\n\r\nexport function elementSwap(elem: Elements, withPlaceholder: (placeholder: Elements) => Elements) {\r\n    const placeholder = Div();\r\n    elementReplace(placeholder, elementReplace(elem, withPlaceholder(placeholder)));\r\n}\r\n\r\nexport function getElement<T extends HTMLElement>(selector: string): T {\r\n    return document.querySelector<T>(selector);\r\n}\r\n\r\nexport function getButton(selector: string) {\r\n    return getElement<HTMLButtonElement>(selector);\r\n}\r\n\r\nexport function getInput(selector: string) {\r\n    return getElement<HTMLInputElement>(selector);\r\n}\r\n\r\nexport function getSelect(selector: string) {\r\n    return getElement<HTMLSelectElement>(selector);\r\n}\r\n\r\nexport function getCanvas(selector: string) {\r\n    return getElement<HTMLCanvasElement>(selector);\r\n}\r\n\r\n/**\r\n * Creates an HTML element for a given tag name.\r\n * \r\n * Boolean attributes that you want to default to true can be passed\r\n * as just the attribute creating function, \r\n *   e.g. `Audio(autoPlay)` vs `Audio(autoPlay(true))`\r\n * @param name - the name of the tag\r\n * @param rest - optional attributes, child elements, and text\r\n * @returns\r\n */\r\nexport function tag<T extends HTMLElement>(name: string, ...rest: ElementChild[]): T {\r\n    let elem: T = null;\r\n\r\n    for (const attr of rest) {\r\n        if (attr instanceof Attr && attr.key === \"id\") {\r\n            elem = document.getElementById(attr.value) as T;\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (elem == null) {\r\n        elem = document.createElement(name) as T;\r\n    }\r\n\r\n    elementApply(elem, ...rest);\r\n\r\n    return elem;\r\n}\r\n\r\nexport interface IDisableable {\r\n    disabled: boolean;\r\n}\r\n\r\nexport function isDisableable(obj: any): obj is IDisableable {\r\n    return \"disabled\" in obj\r\n        && isBoolean(obj.disabled);\r\n}\r\n\r\n/**\r\n * Empty an element of all children. This is faster than setting `innerHTML = \"\"`.\r\n */\r\nexport function elementClearChildren(elem: Elements) {\r\n    elem = resolveElement(elem);\r\n    while (elem.lastChild) {\r\n        elem.lastChild.remove();\r\n    }\r\n}\r\n\r\nexport function elementSetText(elem: Elements, text: string): void {\r\n    elem = resolveElement(elem);\r\n    elementClearChildren(elem);\r\n    elem.append(TextNode(text));\r\n}\r\n\r\nexport function elementGetText(elem: Elements): string {\r\n    elem = resolveElement(elem);\r\n    return elem.innerText;\r\n}\r\n\r\nexport function elementSetTitle(elem: Elements, text: string): void {\r\n    elem = resolveElement(elem);\r\n    elem.title = text;\r\n}\r\n\r\nasync function mediaElementCan(type: \"canplay\" | \"canplaythrough\", elem: HTMLMediaElement, prog?: IProgress): Promise<boolean> {\r\n    if (isDefined(prog)) {\r\n        prog.start();\r\n    }\r\n\r\n    const expectedState = type === \"canplay\"\r\n        ? elem.HAVE_CURRENT_DATA\r\n        : elem.HAVE_ENOUGH_DATA;\r\n\r\n    if (elem.readyState >= expectedState) {\r\n        return true;\r\n    }\r\n\r\n    try {\r\n        await once<HTMLMediaElementEventMap>(elem, type, \"error\");\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        console.warn(elem.error, err);\r\n        return false;\r\n    }\r\n    finally {\r\n        if (isDefined(prog)) {\r\n            prog.end();\r\n        }\r\n    }\r\n}\r\n\r\nexport function mediaElementCanPlay(elem: HTMLMediaElement, prog?: IProgress): Promise<boolean> {\r\n    return mediaElementCan(\"canplay\", elem, prog);\r\n}\r\n\r\nexport function mediaElementCanPlayThrough(elem: HTMLMediaElement, prog?: IProgress): Promise<boolean> {\r\n    return mediaElementCan(\"canplaythrough\", elem, prog);\r\n}\r\n\r\nexport function A(...rest: ElementChild[]): HTMLAnchorElement { return tag(\"a\", ...rest); }\r\nexport function Abbr(...rest: ElementChild[]): HTMLElement { return tag(\"abbr\", ...rest); }\r\nexport function Address(...rest: ElementChild[]): HTMLElement { return tag(\"address\", ...rest); }\r\nexport function Area(...rest: ElementChild[]): HTMLAreaElement { return tag(\"area\", ...rest); }\r\nexport function Article(...rest: ElementChild[]): HTMLElement { return tag(\"article\", ...rest); }\r\nexport function Aside(...rest: ElementChild[]): HTMLElement { return tag(\"aside\", ...rest); }\r\nexport function Audio(...rest: ElementChild[]): HTMLAudioElement { return tag(\"audio\", ...rest); }\r\nexport function B(...rest: ElementChild[]): HTMLElement { return tag(\"b\", ...rest); }\r\nexport function Base(...rest: ElementChild[]): HTMLBaseElement { return tag(\"base\", ...rest); }\r\nexport function BDI(...rest: ElementChild[]): HTMLElement { return tag(\"bdi\", ...rest); }\r\nexport function BDO(...rest: ElementChild[]): HTMLElement { return tag(\"bdo\", ...rest); }\r\nexport function BlockQuote(...rest: ElementChild[]): HTMLQuoteElement { return tag(\"blockquote\", ...rest); }\r\nexport function Body(...rest: ElementChild[]): HTMLBodyElement { return tag(\"body\", ...rest); }\r\nexport function BR(): HTMLBRElement { return tag(\"br\"); }\r\nexport function ButtonRaw(...rest: ElementChild[]): HTMLButtonElement { return tag(\"button\", ...rest); }\r\nexport function Button(...rest: ElementChild[]): HTMLButtonElement { return ButtonRaw(...rest, type(\"button\")); }\r\nexport function ButtonPrimary(...rest: ElementChild[]): HTMLButtonElement { return Button(...rest, classList(\"btn\", \"btn-primary\")); }\r\nexport function ButtonSecondary(...rest: ElementChild[]): HTMLButtonElement { return Button(...rest, classList(\"btn\", \"btn-secondary\")); }\r\nexport function ButtonDanger(...rest: ElementChild[]): HTMLButtonElement { return Button(...rest, classList(\"btn\", \"btn-danger\")); }\r\nexport function ButtonSmall(...rest: ElementChild[]): HTMLButtonElement { return Button(...rest, classList(\"btn\", \"btn-small\")); }\r\nexport function ButtonSubmit(...rest: ElementChild[]): HTMLButtonElement { return ButtonRaw(...rest, type(\"submit\")); }\r\nexport function ButtonReset(...rest: ElementChild[]): HTMLButtonElement { return ButtonRaw(...rest, type(\"reset\")); }\r\nexport function Canvas(...rest: ElementChild[]): HTMLCanvasElement { return tag(\"canvas\", ...rest); }\r\nexport function Caption(...rest: ElementChild[]): HTMLTableCaptionElement { return tag(\"caption\", ...rest); }\r\nexport function Cite(...rest: ElementChild[]): HTMLElement { return tag(\"cite\", ...rest); }\r\nexport function Code(...rest: ElementChild[]): HTMLElement { return tag(\"code\", ...rest); }\r\nexport function Col(...rest: ElementChild[]): HTMLTableColElement { return tag(\"col\", ...rest); }\r\nexport function ColGroup(...rest: ElementChild[]): HTMLTableColElement { return tag(\"colgroup\", ...rest); }\r\nexport function Data(...rest: ElementChild[]): HTMLDataElement { return tag(\"data\", ...rest); }\r\nexport function DataList(...rest: ElementChild[]): HTMLDataListElement { return tag(\"datalist\", ...rest); }\r\nexport function DD(...rest: ElementChild[]): HTMLElement { return tag(\"dd\", ...rest); }\r\nexport function Del(...rest: ElementChild[]): HTMLModElement { return tag(\"del\", ...rest); }\r\nexport function Details(...rest: ElementChild[]): HTMLDetailsElement { return tag(\"details\", ...rest); }\r\nexport function DFN(...rest: ElementChild[]): HTMLElement { return tag(\"dfn\", ...rest); }\r\nexport function Dialog(...rest: ElementChild[]): HTMLDialogElement { return tag(\"dialog\", ...rest); }\r\nexport function Dir(...rest: ElementChild[]): HTMLDirectoryElement { return tag(\"dir\", ...rest); }\r\nexport function Div(...rest: ElementChild[]): HTMLDivElement { return tag(\"div\", ...rest); }\r\nexport function DL(...rest: ElementChild[]): HTMLDListElement { return tag(\"dl\", ...rest); }\r\nexport function DT(...rest: ElementChild[]): HTMLElement { return tag(\"dt\", ...rest); }\r\nexport function Em(...rest: ElementChild[]): HTMLElement { return tag(\"em\", ...rest); }\r\nexport function Embed(...rest: ElementChild[]): HTMLEmbedElement { return tag(\"embed\", ...rest); }\r\nexport function FieldSet(...rest: ElementChild[]): HTMLFieldSetElement { return tag(\"fieldset\", ...rest); }\r\nexport function FigCaption(...rest: ElementChild[]): HTMLElement { return tag(\"figcaption\", ...rest); }\r\nexport function Figure(...rest: ElementChild[]): HTMLElement { return tag(\"figure\", ...rest); }\r\nexport function Footer(...rest: ElementChild[]): HTMLElement { return tag(\"footer\", ...rest); }\r\nexport function Form(...rest: ElementChild[]): HTMLFormElement { return tag(\"form\", ...rest); }\r\nexport function H1(...rest: ElementChild[]): HTMLHeadingElement { return tag(\"h1\", ...rest); }\r\nexport function H2(...rest: ElementChild[]): HTMLHeadingElement { return tag(\"h2\", ...rest); }\r\nexport function H3(...rest: ElementChild[]): HTMLHeadingElement { return tag(\"h3\", ...rest); }\r\nexport function H4(...rest: ElementChild[]): HTMLHeadingElement { return tag(\"h4\", ...rest); }\r\nexport function H5(...rest: ElementChild[]): HTMLHeadingElement { return tag(\"h5\", ...rest); }\r\nexport function H6(...rest: ElementChild[]): HTMLHeadingElement { return tag(\"h6\", ...rest); }\r\nexport function HR(...rest: ElementChild[]): HTMLHRElement { return tag(\"hr\", ...rest); }\r\nexport function Head(...rest: ElementChild[]): HTMLHeadElement { return tag(\"head\", ...rest); }\r\nexport function Header(...rest: ElementChild[]): HTMLElement { return tag(\"header\", ...rest); }\r\nexport function HGroup(...rest: ElementChild[]): HTMLElement { return tag(\"hgroup\", ...rest); }\r\nexport function HTML(...rest: ElementChild[]): HTMLHtmlElement { return tag(\"html\", ...rest); }\r\nexport function I(...rest: ElementChild[]): HTMLElement { return tag(\"i\", ...rest); }\r\nexport function FAIcon(iconName: string, ...rest: ElementChild[]): HTMLElement { return I(className(`fa fa-${iconName}`), ...rest); }\r\nexport function IFrame(...rest: ElementChild[]): HTMLIFrameElement { return tag(\"iframe\", ...rest); }\r\nexport function Img(...rest: ElementChild[]): HTMLImageElement { return tag(\"img\", ...rest); }\r\nexport function Input(...rest: ElementChild[]): HTMLInputElement { return tag(\"input\", ...rest); }\r\nexport function Ins(...rest: ElementChild[]): HTMLModElement { return tag(\"ins\", ...rest); }\r\nexport function KBD(...rest: ElementChild[]): HTMLElement { return tag(\"kbd\", ...rest); }\r\nexport function Label(...rest: ElementChild[]): HTMLLabelElement { return tag(\"label\", ...rest); }\r\nexport function PreLabeled<T extends Elements>(id: string, label: ElementChild, input: T): [HTMLLabelElement, T] {\r\n    resolveElement(input).id = id;\r\n    return [\r\n        Label(htmlFor(id), label),\r\n        input\r\n    ];\r\n}\r\nexport function PostLabeled<T extends Elements>(id: string, label: ElementChild, input: T): [T, HTMLLabelElement] {\r\n    resolveElement(input).id = id;\r\n    return [\r\n        input,\r\n        Label(htmlFor(id), label)\r\n    ];\r\n}\r\nexport function Legend(...rest: ElementChild[]): HTMLLegendElement { return tag(\"legend\", ...rest); }\r\nexport function LI(...rest: ElementChild[]): HTMLLIElement { return tag(\"li\", ...rest); }\r\nexport function Link(...rest: ElementChild[]): HTMLLinkElement { return tag(\"link\", ...rest); }\r\nexport function Main(...rest: ElementChild[]): HTMLElement { return tag(\"main\", ...rest); }\r\nexport function HtmlMap(...rest: ElementChild[]): HTMLMapElement { return tag(\"map\", ...rest); }\r\nexport function Mark(...rest: ElementChild[]): HTMLElement { return tag(\"mark\", ...rest); }\r\nexport function Marquee(...rest: ElementChild[]): HTMLMarqueeElement { return tag(\"marquee\", ...rest); }\r\nexport function Menu(...rest: ElementChild[]): HTMLMenuElement { return tag(\"menu\", ...rest); }\r\nexport function Meta(...rest: ElementChild[]): HTMLMetaElement { return tag(\"meta\", ...rest); }\r\nexport function Meter(...rest: ElementChild[]): HTMLMeterElement { return tag(\"meter\", ...rest); }\r\nexport function Nav(...rest: ElementChild[]): HTMLElement { return tag(\"nav\", ...rest); }\r\nexport function NoScript(...rest: ElementChild[]): HTMLElement { return tag(\"noscript\", ...rest); }\r\nexport function HtmlObject(...rest: ElementChild[]): HTMLObjectElement { return tag(\"object\", ...rest); }\r\nexport function OL(...rest: ElementChild[]): HTMLOListElement { return tag(\"ol\", ...rest); }\r\nexport function OptGroup(...rest: ElementChild[]): HTMLOptGroupElement { return tag(\"optgroup\", ...rest); }\r\nexport function Option(...rest: ElementChild[]): HTMLOptionElement { return tag(\"option\", ...rest); }\r\nexport function Output(...rest: ElementChild[]): HTMLOutputElement { return tag(\"output\", ...rest); }\r\nexport function P(...rest: ElementChild[]): HTMLParagraphElement { return tag(\"p\", ...rest); }\r\nexport function Param(...rest: ElementChild[]): HTMLParamElement { return tag(\"param\", ...rest); }\r\nexport function Picture(...rest: ElementChild[]): HTMLPictureElement { return tag(\"picture\", ...rest); }\r\nexport function Pre(...rest: ElementChild[]): HTMLPreElement { return tag(\"pre\", ...rest); }\r\nexport function Progress(...rest: ElementChild[]): HTMLProgressElement { return tag(\"progress\", ...rest); }\r\nexport function Q(...rest: ElementChild[]): HTMLQuoteElement { return tag(\"q\", ...rest); }\r\nexport function RB(...rest: ElementChild[]): HTMLElement { return tag(\"rb\", ...rest); }\r\nexport function RP(...rest: ElementChild[]): HTMLElement { return tag(\"rp\", ...rest); }\r\nexport function RT(...rest: ElementChild[]): HTMLElement { return tag(\"rt\", ...rest); }\r\nexport function RTC(...rest: ElementChild[]): HTMLElement { return tag(\"rtc\", ...rest); }\r\nexport function Ruby(...rest: ElementChild[]): HTMLElement { return tag(\"ruby\", ...rest); }\r\nexport function S(...rest: ElementChild[]): HTMLElement { return tag(\"s\", ...rest); }\r\nexport function Samp(...rest: ElementChild[]): HTMLElement { return tag(\"samp\", ...rest); }\r\nexport function Script(...rest: ElementChild[]): HTMLScriptElement { return tag(\"script\", ...rest); }\r\nexport function Section(...rest: ElementChild[]): HTMLElement { return tag(\"section\", ...rest); }\r\nexport function Select(...rest: ElementChild[]): HTMLSelectElement { return tag(\"select\", ...rest); }\r\nexport function Slot(...rest: ElementChild[]): HTMLSlotElement { return tag(\"slot\", ...rest); }\r\nexport function Small(...rest: ElementChild[]): HTMLElement { return tag(\"small\", ...rest); }\r\nexport function Source(...rest: ElementChild[]): HTMLSourceElement { return tag(\"source\", ...rest); }\r\nexport function Span(...rest: ElementChild[]): HTMLSpanElement { return tag(\"span\", ...rest); }\r\nexport function Strong(...rest: ElementChild[]): HTMLElement { return tag(\"strong\", ...rest); }\r\nexport function Sub(...rest: ElementChild[]): HTMLElement { return tag(\"sub\", ...rest); }\r\nexport function Summary(...rest: ElementChild[]): HTMLElement { return tag(\"summary\", ...rest); }\r\nexport function Sup(...rest: ElementChild[]): HTMLElement { return tag(\"sup\", ...rest); }\r\nexport function Table(...rest: ElementChild[]): HTMLTableElement { return tag(\"table\", ...rest); }\r\nexport function TBody(...rest: ElementChild[]): HTMLTableSectionElement { return tag(\"tbody\", ...rest); }\r\nexport function TD(...rest: ElementChild[]): HTMLTableDataCellElement { return tag(\"td\", ...rest); }\r\nexport function Template(...rest: ElementChild[]): HTMLTemplateElement { return tag(\"template\", ...rest); }\r\nexport function TextArea(...rest: ElementChild[]): HTMLTextAreaElement { return tag(\"textarea\", ...rest); }\r\nexport function TFoot(...rest: ElementChild[]): HTMLTableSectionElement { return tag(\"tfoot\", ...rest); }\r\nexport function TH(...rest: ElementChild[]): HTMLTableHeaderCellElement { return tag(\"th\", ...rest); }\r\nexport function THead(...rest: ElementChild[]): HTMLTableSectionElement { return tag(\"thead\", ...rest); }\r\nexport function Time(...rest: ElementChild[]): HTMLTimeElement { return tag(\"time\", ...rest); }\r\nexport function Title(...rest: ElementChild[]): HTMLTitleElement { return tag(\"title\", ...rest); }\r\nexport function TR(...rest: ElementChild[]): HTMLTableRowElement { return tag(\"tr\", ...rest); }\r\nexport function Track(...rest: ElementChild[]): HTMLTrackElement { return tag(\"track\", ...rest); }\r\nexport function U(...rest: ElementChild[]): HTMLElement { return tag(\"u\", ...rest); }\r\nexport function UL(...rest: ElementChild[]): HTMLUListElement { return tag(\"ul\", ...rest); }\r\nexport function Var(...rest: ElementChild[]): HTMLElement { return tag(\"var\", ...rest); }\r\nexport function Video(...rest: ElementChild[]): HTMLVideoElement { return tag(\"video\", ...rest); }\r\nexport function WBR(): HTMLElement { return tag(\"wbr\"); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a button.\r\n */\r\nexport function InputButton(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"button\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a checkbox.\r\n */\r\nexport function InputCheckbox(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"checkbox\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a color picker.\r\n */\r\nexport function InputColor(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"color\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a date picker.\r\n */\r\nexport function InputDate(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"date\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a local date-time picker.\r\n */\r\nexport function InputDateTime(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"datetime-local\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is an email entry field.\r\n */\r\nexport function InputEmail(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"email\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a file picker.\r\n */\r\nexport function InputFile(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"file\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a hidden field.\r\n */\r\nexport function InputHidden(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"hidden\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a graphical submit button.\r\n */\r\nexport function InputImage(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"image\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a month picker.\r\n */\r\nexport function InputMonth(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"month\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a month picker.\r\n */\r\nexport function InputNumber(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"number\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a password entry field.\r\n */\r\nexport function InputPassword(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"password\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a radio button.\r\n */\r\nexport function InputRadio(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"radio\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a range selector.\r\n */\r\nexport function InputRange(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"range\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a form reset button.\r\n */\r\nexport function InputReset(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"reset\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a search entry field.\r\n */\r\nexport function InputSearch(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"search\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a submit button.\r\n */\r\nexport function InputSubmit(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"submit\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a telephone number entry field.\r\n */\r\nexport function InputTelephone(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"tel\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a text entry field.\r\n */\r\nexport function InputText(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"text\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a time picker.\r\n */\r\nexport function InputTime(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"time\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a URL entry field.\r\n */\r\nexport function InputURL(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"url\"), ...rest); }\r\n\r\n/**\r\n * creates an HTML Input tag that is a week picker.\r\n */\r\nexport function InputWeek(...rest: ElementChild[]): HTMLInputElement { return Input(type(\"week\"), ...rest); }\r\n\r\n/**\r\n * Creates a text node out of the give input.\r\n */\r\nexport function TextNode(txt: any): Text {\r\n    return document.createTextNode(txt);\r\n}\r\n\r\n/**\r\n * Creates a Div element with margin: auto.\r\n */\r\nexport function Run(...rest: ElementChild[]): HTMLDivElement {\r\n    return Div(\r\n        styles(\r\n            margin(\"auto\")),\r\n        ...rest);\r\n}\r\n\r\nexport function Style(...rest: CSSInJSRule[]): HTMLStyleElement {\r\n    let elem = document.createElement(\"style\");\r\n    document.head.append(elem);\r\n\r\n    for (let x of rest) {\r\n        x.apply(elem.sheet);\r\n    }\r\n\r\n    return elem;\r\n}\r\n\r\nexport function BackgroundAudio(autoplay: boolean, mute: boolean, looping: boolean, ...rest: ElementChild[]): HTMLAudioElement {\r\n    return Audio(\r\n        playsInline(true),\r\n        controls(false),\r\n        muted(mute),\r\n        autoPlay(autoplay),\r\n        loop(looping),\r\n        styles(display(\"none\")),\r\n        ...rest);\r\n}\r\n\r\nexport function BackgroundVideo(autoplay: boolean, mute: boolean, looping: boolean, ...rest: ElementChild[]): HTMLVideoElement {\r\n    return Video(\r\n        playsInline(true),\r\n        controls(false),\r\n        muted(mute),\r\n        autoPlay(autoplay),\r\n        loop(looping),\r\n        styles(display(\"none\")),\r\n        ...rest);\r\n}", "import { isDefined, isNullOrUndefined, once, Task } from \"@juniper-lib/tslib\";\r\nimport { htmlHeight, htmlWidth, src } from \"./attrs\";\r\nimport { Canvas, Img } from \"./tags\";\r\n\r\nexport type CanvasTypes = HTMLCanvasElement | OffscreenCanvas;\r\nexport type CanvasImageTypes = HTMLImageElement | HTMLCanvasElement | OffscreenCanvas | ImageBitmap;\r\nexport type Context2D = CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D;\r\nexport type GraphicsContext = RenderingContext | OffscreenCanvasRenderingContext2D;\r\n\r\nexport const hasHTMLCanvas = \"HTMLCanvasElement\" in globalThis;\r\nexport const hasHTMLImage = \"HTMLImageElement\" in globalThis;\r\nexport const disableAdvancedSettings = false;\r\nexport const hasOffscreenCanvas = !disableAdvancedSettings && \"OffscreenCanvas\" in globalThis;\r\nexport const hasImageBitmap = !disableAdvancedSettings && \"createImageBitmap\" in globalThis;\r\n\r\nexport function isHTMLCanvas(obj: any): obj is HTMLCanvasElement {\r\n    return hasHTMLCanvas && obj instanceof HTMLCanvasElement;\r\n}\r\n\r\nexport function isHTMLImage(img: any): img is HTMLImageElement {\r\n    return hasHTMLImage && img instanceof HTMLImageElement;\r\n}\r\n\r\nexport function isOffscreenCanvas(obj: any): obj is OffscreenCanvas {\r\n    return hasOffscreenCanvas && obj instanceof OffscreenCanvas;\r\n}\r\n\r\nexport function isImageBitmap(img: any): img is ImageBitmap {\r\n    return hasImageBitmap && img instanceof ImageBitmap;\r\n}\r\n\r\n/**\r\n * Returns true if the given object is either an HTMLCanvasElement or an OffscreenCanvas.\r\n */\r\nexport function isCanvas(obj: any): obj is CanvasTypes {\r\n    return isHTMLCanvas(obj)\r\n        || isOffscreenCanvas(obj);\r\n}\r\n\r\nexport function isCanvasArray(arr: any): arr is CanvasTypes[] {\r\n    return isDefined(arr)\r\n        && arr.length > 0\r\n        && isCanvas(arr[0]);\r\n}\r\n\r\nexport function drawImageBitmapToCanvas2D(canv: CanvasTypes, img: ImageBitmap): void {\r\n    const g = canv.getContext(\"2d\");\r\n    if (isNullOrUndefined(g)) {\r\n        throw new Error(\"Could not create 2d context for canvas\");\r\n    }\r\n    g.drawImage(img, 0, 0);\r\n}\r\n\r\nexport function copyImageBitmapToCanvas(canv: CanvasTypes, img: ImageBitmap): void {\r\n    const g = canv.getContext(\"bitmaprenderer\");\r\n    if (isNullOrUndefined(g)) {\r\n        throw new Error(\"Could not create bitmaprenderer context for canvas\");\r\n    }\r\n    g.transferFromImageBitmap(img);\r\n}\r\n\r\nfunction testOffscreen2D() {\r\n    try {\r\n        const canv = new OffscreenCanvas(1, 1);\r\n        const g = canv.getContext(\"2d\");\r\n        return g != null;\r\n    }\r\n    catch (exp) {\r\n        return false;\r\n    }\r\n}\r\n\r\nexport const hasOffscreenCanvasRenderingContext2D = hasOffscreenCanvas && testOffscreen2D();\r\n\r\nexport const createUtilityCanvas = hasOffscreenCanvasRenderingContext2D && createOffscreenCanvas\r\n    || hasHTMLCanvas && createCanvas\r\n    || null;\r\n\r\nexport const createUICanvas = hasHTMLCanvas\r\n    ? createCanvas\r\n    : createUtilityCanvas;\r\n\r\nfunction testOffscreen3D() {\r\n    try {\r\n        const canv = new OffscreenCanvas(1, 1);\r\n        const g = canv.getContext(\"webgl2\");\r\n        return g != null;\r\n    }\r\n    catch (exp) {\r\n        return false;\r\n    }\r\n}\r\n\r\nexport const hasOffscreenCanvasRenderingContext3D = hasOffscreenCanvas && testOffscreen3D();\r\n\r\nfunction testBitmapRenderer() {\r\n    if (!hasHTMLCanvas && !hasOffscreenCanvas) {\r\n        return false;\r\n    }\r\n\r\n    try {\r\n        const canv = createUtilityCanvas(1, 1);\r\n        const g = canv.getContext(\"bitmaprenderer\");\r\n        return g != null;\r\n    }\r\n    catch (exp) {\r\n        return false;\r\n    }\r\n}\r\n\r\nexport const hasImageBitmapRenderingContext = hasImageBitmap && testBitmapRenderer();\r\n\r\nexport const drawImageBitmapToCanvas = hasImageBitmapRenderingContext\r\n    ? copyImageBitmapToCanvas\r\n    : drawImageBitmapToCanvas2D;\r\n\r\nexport function createOffscreenCanvas(width: number, height: number): OffscreenCanvas {\r\n    return new OffscreenCanvas(width, height);\r\n}\r\n\r\nexport function createCanvas(w: number, h: number): HTMLCanvasElement {\r\n    return Canvas(htmlWidth(w), htmlHeight(h));\r\n}\r\n\r\nexport function createOffscreenCanvasFromImageBitmap(img: ImageBitmap): OffscreenCanvas {\r\n    const canv = createOffscreenCanvas(img.width, img.height);\r\n    drawImageBitmapToCanvas(canv, img);\r\n    return canv;\r\n}\r\n\r\nexport function createCanvasFromImageBitmap(img: ImageBitmap): HTMLCanvasElement {\r\n    const canv = createCanvas(img.width, img.height);\r\n    drawImageBitmapToCanvas2D(canv, img);\r\n    return canv;\r\n}\r\n\r\nexport const createUtilityCanvasFromImageBitmap = hasOffscreenCanvasRenderingContext2D && createOffscreenCanvasFromImageBitmap\r\n    || hasHTMLCanvas && createCanvasFromImageBitmap\r\n    || null;\r\n\r\nexport function createCanvasFromOffscreenCanvas(canv: OffscreenCanvas): HTMLCanvasElement {\r\n    const c = createCanvas(canv.width, canv.height);\r\n    drawImageToCanvas(c, canv);\r\n    return c;\r\n}\r\n\r\nexport function drawImageToCanvas(canv: CanvasTypes, img: CanvasImageTypes): void {\r\n    const g = canv.getContext(\"2d\");\r\n    if (isNullOrUndefined(g)) {\r\n        throw new Error(\"Could not create 2d context for canvas\");\r\n    }\r\n    g.drawImage(img, 0, 0);\r\n}\r\n\r\nexport function createOffscreenCanvasFromImage(img: HTMLImageElement): OffscreenCanvas {\r\n    const canv = createOffscreenCanvas(img.width, img.height);\r\n    drawImageToCanvas(canv, img);\r\n    return canv;\r\n}\r\n\r\nexport function createCanvasFromImage(img: HTMLImageElement): HTMLCanvasElement {\r\n    const canv = createCanvas(img.width, img.height);\r\n    drawImageToCanvas(canv, img);\r\n    return canv;\r\n}\r\n\r\nexport const createUtilityCanvasFromImage = hasOffscreenCanvasRenderingContext2D && createOffscreenCanvasFromImage\r\n    || hasHTMLCanvas && createCanvasFromImage\r\n    || null;\r\n\r\nexport async function createImageFromFile(file: string): Promise<HTMLImageElement> {\r\n    const img = Img(src(file));\r\n    await once<HTMLElementEventMap>(img, \"load\", \"error\");\r\n    return img;\r\n}\r\n\r\n/**\r\n * Resizes a canvas element\r\n * @param canv\r\n * @param w - the new width of the canvas\r\n * @param h - the new height of the canvas\r\n * @param [superscale=1] - a value by which to scale width and height to achieve supersampling. Defaults to 1.\r\n * @returns true, if the canvas size changed, false if the given size (with super sampling) resulted in the same size.\r\n */\r\nexport function setCanvasSize(canv: CanvasTypes, w: number, h: number, superscale = 1) {\r\n    w = Math.floor(w * superscale);\r\n    h = Math.floor(h * superscale);\r\n    if (canv.width != w\r\n        || canv.height != h) {\r\n        canv.width = w;\r\n        canv.height = h;\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nexport function is2DRenderingContext(ctx: GraphicsContext): ctx is Context2D {\r\n    return isDefined((ctx as Context2D).textBaseline);\r\n}\r\n\r\nexport function setCanvas2DContextSize(ctx: Context2D, w: number, h: number, superscale = 1) {\r\n    const oldImageSmoothingEnabled = ctx.imageSmoothingEnabled,\r\n        oldTextBaseline = ctx.textBaseline,\r\n        oldTextAlign = ctx.textAlign,\r\n        oldFont = ctx.font,\r\n        resized = setCanvasSize(\r\n            ctx.canvas,\r\n            w,\r\n            h,\r\n            superscale);\r\n\r\n    if (resized) {\r\n        ctx.imageSmoothingEnabled = oldImageSmoothingEnabled;\r\n        ctx.textBaseline = oldTextBaseline;\r\n        ctx.textAlign = oldTextAlign;\r\n        ctx.font = oldFont;\r\n    }\r\n\r\n    return resized;\r\n}\r\n\r\n/**\r\n * Resizes the canvas element of a given rendering context.\r\n * \r\n * Note: the imageSmoothingEnabled, textBaseline, textAlign, and font \r\n * properties of the context will be restored after the context is resized,\r\n * as these values are usually reset to their default values when a canvas\r\n * is resized.\r\n * @param ctx\r\n * @param w - the new width of the canvas\r\n * @param h - the new height of the canvas\r\n * @param [superscale=1] - a value by which to scale width and height to achieve supersampling. Defaults to 1.\r\n * @returns true, if the canvas size changed, false if the given size (with super sampling) resulted in the same size.\r\n */\r\nexport function setContextSize(ctx: GraphicsContext, w: number, h: number, superscale = 1) {\r\n    if (is2DRenderingContext(ctx)) {\r\n        return setCanvas2DContextSize(ctx, w, h, superscale);\r\n    }\r\n    else {\r\n        return setCanvasSize(\r\n            ctx.canvas,\r\n            w,\r\n            h,\r\n            superscale);\r\n    }\r\n}\r\n\r\n/**\r\n * Resizes a canvas element to match the proportions of the size of the element in the DOM.\r\n * @param canv\r\n * @param [superscale=1] - a value by which to scale width and height to achieve supersampling. Defaults to 1.\r\n * @returns true, if the canvas size changed, false if the given size (with super sampling) resulted in the same size.\r\n */\r\nexport function resizeCanvas(canv: HTMLCanvasElement, superscale = 1) {\r\n    return setCanvasSize(\r\n        canv,\r\n        canv.clientWidth,\r\n        canv.clientHeight,\r\n        superscale);\r\n}\r\n\r\n/**\r\n * Resizes a canvas element of a given rendering context to match the proportions of the size of the element in the DOM.\r\n * @param ctx\r\n * @param [superscale=1] - a value by which to scale width and height to achieve supersampling. Defaults to 1.\r\n * @returns true, if the canvas size changed, false if the given size (with super sampling) resulted in the same size.\r\n */\r\nexport function resizeContext(ctx: CanvasRenderingContext2D, superscale = 1) {\r\n    return setContextSize(\r\n        ctx,\r\n        ctx.canvas.clientWidth,\r\n        ctx.canvas.clientHeight,\r\n        superscale);\r\n}\r\n\r\nexport function canvasToBlob(canvas: CanvasTypes, type?: string, quality?: number): Promise<Blob> {\r\n    if (isOffscreenCanvas(canvas)) {\r\n        return canvas.convertToBlob({ type, quality });\r\n    }\r\n    else if (isHTMLCanvas(canvas)) {\r\n        const blobCreated = new Task<Blob>();\r\n        canvas.toBlob(blobCreated.resolve, type, quality);\r\n        return blobCreated;\r\n    }\r\n    else {\r\n        throw new Error(\"Cannot save image from canvas\");\r\n    }\r\n}\r\n\r\nexport async function snapshot(canvas: CanvasTypes): Promise<CanvasTypes> {\r\n    const copy = createUtilityCanvas(canvas.width, canvas.height);\r\n    drawImageToCanvas(copy, canvas);\r\n    return copy;\r\n}", "import type { CanvasTypes, Context2D } from \"@juniper-lib/dom/canvas\";\r\nimport { createUICanvas, isHTMLCanvas } from \"@juniper-lib/dom/canvas\";\r\nimport type { ErsatzElement } from \"@juniper-lib/dom/tags\";\r\nimport { isDefined, TypedEvent, TypedEventBase } from \"@juniper-lib/tslib\";\r\n\r\ninterface CanvasImageEvents {\r\n    redrawn: TypedEvent<\"redrawn\">;\r\n}\r\n\r\nexport interface CanvasImageOptions {\r\n    scale: number;\r\n}\r\n\r\nexport abstract class CanvasImage\r\n    extends TypedEventBase<CanvasImageEvents>\r\n    implements ErsatzElement {\r\n\r\n    private _canvas: CanvasTypes;\r\n    private _scale = 250;\r\n    private _g: Context2D;\r\n    private _visible = true;\r\n    private wasVisible: boolean = null;\r\n\r\n    protected redrawnEvt = new TypedEvent(\"redrawn\");\r\n    readonly element: HTMLCanvasElement = null;\r\n\r\n    constructor(width: number, height: number, options?: Partial<CanvasImageOptions>) {\r\n        super();\r\n\r\n        if (isDefined(options)) {\r\n\r\n            if (isDefined(options.scale)) {\r\n                this._scale = options.scale;\r\n            }\r\n\r\n        }\r\n\r\n        this._canvas = createUICanvas(width, height);\r\n        this._g = this.canvas.getContext(\"2d\");\r\n\r\n        if (isHTMLCanvas(this._canvas)) {\r\n            this.element = this._canvas;\r\n        }\r\n    }\r\n\r\n    protected fillRect(color: string, x: number, y: number, width: number, height: number, margin: number) {\r\n        this.g.fillStyle = color;\r\n        this.g.fillRect(x + margin, y + margin, width - 2 * margin, height - 2 * margin);\r\n    }\r\n\r\n    protected drawText(text: string, x: number, y: number, align: CanvasTextAlign) {\r\n        this.g.textAlign = align;\r\n        this.g.strokeText(text, x, y);\r\n        this.g.fillText(text, x, y);\r\n    }\r\n\r\n    protected redraw(): void {\r\n        if ((this.visible || this.wasVisible) && this.onRedraw()) {\r\n            this.wasVisible = this.visible;\r\n            this.dispatchEvent(this.redrawnEvt);\r\n        }\r\n    }\r\n\r\n    get canvas() {\r\n        return this._canvas;\r\n    }\r\n\r\n    protected get g() {\r\n        return this._g;\r\n    }\r\n\r\n    get imageWidth(): number {\r\n        return this.canvas.width;\r\n    }\r\n\r\n    get imageHeight(): number {\r\n        return this.canvas.height;\r\n    }\r\n\r\n    get aspectRatio(): number {\r\n        return this.imageWidth / this.imageHeight;\r\n    }\r\n\r\n    get width(): number {\r\n        return this.imageWidth / this.scale;\r\n    }\r\n\r\n    get height(): number {\r\n        return this.imageHeight / this.scale;\r\n    }\r\n\r\n    get scale() {\r\n        return this._scale;\r\n    }\r\n\r\n    set scale(v) {\r\n        if (this.scale !== v) {\r\n            this._scale = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get visible() {\r\n        return this._visible;\r\n    }\r\n\r\n    set visible(v) {\r\n        if (this.visible !== v) {\r\n            this.wasVisible = this._visible;\r\n            this._visible = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    protected abstract onRedraw(): boolean;\r\n}\r\n", "import { deg2rad } from \"@juniper-lib/tslib\";\r\nimport { CanvasImage } from \"./CanvasImage\";\r\n\r\nexport class ArtificialHorizon extends CanvasImage {\r\n\r\n    private _pitch = 0;\r\n    private _heading = 0;\r\n\r\n    constructor() {\r\n        super(128, 128);\r\n\r\n        this.redraw();\r\n    }\r\n\r\n    get pitch(): number {\r\n        return this._pitch;\r\n    }\r\n\r\n    set pitch(v: number) {\r\n        if (v !== this.pitch) {\r\n            this._pitch = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get heading(): number {\r\n        return this._heading;\r\n    }\r\n\r\n    set heading(v: number) {\r\n        if (v !== this.heading) {\r\n            this._heading = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    setPitchAndHeading(pitch: number, heading: number) {\r\n        if (pitch !== this.pitch\r\n            || heading !== this.heading) {\r\n            this._pitch = pitch;\r\n            this._heading = heading;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    protected onRedraw(): boolean {\r\n        const a = deg2rad(this.pitch);\r\n        const b = deg2rad(this.heading - 180);\r\n        const p = 5;\r\n        const w = this.canvas.width - 2 * p;\r\n        const h = this.canvas.height - 2 * p;\r\n        const hw = 0.5 * w;\r\n        const hh = 0.5 * h;\r\n        const y = Math.sin(a);\r\n        const g = this.g;\r\n\r\n        g.save();\r\n        {\r\n            g.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n            g.translate(p, p);\r\n            g.scale(hw, hh);\r\n            g.translate(1, 1);\r\n\r\n            g.fillStyle = \"#808080\";\r\n            g.beginPath();\r\n            g.arc(0, 0, 1, 0, 2 * Math.PI);\r\n            g.fill();\r\n\r\n            g.fillStyle = \"#d0d0d0\";\r\n            g.beginPath();\r\n            g.arc(0, 0, 1, 0, Math.PI, true);\r\n            g.fill();\r\n\r\n            g.save();\r\n            {\r\n                g.scale(1, Math.abs(y));\r\n                if (y < 0) {\r\n                    g.fillStyle = \"#808080\";\r\n                }\r\n                g.beginPath();\r\n                g.arc(0, 0, 1, 0, Math.PI, y < 0);\r\n                g.fill();\r\n            }\r\n            g.restore();\r\n\r\n            g.save();\r\n            {\r\n                g.shadowColor = \"#404040\";\r\n                g.shadowBlur = 4;\r\n                g.shadowOffsetX = 3;\r\n                g.shadowOffsetY = 3;\r\n\r\n                g.rotate(b);\r\n\r\n                g.fillStyle = \"#ff0000\";\r\n                g.beginPath();\r\n                g.moveTo(-0.1, 0);\r\n                g.lineTo(0, 0.667);\r\n                g.lineTo(0.1, 0);\r\n                g.closePath();\r\n                g.fill();\r\n\r\n                g.fillStyle = \"#ffffff\";\r\n                g.beginPath();\r\n                g.moveTo(-0.1, 0);\r\n                g.lineTo(0, -0.667);\r\n                g.lineTo(0.1, 0);\r\n                g.closePath();\r\n                g.fill();\r\n            }\r\n            g.restore();\r\n\r\n            g.beginPath();\r\n            g.strokeStyle = \"#000000\";\r\n            g.lineWidth = 0.1;\r\n            g.arc(0, 0, 1, 0, 2 * Math.PI);\r\n            g.stroke();\r\n        }\r\n        g.restore();\r\n\r\n        return true;\r\n    }\r\n}\r\n", "import type { IProgress } from \"@juniper-lib/tslib\";\r\nimport { isString, singleton } from \"@juniper-lib/tslib\";\r\n\r\nconst DEFAULT_TEST_TEXT = \"The quick brown fox jumps over the lazy dog\";\r\nconst loadedFonts = singleton<string[]>(\"juniper::loadedFonts\", () => []);\r\n\r\nexport interface FontDescription {\r\n    fontSize: number;\r\n    fontFamily: string;\r\n\r\n    fontStyle?: string;\r\n    fontVariant?: string;\r\n    fontWeight?: string;\r\n}\r\n\r\nexport function makeFont(style: FontDescription): string {\r\n    const fontParts = [];\r\n    if (style.fontStyle && style.fontStyle !== \"normal\") {\r\n        fontParts.push(style.fontStyle);\r\n    }\r\n\r\n    if (style.fontVariant && style.fontVariant !== \"normal\") {\r\n        fontParts.push(style.fontVariant);\r\n    }\r\n\r\n    if (style.fontWeight && style.fontWeight !== \"normal\") {\r\n        fontParts.push(style.fontWeight);\r\n    }\r\n\r\n    fontParts.push(`${style.fontSize}px`);\r\n    fontParts.push(style.fontFamily);\r\n\r\n    return fontParts.join(\" \");\r\n}\r\n\r\nexport async function loadFont(font: string | FontDescription, testString: string | null = null, prog?: IProgress) {\r\n    if (!isString(font)) {\r\n        font = makeFont(font);\r\n    }\r\n\r\n    if (loadedFonts.indexOf(font) === -1) {\r\n        testString = testString || DEFAULT_TEST_TEXT;\r\n        if (prog) {\r\n            prog.start(font);\r\n        }\r\n        const fonts = await document.fonts.load(font, testString);\r\n        if (prog) {\r\n            prog.end(font);\r\n        }\r\n        if (fonts.length === 0) {\r\n            console.warn(`Failed to load font \"${font}\". If this is a system font, just set the object's \\`value\\` property, instead of calling \\`loadFontAndSetText\\`.`);\r\n        }\r\n        else {\r\n            loadedFonts.push(font);\r\n        }\r\n    }\r\n}", "import { makeFont } from \"@juniper-lib/dom/fonts\";\r\nimport { CanvasImage } from \"./CanvasImage\";\r\n\r\nfunction isBatteryNavigator(nav: Navigator): nav is BatteryNavigator {\r\n    return \"getBattery\" in nav;\r\n}\r\n\r\nconst chargeLabels = [\r\n    \"\",\r\n    \"N/A\",\r\n    \"charging\"\r\n];\r\n\r\nexport class BatteryImage extends CanvasImage {\r\n    static readonly isAvailable = isBatteryNavigator(navigator);\r\n    private battery: BatteryManager = null;\r\n    private lastChargeDirection: number = null;\r\n    private lastLevel: number = null;\r\n    private chargeDirection = 0;\r\n    private level = 0.5;\r\n\r\n    constructor() {\r\n        super(256, 128);\r\n\r\n        if (isBatteryNavigator(navigator)) {\r\n            this.readBattery(navigator);\r\n        }\r\n        else {\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    protected onRedraw(): boolean {\r\n        if (this.battery) {\r\n            this.chargeDirection = this.battery.charging ? 1 : -1;\r\n            this.level = this.battery.level;\r\n        }\r\n        else {\r\n            this.level += 0.1;\r\n            if (this.level > 1) {\r\n                this.level = 0;\r\n            }\r\n        }\r\n\r\n        const directionChanged = this.chargeDirection !== this.lastChargeDirection;\r\n        const levelChanged = this.level !== this.lastLevel;\r\n\r\n        if (!directionChanged && !levelChanged) {\r\n            return false;\r\n        }\r\n\r\n        this.lastChargeDirection = this.chargeDirection;\r\n        this.lastLevel = this.level;\r\n\r\n        const levelColor = this.level < 0.10\r\n            ? \"red\"\r\n            : \"#ccc\";\r\n\r\n        const padding = 7;\r\n        const scale = 0.7;\r\n        const invScale = (1 - scale) / 2;\r\n        const bodyWidth = this.canvas.width - 2 * padding;\r\n        const width = bodyWidth - 4 * padding;\r\n        const height = this.canvas.height - 4 * padding;\r\n        const midX = bodyWidth / 2;\r\n        const midY = this.canvas.height / 2;\r\n        const label = chargeLabels[this.chargeDirection + 1];\r\n\r\n        this.g.clearRect(0, 0, bodyWidth, this.canvas.height);\r\n\r\n        this.g.save();\r\n        this.g.translate(invScale * this.canvas.width, invScale * this.canvas.height);\r\n        this.g.globalAlpha = 0.75;\r\n        this.g.scale(scale, scale);\r\n\r\n        this.fillRect(\"#ccc\", 0, 0, bodyWidth, this.canvas.height, 0);\r\n        this.fillRect(\"#ccc\", bodyWidth, midY - 2 * padding - 10, padding + 10, 4 * padding + 20, 0);\r\n        this.g.clearRect(padding, padding, bodyWidth - 2 * padding, this.canvas.height - 2 * padding);\r\n        this.fillRect(\"black\", padding, padding, bodyWidth - 2 * padding, this.canvas.height - 2 * padding, 0);\r\n        this.g.clearRect(2 * padding, 2 * padding, width * this.level, height);\r\n        this.fillRect(levelColor, 2 * padding, 2 * padding, width * this.level, height, 0);\r\n\r\n        this.g.fillStyle = \"white\";\r\n        this.g.strokeStyle = \"black\";\r\n        this.g.lineWidth = 4;\r\n        this.g.textBaseline = \"middle\";\r\n\r\n        this.g.font = makeFont({\r\n            fontSize: height / 2,\r\n            fontFamily: \"Lato\"\r\n        });\r\n\r\n        this.drawText(label, midX, midY, \"center\");\r\n\r\n        this.g.restore();\r\n\r\n        return true;\r\n    }\r\n\r\n    private async readBattery(navigator: BatteryNavigator) {\r\n        const redraw = this.redraw.bind(this);\r\n        redraw();\r\n\r\n        this.battery = await navigator.getBattery();\r\n\r\n        this.battery.addEventListener(\"chargingchange\", redraw);\r\n        this.battery.addEventListener(\"levelchange\", redraw);\r\n\r\n        setInterval(redraw, 1000);\r\n        redraw();\r\n    }\r\n}\r\n\r\n", "import { Context2D, createUtilityCanvas, setContextSize } from \"@juniper-lib/dom/canvas\";\r\nimport { makeFont } from \"@juniper-lib/dom/fonts\";\r\nimport { clamp, isDefined, isNullOrUndefined, isNumber, PaddingRect } from \"@juniper-lib/tslib\";\r\nimport { CanvasImage, CanvasImageOptions } from \"./CanvasImage\";\r\n\r\nexport type TextDirection = \"horizontal\" | \"vertical\";\r\n\r\nexport interface TextImageOptions extends CanvasImageOptions {\r\n    minWidth: number;\r\n    maxWidth: number;\r\n    minHeight: number;\r\n    maxHeight: number;\r\n    freezeDimensions: boolean;\r\n\r\n    bgFillColor: string;\r\n    bgStrokeColor: string;\r\n    bgStrokeSize: number;\r\n\r\n    textStrokeColor: string;\r\n    textStrokeSize: number;\r\n    textFillColor: string;\r\n    textDirection: TextDirection;\r\n    wrapWords: boolean;\r\n\r\n    fontStyle: string;\r\n    fontVariant: string;\r\n    fontWeight: string;\r\n    fontFamily: string;\r\n    fontSize: number;\r\n\r\n    padding: PaddingRect | number;\r\n\r\n    value: string;\r\n}\r\n\r\nexport class TextImage extends CanvasImage {\r\n    private trueWidth: number = null;\r\n    private trueHeight: number = null;\r\n    private trueFontSize: number = null;\r\n    private dx: number = null;\r\n\r\n    private _minWidth: number = null;\r\n    private _maxWidth: number = null;\r\n    private _minHeight: number = null;\r\n    private _maxHeight: number = null;\r\n    private _freezeDimensions: boolean = false;\r\n    private _dimensionsFrozen: boolean = false;\r\n\r\n    private _bgFillColor: string = null;\r\n    private _bgStrokeColor: string = null;\r\n    private _bgStrokeSize: number = null;\r\n\r\n    private _textStrokeColor: string = null;\r\n    private _textStrokeSize: number = null;\r\n    private _textFillColor = \"black\";\r\n    private _textDirection = \"horizontal\";\r\n    private _wrapWords = true;\r\n\r\n    private _fontStyle = \"normal\";\r\n    private _fontVariant = \"normal\";\r\n    private _fontWeight = \"normal\";\r\n    private _fontFamily = \"sans-serif\";\r\n    private _fontSize = 20;\r\n\r\n    private _padding: PaddingRect;\r\n\r\n    private _value: string = null;\r\n\r\n    constructor(options?: Partial<TextImageOptions>) {\r\n        super(10, 10, options);\r\n\r\n        if (isDefined(options)) {\r\n            if (isDefined(options.minWidth)) {\r\n                this._minWidth = options.minWidth;\r\n            }\r\n\r\n            if (isDefined(options.maxWidth)) {\r\n                this._maxWidth = options.maxWidth;\r\n            }\r\n\r\n            if (isDefined(options.minHeight)) {\r\n                this._minHeight = options.minHeight;\r\n            }\r\n\r\n            if (isDefined(options.maxHeight)) {\r\n                this._maxHeight = options.maxHeight;\r\n            }\r\n\r\n            if (isDefined(options.freezeDimensions)) {\r\n                this._freezeDimensions = options.freezeDimensions;\r\n            }\r\n\r\n            if (isDefined(options.textStrokeColor)) {\r\n                this._textStrokeColor = options.textStrokeColor;\r\n            }\r\n\r\n            if (isDefined(options.textStrokeSize)) {\r\n                this._textStrokeSize = options.textStrokeSize;\r\n            }\r\n\r\n            if (isDefined(options.bgFillColor)) {\r\n                this._bgFillColor = options.bgFillColor;\r\n            }\r\n\r\n            if (isDefined(options.bgStrokeColor)) {\r\n                this._bgStrokeColor = options.bgStrokeColor;\r\n            }\r\n\r\n            if (isDefined(options.bgStrokeSize)) {\r\n                this._bgStrokeSize = options.bgStrokeSize;\r\n            }\r\n\r\n            if (isDefined(options.value)) {\r\n                this._value = options.value;\r\n            }\r\n\r\n            if (isDefined(options.textFillColor)) {\r\n                this._textFillColor = options.textFillColor;\r\n            }\r\n\r\n            if (isDefined(options.textDirection)) {\r\n                this._textDirection = options.textDirection;\r\n            }\r\n\r\n            if (isDefined(options.wrapWords)) {\r\n                this._wrapWords = options.wrapWords;\r\n            }\r\n\r\n            if (isDefined(options.fontStyle)) {\r\n                this._fontStyle = options.fontStyle;\r\n            }\r\n\r\n            if (isDefined(options.fontVariant)) {\r\n                this._fontVariant = options.fontVariant;\r\n            }\r\n\r\n            if (isDefined(options.fontWeight)) {\r\n                this._fontWeight = options.fontWeight;\r\n            }\r\n\r\n            if (isDefined(options.fontFamily)) {\r\n                this._fontFamily = options.fontFamily;\r\n            }\r\n\r\n            if (isDefined(options.fontSize)) {\r\n                this._fontSize = options.fontSize;\r\n            }\r\n\r\n            if (isDefined(options.padding)) {\r\n                if (isNumber(options.padding)) {\r\n                    this._padding = {\r\n                        left: options.padding,\r\n                        right: options.padding,\r\n                        top: options.padding,\r\n                        bottom: options.padding\r\n                    };\r\n                }\r\n                else {\r\n                    this._padding = options.padding;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (isNullOrUndefined(this._padding)) {\r\n            this._padding = {\r\n                top: 0,\r\n                right: 0,\r\n                bottom: 0,\r\n                left: 0\r\n            };\r\n        }\r\n\r\n        this.redraw();\r\n    }\r\n\r\n    get minWidth() {\r\n        return this._minWidth;\r\n    }\r\n\r\n    set minWidth(v) {\r\n        if (this.minWidth !== v) {\r\n            this._minWidth = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get maxWidth() {\r\n        return this._maxWidth;\r\n    }\r\n\r\n    set maxWidth(v) {\r\n        if (this.maxWidth !== v) {\r\n            this._maxWidth = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get minHeight() {\r\n        return this._minHeight;\r\n    }\r\n\r\n    set minHeight(v) {\r\n        if (this.minHeight !== v) {\r\n            this._minHeight = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get maxHeight() {\r\n        return this._maxHeight;\r\n    }\r\n\r\n    set maxHeight(v) {\r\n        if (this.maxHeight !== v) {\r\n            this._maxHeight = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n\r\n    get padding() {\r\n        return this._padding;\r\n    }\r\n\r\n    set padding(v) {\r\n        if (v instanceof Array) {\r\n            throw new Error(\"Invalid padding\");\r\n        }\r\n        if (this.padding.top !== v.top\r\n            || this.padding.right != v.right\r\n            || this.padding.bottom != v.bottom\r\n            || this.padding.left != v.left) {\r\n            this._padding = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get wrapWords() {\r\n        return this._wrapWords;\r\n    }\r\n\r\n    set wrapWords(v) {\r\n        if (this.wrapWords !== v) {\r\n            this._wrapWords = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get textDirection() {\r\n        return this._textDirection;\r\n    }\r\n\r\n    set textDirection(v) {\r\n        if (this.textDirection !== v) {\r\n            this._textDirection = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get fontStyle() {\r\n        return this._fontStyle;\r\n    }\r\n\r\n    set fontStyle(v) {\r\n        if (this.fontStyle !== v) {\r\n            this._fontStyle = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get fontVariant() {\r\n        return this._fontVariant;\r\n    }\r\n\r\n    set fontVariant(v) {\r\n        if (this.fontVariant !== v) {\r\n            this._fontVariant = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get fontWeight() {\r\n        return this._fontWeight;\r\n    }\r\n\r\n    set fontWeight(v) {\r\n        if (this.fontWeight !== v) {\r\n            this._fontWeight = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get fontSize() {\r\n        return this._fontSize;\r\n    }\r\n\r\n    set fontSize(v) {\r\n        if (this.fontSize !== v) {\r\n            this._fontSize = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get fontFamily() {\r\n        return this._fontFamily;\r\n    }\r\n\r\n    set fontFamily(v) {\r\n        if (this.fontFamily !== v) {\r\n            this._fontFamily = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get textFillColor() {\r\n        return this._textFillColor;\r\n    }\r\n\r\n    set textFillColor(v) {\r\n        if (this.textFillColor !== v) {\r\n            this._textFillColor = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get textStrokeColor() {\r\n        return this._textStrokeColor;\r\n    }\r\n\r\n    set textStrokeColor(v) {\r\n        if (this.textStrokeColor !== v) {\r\n            this._textStrokeColor = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get textStrokeSize() {\r\n        return this._textStrokeSize;\r\n    }\r\n\r\n    set textStrokeSize(v) {\r\n        if (this.textStrokeSize !== v) {\r\n            this._textStrokeSize = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get bgFillColor() {\r\n        return this._bgFillColor;\r\n    }\r\n\r\n    set bgFillColor(v) {\r\n        if (this.bgFillColor !== v) {\r\n            this._bgFillColor = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get bgStrokeColor() {\r\n        return this._bgStrokeColor;\r\n    }\r\n\r\n    set bgStrokeColor(v) {\r\n        if (this.bgStrokeColor !== v) {\r\n            this._bgStrokeColor = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get bgStrokeSize() {\r\n        return this._bgStrokeSize;\r\n    }\r\n\r\n    set bgStrokeSize(v) {\r\n        if (this.bgStrokeSize !== v) {\r\n            this._bgStrokeSize = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get value() {\r\n        return this._value;\r\n    }\r\n\r\n    set value(v) {\r\n        if (this.value !== v) {\r\n            this._value = v;\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    draw(g: Context2D, x: number, y: number) {\r\n        if (this.canvas.width > 0\r\n            && this.canvas.height > 0) {\r\n            g.drawImage(this.canvas, x, y, this.width, this.height);\r\n        }\r\n    }\r\n\r\n    private split(value: string) {\r\n        if (this.wrapWords) {\r\n            return value\r\n                .split(' ')\r\n                .join('\\n')\r\n                .replace(/\\r\\n/, '\\n')\r\n                .split('\\n');\r\n        }\r\n        else {\r\n            return value\r\n                .replace(/\\r\\n/, '\\n')\r\n                .split('\\n');\r\n        }\r\n    }\r\n\r\n    protected unfreeze() {\r\n        this._dimensionsFrozen = false;\r\n    }\r\n\r\n    protected onRedraw() {\r\n        this.g.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n        if (this.visible\r\n            && this.fontFamily\r\n            && this.fontSize\r\n            && (this.textFillColor || (this.textStrokeColor && this.textStrokeSize))\r\n            && this.value) {\r\n\r\n            const lines = this.split(this.value);\r\n            const isVertical = this.textDirection && this.textDirection.indexOf(\"vertical\") === 0;\r\n\r\n            if (this.trueWidth === null\r\n                || this.trueHeight === null\r\n                || this.dx === null\r\n                || this.trueFontSize === null\r\n                || !this._dimensionsFrozen) {\r\n\r\n                this._dimensionsFrozen = this._freezeDimensions;\r\n\r\n                const autoResize = this.minWidth != null\r\n                    || this.maxWidth != null\r\n                    || this.minHeight != null\r\n                    || this.maxHeight != null;\r\n\r\n                const _targetMinWidth = ((this.minWidth || 0) - this.padding.right - this.padding.left) * this.scale;\r\n                const _targetMaxWidth = ((this.maxWidth || 4096) - this.padding.right - this.padding.left) * this.scale;\r\n                const _targetMinHeight = ((this.minHeight || 0) - this.padding.top - this.padding.bottom) * this.scale;\r\n                const _targetMaxHeight = ((this.maxHeight || 4096) - this.padding.top - this.padding.bottom) * this.scale;\r\n\r\n                const targetMinWidth = isVertical ? _targetMinHeight : _targetMinWidth;\r\n                const targetMaxWidth = isVertical ? _targetMaxHeight : _targetMaxWidth;\r\n                const targetMinHeight = isVertical ? _targetMinWidth : _targetMinHeight;\r\n                const targetMaxHeight = isVertical ? _targetMaxWidth : _targetMaxHeight;\r\n\r\n                const tried = [];\r\n\r\n\r\n                this.trueWidth = 0;\r\n                this.trueHeight = 0;\r\n\r\n                this.dx = 0;\r\n\r\n                let tooBig = false,\r\n                    tooSmall = false,\r\n                    highFontSize = 10000,\r\n                    lowFontSize = 0;\r\n\r\n                this.trueFontSize = clamp(this.fontSize * this.scale, lowFontSize, highFontSize);\r\n\r\n                let minFont = null,\r\n                    minFontDelta = Number.MAX_VALUE;\r\n                do {\r\n                    const realFontSize = this.fontSize;\r\n                    this._fontSize = this.trueFontSize;\r\n                    const font = makeFont(this);\r\n                    this._fontSize = realFontSize;\r\n\r\n                    this.g.textAlign = \"center\";\r\n                    this.g.textBaseline = \"middle\";\r\n                    this.g.font = font;\r\n\r\n                    this.trueWidth = 0;\r\n                    this.trueHeight = 0;\r\n                    for (const line of lines) {\r\n                        const metrics = this.g.measureText(line);\r\n                        this.trueWidth = Math.max(this.trueWidth, metrics.width);\r\n                        this.trueHeight += this.trueFontSize;\r\n                        if (isNumber(metrics.actualBoundingBoxLeft)\r\n                            && isNumber(metrics.actualBoundingBoxRight)\r\n                            && isNumber(metrics.actualBoundingBoxAscent)\r\n                            && isNumber(metrics.actualBoundingBoxDescent)) {\r\n                            if (!autoResize) {\r\n                                this.trueWidth = metrics.actualBoundingBoxLeft + metrics.actualBoundingBoxRight;\r\n                                this.trueHeight = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;\r\n                                this.dx = (metrics.actualBoundingBoxLeft - this.trueWidth / 2) / 2;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (autoResize) {\r\n                        const dMinWidth = this.trueWidth - targetMinWidth;\r\n                        const dMaxWidth = this.trueWidth - targetMaxWidth;\r\n                        const dMinHeight = this.trueHeight - targetMinHeight;\r\n                        const dMaxHeight = this.trueHeight - targetMaxHeight;\r\n\r\n                        const mdMinWidth = Math.abs(dMinWidth);\r\n                        const mdMaxWidth = Math.abs(dMaxWidth);\r\n                        const mdMinHeight = Math.abs(dMinHeight);\r\n                        const mdMaxHeight = Math.abs(dMaxHeight);\r\n\r\n                        tooBig = dMaxWidth > 1 || dMaxHeight > 1;\r\n                        tooSmall = dMinWidth < -1 && dMinHeight < -1;\r\n\r\n                        const minDif = Math.min(mdMinWidth, Math.min(mdMaxWidth, Math.min(mdMinHeight, mdMaxHeight)));\r\n                        if (minDif < minFontDelta) {\r\n                            minFontDelta = minDif;\r\n                            minFont = this.g.font;\r\n                        }\r\n\r\n                        if ((tooBig || tooSmall)\r\n                            && tried.indexOf(this.g.font) > -1\r\n                            && minFont) {\r\n                            this.g.font = minFont;\r\n                            tooBig = false;\r\n                            tooSmall = false;\r\n                        }\r\n\r\n                        if (tooBig) {\r\n                            highFontSize = this.trueFontSize;\r\n                            this.trueFontSize = (lowFontSize + this.trueFontSize) / 2;\r\n                        }\r\n                        else if (tooSmall) {\r\n                            lowFontSize = this.trueFontSize;\r\n                            this.trueFontSize = (this.trueFontSize + highFontSize) / 2;\r\n                        }\r\n                    }\r\n\r\n                    tried.push(this.g.font);\r\n                } while (tooBig || tooSmall);\r\n\r\n                if (autoResize) {\r\n                    if (this.trueWidth < targetMinWidth) {\r\n                        this.trueWidth = targetMinWidth;\r\n                    }\r\n                    else if (this.trueWidth > targetMaxWidth) {\r\n                        this.trueWidth = targetMaxWidth;\r\n                    }\r\n\r\n                    if (this.trueHeight < targetMinHeight) {\r\n                        this.trueHeight = targetMinHeight;\r\n                    }\r\n                    else if (this.trueHeight > targetMaxHeight) {\r\n                        this.trueHeight = targetMaxHeight;\r\n                    }\r\n                }\r\n\r\n                const newW = this.trueWidth + this.scale * (this.padding.right + this.padding.left);\r\n                const newH = this.trueHeight + this.scale * (this.padding.top + this.padding.bottom);\r\n                try {\r\n                    setContextSize(this.g, newW, newH);\r\n                }\r\n                catch (exp) {\r\n                    console.error(exp);\r\n                    throw exp;\r\n                }\r\n            }\r\n\r\n            if (this.bgFillColor) {\r\n                this.g.fillStyle = this.bgFillColor;\r\n                this.g.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n            }\r\n            else {\r\n                this.g.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n            }\r\n\r\n            if (this.textStrokeColor && this.textStrokeSize) {\r\n                this.g.lineWidth = this.textStrokeSize * this.scale;\r\n                this.g.strokeStyle = this.textStrokeColor;\r\n            }\r\n\r\n            if (this.textFillColor) {\r\n                this.g.fillStyle = this.textFillColor;\r\n            }\r\n\r\n            const di = 0.5 * (lines.length - 1);\r\n\r\n            for (let i = 0; i < lines.length; ++i) {\r\n                const line = lines[i];\r\n                const dy = (i - di) * this.trueFontSize;\r\n                const x = this.dx + this.trueWidth / 2 + this.scale * this.padding.left;\r\n                const y = dy + this.trueHeight / 2 + this.scale * this.padding.top;\r\n\r\n                if (this.textStrokeColor && this.textStrokeSize) {\r\n                    this.g.strokeText(line, x, y);\r\n                }\r\n\r\n                if (this.textFillColor) {\r\n                    this.g.fillText(line, x, y);\r\n                }\r\n            }\r\n\r\n            if (this.bgStrokeColor && this.bgStrokeSize) {\r\n                this.g.strokeStyle = this.bgStrokeColor;\r\n                this.g.lineWidth = this.bgStrokeSize * this.scale;\r\n                const s = this.bgStrokeSize / 2;\r\n                this.g.strokeRect(s, s, this.canvas.width - this.bgStrokeSize, this.canvas.height - this.bgStrokeSize);\r\n            }\r\n\r\n            if (isVertical) {\r\n                const canv = createUtilityCanvas(this.canvas.height, this.canvas.width);\r\n                const g = canv.getContext(\"2d\");\r\n                if (g) {\r\n                    g.translate(canv.width / 2, canv.height / 2);\r\n                    if (this.textDirection === \"vertical\"\r\n                        || this.textDirection === \"vertical-left\") {\r\n                        g.rotate(Math.PI / 2);\r\n                    }\r\n                    else if (this.textDirection === \"vertical-right\") {\r\n                        g.rotate(-Math.PI / 2);\r\n                    }\r\n                    g.translate(-this.canvas.width / 2, -this.canvas.height / 2);\r\n                    g.drawImage(this.canvas, 0, 0);\r\n                    setContextSize(this.g, canv.width, canv.height);\r\n                }\r\n                else {\r\n                    console.warn(\"Couldn't rotate the TextImage\");\r\n                }\r\n                this.g.drawImage(canv, 0, 0);\r\n            }\r\n\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n}", "import { getMonospaceFonts } from \"@juniper-lib/dom/css\";\r\nimport { TextImage } from \"./TextImage\";\r\n\r\nexport class ClockImage extends TextImage {\r\n    constructor() {\r\n        super({\r\n            textFillColor: \"#ffffff\",\r\n            textStrokeColor: \"rgba(0, 0, 0, 0.25)\",\r\n            textStrokeSize: 0.05,\r\n            fontFamily: getMonospaceFonts(),\r\n            fontSize: 20,\r\n            minHeight: 1,\r\n            maxHeight: 1,\r\n            padding: 0.3,\r\n            wrapWords: false,\r\n            freezeDimensions: true\r\n        });\r\n\r\n        const updater = this.update.bind(this);\r\n        setInterval(updater, 500);\r\n        updater();\r\n    }\r\n\r\n    private fps: number = null;\r\n    private drawCalls: number = null;\r\n    private triangles: number = null;\r\n\r\n    setStats(fps: number, drawCalls: number, triangles: number): void {\r\n        this.fps = fps;\r\n        this.drawCalls = drawCalls;\r\n        this.triangles = triangles;\r\n    }\r\n\r\n    private lastLen: number = 0;\r\n\r\n    protected update(): void {\r\n        const time = new Date();\r\n        let value = time.toLocaleTimeString();\r\n        if (this.fps !== null) {\r\n            value += ` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`;\r\n        }\r\n\r\n        if (value.length !== this.lastLen) {\r\n            this.lastLen = value.length;\r\n            this.unfreeze();\r\n        }\r\n\r\n        this.value = value;\r\n    }\r\n}\r\n\r\n", "const gestures = [\r\n    \"change\",\r\n    \"click\",\r\n    \"contextmenu\",\r\n    \"dblclick\",\r\n    \"mouseup\",\r\n    \"pointerup\",\r\n    \"reset\",\r\n    \"submit\",\r\n    \"touchend\"\r\n];\r\n\r\n/**\r\n * This is not an event handler that you can add to an element. It's a global event that\r\n * waits for the user to perform some sort of interaction with the website.\r\n  */\r\nexport function onUserGesture(callback: () => any, test?: () => Promise<boolean>) {\r\n    const realTest = test || (async () => true);\r\n\r\n    const check = async (evt: Event) => {\r\n        if (evt.isTrusted && await realTest()) {\r\n            for (const gesture of gestures) {\r\n                window.removeEventListener(gesture, check);\r\n            }\r\n\r\n            await callback();\r\n        }\r\n    };\r\n\r\n    for (const gesture of gestures) {\r\n        window.addEventListener(gesture, check);\r\n    }\r\n}\r\n\r\n", "import { onUserGesture } from \"@juniper-lib/dom/onUserGesture\";\r\nimport { assertNever, GraphNode, IDisposable, isArray, isDefined, isFunction, isNullOrUndefined, once, singleton } from \"@juniper-lib/tslib\";\r\n\r\nexport const hasAudioContext = \"AudioContext\" in globalThis;\r\nexport const hasAudioListener = hasAudioContext && \"AudioListener\" in globalThis;\r\nexport const hasOldAudioListener = hasAudioListener && \"setPosition\" in AudioListener.prototype;\r\nexport const hasNewAudioListener = hasAudioListener && \"positionX\" in AudioListener.prototype;\r\nexport const canCaptureStream = isFunction(HTMLMediaElement.prototype.captureStream)\r\n    || isFunction(HTMLMediaElement.prototype.mozCaptureStream);\r\n\r\nexport interface WrappedAudioNode extends IDisposable {\r\n    node: AudioNode;\r\n}\r\n\r\nexport function isWrappedAudioNode(value: any): value is WrappedAudioNode {\r\n    return isDefined(value)\r\n        && value.node instanceof AudioNode;\r\n}\r\n\r\nexport interface ErsatzAudioNode extends IDisposable {\r\n    input: AudioNode;\r\n    output: AudioNode;\r\n}\r\n\r\nexport function isErsatzAudioNode(value: any): value is ErsatzAudioNode {\r\n    return isDefined(value)\r\n        && value.input instanceof AudioNode\r\n        && value.output instanceof AudioNode;\r\n}\r\n\r\nexport type AudioNodeType = AudioNode | WrappedAudioNode | ErsatzAudioNode;\r\n\r\nexport type AudioVertex = AudioNodeType | AudioParam;\r\n\r\nexport type AudioConnection\r\n    = AudioVertex\r\n    | [number, AudioVertex]\r\n    | [number, number, AudioNodeType];\r\n\r\nexport type BaseAudioNodeParamType = number | ChannelCountMode | ChannelInterpretation;\r\n\r\nconst connections = singleton(\"Juniper:Audio:connections\", () => new Map<AudioNode, Set<AudioNode | AudioParam>>());\r\nconst names = singleton(\"Juniper:Audio:names\", () => new Map<AudioNode | AudioParam, string>());\r\n\r\nfunction resolveOutput(node: AudioNodeType): AudioNode {\r\n    if (isErsatzAudioNode(node)) {\r\n        return node.output;\r\n    }\r\n    else if (isWrappedAudioNode(node)) {\r\n        return node.node;\r\n    }\r\n\r\n    return node;\r\n}\r\n\r\nexport function resolveInput(node: AudioConnection): AudioNode | AudioParam {\r\n    if (isNullOrUndefined(node)) {\r\n        return undefined;\r\n    }\r\n\r\n    let n: AudioVertex = null;\r\n    if (isArray(node)) {\r\n        if (node.length === 2) {\r\n            n = node[1];\r\n        }\r\n        else {\r\n            n = node[2];\r\n        }\r\n    }\r\n    else {\r\n        n = node;\r\n    }\r\n\r\n    let n2: AudioNode | AudioParam = null;\r\n    if (isErsatzAudioNode(n)) {\r\n        n2 = n.input;\r\n    }\r\n    else if (isWrappedAudioNode(n)) {\r\n        n2 = n.node;\r\n    }\r\n    else {\r\n        n2 = n;\r\n    }\r\n\r\n    return n2;\r\n}\r\n\r\nexport function resolveArray(node: AudioConnection): number[] {\r\n    if (!isArray(node)) {\r\n        return [];\r\n    }\r\n    else if (node.length === 2) {\r\n        return [node[0]];\r\n    }\r\n    else {\r\n        return [node[0], node[1]];\r\n    }\r\n}\r\n\r\nfunction isAudioNode(a: AudioVertex | number): a is AudioNode {\r\n    return isDefined(a)\r\n        && isDefined((a as AudioNode).context);\r\n}\r\n\r\nfunction nameVertex(name: string, v: AudioNode | AudioParam): void {\r\n    names.set(v, name);\r\n}\r\n\r\nexport function getVertexName(v: AudioNode | AudioParam): string {\r\n    return names.get(v);\r\n}\r\n\r\nexport function removeVertex(v: AudioNode | AudioParam): void {\r\n    names.delete(v);\r\n    if (isAudioNode(v)) {\r\n        disconnect(v);\r\n    }\r\n}\r\n\r\nexport function chain(...nodes: AudioNodeType[]): void {\r\n    for (let i = 1; i < nodes.length; ++i) {\r\n        connect(nodes[i - 1], nodes[i]);\r\n    }\r\n}\r\n\r\nexport function connect(left: AudioNodeType, right: AudioConnection): boolean {\r\n    const a = resolveOutput(left);\r\n    const b = resolveInput(right);\r\n    const c = resolveArray(right);\r\n\r\n    if (isNullOrUndefined(b)) {\r\n        throw new Error(\"Must have a target to connect to\");\r\n    }\r\n    else if (b instanceof AudioParam) {\r\n        a.connect(b, c[0]);\r\n    }\r\n    else if (b instanceof AudioNode) {\r\n        a.connect(b, c[0], c[1]);\r\n    }\r\n    else {\r\n        assertNever(b);\r\n    }\r\n\r\n    if (!connections.has(a)) {\r\n        connections.set(a, new Set<AudioNode | AudioParam>());\r\n    }\r\n\r\n    const g = connections.get(a);\r\n    if (g.has(b)) {\r\n        return false;\r\n    }\r\n\r\n    g.add(b);\r\n\r\n    return true;\r\n}\r\n\r\nexport function disconnect(left: AudioNodeType, right?: AudioConnection): boolean {\r\n    const a = resolveOutput(left);\r\n    const b = resolveInput(right);\r\n    const c = resolveArray(right);\r\n\r\n    if (isNullOrUndefined(b)) {\r\n        a.disconnect();\r\n    }\r\n    else if (b instanceof AudioParam) {\r\n        a.disconnect(b, c[0]);\r\n    }\r\n    else if (b instanceof AudioNode) {\r\n        a.disconnect(b, c[0], c[1]);\r\n    }\r\n    else {\r\n        assertNever(b);\r\n    }\r\n\r\n    if (!connections.has(a)) {\r\n        return false;\r\n    }\r\n\r\n    const g = connections.get(a);\r\n\r\n    let removed = false;\r\n    if (isNullOrUndefined(b)) {\r\n        removed = g.size > 0;\r\n        g.clear();\r\n    }\r\n    else if (g.has(b)) {\r\n        removed = true;\r\n        g.delete(b);\r\n    }\r\n\r\n    if (g.size === 0) {\r\n        connections.delete(a);\r\n    }\r\n\r\n    return removed;\r\n}\r\n\r\nexport function getAudioGraph(): Array<GraphNode<AudioNode | AudioParam>> {\r\n    const nodes = new Map<AudioNode | AudioParam, GraphNode<AudioNode | AudioParam>>();\r\n\r\n    function maybeAdd(node: AudioNode | AudioParam) {\r\n        if (!nodes.has(node)) {\r\n            nodes.set(node, new GraphNode(node));\r\n        }\r\n    }\r\n\r\n    for (const node of names.keys()) {\r\n        maybeAdd(node);\r\n    }\r\n\r\n    for (const [parent, children] of connections) {\r\n        maybeAdd(parent);\r\n        for (const child of children) {\r\n            maybeAdd(child);\r\n        }\r\n    }\r\n\r\n    for (const [parent, children] of connections) {\r\n        const branch = nodes.get(parent);\r\n        for (const child of children) {\r\n            if (nodes.has(child)) {\r\n                branch.connectTo(nodes.get(child));\r\n            }\r\n        }\r\n    }\r\n\r\n    return Array.from(nodes.values());\r\n}\r\n\r\n(globalThis as any).getAudioGraph = getAudioGraph;\r\n\r\nexport async function audioReady(audioCtx: AudioContext) {\r\n    nameVertex(\"speakers\", audioCtx.destination);\r\n    if (audioCtx.state !== \"running\") {\r\n        if (audioCtx.state === \"closed\") {\r\n            await audioCtx.resume();\r\n        }\r\n        else if (audioCtx.state === \"suspended\") {\r\n            const stateChange = once<BaseAudioContextEventMap>(audioCtx, \"statechange\");\r\n            onUserGesture(() => audioCtx.resume());\r\n            await stateChange;\r\n        }\r\n        else {\r\n            assertNever(audioCtx.state);\r\n        }\r\n    }\r\n}\r\n\r\nexport function initAudio<NodeT extends AudioNode>(name: string, left: NodeT, ...rest: AudioConnection[]) {\r\n    nameVertex(name, left);\r\n\r\n    for (const right of rest) {\r\n        if (isDefined(right)) {\r\n            connect(left, right);\r\n        }\r\n    }\r\n\r\n    return left;\r\n}\r\n\r\n\r\nexport function Analyser(name: string, audioCtx: BaseAudioContext, options?: AnalyserOptions, ...rest: AudioConnection[]): AnalyserNode {\r\n    return initAudio(name, new AnalyserNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function AudioWorklet(nodeName: string, audioCtx: BaseAudioContext, workletName: string, options?: AudioWorkletNodeOptions, ...rest: AudioConnection[]): AudioWorkletNode {\r\n    return initAudio(nodeName, new AudioWorkletNode(audioCtx, workletName, options), ...rest);\r\n}\r\n\r\nexport function BiquadFilter(name: string, audioCtx: BaseAudioContext, options?: BiquadFilterOptions, ...rest: AudioConnection[]): BiquadFilterNode {\r\n    return initAudio(name, new BiquadFilterNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function BufferSource(name: string, audioCtx: BaseAudioContext, options?: AudioBufferSourceOptions, ...rest: AudioConnection[]): AudioBufferSourceNode {\r\n    return initAudio(name, new AudioBufferSourceNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function ChannelMerger(name: string, audioCtx: BaseAudioContext, options?: ChannelMergerOptions, ...rest: AudioConnection[]): ChannelMergerNode {\r\n    return initAudio(name, new ChannelMergerNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function ChannelSplitter(name: string, audioCtx: BaseAudioContext, options?: ChannelSplitterOptions, ...rest: AudioConnection[]): ChannelSplitterNode {\r\n    return initAudio(name, new ChannelSplitterNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function ConstantSource(name: string, audioCtx: BaseAudioContext, options?: ConstantSourceOptions, ...rest: AudioConnection[]): ConstantSourceNode {\r\n    return initAudio(name, new ConstantSourceNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function Convolver(name: string, audioCtx: BaseAudioContext, options?: ConvolverOptions, ...rest: AudioConnection[]): ConvolverNode {\r\n    return initAudio(name, new ConvolverNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function Delay(name: string, audioCtx: BaseAudioContext, options?: DelayOptions, ...rest: AudioConnection[]): DelayNode {\r\n    return initAudio(name, new DelayNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function DynamicsCompressor(name: string, audioCtx: BaseAudioContext, options?: DynamicsCompressorOptions, ...rest: AudioConnection[]): DynamicsCompressorNode {\r\n    return initAudio(name, new DynamicsCompressorNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function Gain(name: string, audioCtx: BaseAudioContext, options?: GainOptions, ...rest: AudioConnection[]): GainNode {\r\n    return initAudio(name, new GainNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function IIRFilter(name: string, audioCtx: BaseAudioContext, options?: IIRFilterOptions, ...rest: AudioConnection[]): IIRFilterNode {\r\n    return initAudio(name, new IIRFilterNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function MediaElementSource(name: string, audioCtx: AudioContext, mediaElement: HTMLMediaElement, ...rest: AudioConnection[]): MediaElementAudioSourceNode {\r\n    return initAudio(name, audioCtx.createMediaElementSource(mediaElement), ...rest);\r\n}\r\n\r\nexport function MediaStreamDestination(name: string, audioCtx: AudioContext, options?: AudioNodeOptions, ...rest: AudioConnection[]): MediaStreamAudioDestinationNode {\r\n    return initAudio(name, new MediaStreamAudioDestinationNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function MediaStreamSource(name: string, audioCtx: AudioContext, mediaStream: MediaStream, ...rest: AudioConnection[]): MediaStreamAudioSourceNode {\r\n    return initAudio(name, audioCtx.createMediaStreamSource(mediaStream), ...rest);\r\n}\r\n\r\nexport function Oscillator(name: string, audioCtx: BaseAudioContext, options?: OscillatorOptions, ...rest: AudioConnection[]): OscillatorNode {\r\n    return initAudio(name, new OscillatorNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function Panner(name: string, audioCtx: BaseAudioContext, options?: PannerOptions, ...rest: AudioConnection[]): PannerNode {\r\n    return initAudio(name, new PannerNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function StereoPanner(name: string, audioCtx: BaseAudioContext, options?: StereoPannerOptions, ...rest: AudioConnection[]): StereoPannerNode {\r\n    return initAudio(name, new StereoPannerNode(audioCtx, options), ...rest);\r\n}\r\n\r\nexport function WaveShaper(name: string, audioCtx: BaseAudioContext, options?: WaveShaperOptions, ...rest: AudioConnection[]): WaveShaperNode {\r\n    return initAudio(name, new WaveShaperNode(audioCtx, options), ...rest);\r\n}\r\n", "import { vec3 } from \"gl-matrix\";\r\n\r\n/**\r\n * A position and orientation, at a given time.\r\n **/\r\nexport class Pose {\r\n    t = 0;\r\n    p = vec3.create();\r\n    f = vec3.set(vec3.create(), 0, 0, -1);\r\n    u = vec3.set(vec3.create(), 0, 1, 0);\r\n    o = vec3.create();\r\n\r\n    /**\r\n     * Creates a new position and orientation, at a given time.\r\n     **/\r\n    constructor() {\r\n        Object.seal(this);\r\n    }\r\n\r\n\r\n    /**\r\n     * Sets the components of the pose.\r\n     */\r\n    set(px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this.setPosition(px, py, pz);\r\n        this.setOrientation(fx, fy, fz, ux, uy, uz);\r\n    }\r\n\r\n    setPosition(px: number, py: number, pz: number): void {\r\n        vec3.set(this.p, px, py, pz);\r\n    }\r\n\r\n    setOrientation(fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        vec3.set(this.f, fx, fy, fz);\r\n        vec3.set(this.u, ux, uy, uz);\r\n    }\r\n\r\n    setOffset(ox: number, oy: number, oz: number) {\r\n        vec3.set(this.o, ox, oy, oz);\r\n    }\r\n\r\n    /**\r\n     * Copies the components of another pose into this pose.\r\n     */\r\n    copy(other: Pose): void {\r\n        vec3.copy(this.p, other.p);\r\n        vec3.copy(this.f, other.f);\r\n        vec3.copy(this.u, other.u);\r\n        vec3.copy(this.o, other.o);\r\n    }\r\n}\r\n", "import { IDisposable, isDisposable, TypedEventBase } from \"@juniper-lib/tslib\";\r\nimport type { BaseSpatializer } from \"./BaseSpatializer\";\r\nimport type { IPoseable } from \"./IPoseable\";\r\nimport { Gain, removeVertex } from \"./nodes\";\r\nimport { Pose } from \"./Pose\";\r\n\r\nexport interface AudioElement\r\n    extends IDisposable, IPoseable {\r\n    volume: number;\r\n    audioTick(t: number): void;\r\n}\r\n\r\nexport abstract class BaseAudioElement<SpatializerT extends BaseSpatializer, EventT>\r\n    extends TypedEventBase<EventT>\r\n    implements AudioElement {\r\n    readonly pose = new Pose();\r\n    readonly volumeControl: GainNode;\r\n\r\n    constructor(\r\n        public id: string,\r\n        protected readonly audioCtx: AudioContext,\r\n        public readonly spatializer: SpatializerT) {\r\n        super();\r\n\r\n        this.volumeControl = Gain(`volume-control-${this.id}`, audioCtx);\r\n    }\r\n\r\n    get volume(): number {\r\n        return this.volumeControl.gain.value;\r\n    }\r\n\r\n    set volume(v: number) {\r\n        this.volumeControl.gain.value = v;\r\n    }\r\n\r\n    private disposed = false;\r\n    dispose(): void {\r\n        if (!this.disposed) {\r\n            this.onDisposing();\r\n            this.disposed = true;\r\n        }\r\n    }\r\n\r\n    protected onDisposing(): void {\r\n        removeVertex(this.volumeControl);\r\n        if (isDisposable(this.spatializer)) {\r\n            this.spatializer.dispose();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update the user.\r\n     */\r\n    audioTick(t: number): void {\r\n        this.spatializer.setPose(this.pose, t);\r\n    }\r\n}\r\n", "import type { Pose } from \"./Pose\";\r\n\r\n/**\r\n * Base class providing functionality for spatializers.\r\n */\r\nexport abstract class BaseSpatializer {\r\n\r\n    minDistance = 1;\r\n    maxDistance = 10;\r\n    protected algorithm: DistanceModelType = \"inverse\";\r\n\r\n    constructor(public readonly id: string) {\r\n    }\r\n\r\n    /**\r\n     * Sets parameters that alter spatialization.\r\n     **/\r\n    setAudioProperties(minDistance: number, maxDistance: number, algorithm: DistanceModelType): void {\r\n        this.minDistance = minDistance;\r\n        this.maxDistance = maxDistance;\r\n        this.algorithm = algorithm;\r\n    }\r\n\r\n    /**\r\n     * Performs the spatialization operation for the audio source's latest location.\r\n     */\r\n    abstract setPose(loc: Pose, t: number): void;\r\n}\r\n", "import { BaseSpatializer } from \"../../BaseSpatializer\";\r\nimport { ErsatzAudioNode, removeVertex } from \"../../nodes\";\r\n\r\n/**\r\n * Base class providing functionality for audio listeners.\r\n **/\r\nexport abstract class BaseEmitter\r\n    extends BaseSpatializer\r\n    implements ErsatzAudioNode {\r\n\r\n    input: AudioNode;\r\n    output: AudioNode;\r\n\r\n    private disposed = false;\r\n    dispose(): void {\r\n        if (!this.disposed) {\r\n            this.onDisposing();\r\n            this.disposed = true;\r\n        }\r\n    }\r\n\r\n    protected onDisposing() {\r\n        removeVertex(this.input);\r\n    }\r\n}\r\n\r\n", "import { singleton, stringRandom } from \"@juniper-lib/tslib\";\r\nimport { Gain } from \"../../nodes\";\r\nimport type { Pose } from \"../../Pose\";\r\nimport { BaseEmitter } from \"./BaseEmitter\";\r\n\r\nconst nodes = singleton(\"Juniper:Audio:Destinations:Spatializers:NoSpatializationNode:nodes\", () =>\r\n    new WeakMap<AudioContext, NoSpatializationNode>());\r\n\r\nexport class NoSpatializationNode extends BaseEmitter {\r\n\r\n    static instance(audioCtx: AudioContext): NoSpatializationNode {\r\n        if (!nodes.has(audioCtx)) {\r\n            const id = `no-spatialization-hook-${stringRandom(8)}`;\r\n            nodes.set(audioCtx, new NoSpatializationNode(id, audioCtx));\r\n        }\r\n\r\n        return nodes.get(audioCtx);\r\n    }\r\n\r\n    /**\r\n     * Creates a new \"spatializer\" that performs no panning. An anti-spatializer.\r\n     */\r\n    constructor(id: string, audioCtx: AudioContext) {\r\n        super(id);\r\n        this.input = this.output = Gain(this.id, audioCtx);\r\n        Object.seal(this);\r\n    }\r\n\r\n    setPose(_loc: Pose, _t: number): void {\r\n        // do nothing\r\n    }\r\n}\r\n", "import { BaseAudioElement } from \"../BaseAudioElement\";\r\nimport { connect, Gain, removeVertex } from \"../nodes\";\r\nimport { NoSpatializationNode } from \"../sources/spatializers/NoSpatializationNode\";\r\nimport type { BaseListener } from \"./spatializers/BaseListener\";\r\n\r\nexport type DestinationNode = AudioDestinationNode | MediaStreamAudioDestinationNode;\r\n\r\nexport class AudioDestination extends BaseAudioElement<BaseListener, void> {\r\n    private _remoteUserInput: AudioNode;\r\n    private _spatializedInput: AudioNode;\r\n    private _nonSpatializedInput: AudioNode;\r\n\r\n    constructor(audioCtx: AudioContext, private _trueDestination: DestinationNode, listener: BaseListener) {\r\n        super(\"final\", audioCtx, listener);\r\n\r\n        this._remoteUserInput = Gain(\r\n            \"remote-user-input\",\r\n            this.audioCtx,\r\n            null,\r\n            this._spatializedInput = Gain(\r\n                \"spatialized-input\",\r\n                this.audioCtx,\r\n                null,\r\n                this.volumeControl));\r\n\r\n        this._nonSpatializedInput = Gain(\r\n            \"non-spatialized-input\",\r\n            this.audioCtx,\r\n            null,\r\n            this.volumeControl);\r\n\r\n        connect(this.volumeControl, this._trueDestination);\r\n        connect(NoSpatializationNode.instance(this.audioCtx), this.nonSpatializedInput);\r\n    }\r\n\r\n    protected override onDisposing(): void {\r\n        removeVertex(this._remoteUserInput);\r\n        removeVertex(this._spatializedInput);\r\n        removeVertex(this._nonSpatializedInput);\r\n        super.onDisposing();\r\n    }\r\n\r\n    get remoteUserInput() {\r\n        return this._remoteUserInput;\r\n    }\r\n\r\n    get spatializedInput() {\r\n        return this._spatializedInput;\r\n    }\r\n\r\n    get nonSpatializedInput() {\r\n        return this._nonSpatializedInput;\r\n    }\r\n\r\n    get trueDestination() {\r\n        return this._trueDestination;\r\n    }\r\n}\r\n", "import { BaseSpatializer } from \"../../BaseSpatializer\";\r\n\r\n/**\r\n * Base class providing functionality for audio listeners.\r\n **/\r\nexport abstract class BaseListener\r\n    extends BaseSpatializer {\r\n\r\n    constructor(protected readonly audioCtx: AudioContext) {\r\n        super(\"listener\");\r\n    }\r\n\r\n    protected get listener(): AudioListener {\r\n        return this.audioCtx.listener;\r\n    }\r\n}\r\n\r\n", "import { hasNewAudioListener } from \"../../nodes\";\r\nimport type { Pose } from \"../../Pose\";\r\nimport { BaseListener } from \"./BaseListener\";\r\n\r\n/**\r\n * A positioner that uses WebAudio's playback dependent time progression.\r\n **/\r\nexport class WebAudioListenerNew extends BaseListener {\r\n    /**\r\n     * Creates a new positioner that uses WebAudio's playback dependent time progression.\r\n     */\r\n    constructor(audioCtx: AudioContext) {\r\n        super(audioCtx);\r\n\r\n        if (!hasNewAudioListener) {\r\n            throw new Error(\"Latest WebAudio Listener API is not supported\");\r\n        }\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    /**\r\n     * Performs the spatialization operation for the audio source's latest location.\r\n     */\r\n    setPose(loc: Pose, t: number): void {\r\n        const { p, f, u } = loc;\r\n        this.listener.positionX.setValueAtTime(p[0], t);\r\n        this.listener.positionY.setValueAtTime(p[1], t);\r\n        this.listener.positionZ.setValueAtTime(p[2], t);\r\n        this.listener.forwardX.setValueAtTime(f[0], t);\r\n        this.listener.forwardY.setValueAtTime(f[1], t);\r\n        this.listener.forwardZ.setValueAtTime(f[2], t);\r\n        this.listener.upX.setValueAtTime(u[0], t);\r\n        this.listener.upY.setValueAtTime(u[1], t);\r\n        this.listener.upZ.setValueAtTime(u[2], t);\r\n    }\r\n}\r\n", "import { hasOldAudioListener } from \"../../nodes\";\r\nimport type { Pose } from \"../../Pose\";\r\nimport { BaseListener } from \"./BaseListener\";\r\n\r\n/**\r\n * A positioner that uses WebAudio's playback dependent time progression.\r\n **/\r\nexport class WebAudioListenerOld extends BaseListener {\r\n    /**\r\n     * Creates a new positioner that uses WebAudio's playback dependent time progression.\r\n     */\r\n    constructor(audioCtx: AudioContext) {\r\n        super(audioCtx);\r\n\r\n        if (!hasOldAudioListener) {\r\n            throw new Error(\"WebAudio Listener API is not supported\");\r\n        }\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    /**\r\n     * Performs the spatialization operation for the audio source's latest location.\r\n     */\r\n    setPose(loc: Pose, _t: number): void {\r\n        const { p, f, u } = loc;\r\n        this.listener.setPosition(p[0], p[1], p[2]);\r\n        this.listener.setOrientation(f[0], f[1], f[2], u[0], u[1], u[2]);\r\n    }\r\n}", "import { arrayScan, arraySortByKey, isDefined, isFunction, isNullOrUndefined, TypedEvent, TypedEventBase } from \"@juniper-lib/tslib\";\r\nimport type { MediaDeviceSet } from \"./MediaDeviceSet\";\r\nimport type { MediaPermissionSet } from \"./MediaPermissionSet\";\r\n\r\n/**\r\n * Indicates whether or not the current browser can change the destination device for audio output.\r\n **/\r\nexport const canChangeAudioOutput = isFunction(HTMLAudioElement.prototype.setSinkId);\r\n\r\n\r\nfunction filterDeviceDuplicates(devices: MediaDeviceInfo[]) {\r\n    const filtered = [];\r\n    for (let i = 0; i < devices.length; ++i) {\r\n        const a = devices[i];\r\n        let found = false;\r\n        for (let j = 0; j < filtered.length && !found; ++j) {\r\n            const b = filtered[j];\r\n            found = a.kind === b.kind && b.label.indexOf(a.label) > 0;\r\n        }\r\n\r\n        if (!found) {\r\n            filtered.push(a);\r\n        }\r\n    }\r\n\r\n    return filtered;\r\n}\r\n\r\nexport class DeviceManagerAudioOutputChangedEvent\r\n    extends TypedEvent<\"audiooutputchanged\"> {\r\n    public constructor(public readonly device: MediaDeviceInfo) {\r\n        super(\"audiooutputchanged\");\r\n    }\r\n}\r\n\r\nexport class DeviceManagerAudioInputChangedEvent\r\n    extends TypedEvent<\"audioinputchanged\"> {\r\n    public constructor(public readonly audio: MediaDeviceInfo) {\r\n        super(\"audioinputchanged\");\r\n    }\r\n}\r\n\r\nexport class DeviceManagerVideoInputChangedEvent\r\n    extends TypedEvent<\"videoinputchanged\"> {\r\n    public constructor(public readonly video: MediaDeviceInfo) {\r\n        super(\"videoinputchanged\");\r\n    }\r\n}\r\n\r\nconst PREFERRED_AUDIO_OUTPUT_ID_KEY = \"calla:preferredAudioOutputID\";\r\nconst PREFERRED_AUDIO_INPUT_ID_KEY = \"calla:preferredAudioInputID\";\r\nconst PREFERRED_VIDEO_INPUT_ID_KEY = \"calla:preferredVideoInputID\";\r\n\r\nexport class DeviceManager\r\n    extends TypedEventBase<{\r\n        audiooutputchanged: DeviceManagerAudioOutputChangedEvent;\r\n        audioinputchanged: DeviceManagerAudioInputChangedEvent;\r\n        videoinputchanged: DeviceManagerVideoInputChangedEvent;\r\n    }> {\r\n\r\n    private _hasAudioPermission = false;\r\n    get hasAudioPermission(): boolean {\r\n        return this._hasAudioPermission;\r\n    }\r\n\r\n    private _hasVideoPermission = false;\r\n    get hasVideoPermission(): boolean {\r\n        return this._hasVideoPermission;\r\n    }\r\n\r\n    private _currentStream: MediaStream = null;\r\n    get currentStream(): MediaStream {\r\n        return this._currentStream;\r\n    }\r\n\r\n    set currentStream(v: MediaStream) {\r\n        if (v !== this.currentStream) {\r\n            if (isDefined(this.currentStream)\r\n                && this.currentStream.active) {\r\n                for (const track of this.currentStream.getTracks()) {\r\n                    track.stop();\r\n                }\r\n            }\r\n\r\n            this._currentStream = v;\r\n        }\r\n    }\r\n\r\n    readonly ready: Promise<void>;\r\n\r\n    constructor(private element: HTMLAudioElement, public needsVideoDevice = false) {\r\n        super();\r\n\r\n        this.ready = this.start();\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    private async start(): Promise<void> {\r\n        if (canChangeAudioOutput) {\r\n            const device = await this.getPreferredAudioOutput();\r\n            if (device) {\r\n                await this.setAudioOutputDevice(device);\r\n            }\r\n        }\r\n    }\r\n\r\n    async startPreferredAudioInput() {\r\n        const device = await this.getPreferredAudioInput();\r\n        if (device) {\r\n            await this.setAudioInputDevice(device);\r\n            this.currentStream = await this.startStream();\r\n        }\r\n    }\r\n\r\n    async startPreferredVideoInput() {\r\n        const device = await this.getPreferredVideoInput();\r\n        if (device) {\r\n            await this.setVideoInputDevice(device);\r\n            this.currentStream = await this.startStream();\r\n        }\r\n    }\r\n\r\n    get preferredAudioOutputID(): string {\r\n        if (!canChangeAudioOutput) {\r\n            return null;\r\n        }\r\n\r\n        return localStorage.getItem(PREFERRED_AUDIO_OUTPUT_ID_KEY);\r\n    }\r\n\r\n\r\n    get preferredAudioInputID(): string {\r\n        return localStorage.getItem(PREFERRED_AUDIO_INPUT_ID_KEY);\r\n    }\r\n\r\n    get preferredVideoInputID(): string {\r\n        return localStorage.getItem(PREFERRED_VIDEO_INPUT_ID_KEY);\r\n    }\r\n\r\n    async getAudioOutputDevices(filterDuplicates: boolean = false): Promise<MediaDeviceInfo[]> {\r\n        if (!canChangeAudioOutput) {\r\n            return [];\r\n        }\r\n\r\n        const devices = await this.getAvailableDevices(filterDuplicates);\r\n        return devices && devices.audioOutput || [];\r\n    }\r\n\r\n    async getAudioInputDevices(filterDuplicates: boolean = false): Promise<MediaDeviceInfo[]> {\r\n        const devices = await this.getAvailableDevices(filterDuplicates);\r\n        return devices && devices.audioInput || [];\r\n    }\r\n\r\n    async getVideoInputDevices(filterDuplicates: boolean = false): Promise<MediaDeviceInfo[]> {\r\n        const devices = await this.getAvailableDevices(filterDuplicates);\r\n        return devices && devices.videoInput || [];\r\n    }\r\n\r\n    async getAudioOutputDevice(): Promise<MediaDeviceInfo> {\r\n        if (!canChangeAudioOutput) {\r\n            return null;\r\n        }\r\n\r\n        const curId = this.element && this.element.sinkId;\r\n        if (isNullOrUndefined(curId)) {\r\n            return null;\r\n        }\r\n\r\n        const devices = await this.getAudioOutputDevices(),\r\n            device = arrayScan(devices,\r\n                (d) => d.deviceId === curId);\r\n\r\n        return device;\r\n    }\r\n\r\n    async getAudioInputDevice(): Promise<MediaDeviceInfo> {\r\n        if (isNullOrUndefined(this.currentStream)\r\n            || !this.currentStream.active) {\r\n            return null;\r\n        }\r\n\r\n        const curTracks = this.currentStream.getAudioTracks();\r\n        if (curTracks.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        const testTrack = curTracks[0];\r\n        const devices = await this.getAudioInputDevices();\r\n        const device = arrayScan(devices,\r\n            (d) => testTrack.label === d.label);\r\n\r\n        return device;\r\n    }\r\n\r\n    async getVideoInputDevice(): Promise<MediaDeviceInfo> {\r\n        if (isNullOrUndefined(this.currentStream)\r\n            || !this.currentStream.active) {\r\n            return null;\r\n        }\r\n\r\n        const curTracks = this.currentStream.getVideoTracks();\r\n        if (curTracks.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        const testTrack = curTracks[0];\r\n        const devices = await this.getVideoInputDevices();\r\n        const device = arrayScan(devices,\r\n            (d) => testTrack.label === d.label);\r\n\r\n        return device;\r\n    }\r\n\r\n    private async getPreferredAudioOutput(): Promise<MediaDeviceInfo> {\r\n        if (!canChangeAudioOutput) {\r\n            return null;\r\n        }\r\n\r\n        const devices = await this.getAudioOutputDevices();\r\n        const device = arrayScan(\r\n            devices,\r\n            (d) => d.deviceId === this.preferredAudioOutputID,\r\n            (d) => d.deviceId === \"default\",\r\n            (d) => d.deviceId.length > 0);\r\n        return device;\r\n    }\r\n\r\n    private async getPreferredAudioInput(): Promise<MediaDeviceInfo> {\r\n        const devices = await this.getAudioInputDevices();\r\n        const device = arrayScan(\r\n            devices,\r\n            (d) => d.deviceId === this.preferredAudioInputID,\r\n            (d) => d.deviceId === \"default\",\r\n            (d) => d.deviceId.length > 0);\r\n        return device;\r\n    }\r\n\r\n    private async getPreferredVideoInput(): Promise<MediaDeviceInfo> {\r\n        const devices = await this.getVideoInputDevices();\r\n        const device = arrayScan(\r\n            devices,\r\n            (d) => d.deviceId === this.preferredVideoInputID,\r\n            (d) => this.needsVideoDevice && d.deviceId.length > 0);\r\n        return device;\r\n    }\r\n\r\n    async setAudioOutputDevice(device: MediaDeviceInfo) {\r\n        if (canChangeAudioOutput) {\r\n            if (isDefined(device) && device.kind !== \"audiooutput\") {\r\n                throw new Error(`Device is not an audio output device. Was: ${device.kind}. Label: ${device.label}`);\r\n            }\r\n\r\n            localStorage.setItem(PREFERRED_AUDIO_OUTPUT_ID_KEY, device && device.deviceId || null);\r\n            const curDevice = this.element;\r\n            const curDeviceID = curDevice && curDevice.sinkId;\r\n            if (this.preferredAudioOutputID !== curDeviceID) {\r\n                if (isDefined(this.preferredAudioOutputID)) {\r\n                    await this.element.setSinkId(this.preferredAudioOutputID);\r\n                }\r\n                this.dispatchEvent(new DeviceManagerAudioOutputChangedEvent(device));\r\n            }\r\n        }\r\n    }\r\n\r\n    async setAudioInputDevice(device: MediaDeviceInfo) {\r\n        if (isDefined(device) && device.kind !== \"audioinput\") {\r\n            throw new Error(`Device is not an audio input device. Was: ${device.kind}. Label: ${device.label}`);\r\n        }\r\n\r\n        localStorage.setItem(PREFERRED_AUDIO_INPUT_ID_KEY, device && device.deviceId || null);\r\n        const curAudio = await this.getAudioInputDevice();\r\n        const curAudioID = curAudio && curAudio.deviceId;\r\n        if (this.preferredAudioInputID !== curAudioID) {\r\n            this.dispatchEvent(new DeviceManagerAudioInputChangedEvent(device));\r\n        }\r\n    }\r\n\r\n    async setVideoInputDevice(device: MediaDeviceInfo) {\r\n        if (isDefined(device) && device.kind !== \"videoinput\") {\r\n            throw new Error(`Device is not an video input device. Was: ${device.kind}. Label: ${device.label}`);\r\n        }\r\n\r\n        localStorage.setItem(PREFERRED_VIDEO_INPUT_ID_KEY, device && device.deviceId || null);\r\n        const curVideo = await this.getVideoInputDevice();\r\n        const curVideoID = curVideo && curVideo.deviceId;\r\n        if (this.preferredVideoInputID !== curVideoID) {\r\n            this.dispatchEvent(new DeviceManagerVideoInputChangedEvent(device));\r\n        }\r\n    }\r\n\r\n    private async getAvailableDevices(filterDuplicates: boolean = false): Promise<MediaDeviceSet> {\r\n        let devices = await this.getDevices();\r\n\r\n        if (filterDuplicates) {\r\n            devices = filterDeviceDuplicates(devices);\r\n        }\r\n\r\n        return {\r\n            audioOutput: canChangeAudioOutput ? devices.filter((d) => d.kind === \"audiooutput\") : [],\r\n            audioInput: devices.filter((d) => d.kind === \"audioinput\"),\r\n            videoInput: devices.filter((d) => d.kind === \"videoinput\")\r\n        };\r\n    }\r\n\r\n    private async getDevices(): Promise<MediaDeviceInfo[]> {\r\n        let devices: MediaDeviceInfo[] = null;\r\n        let testStream: MediaStream = null;\r\n        for (let i = 0; i < 3; ++i) {\r\n            devices = await navigator.mediaDevices.enumerateDevices();\r\n            for (const device of devices) {\r\n                if (device.deviceId.length > 0) {\r\n                    if (!this.hasAudioPermission) {\r\n                        this._hasAudioPermission = device.kind === \"audioinput\"\r\n                            && device.label.length > 0;\r\n                    }\r\n\r\n                    if (this.needsVideoDevice && !this.hasVideoPermission) {\r\n                        this._hasVideoPermission = device.kind === \"videoinput\"\r\n                            && device.label.length > 0;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (this.hasAudioPermission\r\n                && (!this.needsVideoDevice || this.hasVideoPermission)) {\r\n                break;\r\n            }\r\n\r\n            try {\r\n                if (!this.hasAudioPermission\r\n                    || this.needsVideoDevice && !this.hasVideoPermission) {\r\n\r\n                    testStream = await this.startStream();\r\n                }\r\n            }\r\n            catch (exp) {\r\n                console.warn(exp);\r\n            }\r\n        }\r\n\r\n        if (testStream) {\r\n            for (const track of testStream.getTracks()) {\r\n                track.stop();\r\n            }\r\n        }\r\n\r\n        devices = arraySortByKey(devices || [], (d) => d.label);\r\n        return devices;\r\n    }\r\n\r\n    private startStream(): Promise<MediaStream> {\r\n        return navigator.mediaDevices.getUserMedia({\r\n            audio: this.preferredAudioInputID\r\n                && { deviceId: this.preferredAudioInputID }\r\n                || true,\r\n            video: this.needsVideoDevice\r\n                && (this.preferredVideoInputID\r\n                    && { deviceId: this.preferredVideoInputID }\r\n                    || true)\r\n                || false\r\n        });\r\n    }\r\n\r\n    async getMediaPermissions(): Promise<MediaPermissionSet> {\r\n        await this.getDevices();\r\n        return {\r\n            audio: this.hasAudioPermission,\r\n            video: this.hasVideoPermission\r\n        };\r\n    }\r\n}", "import { arrayClear } from \"@juniper-lib/tslib\";\r\nimport type { AudioConnection, ErsatzAudioNode } from \"../nodes\";\r\nimport { Delay, Gain, removeVertex } from \"../nodes\";\r\n\r\n\r\nfunction* fibGen(a: number, b: number, count: number = -1) {\r\n    let i = 0;\r\n    while (count < 0 || i < count) {\r\n        yield a;\r\n        ++i;\r\n        const c = a + b;\r\n        a = b;\r\n        b = c;\r\n    }\r\n}\r\n\r\nexport function EchoEffect(name: string, audioCtx: AudioContext, connectTo?: AudioConnection) {\r\n    return new EchoEffectNode(name, audioCtx, 3, connectTo);\r\n}\r\n\r\nclass EchoEffectLayerNode implements ErsatzAudioNode {\r\n    readonly input: GainNode;\r\n    readonly output: DelayNode;\r\n    constructor(name: string, audioCtx: AudioContext, volume: number, delay: number, connectTo?: AudioConnection) {\r\n        this.input = Gain(\r\n            `${name}-input`,\r\n            audioCtx, {\r\n            gain: volume\r\n        },\r\n            this.output = Delay(`${name}-delay`,\r\n                audioCtx, {\r\n                maxDelayTime: delay,\r\n                delayTime: delay\r\n            },\r\n                connectTo));\r\n    }\r\n\r\n    dispose() {\r\n        removeVertex(this.input);\r\n        removeVertex(this.output);\r\n    }\r\n}\r\n\r\nclass EchoEffectNode implements ErsatzAudioNode {\r\n    readonly input: GainNode;\r\n    private readonly layers: EchoEffectLayerNode[];\r\n    readonly output: GainNode;\r\n\r\n    constructor(name: string, audioCtx: AudioContext, numLayers: number, connectTo?: AudioConnection) {\r\n\r\n        this.output = Gain(`${name}-output`, audioCtx, null, connectTo);\r\n\r\n        const delays = Array.from(fibGen(1, 2, numLayers));\r\n        this.layers = delays.map((delay) =>\r\n            new EchoEffectLayerNode(\r\n                `${name}-echo-layer-${delay}`,\r\n                audioCtx,\r\n                0.5 / delay,\r\n                delay,\r\n                this.output\r\n            ));\r\n\r\n        this.input = Gain(`${name}-input`, audioCtx, null, ...this.layers);\r\n    }\r\n\r\n    dispose() {\r\n        removeVertex(this.input);\r\n\r\n        for (const layer of this.layers) {\r\n            layer.dispose();\r\n        }\r\n\r\n        removeVertex(this.output);\r\n\r\n        arrayClear(this.layers);\r\n    }\r\n}\r\n", "import type { AudioConnection, WrappedAudioNode } from \"../nodes\";\r\nimport { BiquadFilter, removeVertex } from \"../nodes\";\r\n\r\nexport function RadioEffect(name: string, audioCtx: AudioContext, connectTo?: AudioConnection): RadioEffectNode {\r\n    return new RadioEffectNode(name, audioCtx, connectTo);\r\n};\r\n\r\nclass RadioEffectNode implements WrappedAudioNode {\r\n    readonly node: BiquadFilterNode;\r\n\r\n    constructor(name: string, audioCtx: AudioContext, connectTo?: AudioConnection) {\r\n        this.node = BiquadFilter(`${name}-biquad-filter`, audioCtx, {\r\n            type: \"bandpass\",\r\n            frequency: 2500,\r\n            Q: 4.5\r\n        }, connectTo);\r\n    }\r\n\r\n    dispose() {\r\n        removeVertex(this.node);\r\n    }\r\n}\r\n\r\n", "import type { AudioConnection, WrappedAudioNode } from \"../nodes\";\r\nimport { BiquadFilter, removeVertex } from \"../nodes\";\r\n\r\n\r\nexport function WallEffect(name: string, audioCtx: AudioContext, connectTo?: AudioConnection): WallEffectNode {\r\n    return new WallEffectNode(name, audioCtx, connectTo);\r\n}\r\n\r\nclass WallEffectNode implements WrappedAudioNode {\r\n    readonly node: BiquadFilterNode;\r\n\r\n    constructor(name: string, audioCtx: AudioContext, connectTo?: AudioConnection) {\r\n        this.node = BiquadFilter(`${name}-biquad-filter`, audioCtx, {\r\n            type: \"bandpass\",\r\n            frequency: 400,\r\n            Q: 4.5\r\n        }, connectTo);\r\n    }\r\n\r\n    dispose() {\r\n        removeVertex(this.node);\r\n    }\r\n}\r\n", "import type { AudioNodeType, AudioVertex } from \"../nodes\";\r\nimport { EchoEffect } from \"./EchoEffect\";\r\nimport { RadioEffect } from \"./RadioEffect\";\r\nimport { WallEffect } from \"./WallEffect\";\r\n\r\nexport type EffectFactory = (name: string, audioCtx: AudioContext, connectTo?: AudioVertex) => AudioNodeType;\r\n\r\nexport const effectStore = new Map<string, EffectFactory>([\r\n    [\"Radio\", RadioEffect],\r\n    [\"Wall\", WallEffect],\r\n    [\"Echo\", EchoEffect]\r\n]);", "import { arrayClear, isDefined, isDisposable, TypedEvent } from \"@juniper-lib/tslib\";\r\nimport { BaseAudioElement } from \"../BaseAudioElement\";\r\nimport { effectStore } from \"../effects\";\r\nimport { AudioNodeType, chain, connect, disconnect, ErsatzAudioNode, removeVertex } from \"../nodes\";\r\nimport type { BaseEmitter } from \"./spatializers/BaseEmitter\";\r\nimport { NoSpatializationNode } from \"./spatializers/NoSpatializationNode\";\r\n\r\nexport class AudioSourceAddedEvent extends TypedEvent<\"sourceadded\"> {\r\n    constructor(public readonly source: AudioNode) {\r\n        super(\"sourceadded\");\r\n    }\r\n}\r\n\r\nexport interface AudioSourceEvents {\r\n    \"sourceadded\": AudioSourceAddedEvent;\r\n}\r\n\r\nexport abstract class BaseAudioSource<AudioNodeT extends AudioNode, EventTypeT = void>\r\n    extends BaseAudioElement<BaseEmitter, AudioSourceEvents & EventTypeT>\r\n    implements ErsatzAudioNode {\r\n\r\n    private source: AudioNodeT = null;\r\n    private readonly effects = new Array<AudioNodeType>();\r\n\r\n    constructor(id: string, audioCtx: AudioContext, spatializer: BaseEmitter, ...effectNames: string[]) {\r\n        super(id, audioCtx, spatializer);\r\n\r\n        this.setEffects(...effectNames);\r\n    }\r\n\r\n    protected override onDisposing(): void {\r\n        for (const effect of this.effects) {\r\n            if (isDisposable(effect)) {\r\n                effect.dispose();\r\n            }\r\n        }\r\n\r\n        arrayClear(this.effects);\r\n\r\n        super.onDisposing();\r\n    }\r\n\r\n    setEffects(...effectNames: string[]) {\r\n        disconnect(this.volumeControl);\r\n\r\n        for (const effect of this.effects) {\r\n            if (isDisposable(effect)) {\r\n                effect.dispose();\r\n            }\r\n        }\r\n\r\n        arrayClear(this.effects);\r\n\r\n        for (const effectName of effectNames) {\r\n            if (isDefined(effectName)) {\r\n                const effect = effectStore.get(effectName);\r\n                if (isDefined(effect)) {\r\n                    this.effects.push(effect(`${effectName}-${this.id}`, this.audioCtx));\r\n                }\r\n            }\r\n        }\r\n\r\n        chain(\r\n            this.volumeControl,\r\n            ...this.effects,\r\n            this.spatializer);\r\n    }\r\n\r\n    get spatialized() {\r\n        return !(this.spatializer instanceof NoSpatializationNode);\r\n    }\r\n\r\n    get input() {\r\n        return this.source;\r\n    }\r\n\r\n    private _connected = false;\r\n    get connected() {\r\n        return this._connected;\r\n    }\r\n\r\n    protected connect(): void {\r\n        if (!this.connected) {\r\n            connect(this.source, this.volumeControl);\r\n        }\r\n    }\r\n\r\n    protected disconnect(): void {\r\n        if (this.connected) {\r\n            disconnect(this.source, this.volumeControl);\r\n        }\r\n    }\r\n\r\n    set input(v: AudioNodeT) {\r\n        if (v !== this.input) {\r\n            if (this.source) {\r\n                removeVertex(this.source);\r\n            }\r\n\r\n            if (v) {\r\n                this.source = v;\r\n                this.connect();\r\n                this.dispatchEvent(new AudioSourceAddedEvent(this.source));\r\n            }\r\n        }\r\n    }\r\n\r\n    get output() {\r\n        return this.volumeControl;\r\n    }\r\n}", "import { TypedEvent, TypedEventBase } from \"@juniper-lib/tslib\";\r\nimport { PlaybackState } from \"./PlaybackState\";\r\n\r\nexport interface IBasePlayable<T extends MediaElementSourceEvents> extends TypedEventBase<T> {\r\n    playbackState: PlaybackState;\r\n    play(): Promise<void>;\r\n    playThrough(): Promise<void>;\r\n    pause(): void;\r\n    stop(): void;\r\n    restart(): void;\r\n}\r\n\r\nexport interface IPlayable extends IBasePlayable<MediaElementSourceEvents> {\r\n}\r\n\r\nexport class MediaElementSourceEvent<T extends string, P> extends TypedEvent<T> {\r\n    constructor(type: T, public readonly source: P) {\r\n        super(type);\r\n    }\r\n}\r\n\r\nexport class MediaElementSourceLoadedEvent<T> extends MediaElementSourceEvent<\"loaded\", T> {\r\n    constructor(source: T) {\r\n        super(\"loaded\", source);\r\n    }\r\n}\r\n\r\nexport class MediaElementSourceErroredEvent<T> extends MediaElementSourceEvent<\"errored\", T> {\r\n    constructor(source: T, public error: unknown) {\r\n        super(\"errored\", source);\r\n    }\r\n}\r\n\r\nexport class MediaElementSourcePlayedEvent<T> extends MediaElementSourceEvent<\"played\", T> {\r\n    constructor(source: T) {\r\n        super(\"played\", source);\r\n    }\r\n}\r\n\r\nexport class MediaElementSourcePausedEvent<T> extends MediaElementSourceEvent<\"paused\", T> {\r\n    constructor(source: T) {\r\n        super(\"paused\", source);\r\n    }\r\n}\r\n\r\nexport class MediaElementSourceStoppedEvent<T> extends MediaElementSourceEvent<\"stopped\", T> {\r\n    constructor(source: T) {\r\n        super(\"stopped\", source);\r\n    }\r\n}\r\n\r\nexport class MediaElementSourceProgressEvent<T> extends MediaElementSourceEvent<\"progress\", T> {\r\n    public value = 0;\r\n    public total = 0;\r\n\r\n    constructor(source: T) {\r\n        super(\"progress\", source);\r\n    }\r\n}\r\n\r\nexport interface BaseMediaElementSourceEvents<T extends IPlayable> {\r\n    errored: MediaElementSourceErroredEvent<T>;\r\n    loaded: MediaElementSourceLoadedEvent<T>;\r\n    played: MediaElementSourcePlayedEvent<T>;\r\n    paused: MediaElementSourcePausedEvent<T>;\r\n    stopped: MediaElementSourceStoppedEvent<T>;\r\n    progress: MediaElementSourceProgressEvent<T>;\r\n}\r\n\r\nexport interface MediaElementSourceEvents extends BaseMediaElementSourceEvents<IPlayable> {\r\n}", "import { mediaElementCanPlay } from \"@juniper-lib/dom/tags\";\r\nimport { once } from \"@juniper-lib/tslib\";\r\nimport { audioReady, removeVertex } from \"../nodes\";\r\nimport { BaseAudioSource } from \"./BaseAudioSource\";\r\nimport { IPlayable, MediaElementSourceErroredEvent, MediaElementSourceEvents, MediaElementSourceLoadedEvent, MediaElementSourcePausedEvent, MediaElementSourcePlayedEvent, MediaElementSourceProgressEvent, MediaElementSourceStoppedEvent } from \"./IPlayable\";\r\nimport { PlaybackState } from \"./PlaybackState\";\r\nimport type { BaseEmitter } from \"./spatializers/BaseEmitter\";\r\n\r\nconst elementRefCounts = new WeakMap<HTMLMediaElement, number>();\r\nconst nodeRefCounts = new WeakMap<MediaElementAudioSourceNode, number>();\r\n\r\nfunction count(source: MediaElementAudioSourceNode, delta: number) {\r\n    const nodeCount = (nodeRefCounts.get(source) || 0) + delta;\r\n    nodeRefCounts.set(source, nodeCount);\r\n\r\n    const elem = source.mediaElement;\r\n    const elementCount = (elementRefCounts.get(elem) || 0) + delta;\r\n    elementRefCounts.set(elem, elementCount);\r\n\r\n    return elementCount;\r\n}\r\n\r\nfunction inc(source: MediaElementAudioSourceNode) {\r\n    count(source, 1);\r\n}\r\n\r\nfunction dec(source: MediaElementAudioSourceNode) {\r\n    count(source, -1);\r\n    if (nodeRefCounts.get(source) === 0) {\r\n        nodeRefCounts.delete(source);\r\n        removeVertex(source);\r\n    }\r\n\r\n    if (elementRefCounts.get(source.mediaElement) === 0) {\r\n        elementRefCounts.delete(source.mediaElement);\r\n        if (source.mediaElement.isConnected) {\r\n            source.mediaElement.remove();\r\n        }\r\n    }\r\n}\r\n\r\nexport class AudioElementSource\r\n    extends BaseAudioSource<MediaElementAudioSourceNode, MediaElementSourceEvents>\r\n    implements IPlayable {\r\n    private readonly loadEvt: MediaElementSourceLoadedEvent<IPlayable>;\r\n    private readonly playEvt: MediaElementSourcePlayedEvent<IPlayable>;\r\n    private readonly pauseEvt: MediaElementSourcePausedEvent<IPlayable>;\r\n    private readonly stopEvt: MediaElementSourceStoppedEvent<IPlayable>;\r\n    private readonly progEvt: MediaElementSourceProgressEvent<IPlayable>;\r\n    private readonly audio: HTMLMediaElement;\r\n\r\n    constructor(id: string,\r\n        audioCtx: AudioContext,\r\n        source: MediaElementAudioSourceNode,\r\n        private readonly randomize: boolean,\r\n        spatializer: BaseEmitter,\r\n        ...effectNames: string[]) {\r\n        super(id, audioCtx, spatializer, ...effectNames);\r\n\r\n        inc(this.input = source);\r\n        this.audio = source.mediaElement;\r\n        this.disconnect();\r\n\r\n        this.loadEvt = new MediaElementSourceLoadedEvent(this);\r\n        this.playEvt = new MediaElementSourcePlayedEvent(this);\r\n        this.pauseEvt = new MediaElementSourcePausedEvent(this);\r\n        this.stopEvt = new MediaElementSourceStoppedEvent(this);\r\n        this.progEvt = new MediaElementSourceProgressEvent(this);\r\n\r\n        const halt = (evt: Event) => {\r\n            this.disconnect();\r\n\r\n            if (this.audio.currentTime === 0 || evt.type === \"ended\") {\r\n                this.dispatchEvent(this.stopEvt);\r\n            }\r\n            else {\r\n                this.dispatchEvent(this.pauseEvt);\r\n            }\r\n        };\r\n\r\n        this.audio.addEventListener(\"ended\", halt);\r\n        this.audio.addEventListener(\"pause\", halt);\r\n\r\n        this.audio.addEventListener(\"play\", () => {\r\n            this.connect();\r\n\r\n            if (this.randomize\r\n                && this.audio.loop\r\n                && this.audio.duration > 1) {\r\n                const startTime = this.audio.duration * Math.random();\r\n                this.audio.currentTime = startTime;\r\n            }\r\n\r\n            this.dispatchEvent(this.playEvt);\r\n        });\r\n\r\n        this.audio.addEventListener(\"timeupdate\", () => {\r\n            this.progEvt.value = this.audio.currentTime;\r\n            this.progEvt.total = this.audio.duration;\r\n            this.dispatchEvent(this.progEvt);\r\n        });\r\n\r\n        mediaElementCanPlay(this.audio)\r\n            .then((success) => this.dispatchEvent(success\r\n                ? this.loadEvt\r\n                : new MediaElementSourceErroredEvent(this, this.audio.error)));\r\n    }\r\n\r\n    get playbackState(): PlaybackState {\r\n        if (this.audio.error) {\r\n            return \"errored\";\r\n        }\r\n\r\n        if (this.audio.ended\r\n            || this.audio.paused && this.audio.currentTime === 0) {\r\n            return \"stopped\";\r\n        }\r\n\r\n        if (this.audio.paused) {\r\n            return \"paused\";\r\n        }\r\n\r\n        return \"playing\";\r\n    }\r\n\r\n    async play(): Promise<void> {\r\n        await audioReady(this.audioCtx);\r\n        await this.audio.play();\r\n    }\r\n\r\n    async playThrough(): Promise<void> {\r\n        const endTask = once(this, \"stopped\");\r\n        await this.play();\r\n        await endTask;\r\n    }\r\n\r\n    pause(): void {\r\n        this.audio.pause();\r\n    }\r\n\r\n    stop(): void {\r\n        this.audio.currentTime = 0;\r\n        this.pause();\r\n    }\r\n\r\n    restart(): Promise<void> {\r\n        this.stop();\r\n        return this.play();\r\n    }\r\n\r\n    protected override onDisposing(): void {\r\n        this.disconnect();\r\n        dec(this.input);\r\n        super.onDisposing();\r\n    }\r\n}\r\n", "import { BaseAudioSource } from \"./BaseAudioSource\";\r\nimport type { BaseEmitter } from \"./spatializers/BaseEmitter\";\r\n\r\nexport type AudioStreamSourceNode = MediaElementAudioSourceNode | MediaStreamAudioSourceNode;\r\n\r\nexport class AudioStreamSource extends BaseAudioSource<AudioStreamSourceNode> {\r\n    constructor(id: string, audioCtx: AudioContext, spatializer: BaseEmitter, ...effectNames: string[]) {\r\n        super(id, audioCtx, spatializer, ...effectNames);\r\n    }\r\n}\r\n", "import { Panner } from \"../../nodes\";\r\nimport { Pose } from \"../../Pose\";\r\nimport { BaseEmitter } from \"./BaseEmitter\";\r\n\r\n/**\r\n * Base class for spatializers that uses WebAudio's PannerNode\r\n **/\r\nexport abstract class BaseWebAudioPanner extends BaseEmitter {\r\n\r\n    protected readonly panner: PannerNode;\r\n\r\n    /**\r\n     * Creates a new spatializer that uses WebAudio's PannerNode.\r\n     */\r\n    constructor(id: string, audioCtx: AudioContext) {\r\n        super(id);\r\n\r\n        this.input = this.output = this.panner = Panner(this.id,\r\n            audioCtx, {\r\n            panningModel: \"HRTF\",\r\n            distanceModel: \"inverse\",\r\n            coneInnerAngle: 360,\r\n            coneOuterAngle: 0,\r\n            coneOuterGain: 0\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Sets parameters that alter spatialization.\r\n     **/\r\n    override setAudioProperties(minDistance: number, maxDistance: number, algorithm: DistanceModelType): void {\r\n        super.setAudioProperties(minDistance, maxDistance, algorithm);\r\n        this.panner.refDistance = this.minDistance;\r\n        this.panner.distanceModel = algorithm;\r\n        if (this.maxDistance <= 0) {\r\n            this.panner.rolloffFactor = Infinity;\r\n        }\r\n        else {\r\n            this.panner.rolloffFactor = 1 / this.maxDistance;\r\n        }\r\n    }\r\n\r\n    private lpx = 0;\r\n    private lpy = 0;\r\n    private lpz = 0;\r\n    private lox = 0;\r\n    private loy = 0;\r\n    private loz = 0;\r\n\r\n    /**\r\n     * Performs the spatialization operation for the audio source's latest location.\r\n     */\r\n    setPose(loc: Pose, t: number): void {\r\n        const { p, f } = loc;\r\n        const [px, py, pz] = p;\r\n        const [ox, oy, oz] = f;\r\n        if (px !== this.lpx\r\n            || py !== this.lpy\r\n            || pz !== this.lpz) {\r\n            this.lpx = px;\r\n            this.lpy = py;\r\n            this.lpz = pz;\r\n            this.setPosition(px, py, pz, t);\r\n        }\r\n\r\n        if (ox !== this.lox\r\n            || oy !== this.loy\r\n            || oz !== this.loz) {\r\n            this.lox = ox;\r\n            this.loy = oy;\r\n            this.loz = oz;\r\n            this.setOrientation(ox, oy, oz, t);\r\n        }\r\n    }\r\n\r\n    protected abstract setPosition(x: number, y: number, z: number, t: number): void;\r\n    protected abstract setOrientation(x: number, y: number, z: number, t: number): void;\r\n}", "import { BaseWebAudioPanner } from \"./BaseWebAudioPanner\";\r\n\r\n/**\r\n * A positioner that uses WebAudio's playback dependent time progression.\r\n **/\r\nexport class WebAudioPannerNew extends BaseWebAudioPanner {\r\n\r\n    /**\r\n     * Creates a new positioner that uses WebAudio's playback dependent time progression.\r\n     */\r\n    constructor(id: string, audioCtx: AudioContext) {\r\n        super(id, audioCtx);\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    override setPosition(x: number, y: number, z: number, t: number) {\r\n            this.panner.positionX.setValueAtTime(x, t);\r\n            this.panner.positionY.setValueAtTime(y, t);\r\n            this.panner.positionZ.setValueAtTime(z, t);\r\n    }\r\n\r\n    override setOrientation(x: number, y: number, z: number, t: number) {\r\n        this.panner.orientationX.setValueAtTime(-x, t);\r\n        this.panner.orientationY.setValueAtTime(-y, t);\r\n        this.panner.orientationZ.setValueAtTime(-z, t);\r\n    }\r\n}\r\n\r\n", "import { BaseWebAudioPanner } from \"./BaseWebAudioPanner\";\r\n\r\n/**\r\n * A positioner that uses the WebAudio API's old setPosition method.\r\n **/\r\nexport class WebAudioPannerOld extends BaseWebAudioPanner {\r\n\r\n    /**\r\n     * Creates a new positioner that uses the WebAudio API's old setPosition method.\r\n     */\r\n    constructor(id: string, audioCtx: AudioContext) {\r\n        super(id, audioCtx);\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    override setPosition(x: number, y: number, z: number, _t: number) {\r\n        this.panner.setPosition(x, y, z);\r\n    }\r\n\r\n    override setOrientation(x: number, y: number, z: number, _t: number) {\r\n        this.panner.setOrientation(x, y, z);\r\n    }\r\n}\r\n", "import { autoPlay, id, playsInline, src, srcObject } from \"@juniper-lib/dom/attrs\";\r\nimport { display, styles } from \"@juniper-lib/dom/css\";\r\nimport { Audio, BackgroundAudio, elementApply, ErsatzElement, mediaElementCanPlay } from \"@juniper-lib/dom/tags\";\r\nimport {\r\n    arrayRemove, arraySortedInsert, IDisposable, IProgress, isDefined,\r\n    isMobileVR,\r\n    isNullOrUndefined,\r\n    isString, stringToName, TypedEvent, TypedEventBase\r\n} from \"@juniper-lib/tslib\";\r\nimport type { vec3 } from \"gl-matrix\";\r\nimport type { DestinationNode } from \"./destinations/AudioDestination\";\r\nimport { AudioDestination } from \"./destinations/AudioDestination\";\r\nimport { WebAudioListenerNew } from \"./destinations/spatializers/WebAudioListenerNew\";\r\nimport { WebAudioListenerOld } from \"./destinations/spatializers/WebAudioListenerOld\";\r\nimport { canChangeAudioOutput, DeviceManager } from \"./DeviceManager\";\r\nimport type { IPoseable } from \"./IPoseable\";\r\nimport {\r\n    audioReady,\r\n    BiquadFilter, connect, disconnect,\r\n    DynamicsCompressor, ErsatzAudioNode, Gain, hasNewAudioListener, MediaElementSource,\r\n    MediaStreamDestination,\r\n    MediaStreamSource\r\n} from \"./nodes\";\r\nimport type { Pose } from \"./Pose\";\r\nimport { AudioElementSource } from \"./sources/AudioElementSource\";\r\nimport type { AudioStreamSourceNode } from \"./sources/AudioStreamSource\";\r\nimport { AudioStreamSource } from \"./sources/AudioStreamSource\";\r\nimport { BaseEmitter } from \"./sources/spatializers/BaseEmitter\";\r\nimport { NoSpatializationNode } from \"./sources/spatializers/NoSpatializationNode\";\r\nimport { WebAudioPannerNew } from \"./sources/spatializers/WebAudioPannerNew\";\r\nimport { WebAudioPannerOld } from \"./sources/spatializers/WebAudioPannerOld\";\r\n\r\nif (!(\"AudioContext\" in globalThis) && \"webkitAudioContext\" in globalThis) {\r\n    globalThis.AudioContext = (globalThis as any).webkitAudioContext;\r\n}\r\n\r\nif (!(\"OfflineAudioContext\" in globalThis) && \"webkitOfflineAudioContext\" in globalThis) {\r\n    globalThis.OfflineAudioContext = (globalThis as any).webkitOfflineAudioContext;\r\n}\r\n\r\n\r\ntype withPoseCallback<T> = (pose: Pose) => T;\r\n\r\n\r\nconst USE_HEADPHONES_KEY = \"juniper::useHeadphones\";\r\nconst useHeadphonesToggledEvt = new TypedEvent(\"useheadphonestoggled\");\r\n\r\nconst hasStreamSources = \"createMediaStreamSource\" in AudioContext.prototype;\r\nconst useElementSourceForUsers = !hasStreamSources;\r\n\r\ninterface AudioManagerEvents {\r\n    useheadphonestoggled: TypedEvent<\"useheadphonestoggled\">;\r\n}\r\n\r\n/**\r\n * A manager of audio sources, destinations, and their spatialization.\r\n **/\r\nexport class AudioManager\r\n    extends TypedEventBase<AudioManagerEvents>\r\n    implements ErsatzElement, ErsatzAudioNode {\r\n\r\n    private readonly sortedUserIDs = new Array<string>();\r\n    private readonly users = new Map<string, AudioStreamSource>();\r\n    private readonly clips = new Map<string, AudioElementSource>();\r\n    private readonly clipPaths = new Map<string, string>();\r\n    private readonly pathSources = new Map<string, Promise<MediaElementAudioSourceNode>>();\r\n    private readonly pathCounts = new Map<string, number>();\r\n\r\n    private readonly localFilter: BiquadFilterNode;\r\n    private readonly localCompressor: DynamicsCompressorNode;\r\n\r\n    private _minDistance = 1;\r\n    private _maxDistance = 10;\r\n    private _offsetRadius = 0;\r\n    private _useHeadphones = false;\r\n\r\n    private _algorithm: DistanceModelType = \"inverse\";\r\n    get algorithm(): DistanceModelType { return this._algorithm; }\r\n\r\n    readonly element: HTMLAudioElement = null;\r\n    readonly audioDestination: AudioDestination = null;\r\n\r\n    readonly devices: DeviceManager;\r\n    readonly input: GainNode;\r\n    readonly localAutoControlledGain: GainNode;\r\n    readonly output: MediaStreamAudioDestinationNode;\r\n    readonly audioCtx: AudioContext;\r\n    readonly ready: Promise<void>;\r\n\r\n    localUserID: string = null;\r\n\r\n    /**\r\n     * Creates a new manager of audio sources, destinations, and their spatialization.\r\n     **/\r\n    constructor(defaultLocalUserID: string) {\r\n        super();\r\n\r\n        this.audioCtx = new AudioContext();\r\n\r\n        let destination: DestinationNode = null;\r\n        if (canChangeAudioOutput) {\r\n            destination = MediaStreamDestination(\"final-destination\", this.audioCtx);\r\n\r\n            this.element = Audio(\r\n                id(\"Audio-Device-Manager\"),\r\n                playsInline(true),\r\n                autoPlay(true),\r\n                srcObject(destination.stream),\r\n                styles(\r\n                    display(\"none\")));\r\n\r\n            elementApply(document.body, this);\r\n        }\r\n        else {\r\n            destination = this.audioCtx.destination;\r\n        }\r\n\r\n        this.devices = new DeviceManager(this.element);\r\n\r\n        this.input = Gain(\r\n            \"local-mic-user-gain\",\r\n            this.audioCtx,\r\n            null,\r\n            this.localAutoControlledGain = Gain(\r\n                \"local-mic-auto-gain\",\r\n                this.audioCtx,\r\n                null,\r\n                this.localFilter = BiquadFilter(\r\n                    \"local-mic-filter\",\r\n                    this.audioCtx,\r\n                    {\r\n                        type: \"bandpass\",\r\n                        frequency: 1500,\r\n                        Q: 0.25,\r\n                    },\r\n                    this.localCompressor = DynamicsCompressor(\r\n                        \"local-mic-compressor\",\r\n                        this.audioCtx, {\r\n                        threshold: -15,\r\n                        knee: 40,\r\n                        ratio: 17\r\n                    },\r\n                        this.output = MediaStreamDestination(\r\n                            \"local-mic-destination\",\r\n                            this.audioCtx)))));\r\n\r\n        this.audioDestination = new AudioDestination(this.audioCtx, destination, hasNewAudioListener\r\n            ? new WebAudioListenerNew(this.audioCtx)\r\n            : new WebAudioListenerOld(this.audioCtx));\r\n        NoSpatializationNode.instance(this.audioCtx).setAudioProperties(this._minDistance, this._maxDistance, this.algorithm);\r\n\r\n        this.setLocalUserID(defaultLocalUserID);\r\n\r\n        const useHeadphones = localStorage.getItem(USE_HEADPHONES_KEY);\r\n        if (isDefined(useHeadphones)) {\r\n            this._useHeadphones = useHeadphones === \"true\";\r\n        }\r\n        else {\r\n            this._useHeadphones = isMobileVR();\r\n        }\r\n\r\n        this.ready = this.start();\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    get useHeadphones() {\r\n        return this._useHeadphones;\r\n    }\r\n\r\n    set useHeadphones(v) {\r\n        if (v !== this.useHeadphones) {\r\n            this._useHeadphones = v;\r\n            localStorage.setItem(USE_HEADPHONES_KEY, this.useHeadphones.toString());\r\n            this.dispatchEvent(useHeadphonesToggledEvt);\r\n        }\r\n    }\r\n\r\n    dispose() {\r\n        for (const userID of this.sortedUserIDs) {\r\n            this.removeUser(userID);\r\n        }\r\n\r\n        for (const clipID of this.clips.keys()) {\r\n            this.removeClip(clipID);\r\n        }\r\n\r\n        disconnect(this.input);\r\n        disconnect(this.localAutoControlledGain);\r\n        disconnect(this.localFilter);\r\n        disconnect(this.localCompressor);\r\n        disconnect(this.output);\r\n\r\n        this.audioDestination.dispose();\r\n        this.audioCtx.suspend();\r\n    }\r\n\r\n    private async start() {\r\n        await audioReady(this.audioCtx);\r\n        if (this.element) {\r\n            await this.element.play();\r\n        }\r\n        await this.devices.ready;\r\n    }\r\n\r\n    get offsetRadius() {\r\n        return this._offsetRadius;\r\n    }\r\n\r\n    set offsetRadius(v) {\r\n        this._offsetRadius = v;\r\n        this.updateUserOffsets();\r\n    }\r\n\r\n    get filter() {\r\n        return this.localFilter;\r\n    }\r\n\r\n    get filterFrequency() {\r\n        return this.localFilter.frequency.value;\r\n    }\r\n\r\n    set filterFrequency(v) {\r\n        this.localFilter.frequency.value = v;\r\n    }\r\n\r\n    get compressor() {\r\n        return this.localCompressor;\r\n    }\r\n\r\n    get isReady(): boolean {\r\n        return this.audioCtx.state === \"running\";\r\n    }\r\n\r\n    /**\r\n     * Gets the current playback time.\r\n     */\r\n    get currentTime(): number {\r\n        return this.audioCtx.currentTime;\r\n    }\r\n\r\n    update(): void {\r\n        const t = this.currentTime;\r\n        this.audioDestination.audioTick(t);\r\n\r\n        for (const clip of this.clips.values()) {\r\n            clip.audioTick(t);\r\n        }\r\n\r\n        for (const user of this.users.values()) {\r\n            user.audioTick(t);\r\n        }\r\n    }\r\n\r\n    private counter = 0;\r\n\r\n    /**\r\n     * Creates a spatialzer for an audio source.\r\n     * @param spatialize - whether or not the audio stream should be spatialized. Stereo audio streams that are spatialized will get down-mixed to a single channel.\r\n     * @param isRemoteStream - whether or not the audio stream is coming from a remote user.\r\n     */\r\n    newSpatializer(id: string, spatialize: boolean, isRemoteStream: boolean): BaseEmitter {\r\n        if (spatialize) {\r\n            const destination = isRemoteStream\r\n                ? this.audioDestination.remoteUserInput\r\n                : this.audioDestination.spatializedInput;\r\n\r\n            const slug = `spatializer-${++this.counter}-${id}`;\r\n\r\n            const spatializer = hasNewAudioListener\r\n                ? new WebAudioPannerNew(slug + \"-new-wa\", this.audioCtx)\r\n                : new WebAudioPannerOld(id + \"-old-wa\", this.audioCtx);\r\n\r\n            connect(spatializer, destination);\r\n\r\n            return spatializer;\r\n        }\r\n        else {\r\n            return NoSpatializationNode.instance(this.audioCtx);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a spatialzer for an audio source.\r\n     * @param spatialize - whether or not the audio stream should be spatialized. Stereo audio streams that are spatialized will get down-mixed to a single channel.\r\n     * @param isRemoteStream - whether or not the audio stream is coming from a remote user.\r\n     */\r\n    private createSpatializer(id: string, spatialize: boolean, isRemoteStream: boolean): BaseEmitter {\r\n        const spatializer = this.newSpatializer(id, spatialize, isRemoteStream);\r\n        spatializer.setAudioProperties(this._minDistance, this._maxDistance, this._algorithm);\r\n        return spatializer;\r\n    }\r\n\r\n    /**\r\n     * Create a new user for audio processing.\r\n     */\r\n    createUser(userID: string, userName: string): AudioStreamSource {\r\n        if (!this.users.has(userID)) {\r\n            const id = stringToName(userName, userID);\r\n            const spatializer = this.createSpatializer(id, true, true);\r\n            const user = new AudioStreamSource(id, this.audioCtx, spatializer);\r\n            this.users.set(userID, user);\r\n            arraySortedInsert(this.sortedUserIDs, userID);\r\n            this.updateUserOffsets();\r\n        }\r\n\r\n        return this.users.get(userID);\r\n    }\r\n\r\n    /**\r\n     * Create a new user for the audio listener.\r\n     */\r\n    setLocalUserID(id: string): AudioDestination {\r\n        if (this.audioDestination) {\r\n            arrayRemove(this.sortedUserIDs, this.localUserID);\r\n            this.localUserID = id;\r\n            arraySortedInsert(this.sortedUserIDs, this.localUserID);\r\n            this.updateUserOffsets();\r\n        }\r\n\r\n        return this.audioDestination;\r\n    }\r\n\r\n    loadBasicClip(id: string, path: string, vol: number, prog?: IProgress): Promise<AudioElementSource> {\r\n        return this.loadClip(id, path, false, false, false, false, vol, [], prog);\r\n    }\r\n\r\n    createBasicClip(id: string, element: HTMLMediaElement, vol: number): AudioElementSource {\r\n        return this.createClip(id, element, false, false, false, vol, []);\r\n    }\r\n\r\n    /**\r\n     * Creates a new sound effect from a series of fallback paths\r\n     * for media files.\r\n     * @param id - the name of the sound effect, to reference when executing playback.\r\n     * @param looping - whether or not the sound effect should be played on loop.\r\n     * @param autoPlaying - whether or not the sound effect should be played immediately.\r\n     * @param spatialize - whether or not the sound effect should be spatialized.\r\n     * @param vol - the volume at which to set the clip.\r\n     * @param effectNames - names of pre-canned effects to load on the control.\r\n     * @param path - a path for loading the media of the sound effect, or the sound effect that has already been loaded.\r\n     * @param prog - an optional callback function to use for tracking progress of loading the clip.\r\n     */\r\n    async loadClip(\r\n        id: string,\r\n        path: string,\r\n        looping: boolean,\r\n        autoPlaying: boolean,\r\n        spatialize: boolean,\r\n        randomize: boolean,\r\n        vol: number,\r\n        effectNames: string[],\r\n        prog?: IProgress): Promise<AudioElementSource> {\r\n        if (isNullOrUndefined(path)\r\n            || isString(path)\r\n            && path.length === 0) {\r\n            throw new Error(\"No clip source path provided\");\r\n        }\r\n\r\n        if (isDefined(prog)) {\r\n            prog.start(path);\r\n        }\r\n\r\n        const source = await this.getSourceTask(id, path, path, looping, autoPlaying, prog);\r\n        const clip = this.makeClip(source, id, path, spatialize, randomize, autoPlaying, vol, ...effectNames);\r\n        this.clips.set(id, clip);\r\n\r\n        if (isDefined(prog)) {\r\n            prog.end(path);\r\n        }\r\n\r\n        return clip;\r\n    }\r\n\r\n    createClip(\r\n        id: string,\r\n        element: HTMLMediaElement,\r\n        autoPlaying: boolean,\r\n        spatialize: boolean,\r\n        randomize: boolean,\r\n        vol: number,\r\n        effectNames: string[]): AudioElementSource {\r\n        if (isNullOrUndefined(element)\r\n            || isString(element)\r\n            && element.length === 0) {\r\n            throw new Error(\"No clip source path provided\");\r\n        }\r\n\r\n        const curPath = element.currentSrc;\r\n        const source = this.createSourceFromElement(id, element);\r\n        const clip = this.makeClip(source, id, curPath, spatialize, randomize, autoPlaying, vol, ...effectNames);\r\n        this.clips.set(id, clip);\r\n\r\n        return clip;\r\n    }\r\n\r\n    private getSourceTask(id: string, curPath: string, path: string, looping: boolean, autoPlaying: boolean, prog: IProgress): Promise<MediaElementAudioSourceNode> {\r\n        this.clipPaths.set(id, curPath);\r\n        let sourceTask = this.pathSources.get(curPath);\r\n        if (isDefined(sourceTask)) {\r\n            this.pathCounts.set(curPath, this.pathCounts.get(curPath) + 1);\r\n        }\r\n        else {\r\n            sourceTask = this.createSourceFromFile(id, path, looping, autoPlaying, prog);\r\n            this.pathSources.set(curPath, sourceTask);\r\n            this.pathCounts.set(curPath, 1);\r\n        }\r\n        return sourceTask;\r\n    }\r\n\r\n    private async createSourceFromFile(id: string, path: string, looping: boolean, autoPlaying: boolean, prog?: IProgress): Promise<MediaElementAudioSourceNode> {\r\n        if (isDefined(prog)) {\r\n            prog.start(id);\r\n        }\r\n\r\n        const elem = BackgroundAudio(autoPlaying, false, looping, src(path));\r\n        if (!await mediaElementCanPlay(elem)) {\r\n            throw elem.error;\r\n        }\r\n\r\n        if (isDefined(prog)) {\r\n            prog.end(id);\r\n        }\r\n\r\n        return this.createSourceFromElement(id, elem);\r\n    }\r\n\r\n    private createSourceFromStream(id: string, stream: MediaStream): AudioStreamSourceNode {\r\n        const elem = BackgroundAudio(\r\n            true,\r\n            !useElementSourceForUsers,\r\n            false,\r\n            srcObject(stream));\r\n\r\n        if (useElementSourceForUsers) {\r\n            return this.createSourceFromElement(id, elem);\r\n        }\r\n        else {\r\n            return MediaStreamSource(\r\n                stringToName(\"media-stream-source\", id, stream.id),\r\n                this.audioCtx,\r\n                stream);\r\n        }\r\n    }\r\n\r\n    private createSourceFromElement(id: string, elem: HTMLMediaElement) {\r\n        return MediaElementSource(\r\n            stringToName(\"media-element-source\", id),\r\n            this.audioCtx,\r\n            elem);\r\n    }\r\n\r\n    private makeClip(\r\n        source: MediaElementAudioSourceNode,\r\n        id: string,\r\n        path: string,\r\n        spatialize: boolean,\r\n        randomize: boolean,\r\n        autoPlaying: boolean,\r\n        vol: number,\r\n        ...effectNames: string[]): AudioElementSource {\r\n        const nodeID = stringToName(id, path);\r\n        const spatializer = this.createSpatializer(nodeID, spatialize, false);\r\n        const clip = new AudioElementSource(\r\n            stringToName(\"audio-clip-element\", nodeID),\r\n            this.audioCtx,\r\n            source,\r\n            randomize,\r\n            spatializer,\r\n            ...effectNames);\r\n\r\n        if (autoPlaying) {\r\n            clip.play();\r\n        }\r\n\r\n        clip.volume = vol;\r\n\r\n        return clip;\r\n    }\r\n\r\n    hasClip(id: string): boolean {\r\n        return this.clips.has(id);\r\n    }\r\n\r\n    /**\r\n     * Plays a named sound effect, with the returned promise resolving when the clip has started playing.\r\n     * @param id - the name of the effect to play.\r\n     */\r\n    async playClip(id: string): Promise<void> {\r\n        if (this.isReady && this.hasClip(id)) {\r\n            const clip = this.clips.get(id);\r\n            await clip.play();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Plays a named sound effect, with the returned promise resolving when the clip has finished playing.\r\n     * @param id - the name of the effect to play.\r\n     */\r\n    async playClipThrough(id: string): Promise<void> {\r\n        if (this.isReady && this.hasClip(id)) {\r\n            const clip = this.clips.get(id);\r\n            await clip.playThrough();\r\n        }\r\n    }\r\n\r\n    stopClip(id: string): void {\r\n        if (this.isReady && this.hasClip(id)) {\r\n            const clip = this.clips.get(id);\r\n            clip.stop();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get an existing user.\r\n     */\r\n    getUser(userID: string): AudioStreamSource {\r\n        return this.users.get(userID);\r\n    }\r\n\r\n    /**\r\n     * Get an existing audio clip.\r\n     */\r\n    getClip(id: string): AudioElementSource {\r\n        return this.clips.get(id);\r\n    }\r\n\r\n    /**\r\n     * Remove an audio source from audio processing.\r\n     * @param sources - the collection of audio sources from which to remove.\r\n     * @param id - the id of the audio source to remove\r\n     **/\r\n    private removeSource<T extends IDisposable>(sources: Map<string, T>, id: string): T {\r\n        const source = sources.get(id);\r\n        if (isDefined(source)) {\r\n            sources.delete(id);\r\n            source.dispose();\r\n        }\r\n        return source;\r\n    }\r\n\r\n    /**\r\n     * Remove a user from audio processing.\r\n     **/\r\n    removeUser(userID: string): void {\r\n        const user = this.removeSource(this.users, userID);\r\n        if (isDefined(user.input)) {\r\n            user.input = null;\r\n        }\r\n        arrayRemove(this.sortedUserIDs, userID);\r\n        this.updateUserOffsets();\r\n    }\r\n\r\n    /**\r\n     * Remove an audio clip from audio processing.\r\n     **/\r\n    removeClip(id: string): AudioElementSource {\r\n        const path = this.clipPaths.get(id);\r\n        this.pathCounts.set(path, this.pathCounts.get(path) - 1);\r\n        if (this.pathCounts.get(path) === 0) {\r\n            this.pathCounts.delete(path);\r\n            this.pathSources.delete(path);\r\n        }\r\n\r\n        return this.removeSource(this.clips, id);\r\n    }\r\n\r\n    setUserStream(userID: string, userName: string, stream: MediaStream): void {\r\n        if (this.users.has(userID)) {\r\n            const user = this.users.get(userID);\r\n            if (stream) {\r\n                user.input = this.createSourceFromStream(\r\n                    stringToName(userName, userID),\r\n                    stream);\r\n            }\r\n            else if (isDefined(user.input)) {\r\n                user.input = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    updateUserOffsets(): void {\r\n        if (this.offsetRadius > 0) {\r\n            const idx = this.sortedUserIDs.indexOf(this.localUserID);\r\n            const dAngle = 2 * Math.PI / this.sortedUserIDs.length;\r\n            const localAngle = (idx + 1) * dAngle;\r\n            const dx = this.offsetRadius * Math.sin(localAngle);\r\n            const dy = this.offsetRadius * (Math.cos(localAngle) - 1);\r\n            for (let i = 0; i < this.sortedUserIDs.length; ++i) {\r\n                const id = this.sortedUserIDs[i];\r\n                const angle = (i + 1) * dAngle;\r\n                const x = this.offsetRadius * Math.sin(angle) - dx;\r\n                const z = this.offsetRadius * (Math.cos(angle) - 1) - dy;\r\n                this.setUserOffset(id, x, 0, z);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets parameters that alter spatialization.\r\n     **/\r\n    setAudioProperties(minDistance: number, maxDistance: number, algorithm: DistanceModelType): void {\r\n        this._minDistance = minDistance;\r\n        this._maxDistance = maxDistance;\r\n        this._algorithm = algorithm;\r\n\r\n        NoSpatializationNode.instance(this.audioCtx).setAudioProperties(this._minDistance, this._maxDistance, this.algorithm);\r\n\r\n        for (const user of this.users.values()) {\r\n            user.spatializer.setAudioProperties(this._minDistance, this._maxDistance, this.algorithm);\r\n        }\r\n\r\n        for (const clip of this.clips.values()) {\r\n            clip.spatializer.setAudioProperties(clip.spatializer.minDistance, clip.spatializer.maxDistance, this.algorithm);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get a pose, normalize the transition time, and perform on operation on it, if it exists.\r\n     * @param sources - the collection of poses from which to retrieve the pose.\r\n     * @param id - the id of the pose for which to perform the operation.\r\n     * @param poseCallback\r\n     */\r\n    private withPose<ElementT extends IPoseable, ResultT>(sources: Map<string, ElementT>, id: string, poseCallback: withPoseCallback<ResultT>): ResultT {\r\n        const source = sources.get(id);\r\n        let pose: Pose = null;\r\n        if (source) {\r\n            pose = source.pose;\r\n        }\r\n        else if (id === this.localUserID) {\r\n            pose = this.audioDestination.pose;\r\n        }\r\n\r\n        if (!pose) {\r\n            return null;\r\n        }\r\n\r\n        return poseCallback(pose);\r\n    }\r\n\r\n    /**\r\n     * Get a user pose, normalize the transition time, and perform on operation on it, if it exists.\r\n     * @param id - the id of the user for which to perform the operation.\r\n     * @param poseCallback\r\n     */\r\n    private withUser<T>(id: string, poseCallback: withPoseCallback<T>): T {\r\n        return this.withPose(this.users, id, poseCallback);\r\n    }\r\n\r\n    /**\r\n     * Set the comfort position offset for a given user.\r\n     * @param id - the id of the user for which to set the offset.\r\n     * @param x - the horizontal component of the offset.\r\n     * @param y - the vertical component of the offset.\r\n     * @param z - the lateral component of the offset.\r\n     */\r\n    private setUserOffset(id: string, x: number, y: number, z: number): void {\r\n        this.withUser(id, (pose) => {\r\n            pose.setOffset(x, y, z);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get the comfort position offset for a given user.\r\n     * @param id - the id of the user for which to set the offset.\r\n     */\r\n    public getUserOffset(id: string): vec3 {\r\n        return this.withUser(id, (pose) => pose.o);\r\n    }\r\n\r\n    /**\r\n     * Set the position and orientation of a user.\r\n     * @param id - the id of the user for which to set the position.\r\n     * @param px - the horizontal component of the position.\r\n     * @param py - the vertical component of the position.\r\n     * @param pz - the lateral component of the position.\r\n     * @param fx - the horizontal component of the forward vector.\r\n     * @param fy - the vertical component of the forward vector.\r\n     * @param fz - the lateral component of the forward vector.\r\n     * @param ux - the horizontal component of the up vector.\r\n     * @param uy - the vertical component of the up vector.\r\n     * @param uz - the lateral component of the up vector.\r\n     * @param dt - the amount of time to take to make the transition. Defaults to this AudioManager's `transitionTime`.\r\n     **/\r\n    setUserPose(id: string, px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this.withUser(id, (pose) => {\r\n            pose.set(px, py, pz, fx, fy, fz, ux, uy, uz);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get an audio clip pose, normalize the transition time, and perform on operation on it, if it exists.\r\n     * @param id - the id of the audio clip for which to perform the operation.\r\n     * @param dt - the amount of time to take to make the transition. Defaults to this AudioManager's `transitionTime`.\r\n     * @param poseCallback\r\n     */\r\n    private withClip<T>(id: string, poseCallback: withPoseCallback<T>): T {\r\n        return this.withPose(this.clips, id, poseCallback);\r\n    }\r\n\r\n    /**\r\n     * Set the position of an audio clip.\r\n     * @param id - the id of the audio clip for which to set the position.\r\n     * @param x - the horizontal component of the position.\r\n     * @param y - the vertical component of the position.\r\n     * @param z - the lateral component of the position.\r\n     **/\r\n    setClipPosition(id: string, x: number, y: number, z: number): void {\r\n        this.withClip(id, (pose) => {\r\n            pose.setPosition(x, y, z);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set the orientation of an audio clip.\r\n     * @param id - the id of the audio clip for which to set the position.\r\n     * @param fx - the horizontal component of the forward vector.\r\n     * @param fy - the vertical component of the forward vector.\r\n     * @param fz - the lateral component of the forward vector.\r\n     * @param ux - the horizontal component of the up vector.\r\n     * @param uy - the vertical component of the up vector.\r\n     * @param uz - the lateral component of the up vector.\r\n     **/\r\n    setClipOrientation(id: string, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this.withClip(id, (pose) => {\r\n            pose.setOrientation(fx, fy, fz, ux, uy, uz);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set the position and orientation of an audio clip.\r\n     * @param id - the id of the audio clip for which to set the position.\r\n     * @param px - the horizontal component of the position.\r\n     * @param py - the vertical component of the position.\r\n     * @param pz - the lateral component of the position.\r\n     * @param fx - the horizontal component of the forward vector.\r\n     * @param fy - the vertical component of the forward vector.\r\n     * @param fz - the lateral component of the forward vector.\r\n     * @param ux - the horizontal component of the up vector.\r\n     * @param uy - the vertical component of the up vector.\r\n     * @param uz - the lateral component of the up vector.\r\n     **/\r\n    setClipPose(id: string, px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this.withClip(id, (pose) => {\r\n            pose.set(px, py, pz, fx, fy, fz, ux, uy, uz);\r\n        });\r\n    }\r\n}", "import { IProgress } from \"@juniper-lib/tslib\";\r\nimport { FullAudioRecord } from \"../data\";\r\nimport { BaseMediaElementSourceEvents, IBasePlayable, MediaElementSourceEvent } from \"./IPlayable\";\r\n\r\n\r\nexport interface IPlayer extends IBasePlayable<MediaPlayerEvents> {\r\n    data: FullAudioRecord | string;\r\n    clear(): void;\r\n    load(data: FullAudioRecord | string, prog?: IProgress): Promise<this>;\r\n}\r\n\r\nclass MediaPlayerEvent<T extends string> extends MediaElementSourceEvent<T, IPlayer> {\r\n    constructor(type: T, source: IPlayer) {\r\n        super(type, source);\r\n    }\r\n}\r\n\r\nexport class MediaPlayerLoadingEvent extends MediaPlayerEvent<\"loading\"> {\r\n    constructor(source: IPlayer) {\r\n        super(\"loading\", source);\r\n    }\r\n}\r\n\r\nexport interface MediaPlayerEvents extends BaseMediaElementSourceEvents<IPlayer> {\r\n    loading: MediaPlayerLoadingEvent;\r\n}\r\n", "import { autoPlay, controls, loop, playsInline } from \"@juniper-lib/dom/attrs\";\r\nimport { Audio, ErsatzElement, mediaElementCanPlayThrough } from \"@juniper-lib/dom/tags\";\r\nimport { arrayClear, arrayReplace, arraySortByKeyInPlace, AsyncCallback, IDisposable, IProgress, isDefined, isNullOrUndefined, isString, once } from \"@juniper-lib/tslib\";\r\nimport { AudioRecord, FullAudioRecord } from \"../data\";\r\nimport { audioReady, MediaElementSource, removeVertex } from \"../nodes\";\r\nimport { BaseAudioSource } from \"./BaseAudioSource\";\r\nimport { MediaElementSourceLoadedEvent, MediaElementSourcePausedEvent, MediaElementSourcePlayedEvent, MediaElementSourceProgressEvent, MediaElementSourceStoppedEvent } from \"./IPlayable\";\r\nimport { IPlayer, MediaPlayerEvents, MediaPlayerLoadingEvent } from \"./IPlayer\";\r\nimport { PlaybackState } from \"./PlaybackState\";\r\nimport { NoSpatializationNode } from \"./spatializers/NoSpatializationNode\";\r\n\r\nexport class AudioPlayer\r\n    extends BaseAudioSource<MediaElementAudioSourceNode, MediaPlayerEvents>\r\n    implements ErsatzElement, IPlayer, IDisposable {\r\n\r\n    private readonly loadingEvt: MediaPlayerLoadingEvent;\r\n    private readonly loadEvt: MediaElementSourceLoadedEvent<IPlayer>;\r\n    private readonly playEvt: MediaElementSourcePlayedEvent<IPlayer>;\r\n    private readonly pauseEvt: MediaElementSourcePausedEvent<IPlayer>;\r\n    private readonly stopEvt: MediaElementSourceStoppedEvent<IPlayer>;\r\n    private readonly progEvt: MediaElementSourceProgressEvent<IPlayer>;\r\n\r\n    private readonly onError: AsyncCallback;\r\n    private readonly onPlay: () => void;\r\n    private readonly onCanPlay: () => void;\r\n    private readonly onWaiting: () => void;\r\n    private readonly onPause: (evt: Event) => void;\r\n    private readonly onTimeUpdate: AsyncCallback;\r\n\r\n    private _data: FullAudioRecord | string = null;\r\n    get data(): FullAudioRecord | string {\r\n        return this._data;\r\n    }\r\n\r\n    private _loaded = false;\r\n    public get loaded() {\r\n        return this._loaded;\r\n    }\r\n\r\n    readonly element: HTMLAudioElement;\r\n    private readonly audioSource: MediaElementAudioSourceNode;\r\n\r\n    get title() {\r\n        return this.element.title;\r\n    }\r\n\r\n    protected setTitle(v: string): void {\r\n        this.element.title = v;\r\n    }\r\n\r\n    private readonly sourcesByURL = new Map<string, AudioRecord>();\r\n    private readonly sources = new Array<AudioRecord>();\r\n    private readonly potatoes = new Array<string>();\r\n\r\n    constructor(audioCtx: AudioContext) {\r\n        super(\"JuniperAudioPlayer\", audioCtx, NoSpatializationNode.instance(audioCtx));\r\n\r\n        this.element = Audio(\r\n            playsInline(true),\r\n            autoPlay(false),\r\n            loop(false),\r\n            controls(true)\r\n        );\r\n\r\n        this.input = MediaElementSource(\r\n            \"JuniperAudioPlayer-Input\",\r\n            audioCtx,\r\n            this.element);\r\n\r\n        this.loadingEvt = new MediaPlayerLoadingEvent(this);\r\n        this.loadEvt = new MediaElementSourceLoadedEvent(this);\r\n        this.playEvt = new MediaElementSourcePlayedEvent(this);\r\n        this.pauseEvt = new MediaElementSourcePausedEvent(this);\r\n        this.stopEvt = new MediaElementSourceStoppedEvent(this);\r\n        this.progEvt = new MediaElementSourceProgressEvent(this);\r\n\r\n        this.onPlay = async () => {\r\n            this.connect();\r\n            this.dispatchEvent(this.playEvt)\r\n        };\r\n\r\n        this.onPause = (evt: Event) => {\r\n            this.disconnect();\r\n\r\n            if (this.element.currentTime === 0 || evt.type === \"ended\") {\r\n                this.dispatchEvent(this.stopEvt);\r\n            }\r\n            else {\r\n                this.dispatchEvent(this.pauseEvt);\r\n            }\r\n        };\r\n\r\n        this.onTimeUpdate = async () => {\r\n            this.progEvt.value = this.element.currentTime;\r\n            this.progEvt.total = this.element.duration;\r\n            this.dispatchEvent(this.progEvt);\r\n        };\r\n\r\n        this.onError = () => this.loadAudio();\r\n\r\n        this.element.addEventListener(\"play\", this.onPlay);\r\n        this.element.addEventListener(\"pause\", this.onPause);\r\n        this.element.addEventListener(\"ended\", this.onPause);\r\n        this.element.addEventListener(\"error\", this.onError);\r\n        this.element.addEventListener(\"waiting\", this.onWaiting);\r\n        this.element.addEventListener(\"canplay\", this.onCanPlay);\r\n        this.element.addEventListener(\"timeupdate\", this.onTimeUpdate);\r\n\r\n\r\n        Object.assign(window, { audioPlayer: this });\r\n    }\r\n\r\n    get hasAudio() {\r\n        const source = this.sourcesByURL.get(this.element.src);\r\n        return isDefined(source) && source.acodec !== \"none\"\r\n            || isDefined(this.element.audioTracks) && this.element.audioTracks.length > 0\r\n            || isDefined(this.element.webkitAudioDecodedByteCount) && this.element.webkitAudioDecodedByteCount > 0\r\n            || isDefined(this.element.mozHasAudio) && this.element.mozHasAudio;\r\n    }\r\n\r\n    protected override onDisposing(): void {\r\n        super.onDisposing();\r\n        this.clear();\r\n        removeVertex(this.input);\r\n        removeVertex(this.audioSource);\r\n\r\n        this.element.removeEventListener(\"play\", this.onPlay);\r\n        this.element.removeEventListener(\"pause\", this.onPause);\r\n        this.element.removeEventListener(\"ended\", this.onPause);\r\n        this.element.removeEventListener(\"error\", this.onError);\r\n        this.element.removeEventListener(\"waiting\", this.onWaiting);\r\n        this.element.removeEventListener(\"canplay\", this.onCanPlay);\r\n        this.element.removeEventListener(\"timeupdate\", this.onTimeUpdate);\r\n    }\r\n\r\n    clear(): void {\r\n        this.stop();\r\n\r\n        this.sourcesByURL.clear();\r\n        arrayClear(this.sources);\r\n        arrayClear(this.potatoes);\r\n\r\n        this.element.src = \"\";\r\n        this._data = null;\r\n        this._loaded = false;\r\n    }\r\n\r\n    async load(data: FullAudioRecord | string, prog?: IProgress): Promise<this> {\r\n        this.clear();\r\n\r\n        this._data = data;\r\n\r\n        if (isString(data)) {\r\n            this.setTitle(data);\r\n            this.potatoes.push(data);\r\n        }\r\n        else {\r\n            this.setTitle(data.title);\r\n            arraySortByKeyInPlace(data.audios, (f) => -f.resolution);\r\n            arrayReplace(this.sources, ...data.audios);\r\n        }\r\n\r\n        for (const audio of this.sources) {\r\n            this.sourcesByURL.set(audio.url, audio);\r\n        }\r\n\r\n        if (!this.hasSources) {\r\n            throw new Error(\"No audio sources\");\r\n        }\r\n\r\n        this.dispatchEvent(this.loadingEvt);\r\n\r\n        await this.loadAudio(prog);\r\n\r\n        if (!this.hasSources) {\r\n            throw new Error(\"No audio sources\");\r\n        }\r\n\r\n        this._loaded = true;\r\n        this.dispatchEvent(this.loadEvt);\r\n        return this;\r\n    }\r\n\r\n    private async getMediaCapabilities<T extends AudioRecord>(source: T): Promise<MediaCapabilitiesDecodingInfo> {\r\n        const config: MediaDecodingConfiguration = {\r\n            type: \"file\",\r\n            audio: {\r\n                contentType: source.contentType,\r\n                bitrate: source.abr * 1024,\r\n                samplerate: source.asr\r\n            }\r\n        }\r\n\r\n        try {\r\n            return await navigator.mediaCapabilities.decodingInfo(config)\r\n        }\r\n        catch {\r\n            return {\r\n                supported: true,\r\n                powerEfficient: false,\r\n                smooth: false,\r\n                configuration: config\r\n            };\r\n        }\r\n    }\r\n\r\n    private get hasSources(): boolean {\r\n        return this.sources.length > 0\r\n            || this.potatoes.length > 0;\r\n    }\r\n\r\n    private async loadAudio(prog?: IProgress): Promise<void> {\r\n        if (isDefined(prog)) {\r\n            prog.start();\r\n        }\r\n\r\n        this.element.removeEventListener(\"error\", this.onError);\r\n\r\n        while (this.hasSources) {\r\n            let url: string = null;\r\n            const source = this.sources.shift();\r\n            if (isDefined(source)) {\r\n                const caps = await this.getMediaCapabilities(source);\r\n                if (!caps.smooth || !caps.powerEfficient) {\r\n                    this.potatoes.push(source.url);\r\n                    continue;\r\n                }\r\n                else {\r\n                    url = source.url;\r\n                }\r\n            }\r\n            else {\r\n                url = this.potatoes.shift();\r\n            }\r\n\r\n            this.element.src = url;\r\n            this.element.load();\r\n            if (await mediaElementCanPlayThrough(this.element)) {\r\n                if (isDefined(source)) {\r\n                    this.sources.unshift(source);\r\n                }\r\n                else {\r\n                    this.potatoes.unshift(url);\r\n                }\r\n\r\n                this.element.addEventListener(\"error\", this.onError);\r\n\r\n                if (isDefined(prog)) {\r\n                    prog.end();\r\n                }\r\n\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    get playbackState(): PlaybackState {\r\n        if (isNullOrUndefined(this.data)) {\r\n            return \"empty\";\r\n        }\r\n\r\n        if (!this.loaded) {\r\n            return \"loading\";\r\n        }\r\n\r\n        if (this.element.error) {\r\n            return \"errored\";\r\n        }\r\n\r\n        if (this.element.ended\r\n            || this.element.paused\r\n            && this.element.currentTime === 0) {\r\n            return \"stopped\";\r\n        }\r\n\r\n        if (this.element.paused) {\r\n            return \"paused\";\r\n        }\r\n\r\n        return \"playing\";\r\n    }\r\n\r\n    async play(): Promise<void> {\r\n        await audioReady(this.audioCtx);\r\n        await this.element.play();\r\n    }\r\n\r\n    async playThrough(): Promise<void> {\r\n        const endTask = once(this, \"stopped\");\r\n        await this.play();\r\n        await endTask;\r\n    }\r\n\r\n    pause(): void {\r\n        this.element.pause();\r\n    }\r\n\r\n    stop(): void {\r\n        this.pause();\r\n        this.element.currentTime = 0;\r\n    }\r\n\r\n    restart(): Promise<void> {\r\n        this.stop();\r\n        return this.play();\r\n    }\r\n}\r\n\r\n", "export const DEFAULT_LOCAL_USER_ID = \"local-user\";\r\n\r\n", "import { src, title } from \"@juniper-lib/dom/attrs\";\r\nimport { CanvasImageTypes, CanvasTypes, createUICanvas } from \"@juniper-lib/dom/canvas\";\r\nimport { Img } from \"@juniper-lib/dom/tags\";\r\nimport type { IFetcher } from \"@juniper-lib/fetcher\";\r\nimport { Exception, IProgress, nextPowerOf2, PoppableParentProgressCallback, PriorityMap, progressPopper, Task } from \"@juniper-lib/tslib\";\r\n\r\ninterface UVRect {\r\n    u: number;\r\n    v: number;\r\n    du: number;\r\n    dv: number;\r\n}\r\n\r\nasync function loadIcon(fetcher: IFetcher, setName: string, iconName: string, iconPath: string, popper: PoppableParentProgressCallback): Promise<[string, string, CanvasImageTypes]> {\r\n    const { content } = await fetcher\r\n        .get(iconPath)\r\n        .progress(popper.pop())\r\n        .image();\r\n    return [\r\n        setName,\r\n        iconName,\r\n        content\r\n    ];\r\n}\r\n\r\nexport class ButtonFactory {\r\n    private readonly uvDescrips = new PriorityMap<string, string, UVRect>();\r\n    private readonly geoms = new PriorityMap<string, string, THREE.BufferGeometry>();\r\n\r\n    private readonly readyTask: Task<void>;\r\n\r\n    private canvas: CanvasTypes = null;\r\n    private texture: THREE.Texture = null;\r\n    private enabledMaterial: THREE.MeshBasicMaterial = null;\r\n    private disabledMaterial: THREE.MeshBasicMaterial = null;\r\n\r\n    constructor(private readonly fetcher: IFetcher, private readonly imagePaths: PriorityMap<string, string, string>, private readonly padding: number) {\r\n        this.readyTask = new Task();\r\n    }\r\n\r\n    async load(prog?: IProgress) {\r\n        const popper = progressPopper(prog);\r\n        const imageSets = new PriorityMap(await Promise.all(\r\n            Array.from(this.imagePaths.entries())\r\n                .map(([setName, iconName, path]) =>\r\n                    loadIcon(this.fetcher, setName, iconName, path, popper))));\r\n        const images = Array.from(imageSets.values());\r\n        const iconWidth = Math.max(...images.map((img) => img.width));\r\n        const iconHeight = Math.max(...images.map((img) => img.height));\r\n        const area = iconWidth * iconHeight * images.length;\r\n        const squareDim = Math.sqrt(area);\r\n        const cols = Math.floor(squareDim / iconWidth);\r\n        const rows = Math.ceil(images.length / cols);\r\n        const width = cols * iconWidth;\r\n        const height = rows * iconHeight;\r\n        const canvWidth = nextPowerOf2(width);\r\n        const canvHeight = nextPowerOf2(height);\r\n        const widthRatio = width / canvWidth;\r\n        const heightRatio = height / canvHeight;\r\n        const du = iconWidth / canvWidth;\r\n        const dv = iconHeight / canvHeight;\r\n\r\n        this.canvas = createUICanvas(canvWidth, canvHeight);\r\n\r\n        const g = this.canvas.getContext(\"2d\");\r\n        g.fillStyle = \"#1e4388\";\r\n        g.fillRect(0, 0, canvWidth, canvHeight);\r\n\r\n        let i = 0;\r\n        for (const [setName, imgName, img] of imageSets.entries()) {\r\n            const c = i % cols;\r\n            const r = (i - c) / cols;\r\n            const u = widthRatio * (c * iconWidth / width);\r\n            const v = heightRatio * (1 - r / rows) - dv;\r\n            const x = c * iconWidth;\r\n            const y = r * iconHeight + canvHeight - height;\r\n            const w = iconWidth - 2 * this.padding;\r\n            const h = iconHeight - 2 * this.padding;\r\n\r\n            g.drawImage(img,\r\n                0, 0, img.width, img.height,\r\n                x + this.padding, y + this.padding, w, h);\r\n            this.uvDescrips.add(setName, imgName, { u, v, du, dv });\r\n\r\n            ++i;\r\n        }\r\n\r\n        this.texture = new THREE.CanvasTexture(this.canvas as any);\r\n        this.enabledMaterial = new THREE.MeshBasicMaterial({\r\n            map: this.texture,\r\n        });\r\n        this.enabledMaterial.needsUpdate = true;\r\n        this.disabledMaterial = new THREE.MeshBasicMaterial({\r\n            map: this.texture,\r\n            transparent: true,\r\n            opacity: 0.5\r\n        });\r\n        this.disabledMaterial.needsUpdate = true;\r\n\r\n        this.readyTask.resolve();\r\n    }\r\n\r\n    getSets() {\r\n        return Array.from(this.imagePaths.keys());\r\n    }\r\n\r\n    getIcons(setName: string) {\r\n        if (!this.imagePaths.has(setName)) {\r\n            throw new Exception(`Button set ${setName} does not exist`);\r\n        }\r\n\r\n        return Array.from(this.imagePaths.get(setName).keys());\r\n    }\r\n\r\n    async getMaterial(enabled: boolean) {\r\n        await this.readyTask;\r\n        return enabled\r\n            ? this.enabledMaterial\r\n            : this.disabledMaterial;\r\n    }\r\n\r\n    async getGeometry(setName: string, iconName: string) {\r\n        await this.readyTask;\r\n        const uvSet = this.uvDescrips.get(setName);\r\n        const uv = uvSet && uvSet.get(iconName);\r\n        if (!uvSet || !uv) {\r\n            throw new Exception(`Button ${setName}/${iconName} does not exist`, this.uvDescrips);\r\n        }\r\n\r\n\r\n        let geom = this.geoms.get(setName, iconName);\r\n        if (!geom) {\r\n            geom = new THREE.PlaneBufferGeometry(1, 1, 1, 1)\r\n            geom.name = `Geometry:${setName}/${iconName}`;\r\n\r\n            this.geoms.add(setName, iconName, geom);\r\n\r\n            const uvBuffer = geom.getAttribute(\"uv\");\r\n            for (let i = 0; i < uvBuffer.count; ++i) {\r\n                const u = uvBuffer.getX(i) * uv.du + uv.u;\r\n                const v = uvBuffer.getY(i) * uv.dv + uv.v;\r\n                uvBuffer.setX(i, u);\r\n                uvBuffer.setY(i, v);\r\n            }\r\n        }\r\n        return geom;\r\n    }\r\n\r\n    async getMesh(setName: string, iconName: string, enabled: boolean) {\r\n        const geom = await this.getGeometry(setName, iconName);\r\n        const mesh = new THREE.Mesh(\r\n            geom,\r\n            enabled\r\n                ? this.enabledMaterial\r\n                : this.disabledMaterial);\r\n        mesh.name = `Mesh:${setName}/${iconName}`;\r\n        return mesh;\r\n    }\r\n\r\n    async getGeometryAndMaterials(setName: string, iconName: string) {\r\n        const [geometry, enabledMaterial, disabledMaterial] = await Promise.all([\r\n            this.getGeometry(setName, iconName),\r\n            this.getMaterial(true),\r\n            this.getMaterial(false)\r\n        ]);\r\n\r\n        return {\r\n            geometry,\r\n            enabledMaterial,\r\n            disabledMaterial\r\n        }\r\n    }\r\n\r\n    getImageSrc(setName: string, iconName: string) {\r\n        const imageSet = this.imagePaths.get(setName);\r\n        const imgSrc = imageSet && imageSet.get(iconName);\r\n        if (!imageSet || !imgSrc) {\r\n            throw new Exception(`Button ${setName}/${iconName} does not exist`, this.uvDescrips);\r\n        }\r\n\r\n        return imgSrc;\r\n    }\r\n\r\n    getImageElement(setName: string, iconName: string) {\r\n        return Img(\r\n            title(setName + \" \" + iconName),\r\n            src(this.getImageSrc(setName, iconName)));\r\n    }\r\n}\r\n", "import { arrayClear, Task } from \"@juniper-lib/tslib\";\r\n\r\nexport class Animator {\r\n    private animations = new Array<(dt: number) => void>();\r\n\r\n    update(dt: number) {\r\n        dt = 0.001 * dt;\r\n        for (const animation of this.animations) {\r\n            animation(dt);\r\n        }\r\n    }\r\n\r\n    clear() {\r\n        arrayClear(this.animations);\r\n    }\r\n\r\n    start(delay: number, duration: number, update: (t: number) => void): Promise<void> {\r\n        let time = -delay;\r\n        update(0);\r\n        const animationComplete = new Task();\r\n        this.animations.push((dt: number) => {\r\n            time += dt / duration;\r\n            if (time >= 1) {\r\n                update(1);\r\n                animationComplete.resolve();\r\n            }\r\n            else if (time >= 0) {\r\n                update(time);\r\n            }\r\n        });\r\n        return animationComplete;\r\n    }\r\n}\r\n", "export type TweenFunc = (t: number, k: number, d: boolean) => number;\r\n\r\n/**\r\n * Different modes of animating a single value from 0 to 1.\r\n **/\r\nexport type TweenType =\r\n    /**\r\n     * The most basic form of `tween, values increase in proportion to time, from\r\n     * 0 to 1 in the forward direction, then 1 to 0 in the reverse direction.\r\n     **/\r\n    \"Linear\"\r\n\r\n    /**\r\n     * Values increase in proportion to time from -1 to 0 in the forward direction,\r\n     * then 0 to 1 in the reverse, rather than decreasing from 1 to 0.\r\n     **/\r\n    | \"LinearContinuous\"\r\n\r\n    /**\r\n     * Values increase in proportion to the square of time, from 0 to 1 in the forward direction,\r\n     * then 1 to 0 in the reverse direction.\r\n     **/\r\n    | \"Quadratic\"\r\n\r\n    /**\r\n     * Values increase in proportion to the square of time. from -1 to 0 in the forward direction,\r\n     * then 0 to 1 in the reverse direction.\r\n     **/\r\n    | \"QuadraticContinuous\"\r\n\r\n    | \"Sine\"\r\n\r\n    | \"SineContinuous\"\r\n\r\n    /**\r\n     * Similar to <see cref=\"Sine\"/>, but values bump in the opposite direction slightly, before\r\n     * the beginning and the end of the curve.\r\n     **/\r\n    | \"Bump\"\r\n\r\n    /**\r\n     * Similar to <see cref=\"Sine\"/>, but values bump in the opposite direction slightly, before\r\n     * the beginning and the end of the curve.\r\n     **/\r\n    | \"BumpContinuous\"\r\n\r\n    | \"Jump\";\r\n\r\n/**\r\n * Implementations for each of the values in <see cref=\"TweenType\"/>.\r\n * All functions receive a value t, representing the proportion of the way through the animation process we are\r\n * calculating. All functions take an extra `k` parameter, for scaling tertiary effects; most functions do not use it.\r\n * All functions return a value v, mapping the value t to one of the desired 'tween shapes.\r\n **/\r\nexport function isContinuous(tween: TweenType): boolean {\r\n    return tween == \"LinearContinuous\"\r\n        || tween == \"QuadraticContinuous\"\r\n        || tween == \"SineContinuous\"\r\n        || tween == \"BumpContinuous\";\r\n}\r\n\r\nexport function linear(t: number): number {\r\n    return t;\r\n}\r\n\r\nexport function quadratic(t: number): number {\r\n    return t * t;\r\n}\r\n\r\nexport function sine(t: number): number {\r\n    const a = t * Math.PI;\r\n    return Math.sin(a);\r\n}\r\n\r\nexport function bump(t: number, k: number): number {\r\n    const a = t * Math.PI;\r\n    return ((0.5 * (1 - Math.cos(a))) - (k * Math.sin(2 * a)));\r\n}\r\n\r\nexport function jump(t: number, k: number): number {\r\n    const a = (t - 0.5) * Math.PI;\r\n    return t * t + k * Math.cos(a);\r\n}\r\n\r\nexport function linearContinuous(t: number, _k: number, d: boolean): number {\r\n    if (d) {\r\n        return t - 1;\r\n    }\r\n    else {\r\n        return 1 - t;\r\n    }\r\n}\r\n\r\nexport function quadraticContinuous(t: number, _k: number, d: boolean): number {\r\n    t = linearContinuous(t, null, d);\r\n    return Math.sign(t) * quadratic(t);\r\n}\r\n\r\nexport function sineContinuous(t: number, _k: number, d: boolean): number {\r\n    t = linearContinuous(t, null, d);\r\n    return sine(t);\r\n}\r\n\r\nexport function bumpContinuous(t: number, k: number, d: boolean): number {\r\n    t = linearContinuous(t, null, d);\r\n    return bump(t, k);\r\n}", "import { classList, className, customData } from \"@juniper-lib/dom/attrs\";\r\nimport { backgroundColor, boxShadow, display, float, gridArea, gridTemplateColumns, gridTemplateRows, height, left, maxHeight, maxWidth, overflow, padding, position, rule, styles, textAlign, top, transform, width, zIndex } from \"@juniper-lib/dom/css\";\r\nimport { ButtonPrimary, ButtonSecondary, Div, elementApply, elementIsDisplayed, elementSetDisplay, elementSetText, ErsatzElement, H1, Style } from \"@juniper-lib/dom/tags\";\r\nimport { once, success, TypedEvent, TypedEventBase } from \"@juniper-lib/tslib\";\r\n\r\nStyle(\r\n    rule(\".dialog, .dialog-container\",\r\n        position(\"fixed\")),\r\n    rule(\".dialog\",\r\n        top(0),\r\n        left(0),\r\n        width(\"100%\"),\r\n        height(\"100%\"),\r\n        backgroundColor(\"rgba(0, 0, 0, 0.5)\"),\r\n        zIndex(100)),\r\n    rule(\".dialog-container\",\r\n        top(\"50%\"),\r\n        left(\"50%\"),\r\n        maxWidth(\"100%\"),\r\n        maxHeight(\"100%\"),\r\n        transform(\"translateX(-50%) translateY(-50%)\"),\r\n        backgroundColor(\"white\"),\r\n        boxShadow(\"rgba(0,0,0,0.5) 0px 5px 30px\"),\r\n        display(\"grid\"),\r\n        gridTemplateColumns(\"2em auto 2em\"),\r\n        gridTemplateRows(\"auto 1fr auto 2em\")),\r\n    rule(\".dialog .title-bar\",\r\n        gridArea(1, 1, 2, -1),\r\n        padding(\"0.25em\")),\r\n    rule(\".dialog-content\",\r\n        gridArea(2, 2, -4, -2),\r\n        overflow(\"auto\")),\r\n    rule(\".dialog-controls\",\r\n        gridArea(-2, 2, -3, -2)),\r\n    rule(\".dialog .confirm-button\",\r\n        float(\"right\")),\r\n    rule(\".dialog h1, .dialog h2, .dialog h3, .dialog h4, .dialog h5, .dialog h6\",\r\n        textAlign(\"left\")),\r\n    rule(\".dialog select\",\r\n        maxWidth(\"10em\"))\r\n);\r\n\r\nexport abstract class DialogBox\r\n    implements ErsatzElement {\r\n\r\n    public readonly element: HTMLDivElement;\r\n\r\n    private subEventer = new TypedEventBase<{\r\n        confirm: TypedEvent<\"confirm\">;\r\n        cancel: TypedEvent<\"cancel\">;\r\n    }>();\r\n\r\n    private _title: string;\r\n    private readonly titleElement: HTMLElement;\r\n\r\n    protected readonly container: HTMLDivElement;\r\n    protected readonly contentArea: HTMLDivElement;\r\n    protected readonly confirmButton: HTMLButtonElement;\r\n    protected readonly cancelButton: HTMLButtonElement;\r\n\r\n\r\n    constructor(title: string) {\r\n\r\n        this.element = Div(\r\n            className(\"dialog\"),\r\n            customData(\"dialogname\", title),\r\n            styles(display(\"none\")),\r\n            this.container = Div(className(\"dialog-container\"),\r\n                this.titleElement = H1(className(\"title-bar\"), title),\r\n                this.contentArea = Div(className(\"dialog-content\")),\r\n                Div(className(\"dialog-controls\"),\r\n                    this.confirmButton = ButtonPrimary(\"Confirm\", classList(\"confirm-button\")),\r\n                    this.cancelButton = ButtonSecondary(\"Cancel\", classList(\"cancel-button\")))));\r\n\r\n        this.confirmButton.addEventListener(\"click\", () => this.subEventer.dispatchEvent(new TypedEvent(\"confirm\")));\r\n\r\n        this.cancelButton.addEventListener(\"click\", () => this.subEventer.dispatchEvent(new TypedEvent(\"cancel\")));\r\n\r\n        elementApply(document.body, this);\r\n    }\r\n\r\n    get title() {\r\n        return this._title;\r\n    }\r\n\r\n    set title(v: string) {\r\n        elementSetText(this.titleElement, this._title = v);\r\n    }\r\n\r\n    protected async onShowing(): Promise<void> {\r\n        // nothing to do in the base case.\r\n    }\r\n\r\n    protected onShown(): void {\r\n        // nothing to do in the base case.\r\n    }\r\n\r\n    protected async onConfirm(): Promise<void> {\r\n        // nothing to do in the base case.\r\n    }\r\n\r\n    protected onCancel(): void {\r\n        // nothing to do in the base case.\r\n    }\r\n\r\n    protected async onClosing(): Promise<void> {\r\n        // nothing to do in the base case.\r\n    }\r\n\r\n    protected onClosed(): void {\r\n        // nothing to do in the base case.\r\n    }\r\n\r\n    private show(v: boolean) {\r\n        elementSetDisplay(this, v);\r\n    }\r\n\r\n    get isOpen() {\r\n        return elementIsDisplayed(this);\r\n    }\r\n\r\n    async showDialog(): Promise<boolean> {\r\n        await this.onShowing();\r\n        this.show(true);\r\n        this.onShown();\r\n\r\n        const confirming = once(this.subEventer, \"confirm\", \"cancel\");\r\n        const confirmed = await success(confirming);\r\n        if (confirmed) {\r\n            await this.onConfirm();\r\n        }\r\n        else {\r\n            this.onCancel();\r\n        }\r\n\r\n        await this.onClosing();\r\n        this.show(false);\r\n        this.onClosed();\r\n\r\n        return confirmed;\r\n    }\r\n}\r\n", "import { isDefined } from \"@juniper-lib/tslib\";\r\n\r\nexport function isMesh(obj: any): obj is THREE.Mesh {\r\n    return isDefined(obj)\r\n        && obj.isMesh;\r\n}\r\n\r\nexport function isMaterial(obj: any): obj is THREE.Material {\r\n    return isDefined(obj)\r\n        && obj.isMaterial;\r\n}\r\n\r\nexport function isMeshBasicMaterial(obj: any): obj is THREE.MeshBasicMaterial {\r\n    return isMaterial(obj)\r\n        && obj.type === \"MeshBasicMaterial\";\r\n}\r\n\r\nexport function isMeshStandardMaterial(obj: any): obj is THREE.MeshStandardMaterial {\r\n    return isMaterial(obj)\r\n        && obj.type === \"MeshStandardMaterial\";\r\n}\r\n\r\nexport function isMeshPhysicalMaterial(obj: any): obj is THREE.MeshPhysicalMaterial {\r\n    return isMaterial(obj)\r\n        && obj.type === \"MeshPhysicalMaterial\";\r\n}\r\n\r\nexport function isTexture(obj: any): obj is THREE.Texture {\r\n    return isDefined(obj)\r\n        && obj.isTexture;\r\n}\r\n\r\nexport function isCubeTexture(obj: any): obj is THREE.CubeTexture {\r\n    return isDefined(obj)\r\n        && obj.isCubeTexture;\r\n}\r\n\r\nexport function isObject3D(obj: any): obj is THREE.Object3D {\r\n    return isDefined(obj)\r\n        && obj.isObject3D;\r\n}\r\n\r\nexport function isQuaternion(obj: any): obj is THREE.Quaternion {\r\n    return isDefined(obj)\r\n        && obj.isQuaternion;\r\n}\r\n\r\nexport function isEuler(obj: any): obj is THREE.Euler {\r\n    return isDefined(obj)\r\n        && obj.isEuler;\r\n}", "import { isDisableable } from \"@juniper-lib/dom/tags\";\r\nimport { isDefined } from \"@juniper-lib/tslib\";\r\nimport { isObject3D } from \"./typeChecks\";\r\n\r\nexport interface ErsatzObject {\r\n    object: THREE.Object3D;\r\n}\r\n\r\nexport function isErsatzObject(obj: any): obj is ErsatzObject {\r\n    return isDefined(obj)\r\n        && isObject3D(obj.object);\r\n}\r\n\r\nexport type Objects = THREE.Object3D | ErsatzObject;\r\n\r\nexport function isObjects(obj: any): obj is Objects {\r\n    return isErsatzObject(obj)\r\n        || isObject3D(obj);\r\n}\r\n\r\nexport function objectResolve(obj: Objects): THREE.Object3D {\r\n    if (isErsatzObject(obj)) {\r\n        return obj.object;\r\n    }\r\n\r\n    return obj;\r\n}\r\n\r\nexport function objectSetVisible(obj: Objects, visible: boolean): boolean {\r\n    obj = objectResolve(obj);\r\n    obj.visible = visible;\r\n    return visible;\r\n}\r\n\r\nexport function objectIsVisible(obj: Objects): boolean {\r\n    obj = objectResolve(obj);\r\n    return obj.visible;\r\n}\r\n\r\nexport function objectIsFullyVisible(obj: Objects) {\r\n    obj = objectResolve(obj);\r\n    while (obj) {\r\n        if (!obj.visible) {\r\n            return false;\r\n        }\r\n        obj = obj.parent;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport function objectToggleVisible(obj: Objects): void {\r\n    objectSetVisible(obj, !objectIsVisible(obj));\r\n}\r\n\r\nexport function objGraph(obj: Objects, ...children: Objects[]): Objects {\r\n    const toAdd = children\r\n        .filter(isDefined)\r\n        .map(objectResolve);\r\n    if (toAdd.length > 0) {\r\n        objectResolve(obj)\r\n            .add(...toAdd);\r\n    }\r\n\r\n    return obj;\r\n}\r\n\r\nexport function objectRemove(obj: Objects, ...children: Objects[]): void {\r\n    const toRemove = children\r\n        .filter(isDefined)\r\n        .map(objectResolve);\r\n    if (toRemove.length > 0) {\r\n        objectResolve(obj)\r\n            .remove(...toRemove);\r\n    }\r\n}\r\n\r\nexport function obj(name: string, ...rest: Objects[]): THREE.Object3D {\r\n    const obj = new THREE.Object3D();\r\n    obj.name = name;\r\n    objGraph(obj, ...rest);\r\n    return obj;\r\n}\r\n\r\nexport function objectClearChildren(obj: Objects) {\r\n    obj = objectResolve(obj);\r\n    obj.clear();\r\n}\r\n\r\nexport function objectSetEnabled(obj: Objects, enabled: boolean) {\r\n    obj = objectResolve(obj);\r\n    if (isDisableable(obj)) {\r\n        obj.disabled = !enabled;\r\n    }\r\n}\r\n\r\nexport function objectSetWorldPosition(obj: Objects, pos: THREE.Vector3) {\r\n    obj = objectResolve(obj);\r\n    const parent = obj.parent;\r\n    obj.removeFromParent();\r\n    obj.position.copy(pos);\r\n    if (isDefined(parent)) {\r\n        parent.attach(obj);\r\n    }\r\n}", "/**\r\n * parameters = {\r\n *  color: <hex>,\r\n *  linewidth: <float>,\r\n *  dashed: <boolean>,\r\n *  dashScale: <float>,\r\n *  dashSize: <float>,\r\n *  dashOffset: <float>,\r\n *  gapSize: <float>,\r\n *  resolution: <THREE.Vector2>, // to be set by renderer\r\n * }\r\n */\r\n\r\n\r\nTHREE.UniformsLib.line = {\r\n\r\n    worldUnits: { value: 1 },\r\n    linewidth: { value: 1 },\r\n    resolution: { value: new THREE.Vector2(1, 1) },\r\n    dashOffset: { value: 0 },\r\n    dashScale: { value: 1 },\r\n    dashSize: { value: 1 },\r\n    gapSize: { value: 1 } // todo FIX - maybe change to totalSize\r\n\r\n};\r\n\r\nTHREE.ShaderLib['line'] = {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n        THREE.UniformsLib.common,\r\n        THREE.UniformsLib.fog,\r\n        THREE.UniformsLib.line\r\n    ]),\r\n\r\n    vertexShader:\r\n\t/* glsl */`\r\n\t\t#include <common>\r\n\t\t#include <color_pars_vertex>\r\n\t\t#include <fog_pars_vertex>\r\n\t\t#include <logdepthbuf_pars_vertex>\r\n\t\t#include <clipping_planes_pars_vertex>\r\n\r\n\t\tuniform float linewidth;\r\n\t\tuniform vec2 resolution;\r\n\r\n\t\tattribute vec3 instanceStart;\r\n\t\tattribute vec3 instanceEnd;\r\n\r\n\t\tattribute vec3 instanceColorStart;\r\n\t\tattribute vec3 instanceColorEnd;\r\n\r\n\t\t#ifdef WORLD_UNITS\r\n\r\n\t\t\tvarying vec4 worldPos;\r\n\t\t\tvarying vec3 worldStart;\r\n\t\t\tvarying vec3 worldEnd;\r\n\r\n\t\t\t#ifdef USE_DASH\r\n\r\n\t\t\t\tvarying vec2 vUv;\r\n\r\n\t\t\t#endif\r\n\r\n\t\t#else\r\n\r\n\t\t\tvarying vec2 vUv;\r\n\r\n\t\t#endif\r\n\r\n\t\t#ifdef USE_DASH\r\n\r\n\t\t\tuniform float dashScale;\r\n\t\t\tattribute float instanceDistanceStart;\r\n\t\t\tattribute float instanceDistanceEnd;\r\n\t\t\tvarying float vLineDistance;\r\n\r\n\t\t#endif\r\n\r\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\r\n\r\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\r\n\r\n\t\t\t// conservative estimate of the near plane\r\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\r\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\r\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\r\n\r\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\r\n\r\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\r\n\r\n\t\t}\r\n\r\n\t\tvoid main() {\r\n\r\n\t\t\t#ifdef USE_COLOR\r\n\r\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\t#ifdef USE_DASH\r\n\r\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\r\n\t\t\t\tvUv = uv;\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\tfloat aspect = resolution.x / resolution.y;\r\n\r\n\t\t\t// camera space\r\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\r\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\r\n\r\n\t\t\t#ifdef WORLD_UNITS\r\n\r\n\t\t\t\tworldStart = start.xyz;\r\n\t\t\t\tworldEnd = end.xyz;\r\n\r\n\t\t\t#else\r\n\r\n\t\t\t\tvUv = uv;\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\r\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\r\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\r\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\r\n\r\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\r\n\r\n\t\t\tif ( perspective ) {\r\n\r\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\r\n\r\n\t\t\t\t\ttrimSegment( start, end );\r\n\r\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\r\n\r\n\t\t\t\t\ttrimSegment( end, start );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// clip space\r\n\t\t\tvec4 clipStart = projectionMatrix * start;\r\n\t\t\tvec4 clipEnd = projectionMatrix * end;\r\n\r\n\t\t\t// ndc space\r\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\r\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\r\n\r\n\t\t\t// direction\r\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\r\n\r\n\t\t\t// account for clip-space aspect ratio\r\n\t\t\tdir.x *= aspect;\r\n\t\t\tdir = normalize( dir );\r\n\r\n\t\t\t#ifdef WORLD_UNITS\r\n\r\n\t\t\t\t// get the offset direction as perpendicular to the view vector\r\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\r\n\t\t\t\tvec3 offset;\r\n\t\t\t\tif ( position.y < 0.5 ) {\r\n\r\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// sign flip\r\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\r\n\r\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\r\n\r\n\t\t\t\t// don't extend the line if we're rendering dashes because we\r\n\t\t\t\t// won't be rendering the endcaps\r\n\t\t\t\t#ifndef USE_DASH\r\n\r\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\r\n\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\r\n\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\r\n\r\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\r\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\r\n\t\t\t\t\toffset.z += 0.5;\r\n\r\n\t\t\t\t#endif\r\n\r\n\t\t\t\t// endcaps\r\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\r\n\r\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// adjust for linewidth\r\n\t\t\t\toffset *= linewidth * 0.5;\r\n\r\n\t\t\t\t// set the world position\r\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\r\n\t\t\t\tworldPos.xyz += offset;\r\n\r\n\t\t\t\t// project the worldpos\r\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\r\n\r\n\t\t\t\t// shift the depth of the projected points so the line\r\n\t\t\t\t// segements overlap neatly\r\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\r\n\t\t\t\tclip.z = clipPose.z * clip.w;\r\n\r\n\t\t\t#else\r\n\r\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\r\n\t\t\t\t// undo aspect ratio adjustment\r\n\t\t\t\tdir.x /= aspect;\r\n\t\t\t\toffset.x /= aspect;\r\n\r\n\t\t\t\t// sign flip\r\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\r\n\r\n\t\t\t\t// endcaps\r\n\t\t\t\tif ( position.y < 0.0 ) {\r\n\r\n\t\t\t\t\toffset += - dir;\r\n\r\n\t\t\t\t} else if ( position.y > 1.0 ) {\r\n\r\n\t\t\t\t\toffset += dir;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// adjust for linewidth\r\n\t\t\t\toffset *= linewidth;\r\n\r\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\r\n\t\t\t\toffset /= resolution.y;\r\n\r\n\t\t\t\t// select end\r\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\r\n\r\n\t\t\t\t// back to clip space\r\n\t\t\t\toffset *= clip.w;\r\n\r\n\t\t\t\tclip.xy += offset;\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\tgl_Position = clip;\r\n\r\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\r\n\r\n\t\t\t#include <logdepthbuf_vertex>\r\n\t\t\t#include <clipping_planes_vertex>\r\n\t\t\t#include <fog_vertex>\r\n\r\n\t\t}\r\n\t\t`,\r\n\r\n    fragmentShader:\r\n\t/* glsl */`\r\n\t\tuniform vec3 diffuse;\r\n\t\tuniform float opacity;\r\n\t\tuniform float linewidth;\r\n\r\n\t\t#ifdef USE_DASH\r\n\r\n\t\t\tuniform float dashOffset;\r\n\t\t\tuniform float dashSize;\r\n\t\t\tuniform float gapSize;\r\n\r\n\t\t#endif\r\n\r\n\t\tvarying float vLineDistance;\r\n\r\n\t\t#ifdef WORLD_UNITS\r\n\r\n\t\t\tvarying vec4 worldPos;\r\n\t\t\tvarying vec3 worldStart;\r\n\t\t\tvarying vec3 worldEnd;\r\n\r\n\t\t\t#ifdef USE_DASH\r\n\r\n\t\t\t\tvarying vec2 vUv;\r\n\r\n\t\t\t#endif\r\n\r\n\t\t#else\r\n\r\n\t\t\tvarying vec2 vUv;\r\n\r\n\t\t#endif\r\n\r\n\t\t#include <common>\r\n\t\t#include <color_pars_fragment>\r\n\t\t#include <fog_pars_fragment>\r\n\t\t#include <logdepthbuf_pars_fragment>\r\n\t\t#include <clipping_planes_pars_fragment>\r\n\r\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\r\n\r\n\t\t\tfloat mua;\r\n\t\t\tfloat mub;\r\n\r\n\t\t\tvec3 p13 = p1 - p3;\r\n\t\t\tvec3 p43 = p4 - p3;\r\n\r\n\t\t\tvec3 p21 = p2 - p1;\r\n\r\n\t\t\tfloat d1343 = dot( p13, p43 );\r\n\t\t\tfloat d4321 = dot( p43, p21 );\r\n\t\t\tfloat d1321 = dot( p13, p21 );\r\n\t\t\tfloat d4343 = dot( p43, p43 );\r\n\t\t\tfloat d2121 = dot( p21, p21 );\r\n\r\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\r\n\r\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\r\n\r\n\t\t\tmua = numer / denom;\r\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\r\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\r\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\r\n\r\n\t\t\treturn vec2( mua, mub );\r\n\r\n\t\t}\r\n\r\n\t\tvoid main() {\r\n\r\n\t\t\t#include <clipping_planes_fragment>\r\n\r\n\t\t\t#ifdef USE_DASH\r\n\r\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\r\n\r\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\tfloat alpha = opacity;\r\n\r\n\t\t\t#ifdef WORLD_UNITS\r\n\r\n\t\t\t\t// Find the closest points on the view ray and the line segment\r\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\r\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\r\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\r\n\r\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\r\n\t\t\t\tvec3 p2 = rayEnd * params.y;\r\n\t\t\t\tvec3 delta = p1 - p2;\r\n\t\t\t\tfloat len = length( delta );\r\n\t\t\t\tfloat norm = len / linewidth;\r\n\r\n\t\t\t\t#ifndef USE_DASH\r\n\r\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\r\n\r\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\r\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\r\n\r\n\t\t\t\t\t#else\r\n\r\n\t\t\t\t\t\tif ( norm > 0.5 ) {\r\n\r\n\t\t\t\t\t\t\tdiscard;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t#endif\r\n\r\n\t\t\t\t#endif\r\n\r\n\t\t\t#else\r\n\r\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\r\n\r\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\r\n\t\t\t\t\tfloat a = vUv.x;\r\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\r\n\t\t\t\t\tfloat len2 = a * a + b * b;\r\n\t\t\t\t\tfloat dlen = fwidth( len2 );\r\n\r\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\r\n\r\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t#else\r\n\r\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\r\n\r\n\t\t\t\t\t\tfloat a = vUv.x;\r\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\r\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\r\n\r\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t#endif\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\r\n\r\n\t\t\t#include <logdepthbuf_fragment>\r\n\t\t\t#include <color_fragment>\r\n\r\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\r\n\r\n\t\t\t#include <tonemapping_fragment>\r\n\t\t\t#include <encodings_fragment>\r\n\t\t\t#include <fog_fragment>\r\n\t\t\t#include <premultiplied_alpha_fragment>\r\n\r\n\t\t}\r\n\t\t`\r\n};\r\n\r\nclass LineMaterial extends THREE.ShaderMaterial {\r\n\r\n    constructor(parameters) {\r\n\r\n        super({\r\n\r\n            type: 'LineMaterial',\r\n\r\n            uniforms: THREE.UniformsUtils.clone(THREE.ShaderLib['line'].uniforms),\r\n\r\n            vertexShader: THREE.ShaderLib['line'].vertexShader,\r\n            fragmentShader: THREE.ShaderLib['line'].fragmentShader,\r\n\r\n            clipping: true // required for clipping support\r\n\r\n        });\r\n\r\n        Object.defineProperties(this, {\r\n\r\n            color: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return this.uniforms.diffuse.value;\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    this.uniforms.diffuse.value = value;\r\n\r\n                }\r\n\r\n            },\r\n\r\n            worldUnits: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return 'WORLD_UNITS' in this.defines;\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    if (value === true) {\r\n\r\n                        this.defines.WORLD_UNITS = '';\r\n\r\n                    } else {\r\n\r\n                        delete this.defines.WORLD_UNITS;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n\r\n            linewidth: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return this.uniforms.linewidth.value;\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    this.uniforms.linewidth.value = value;\r\n\r\n                }\r\n\r\n            },\r\n\r\n            dashed: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return Boolean('USE_DASH' in this.defines);\r\n\r\n                },\r\n\r\n                set(value) {\r\n\r\n                    if (Boolean(value) !== Boolean('USE_DASH' in this.defines)) {\r\n\r\n                        this.needsUpdate = true;\r\n\r\n                    }\r\n\r\n                    if (value === true) {\r\n\r\n                        this.defines.USE_DASH = '';\r\n\r\n                    } else {\r\n\r\n                        delete this.defines.USE_DASH;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n\r\n            dashScale: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return this.uniforms.dashScale.value;\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    this.uniforms.dashScale.value = value;\r\n\r\n                }\r\n\r\n            },\r\n\r\n            dashSize: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return this.uniforms.dashSize.value;\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    this.uniforms.dashSize.value = value;\r\n\r\n                }\r\n\r\n            },\r\n\r\n            dashOffset: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return this.uniforms.dashOffset.value;\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    this.uniforms.dashOffset.value = value;\r\n\r\n                }\r\n\r\n            },\r\n\r\n            gapSize: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return this.uniforms.gapSize.value;\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    this.uniforms.gapSize.value = value;\r\n\r\n                }\r\n\r\n            },\r\n\r\n            opacity: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return this.uniforms.opacity.value;\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    this.uniforms.opacity.value = value;\r\n\r\n                }\r\n\r\n            },\r\n\r\n            resolution: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return this.uniforms.resolution.value;\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    this.uniforms.resolution.value.copy(value);\r\n\r\n                }\r\n\r\n            },\r\n\r\n            alphaToCoverage: {\r\n\r\n                enumerable: true,\r\n\r\n                get: function () {\r\n\r\n                    return Boolean('USE_ALPHA_TO_COVERAGE' in this.defines);\r\n\r\n                },\r\n\r\n                set: function (value) {\r\n\r\n                    if (Boolean(value) !== Boolean('USE_ALPHA_TO_COVERAGE' in this.defines)) {\r\n\r\n                        this.needsUpdate = true;\r\n\r\n                    }\r\n\r\n                    if (value === true) {\r\n\r\n                        this.defines.USE_ALPHA_TO_COVERAGE = '';\r\n                        this.extensions.derivatives = true;\r\n\r\n                    } else {\r\n\r\n                        delete this.defines.USE_ALPHA_TO_COVERAGE;\r\n                        this.extensions.derivatives = false;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n        });\r\n\r\n        this.setValues(parameters);\r\n\r\n    }\r\n\r\n}\r\n\r\nLineMaterial.prototype.isLineMaterial = true;\r\n\r\nexport { LineMaterial };\r\n", "import { singleton } from \"@juniper-lib/tslib\";\r\nimport { LineMaterial, LineMaterialParameters } from \"./examples/lines/LineMaterial\";\r\n\r\nconst materials = singleton(\"Juniper:Three:Materials\", () => new Map<string, THREE.Material>());\r\n\r\nfunction del(obj: any, name: string) {\r\n    if (name in obj) {\r\n        delete obj[name];\r\n    }\r\n}\r\n\r\nexport type SolidMaterial = THREE.MeshBasicMaterial | THREE.MeshStandardMaterial;\r\nexport type SolidMaterialOpts = THREE.MeshBasicMaterialParameters | THREE.MeshStandardMaterialParameters;\r\n\r\nfunction makeMaterial<MaterialT extends THREE.Material, OptionsT extends THREE.MaterialParameters>(slug: string, material: (new (opts: OptionsT) => MaterialT), options: OptionsT): MaterialT {\r\n\r\n    const key = `${slug}_${Object\r\n        .keys(options)\r\n        .map((k) => `${k}:${(options as any)[k]}`)\r\n        .join(\",\")}`;\r\n\r\n    if (!materials.has(key)) {\r\n        del(options, \"name\");\r\n        materials.set(key, new material(options));\r\n    }\r\n\r\n    return materials.get(key) as MaterialT;\r\n}\r\n\r\nfunction trans<T>(options: T): T {\r\n    return Object.assign(options, {\r\n        transparent: true\r\n    });\r\n}\r\n\r\nexport function solid(options: THREE.MeshBasicMaterialParameters): THREE.MeshBasicMaterial {\r\n    return makeMaterial(\"solid\", THREE.MeshBasicMaterial, options);\r\n}\r\n\r\nexport function solidTransparent(options: THREE.MeshBasicMaterialParameters): THREE.MeshBasicMaterial {\r\n    return makeMaterial(\"solidTransparent\", THREE.MeshBasicMaterial, trans(options));\r\n}\r\n\r\nexport function lit(options: THREE.MeshStandardMaterialParameters): THREE.MeshStandardMaterial {\r\n    return makeMaterial(\"lit\", THREE.MeshStandardMaterial, options);\r\n}\r\n\r\nexport function litTransparent(options: THREE.MeshStandardMaterialParameters): THREE.MeshStandardMaterial {\r\n    return makeMaterial(\"litTransparent\", THREE.MeshStandardMaterial, trans(options));\r\n}\r\n\r\nexport function line(options: THREE.LineBasicMaterialParameters): THREE.LineBasicMaterial {\r\n    return makeMaterial(\"line\", THREE.LineBasicMaterial, options);\r\n}\r\n\r\nexport function lineTransparent(options: THREE.LineBasicMaterialParameters): THREE.LineBasicMaterial {\r\n    return makeMaterial(\"lineTransparent\", THREE.LineBasicMaterial, trans(options));\r\n}\r\n\r\nexport function line2(options: LineMaterialParameters) {\r\n    return makeMaterial(\"line2\", LineMaterial, options);\r\n}\r\n\r\nexport function sprite(options: THREE.SpriteMaterialParameters): THREE.SpriteMaterial {\r\n    return makeMaterial(\"sprite\", THREE.SpriteMaterial, options);\r\n}\r\n\r\nexport function spriteTransparent(options: THREE.SpriteMaterialParameters): THREE.SpriteMaterial {\r\n    return makeMaterial(\"spriteTransparent\", THREE.SpriteMaterial, trans(options));\r\n}\r\n\r\nexport type ColorOpts = (THREE.Color | number | string);\r\n\r\nexport const black = /*@__PURE__*/ 0x000000;\r\nexport const blue = /*@__PURE__*/ 0x0000ff;\r\nexport const green = /*@__PURE__*/ 0x00ff00;\r\nexport const cyan = /*@__PURE__*/ 0x00ffff;\r\nexport const red = /*@__PURE__*/ 0xff0000;\r\nexport const magenta = /*@__PURE__*/ 0xff00ff;\r\nexport const yellow = /*@__PURE__*/ 0xffff00;\r\nexport const grey = /*@__PURE__*/ 0xc0c0c0;\r\nexport const white = /*@__PURE__*/ 0xffffff;\r\n\r\nexport const solidBlack = /*@__PURE__*/ solid({ color: black });\r\nexport const solidBlue = /*@__PURE__*/ solid({ color: blue });\r\nexport const solidGreen = /*@__PURE__*/ solid({ color: green });\r\nexport const solidCyan = /*@__PURE__*/ solid({ color: cyan });\r\nexport const solidRed = /*@__PURE__*/ solid({ color: red });\r\nexport const solidMagenta = /*@__PURE__*/ solid({ color: magenta });\r\nexport const solidYellow = /*@__PURE__*/ solid({ color: yellow });\r\nexport const solidGrey = /*@__PURE__*/ solid({ color: grey });\r\nexport const solidWhite = /*@__PURE__*/ solid({ color: white });\r\nexport function solidTransparentBlack(opacity: number) { return solidTransparent({ color: black, opacity }); }\r\nexport function solidTransparentBlue(opacity: number) { return solidTransparent({ color: blue, opacity }); }\r\nexport function solidTransparentGreen(opacity: number) { return solidTransparent({ color: green, opacity }); }\r\nexport function solidTransparentCyan(opacity: number) { return solidTransparent({ color: cyan, opacity }); }\r\nexport function solidTransparentRed(opacity: number) { return solidTransparent({ color: red, opacity }); }\r\nexport function solidTransparentMagenta(opacity: number) { return solidTransparent({ color: magenta, opacity }); }\r\nexport function solidTransparentYellow(opacity: number) { return solidTransparent({ color: yellow, opacity }); }\r\nexport function solidTransparentGrey(opacity: number) { return solidTransparent({ color: grey, opacity }); }\r\nexport function solidTransparentWhite(opacity: number) { return solidTransparent({ color: white, opacity }); }\r\n\r\nexport const litBlack = /*@__PURE__*/ lit({ color: black });\r\nexport const litBlue = /*@__PURE__*/ lit({ color: blue });\r\nexport const litGreen = /*@__PURE__*/ lit({ color: green });\r\nexport const litCyan = /*@__PURE__*/ lit({ color: cyan });\r\nexport const litRed = /*@__PURE__*/ lit({ color: red });\r\nexport const litMagenta = /*@__PURE__*/ lit({ color: magenta });\r\nexport const litYellow = /*@__PURE__*/ lit({ color: yellow });\r\nexport const litGrey = /*@__PURE__*/ lit({ color: grey });\r\nexport const litWhite = /*@__PURE__*/ lit({ color: white });\r\nexport function litTransparentBlack(opacity: number) { return litTransparent({ color: black, opacity }); }\r\nexport function litTransparentBlue(opacity: number) { return litTransparent({ color: blue, opacity }); }\r\nexport function litTransparentGreen(opacity: number) { return litTransparent({ color: green, opacity }); }\r\nexport function litTransparentCyan(opacity: number) { return litTransparent({ color: cyan, opacity }); }\r\nexport function litTransparentRed(opacity: number) { return litTransparent({ color: red, opacity }); }\r\nexport function litTransparentMagenta(opacity: number) { return litTransparent({ color: magenta, opacity }); }\r\nexport function litTransparentYellow(opacity: number) { return litTransparent({ color: yellow, opacity }); }\r\nexport function litTransparentGrey(opacity: number) { return litTransparent({ color: grey, opacity }); }\r\nexport function litTransparentWhite(opacity: number) { return litTransparent({ color: white, opacity }); }\r\n\r\nexport const lineBlack = /*@__PURE__*/ line({ color: black });\r\nexport const lineBlue = /*@__PURE__*/ line({ color: blue });\r\nexport const lineGreen = /*@__PURE__*/ line({ color: green });\r\nexport const lineCyan = /*@__PURE__*/ line({ color: cyan });\r\nexport const lineRed = /*@__PURE__*/ line({ color: red });\r\nexport const lineMagenta = /*@__PURE__*/ line({ color: magenta });\r\nexport const lineYellow = /*@__PURE__*/ line({ color: yellow });\r\nexport const lineGrey = /*@__PURE__*/ line({ color: grey });\r\nexport const lineWhite = /*@__PURE__*/ line({ color: white });\r\nexport function lineTransparentBlack(opacity: number) { return lineTransparent({ color: black, opacity }); }\r\nexport function lineTransparentBlue(opacity: number) { return lineTransparent({ color: blue, opacity }); }\r\nexport function lineTransparentGreen(opacity: number) { return lineTransparent({ color: green, opacity }); }\r\nexport function lineTransparentCyan(opacity: number) { return lineTransparent({ color: cyan, opacity }); }\r\nexport function lineTransparentRed(opacity: number) { return lineTransparent({ color: red, opacity }); }\r\nexport function lineTransparentMagenta(opacity: number) { return lineTransparent({ color: magenta, opacity }); }\r\nexport function lineTransparentYellow(opacity: number) { return lineTransparent({ color: yellow, opacity }); }\r\nexport function lineTransparentGrey(opacity: number) { return lineTransparent({ color: grey, opacity }); }\r\nexport function lineTransparentWhite(opacity: number) { return lineTransparent({ color: white, opacity }); }\r\n\r\nexport const spriteBlack = /*@__PURE__*/ sprite({ color: black });\r\nexport const spriteBlue = /*@__PURE__*/ sprite({ color: blue });\r\nexport const spriteGreen = /*@__PURE__*/ sprite({ color: green });\r\nexport const spriteCyan = /*@__PURE__*/ sprite({ color: cyan });\r\nexport const spriteRed = /*@__PURE__*/ sprite({ color: red });\r\nexport const spriteMagenta = /*@__PURE__*/ sprite({ color: magenta });\r\nexport const spriteYellow = /*@__PURE__*/ sprite({ color: yellow });\r\nexport const spriteGrey = /*@__PURE__*/ sprite({ color: grey });\r\nexport const spriteWhite = /*@__PURE__*/ sprite({ color: white });\r\nexport function spriteTransparentBlack(opacity: number) { return spriteTransparent({ color: black, opacity }); }\r\nexport function spriteTransparentBlue(opacity: number) { return spriteTransparent({ color: blue, opacity }); }\r\nexport function spriteTransparentGreen(opacity: number) { return spriteTransparent({ color: green, opacity }); }\r\nexport function spriteTransparentCyan(opacity: number) { return spriteTransparent({ color: cyan, opacity }); }\r\nexport function spriteTransparentRed(opacity: number) { return spriteTransparent({ color: red, opacity }); }\r\nexport function spriteTransparentMagenta(opacity: number) { return spriteTransparent({ color: magenta, opacity }); }\r\nexport function spriteTransparentYellow(opacity: number) { return spriteTransparent({ color: yellow, opacity }); }\r\nexport function spriteTransparentGrey(opacity: number) { return spriteTransparent({ color: grey, opacity }); }\r\nexport function spriteTransparentWhite(opacity: number) { return spriteTransparent({ color: white, opacity }); }", "import { TypedEventBase } from \"@juniper-lib/tslib\";\r\nimport { solidBlack } from \"../materials\";\r\nimport { isObject3D } from \"../typeChecks\";\r\nimport { EventSystemEvents } from \"./EventSystemEvent\";\r\n\r\nconst RAY_TARGET_KEY = \"Juniper:ThreeJS:EventSystem:RayTarget\";\r\nconst RAY_TARGETS_KEY = \"Juniper:ThreeJS:EventSystem:RayTargets\";\r\nconst RAY_TARGET_DISABLED_KEY = \"Juniper:ThreeJS:EventSystem:RayTarget:Disabled\";\r\nconst RAY_TARGET_CLICKABLE_KEY = \"Juniper:ThreeJS:EventSystem:RayTarget:Clickable\";\r\nconst RAY_TARGET_DRAGGABLE_KEY = \"Juniper:ThreeJS:EventSystem:RayTarget:Draggable\";\r\n\r\nexport class RayTarget<EventsT = void> extends TypedEventBase<EventsT & EventSystemEvents> {\r\n    constructor(public readonly object: THREE.Object3D, public readonly mesh: THREE.Mesh) {\r\n        super();\r\n\r\n        this.mesh.userData[RAY_TARGET_KEY] = this;\r\n        let targets = this.object.userData[RAY_TARGETS_KEY] as Array<RayTarget<EventsT>>;\r\n        if (!targets) {\r\n            this.object.userData[RAY_TARGETS_KEY] = targets = new Array<RayTarget<EventsT>>();\r\n        }\r\n        targets.push(this);\r\n    }\r\n\r\n    get disabled() {\r\n        return this.object.userData[RAY_TARGET_DISABLED_KEY] as boolean;\r\n    }\r\n\r\n    set disabled(v) {\r\n        this.object.userData[RAY_TARGET_DISABLED_KEY] = v;\r\n    }\r\n\r\n    get enabled() {\r\n        return !this.disabled;\r\n    }\r\n\r\n    set enabled(v) {\r\n        this.disabled = !v;\r\n    }\r\n\r\n    get clickable() {\r\n        return this.object.userData[RAY_TARGET_CLICKABLE_KEY] as boolean;\r\n    }\r\n\r\n    set clickable(v) {\r\n        this.object.userData[RAY_TARGET_CLICKABLE_KEY] = v;\r\n    }\r\n\r\n    get draggable() {\r\n        return this.object.userData[RAY_TARGET_DRAGGABLE_KEY] as boolean;\r\n    }\r\n\r\n    set draggable(v) {\r\n        this.object.userData[RAY_TARGET_DRAGGABLE_KEY] = v;\r\n    }\r\n}\r\n\r\nexport function getMeshTarget(objectOrHit: THREE.Object3D | THREE.Intersection): RayTarget {\r\n    if (!objectOrHit) {\r\n        return null;\r\n    }\r\n\r\n    const obj = isObject3D(objectOrHit) ? objectOrHit : objectOrHit.object;\r\n\r\n    return obj && obj.userData[RAY_TARGET_KEY] as RayTarget;\r\n}\r\n\r\nexport function getObjectTargets(obj: THREE.Object3D): Array<RayTarget> {\r\n    if (!obj) {\r\n        return null;\r\n    }\r\n\r\n    return obj.userData[RAY_TARGETS_KEY] as Array<RayTarget>;\r\n}\r\n\r\nexport function makeRayTarget<T>(mesh: THREE.Mesh, obj?: THREE.Object3D): RayTarget<T> {\r\n    obj = obj || mesh;\r\n    return new RayTarget<T>(obj, mesh);\r\n}\r\n\r\nexport function addRayTarget<T>(obj: THREE.Object3D, geom: THREE.BufferGeometry): RayTarget<T> {\r\n    const mesh = new THREE.Mesh(geom, solidBlack);\r\n    mesh.visible = false;\r\n    obj.add(mesh);\r\n    return makeRayTarget<T>(mesh, obj);\r\n}", "import { bump } from \"@juniper-lib/graphics2d/animation/tween\";\r\nimport { IDisposable, singleton } from \"@juniper-lib/tslib\";\r\nimport { getObjectTargets, makeRayTarget } from \"../eventSystem/RayTarget\";\r\nimport { isMesh } from \"../typeChecks\";\r\n\r\n/**\r\n * This is a hack to make sure all Applications get the same scaleOnHover state as the Environment.\r\n **/\r\nconst scaledItems = singleton(\"Juniper:ScaledItems\", () => new Map<THREE.Object3D, ScaleState>());\r\nconst start = 1;\r\nconst end = 1.1;\r\nconst timeScale = 0.005;\r\n\r\nclass ScaleState implements IDisposable {\r\n    private readonly base: THREE.Vector3;\r\n    private readonly onEnter: () => void;\r\n    private readonly onExit: () => void;\r\n\r\n    private p: number;\r\n    private dir: number;\r\n    private running: boolean;\r\n    private wasDisabled: boolean;\r\n\r\n    constructor(private readonly obj: THREE.Object3D) {\r\n        this.base = obj.scale.clone();\r\n        this.p = 0;\r\n        this.dir = 0;\r\n        this.running = false;\r\n        this.wasDisabled = this.disabled;\r\n        this.onEnter = () => this.run(1);\r\n        this.onExit = () => this.run(-1);\r\n\r\n        this.obj.traverse(child => {\r\n            if (isMesh(child)) {\r\n                const target = makeRayTarget(child, this.obj);\r\n                target.addEventListener(\"enter\", this.onEnter);\r\n                target.addEventListener(\"exit\", this.onExit);\r\n            }\r\n        });\r\n    }\r\n\r\n    private get enabled() {\r\n        const targets = getObjectTargets(this.obj);\r\n        if (!targets || targets.length === 0) {\r\n            return false;\r\n        }\r\n\r\n        for (const target of targets) {\r\n            if (!target.enabled) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private get disabled() {\r\n        return !this.enabled;\r\n    }\r\n\r\n    private run(d: number) {\r\n        if (!this.disabled || (d === -1 || this.p > 0)) {\r\n            this.dir = d;\r\n            this.running = true;\r\n        }\r\n    }\r\n\r\n    updateScaling(dt: number) {\r\n        if (this.disabled !== this.wasDisabled) {\r\n            this.wasDisabled = this.disabled;\r\n            if (this.disabled) {\r\n                this.onExit();\r\n            }\r\n        }\r\n\r\n        if (this.running) {\r\n            this.p += this.dir * dt;\r\n\r\n            if (this.dir > 0 && this.p >= 1\r\n                || this.dir < 0 && this.p < 0) {\r\n                this.p = Math.max(0, Math.min(1, this.p));\r\n                this.running = false;\r\n            }\r\n\r\n            const q = bump(this.p, 1.1);\r\n            this.obj.scale.copy(this.base)\r\n                .multiplyScalar(q * (end - start) + start);\r\n        }\r\n    }\r\n\r\n    dispose() {\r\n        this.obj.removeEventListener(\"enter\", this.onEnter);\r\n        this.obj.removeEventListener(\"exit\", this.onExit);\r\n    }\r\n}\r\n\r\nexport function updateScalings(dt: number) {\r\n    dt *= timeScale;\r\n    for (const state of scaledItems.values()) {\r\n        state.updateScaling(dt);\r\n    }\r\n}\r\n\r\nexport function removeScaledObj(obj: THREE.Object3D) {\r\n    const state = scaledItems.get(obj);\r\n    if (state) {\r\n        scaledItems.delete(obj);\r\n        state.dispose();\r\n    }\r\n}\r\n\r\nexport function scaleOnHover(obj: THREE.Object3D) {\r\n    scaledItems.set(obj, new ScaleState(obj));\r\n}", "import { dispose, isArray } from \"@juniper-lib/tslib\";\r\nimport { removeScaledObj } from \"./animation/scaleOnHover\";\r\n\r\nexport function cleanup(obj: any) {\r\n    const cleanupQ = new Array<any>();\r\n    const cleanupSeen = new Set<any>();\r\n\r\n    cleanupQ.push(obj);\r\n    while (cleanupQ.length > 0) {\r\n        const here = cleanupQ.shift();\r\n        if (here && !cleanupSeen.has(here)) {\r\n            cleanupSeen.add(here);\r\n\r\n            if (here.isMesh) {\r\n                cleanupQ.push(\r\n                    here.material,\r\n                    here.geometry);\r\n            }\r\n\r\n            if (here.isMaterial) {\r\n                cleanupQ.push(...Object.values(here));\r\n            }\r\n\r\n            if (here.isObject3D) {\r\n                cleanupQ.push(...here.children);\r\n                here.clear();\r\n                removeScaledObj(here);\r\n            }\r\n\r\n            if (isArray(here)) {\r\n                cleanupQ.push(...here);\r\n            }\r\n\r\n            dispose(here);\r\n        }\r\n    }\r\n\r\n    cleanupSeen.clear();\r\n}\r\n", "const M = new THREE.Matrix4();\r\nconst P = new THREE.Vector3();\r\n\r\nexport function objectGetRelativePose(ref: THREE.Object3D, obj: THREE.Object3D, position: THREE.Vector4, quaternion: THREE.Quaternion, scale: THREE.Vector3): void {\r\n    M.copy(ref.matrixWorld)\r\n        .invert()\r\n        .multiply(obj.matrixWorld)\r\n        .decompose(P, quaternion, scale);\r\n    position.set(P.x, P.y, P.z, 1);\r\n}", "import { SolidMaterial } from \"./materials\";\r\n\r\nexport const plane = new THREE.PlaneBufferGeometry(1, 1, 1, 1);\r\nplane.name = \"PlaneGeom\";\r\n\r\nexport class Plane extends THREE.Mesh {\r\n    constructor(sx: number, sy: number, material: SolidMaterial) {\r\n        super(plane, material);\r\n        this.scale.set(sx, sy, 1);\r\n    }\r\n}", "import { CanvasImageTypes, createCanvasFromImageBitmap, isImageBitmap, isOffscreenCanvas } from \"@juniper-lib/dom/canvas\";\r\nimport { IFetcher } from \"@juniper-lib/fetcher\";\r\nimport { IProgress, isNumber } from \"@juniper-lib/tslib\";\r\n\r\nconst inchesPerMeter = 39.3701;\r\n\r\ntype Material = THREE.Material & {\r\n    map: THREE.Texture;\r\n};\r\n\r\nexport class TexturedMesh extends THREE.Mesh<THREE.BufferGeometry, Material> {\r\n    private _imageWidth: number = 0;\r\n    private _imageHeight: number = 0;\r\n\r\n    constructor(geom: THREE.BufferGeometry, mat: Material) {\r\n        super(geom, mat);\r\n    }\r\n\r\n    override copy(source: this, recursive = true): this {\r\n        super.copy(source, recursive);\r\n        this._imageWidth = source.imageWidth;\r\n        this._imageHeight = source.imageHeight;\r\n        return this;\r\n    }\r\n\r\n    get imageWidth() {\r\n        return this._imageWidth;\r\n    }\r\n\r\n    get imageHeight() {\r\n        return this._imageHeight;\r\n    }\r\n\r\n    get imageAspectRatio() {\r\n        return this.imageWidth / this.imageHeight;\r\n    }\r\n\r\n    get objectWidth() {\r\n        return this.scale.x;\r\n    }\r\n\r\n    set objectWidth(v) {\r\n        this.scale.x = v;\r\n        this.scale.y = v / this.imageAspectRatio;\r\n    }\r\n\r\n    get objectHeight() {\r\n        return this.scale.y;\r\n    }\r\n\r\n    set objectHeight(v) {\r\n        this.scale.x = this.imageAspectRatio * v;\r\n        this.scale.y = v;\r\n    }\r\n\r\n    get pixelDensity() {\r\n        const ppm = (this.imageWidth / this.objectWidth);\r\n        const ppi = ppm / inchesPerMeter;\r\n        return ppi;\r\n    }\r\n\r\n    set pixelDensity(ppi) {\r\n        const ppm = ppi * inchesPerMeter;\r\n        this.objectWidth = this.imageWidth / ppm;\r\n    }\r\n\r\n    setImage(img: CanvasImageTypes | HTMLVideoElement): THREE.Texture {\r\n        if (isImageBitmap(img)) {\r\n            img = createCanvasFromImageBitmap(img);\r\n        }\r\n\r\n        if (isOffscreenCanvas(img)) {\r\n            img = img as any as HTMLCanvasElement;\r\n        }\r\n\r\n        if (img instanceof HTMLVideoElement) {\r\n            this.material.map = new THREE.VideoTexture(img);\r\n            this._imageWidth = img.videoWidth;\r\n            this._imageHeight = img.videoHeight;\r\n        }\r\n        else {\r\n            this.material.map = new THREE.Texture(img);\r\n            this._imageWidth = img.width;\r\n            this._imageHeight = img.height;\r\n            this.material.map.needsUpdate = true;\r\n        }\r\n\r\n        this.material.needsUpdate = true;\r\n\r\n        return this.material.map;\r\n    }\r\n\r\n    async loadImage(fetcher: IFetcher, path: string, prog?: IProgress): Promise<void> {\r\n        let { content: img } = await fetcher\r\n            .get(path)\r\n            .progress(prog)\r\n            .image();\r\n        const texture = this.setImage(img);\r\n        texture.name = path;\r\n    }\r\n\r\n    updateTexture() {\r\n        const img = this.material.map.image;\r\n        if (isNumber(img.width)\r\n            && isNumber(img.height)\r\n            && (this.imageWidth !== img.width\r\n                || this.imageHeight !== img.height)) {\r\n\r\n            this._imageWidth = img.width;\r\n            this._imageHeight = img.height\r\n            this.material.map.dispose();\r\n            this.material.map = new THREE.Texture(img);\r\n            this.material.needsUpdate = true;\r\n        }\r\n        this.material.map.needsUpdate = true;\r\n    }\r\n}\r\n", "import { arrayCompare, IDisposable, isDefined, isNullOrUndefined } from \"@juniper-lib/tslib\";\r\nimport { cleanup } from \"./cleanup\";\r\nimport { IUpdatable } from \"./IUpdatable\";\r\nimport { IWebXRLayerManager } from \"./IWebXRLayerManager\";\r\nimport { solidTransparent } from \"./materials\";\r\nimport { objectGetRelativePose } from \"./objectGetRelativePose\";\r\nimport { objectIsFullyVisible } from \"./objects\";\r\nimport { plane } from \"./Plane\";\r\nimport { TexturedMesh } from \"./TexturedMesh\";\r\nimport { isMeshBasicMaterial } from \"./typeChecks\";\r\nimport { StereoLayoutName } from \"./VideoPlayer3D\";\r\n\r\nconst P = new THREE.Vector4();\r\nconst Q = new THREE.Quaternion();\r\nconst S = new THREE.Vector3();\r\n\r\nlet copyCounter = 0;\r\n\r\nexport class Image2DMesh\r\n    extends THREE.Object3D\r\n    implements IDisposable, IUpdatable {\r\n    private readonly lastMatrixWorld = new THREE.Matrix4();\r\n    private layer: XRQuadLayer = null;\r\n    private tryWebXRLayers = true;\r\n    private wasUsingLayer = false;\r\n    private lastImage: unknown = null;\r\n    private lastWidth: number = null;\r\n    private lastHeight: number = null;\r\n    stereoLayoutName: StereoLayoutName = \"mono\";\r\n    protected env: IWebXRLayerManager = null;\r\n    mesh: TexturedMesh = null;\r\n\r\n    webXRLayersEnabled = true;\r\n\r\n    constructor(env: IWebXRLayerManager, name: string, private readonly isStatic: boolean, materialOrOptions: THREE.MeshBasicMaterialParameters | THREE.MeshBasicMaterial = null) {\r\n        super();\r\n\r\n        if (env) {\r\n            this.setEnvAndName(env, name);\r\n\r\n            let material = isMeshBasicMaterial(materialOrOptions)\r\n                ? materialOrOptions\r\n                : solidTransparent(Object.assign(\r\n                    {},\r\n                    materialOrOptions,\r\n                    { name: this.name }));\r\n\r\n            this.mesh = new TexturedMesh(plane, material);\r\n            this.add(this.mesh);\r\n        }\r\n    }\r\n\r\n    dispose(): void {\r\n        cleanup(this.layer);\r\n    }\r\n\r\n    private setEnvAndName(env: IWebXRLayerManager, name: string) {\r\n        this.env = env;\r\n        this.name = name;\r\n        this.tryWebXRLayers &&= this.env && this.env.hasXRCompositionLayers;\r\n    }\r\n\r\n    override copy(source: this, recursive = true) {\r\n        super.copy(source, recursive);\r\n        this.setEnvAndName(source.env, source.name + (++copyCounter));\r\n        for (let i = this.children.length - 1; i >= 0; --i) {\r\n            const child = this.children[i];\r\n            if (child.parent instanceof Image2DMesh\r\n                && child instanceof TexturedMesh) {\r\n                child.removeFromParent();\r\n                this.mesh = new TexturedMesh(child.geometry, child.material as THREE.MeshBasicMaterial);\r\n            }\r\n        }\r\n        if (isNullOrUndefined(this.mesh)) {\r\n            this.mesh = source.mesh.clone();\r\n            this.add(this.mesh);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    private get needsLayer(): boolean {\r\n        if (!objectIsFullyVisible(this)\r\n            || isNullOrUndefined(this.mesh.material.map)\r\n            || isNullOrUndefined(this.mesh.material.map.image)) {\r\n            return false;\r\n        }\r\n\r\n        const img = this.mesh.material.map.image;\r\n        if (!(img instanceof HTMLVideoElement)) {\r\n            return true;\r\n        }\r\n\r\n        return !img.paused || img.currentTime > 0;\r\n    }\r\n\r\n    removeWebXRLayer() {\r\n        if (isDefined(this.layer)) {\r\n            this.wasUsingLayer = false;\r\n            this.env.removeWebXRLayer(this.layer);\r\n            const layer = this.layer;\r\n            this.layer = null;\r\n\r\n            setTimeout(() => {\r\n                layer.destroy();\r\n                this.mesh.visible = true;\r\n            }, 100);\r\n        }\r\n    }\r\n\r\n    update(_dt: number, frame?: XRFrame): void {\r\n        if (this.mesh.material.map && this.mesh.material.map.image) {\r\n            const isVideo = this.mesh.material.map instanceof THREE.VideoTexture;\r\n            const isLayersAvailable = this.tryWebXRLayers\r\n                && this.webXRLayersEnabled\r\n                && isDefined(frame)\r\n                && (isVideo && isDefined(this.env.xrMediaBinding)\r\n                    || !isVideo && isDefined(this.env.xrBinding));\r\n            const useLayer = isLayersAvailable && this.needsLayer;\r\n\r\n            const useLayerChanged = useLayer !== this.wasUsingLayer;\r\n            const imageChanged = this.mesh.material.map.image !== this.lastImage\r\n                || this.mesh.material.needsUpdate\r\n                || this.mesh.material.map.needsUpdate;\r\n            const sizeChanged = this.mesh.imageWidth !== this.lastWidth\r\n                || this.mesh.imageHeight !== this.lastHeight;\r\n\r\n            this.wasUsingLayer = useLayer;\r\n            this.lastImage = this.mesh.material.map.image;\r\n            this.lastWidth = this.mesh.imageWidth;\r\n            this.lastHeight = this.mesh.imageHeight;\r\n\r\n            if (useLayerChanged || sizeChanged) {\r\n                if ((!useLayer || sizeChanged) && this.layer) {\r\n                    this.removeWebXRLayer();\r\n                }\r\n\r\n                if (useLayer) {\r\n                    const space = this.env.referenceSpace;\r\n\r\n                    objectGetRelativePose(this.env.stage, this.mesh, P, Q, S);\r\n                    this.lastMatrixWorld.copy(this.matrixWorld);\r\n                    const transform = new XRRigidTransform(P, Q);\r\n                    const width = S.x / 2;\r\n                    const height = S.y / 2;\r\n                    const layout = this.stereoLayoutName === \"mono\"\r\n                        ? \"mono\"\r\n                        : this.stereoLayoutName === \"left-right\" || this.stereoLayoutName === \"right-left\"\r\n                            ? \"stereo-left-right\"\r\n                            : \"stereo-top-bottom\";\r\n\r\n                    if (isVideo) {\r\n                        const invertStereo = this.stereoLayoutName === \"right-left\"\r\n                            || this.stereoLayoutName === \"bottom-top\";\r\n\r\n                        this.layer = this.env.xrMediaBinding.createQuadLayer(this.mesh.material.map.image, {\r\n                            space,\r\n                            layout,\r\n                            invertStereo,\r\n                            transform,\r\n                            width,\r\n                            height\r\n                        });\r\n                    }\r\n                    else {\r\n                        this.layer = this.env.xrBinding.createQuadLayer({\r\n                            space,\r\n                            layout,\r\n                            textureType: \"texture\",\r\n                            isStatic: this.isStatic,\r\n                            viewPixelWidth: this.mesh.imageWidth,\r\n                            viewPixelHeight: this.mesh.imageHeight,\r\n                            transform,\r\n                            width,\r\n                            height\r\n                        });\r\n                    }\r\n\r\n                    this.env.addWebXRLayer(this.layer, 500);\r\n                    this.mesh.visible = false;\r\n                }\r\n            }\r\n\r\n            if (this.layer) {\r\n                if (imageChanged || this.layer.needsRedraw) {\r\n                    const gl = this.env.gl;\r\n                    const gLayer = this.env.xrBinding.getSubImage(this.layer, frame);\r\n\r\n                    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\r\n                    gl.bindTexture(gl.TEXTURE_2D, gLayer.colorTexture);\r\n                    gl.texSubImage2D(\r\n                        gl.TEXTURE_2D,\r\n                        0,\r\n                        0, 0,\r\n                        gl.RGBA,\r\n                        gl.UNSIGNED_BYTE,\r\n                        this.mesh.material.map.image);\r\n                    gl.generateMipmap(gl.TEXTURE_2D);\r\n\r\n                    gl.bindTexture(gl.TEXTURE_2D, null);\r\n                }\r\n\r\n                if (arrayCompare(this.matrixWorld.elements, this.lastMatrixWorld.elements) >= 0) {\r\n                    objectGetRelativePose(this.env.stage, this.mesh, P, Q, S);\r\n                    this.lastMatrixWorld.copy(this.matrixWorld);\r\n                    this.layer.transform = new XRRigidTransform(P, Q);\r\n                    this.layer.width = S.x / 2;\r\n                    this.layer.height = S.y / 2;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n", "import type { TextImageOptions } from \"@juniper-lib/graphics2d/TextImage\";\r\nimport { TextImage } from \"@juniper-lib/graphics2d/TextImage\";\r\nimport { Image2DMesh } from \"./Image2DMesh\";\r\nimport { IWebXRLayerManager } from \"./IWebXRLayerManager\";\r\n\r\nconst redrawnEvt = { type: \"redrawn\" };\r\n\r\nexport class TextMesh extends Image2DMesh {\r\n    private _textImage: TextImage = null;\r\n\r\n    private _onRedrawn: () => void;\r\n\r\n    constructor(env: IWebXRLayerManager, name: string, materialOptions?: THREE.MeshBasicMaterialParameters) {\r\n        super(env, name, false, materialOptions);\r\n\r\n        this._onRedrawn = this.onRedrawn.bind(this);\r\n    }\r\n\r\n    private onRedrawn() {\r\n        this.mesh.updateTexture();\r\n        this.scale.set(this._textImage.width, this._textImage.height, 0.01);\r\n        this.dispatchEvent(redrawnEvt);\r\n    }\r\n\r\n\r\n    get textImage() {\r\n        return this._textImage;\r\n    }\r\n\r\n    set textImage(v) {\r\n        if (v !== this.textImage) {\r\n            if (this.textImage) {\r\n                this.textImage.clearEventListeners();\r\n            }\r\n\r\n            this._textImage = v;\r\n\r\n            if (this.textImage) {\r\n                this.textImage.addEventListener(\"redrawn\", this._onRedrawn);\r\n                this.mesh.setImage(this.textImage.canvas);\r\n                this._onRedrawn();\r\n            }\r\n        }\r\n    }\r\n\r\n    createTextImage(textImageOptions?: Partial<TextImageOptions>) {\r\n        this.textImage = new TextImage(textImageOptions);\r\n    }\r\n\r\n    get wrapWords() {\r\n        return this._textImage.wrapWords;\r\n    }\r\n\r\n    set wrapWords(v) {\r\n        this._textImage.wrapWords = v;\r\n    }\r\n\r\n    get minWidth() {\r\n        return this._textImage.minWidth;\r\n    }\r\n\r\n    set minWidth(v) {\r\n        this._textImage.minWidth = v;\r\n    }\r\n\r\n    get maxWidth() {\r\n        return this._textImage.maxWidth;\r\n    }\r\n\r\n    set maxWidth(v) {\r\n        this._textImage.maxWidth = v;\r\n    }\r\n\r\n    get minHeight() {\r\n        return this._textImage.minHeight;\r\n    }\r\n\r\n    set minHeight(v) {\r\n        this._textImage.minHeight = v;\r\n    }\r\n\r\n    get maxHeight() {\r\n        return this._textImage.maxHeight;\r\n    }\r\n\r\n    set maxHeight(v) {\r\n        this._textImage.maxHeight = v;\r\n    }\r\n\r\n    get textDirection() {\r\n        return this._textImage.textDirection;\r\n    }\r\n\r\n    set textDirection(v) {\r\n        this._textImage.textDirection = v;\r\n    }\r\n\r\n    get textScale() {\r\n        return this._textImage.scale;\r\n    }\r\n\r\n    set textScale(v) {\r\n        this._textImage.scale = v;\r\n    }\r\n\r\n    get textWidth() {\r\n        return this._textImage.width;\r\n    }\r\n\r\n    get textHeight() {\r\n        return this._textImage.height;\r\n    }\r\n\r\n    get textPadding() {\r\n        return this._textImage.padding;\r\n    }\r\n\r\n    set textPadding(v) {\r\n        this._textImage.padding = v;\r\n    }\r\n\r\n    get fontStyle() {\r\n        return this._textImage.fontStyle;\r\n    }\r\n\r\n    set fontStyle(v) {\r\n        this._textImage.fontStyle = v;\r\n    }\r\n\r\n    get fontVariant() {\r\n        return this._textImage.fontVariant;\r\n    }\r\n\r\n    set fontVariant(v) {\r\n        this._textImage.fontVariant = v;\r\n    }\r\n\r\n    get fontWeight() {\r\n        return this._textImage.fontWeight;\r\n    }\r\n\r\n    set fontWeight(v) {\r\n        this._textImage.fontWeight = v;\r\n    }\r\n\r\n    get fontSize() {\r\n        return this._textImage.fontSize;\r\n    }\r\n\r\n    set fontSize(v) {\r\n        this._textImage.fontSize = v;\r\n    }\r\n\r\n    get fontFamily() {\r\n        return this._textImage.fontFamily;\r\n    }\r\n\r\n    set fontFamily(v) {\r\n        this._textImage.fontFamily = v;\r\n    }\r\n\r\n    get textFillColor() {\r\n        return this._textImage.textFillColor;\r\n    }\r\n\r\n    set textFillColor(v) {\r\n        this._textImage.textFillColor = v;\r\n    }\r\n\r\n    get textStrokeColor() {\r\n        return this._textImage.textStrokeColor;\r\n    }\r\n\r\n    set textStrokeColor(v) {\r\n        this._textImage.textStrokeColor = v;\r\n    }\r\n\r\n    get textStrokeSize() {\r\n        return this._textImage.textStrokeSize;\r\n    }\r\n\r\n    set textStrokeSize(v) {\r\n        this._textImage.textStrokeSize = v;\r\n    }\r\n\r\n    get textBgColor() {\r\n        return this._textImage.bgFillColor;\r\n    }\r\n\r\n    set textBgColor(v) {\r\n        this._textImage.bgFillColor = v;\r\n    }\r\n\r\n    get value() {\r\n        return this._textImage.value;\r\n    }\r\n\r\n    set value(v) {\r\n        this._textImage.value = v;\r\n    }\r\n}", "import type { TextImageOptions } from \"@juniper-lib/graphics2d/TextImage\";\r\nimport { TextImage } from \"@juniper-lib/graphics2d/TextImage\";\r\nimport { IFetcher } from \"@juniper-lib/fetcher\";\r\nimport { isDefined, stringRandom } from \"@juniper-lib/tslib\";\r\nimport { IWebXRLayerManager } from \"./IWebXRLayerManager\";\r\nimport { TextMesh } from \"./TextMesh\";\r\n\r\nexport class TextMeshLabel extends THREE.Object3D {\r\n    private _disabled = false;\r\n\r\n    readonly image: TextImage;\r\n    readonly enabledImage: TextMesh;\r\n    readonly disabledImage: TextMesh;\r\n\r\n    constructor(protected readonly fetcher: IFetcher,\r\n        protected readonly env: IWebXRLayerManager,\r\n        name: string,\r\n        value: string,\r\n        textImageOptions?: Partial<TextImageOptions>) {\r\n        super();\r\n\r\n        if (isDefined(value)) {\r\n            this.name = name;\r\n\r\n            textImageOptions = Object.assign({\r\n                textFillColor: \"#ffffff\",\r\n                fontFamily: \"Segoe UI Emoji\",\r\n                fontSize: 20,\r\n                minHeight: 0.25,\r\n                maxHeight: 0.25\r\n            }, textImageOptions, {\r\n                value\r\n            });\r\n\r\n            this.image = new TextImage(textImageOptions);\r\n            const id = stringRandom(16);\r\n\r\n            this.enabledImage = this.createImage(`${id}-enabled`, 1);\r\n            this.disabledImage = this.createImage(`${id}-disabled`, 0.5);\r\n            this.disabledImage.visible = false;\r\n\r\n            this.add(this.enabledImage, this.disabledImage);\r\n        }\r\n    }\r\n\r\n    private createImage(id: string, opacity: number) {\r\n        const image = new TextMesh(\r\n            this.env,\r\n            `text-${id}`, {\r\n                side: THREE.FrontSide,\r\n            opacity\r\n        });\r\n\r\n        image.textImage = this.image;\r\n\r\n        return image;\r\n    }\r\n\r\n    get disabled(): boolean {\r\n        return this._disabled;\r\n    }\r\n\r\n    set disabled(v: boolean) {\r\n        if (v !== this.disabled) {\r\n            this._disabled = v;\r\n            this.enabledImage.visible = !v;\r\n            this.disabledImage.visible = v;\r\n        }\r\n    }\r\n}\r\n", "import type { TextImageOptions } from \"@juniper-lib/graphics2d/TextImage\";\r\nimport { IFetcher } from \"@juniper-lib/fetcher\";\r\nimport { isDefined } from \"@juniper-lib/tslib\";\r\nimport { scaleOnHover } from \"./animation/scaleOnHover\";\r\nimport { IWebXRLayerManager } from \"./IWebXRLayerManager\";\r\nimport { TextMeshLabel } from \"./TextMeshLabel\";\r\nimport { makeRayTarget, RayTarget } from \"./eventSystem/RayTarget\";\r\n\r\nexport class TextMeshButton extends TextMeshLabel {\r\n\r\n    readonly target: RayTarget;\r\n\r\n    constructor(fetcher: IFetcher, env: IWebXRLayerManager, name: string, value: string, textImageOptions?: Partial<TextImageOptions>) {\r\n        super(fetcher, env, name, value, textImageOptions);\r\n        this.target = makeRayTarget(this.enabledImage.mesh, this);\r\n        this.target.clickable = true;\r\n\r\n        if (isDefined(value)) {\r\n            scaleOnHover(this);\r\n        }\r\n    }\r\n}\r\n", "import {\r\n    fontSize,\r\n    maxWidth,\r\n    padding,\r\n    styles,\r\n    textAlign,\r\n    width\r\n} from \"@juniper-lib/dom/css\";\r\nimport {\r\n    elementApply,\r\n    elementIsDisplayed,\r\n    elementSetDisplay,\r\n    elementSetText\r\n} from \"@juniper-lib/dom/tags\";\r\nimport { Animator } from \"@juniper-lib/graphics2d/animation/Animator\";\r\nimport { jump } from \"@juniper-lib/graphics2d/animation/tween\";\r\nimport type { TextImageOptions } from \"@juniper-lib/graphics2d/TextImage\";\r\nimport { DialogBox } from \"@juniper-lib/widgets/DialogBox\";\r\nimport type { Environment } from \"./environment/Environment\";\r\nimport { objectSetVisible, objGraph } from \"./objects\";\r\nimport { TextMeshButton } from \"./TextMeshButton\";\r\nimport { TextMeshLabel } from \"./TextMeshLabel\";\r\nimport type { Widget } from \"./widgets/widgets\";\r\n\r\nconst baseTextStyle: Partial<TextImageOptions> = {\r\n    bgStrokeColor: \"#000000\",\r\n    bgStrokeSize: 0.04,\r\n    wrapWords: false,\r\n    textFillColor: \"#ffffff\",\r\n    scale: 150\r\n};\r\n\r\nconst textButtonStyle: Partial<TextImageOptions> = Object.assign({}, baseTextStyle, {\r\n    padding: {\r\n        left: 0.1,\r\n        right: 0.1,\r\n        top: 0.025,\r\n        bottom: 0.025\r\n    },\r\n    fontSize: 20,\r\n    minHeight: 0.5,\r\n    maxHeight: 0.5\r\n});\r\n\r\nconst confirmButton3DStyle: Partial<TextImageOptions> = Object.assign({}, textButtonStyle, {\r\n    bgFillColor: \"#0078d7\"\r\n});\r\n\r\nconst cancelButton3DStyle: Partial<TextImageOptions> = Object.assign({}, textButtonStyle, {\r\n    bgFillColor: \"#780000\"\r\n});\r\n\r\nconst textLabelStyle: Partial<TextImageOptions> = Object.assign({}, baseTextStyle, {\r\n    bgFillColor: \"#ffffff\",\r\n    textFillColor: \"#000000\",\r\n    padding: {\r\n        top: 0.1,\r\n        left: 0.1,\r\n        bottom: 0.4,\r\n        right: 0.1\r\n    },\r\n    fontSize: 25,\r\n    minHeight: 1,\r\n    maxHeight: 1\r\n});\r\n\r\nconst JUMP_FACTOR = 0.9;\r\nfunction newStyle(baseStyle: Partial<TextImageOptions>, fontFamily: string): Partial<TextImageOptions> {\r\n    return Object.assign({}, baseStyle, { fontFamily });\r\n}\r\nexport class ConfirmationDialog extends DialogBox implements Widget {\r\n    readonly object = new THREE.Object3D();\r\n    readonly name = \"ConfirmationDialog\";\r\n\r\n    private readonly root = new THREE.Object3D();\r\n    readonly mesh: TextMeshLabel;\r\n    private readonly confirmButton3D: TextMeshButton;\r\n    private readonly cancelButton3D: TextMeshButton;\r\n\r\n    private readonly animator = new Animator();\r\n\r\n    constructor(private readonly env: Environment, fontFamily: string) {\r\n        super(\"Confirm action\");\r\n\r\n        this.confirmButton.innerText = \"Yes\";\r\n        this.cancelButton.innerText = \"No\";\r\n\r\n        this.mesh = new TextMeshLabel(this.env.fetcher, this.env, \"confirmationDialogLabel\", \"\", newStyle(textLabelStyle, fontFamily));\r\n\r\n        this.confirmButton3D = new TextMeshButton(this.env.fetcher, this.env, \"confirmationDialogConfirmButton\", \"Yes\", newStyle(confirmButton3DStyle, fontFamily));\r\n        this.confirmButton3D.target.addEventListener(\"click\", () =>\r\n            this.confirmButton.click());\r\n        this.confirmButton3D.position.set(1, -0.5, 0.5);\r\n\r\n        this.cancelButton3D = new TextMeshButton(this.env.fetcher, this.env, \"confirmationDialogCancelButton\", \"No\", newStyle(cancelButton3DStyle, fontFamily));\r\n        this.cancelButton3D.target.addEventListener(\"click\", () =>\r\n            this.cancelButton.click());\r\n\r\n        this.cancelButton3D.position.set(2, -0.5, 0.5);\r\n\r\n        elementApply(this.container, styles(\r\n            maxWidth(\"calc(100% - 2em)\"),\r\n            width(\"max-content\")\r\n        ));\r\n\r\n        elementApply(this.contentArea, styles(\r\n            fontSize(\"18pt\"),\r\n            textAlign(\"center\"),\r\n            padding(\"1em\")\r\n        ));\r\n\r\n        objGraph(this,\r\n            objGraph(this.root,\r\n                this.mesh,\r\n                this.confirmButton3D,\r\n                this.cancelButton3D));\r\n\r\n        objectSetVisible(this.root, false);\r\n    }\r\n\r\n    get visible() {\r\n        return elementIsDisplayed(this);\r\n    }\r\n\r\n    set visible(visible) {\r\n        elementSetDisplay(this, visible, \"inline-block\");\r\n        this.mesh.visible = visible;\r\n    }\r\n\r\n    update(dt: number) {\r\n        this.animator.update(dt);\r\n    }\r\n\r\n    private async showHide(a: number, b: number): Promise<void> {\r\n        await this.animator.start(0, 0.25, (t) => {\r\n            const scale = jump(a + b * t, JUMP_FACTOR);\r\n            this.root.scale.set(scale, scale, 0.01);\r\n        });\r\n        this.animator.clear();\r\n    }\r\n\r\n    private get use3D() {\r\n        return this.env.renderer.xr.isPresenting || this.env.testSpaceLayout;\r\n    }\r\n\r\n    protected override async onShowing(): Promise<void> {\r\n        await super.onShowing();\r\n\r\n        if (this.use3D) {\r\n            this.root.visible = true;\r\n            await this.showHide(0, 1);\r\n        }\r\n    }\r\n\r\n    override onShown(): void {\r\n        if (this.use3D) {\r\n            this.element.style.display = \"none\";\r\n        }\r\n    }\r\n\r\n    protected override async onClosing(): Promise<void> {\r\n        if (this.use3D) {\r\n            await this.showHide(1, -1);\r\n            this.root.visible = false;\r\n        }\r\n\r\n        await super.onClosing();\r\n    }\r\n\r\n    prompt(title: string, message: string): Promise<boolean> {\r\n        this.title = title;\r\n        elementSetText(this.contentArea, message);\r\n        this.mesh.image.value = message;\r\n\r\n        return this.showDialog();\r\n    }\r\n}", "import type { AudioManager } from \"@juniper-lib/audio/AudioManager\";\r\nimport type { IProgress } from \"@juniper-lib/tslib\";\r\nimport type { EventSystem } from \"./EventSystem\";\r\nimport type { EventSystemEvent } from \"./EventSystemEvent\";\r\n\r\nfunction makeClipName(type: string, isDisabled: boolean) {\r\n    if (type === \"click\" && isDisabled) {\r\n        type = \"error\";\r\n    }\r\n\r\n    return `InteractionAudio-${type}`;\r\n}\r\n\r\nexport class InteractionAudio {\r\n    audio: AudioManager;\r\n    eventSys: EventSystem;\r\n    enabled: boolean;\r\n\r\n    constructor(audio: AudioManager, eventSys: EventSystem) {\r\n        this.audio = audio;\r\n        this.eventSys = eventSys;\r\n        this.enabled = true;\r\n\r\n        const playClip = (evt: EventSystemEvent<\"enter\" | \"exit\" | \"click\">) => {\r\n            if (this.enabled\r\n                && evt.rayTarget\r\n                && evt.rayTarget.clickable) {\r\n                const clipName = makeClipName(evt.type, !evt.rayTarget.enabled);\r\n                if (this.audio.hasClip(clipName)) {\r\n                    const { x, y, z } = evt.point;\r\n                    this.audio.setClipPosition(clipName, x, y, z);\r\n                    this.audio.playClip(clipName);\r\n                }\r\n            }\r\n        };\r\n\r\n        this.eventSys.addEventListener(\"enter\", playClip);\r\n        this.eventSys.addEventListener(\"exit\", playClip);\r\n        this.eventSys.addEventListener(\"click\", playClip);\r\n    }\r\n\r\n    async load(type: string, path: string, volume: number, prog?: IProgress) {\r\n        return await this.audio.loadClip(makeClipName(type, false), path, false, false, true, false, volume, [], prog);\r\n    }\r\n}", "export enum ScreenMode {\r\n    None = \"None\",\r\n    Fullscreen = \"Fullscreen\",\r\n    VR = \"VR\",\r\n    AR = \"AR\"\r\n}\r\n", "import { className, id } from \"@juniper-lib/dom/attrs\";\r\nimport {\r\n    backgroundColor,\r\n    borderRadius,\r\n    display,\r\n    flexFlow,\r\n    fontSize, gridColumn, gridRow,\r\n    gridTemplateColumns,\r\n    gridTemplateRows,\r\n    height,\r\n    left,\r\n    margin,\r\n    padding,\r\n    pointerEvents,\r\n    position,\r\n    rule,\r\n    top,\r\n    width\r\n} from \"@juniper-lib/dom/css\";\r\nimport { Div, ErsatzElement, Style } from \"@juniper-lib/dom/tags\";\r\n\r\nStyle(\r\n    rule(\"#controls\",\r\n        position(\"absolute\"),\r\n        left(0),\r\n        top(0),\r\n        width(\"100%\"),\r\n        height(\"100%\")\r\n    ),\r\n\r\n    rule(\"#controls\",\r\n        display(\"grid\"),\r\n        fontSize(\"20pt\"),\r\n        gridTemplateRows(\"auto 1fr auto\")\r\n    ),\r\n\r\n    rule(\"#controls, #controls *\",\r\n        pointerEvents(\"none\")\r\n    ),\r\n\r\n    rule(\"#controls canvas\",\r\n        height(\"58px\")\r\n    ),\r\n\r\n    rule(\"#controls > .row\",\r\n        display(\"grid\"),\r\n        margin(\"10px 5px\"),\r\n        gridTemplateColumns(\"repeat(2, auto)\")\r\n    ),\r\n\r\n    rule(\"#controls > .row.top\",\r\n        gridRow(1)\r\n    ),\r\n\r\n    rule(\"#controls > .row.middle\",\r\n        gridRow(2, -2)\r\n    ),\r\n\r\n    rule(\"#controls > .row.bottom\",\r\n        gridRow(-2)\r\n    ),\r\n\r\n    rule(\"#controls > .row > .cell\",\r\n        display(\"flex\")\r\n    ),\r\n\r\n    rule(\"#controls > .row > .cell.left\",\r\n        gridColumn(1)\r\n    ),\r\n\r\n    rule(\"#controls > .row > .cell.right\",\r\n        gridColumn(-2),\r\n        flexFlow(\"row-reverse\")\r\n    ),\r\n\r\n    rule(\"#controls > .row > .cell > .btn\",\r\n        borderRadius(0),\r\n        backgroundColor(\"#1e4388\"),\r\n        height(\"58px !important\"),\r\n        width(\"58px\"),\r\n        padding(\"0.25em\"),\r\n        margin(\"0 5px\"),\r\n        pointerEvents(\"initial\")\r\n    ),\r\n\r\n    rule(\"#controls .btn-primary img\",\r\n        height(\"calc(100% - 0.5em)\")\r\n    )\r\n);\r\n\r\nexport class ScreenUI implements ErsatzElement {\r\n\r\n    readonly element: HTMLElement;\r\n\r\n    readonly topRowLeft: HTMLElement;\r\n    readonly topRowRight: HTMLElement;\r\n\r\n    readonly middleRowLeft: HTMLElement;\r\n    readonly middleRowRight: HTMLElement;\r\n\r\n    readonly bottomRowLeft: HTMLElement;\r\n    readonly bottomRowRight: HTMLElement;\r\n\r\n    readonly cells: Array<Array<HTMLElement>>;\r\n\r\n    constructor() {\r\n        this.element = Div(\r\n            id(\"controls\"),\r\n            Div(className(\"row top\"),\r\n                this.topRowLeft = Div(className(\"cell left\")),\r\n                this.topRowRight = Div(className(\"cell right\"))),\r\n            Div(className(\"row middle\"),\r\n                this.middleRowLeft = Div(className(\"cell left\")),\r\n                this.middleRowRight = Div(className(\"cell right\"))),\r\n            Div(className(\"row bottom\"),\r\n                this.bottomRowLeft = Div(className(\"cell left\")),\r\n                this.bottomRowRight = Div(className(\"cell right\")))\r\n        );\r\n\r\n        this.cells = [\r\n            [this.topRowLeft, this.topRowRight],\r\n            [this.middleRowLeft, this.middleRowRight],\r\n            [this.bottomRowLeft, this.bottomRowRight]\r\n        ];\r\n    }\r\n}\r\n", "import { deg2rad } from \"@juniper-lib/tslib\";\r\nimport { objectResolve, Objects, objGraph } from \"./objects\";\r\n\r\ninterface Point2D {\r\n    x: number;\r\n    y: number;\r\n    scale: number;\r\n}\r\n\r\nconst radius = 1.25;\r\nconst dAngleH = deg2rad(30);\r\nconst dAngleV = deg2rad(32);\r\nconst headPos = new THREE.Vector3(0, 0, 0);\r\n\r\nexport class SpaceUI extends THREE.Object3D {\r\n    constructor() {\r\n        super();\r\n        this.name = \"SpaceUI\";\r\n        this.position.y = -0.25;\r\n    }\r\n\r\n    addItem(child: Objects, position: Point2D): void {\r\n        child = objectResolve(child);\r\n        objGraph(this, child);\r\n        this.add(child);\r\n        child.position.set(\r\n            radius * Math.sin(position.x * dAngleH),\r\n            radius * Math.sin(position.y * dAngleV),\r\n            -radius * Math.cos(position.x * dAngleH));\r\n        child.scale.set(\r\n            position.scale,\r\n            position.scale,\r\n            1);\r\n        for (const child of this.children) {\r\n            child.lookAt(headPos);\r\n        }\r\n    }\r\n}", "import { isDefined, isNullOrUndefined, isString } from \"@juniper-lib/tslib\";\r\n\r\nexport const typePattern = /([^\\/]+)\\/(.+)/;\r\nconst subTypePattern = /(?:([^\\.]+)\\.)?([^\\+;]+)(?:\\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;\r\n\r\nexport class MediaType {\r\n    private readonly _tree: string;\r\n    private readonly _subType: string;\r\n    private readonly _suffix: string;\r\n    private readonly _parameters: ReadonlyMap<string, string>;\r\n\r\n    private readonly _value: string;\r\n    private readonly _fullValue: string;\r\n\r\n    private readonly _extensions: ReadonlyArray<string>;\r\n    private readonly _primaryExtension: string = null;\r\n\r\n    private depMessage: string = null;\r\n\r\n\r\n    constructor(\r\n        private readonly _type: string,\r\n        private readonly _fullSubType: string,\r\n        extensions?: ReadonlyArray<string>) {\r\n\r\n        const parameters = new Map<string, string>();\r\n        this._parameters = parameters;\r\n\r\n        const subTypeParts = this._fullSubType.match(subTypePattern);\r\n        this._tree = subTypeParts[1];\r\n        this._subType = subTypeParts[2];\r\n        this._suffix = subTypeParts[3];\r\n        const paramStr = subTypeParts[4];\r\n\r\n        this._value = this._fullValue = this._type + \"/\";\r\n\r\n        if (isDefined(this._tree)) {\r\n            this._value = this._fullValue += this._tree + \".\";\r\n        }\r\n\r\n        this._value = this._fullValue += this._subType;\r\n\r\n        if (isDefined(this._suffix)) {\r\n            this._value = this._fullValue += \"+\" + this._suffix;\r\n        }\r\n\r\n        if (isDefined(paramStr)) {\r\n            const pairs = paramStr.split(';')\r\n                .map((p) => p.trim())\r\n                .filter((p) => p.length > 0)\r\n                .map((p) => p.split('='));\r\n            for (const [key, ...values] of pairs) {\r\n                const value = values.join(\"=\");\r\n                parameters.set(key, value);\r\n                const slug = `; ${key}=${value}`;\r\n                this._fullValue += slug;\r\n                if (key !== \"q\") {\r\n                    this._value += slug;\r\n                }\r\n            }\r\n        }\r\n\r\n        this._extensions = extensions || [];\r\n        this._primaryExtension = this._extensions[0] || null;\r\n    }\r\n\r\n    static parse(value: string): MediaType {\r\n        if (!value) {\r\n            return null;\r\n        }\r\n\r\n        const match = value.match(typePattern);\r\n        if (!match) {\r\n            return null;\r\n        }\r\n\r\n        const type = match[1];\r\n        const subType = match[2];\r\n        return new MediaType(type, subType);\r\n    }\r\n\r\n    deprecate(message: string): this {\r\n        this.depMessage = message;\r\n        return this;\r\n    }\r\n\r\n    private check() {\r\n        if (isDefined(this.depMessage)) {\r\n            console.warn(`${this._value} is deprecated ${this.depMessage}`);\r\n        }\r\n    }\r\n\r\n    matches(value: MediaType | string): boolean {\r\n        if (isNullOrUndefined(value)) {\r\n            return false;\r\n        }\r\n\r\n        if (this.typeName === \"*\" && this.subTypeName === \"*\") {\r\n            return true;\r\n        }\r\n\r\n        let typeName: string = null;\r\n        let subTypeName: string = null;\r\n        if (isString(value)) {\r\n            const match = value.match(typePattern);\r\n            if (!match) {\r\n                return false;\r\n            }\r\n\r\n            typeName = match[1];\r\n            subTypeName = match[2];\r\n        }\r\n        else {\r\n            typeName = value.typeName;\r\n            subTypeName = value._fullSubType;\r\n        }\r\n\r\n        return this.typeName === typeName\r\n            && (this._fullSubType === \"*\" || this._fullSubType === subTypeName);\r\n    }\r\n\r\n    withParameter(key: string, value: string): MediaType {\r\n        const newSubType = `${this._fullSubType}; ${key}=${value}`;\r\n        return new MediaType(this.typeName, newSubType, this.extensions);\r\n    }\r\n\r\n    get typeName(): string {\r\n        this.check();\r\n        return this._type;\r\n    }\r\n\r\n    get tree(): string {\r\n        this.check();\r\n        return this._tree;\r\n    }\r\n\r\n    get suffix(): string {\r\n        return this._suffix;\r\n    }\r\n\r\n    get subTypeName(): string {\r\n        this.check();\r\n        return this._subType;\r\n    }\r\n\r\n    get value(): string {\r\n        this.check();\r\n        return this._value;\r\n    }\r\n\r\n    __getValueUnsafe() {\r\n        return this._value;\r\n    }\r\n\r\n    get fullValue(): string {\r\n        this.check();\r\n        return this._fullValue;\r\n    }\r\n\r\n    get parameters(): ReadonlyMap<string, string> {\r\n        this.check();\r\n        return this._parameters;\r\n    }\r\n\r\n    get extensions(): ReadonlyArray<string> {\r\n        this.check();\r\n        return this._extensions;\r\n    }\r\n\r\n    __getExtensionsUnsafe() {\r\n        return this._extensions;\r\n    }\r\n\r\n    get primaryExtension(): string {\r\n        this.check();\r\n        return this._primaryExtension;\r\n    }\r\n\r\n    toString() {\r\n        if (this.parameters.get(\"q\") === \"1\") {\r\n            return this.value;\r\n        }\r\n        else {\r\n            return this.fullValue;\r\n        }\r\n    }\r\n\r\n    addExtension(fileName: string): string {\r\n        if (!fileName) {\r\n            throw new Error(\"File name is not defined\");\r\n        }\r\n\r\n        if (this.primaryExtension) {\r\n            const idx = fileName.lastIndexOf(\".\");\r\n            if (idx > -1) {\r\n                const currentExtension = fileName.substring(idx + 1);;\r\n                if (this.extensions.indexOf(currentExtension) > -1) {\r\n                    fileName = fileName.substring(0, idx);\r\n                }\r\n            }\r\n\r\n            fileName = `${fileName}.${this.primaryExtension}`;\r\n        }\r\n\r\n        return fileName;\r\n    }\r\n}\r\n\r\nexport function create(group: string, value: string, ...extensions: string[]): MediaType {\r\n    return new MediaType(group, value, extensions);\r\n}\r\n\r\nexport function specialize(group: string) {\r\n    return create.bind(null, group);\r\n}", "import { specialize } from \"./util\";\r\n\r\nconst image = /*@__PURE__*/ specialize(\"image\");\r\n\r\nexport const Image_Aces = /*@__PURE__*/ image(\"aces\");\r\nexport const Image_Apng = /*@__PURE__*/ image(\"apng\", \"apng\");\r\nexport const Image_Avci = /*@__PURE__*/ image(\"avci\");\r\nexport const Image_Avcs = /*@__PURE__*/ image(\"avcs\");\r\nexport const Image_Avif = /*@__PURE__*/ image(\"avif\", \"avif\");\r\nexport const Image_Bmp = /*@__PURE__*/ image(\"bmp\", \"bmp\");\r\nexport const Image_Cgm = /*@__PURE__*/ image(\"cgm\", \"cgm\");\r\nexport const Image_Dicom_Rle = /*@__PURE__*/ image(\"dicom-rle\");\r\nexport const Image_Emf = /*@__PURE__*/ image(\"emf\");\r\nexport const Image_Example = /*@__PURE__*/ image(\"example\");\r\nexport const Image_EXR = /*@__PURE__*/ image(\"x-exr\", \"exr\");\r\nexport const Image_Fits = /*@__PURE__*/ image(\"fits\");\r\nexport const Image_G3fax = /*@__PURE__*/ image(\"g3fax\", \"g3\");\r\nexport const Image_Gif = /*@__PURE__*/ image(\"gif\", \"gif\");\r\nexport const Image_Heic = /*@__PURE__*/ image(\"heic\");\r\nexport const Image_Heic_Sequence = /*@__PURE__*/ image(\"heic-sequence\");\r\nexport const Image_Heif = /*@__PURE__*/ image(\"heif\");\r\nexport const Image_Heif_Sequence = /*@__PURE__*/ image(\"heif-sequence\");\r\nexport const Image_Hej2k = /*@__PURE__*/ image(\"hej2k\");\r\nexport const Image_Hsj2 = /*@__PURE__*/ image(\"hsj2\");\r\nexport const Image_Ief = /*@__PURE__*/ image(\"ief\", \"ief\");\r\nexport const Image_Jls = /*@__PURE__*/ image(\"jls\");\r\nexport const Image_Jp2 = /*@__PURE__*/ image(\"jp2\");\r\nexport const Image_Jpeg = /*@__PURE__*/ image(\"jpeg\", \"jpeg\", \"jpg\", \"jpe\");\r\nexport const Image_Jph = /*@__PURE__*/ image(\"jph\");\r\nexport const Image_Jphc = /*@__PURE__*/ image(\"jphc\");\r\nexport const Image_Jpm = /*@__PURE__*/ image(\"jpm\");\r\nexport const Image_Jpx = /*@__PURE__*/ image(\"jpx\");\r\nexport const Image_Jxr = /*@__PURE__*/ image(\"jxr\");\r\nexport const Image_JxrA = /*@__PURE__*/ image(\"jxra\");\r\nexport const Image_JxrS = /*@__PURE__*/ image(\"jxrs\");\r\nexport const Image_Jxs = /*@__PURE__*/ image(\"jxs\");\r\nexport const Image_Jxsc = /*@__PURE__*/ image(\"jxsc\");\r\nexport const Image_Jxsi = /*@__PURE__*/ image(\"jxsi\");\r\nexport const Image_Jxss = /*@__PURE__*/ image(\"jxss\");\r\nexport const Image_Ktx = /*@__PURE__*/ image(\"ktx\", \"ktx\");\r\nexport const Image_Naplps = /*@__PURE__*/ image(\"naplps\");\r\nexport const Image_Pjpeg = /*@__PURE__*/ image(\"pjpeg\");\r\nexport const Image_Png = /*@__PURE__*/ image(\"png\", \"png\");\r\nexport const Image_PrsBtif = /*@__PURE__*/ image(\"prs.btif\", \"btif\");\r\nexport const Image_PrsPti = /*@__PURE__*/ image(\"prs.pti\");\r\nexport const Image_Pwg_Raster = /*@__PURE__*/ image(\"pwg-raster\");\r\nexport const Image_Raw = /*@__PURE__*/ image(\"x-raw\", \"raw\");\r\nexport const Image_Sgi = /*@__PURE__*/ image(\"sgi\", \"sgi\");\r\nexport const Image_SvgXml = /*@__PURE__*/ image(\"svg+xml\", \"svg\", \"svgz\");\r\nexport const Image_T38 = /*@__PURE__*/ image(\"t38\");\r\nexport const Image_Tiff = /*@__PURE__*/ image(\"tiff\", \"tiff\", \"tif\");\r\nexport const Image_Tiff_Fx = /*@__PURE__*/ image(\"tiff-fx\");\r\nexport const Image_Vendor_AdobePhotoshop = /*@__PURE__*/ image(\"vnd.adobe.photoshop\", \"psd\");\r\nexport const Image_Vendor_AirzipAcceleratorAzv = /*@__PURE__*/ image(\"vnd.airzip.accelerator.azv\");\r\nexport const Image_Vendor_CnsInf2 = /*@__PURE__*/ image(\"vnd.cns.inf2\");\r\nexport const Image_Vendor_DeceGraphic = /*@__PURE__*/ image(\"vnd.dece.graphic\", \"uvi\", \"uvvi\", \"uvg\", \"uvvg\");\r\nexport const Image_Vendor_Djvu = /*@__PURE__*/ image(\"vnd.djvu\", \"djvu\", \"djv\");\r\nexport const Image_Vendor_DvbSubtitle = /*@__PURE__*/ image(\"vnd.dvb.subtitle\", \"sub\");\r\nexport const Image_Vendor_Dwg = /*@__PURE__*/ image(\"vnd.dwg\", \"dwg\");\r\nexport const Image_Vendor_Dxf = /*@__PURE__*/ image(\"vnd.dxf\", \"dxf\");\r\nexport const Image_Vendor_Fastbidsheet = /*@__PURE__*/ image(\"vnd.fastbidsheet\", \"fbs\");\r\nexport const Image_Vendor_Fpx = /*@__PURE__*/ image(\"vnd.fpx\", \"fpx\");\r\nexport const Image_Vendor_Fst = /*@__PURE__*/ image(\"vnd.fst\", \"fst\");\r\nexport const Image_Vendor_FujixeroxEdmics_Mmr = /*@__PURE__*/ image(\"vnd.fujixerox.edmics-mmr\", \"mmr\");\r\nexport const Image_Vendor_FujixeroxEdmics_Rlc = /*@__PURE__*/ image(\"vnd.fujixerox.edmics-rlc\", \"rlc\");\r\nexport const Image_Vendor_GlobalgraphicsPgb = /*@__PURE__*/ image(\"vnd.globalgraphics.pgb\");\r\nexport const Image_Vendor_Google_StreetView_Pano = /*@__PURE_*/ image(\"vnd.google.streetview.pano\");\r\nexport const Image_Vendor_MicrosoftIcon = /*@__PURE__*/ image(\"vnd.microsoft.icon\");\r\nexport const Image_Vendor_Mix = /*@__PURE__*/ image(\"vnd.mix\");\r\nexport const Image_Vendor_MozillaApng = /*@__PURE__*/ image(\"vnd.mozilla.apng\");\r\nexport const Image_Vendor_Ms_Dds = /*@__PURE__*/ image(\"vnd.ms-dds\", \"dds\");\r\nexport const Image_Vendor_Ms_Modi = /*@__PURE__*/ image(\"vnd.ms-modi\", \"mdi\");\r\nexport const Image_Vendor_Ms_Photo = /*@__PURE__*/ image(\"vnd.ms-photo\", \"wdp\");\r\nexport const Image_Vendor_Net_Fpx = /*@__PURE__*/ image(\"vnd.net-fpx\", \"npx\");\r\nexport const Image_Vendor_Radiance = /*@__PURE__*/ image(\"vnd.radiance\");\r\nexport const Image_Vendor_SealedmediaSoftsealGif = /*@__PURE__*/ image(\"vnd.sealedmedia.softseal.gif\");\r\nexport const Image_Vendor_SealedmediaSoftsealJpg = /*@__PURE__*/ image(\"vnd.sealedmedia.softseal.jpg\");\r\nexport const Image_Vendor_SealedPng = /*@__PURE__*/ image(\"vnd.sealed.png\");\r\nexport const Image_Vendor_Svf = /*@__PURE__*/ image(\"vnd.svf\");\r\nexport const Image_Vendor_TencentTap = /*@__PURE__*/ image(\"vnd.tencent.tap\");\r\nexport const Image_Vendor_ValveSourceTexture = /*@__PURE__*/ image(\"vnd.valve.source.texture\");\r\nexport const Image_Vendor_WapWbmp = /*@__PURE__*/ image(\"vnd.wap.wbmp\", \"wbmp\");\r\nexport const Image_Vendor_Xiff = /*@__PURE__*/ image(\"vnd.xiff\", \"xif\");\r\nexport const Image_Vendor_ZbrushPcx = /*@__PURE__*/ image(\"vnd.zbrush.pcx\");\r\nexport const Image_Webp = /*@__PURE__*/ image(\"webp\", \"webp\");\r\nexport const Image_Wmf = /*@__PURE__*/ image(\"wmf\");\r\nexport const Image_X_3ds = /*@__PURE__*/ image(\"x-3ds\", \"3ds\");\r\nexport const Image_X_Cmu_Raster = /*@__PURE__*/ image(\"x-cmu-raster\", \"ras\");\r\nexport const Image_X_Cmx = /*@__PURE__*/ image(\"x-cmx\", \"cmx\");\r\nexport const Image_X_Emf = /*@__PURE__*/ image(\"x-emf\").deprecate(\"in favor of image/emf\");\r\nexport const Image_X_Freehand = /*@__PURE__*/ image(\"x-freehand\", \"fh\", \"fhc\", \"fh4\", \"fh5\", \"fh7\");\r\nexport const Image_X_Icon = /*@__PURE__*/ image(\"x-icon\", \"ico\");\r\nexport const Image_X_Mrsid_Image = /*@__PURE__*/ image(\"x-mrsid-image\", \"sid\");\r\nexport const Image_X_Ms_Bmp = /*@__PURE__*/ image(\"x-ms-bmp\");\r\nexport const Image_X_Pcx = /*@__PURE__*/ image(\"x-pcx\", \"pcx\");\r\nexport const Image_X_Pict = /*@__PURE__*/ image(\"x-pict\", \"pic\", \"pct\");\r\nexport const Image_X_Portable_Anymap = /*@__PURE__*/ image(\"x-portable-anymap\", \"pnm\");\r\nexport const Image_X_Portable_Bitmap = /*@__PURE__*/ image(\"x-portable-bitmap\", \"pbm\");\r\nexport const Image_X_Portable_Graymap = /*@__PURE__*/ image(\"x-portable-graymap\", \"pgm\");\r\nexport const Image_X_Portable_Pixmap = /*@__PURE__*/ image(\"x-portable-pixmap\", \"ppm\");\r\nexport const Image_X_Rgb = /*@__PURE__*/ image(\"x-rgb\", \"rgb\");\r\nexport const Image_X_Tga = /*@__PURE__*/ image(\"x-tga\", \"tga\");\r\nexport const Image_X_Wmf = /*@__PURE__*/ image(\"x-wmf\").deprecate(\"in favor of image/wmf\");\r\nexport const Image_X_Xbitmap = /*@__PURE__*/ image(\"x-xbitmap\", \"xbm\");\r\nexport const Image_X_Xcf = /*@__PURE__*/ image(\"x-xcf\");\r\nexport const Image_X_Xpixmap = /*@__PURE__*/ image(\"x-xpixmap\", \"xpm\");\r\nexport const Image_X_Xwindowdump = /*@__PURE__*/ image(\"x-xwindowdump\", \"xwd\");", "import { specialize } from \"./util\";\r\n\r\nconst video = /*@__PURE__*/ specialize(\"video\");\r\n\r\nexport const Video_BMPEG = /*@__PURE__*/ video(\"bmpeg\");\r\nexport const Video_BT656 = /*@__PURE__*/ video(\"bt656\");\r\nexport const Video_CelB = /*@__PURE__*/ video(\"celb\");\r\nexport const Video_DV = /*@__PURE__*/ video(\"dv\");\r\nexport const Video_Encaprtp = /*@__PURE__*/ video(\"encaprtp\");\r\nexport const Video_Example = /*@__PURE__*/ video(\"example\");\r\nexport const Video_Flexfec = /*@__PURE__*/ video(\"flexfec\");\r\nexport const Video_H261 = /*@__PURE__*/ video(\"h261\", \"h261\");\r\nexport const Video_H263 = /*@__PURE__*/ video(\"h263\", \"h263\");\r\nexport const Video_H263_1998 = /*@__PURE__*/ video(\"h263-1998\");\r\nexport const Video_H263_2000 = /*@__PURE__*/ video(\"h263-2000\");\r\nexport const Video_H264 = /*@__PURE__*/ video(\"h264\", \"h264\");\r\nexport const Video_H264_RCDO = /*@__PURE__*/ video(\"h264-rcdo\");\r\nexport const Video_H264_SVC = /*@__PURE__*/ video(\"h264-svc\");\r\nexport const Video_H265 = /*@__PURE__*/ video(\"h265\");\r\nexport const Video_IsoSegment = /*@__PURE__*/ video(\"iso.segment\");\r\nexport const Video_JPEG = /*@__PURE__*/ video(\"jpeg\", \"jpgv\");\r\nexport const Video_Jpeg2000 = /*@__PURE__*/ video(\"jpeg2000\");\r\nexport const Video_Jpm = /*@__PURE__*/ video(\"jpm\", \"jpm\", \"jpgm\");\r\nexport const Video_Mj2 = /*@__PURE__*/ video(\"mj2\", \"mj2\", \"mjp2\");\r\nexport const Video_MP1S = /*@__PURE__*/ video(\"mp1s\");\r\nexport const Video_MP2P = /*@__PURE__*/ video(\"mp2p\");\r\nexport const Video_MP2T = /*@__PURE__*/ video(\"mp2t\");\r\nexport const Video_Mp4 = /*@__PURE__*/ video(\"mp4\", \"mp4\", \"mp4v\", \"mpg4\");\r\nexport const Video_MP4V_ES = /*@__PURE__*/ video(\"mp4v-es\");\r\nexport const Video_Mpeg = /*@__PURE__*/ video(\"mpeg\", \"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\");\r\nexport const Video_Mpeg4_Generic = /*@__PURE__*/ video(\"mpeg4-generic\");\r\nexport const Video_MPV = /*@__PURE__*/ video(\"mpv\");\r\nexport const Video_Nv = /*@__PURE__*/ video(\"nv\");\r\nexport const Video_Ogg = /*@__PURE__*/ video(\"ogg\", \"ogv\");\r\nexport const Video_Parityfec = /*@__PURE__*/ video(\"parityfec\");\r\nexport const Video_Pointer = /*@__PURE__*/ video(\"pointer\");\r\nexport const Video_Quicktime = /*@__PURE__*/ video(\"quicktime\", \"qt\", \"mov\");\r\nexport const Video_Raptorfec = /*@__PURE__*/ video(\"raptorfec\");\r\nexport const Video_Raw = /*@__PURE__*/ video(\"raw\");\r\nexport const Video_Rtp_Enc_Aescm128 = /*@__PURE__*/ video(\"rtp-enc-aescm128\");\r\nexport const Video_Rtploopback = /*@__PURE__*/ video(\"rtploopback\");\r\nexport const Video_Rtx = /*@__PURE__*/ video(\"rtx\");\r\nexport const Video_Smpte291 = /*@__PURE__*/ video(\"smpte291\");\r\nexport const Video_SMPTE292M = /*@__PURE__*/ video(\"smpte292m\");\r\nexport const Video_Ulpfec = /*@__PURE__*/ video(\"ulpfec\");\r\nexport const Video_Vc1 = /*@__PURE__*/ video(\"vc1\");\r\nexport const Video_Vc2 = /*@__PURE__*/ video(\"vc2\");\r\nexport const Video_Vendor_1d_Interleaved_Parityfec = /*@__PURE__*/ video(\"1d-interleaved-parityfec\");\r\nexport const Video_Vendor_3gpp = /*@__PURE__*/ video(\"3gpp\", \"3gp\");\r\nexport const Video_Vendor_3gpp_Tt = /*@__PURE__*/ video(\"3gpp-tt\");\r\nexport const Video_Vendor_3gpp2 = /*@__PURE__*/ video(\"3gpp2\", \"3g2\");\r\nexport const Video_Vendor_CCTV = /*@__PURE__*/ video(\"vnd.cctv\");\r\nexport const Video_Vendor_DeceHd = /*@__PURE__*/ video(\"vnd.dece.hd\", \"uvh\", \"uvvh\");\r\nexport const Video_Vendor_DeceMobile = /*@__PURE__*/ video(\"vnd.dece.mobile\", \"uvm\", \"uvvm\");\r\nexport const Video_Vendor_DeceMp4 = /*@__PURE__*/ video(\"vnd.dece.mp4\");\r\nexport const Video_Vendor_DecePd = /*@__PURE__*/ video(\"vnd.dece.pd\", \"uvp\", \"uvvp\");\r\nexport const Video_Vendor_DeceSd = /*@__PURE__*/ video(\"vnd.dece.sd\", \"uvs\", \"uvvs\");\r\nexport const Video_Vendor_DeceVideo = /*@__PURE__*/ video(\"vnd.dece.video\", \"uvv\", \"uvvv\");\r\nexport const Video_Vendor_DirectvMpeg = /*@__PURE__*/ video(\"vnd.directv.mpeg\");\r\nexport const Video_Vendor_DirectvMpeg_Tts = /*@__PURE__*/ video(\"vnd.directv.mpeg-tts\");\r\nexport const Video_Vendor_DlnaMpeg_Tts = /*@__PURE__*/ video(\"vnd.dlna.mpeg-tts\");\r\nexport const Video_Vendor_DvbFile = /*@__PURE__*/ video(\"vnd.dvb.file\", \"dvb\");\r\nexport const Video_Vendor_Fvt = /*@__PURE__*/ video(\"vnd.fvt\", \"fvt\");\r\nexport const Video_Vendor_HnsVideo = /*@__PURE__*/ video(\"vnd.hns.video\");\r\nexport const Video_Vendor_Iptvforum1dparityfec_1010 = /*@__PURE__*/ video(\"vnd.iptvforum.1dparityfec-1010\");\r\nexport const Video_Vendor_Iptvforum1dparityfec_2005 = /*@__PURE__*/ video(\"vnd.iptvforum.1dparityfec-2005\");\r\nexport const Video_Vendor_Iptvforum2dparityfec_1010 = /*@__PURE__*/ video(\"vnd.iptvforum.2dparityfec-1010\");\r\nexport const Video_Vendor_Iptvforum2dparityfec_2005 = /*@__PURE__*/ video(\"vnd.iptvforum.2dparityfec-2005\");\r\nexport const Video_Vendor_IptvforumTtsavc = /*@__PURE__*/ video(\"vnd.iptvforum.ttsavc\");\r\nexport const Video_Vendor_IptvforumTtsmpeg2 = /*@__PURE__*/ video(\"vnd.iptvforum.ttsmpeg2\");\r\nexport const Video_Vendor_MotorolaVideo = /*@__PURE__*/ video(\"vnd.motorola.video\");\r\nexport const Video_Vendor_MotorolaVideop = /*@__PURE__*/ video(\"vnd.motorola.videop\");\r\nexport const Video_Vendor_Mpegurl = /*@__PURE__*/ video(\"vnd.mpegurl\", \"mxu\", \"m4u\");\r\nexport const Video_Vendor_Ms_PlayreadyMediaPyv = /*@__PURE__*/ video(\"vnd.ms-playready.media.pyv\", \"pyv\");\r\nexport const Video_Vendor_NokiaInterleaved_Multimedia = /*@__PURE__*/ video(\"vnd.nokia.interleaved-multimedia\");\r\nexport const Video_Vendor_NokiaMp4vr = /*@__PURE__*/ video(\"vnd.nokia.mp4vr\");\r\nexport const Video_Vendor_NokiaVideovoip = /*@__PURE__*/ video(\"vnd.nokia.videovoip\");\r\nexport const Video_Vendor_Objectvideo = /*@__PURE__*/ video(\"vnd.objectvideo\");\r\nexport const Video_Vendor_RadgamettoolsBink = /*@__PURE__*/ video(\"vnd.radgamettools.bink\");\r\nexport const Video_Vendor_RadgamettoolsSmacker = /*@__PURE__*/ video(\"vnd.radgamettools.smacker\");\r\nexport const Video_Vendor_SealedmediaSoftsealMov = /*@__PURE__*/ video(\"vnd.sealedmedia.softseal.mov\");\r\nexport const Video_Vendor_SealedMpeg1 = /*@__PURE__*/ video(\"vnd.sealed.mpeg1\");\r\nexport const Video_Vendor_SealedMpeg4 = /*@__PURE__*/ video(\"vnd.sealed.mpeg4\");\r\nexport const Video_Vendor_SealedSwf = /*@__PURE__*/ video(\"vnd.sealed.swf\");\r\nexport const Video_Vendor_UvvuMp4 = /*@__PURE__*/ video(\"vnd.uvvu.mp4\", \"uvu\", \"uvvu\");\r\nexport const Video_Vendor_Vivo = /*@__PURE__*/ video(\"vnd.vivo\", \"viv\");\r\nexport const Video_Vendor_YoutubeYt = /*@__PURE__*/ video(\"vnd.youtube.yt\");\r\n/**\r\n * This is actually an XML file format that describes adaptive media playback\r\n **/\r\nexport const Video_Vendor_Mpeg_Dash_Mpd = video(\"vnd.mpeg.dash.mpd\", \"mpd\");\r\nexport const Video_VP8 = /*@__PURE__*/ video(\"vp8\");\r\nexport const Video_Webm = /*@__PURE__*/ video(\"webm\", \"webm\");\r\nexport const Video_X_F4v = /*@__PURE__*/ video(\"x-f4v\", \"f4v\");\r\nexport const Video_X_Fli = /*@__PURE__*/ video(\"x-fli\", \"fli\");\r\nexport const Video_X_Flv = /*@__PURE__*/ video(\"x-flv\", \"flv\");\r\nexport const Video_X_M4v = /*@__PURE__*/ video(\"x-m4v\", \"m4v\");\r\nexport const Video_X_Matroska = /*@__PURE__*/ video(\"x-matroska\", \"mkv\", \"mk3d\", \"mks\");\r\nexport const Video_X_Mng = /*@__PURE__*/ video(\"x-mng\", \"mng\");\r\nexport const Video_X_Ms_Asf = /*@__PURE__*/ video(\"x-ms-asf\", \"asf\", \"asx\");\r\nexport const Video_X_Ms_Vob = /*@__PURE__*/ video(\"x-ms-vob\", \"vob\");\r\nexport const Video_X_Ms_Wm = /*@__PURE__*/ video(\"x-ms-wm\", \"wm\");\r\nexport const Video_X_Ms_Wmv = /*@__PURE__*/ video(\"x-ms-wmv\", \"wmv\");\r\nexport const Video_X_Ms_Wmx = /*@__PURE__*/ video(\"x-ms-wmx\", \"wmx\");\r\nexport const Video_X_Ms_Wvx = /*@__PURE__*/ video(\"x-ms-wvx\", \"wvx\");\r\nexport const Video_X_Msvideo = /*@__PURE__*/ video(\"x-msvideo\", \"avi\");\r\nexport const Video_X_Sgi_Movie = /*@__PURE__*/ video(\"x-sgi-movie\", \"movie\");\r\nexport const Video_X_Smv = /*@__PURE__*/ video(\"x-smv\", \"smv\");", "import { AudioRecord, FullAudioRecord, MediaRecord } from \"@juniper-lib/audio/data\";\r\nimport { isString } from \"@juniper-lib/tslib\";\r\n\r\nexport interface ImageRecord extends MediaRecord {\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\nexport interface VideoRecord extends AudioRecord, ImageRecord {\r\n    vcodec: string;\r\n    fps: number;\r\n    vbr: number;\r\n}\r\n\r\nexport interface FullVideoRecord extends FullAudioRecord {\r\n    thumbnail: ImageRecord;\r\n    videos: VideoRecord[];\r\n}\r\n\r\nexport function isVideoRecord(obj: MediaRecord): obj is VideoRecord {\r\n    return isString((obj as VideoRecord).vcodec);\r\n}\r\n", "import { AudioRecord } from \"@juniper-lib/audio/data\";\r\nimport { Gain, MediaElementSource, removeVertex } from \"@juniper-lib/audio/nodes\";\r\nimport { BaseAudioSource } from \"@juniper-lib/audio/sources/BaseAudioSource\";\r\nimport { MediaElementSourceLoadedEvent, MediaElementSourcePausedEvent, MediaElementSourcePlayedEvent, MediaElementSourceProgressEvent, MediaElementSourceStoppedEvent } from \"@juniper-lib/audio/sources/IPlayable\";\r\nimport { IPlayer, MediaPlayerEvents, MediaPlayerLoadingEvent } from \"@juniper-lib/audio/sources/IPlayer\";\r\nimport { PlaybackState } from \"@juniper-lib/audio/sources/PlaybackState\";\r\nimport { NoSpatializationNode } from \"@juniper-lib/audio/sources/spatializers/NoSpatializationNode\";\r\nimport { autoPlay, controls, loop, playsInline } from \"@juniper-lib/dom/attrs\";\r\nimport { Audio, ElementChild, mediaElementCanPlayThrough, Video } from \"@juniper-lib/dom/tags\";\r\nimport { Video_Vendor_Mpeg_Dash_Mpd } from \"@juniper-lib/mediatypes\";\r\nimport { arraySortByKeyInPlace, AsyncCallback, IDisposable, IProgress, isDefined, isNullOrUndefined, isString, once, PriorityList, progressTasks } from \"@juniper-lib/tslib\";\r\nimport { FullVideoRecord, isVideoRecord } from \"./data\";\r\n\r\nexport abstract class BaseVideoPlayer\r\n    extends BaseAudioSource<GainNode, MediaPlayerEvents>\r\n    implements IPlayer, IDisposable {\r\n\r\n    private readonly loadingEvt: MediaPlayerLoadingEvent;\r\n    private readonly loadEvt: MediaElementSourceLoadedEvent<IPlayer>;\r\n    private readonly playEvt: MediaElementSourcePlayedEvent<IPlayer>;\r\n    private readonly pauseEvt: MediaElementSourcePausedEvent<IPlayer>;\r\n    private readonly stopEvt: MediaElementSourceStoppedEvent<IPlayer>;\r\n    private readonly progEvt: MediaElementSourceProgressEvent<IPlayer>;\r\n\r\n    private readonly onPlay: () => void;\r\n    private readonly onSeeked: () => void;\r\n    private readonly onCanPlay: () => void;\r\n    private readonly onWaiting: () => void;\r\n    private readonly onPause: (evt: Event) => void;\r\n    private readonly onTimeUpdate: () => Promise<void> = null;\r\n\r\n    private wasUsingAudioElement: boolean = false;\r\n\r\n    private _data: FullVideoRecord | string = null;\r\n    get data(): FullVideoRecord | string {\r\n        return this._data;\r\n    }\r\n\r\n    private _loaded = false;\r\n    public get loaded() {\r\n        return this._loaded;\r\n    }\r\n\r\n    protected readonly video: HTMLVideoElement;\r\n    protected readonly audio: HTMLAudioElement;\r\n    private readonly videoSource: MediaElementAudioSourceNode;\r\n    private readonly audioSource: MediaElementAudioSourceNode;\r\n\r\n    get title() {\r\n        return this.video.title;\r\n    }\r\n\r\n    protected setTitle(v: string): void {\r\n        this.video.title = v;\r\n        this.audio.title = v;\r\n    }\r\n\r\n    private readonly onError = new Map<HTMLMediaElement, AsyncCallback>();\r\n    private readonly sourcesByURL = new Map<string, AudioRecord>();\r\n    private readonly sources = new PriorityList<HTMLMediaElement, AudioRecord>();\r\n    private readonly potatoes = new PriorityList<HTMLMediaElement, string>();\r\n\r\n    constructor(audioCtx: AudioContext) {\r\n        super(\"JuniperVideoPlayer\", audioCtx, NoSpatializationNode.instance(audioCtx));\r\n\r\n        this.video = this.createMediaElement(Video, controls(true));\r\n        this.audio = this.createMediaElement(Audio, controls(false));\r\n\r\n        this.input = Gain(\"JuniperVideoPlayer-combiner\", audioCtx);\r\n\r\n        this.videoSource = MediaElementSource(\r\n            \"JuniperVideoPlayer-VideoNode\",\r\n            audioCtx,\r\n            this.video,\r\n            this.input);\r\n\r\n        this.audioSource = MediaElementSource(\r\n            \"JuniperVideoPlayer-AudioNode\",\r\n            audioCtx,\r\n            this.audio,\r\n            this.input);\r\n\r\n        this.loadingEvt = new MediaPlayerLoadingEvent(this);\r\n        this.loadEvt = new MediaElementSourceLoadedEvent(this);\r\n        this.playEvt = new MediaElementSourcePlayedEvent(this);\r\n        this.pauseEvt = new MediaElementSourcePausedEvent(this);\r\n        this.stopEvt = new MediaElementSourceStoppedEvent(this);\r\n        this.progEvt = new MediaElementSourceProgressEvent(this);\r\n\r\n        this.onSeeked = () => {\r\n            if (this.useAudioElement) {\r\n                this.audio.currentTime = this.video.currentTime;\r\n            }\r\n        };\r\n\r\n        this.onPlay = async () => {\r\n            this.connect();\r\n\r\n            this.onSeeked();\r\n            if (this.useAudioElement) {\r\n                await this.audio.play();\r\n            }\r\n            this.dispatchEvent(this.playEvt)\r\n        };\r\n\r\n        this.onPause = (evt: Event) => {\r\n            this.disconnect();\r\n\r\n            if (this.useAudioElement) {\r\n                this.onSeeked();\r\n                this.audio.pause();\r\n            }\r\n            if (this.video.currentTime === 0 || evt.type === \"ended\") {\r\n                this.dispatchEvent(this.stopEvt);\r\n            }\r\n            else {\r\n                this.dispatchEvent(this.pauseEvt);\r\n            }\r\n        };\r\n\r\n        let wasWaiting = false;\r\n        this.onWaiting = () => {\r\n            if (this.useAudioElement) {\r\n                wasWaiting = true;\r\n                this.audio.pause();\r\n            }\r\n        };\r\n\r\n        this.onCanPlay = async () => {\r\n            if (this.useAudioElement && wasWaiting) {\r\n                await this.audio.play();\r\n                wasWaiting = false;\r\n            }\r\n        };\r\n\r\n        this.wasUsingAudioElement = false;\r\n        this.onTimeUpdate = async () => {\r\n            const quality = this.video.getVideoPlaybackQuality();\r\n            if (quality.totalVideoFrames === 0) {\r\n                const onError = this.onError.get(this.video);\r\n                if (isDefined(onError)) {\r\n                    await onError();\r\n                }\r\n            }\r\n            else if (this.useAudioElement) {\r\n                this.wasUsingAudioElement = false;\r\n                const delta = this.video.currentTime - this.audio.currentTime;\r\n                if (Math.abs(delta) > 0.25) {\r\n                    this.audio.currentTime = this.video.currentTime;\r\n                }\r\n            }\r\n            else if (!this.wasUsingAudioElement) {\r\n                this.wasUsingAudioElement = true;\r\n                this.audio.pause();\r\n            }\r\n            this.progEvt.value = this.video.currentTime;\r\n            this.progEvt.total = this.video.duration;\r\n            this.dispatchEvent(this.progEvt);\r\n        };\r\n\r\n        this.video.addEventListener(\"seeked\", this.onSeeked);\r\n        this.video.addEventListener(\"play\", this.onPlay);\r\n        this.video.addEventListener(\"pause\", this.onPause);\r\n        this.video.addEventListener(\"ended\", this.onPause);\r\n        this.video.addEventListener(\"waiting\", this.onWaiting);\r\n        this.video.addEventListener(\"canplay\", this.onCanPlay);\r\n        this.video.addEventListener(\"timeupdate\", this.onTimeUpdate);\r\n\r\n\r\n        Object.assign(window, { videoPlayer: this });\r\n    }\r\n\r\n    private elementHasAudio(elem: HTMLMediaElement): boolean {\r\n        const source = this.sourcesByURL.get(elem.src);\r\n        return isDefined(source) && source.acodec !== \"none\"\r\n            || isDefined(elem.audioTracks) && elem.audioTracks.length > 0\r\n            || isDefined(elem.webkitAudioDecodedByteCount) && elem.webkitAudioDecodedByteCount > 0\r\n            || isDefined(elem.mozHasAudio) && elem.mozHasAudio;\r\n    }\r\n\r\n    private get useAudioElement(): boolean {\r\n        return !this.elementHasAudio(this.video)\r\n            && this.elementHasAudio(this.audio);\r\n    }\r\n\r\n    protected override onDisposing(): void {\r\n        super.onDisposing();\r\n        this.clear();\r\n        removeVertex(this.input);\r\n        removeVertex(this.videoSource);\r\n        removeVertex(this.audioSource);\r\n\r\n        this.video.removeEventListener(\"seeked\", this.onSeeked);\r\n        this.video.removeEventListener(\"play\", this.onPlay);\r\n        this.video.removeEventListener(\"pause\", this.onPause);\r\n        this.video.removeEventListener(\"ended\", this.onPause);\r\n        this.video.removeEventListener(\"waiting\", this.onWaiting);\r\n        this.video.removeEventListener(\"canplay\", this.onCanPlay);\r\n        this.video.removeEventListener(\"timeupdate\", this.onTimeUpdate);\r\n    }\r\n\r\n    clear(): void {\r\n        this.stop();\r\n\r\n        for (const [elem, onError] of this.onError) {\r\n            elem.removeEventListener(\"error\", onError);\r\n        }\r\n\r\n        this.onError.clear();\r\n        this.sourcesByURL.clear();\r\n        this.sources.clear();\r\n        this.potatoes.clear();\r\n\r\n        this.video.src = \"\";\r\n        this.audio.src = \"\";\r\n        this.wasUsingAudioElement = false;\r\n        this._data = null;\r\n        this._loaded = false;\r\n    }\r\n\r\n    async load(data: FullVideoRecord | string, prog?: IProgress): Promise<this> {\r\n        this.clear();\r\n\r\n        this._data = data;\r\n\r\n        if (isString(data)) {\r\n            this.setTitle(data);\r\n            this.potatoes.add(this.video, data);\r\n        }\r\n        else {\r\n            this.setTitle(data.title);\r\n            this.fillSources(this.video, data.videos);\r\n            this.fillSources(this.audio, data.audios);\r\n        }\r\n\r\n        if (!this.hasSources(this.video)) {\r\n            throw new Error(\"No video sources found\");\r\n        }\r\n\r\n        this.dispatchEvent(this.loadingEvt);\r\n\r\n        await progressTasks(prog,\r\n            (prog) => this.loadMediaElement(this.audio, prog),\r\n            (prog) => this.loadMediaElement(this.video, prog));\r\n\r\n        if (!this.hasSources(this.video)) {\r\n            throw new Error(\"No video playable sources\");\r\n        }\r\n\r\n        this._loaded = true;\r\n\r\n        this.dispatchEvent(this.loadEvt);\r\n        return this;\r\n    }\r\n\r\n    private fillSources(elem: HTMLMediaElement, formats: AudioRecord[]) {\r\n        arraySortByKeyInPlace(formats, (f) => -f.resolution);\r\n        for (const format of formats) {\r\n            if (!Video_Vendor_Mpeg_Dash_Mpd.matches(format.contentType)) {\r\n                this.sources.add(elem, format);\r\n                this.sourcesByURL.set(format.url, format);\r\n            }\r\n        }\r\n    }\r\n\r\n    private createMediaElement<T extends HTMLMediaElement>(MediaElement: (...rest: ElementChild[]) => T, ...rest: ElementChild[]): T {\r\n        return MediaElement(\r\n            playsInline(true),\r\n            autoPlay(false),\r\n            loop(false),\r\n            ...rest\r\n        );\r\n    }\r\n\r\n    private async getMediaCapabilities<T extends AudioRecord>(source: T): Promise<MediaCapabilitiesDecodingInfo> {\r\n        const config: MediaDecodingConfiguration = {\r\n            type: \"file\"\r\n        };\r\n\r\n        if (isVideoRecord(source)) {\r\n            config.video = {\r\n                contentType: source.contentType,\r\n                bitrate: source.vbr * 1024,\r\n                framerate: source.fps,\r\n                width: source.width,\r\n                height: source.height\r\n            }\r\n        }\r\n        else if (source.acodec !== \"none\") {\r\n            config.audio = {\r\n                contentType: source.contentType,\r\n                bitrate: source.abr * 1024,\r\n                samplerate: source.asr\r\n            };\r\n        }\r\n\r\n        try {\r\n            return await navigator.mediaCapabilities.decodingInfo(config)\r\n        }\r\n        catch {\r\n            return {\r\n                supported: true,\r\n                powerEfficient: false,\r\n                smooth: false,\r\n                configuration: config\r\n            };\r\n        }\r\n    }\r\n\r\n    private hasSources(elem: HTMLMediaElement): boolean {\r\n        return this.sources.get(elem).length > 0\r\n            || this.potatoes.count(elem) > 0;\r\n    }\r\n\r\n    private async loadMediaElement(elem: HTMLMediaElement, prog?: IProgress): Promise<void> {\r\n        if (isDefined(prog)) {\r\n            prog.start();\r\n        }\r\n\r\n        if (this.onError.has(elem)) {\r\n            elem.removeEventListener(\"error\", this.onError.get(elem));\r\n            this.onError.delete(elem);\r\n        }\r\n\r\n        while (this.hasSources(elem)) {\r\n            let url: string = null;\r\n            const source = this.sources.get(elem).shift();\r\n            if (isDefined(source)) {\r\n                const caps = await this.getMediaCapabilities(source);\r\n                if (!caps.smooth || !caps.powerEfficient) {\r\n                    this.potatoes.add(elem, source.url);\r\n                    continue;\r\n                }\r\n                else {\r\n                    url = source.url;\r\n                }\r\n            }\r\n            else {\r\n                url = this.potatoes.get(elem).shift();\r\n            }\r\n\r\n            elem.src = url;\r\n            elem.load();\r\n            if (await mediaElementCanPlayThrough(elem)) {\r\n                if (isDefined(source)) {\r\n                    this.sources.get(elem).unshift(source);\r\n                }\r\n                else {\r\n                    this.potatoes.get(elem).unshift(url);\r\n                }\r\n\r\n                const onError = () => this.loadMediaElement(elem, prog);\r\n                elem.addEventListener(\"error\", onError);\r\n                this.onError.set(elem, onError);\r\n                this.wasUsingAudioElement = this.wasUsingAudioElement;\r\n\r\n                if (isDefined(prog)) {\r\n                    prog.end();\r\n                }\r\n\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    get width() {\r\n        return this.video.videoWidth;\r\n    }\r\n\r\n    get height() {\r\n        return this.video.videoHeight;\r\n    }\r\n\r\n    get playbackState(): PlaybackState {\r\n        if (isNullOrUndefined(this.data)) {\r\n            return \"empty\";\r\n        }\r\n\r\n        if (!this.loaded) {\r\n            return \"loading\";\r\n        }\r\n\r\n        if (this.video.error) {\r\n            return \"errored\";\r\n        }\r\n\r\n        if (this.video.ended\r\n            || this.video.paused\r\n            && this.video.currentTime === 0) {\r\n            return \"stopped\";\r\n        }\r\n\r\n        if (this.video.paused) {\r\n            return \"paused\";\r\n        }\r\n\r\n        return \"playing\";\r\n    }\r\n\r\n    play(): Promise<void> {\r\n        return this.video.play();\r\n    }\r\n\r\n    async playThrough(): Promise<void> {\r\n        const endTask = once(this, \"stopped\");\r\n        await this.play();\r\n        await endTask;\r\n    }\r\n\r\n    pause(): void {\r\n        this.video.pause();\r\n    }\r\n\r\n    stop(): void {\r\n        this.pause();\r\n        this.video.currentTime = 0;\r\n    }\r\n\r\n    restart(): Promise<void> {\r\n        this.stop();\r\n        return this.play();\r\n    }\r\n}\r\n\r\n", "type UV = [number, number];\r\ntype Pos = [number, number, number];\r\nexport type PosUV = [number, number, number, number, number];\r\ntype PosUVBounds = {\r\n    pos: Pos;\r\n    uv: UV;\r\n    pUV: UV;\r\n}\r\n\r\nexport type TrianglePosUV = [PosUV, PosUV, PosUV];\r\nexport type QuadPosUV = [PosUV, PosUV, PosUV, PosUV];\r\nexport type QuadPosUVBounds = {\r\n    minUV: UV;\r\n    deltaUV: UV;\r\n    verts: [PosUVBounds, PosUVBounds, PosUVBounds, PosUVBounds];\r\n}\r\n\r\ninterface ITrianglePosUVNormal {\r\n    positions: [Pos, Pos, Pos];\r\n    uvs: [UV, UV, UV];\r\n    normal: Pos;\r\n}\r\n\r\nfunction normalizeTriangles(trias: TrianglePosUV[]): ITrianglePosUVNormal[] {\r\n    return trias.map(normalizeTriangle);\r\n}\r\n\r\nfunction normalizeQuad(quad: QuadPosUV): [ITrianglePosUVNormal, ITrianglePosUVNormal] {\r\n    return [\r\n        normalizeTriangle([quad[1], quad[0], quad[2]]),\r\n        normalizeTriangle([quad[2], quad[0], quad[3]])\r\n    ];\r\n}\r\n\r\nfunction normalizeQuads(quads: QuadPosUV[]): ITrianglePosUVNormal[] {\r\n    return quads.map(normalizeQuad).flat();\r\n}\r\n\r\nconst A = new THREE.Vector3();\r\nconst B = new THREE.Vector3();\r\nconst C = new THREE.Vector3();\r\n\r\nfunction normalizeTriangle(tria: TrianglePosUV): ITrianglePosUVNormal {\r\n    const positions: [Pos, Pos, Pos] = [\r\n        [tria[0][0], tria[0][1], tria[0][2]],\r\n        [tria[1][0], tria[1][1], tria[1][2]],\r\n        [tria[2][0], tria[2][1], tria[2][2]]\r\n    ];\r\n    const uvs: [UV, UV, UV] = [\r\n        [tria[0][3], tria[0][4]],\r\n        [tria[1][3], tria[1][4]],\r\n        [tria[2][3], tria[2][4]]\r\n    ];\r\n\r\n    C.fromArray(positions[0]);\r\n    A.fromArray(positions[1]).sub(C);\r\n    C.fromArray(positions[2]);\r\n    B.fromArray(positions[1]).sub(C);\r\n    A.cross(B);\r\n    const normal = A.toArray();\r\n\r\n    return {\r\n        positions,\r\n        uvs,\r\n        normal\r\n    };\r\n}\r\n\r\nfunction createGeometry(nFaces: ITrianglePosUVNormal[]) {\r\n    const positions = nFaces.map((f) => f.positions).flat(2);\r\n    const uvs = nFaces.map((f) => f.uvs).flat(2);\r\n    const normals = nFaces.flatMap((f) => f.normal);\r\n    const geom = new THREE.BufferGeometry();\r\n\r\n    geom.setAttribute(\"position\", new THREE.BufferAttribute(new Float32Array(positions), 3, false));\r\n    geom.setAttribute(\"uv\", new THREE.BufferAttribute(new Float32Array(uvs), 2, false));\r\n    geom.setAttribute(\"normal\", new THREE.BufferAttribute(new Float32Array(normals), 3, true));\r\n\r\n    return geom;\r\n}\r\n\r\nexport function createTriGeometry(...trias: TrianglePosUV[]) {\r\n    const faces = normalizeTriangles(trias);\r\n    return createGeometry(faces);\r\n}\r\n\r\nexport function createQuadGeometry(...quads: QuadPosUV[]) {\r\n    const faces = normalizeQuads(quads);\r\n    return createGeometry(faces);\r\n}\r\n\r\nexport function createEACGeometry(subDivs: number, ...quads: QuadPosUV[]) {\r\n    let remappingQuads = mapEACSubdivision(quads);\r\n    for (let i = 0; i < subDivs; ++i) {\r\n        remappingQuads = subdivide(remappingQuads);\r\n    }\r\n    quads = unmapEACSubdivision(remappingQuads)\r\n    const faces = normalizeQuads(quads);\r\n    return createGeometry(faces);\r\n}\r\n\r\nfunction mapEACSubdivision(quads: QuadPosUV[]): QuadPosUVBounds[] {\r\n    return quads.map((quad) => {\r\n        let minU = Number.MAX_VALUE;\r\n        let maxU = Number.MIN_VALUE;\r\n        let minV = Number.MAX_VALUE;\r\n        let maxV = Number.MIN_VALUE;\r\n        for (const vert of quad) {\r\n            const u = vert[3];\r\n            const v = vert[4];\r\n            minU = Math.min(minU, u);\r\n            maxU = Math.max(maxU, u);\r\n            minV = Math.min(minV, v);\r\n            maxV = Math.max(maxV, v);\r\n        }\r\n\r\n        const minUV: UV = [minU, minV];\r\n        const deltaUV: UV = [maxU - minU, maxV - minV];\r\n        return {\r\n            minUV,\r\n            deltaUV,\r\n            verts: [\r\n                mapEACSubdivVert(minUV, deltaUV, quad[0]),\r\n                mapEACSubdivVert(minUV, deltaUV, quad[1]),\r\n                mapEACSubdivVert(minUV, deltaUV, quad[2]),\r\n                mapEACSubdivVert(minUV, deltaUV, quad[3])\r\n            ]\r\n        }\r\n    });\r\n}\r\n\r\nfunction mapEACSubdivVert(minUV: UV, deltaUV: UV, vert: PosUV): PosUVBounds {\r\n    return {\r\n        pos: [vert[0], vert[1], vert[2]],\r\n        uv: [vert[3], vert[4]],\r\n        pUV: [\r\n            (vert[3] - minUV[0]) / deltaUV[0],\r\n            (vert[4] - minUV[1]) / deltaUV[1]\r\n        ]\r\n    };\r\n}\r\n\r\nfunction unmapEACSubdivision(quadsx: QuadPosUVBounds[]): QuadPosUV[] {\r\n    return quadsx.map((quadx) => [\r\n        unmapEACSubdivVert(quadx, 0),\r\n        unmapEACSubdivVert(quadx, 1),\r\n        unmapEACSubdivVert(quadx, 2),\r\n        unmapEACSubdivVert(quadx, 3)\r\n    ]);\r\n}\r\n\r\nfunction unmapEACSubdivVert(quadx: QuadPosUVBounds, i: number): PosUV {\r\n    const vert = quadx.verts[i];\r\n    return [\r\n        vert.pos[0],\r\n        vert.pos[1],\r\n        vert.pos[2],\r\n        vert.uv[0],\r\n        vert.uv[1],\r\n    ]\r\n}\r\n\r\nfunction subdivide(quadsx: QuadPosUVBounds[]): QuadPosUVBounds[] {\r\n    return quadsx.flatMap((quadx) => {\r\n        const midU1 = midpoint(quadx, quadx.verts[0], quadx.verts[1]);\r\n        const midU2 = midpoint(quadx, quadx.verts[2], quadx.verts[3]);\r\n        const midV1 = midpoint(quadx, quadx.verts[0], quadx.verts[3]);\r\n        const midV2 = midpoint(quadx, quadx.verts[1], quadx.verts[2]);\r\n        const mid = midpoint(quadx, midU1, midU2);\r\n        return [{\r\n            minUV: quadx.minUV,\r\n            deltaUV: quadx.deltaUV,\r\n            verts: [quadx.verts[0], midU1, mid, midV1]\r\n        }, {\r\n            minUV: quadx.minUV,\r\n            deltaUV: quadx.deltaUV,\r\n            verts: [midU1, quadx.verts[1], midV2, mid]\r\n        }, {\r\n            minUV: quadx.minUV,\r\n            deltaUV: quadx.deltaUV,\r\n            verts: [mid, midV2, quadx.verts[2], midU2]\r\n        }, {\r\n            minUV: quadx.minUV,\r\n            deltaUV: quadx.deltaUV,\r\n            verts: [midV1, mid, midU2, quadx.verts[3]]\r\n        }];\r\n    });\r\n}\r\n\r\nfunction midpoint(quadx: QuadPosUVBounds, from: PosUVBounds, to: PosUVBounds): PosUVBounds {\r\n    const dx = to.pos[0] - from.pos[0];\r\n    const dy = to.pos[1] - from.pos[1];\r\n    const dz = to.pos[2] - from.pos[2];\r\n    const x = from.pos[0] + 0.5 * dx;\r\n    const y = from.pos[1] + 0.5 * dy;\r\n    const z = from.pos[2] + 0.5 * dz;\r\n\r\n    const dpu = to.pUV[0] - from.pUV[0];\r\n    const dpv = to.pUV[1] - from.pUV[1];\r\n    const pu = from.pUV[0] + 0.5 * dpu;\r\n    const pv = from.pUV[1] + 0.5 * dpv;\r\n    const mu = mapEACUV(pu - 0.5) + 0.5;\r\n    const mv = mapEACUV(pv - 0.5) + 0.5;\r\n    const u = mu * quadx.deltaUV[0] + quadx.minUV[0];\r\n    const v = mv * quadx.deltaUV[1] + quadx.minUV[1];\r\n    \r\n    return {\r\n        pos: [x, y, z],\r\n        pUV: [pu, pv],\r\n        uv: [u, v]\r\n    }\r\n}\r\n\r\nfunction mapEACUV(uv: number): number {\r\n    return 2 * Math.atan(2 * uv) / Math.PI;\r\n}\r\n", "import { and, arrayClear, PriorityMap } from \"@juniper-lib/tslib\";\r\nimport { BaseVideoPlayer } from \"@juniper-lib/video/BaseVideoPlayer\";\r\nimport { cleanup } from \"./cleanup\";\r\nimport { createEACGeometry, createQuadGeometry, PosUV, QuadPosUV } from \"./CustomGeometry\";\r\nimport { Image2DMesh } from \"./Image2DMesh\";\r\nimport { IUpdatable } from \"./IUpdatable\";\r\nimport { IWebXRLayerManager } from \"./IWebXRLayerManager\";\r\nimport { solidTransparent } from \"./materials\";\r\nimport { ErsatzObject, obj } from \"./objects\";\r\n\r\nexport type SphereEncodingName = \"N/A\"\r\n    | \"Cubemap\"\r\n    | \"Cubemap Strips\"\r\n    | \"Equi-Angular Cubemap (YouTube)\"\r\n    | \"Equirectangular\"\r\n    | \"Half Equirectangular\"\r\n    | \"Panoramic\";\r\n\r\nexport const SphereEncodingNames: SphereEncodingName[] = [\r\n    \"N/A\",\r\n    \"Cubemap\",\r\n    \"Cubemap Strips\",\r\n    \"Equi-Angular Cubemap (YouTube)\",\r\n    \"Equirectangular\",\r\n    \"Half Equirectangular\",\r\n    \"Panoramic\"\r\n];\r\n\r\nexport type StereoLayoutName = \"mono\"\r\n    | \"left-right\"\r\n    | \"right-left\"\r\n    | \"top-bottom\"\r\n    | \"bottom-top\";\r\n\r\nexport const StereoLayoutNames: StereoLayoutName[] = [\r\n    \"mono\",\r\n    \"left-right\",\r\n    \"right-left\",\r\n    \"top-bottom\",\r\n    \"bottom-top\"\r\n];\r\n\r\nexport class VideoPlayer3D\r\n    extends BaseVideoPlayer\r\n    implements ErsatzObject, IUpdatable {\r\n\r\n    private readonly material: THREE.MeshBasicMaterial;\r\n    private readonly vidMeshes: Image2DMesh[];\r\n\r\n    readonly object: THREE.Object3D;\r\n\r\n    constructor(layerMgr: IWebXRLayerManager, audioCtx: AudioContext) {\r\n        super(audioCtx);\r\n\r\n        this.material = solidTransparent({ name: \"videoPlayer-material\" });\r\n\r\n        this.vidMeshes = [];\r\n        for (let i = 0; i < 2; ++i) {\r\n            const vidMesh = new Image2DMesh(layerMgr, `videoPlayer-view${i + 1}`, false, this.material);\r\n            vidMesh.mesh.setImage(this.video);\r\n            vidMesh.renderOrder = 4;\r\n            if (i > 0) {\r\n                vidMesh.mesh.layers.disable(0);\r\n            }\r\n            else {\r\n                vidMesh.mesh.layers.enable(0);\r\n            }\r\n\r\n            this.vidMeshes.push(vidMesh);\r\n        }\r\n\r\n        this.object = obj(\"videoPlayer\",\r\n            ...this.vidMeshes\r\n        );\r\n    }\r\n\r\n    protected override onDisposing(): void {\r\n        super.onDisposing();\r\n        cleanup(this.object);\r\n        arrayClear(this.vidMeshes);\r\n    }\r\n\r\n    update(dt: number, frame?: XRFrame) {\r\n        for (const vidMesh of this.vidMeshes) {\r\n            vidMesh.update(dt, frame);\r\n        }\r\n    }\r\n\r\n    isSupported(encoding: SphereEncodingName, layout: StereoLayoutName): boolean {\r\n        return layout\r\n            .split('-')\r\n            .map((name) =>\r\n                GeomPacks.has(encoding, name))\r\n            .reduce(and, true);\r\n    }\r\n\r\n    setStereoParameters(encoding: SphereEncodingName, layout: StereoLayoutName) {\r\n        if (!this.isSupported(encoding, layout)) {\r\n            throw new Error(`Not supported [encoding: ${encoding}, layout: ${layout}]`);\r\n        }\r\n\r\n        for (let i = 0; i < this.vidMeshes.length; ++i) {\r\n            const vidMesh = this.vidMeshes[i];\r\n            vidMesh.webXRLayersEnabled = false;\r\n            vidMesh.mesh.layers.disable(1);\r\n            vidMesh.mesh.layers.disable(2);\r\n            if (layout === \"left-right\"\r\n                || layout === \"top-bottom\") {\r\n                vidMesh.mesh.layers.enable(this.vidMeshes.length - i);\r\n            }\r\n            else if (layout !== \"mono\") {\r\n                vidMesh.mesh.layers.enable(i + 1);\r\n            }\r\n        }\r\n\r\n        const aspect = this.height / this.width;\r\n        if (encoding !== \"N/A\") {\r\n            this.vidMeshes[0].scale.setScalar(100);\r\n        }\r\n        else if (layout === \"mono\") {\r\n            this.vidMeshes[0].scale.set(1, aspect, 1);\r\n        }\r\n        else if (layout === \"left-right\"\r\n            || layout === \"right-left\") {\r\n            this.vidMeshes[0].scale.set(1, 2 * aspect, 1);\r\n        }\r\n        else {\r\n            this.vidMeshes[0].scale.set(1, 0.5 * aspect, 1);\r\n        }\r\n\r\n        for (let i = 1; i < this.vidMeshes.length; ++i) {\r\n            this.vidMeshes[i].scale.copy(this.vidMeshes[0].scale);\r\n        }\r\n\r\n        const names = layout.split('-');\r\n        for (let i = 0; i < names.length; ++i) {\r\n            const name = names[i];\r\n            const geom = GeomPacks.get(encoding, name);\r\n            const vidMesh = this.vidMeshes[i];\r\n            vidMesh.webXRLayersEnabled = true;\r\n            vidMesh.visible = true;\r\n            if (vidMesh.mesh.geometry !== geom) {\r\n                vidMesh.mesh.geometry.dispose();\r\n                vidMesh.mesh.geometry = geom;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst PlaneGeom_Mono = createQuadGeometry([\r\n    [-1 / 2, +1 / 2, 0, 0.0, 1.0],\r\n    [+1 / 2, +1 / 2, 0, 1.0, 1.0],\r\n    [+1 / 2, -1 / 2, 0, 1.0, 0.0],\r\n    [-1 / 2, -1 / 2, 0, 0.0, 0.0]\r\n]);\r\n\r\nconst PlaneDef_Left: QuadPosUV = [\r\n    [-1 / 2, +1 / 2, 0, 0.0, 1.0],\r\n    [+1 / 2, +1 / 2, 0, 0.5, 1.0],\r\n    [+1 / 2, -1 / 2, 0, 0.5, 0.0],\r\n    [-1 / 2, -1 / 2, 0, 0.0, 0.0]\r\n];\r\n\r\nconst PlanDef_Right: QuadPosUV = [\r\n    [-1 / 2, +1 / 2, 0, 0.5, 1.0],\r\n    [+1 / 2, +1 / 2, 0, 1.0, 1.0],\r\n    [+1 / 2, -1 / 2, 0, 1.0, 0.0],\r\n    [-1 / 2, -1 / 2, 0, 0.5, 0.0]\r\n]\r\n\r\nconst CubeStripDef_Mono: QuadPosUV[] = [[\r\n    [-1 / 2, +1 / 2, -1 / 2, 1 / 3, 1.000],\r\n    [+1 / 2, +1 / 2, -1 / 2, 2 / 3, 1.000],\r\n    [+1 / 2, -1 / 2, -1 / 2, 2 / 3, 1 / 2],\r\n    [-1 / 2, -1 / 2, -1 / 2, 1 / 3, 1 / 2]\r\n], [\r\n    [+1 / 2, +1 / 2, -1 / 2, 2 / 3, 1.000],\r\n    [+1 / 2, +1 / 2, +1 / 2, 1.000, 1.000],\r\n    [+1 / 2, -1 / 2, +1 / 2, 1.000, 1 / 2],\r\n    [+1 / 2, -1 / 2, -1 / 2, 2 / 3, 1 / 2]\r\n], [\r\n    [-1 / 2, +1 / 2, +1 / 2, 0.000, 1.000],\r\n    [-1 / 2, +1 / 2, -1 / 2, 1 / 3, 1.000],\r\n    [-1 / 2, -1 / 2, -1 / 2, 1 / 3, 1 / 2],\r\n    [-1 / 2, -1 / 2, +1 / 2, 0.000, 1 / 2]\r\n], [\r\n    [+1 / 2, +1 / 2, +1 / 2, 2 / 3, 1 / 2],\r\n    [-1 / 2, +1 / 2, +1 / 2, 2 / 3, 0.000],\r\n    [-1 / 2, -1 / 2, +1 / 2, 1 / 3, 0.000],\r\n    [+1 / 2, -1 / 2, +1 / 2, 1 / 3, 1 / 2]\r\n], [\r\n    [+1 / 2, +1 / 2, -1 / 2, 1.000, 1 / 2],\r\n    [-1 / 2, +1 / 2, -1 / 2, 1.000, 0.000],\r\n    [-1 / 2, +1 / 2, +1 / 2, 2 / 3, 0.000],\r\n    [+1 / 2, +1 / 2, +1 / 2, 2 / 3, 1 / 2]\r\n], [\r\n    [+1 / 2, -1 / 2, +1 / 2, 1 / 3, 1 / 2],\r\n    [-1 / 2, -1 / 2, +1 / 2, 1 / 3, 0.000],\r\n    [-1 / 2, -1 / 2, -1 / 2, 0.000, 0.000],\r\n    [+1 / 2, -1 / 2, -1 / 2, 0.000, 1 / 2]\r\n]];\r\n\r\nconst CubeStripDef_Left: QuadPosUV[] = [[\r\n    [-1 / 2, +1 / 2, -1 / 2, 0.000, 1 / 3],\r\n    [+1 / 2, +1 / 2, -1 / 2, 0.000, 2 / 3],\r\n    [+1 / 2, -1 / 2, -1 / 2, 1 / 4, 2 / 3],\r\n    [-1 / 2, -1 / 2, -1 / 2, 1 / 4, 1 / 3]\r\n], [\r\n    [+1 / 2, +1 / 2, -1 / 2, 0.000, 2 / 3],\r\n    [+1 / 2, +1 / 2, +1 / 2, 0.000, 1.000],\r\n    [+1 / 2, -1 / 2, +1 / 2, 1 / 4, 1.000],\r\n    [+1 / 2, -1 / 2, -1 / 2, 1 / 4, 2 / 3]\r\n], [\r\n    [-1 / 2, +1 / 2, +1 / 2, 0.000, 0.000],\r\n    [-1 / 2, +1 / 2, -1 / 2, 0.000, 1 / 3],\r\n    [-1 / 2, -1 / 2, -1 / 2, 1 / 4, 1 / 3],\r\n    [-1 / 2, -1 / 2, +1 / 2, 1 / 4, 0.000]\r\n], [\r\n    [+1 / 2, +1 / 2, +1 / 2, 1 / 4, 2 / 3],\r\n    [-1 / 2, +1 / 2, +1 / 2, 1 / 2, 2 / 3],\r\n    [-1 / 2, -1 / 2, +1 / 2, 1 / 2, 1 / 3],\r\n    [+1 / 2, -1 / 2, +1 / 2, 1 / 4, 1 / 3]\r\n], [\r\n    [+1 / 2, +1 / 2, -1 / 2, 1 / 4, 1.000],\r\n    [-1 / 2, +1 / 2, -1 / 2, 1 / 2, 1.000],\r\n    [-1 / 2, +1 / 2, +1 / 2, 1 / 2, 2 / 3],\r\n    [+1 / 2, +1 / 2, +1 / 2, 1 / 4, 2 / 3]\r\n], [\r\n    [+1 / 2, -1 / 2, +1 / 2, 1 / 4, 1 / 3],\r\n    [-1 / 2, -1 / 2, +1 / 2, 1 / 2, 1 / 3],\r\n    [-1 / 2, -1 / 2, -1 / 2, 1 / 2, 0.000],\r\n    [+1 / 2, -1 / 2, -1 / 2, 1 / 4, 0.000]\r\n]];\r\n\r\nconst CubeStripDef_Right: QuadPosUV[] = [[\r\n    [-1 / 2, +1 / 2, -1 / 2, 1 / 2, 1 / 3],\r\n    [+1 / 2, +1 / 2, -1 / 2, 1 / 2, 2 / 3],\r\n    [+1 / 2, -1 / 2, -1 / 2, 3 / 4, 2 / 3],\r\n    [-1 / 2, -1 / 2, -1 / 2, 3 / 4, 1 / 3]\r\n], [\r\n    [+1 / 2, +1 / 2, -1 / 2, 1 / 2, 2 / 3],\r\n    [+1 / 2, +1 / 2, +1 / 2, 1 / 2, 1.000],\r\n    [+1 / 2, -1 / 2, +1 / 2, 3 / 4, 1.000],\r\n    [+1 / 2, -1 / 2, -1 / 2, 3 / 4, 2 / 3]\r\n], [\r\n    [-1 / 2, +1 / 2, +1 / 2, 1 / 2, 0.000],\r\n    [-1 / 2, +1 / 2, -1 / 2, 1 / 2, 1 / 3],\r\n    [-1 / 2, -1 / 2, -1 / 2, 3 / 4, 1 / 3],\r\n    [-1 / 2, -1 / 2, +1 / 2, 3 / 4, 0.000]\r\n], [\r\n    [+1 / 2, +1 / 2, +1 / 2, 3 / 4, 2 / 3],\r\n    [-1 / 2, +1 / 2, +1 / 2, 1.000, 2 / 3],\r\n    [-1 / 2, -1 / 2, +1 / 2, 1.000, 1 / 3],\r\n    [+1 / 2, -1 / 2, +1 / 2, 3 / 4, 1 / 3]\r\n], [\r\n    [+1 / 2, +1 / 2, -1 / 2, 3 / 4, 1.000],\r\n    [-1 / 2, +1 / 2, -1 / 2, 1.000, 1.000],\r\n    [-1 / 2, +1 / 2, +1 / 2, 1.000, 2 / 3],\r\n    [+1 / 2, +1 / 2, +1 / 2, 3 / 4, 2 / 3]\r\n], [\r\n    [+1 / 2, -1 / 2, +1 / 2, 3 / 4, 1 / 3],\r\n    [-1 / 2, -1 / 2, +1 / 2, 1.000, 1 / 3],\r\n    [-1 / 2, -1 / 2, -1 / 2, 1.000, 0.000],\r\n    [+1 / 2, -1 / 2, -1 / 2, 3 / 4, 0.000]\r\n]];\r\n\r\nconst PlaneGeom_Left = createQuadGeometry(PlaneDef_Left);\r\nconst PlaneGeom_Right = createQuadGeometry(PlanDef_Right);\r\nconst PlaneGeom_Top = createQuadGeometry(rotQuad(PlaneDef_Left));\r\nconst PlaneGeom_Bottom = createQuadGeometry(rotQuad(PlanDef_Right));\r\n\r\nconst CubeStripDef_Top: QuadPosUV[] = rot(CubeStripDef_Left);\r\nconst CubeStripDef_Bottom: QuadPosUV[] = rot(CubeStripDef_Right);\r\n\r\nconst CubeStripGeom_Mono = createQuadGeometry(...CubeStripDef_Mono);\r\nconst CubeStripGeom_Left = createQuadGeometry(...CubeStripDef_Left);\r\nconst CubeStripGeom_Right = createQuadGeometry(...CubeStripDef_Right);\r\nconst CubeStripGeom_Top = createQuadGeometry(...CubeStripDef_Top);\r\nconst CubeStripGeom_Bottom = createQuadGeometry(...CubeStripDef_Bottom);\r\n\r\nconst EACSubDivisions = 4;\r\nconst EACGeom_Mono = createEACGeometry(EACSubDivisions, ...CubeStripDef_Mono);\r\nconst EACGeom_Left = createEACGeometry(EACSubDivisions, ...CubeStripDef_Left);\r\nconst EACGeom_Right = createEACGeometry(EACSubDivisions, ...CubeStripDef_Right);\r\nconst EACGeom_Top = createEACGeometry(EACSubDivisions, ...CubeStripDef_Top);\r\nconst EACGeom_Bottom = createEACGeometry(EACSubDivisions, ...CubeStripDef_Bottom);\r\n\r\nconst GeomPacks = new PriorityMap<SphereEncodingName, string, THREE.BufferGeometry>([\r\n    [\"N/A\", \"mono\", PlaneGeom_Mono],\r\n    [\"N/A\", \"left\", PlaneGeom_Left],\r\n    [\"N/A\", \"right\", PlaneGeom_Right],\r\n    [\"N/A\", \"top\", PlaneGeom_Top],\r\n    [\"N/A\", \"bottom\", PlaneGeom_Bottom],\r\n    [\"Cubemap Strips\", \"mono\", CubeStripGeom_Mono],\r\n    [\"Cubemap Strips\", \"left\", CubeStripGeom_Left],\r\n    [\"Cubemap Strips\", \"right\", CubeStripGeom_Right],\r\n    [\"Cubemap Strips\", \"top\", CubeStripGeom_Top],\r\n    [\"Cubemap Strips\", \"bottom\", CubeStripGeom_Bottom],\r\n    [\"Equi-Angular Cubemap (YouTube)\", \"mono\", EACGeom_Mono],\r\n    [\"Equi-Angular Cubemap (YouTube)\", \"left\", EACGeom_Left],\r\n    [\"Equi-Angular Cubemap (YouTube)\", \"right\", EACGeom_Right],\r\n    [\"Equi-Angular Cubemap (YouTube)\", \"top\", EACGeom_Top],\r\n    [\"Equi-Angular Cubemap (YouTube)\", \"bottom\", EACGeom_Bottom]\r\n]);\r\n\r\nfunction rotVert(vert: PosUV): PosUV {\r\n    return [vert[0], vert[1], vert[2], vert[4], 1 - vert[3]];\r\n}\r\n\r\nfunction rotQuad(quad: QuadPosUV): QuadPosUV {\r\n    return [\r\n        rotVert(quad[0]),\r\n        rotVert(quad[1]),\r\n        rotVert(quad[2]),\r\n        rotVert(quad[3])\r\n    ];\r\n}\r\n\r\nfunction rot(def: QuadPosUV[]): QuadPosUV[] {\r\n    return def.map<QuadPosUV>(rotQuad);\r\n}", "import { stringRandom } from \"@juniper-lib/tslib\";\r\n\r\nexport class MeshLabel extends THREE.Object3D {\r\n    private _disabled = false;\r\n\r\n    protected readonly enabledMesh: THREE.Mesh;\r\n    protected readonly disabledMesh: THREE.Mesh;\r\n\r\n    constructor(name: string, geometry: THREE.BufferGeometry, enabledMaterial: THREE.Material, disabledMaterial: THREE.Material, size: number) {\r\n        super();\r\n        const id = stringRandom(16);\r\n\r\n        this.name = name + id;\r\n\r\n        this.enabledMesh = this.createMesh(`${this.name}-enabled`, geometry, enabledMaterial);\r\n        this.disabledMesh = this.createMesh(`${this.name}-disabled`, geometry, disabledMaterial);\r\n        this.disabledMesh.visible = false;\r\n        this.size = size;\r\n        this.add(this.enabledMesh, this.disabledMesh);\r\n    }\r\n\r\n    get size(): number {\r\n        return this.enabledMesh.scale.x;\r\n    }\r\n\r\n    set size(v: number) {\r\n        this.enabledMesh.scale.setScalar(v);\r\n        this.disabledMesh.scale.setScalar(v);\r\n    }\r\n\r\n    private createMesh(id: string, geometry: THREE.BufferGeometry, material: THREE.Material) {\r\n        const mesh = new THREE.Mesh(geometry, material);\r\n        mesh.name = \"Mesh-\" + id;\r\n        return mesh;\r\n    }\r\n\r\n    get disabled(): boolean {\r\n        return this._disabled;\r\n    }\r\n\r\n    set disabled(v: boolean) {\r\n        if (v !== this.disabled) {\r\n            this._disabled = v;\r\n            this.enabledMesh.visible = !v;\r\n            this.disabledMesh.visible = v;\r\n        }\r\n    }\r\n}\r\n", "import { scaleOnHover } from \"./animation/scaleOnHover\";\r\nimport { makeRayTarget, RayTarget } from \"./eventSystem/RayTarget\";\r\nimport { MeshLabel } from \"./MeshLabel\";\r\n\r\nexport class MeshButton extends MeshLabel {\r\n    readonly target: RayTarget;\r\n\r\n    constructor(name: string, geometry: THREE.BufferGeometry, enabledMaterial: THREE.Material, disabledMaterial: THREE.Material, size: number) {\r\n        super(name, geometry, enabledMaterial, disabledMaterial, size);\r\n\r\n        this.target = makeRayTarget(this.enabledMesh);\r\n        this.target.clickable = true;\r\n        this.target.disabled = this.disabled;\r\n\r\n        scaleOnHover(this);\r\n    }\r\n\r\n    override get disabled() {\r\n        return super.disabled;\r\n    }\r\n\r\n    override set disabled(v) {\r\n        this.target.disabled = super.disabled = v;\r\n    }\r\n}", "import { title } from \"@juniper-lib/dom/attrs\";\r\nimport { ButtonPrimary, elementIsDisplayed, elementSetDisplay } from \"@juniper-lib/dom/tags\";\r\nimport { ButtonFactory } from \"../ButtonFactory\";\r\nimport { MeshButton } from \"../MeshButton\";\r\nimport { obj } from \"../objects\";\r\nimport type { Widget } from \"./widgets\";\r\n\r\nexport class ButtonImageWidget implements Widget, EventTarget {\r\n\r\n    readonly element: HTMLButtonElement;\r\n    readonly object: THREE.Object3D;\r\n    private mesh: MeshButton = null;\r\n\r\n    constructor(buttons: ButtonFactory, setName: string, iconName: string) {\r\n        this.element = ButtonPrimary(\r\n            title(iconName),\r\n            buttons.getImageElement(setName, iconName));\r\n\r\n        this.object = obj(`${name}-button`);\r\n        this.load(buttons, setName, iconName);\r\n    }\r\n\r\n    private async load(buttons: ButtonFactory, setName: string, iconName: string) {\r\n        const { geometry, enabledMaterial, disabledMaterial } = await buttons.getGeometryAndMaterials(setName, iconName);\r\n        this.mesh = new MeshButton(iconName, geometry, enabledMaterial, disabledMaterial, 0.2);\r\n        this.object.add(this.mesh);\r\n        this.mesh.visible = this.visible;\r\n        this.mesh.target.addEventListener(\"click\", () => {\r\n            this.element.click();\r\n        });\r\n    }\r\n\r\n    get name() {\r\n        return this.object.name;\r\n    }\r\n\r\n    addEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void {\r\n        this.element.addEventListener(type, listener, options);\r\n    }\r\n\r\n    dispatchEvent(event: Event): boolean {\r\n        return this.element.dispatchEvent(event);\r\n    }\r\n\r\n    removeEventListener(type: string, callback: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions): void {\r\n        this.element.removeEventListener(type, callback, options);\r\n    }\r\n\r\n    click() {\r\n        this.element.click();\r\n    }\r\n\r\n    get visible() {\r\n        return elementIsDisplayed(this);\r\n    }\r\n\r\n    set visible(visible) {\r\n        elementSetDisplay(this, visible, \"inline-block\");\r\n        if (this.mesh) {\r\n            this.mesh.visible = visible;\r\n        }\r\n    }\r\n}\r\n", "import type { CanvasImage } from \"@juniper-lib/graphics2d/CanvasImage\";\r\nimport { isHTMLCanvas } from \"@juniper-lib/dom/canvas\";\r\nimport { elementIsDisplayed, elementSetDisplay } from \"@juniper-lib/dom/tags\";\r\nimport { Image2DMesh } from \"../Image2DMesh\";\r\nimport { IWebXRLayerManager } from \"../IWebXRLayerManager\";\r\nimport { objectSetVisible } from \"../objects\";\r\nimport type { Widget } from \"./widgets\";\r\n\r\n\r\nexport class CanvasImageMesh<T extends CanvasImage>\r\n    extends Image2DMesh\r\n    implements Widget {\r\n\r\n    get object() {\r\n        return this;\r\n    }\r\n\r\n    constructor(env: IWebXRLayerManager, name: string, public image: T) {\r\n        super(env, name, false);\r\n\r\n        if (this.mesh) {\r\n            this.setImage(image);\r\n        }\r\n    }\r\n\r\n    private setImage(image: T): void {\r\n        this.mesh.setImage(image.canvas);\r\n        this.mesh.objectHeight = 0.1;\r\n        this.mesh.updateTexture();\r\n        image.addEventListener(\"redrawn\", () => this.mesh.updateTexture());\r\n    }\r\n\r\n    override copy(source: this, recursive = true): this {\r\n        super.copy(source, recursive);\r\n        this.setImage(source.image);\r\n        return this;\r\n    }\r\n\r\n    get element() {\r\n        if (isHTMLCanvas(this.image.canvas)) {\r\n            return this.image.canvas;\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    get isVisible() {\r\n        return elementIsDisplayed(this);\r\n    }\r\n\r\n    set isVisible(v) {\r\n        elementSetDisplay(this, v, \"inline-block\");\r\n        objectSetVisible(this, v);\r\n        objectSetVisible(this.mesh, v);\r\n        this.image.visible = v;\r\n    }\r\n}\r\n", "import { isDefined } from \"@juniper-lib/tslib\";\r\n\r\nexport function elementSetClass(elem: HTMLElement, enabled: boolean, className: string) {\r\n    const canEnable = isDefined(className);\r\n    const hasEnabled = canEnable && elem.classList.contains(className);\r\n\r\n    if (canEnable && hasEnabled !== enabled) {\r\n        if (enabled) {\r\n            elem.classList.add(className);\r\n        }\r\n        else {\r\n            elem.classList.remove(className);\r\n        }\r\n    }\r\n}\r\n", "import { isString } from \"@juniper-lib/tslib\";\r\nimport { elementSetClass } from \"./elementSetClass\";\r\nimport { Elements, elementSetText, isDisableable, isErsatzElement } from \"./tags\";\r\n\r\nconst types = [\r\n    \"danger\",\r\n    \"dark\",\r\n    \"info\",\r\n    \"light\",\r\n    \"primary\",\r\n    \"secondary\",\r\n    \"success\",\r\n    \"warning\"\r\n];\r\n\r\nexport function buttonSetEnabled(button: Elements, enabled: boolean, btnType?: string, label?: string) {\r\n    if (isErsatzElement(button)) {\r\n        button = button.element;\r\n    }\r\n\r\n    if (isString(btnType)) {\r\n        for (const type of types) {\r\n            elementSetClass(button, enabled && type === btnType, `btn-${type}`);\r\n            elementSetClass(button, !enabled && type === btnType, `btn-outline-${type}`);\r\n        }\r\n    }\r\n\r\n    if (isDisableable(button)) {\r\n        button.disabled = !enabled;\r\n    }\r\n\r\n    if (label) {\r\n        elementSetText(button, label);\r\n    }\r\n}\r\n", "import { buttonSetEnabled } from \"@juniper-lib/dom/buttonSetEnabled\";\r\nimport { ButtonPrimary, elementSetDisplay, Img } from \"@juniper-lib/dom/tags\";\r\nimport { ButtonFactory } from \"../ButtonFactory\";\r\nimport { MeshButton } from \"../MeshButton\";\r\nimport { obj, objectSetEnabled, objectSetVisible, objGraph } from \"../objects\";\r\nimport type { Widget } from \"./widgets\";\r\n\r\n\r\nexport class ToggleButton implements Widget, EventTarget {\r\n\r\n    readonly element: HTMLButtonElement;\r\n    readonly object: THREE.Object3D;\r\n    private enterButton: MeshButton = null;\r\n    private exitButton: MeshButton = null;\r\n\r\n    get name() {\r\n        return this.object.name;\r\n    }\r\n\r\n    addEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void {\r\n        this.element.addEventListener(type, listener, options);\r\n    }\r\n\r\n    dispatchEvent(event: Event): boolean {\r\n        return this.element.dispatchEvent(event);\r\n    }\r\n\r\n    removeEventListener(type: string, callback: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions): void {\r\n        this.element.removeEventListener(type, callback, options);\r\n    }\r\n\r\n    click() {\r\n        this.element.click();\r\n    }\r\n\r\n    private readonly btnImage: HTMLImageElement;\r\n    private _isAvailable = true;\r\n    private _isEnabled = true;\r\n    private _isVisible = true;\r\n    private _isActive = false;\r\n\r\n    constructor(\r\n        private readonly buttons: ButtonFactory,\r\n        private readonly setName: string,\r\n        private readonly activeName: string,\r\n        private readonly inactiveName: string) {\r\n        this.element = ButtonPrimary(\r\n            this.btnImage = Img());\r\n\r\n        this.object = obj(`${this.setName}-button`);\r\n        this.load();\r\n    }\r\n\r\n    private async load() {\r\n        const [activate, deactivate] = await Promise.all([\r\n            this.buttons.getGeometryAndMaterials(this.setName, this.activeName),\r\n            this.buttons.getGeometryAndMaterials(this.setName, this.inactiveName)\r\n        ]);\r\n\r\n        objGraph(this.object,\r\n            this.enterButton = new MeshButton(`${this.setName}-activate-button`, activate.geometry, activate.enabledMaterial, activate.disabledMaterial, 0.2),\r\n            this.exitButton = new MeshButton(`${this.setName}-deactivate-button`, deactivate.geometry, deactivate.enabledMaterial, deactivate.disabledMaterial, 0.2));\r\n\r\n        this.enterButton.target.addEventListener(\"click\", () => this.element.click());\r\n\r\n        this.exitButton.target.addEventListener(\"click\", () => this.element.click());\r\n\r\n        this.refreshState();\r\n    }\r\n\r\n    get mesh() {\r\n        return this.active\r\n            ? this.enterButton\r\n            : this.exitButton;\r\n    }\r\n\r\n    get available(): boolean {\r\n        return this._isAvailable;\r\n    }\r\n\r\n    set available(v: boolean) {\r\n        this._isAvailable = v;\r\n        this.refreshState();\r\n    }\r\n\r\n    get active(): boolean {\r\n        return this._isActive;\r\n    }\r\n\r\n    set active(v: boolean) {\r\n        this._isActive = v;\r\n        this.refreshState();\r\n    }\r\n\r\n    get enabled(): boolean {\r\n        return this._isEnabled;\r\n    }\r\n\r\n    set enabled(v: boolean) {\r\n        this._isEnabled = v;\r\n        this.refreshState();\r\n    }\r\n\r\n    get visible(): boolean {\r\n        return this._isVisible;\r\n    }\r\n\r\n    set visible(v: boolean) {\r\n        this._isVisible = v;\r\n        this.refreshState();\r\n    }\r\n\r\n    private refreshState() {\r\n        const type = this.active\r\n            ? this.inactiveName\r\n            : this.activeName;\r\n        const text = `${type} ${this.setName}`;\r\n        this.element.title\r\n            = this.btnImage.title\r\n            = text;\r\n        this.btnImage.src = this.buttons.getImageSrc(this.setName, type);\r\n\r\n        buttonSetEnabled(this, this.available && this.visible && this.enabled, \"primary\");\r\n        elementSetDisplay(this, this.available && this.visible, \"inline-block\");\r\n\r\n        if (this.enterButton && this.exitButton) {\r\n            objectSetEnabled(this, this.available && this.visible && this.enabled);\r\n            const visible = objectSetVisible(this.object, this.available && this.visible);\r\n            objectSetVisible(this.enterButton, visible && !this.active);\r\n            objectSetVisible(this.exitButton, visible && this.active);\r\n        }\r\n    }\r\n}\r\n", "import { ButtonFactory } from \"../ButtonFactory\";\r\nimport { ScreenMode } from \"../ScreenMode\";\r\nimport { ToggleButton } from \"./ToggleButton\";\r\n\r\nexport class ScreenModeToggleButton extends ToggleButton {\r\n    constructor(buttons: ButtonFactory, public readonly mode: ScreenMode) {\r\n        const name = ScreenMode[mode];\r\n        super(buttons, name.toLowerCase(), \"enter\", \"exit\");\r\n    }\r\n}\r\n", "import { buttonSetEnabled } from \"@juniper-lib/dom/buttonSetEnabled\";\r\nimport type { ElementChild, ErsatzElement } from \"@juniper-lib/dom/tags\";\r\nimport {\r\n    elementApply,\r\n    elementClearChildren,\r\n    isElementChild,\r\n    isErsatzElement\r\n} from \"@juniper-lib/dom/tags\";\r\nimport type { ErsatzObject, Objects } from \"../objects\";\r\nimport {\r\n    isErsatzObject,\r\n    isObjects,\r\n    objectClearChildren,\r\n    objectSetEnabled,\r\n    objGraph\r\n} from \"../objects\";\r\n\r\nexport interface Widget extends ErsatzElement, ErsatzObject {\r\n    name: string;\r\n    visible: boolean;\r\n}\r\n\r\nexport function isWidget(obj: any): obj is Widget {\r\n    return isErsatzElement(obj)\r\n        && isErsatzObject(obj);\r\n}\r\n\r\nexport type WidgetChild = Widget\r\n    | ElementChild\r\n    | Objects;\r\n\r\nexport function widgetSetEnabled(obj: Widget, enabled: boolean, buttonType: string) {\r\n    if (obj.element instanceof HTMLButtonElement) {\r\n        buttonSetEnabled(obj, enabled, buttonType);\r\n    }\r\n\r\n    objectSetEnabled(obj, enabled);\r\n}\r\n\r\nexport function widgetApply(obj: Widget, ...children: WidgetChild[]) {\r\n    elementApply(obj, ...children.filter(isElementChild));\r\n    objGraph(obj, ...children.filter(isObjects));\r\n}\r\n\r\nexport function widgetClearChildren(obj: Widget) {\r\n    elementClearChildren(obj.element);\r\n    objectClearChildren(obj.object);\r\n}\r\n\r\n", "import { IProgress, isDefined, progressPopper, progressSplitWeighted, TypedEvent, TypedEventBase } from \"@juniper-lib/tslib\";\r\nimport type { Application, ApplicationConstructor, ApplicationModule } from \"./Application\";\r\nimport type { Environment } from \"./Environment\";\r\n\r\nclass ApplicationLoaderEvent<T extends string> extends TypedEvent<T> {\r\n    constructor(type: T, public readonly appName: string) {\r\n        super(type);\r\n    }\r\n}\r\n\r\nexport class ApplicationLoaderAppLoadingEvent extends ApplicationLoaderEvent<\"apploading\"> {\r\n\r\n    public preLoadTask: Promise<any> = null;\r\n\r\n    constructor(appName: string, public readonly appLoadParams: Map<string, unknown>) {\r\n        super(\"apploading\", appName);\r\n    }\r\n}\r\n\r\nexport class ApplicationLoaderAppLoadedEvent extends ApplicationLoaderEvent<\"apploaded\"> {\r\n    constructor(appName: string, public readonly app: Application) {\r\n        super(\"apploaded\", appName);\r\n    }\r\n}\r\n\r\nexport class ApplicationLoaderAppShownEvent extends ApplicationLoaderEvent<\"appshown\"> {\r\n    constructor(appName: string, public readonly app: Application) {\r\n        super(\"appshown\", appName);\r\n    }\r\n}\r\n\r\ntype LoadApp<T extends Application> = (name: string, params: Map<string, unknown>, prog?: IProgress) => Promise<T>;\r\n\r\nclass ApplicationLoadRequest<T extends Application> {\r\n\r\n    private readonly params = new Map<string, unknown>();\r\n\r\n    constructor(private readonly loader: LoadApp<T>, private readonly name: string) {\r\n\r\n    }\r\n\r\n    param(name: string, value: unknown) {\r\n        this.params.set(name, value);\r\n        return this;\r\n    }\r\n\r\n    load(prog?: IProgress) {\r\n        return this.loader(this.name, this.params, prog);\r\n    }\r\n}\r\n\r\ninterface ApplicationLoaderEvents {\r\n    apploading: ApplicationLoaderAppLoadingEvent;\r\n    apploaded: ApplicationLoaderAppLoadedEvent;\r\n    appshown: ApplicationLoaderAppShownEvent;\r\n}\r\n\r\nexport class ApplicationLoader\r\n    extends TypedEventBase<ApplicationLoaderEvents>\r\n    implements Iterable<Application> {\r\n    private readonly loadedModules = new Map<string, Promise<ApplicationModule>>();\r\n    private readonly loadingApps = new Map<string, Promise<Application>>();\r\n    private readonly currentApps = new Map<string, Application>();\r\n\r\n    cacheBustString: string = null;\r\n\r\n    constructor(private readonly env: Environment, private readonly JS_EXT: string) {\r\n        super();\r\n    }\r\n\r\n    [Symbol.iterator](): IterableIterator<Application> {\r\n        return this.currentApps.values();\r\n    }\r\n\r\n    isLoaded(name: string): boolean {\r\n        return this.currentApps.has(name);\r\n    }\r\n\r\n    get<T extends Application>(name: string): T {\r\n        return this.currentApps.get(name) as T;\r\n    }\r\n\r\n    private async loadAppConstructor(name: string, prog?: IProgress): Promise<ApplicationConstructor> {\r\n        if (!this.loadedModules.has(name)) {\r\n\r\n            let url = `/js/${name}/index${this.JS_EXT}`;\r\n            if (isDefined(this.cacheBustString)) {\r\n                url += \"#\" + this.cacheBustString;\r\n            }\r\n\r\n            const task = this.env.fetcher\r\n                .get(url)\r\n                .progress(prog)\r\n                .module<ApplicationModule>();\r\n\r\n            this.loadedModules.set(name, task);\r\n        }\r\n        else if (isDefined(prog)) {\r\n            prog.end();\r\n        }\r\n\r\n        const { default: AppConstructor } = await this.loadedModules.get(name);\r\n        return AppConstructor;\r\n    }\r\n\r\n    app<T extends Application>(name: string) {\r\n        return new ApplicationLoadRequest<T>(this.loadApp.bind(this), name);\r\n    }\r\n\r\n    private loadApp<T extends Application>(name: string, params: Map<string, unknown>, prog?: IProgress): Promise<T>;\r\n    private loadApp<T extends Application>(name: string, prog?: IProgress): Promise<T>;\r\n    private loadApp<T extends Application>(name: string, paramsOrProg: Map<string, unknown> | IProgress, prog?: IProgress): Promise<T> {\r\n        let params: Map<string, unknown> = null;\r\n        if (paramsOrProg instanceof Map) {\r\n            params = paramsOrProg;\r\n        }\r\n        else {\r\n            prog = paramsOrProg;\r\n        }\r\n\r\n        prog = prog || this.env.loadingBar;\r\n\r\n        const evt = new ApplicationLoaderAppLoadingEvent(name, params);\r\n        this.dispatchEvent(evt);\r\n\r\n        const preLoadTask = evt.preLoadTask || Promise.resolve();\r\n\r\n        if (!this.loadingApps.has(name)) {\r\n            const progs = progressPopper(prog);\r\n            const appTask = preLoadTask.then(() =>\r\n                this.loadAppInstance<T>(this.env, name, params, progs.pop(10)));\r\n            this.loadingApps.set(name, appTask);\r\n            prog = progs.pop(1);\r\n        }\r\n\r\n        const appTask = this.loadingApps.get(name) as Promise<T>;\r\n        return appTask\r\n            .then(async (app) => {\r\n                await app.show(prog);\r\n                this.dispatchEvent(new ApplicationLoaderAppShownEvent(name, app));\r\n                return app;\r\n            });\r\n    }\r\n\r\n    private async loadAppInstance<T extends Application>(env: Environment, name: string, params: Map<string, unknown>, prog?: IProgress): Promise<T> {\r\n        if (!this.currentApps.has(name)) {\r\n            const [appLoad, assetLoad] = progressSplitWeighted(prog, [1, 10]);\r\n            const App = await this.loadAppConstructor(name, appLoad);\r\n            const app = new App(env);\r\n\r\n            app.addEventListener(\"quit\", () =>\r\n                this.unloadApp(name));\r\n\r\n            if (isDefined(params)) {\r\n                await app.init(params);\r\n            }\r\n\r\n            await app.load(assetLoad);\r\n            this.currentApps.set(name, app);\r\n\r\n            this.dispatchEvent(new ApplicationLoaderAppLoadedEvent(name, app));\r\n        }\r\n\r\n        if (isDefined(prog)) {\r\n            prog.end();\r\n        }\r\n\r\n        return this.currentApps.get(name) as T;\r\n    }\r\n\r\n    private unloadApp(name: string) {\r\n        const app = this.currentApps.get(name);\r\n        app.clearEventListeners();\r\n        app.dispose();\r\n        this.currentApps.delete(name);\r\n        this.loadingApps.delete(name);\r\n    }\r\n}", "import { angleClamp } from \"@juniper-lib/tslib\";\r\n\r\nconst D = new THREE.Vector3();\r\n\r\nexport function getLookHeading(dir: THREE.Vector3) {\r\n    D.copy(dir);\r\n    D.y = 0;\r\n    D.normalize();\r\n    return angleClamp(Math.atan2(D.x, D.z));\r\n}\r\n\r\nexport function getLookPitch(dir: THREE.Vector3) {\r\n    return angleClamp(Math.asin(dir.y));\r\n}", "import { deg2rad } from \"@juniper-lib/tslib\";\r\nimport { getLookHeading } from \"./lookAngles\";\r\n\r\nconst targetPos = new THREE.Vector3();\r\nlet targetAngle = 0;\r\nconst dPos = new THREE.Vector3();\r\n\r\nconst curPos = new THREE.Vector3();\r\nconst curDir = new THREE.Vector3();\r\nconst dQuat = new THREE.Quaternion();\r\nlet curAngle = 0;\r\nlet copyCounter = 0;\r\n\r\nfunction minRotAngle(to: number, from: number) {\r\n    const a = to - from;\r\n    const b = a + 2 * Math.PI;\r\n    const c = a - 2 * Math.PI;\r\n    const A = Math.abs(a);\r\n    const B = Math.abs(b);\r\n    const C = Math.abs(c);\r\n    if (A < B && A < C) {\r\n        return a;\r\n    }\r\n    else if (B < C) {\r\n        return b;\r\n    }\r\n    else {\r\n        return c;\r\n    }\r\n}\r\n\r\nexport class BodyFollower extends THREE.Object3D {\r\n    private lerp: boolean;\r\n    private maxDistance: number;\r\n    private minAngle: number;\r\n    private maxAngle: number;\r\n\r\n    constructor(name: string,\r\n        private readonly minDistance: number,\r\n        minAngle: number,\r\n        private readonly heightOffset: number,\r\n        private readonly speed = 1) {\r\n        super();\r\n\r\n        this.name = name;\r\n        this.lerp = this.minAngle > 0\r\n            || this.minDistance > 0;\r\n\r\n        this.maxDistance = this.minDistance * 5;\r\n        this.minAngle = deg2rad(minAngle);\r\n        this.maxAngle = Math.PI - this.minAngle;\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    override copy(source: this, recursive = true): this {\r\n        super.copy(source, recursive);\r\n        this.name = source.name + (++copyCounter);\r\n        this.lerp = source.lerp;\r\n        this.maxDistance = source.maxDistance;\r\n        this.minAngle = source.minAngle;\r\n        this.maxAngle = source.maxAngle;\r\n        return this;\r\n    }\r\n\r\n    update(height: number, position: THREE.Vector3, angle: number, dt: number) {\r\n        dt *= 0.001;\r\n        this.clampTo(this.lerp, height, position, this.minDistance, this.maxDistance, angle, this.minAngle, this.maxAngle, dt);\r\n    }\r\n\r\n    reset(height: number, position: THREE.Vector3, angle: number) {\r\n        this.clampTo(false, height, position, 0, 0, angle, 0, 0, 0);\r\n    }\r\n\r\n    private clampTo(\r\n        lerp: boolean,\r\n        height: number,\r\n        position: THREE.Vector3,\r\n        minDistance: number,\r\n        maxDistance: number,\r\n        angle: number,\r\n        minAngle: number,\r\n        maxAngle: number,\r\n        dt: number) {\r\n        targetPos.copy(position);\r\n        targetPos.y -= this.heightOffset * height;\r\n        targetAngle = angle;\r\n\r\n        this.getWorldPosition(curPos);\r\n        this.getWorldDirection(curDir);\r\n        curAngle = getLookHeading(curDir);\r\n        dQuat.identity();\r\n\r\n        let setPos = !lerp;\r\n        let setRot = !lerp;\r\n        if (lerp) {\r\n            const dist = dPos.copy(targetPos)\r\n                .sub(curPos)\r\n                .length();\r\n\r\n            if (minDistance < dist) {\r\n                if (dist < maxDistance) {\r\n                    targetPos.lerpVectors(curPos, targetPos, this.speed * dt);\r\n                }\r\n                setPos = true;\r\n            }\r\n\r\n            const dAngle = minRotAngle(targetAngle, curAngle);\r\n            const mAngle = Math.abs(dAngle);\r\n            if (minAngle < mAngle) {\r\n                if (mAngle < maxAngle) {\r\n                    dQuat.setFromAxisAngle(this.up, dAngle * this.speed * dt);\r\n                }\r\n                else {\r\n                    dQuat.setFromAxisAngle(this.up, dAngle);\r\n                }\r\n                setRot = true;\r\n            }\r\n        }\r\n\r\n        if (setPos || setRot) {\r\n\r\n            if (setPos) {\r\n                this.position.add(targetPos\r\n                    .sub(curPos));\r\n            }\r\n\r\n            if (setRot) {\r\n                this.quaternion.multiply(dQuat);\r\n            }\r\n        }\r\n    }\r\n}", "import { BaseProgress, IProgress, isFunction } from \"@juniper-lib/tslib\";\r\nimport { elementApply, IElementAppliable } from \"./tags\";\r\n\r\ntype EventListenerOpts = boolean | AddEventListenerOptions;\r\n\r\nexport function isModifierless(evt: KeyboardEvent | MouseEvent | PointerEvent) {\r\n    return !(evt.shiftKey || evt.altKey || evt.ctrlKey || evt.metaKey);\r\n}\r\n\r\nexport function makeEnterKeyEventHandler(callback: (evt: KeyboardEvent) => void) {\r\n    return (ev: Event) => {\r\n        const evt = ev as KeyboardEvent;\r\n        if (isModifierless(evt)\r\n            && evt.key === \"Enter\") {\r\n            callback(evt);\r\n        }\r\n    };\r\n}\r\n\r\n\r\nclass HTMLProgressCallback extends BaseProgress {\r\n    constructor(private readonly element: HTMLProgressElement) {\r\n        super();\r\n    }\r\n\r\n    override report(soFar: number, total: number, message?: string, est?: number) {\r\n        super.report(soFar, total, message, est);\r\n        this.element.max = total;\r\n        this.element.value = soFar;\r\n    }\r\n}\r\n\r\nexport function makeProgress(element: HTMLProgressElement): IProgress {\r\n    return new HTMLProgressCallback(element);\r\n}\r\n\r\n/**\r\n * A setter functor for HTML element events.\r\n **/\r\nexport class HtmlEvt<T extends Event>\r\n    implements IElementAppliable {\r\n    opts?: EventListenerOpts;\r\n\r\n    /**\r\n     * Creates a new setter functor for an HTML element event.\r\n     * @param name - the name of the event to attach to.\r\n     * @param callback - the callback function to use with the event handler.\r\n     * @param opts - additional attach options.\r\n     */\r\n    constructor(name: keyof DocumentEventMap, callback: (evt: T) => void, opts?: EventListenerOpts);\r\n    constructor(name: keyof HTMLBodyElementEventMap, callback: (evt: T) => void, opts?: EventListenerOpts);\r\n    constructor(name: keyof HTMLElementEventMap, callback: (evt: T) => void, opts?: EventListenerOpts);\r\n    constructor(name: keyof GlobalEventHandlersEventMap, callback: (evt: T) => void, opts?: EventListenerOpts);\r\n    constructor(public name: string, public callback: (evt: T) => void, opts?: EventListenerOpts) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"A function instance is required for this parameter\");\r\n        }\r\n\r\n        this.opts = opts;\r\n        Object.freeze(this);\r\n    }\r\n\r\n    applyToElement(elem: HTMLElement) {\r\n        this.add(elem);\r\n    }\r\n\r\n    /**\r\n     * Add the encapsulate callback as an event listener to the give HTMLElement\r\n     */\r\n    add(elem: HTMLElement) {\r\n        elem.addEventListener(this.name, this.callback as EventListenerOrEventListenerObject, this.opts);\r\n    }\r\n\r\n    /**\r\n     * Remove the encapsulate callback as an event listener from the give HTMLElement\r\n     */\r\n    remove(elem: HTMLElement) {\r\n        elem.removeEventListener(this.name, this.callback as EventListenerOrEventListenerObject);\r\n    }\r\n}\r\n\r\n\r\nexport function onAbort(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"abort\", callback, opts); }\r\nexport function onAfterPrint(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"afterprint\", callback, opts); }\r\nexport function onAnimationCancel(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"animationcancel\", callback, opts); }\r\nexport function onAnimationEnd(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"animationend\", callback, opts); }\r\nexport function onAnimationIteration(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"animationiteration\", callback, opts); }\r\nexport function onAnimationStart(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"animationstart\", callback, opts); }\r\nexport function onAuxClick(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"auxclick\", callback, opts); }\r\nexport function onBeforeInput(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"beforeinput\", callback, opts); }\r\nexport function onBeforePrint(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"beforeprint\", callback, opts); }\r\nexport function onBeforeUnload(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"beforeunload\", callback, opts); }\r\nexport function onBlur(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"blur\", callback, opts); }\r\nexport function onCanPlay(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"canplay\", callback, opts); }\r\nexport function onCanPlayThrough(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"canplaythrough\", callback, opts); }\r\nexport function onChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"change\", callback, opts); }\r\nexport function onClick(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"click\", callback, opts); }\r\nexport function onClose(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"close\", callback, opts); }\r\nexport function onCompositionEnd(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"compositionend\", callback, opts); }\r\nexport function onCompositionStart(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"compositionstart\", callback, opts); }\r\nexport function onCompositionUpdate(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"compositionupdate\", callback, opts); }\r\nexport function onContextMenu(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"contextmenu\", callback, opts); }\r\nexport function onCopy(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"copy\", callback, opts); }\r\nexport function onCut(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"cut\", callback, opts); }\r\nexport function onDblClick(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"dblclick\", callback, opts); }\r\nexport function onDrag(callback: (evt: DragEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"drag\", callback, opts); }\r\nexport function onDragEnd(callback: (evt: DragEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"dragend\", callback, opts); }\r\nexport function onDragEnter(callback: (evt: DragEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"dragenter\", callback, opts); }\r\nexport function onDragLeave(callback: (evt: DragEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"dragleave\", callback, opts); }\r\nexport function onDragOver(callback: (evt: DragEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"dragover\", callback, opts); }\r\nexport function onDragStart(callback: (evt: DragEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"dragstart\", callback, opts); }\r\nexport function onDrop(callback: (evt: DragEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"drop\", callback, opts); }\r\nexport function onDurationChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"durationchange\", callback, opts); }\r\nexport function onEmptied(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"emptied\", callback, opts); }\r\nexport function onEnded(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"ended\", callback, opts); }\r\nexport function onError(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"error\", callback, opts); }\r\nexport function onFocus(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"focus\", callback, opts); }\r\nexport function onFocusIn(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"focusin\", callback, opts); }\r\nexport function onFocusOut(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"focusout\", callback, opts); }\r\nexport function onFullScreenChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"fullscreenchange\", callback, opts); }\r\nexport function onFullScreenError(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"fullscreenerror\", callback, opts); }\r\nexport function onGamepadConnected(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"gamepadconnected\", callback, opts); }\r\nexport function onGamepadDisconnected(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"gamepaddisconnected\", callback, opts); }\r\nexport function onGotPointerCapture(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"gotpointercapture\", callback, opts); }\r\nexport function onHashChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"hashchange\", callback, opts); }\r\nexport function onLostPointerCapture(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"lostpointercapture\", callback, opts); }\r\nexport function onInput(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"input\", callback, opts); }\r\nexport function onInvalid(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"invalid\", callback, opts); }\r\nexport function onKeyDown(callback: (evt: KeyboardEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"keydown\", callback, opts); }\r\nexport function onKeyPress(callback: (evt: KeyboardEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"keypress\", callback, opts); }\r\nexport function onKeyUp(callback: (evt: KeyboardEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"keyup\", callback, opts); }\r\nexport function onEnterKeyPressed(callback: (evt: KeyboardEvent) => void, opts?: EventListenerOpts) {\r\n    return onKeyUp((evt) => {\r\n        if (evt.key === \"Enter\") {\r\n            callback(evt);\r\n        }\r\n    }, opts);\r\n}\r\nexport function onLanguageChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"languagechange\", callback, opts); }\r\nexport function onLoad(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"load\", callback, opts); }\r\nexport function onLoadedData(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"loadeddata\", callback, opts); }\r\nexport function onLoadedMetadata(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"loadedmetadata\", callback, opts); }\r\nexport function onLoadStart(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"loadstart\", callback, opts); }\r\nexport function onMessage(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"message\", callback, opts); }\r\nexport function onMessageError(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"messageerror\", callback, opts); }\r\nexport function onMouseDown(callback: (evt: MouseEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"mousedown\", callback, opts); }\r\nexport function onMouseEnter(callback: (evt: MouseEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"mouseenter\", callback, opts); }\r\nexport function onMouseLeave(callback: (evt: MouseEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"mouseleave\", callback, opts); }\r\nexport function onMouseMove(callback: (evt: MouseEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"mousemove\", callback, opts); }\r\nexport function onMouseOut(callback: (evt: MouseEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"mouseout\", callback, opts); }\r\nexport function onMouseOver(callback: (evt: MouseEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"mouseover\", callback, opts); }\r\nexport function onMouseUp(callback: (evt: MouseEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"mouseup\", callback, opts); }\r\nexport function onOffline(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"offline\", callback, opts); }\r\nexport function onOnline(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"online\", callback, opts); }\r\nexport function onOrientationChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"orientationchange\", callback, opts); }\r\nexport function onPageHide(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pagehide\", callback, opts); }\r\nexport function onPageShow(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pageshow\", callback, opts); }\r\nexport function onPaste(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"paste\", callback, opts); }\r\nexport function onPause(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pause\", callback, opts); }\r\nexport function onPointerCancel(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointercancel\", callback, opts); }\r\nexport function onPointerDown(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointerdown\", callback, opts); }\r\nexport function onPointerEnter(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointerenter\", callback, opts); }\r\nexport function onPointerLeave(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointerleave\", callback, opts); }\r\nexport function onPointerLockChange(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointerlockchange\", callback, opts); }\r\nexport function onPointerLockError(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointerlockerror\", callback, opts); }\r\nexport function onPointerMove(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointermove\", callback, opts); }\r\nexport function onPointerOut(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointerout\", callback, opts); }\r\nexport function onPointerOver(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointerover\", callback, opts); }\r\nexport function onPointerUp(callback: (evt: PointerEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"pointerup\", callback, opts); }\r\nexport function onPlay(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"play\", callback, opts); }\r\nexport function onPlaying(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"playing\", callback, opts); }\r\nexport function onPopstate(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"popstate\", callback, opts); }\r\nexport function onProgress(callback: (evt: ProgressEvent) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"progress\", (evt) => callback(evt as ProgressEvent), opts); }\r\nexport function onProgressCallback(prog: IProgress) {\r\n    return onProgress((evt) => prog.report(evt.loaded || 0, evt.total || 1));\r\n}\r\nexport function onRatechange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"ratechange\", callback, opts); }\r\nexport function onReadystatechange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"readystatechange\", callback, opts); }\r\nexport function onReset(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"reset\", callback, opts); }\r\nexport function onResize(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"resize\", callback, opts); }\r\nexport function onScroll(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"scroll\", callback, opts); }\r\nexport function onSeeked(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"seeked\", callback, opts); }\r\nexport function onSeeking(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"seeking\", callback, opts); }\r\nexport function onSelect(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"select\", callback, opts); }\r\nexport function onSelectStart(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"selectstart\", callback, opts); }\r\nexport function onSelectionChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"selectionchange\", callback, opts); }\r\nexport function onSlotChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"slotchange\", callback, opts); }\r\nexport function onStalled(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"stalled\", callback, opts); }\r\nexport function onStorage(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"storage\", callback, opts); }\r\nexport function onSubmit(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"submit\", callback, opts); }\r\nexport function onSuspend(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"suspend\", callback, opts); }\r\nexport function onTimeUpdate(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"timeupdate\", callback, opts); }\r\nexport function onTouchCancel(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"touchcancel\", callback, opts); }\r\nexport function onTouchEnd(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"touchend\", callback, opts); }\r\nexport function onTouchMove(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"touchmove\", callback, opts); }\r\nexport function onTouchStart(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"touchstart\", callback, opts); }\r\nexport function onTransitionEnd(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"transitionend\", callback, opts); }\r\nexport function onUnload(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"unload\", callback, opts); }\r\nexport function onVisibilityChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"visibilitychange\", callback, opts); }\r\nexport function onVolumeChange(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"volumechange\", callback, opts); }\r\nexport function onWaiting(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"waiting\", callback, opts); }\r\nexport function onWheel(callback: (evt: Event) => void, opts?: EventListenerOpts) { return new HtmlEvt(\"wheel\", callback, opts); }\r\n\r\nexport function applyFakeProgress(file: string, elem: HTMLElement, prog: IProgress): void {\r\n    if (prog) {\r\n        elementApply(elem,\r\n            onProgressCallback(prog),\r\n            onLoadStart(() => prog.start(`${file} loading`)),\r\n            onLoad(() => prog.end(`${file} loaded`))\r\n        );\r\n    }\r\n}", "import { TypedEvent } from \"@juniper-lib/tslib\";\r\nimport { PointerName } from \"@juniper-lib/tslib/events/PointerName\";\r\n\r\nexport class AvatarMovedEvent extends TypedEvent<\"avatarmoved\"> {\r\n    px = 0;\r\n    py = 0;\r\n    pz = 0;\r\n    fx = 0;\r\n    fy = 0;\r\n    fz = 0;\r\n    ux = 0;\r\n    uy = 0;\r\n    uz = 0;\r\n    height = 0;\r\n\r\n    public readonly name: PointerName = PointerName.LocalUser;\r\n\r\n    constructor() {\r\n        super(\"avatarmoved\");\r\n    }\r\n\r\n    set(px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number, height: number) {\r\n        this.px = px;\r\n        this.py = py;\r\n        this.pz = pz;\r\n        this.fx = fx;\r\n        this.fy = fy;\r\n        this.fz = fz;\r\n        this.ux = ux;\r\n        this.uy = uy;\r\n        this.uz = uz;\r\n        this.height = height;\r\n    }\r\n}\r\n", "export function resolveCamera(renderer: THREE.WebGLRenderer, camera: THREE.PerspectiveCamera): THREE.Camera {\r\n    if (renderer.xr.isPresenting) {\r\n        return renderer.xr.getCamera();\r\n    }\r\n    else {\r\n        return camera;\r\n    }\r\n}\r\n", "export function setRightUpFwdPosFromMatrix(matrix: THREE.Matrix4, R: THREE.Vector3, U: THREE.Vector3, F: THREE.Vector3, P: THREE.Vector3) {\r\n    const m = matrix.elements;\r\n    R.set(m[0], m[1], m[2]);\r\n    U.set(m[4], m[5], m[6]);\r\n    F.set(-m[8], -m[9], -m[10]);\r\n    P.set(m[12], m[13], m[14]);\r\n    R.normalize();\r\n    U.normalize();\r\n    F.normalize();\r\n}", "import { isModifierless } from \"@juniper-lib/dom/evts\";\r\nimport { AvatarMovedEvent } from \"@juniper-lib/threejs/eventSystem/AvatarMovedEvent\";\r\nimport { MouseButtons } from \"@juniper-lib/threejs/eventSystem/MouseButton\";\r\nimport { PointerEventTypes } from \"@juniper-lib/threejs/eventSystem/PointerEventTypes\";\r\nimport { angleClamp, assertNever, clamp, deg2rad, IDisposable, isFunction, isMobile, isMobileVR, isNullOrUndefined, isString, TypedEventBase } from \"@juniper-lib/tslib\";\r\nimport type { BodyFollower } from \"./animation/BodyFollower\";\r\nimport { getLookHeading, getLookPitch } from \"./animation/lookAngles\";\r\nimport type { EventSystem } from \"./eventSystem/EventSystem\";\r\nimport type { EventSystemEvent } from \"./eventSystem/EventSystemEvent\";\r\nimport type { Fader } from \"./Fader\";\r\nimport { ErsatzObject, obj } from \"./objects\";\r\nimport { resolveCamera } from \"./resolveCamera\";\r\nimport { setRightUpFwdPosFromMatrix } from \"./setRightUpFwdPosFromMatrix\";\r\n\r\n/**\r\n * The mouse is not as sensitive as the gamepad, so we have to bump up the\r\n * sensitivity quite a bit.\r\n **/\r\nconst MOUSE_SENSITIVITY_SCALE = 100;\r\n\r\n/**\r\n * The touch points are not as sensitive as the gamepad, so we have to bump up the\r\n * sensitivity quite a bit.\r\n **/\r\nconst TOUCH_SENSITIVITY_SCALE = 50;\r\n\r\nconst GAMEPAD_SENSITIVITY_SCALE = 1;\r\n\r\nconst MOTIONCONTROLLER_STICK_SENSITIVITY_SCALE = Math.PI / 3;\r\n\r\ninterface DeviceOrientationEventWithPermissionRequest extends Function {\r\n    requestPermission(): Promise<PermissionState>;\r\n}\r\n\r\nfunction isPermissionedDeviceOrientationEvent(obj: any): obj is DeviceOrientationEventWithPermissionRequest {\r\n    return obj === DeviceOrientationEvent\r\n        && \"requestPermission\" in obj\r\n        && isFunction(obj.requestPermission);\r\n}\r\n\r\nenum CameraControlMode {\r\n    None = \"none\",\r\n    MouseFPS = \"mousefirstperson\",\r\n    MouseDrag = \"mousedrag\",\r\n    MouseScreenEdge = \"mouseedge\",\r\n    Touch = \"touchswipe\",\r\n    Gamepad = \"gamepad\",\r\n    MotionControllerStick = \"motioncontroller\",\r\n    MagicWindow = \"magicwindow\"\r\n}\r\n\r\ninterface AvatarLocalEvents {\r\n    avatarmoved: AvatarMovedEvent;\r\n}\r\n\r\nexport class AvatarLocal\r\n    extends TypedEventBase<AvatarLocalEvents>\r\n    implements ErsatzObject, IDisposable {\r\n    private controlMode = CameraControlMode.None;\r\n\r\n    private requiredMouseButton = new Map<CameraControlMode, MouseButtons>([\r\n        [CameraControlMode.MouseDrag, MouseButtons.Mouse0],\r\n        [CameraControlMode.Touch, MouseButtons.Mouse0]\r\n    ]);\r\n\r\n\r\n\r\n    private readonly B = new THREE.Vector3(0, 0, 1);\r\n    private readonly R = new THREE.Vector3();\r\n    private readonly F = new THREE.Vector3();\r\n    private readonly U = new THREE.Vector3();\r\n    private readonly P = new THREE.Vector3();\r\n    private readonly M = new THREE.Matrix4();\r\n    private readonly E = new THREE.Euler();\r\n    private readonly Q1 = new THREE.Quaternion();\r\n    private readonly Q2 = new THREE.Quaternion();\r\n    private readonly Q3 = new THREE.Quaternion(- Math.sqrt(0.5), 0, 0, Math.sqrt(0.5)); // - PI/2 around the x-axis\r\n    private readonly motion = new THREE.Vector2();\r\n    private readonly nextFlick = new THREE.Vector2();\r\n    private readonly rotStage = new THREE.Matrix4();\r\n    private readonly userMovedEvt = new AvatarMovedEvent();\r\n\r\n\r\n\r\n    private _heading = 0;\r\n    private _pitch = 0;\r\n    private _roll = 0;\r\n\r\n    private headX = 0;\r\n    private headZ = 0;\r\n\r\n    private fwrd = false;\r\n    private back = false;\r\n    private left = false;\r\n    private rght = false;\r\n    private fwrd2 = false;\r\n    private back2 = false;\r\n    private left2 = false;\r\n    private rght2 = false;\r\n    private up = false;\r\n    private down = false;\r\n    private grow = false;\r\n    private shrk = false;\r\n\r\n    private readonly move = new THREE.Vector3();\r\n    private readonly move2 = new THREE.Vector3();\r\n\r\n    private readonly followers = new Array<BodyFollower>();\r\n\r\n    readonly head: THREE.Object3D;\r\n\r\n    readonly worldPos = new THREE.Vector3();\r\n\r\n    private _worldHeading: number = 0;\r\n    private _worldPitch: number = 0;\r\n    private lastTouchInputTime: number = Number.MIN_SAFE_INTEGER;\r\n\r\n    get worldHeading() {\r\n        return this._worldHeading;\r\n    }\r\n\r\n    get worldPitch() {\r\n        return this._worldPitch;\r\n    }\r\n\r\n    evtSys: EventSystem = null;\r\n    requiredTouchCount = 1;\r\n    private _disableHorizontal: boolean;\r\n    private _disableVertical: boolean;\r\n    private _invertHorizontal: boolean;\r\n    private _invertVertical: boolean;\r\n    private axisControl = new THREE.Vector2(0, 0);\r\n\r\n    set disableVertical(v: boolean) {\r\n        this._disableVertical = v;\r\n        this.axisControl.x = this._disableVertical ? 0 : this._invertVertical ? 1 : -1;\r\n    }\r\n\r\n    set invertVertical(v: boolean) {\r\n        this._invertVertical = v;\r\n        this.axisControl.x = this._disableVertical ? 0 : this._invertVertical ? 1 : -1;\r\n    }\r\n\r\n    set disableHorizontal(v: boolean) {\r\n        this._disableHorizontal = v;\r\n        this.axisControl.y = this._disableHorizontal ? 0 : this._invertHorizontal ? 1 : -1;\r\n    }\r\n\r\n    set invertHorizontal(v: boolean) {\r\n        this._invertHorizontal = v;\r\n        this.axisControl.y = this._disableHorizontal ? 0 : this._invertHorizontal ? 1 : -1;\r\n    }\r\n\r\n\r\n    minimumX = -85 * Math.PI / 180;\r\n    maximumX = 85 * Math.PI / 180;\r\n\r\n    target = new THREE.Quaternion(0, 0, 0, 1);\r\n\r\n    edgeFactor = 1 / 3;\r\n    private readonly acceleration = new THREE.Vector2(2, 2);\r\n    private readonly speed = new THREE.Vector2(3, 2);\r\n\r\n    private deviceQ = new THREE.Quaternion().identity();\r\n\r\n    private _height: number;\r\n    get height(): number {\r\n        return this.head.position.y;\r\n    }\r\n\r\n    private readonly uv = new THREE.Vector2();\r\n    private readonly duv = new THREE.Vector2();\r\n\r\n    get object() {\r\n        return this.head;\r\n    }\r\n\r\n    private _keyboardControlEnabled = false;\r\n    private readonly onKeyDown: (evt: any) => void;\r\n    private readonly onKeyUp: (evt: any) => void;\r\n\r\n    get stage() {\r\n        return this.head.parent;\r\n    }\r\n\r\n    constructor(private readonly renderer: THREE.WebGLRenderer,\r\n        private readonly camera: THREE.PerspectiveCamera,\r\n        fader: Fader,\r\n        defaultAvatarHeight: number) {\r\n        super();\r\n        this.disableHorizontal = false;\r\n        this.disableVertical = false;\r\n        this.invertHorizontal = false;\r\n        this.invertVertical = true;\r\n\r\n        this._height = defaultAvatarHeight;\r\n        this.head = obj(\"Head\", fader);\r\n\r\n        const setKey = (key: string, ok: boolean) => {\r\n            if (key === \"w\") this.fwrd = ok;\r\n            if (key === \"s\") this.back = ok;\r\n            if (key === \"a\") this.left = ok;\r\n            if (key === \"d\") this.rght = ok;\r\n            if (key === \"e\") this.up = ok;\r\n            if (key === \"q\") this.down = ok;\r\n            if (key === \"ArrowUp\") this.fwrd2 = ok;\r\n            if (key === \"ArrowDown\") this.back2 = ok;\r\n            if (key === \"ArrowLeft\") this.left2 = ok;\r\n            if (key === \"ArrowRight\") this.rght2 = ok;\r\n            if (key === \"r\") this.grow = ok;\r\n            if (key === \"f\") this.shrk = ok;\r\n        };\r\n\r\n        this.onKeyDown = (evt: KeyboardEvent) => setKey(evt.key, isModifierless(evt));\r\n        this.onKeyUp = (evt: KeyboardEvent) => setKey(evt.key, false);\r\n\r\n        this.keyboardControlEnabled = true;\r\n\r\n        if (isMobileVR()) {\r\n            this.controlMode = CameraControlMode.MotionControllerStick;\r\n        }\r\n        else if (matchMedia(\"(pointer: coarse)\").matches) {\r\n            this.controlMode = CameraControlMode.Touch;\r\n        }\r\n        else if (matchMedia(\"(pointer: fine)\").matches) {\r\n            this.controlMode = CameraControlMode.MouseDrag;\r\n        }\r\n\r\n        if (globalThis.isSecureContext && isMobile() && !isMobileVR()) {\r\n            this.onDeviceOrientationChangeEvent = (event: DeviceOrientationEvent) => {\r\n                this.deviceOrientation = event;\r\n                if (event\r\n                    && (event.alpha || event.beta || event.gamma)\r\n                    && this.motionEnabled) {\r\n                    const dt = performance.now() - this.lastTouchInputTime;\r\n                    if (dt > 1000) {\r\n                        this.controlMode = CameraControlMode.MagicWindow;\r\n                    }\r\n                }\r\n            };\r\n\r\n            this.onScreenOrientationChangeEvent = () => {\r\n                if (!isString(globalThis.orientation)) {\r\n                    this.screenOrientation = globalThis.orientation || 0;\r\n                }\r\n            };\r\n\r\n            this.startMotionControl();\r\n        }\r\n    }\r\n\r\n    onFlick(direction: number) {\r\n        this.nextFlick.x = MOTIONCONTROLLER_STICK_SENSITIVITY_SCALE * direction;\r\n    }\r\n\r\n    get keyboardControlEnabled(): boolean {\r\n        return this._keyboardControlEnabled;\r\n    }\r\n\r\n    set keyboardControlEnabled(v: boolean) {\r\n        if (this._keyboardControlEnabled !== v) {\r\n            this._keyboardControlEnabled = v;\r\n            if (this._keyboardControlEnabled) {\r\n                globalThis.addEventListener(\"keydown\", this.onKeyDown);\r\n                globalThis.addEventListener(\"keyup\", this.onKeyUp);\r\n            }\r\n            else {\r\n                globalThis.removeEventListener(\"keydown\", this.onKeyDown);\r\n                globalThis.removeEventListener(\"keyup\", this.onKeyUp);\r\n            }\r\n        }\r\n    }\r\n\r\n    addFollower(follower: BodyFollower) {\r\n        this.followers.push(follower);\r\n    }\r\n\r\n    onDown(evt: EventSystemEvent<\"down\">) {\r\n        if (evt.pointer.enabled) {\r\n            this.setMode(evt);\r\n        }\r\n    }\r\n\r\n    onMove(evt: EventSystemEvent<\"move\">) {\r\n        if (evt.pointer.enabled) {\r\n            this.setMode(evt);\r\n            if (evt.pointer.canMoveView\r\n                && this.checkMode(this.controlMode, evt)) {\r\n                this.uv.copy(evt.pointer.state.uv);\r\n                this.duv.copy(evt.pointer.state.duv);\r\n            }\r\n        }\r\n    }\r\n\r\n    private setMode(evt: EventSystemEvent<PointerEventTypes>) {\r\n        if (evt.pointer.type === \"touch\" || evt.pointer.type === \"pen\") {\r\n            this.lastTouchInputTime = performance.now();\r\n            this.controlMode = CameraControlMode.Touch;\r\n        }\r\n        else if (evt.pointer.type === \"gamepad\") {\r\n            this.controlMode = CameraControlMode.Gamepad;\r\n        }\r\n        else if (evt.pointer.type === \"hand\") {\r\n            this.controlMode = CameraControlMode.MotionControllerStick;\r\n        }\r\n        else if (evt.pointer.type !== \"mouse\") {\r\n            this.controlMode = CameraControlMode.None;\r\n        }\r\n        else if (this.evtSys.mouse.isPointerLocked) {\r\n            this.controlMode = CameraControlMode.MouseFPS;\r\n        }\r\n        else if (evt.pointer.draggedHit) {\r\n            this.controlMode = CameraControlMode.MouseScreenEdge;\r\n        }\r\n        else {\r\n            this.controlMode = CameraControlMode.MouseDrag;\r\n        }\r\n    }\r\n\r\n    private checkMode(mode: CameraControlMode, evt: EventSystemEvent<PointerEventTypes>) {\r\n        return mode !== CameraControlMode.None\r\n            && this.gestureSatisfied(mode, evt)\r\n            && this.dragSatisfied(mode, evt);\r\n    }\r\n\r\n    private gestureSatisfied(mode: CameraControlMode, evt: EventSystemEvent<PointerEventTypes>) {\r\n        const button = this.requiredMouseButton.get(mode);\r\n        if (isNullOrUndefined(button)) {\r\n            return mode === CameraControlMode.MouseScreenEdge\r\n                || mode === CameraControlMode.MouseFPS\r\n                || mode === CameraControlMode.Touch\r\n                || mode === CameraControlMode.Gamepad;\r\n        }\r\n        else {\r\n            return evt.pointer.state.buttons === button;\r\n        }\r\n    }\r\n\r\n    private dragSatisfied(mode: CameraControlMode, evt: EventSystemEvent<PointerEventTypes>) {\r\n        return !this.requiredMouseButton.has(mode)\r\n            || this.requiredMouseButton.get(mode) == MouseButtons.None\r\n            || evt.pointer.state.dragging;\r\n    }\r\n\r\n    get name(): string {\r\n        return this.object.name;\r\n    }\r\n\r\n    set name(v: string) {\r\n        this.object.name = v;\r\n    }\r\n\r\n    get heading() {\r\n        return this._heading;\r\n    }\r\n\r\n    private setHeading(angle: number) {\r\n        this._heading = angleClamp(angle);\r\n    }\r\n\r\n    get pitch() {\r\n        return this._pitch;\r\n    }\r\n\r\n    private setPitch(x: number, minX: number, maxX: number) {\r\n        this._pitch = angleClamp(x + Math.PI) - Math.PI;\r\n        this._pitch = clamp(this._pitch, minX, maxX);\r\n    }\r\n\r\n    get roll() {\r\n        return this._roll;\r\n    }\r\n\r\n    private setRoll(z: number) {\r\n        this._roll = angleClamp(z);\r\n    }\r\n\r\n    setHeadingImmediate(heading: number) {\r\n        this.setHeading(heading);\r\n        this.updateOrientation();\r\n        this.resetFollowers();\r\n    }\r\n\r\n    setOrientationImmediate(heading: number, pitch: number) {\r\n        this.setHeading(heading);\r\n        this._pitch = angleClamp(pitch);\r\n        this.updateOrientation();\r\n    }\r\n\r\n    update(dt: number) {\r\n\r\n        dt *= 0.001;\r\n\r\n        if (this.controlMode === CameraControlMode.MagicWindow) {\r\n            const device = this.deviceOrientation;\r\n\r\n            if (device) {\r\n                const alpha = device.alpha ? deg2rad(device.alpha) + this.alphaOffset : 0;\r\n                const beta = device.beta ? deg2rad(device.beta) : 0;\r\n                const gamma = device.gamma ? deg2rad(device.gamma) : 0;\r\n                const orient = this.screenOrientation ? deg2rad(this.screenOrientation) : 0;\r\n                this.E.set(beta, alpha, -gamma, \"YXZ\");\r\n                this.Q2.setFromAxisAngle(this.B, -orient);\r\n                this.deviceQ\r\n                    .setFromEuler(this.E) // orient the device\r\n                    .multiply(this.Q3) // camera looks out the back of the device, not the top\r\n                    .multiply(this.Q2); // adjust for screen orientation\r\n            }\r\n        }\r\n        else if (this.controlMode === CameraControlMode.MotionControllerStick) {\r\n            if (this.nextFlick.manhattanLength() !== 0) {\r\n                this.motion\r\n                    .copy(this.nextFlick)\r\n                    .multiply(this.axisControl);\r\n                this.nextFlick.setScalar(0);\r\n                this.setHeading(this.heading + this.motion.x);\r\n                this.setPitch(this.pitch + this.motion.y, this.minimumX, this.maximumX);\r\n                this.setRoll(0);\r\n            }\r\n        }\r\n        else if (this.controlMode === CameraControlMode.MouseScreenEdge) {\r\n            if (this.uv.manhattanLength() > 0) {\r\n                this.motion\r\n                    .set(\r\n                        this.scaleRadialComponent(this.uv.x, this.speed.x, this.acceleration.x),\r\n                        this.scaleRadialComponent(-this.uv.y, this.speed.y, this.acceleration.y))\r\n                    .multiplyScalar(dt)\r\n                    .multiply(this.axisControl);\r\n\r\n                this.setHeading(this.heading + this.motion.x);\r\n                this.setPitch(this.pitch + this.motion.y, this.minimumX, this.maximumX);\r\n                this.setRoll(0);\r\n            }\r\n        }\r\n        else if (this.controlMode === CameraControlMode.MouseFPS) {\r\n            if (this.duv.manhattanLength() > 0) {\r\n                this.motion\r\n                    .copy(this.duv)\r\n                    .multiply(this.axisControl);\r\n                this.setHeading(this.heading + this.motion.x);\r\n                this.setPitch(this.pitch + this.motion.y, this.minimumX, this.maximumX);\r\n                this.setRoll(0);\r\n            }\r\n        }\r\n        else if (this.controlMode !== CameraControlMode.None) {\r\n            if (this.duv.manhattanLength() > 0) {\r\n                const sensitivity = this.controlMode === CameraControlMode.MouseDrag\r\n                    ? MOUSE_SENSITIVITY_SCALE\r\n                    : this.controlMode === CameraControlMode.Touch\r\n                        ? TOUCH_SENSITIVITY_SCALE\r\n                        : this.controlMode === CameraControlMode.Gamepad\r\n                            ? GAMEPAD_SENSITIVITY_SCALE\r\n                            : assertNever(this.controlMode);\r\n\r\n                this.motion\r\n                    .copy(this.duv)\r\n                    .multiplyScalar(sensitivity * dt)\r\n                    .multiply(this.axisControl);\r\n\r\n                this.setHeading(this.heading + this.motion.x);\r\n                this.setPitch(this.pitch + this.motion.y, this.minimumX, this.maximumX);\r\n                this.setRoll(0);\r\n            }\r\n        }\r\n\r\n        this.Q1.setFromAxisAngle(this.stage.up, this.worldHeading);\r\n\r\n        if (this.fwrd || this.back || this.left || this.rght || this.up || this.down) {\r\n            const dx = (this.left ? -1 : 0) + (this.rght ? 1 : 0);\r\n            const dy = (this.down ? -1 : 0) + (this.up ? 1 : 0);\r\n            const dz = (this.fwrd ? -1 : 0) + (this.back ? 1 : 0);\r\n            this.move.set(dx, dy, dz);\r\n            const d = this.move.length();\r\n            if (d > 0) {\r\n                this.move.multiplyScalar(dt / d)\r\n                    .applyQuaternion(this.Q1);\r\n                this.stage.position.add(this.move);\r\n            }\r\n        }\r\n\r\n        if (this.fwrd2 || this.back2 || this.left2 || this.rght2) {\r\n            const dx = (this.left2 ? -1 : 0) + (this.rght2 ? 1 : 0);\r\n            const dz = (this.fwrd2 ? -1 : 0) + (this.back2 ? 1 : 0);\r\n            this.move2.set(dx, 0, dz);\r\n            const d = this.move2.length();\r\n            if (d > 0) {\r\n                this.move2.multiplyScalar(dt / d)\r\n                    .applyQuaternion(this.Q1);\r\n\r\n                this.headX += this.move2.x;\r\n                this.headZ += this.move2.y;\r\n            }\r\n        }\r\n\r\n        if (this.grow || this.shrk) {\r\n            const dy = (this.shrk ? -1 : 0) + (this.grow ? 1 : 0);\r\n            this._height += dy * dt;\r\n            this._height = clamp(this._height, 1, 2);\r\n        }\r\n\r\n        this.updateOrientation();\r\n\r\n        this.userMovedEvt.set(\r\n            this.P.x, this.P.y, this.P.z,\r\n            this.F.x, this.F.y, this.F.z,\r\n            this.U.x, this.U.y, this.U.z,\r\n            this.height);\r\n\r\n        this.dispatchEvent(this.userMovedEvt);\r\n\r\n        const decay = Math.pow(0.95, 100 * dt);\r\n        this.duv.multiplyScalar(decay);\r\n        if (this.duv.manhattanLength() <= 0.0001) {\r\n            this.duv.setScalar(0);\r\n        }\r\n    }\r\n\r\n    private scaleRadialComponent(n: number, dn: number, ddn: number) {\r\n        const absN = Math.abs(n);\r\n        return Math.sign(n) * Math.pow(Math.max(0, absN - this.edgeFactor) / (1 - this.edgeFactor), ddn) * dn;\r\n    }\r\n\r\n    private updateOrientation() {\r\n        const cam = resolveCamera(this.renderer, this.camera);\r\n\r\n        this.rotStage.makeRotationY(this._heading);\r\n\r\n        this.stage.matrix.makeTranslation(\r\n            this.stage.position.x,\r\n            this.stage.position.y,\r\n            this.stage.position.z)\r\n            .multiply(this.rotStage);\r\n\r\n        this.stage.matrix.decompose(\r\n            this.stage.position,\r\n            this.stage.quaternion,\r\n            this.stage.scale);\r\n\r\n        if (this.renderer.xr.isPresenting) {\r\n            this.M.copy(this.stage.matrixWorld)\r\n                .invert();\r\n\r\n            this.head.position.copy(cam.position)\r\n                .applyMatrix4(this.M);\r\n\r\n            this.head.quaternion.copy(this.stage.quaternion)\r\n                .invert()\r\n                .multiply(cam.quaternion);\r\n        }\r\n        else {\r\n            this.head.position.set(this.headX, this._height, this.headZ);\r\n\r\n            this.E.set(this._pitch, 0, this._roll, \"XYZ\");\r\n            this.head.quaternion.setFromEuler(this.E)\r\n                .premultiply(this.deviceQ);\r\n        }\r\n\r\n\r\n        this.camera.position.copy(this.head.position);\r\n        this.camera.quaternion.copy(this.head.quaternion);\r\n\r\n        this.head.getWorldPosition(this.worldPos);\r\n        this.head.getWorldDirection(this.F);\r\n        this._worldHeading = getLookHeading(this.F);\r\n        this._worldPitch = getLookPitch(this.F);\r\n        setRightUpFwdPosFromMatrix(this.head.matrixWorld, this.R, this.U, this.F, this.P);\r\n    }\r\n\r\n    reset() {\r\n        this.stage.position.setScalar(0);\r\n        this.setHeadingImmediate(0);\r\n    }\r\n\r\n    private resetFollowers() {\r\n        for (const follower of this.followers) {\r\n            follower.reset(this.height, this.worldPos, this.worldHeading);\r\n        }\r\n    }\r\n\r\n    private deviceOrientation: DeviceOrientationEvent = null;\r\n    private screenOrientation = 0;\r\n    private alphaOffset = 0;\r\n\r\n    private onDeviceOrientationChangeEvent: (event: DeviceOrientationEvent) => void = null;\r\n    private onScreenOrientationChangeEvent: () => void = null;\r\n\r\n    private motionEnabled = false;\r\n\r\n    private async getPermission(): Promise<PermissionState | \"not-supported\"> {\r\n        if (!(\"DeviceOrientationEvent\" in globalThis)) {\r\n            return \"not-supported\";\r\n        }\r\n\r\n        // iOS 13+\r\n        if (isPermissionedDeviceOrientationEvent(DeviceOrientationEvent)) {\r\n            return await DeviceOrientationEvent.requestPermission();\r\n        }\r\n\r\n        return \"granted\";\r\n    }\r\n\r\n    async startMotionControl() {\r\n        if (!this.motionEnabled) {\r\n            this.onScreenOrientationChangeEvent(); // run once on load\r\n            const permission = await this.getPermission();\r\n            this.motionEnabled = permission === \"granted\";\r\n            if (this.motionEnabled) {\r\n                globalThis.addEventListener(\"orientationchange\", this.onScreenOrientationChangeEvent);\r\n                globalThis.addEventListener(\"deviceorientation\", this.onDeviceOrientationChangeEvent);\r\n            }\r\n        }\r\n    }\r\n\r\n    stopMotionControl() {\r\n        if (this.motionEnabled) {\r\n            globalThis.removeEventListener(\"orientationchange\", this.onScreenOrientationChangeEvent);\r\n            globalThis.removeEventListener(\"deviceorientation\", this.onDeviceOrientationChangeEvent);\r\n            this.motionEnabled = false;\r\n        }\r\n    }\r\n\r\n    dispose() {\r\n        this.stopMotionControl();\r\n    }\r\n}", "import { clamp, truncate } from \"@juniper-lib/tslib\";\r\nimport type { EventSystemEvent } from \"./eventSystem/EventSystemEvent\";\r\n\r\nexport class CameraControl {\r\n\r\n    fovZoomEnabled = true;\r\n    minFOV = 15;\r\n    maxFOV = 120;\r\n\r\n    private dz: number = 0;\r\n\r\n    constructor(private readonly camera: THREE.PerspectiveCamera) {\r\n\r\n    }\r\n\r\n    onMove(evt: EventSystemEvent<\"move\">) {\r\n        if (evt.pointer.enabled\r\n            && evt.pointer.canMoveView) {\r\n            this.dz = evt.pointer.state.dz;\r\n        }\r\n    }\r\n\r\n    get fov() {\r\n        return this.camera.fov;\r\n    }\r\n\r\n    set fov(v) {\r\n        if (v !== this.fov) {\r\n            this.camera.fov = v;\r\n            this.camera.updateProjectionMatrix();\r\n        }\r\n    }\r\n\r\n    update(dt: number): void {\r\n        if (this.fovZoomEnabled\r\n            && Math.abs(this.dz) > 0) {\r\n            const factor = Math.pow(0.95, 5 * dt);\r\n            this.dz = truncate(factor * this.dz);\r\n            this.fov = clamp(this.camera.fov - this.dz, this.minFOV, this.maxFOV);\r\n        }\r\n    }\r\n}", "import { objectResolve, Objects } from \"./objects\";\r\n\r\nexport const FOREGROUND = 0;\r\nexport const LEFT_EYE = 1;\r\nexport const RIGHT_EYE = 2;\r\nexport const PURGATORY = 3;\r\nexport const PHOTOSPHERE_CAPTURE = 31;\r\n\r\nexport function deepSetLayer(obj: Objects, level: number) {\r\n    obj = objectResolve(obj);\r\n    obj.traverse((o) => o.layers.set(level));\r\n}\r\n\r\nexport function deepEnableLayer(obj: Objects, level: number) {\r\n    obj = objectResolve(obj);\r\n    obj.traverse((o) => o.layers.enable(level));\r\n}\r\n\r\n", "import { MouseButtons } from \"@juniper-lib/threejs/eventSystem/MouseButton\";\r\nimport type { PointerState } from \"@juniper-lib/threejs/eventSystem/PointerState\";\r\nimport { ErsatzObject } from \"../objects\";\r\nimport { getMeshTarget } from \"./RayTarget\";\r\n\r\nconst T = new THREE.Vector3();\r\nconst V = new THREE.Vector3();\r\nconst Q = new THREE.Quaternion();\r\n\r\nexport abstract class BaseCursor implements ErsatzObject {\r\n    private _object: THREE.Object3D = null;\r\n    private _visible: boolean = true;\r\n    private _style: string = \"default\";\r\n\r\n    get object() {\r\n        return this._object;\r\n    }\r\n\r\n    set object(v) {\r\n        this._object = v;\r\n    }\r\n\r\n    get style(): string {\r\n        return this._style;\r\n    }\r\n\r\n    set style(v) {\r\n        this._style = v;\r\n    }\r\n\r\n    get visible(): boolean {\r\n        return this._visible;\r\n    }\r\n\r\n    set visible(v) {\r\n        this._visible = v;\r\n    }\r\n\r\n    abstract get position(): THREE.Vector3;\r\n\r\n    update(avatarHeadPos: THREE.Vector3, hit: THREE.Intersection, defaultDistance: number, canMoveView: boolean, state: PointerState, origin: THREE.Vector3, direction: THREE.Vector3) {\r\n\r\n        if (hit && hit.face) {\r\n            this.position.copy(hit.point);\r\n\r\n            hit.object.getWorldQuaternion(Q);\r\n            T.copy(hit.face.normal)\r\n                .applyQuaternion(Q);\r\n\r\n            V.copy(T)\r\n                .multiplyScalar(0.02);\r\n            this.position.add(V);\r\n\r\n            V.copy(T)\r\n                .multiplyScalar(10)\r\n                .add(this.position);\r\n        }\r\n        else {\r\n            this.position.copy(direction)\r\n                .multiplyScalar(defaultDistance)\r\n                .add(origin);\r\n            V.copy(avatarHeadPos);\r\n        }\r\n\r\n        this.object.parent.worldToLocal(this.position);\r\n\r\n        this.lookAt(V);\r\n\r\n        const target = getMeshTarget(hit);\r\n\r\n        this.style = target\r\n            ? !target.enabled\r\n                ? \"not-allowed\"\r\n                : target.draggable\r\n                    ? state.dragging\r\n                        ? \"grabbing\"\r\n                        : \"move\"\r\n                    : target.clickable\r\n                        ? \"pointer\"\r\n                        : \"default\"\r\n            : canMoveView\r\n                ? state.buttons === MouseButtons.Mouse0\r\n                    ? \"grabbing\"\r\n                    : \"grab\"\r\n                : \"default\";\r\n    }\r\n\r\n    lookAt(_v: THREE.Vector3) {\r\n    }\r\n}\r\n", "import { arrayScan } from \"@juniper-lib/tslib\";\r\nimport { deepEnableLayer, PURGATORY } from \"../layers\";\r\nimport { ErsatzObject, objectIsVisible, objectSetVisible } from \"../objects\";\r\nimport { BaseCursor } from \"./BaseCursor\";\r\nimport { CursorSystem } from \"./CursorSystem\";\r\n\r\nexport class Cursor3D\r\n    extends BaseCursor\r\n    implements ErsatzObject {\r\n\r\n    private readonly cursorSystem: CursorSystem = null;\r\n\r\n    constructor(cursorSystem?: CursorSystem) {\r\n        super();\r\n        this.object = new THREE.Object3D();\r\n        this.cursorSystem = cursorSystem;\r\n    }\r\n\r\n    add(name: string, obj: THREE.Object3D) {\r\n        this.object.add(obj);\r\n        deepEnableLayer(obj, PURGATORY);\r\n        obj.visible = name === \"default\";\r\n    }\r\n\r\n    get position() {\r\n        return this.object.position;\r\n    }\r\n\r\n    override get style() {\r\n        for (const child of this.object.children) {\r\n            if (child.visible) {\r\n                return child.name;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    override set style(v) {\r\n        for (const child of this.object.children) {\r\n            child.visible = child.name === v;\r\n        }\r\n\r\n        if (this.style == null && this.object.children.length > 0) {\r\n            const defaultCursor = arrayScan(this.object.children,\r\n                (child) => child.name === \"default\",\r\n                (child) => child != null);\r\n            if (defaultCursor != null) {\r\n                defaultCursor.visible = true;\r\n            }\r\n        }\r\n\r\n        if (this.cursorSystem) {\r\n            this.cursorSystem.style = \"none\";\r\n        }\r\n    }\r\n\r\n    override get visible() {\r\n        return objectIsVisible(this);\r\n    }\r\n\r\n    override set visible(v) {\r\n        objectSetVisible(this, v);\r\n    }\r\n\r\n    override lookAt(v: THREE.Vector3) {\r\n        this.object.lookAt(v);\r\n    }\r\n\r\n    clone() {\r\n        const obj = new Cursor3D();\r\n        for (const child of this.object.children) {\r\n            obj.add(child.name, child.clone());\r\n        }\r\n        return obj;\r\n    }\r\n}", "import { TypedEvent } from \"@juniper-lib/tslib\";\r\nimport { PointerName } from \"@juniper-lib/tslib/events/PointerName\";\r\n\r\nexport class ObjectMovedEvent extends TypedEvent<\"objectMoved\"> {\r\n    px = 0;\r\n    py = 0;\r\n    pz = 0;\r\n    fx = 0;\r\n    fy = 0;\r\n    fz = 0;\r\n    ux = 0;\r\n    uy = 0;\r\n    uz = 0;\r\n\r\n    constructor(public name: PointerName = null) {\r\n        super(\"objectMoved\");\r\n    }\r\n\r\n    set(px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number) {\r\n        this.px = px;\r\n        this.py = py;\r\n        this.pz = pz;\r\n        this.fx = fx;\r\n        this.fy = fy;\r\n        this.fz = fz;\r\n        this.ux = ux;\r\n        this.uy = uy;\r\n        this.uz = uz;\r\n    }\r\n}", "import { PointerEventTypes } from \"@juniper-lib/threejs/eventSystem/PointerEventTypes\";\r\nimport { TypedEvent } from \"@juniper-lib/tslib\";\r\nimport { FlickEvent } from \"./FlickEvent\";\r\nimport type { IPointer } from \"./IPointer\";\r\nimport { ObjectMovedEvent } from \"./ObjectMovedEvent\";\r\nimport { getMeshTarget, RayTarget } from \"./RayTarget\";\r\n\r\nexport class EventSystemEvent<T extends PointerEventTypes = PointerEventTypes> extends TypedEvent<T> {\r\n    private _hit: THREE.Intersection = null;\r\n    private _point: THREE.Vector3 = null;\r\n    private _distance: number = Number.POSITIVE_INFINITY;\r\n    private _rayTarget: RayTarget = null;\r\n\r\n    constructor(type: T,\r\n        public readonly pointer: IPointer) {\r\n        super(type);\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    get hit(): THREE.Intersection {\r\n        return this._hit;\r\n    }\r\n\r\n    set hit(v: THREE.Intersection) {\r\n        if (v !== this.hit) {\r\n            this._hit = v;\r\n            this._point = null;\r\n            this._distance = Number.POSITIVE_INFINITY;\r\n            this._rayTarget = null;\r\n\r\n            if (v) {\r\n                this._point = v.point;\r\n                this._distance = v.distance;\r\n                this._rayTarget = getMeshTarget(v.object);\r\n            }\r\n        }\r\n    }\r\n\r\n    get rayTarget(): RayTarget {\r\n        return this._rayTarget;\r\n    }\r\n\r\n    get point(): THREE.Vector3 {\r\n        return this._point;\r\n    }\r\n\r\n    get distance(): number {\r\n        return this._distance;\r\n    }\r\n}\r\n\r\nexport interface EventSystemEvents {\r\n    move: EventSystemEvent<\"move\">;\r\n    enter: EventSystemEvent<\"enter\">;\r\n    exit: EventSystemEvent<\"exit\">;\r\n    up: EventSystemEvent<\"up\">;\r\n    down: EventSystemEvent<\"down\">;\r\n    click: EventSystemEvent<\"click\">;\r\n    dragstart: EventSystemEvent<\"dragstart\">;\r\n    drag: EventSystemEvent<\"drag\">;\r\n    dragcancel: EventSystemEvent<\"dragcancel\">;\r\n    dragend: EventSystemEvent<\"dragend\">;\r\n    objectMoved: ObjectMovedEvent;\r\n    flick: FlickEvent;\r\n}", "import { TypedEvent, TypedEventBase } from \"@juniper-lib/tslib\";\r\n\r\nclass GamepadButtonEvent<T extends string> extends TypedEvent<T> {\r\n    constructor(type: T, public button: number) {\r\n        super(type);\r\n    }\r\n}\r\n\r\nexport class GamepadButtonUpEvent extends GamepadButtonEvent<\"gamepadbuttonup\"> {\r\n    constructor(button: number) {\r\n        super(\"gamepadbuttonup\", button);\r\n    }\r\n}\r\n\r\nexport class GamepadButtonDownEvent extends GamepadButtonEvent<\"gamepadbuttondown\"> {\r\n    constructor(button: number) {\r\n        super(\"gamepadbuttondown\", button);\r\n    }\r\n}\r\n\r\nclass GamepadAxisEvent<T extends string> extends TypedEvent<T> {\r\n    constructor(type: T, public axis: number, public value: number) {\r\n        super(type);\r\n    }\r\n}\r\n\r\nexport class GamepadAxisMaxedEvent extends GamepadAxisEvent<\"gamepadaxismaxed\"> {\r\n    constructor(axis: number, value: number) {\r\n        super(\"gamepadaxismaxed\", axis, value);\r\n    }\r\n}\r\n\r\ntype Stick = { x: number, y: number; };\r\n\r\ninterface EventedGamepadEvents {\r\n    gamepadbuttonup: GamepadButtonUpEvent;\r\n    gamepadbuttondown: GamepadButtonDownEvent;\r\n    gamepadaxismaxed: GamepadAxisMaxedEvent;\r\n}\r\n\r\nexport class EventedGamepad\r\n    extends TypedEventBase<EventedGamepadEvents>\r\n    implements Gamepad {\r\n    private readonly lastAxisValues = new Array<number>();\r\n    private readonly _isStick: (a: any) => boolean;\r\n\r\n    private readonly btnDownEvts = new Array<GamepadButtonDownEvent>();\r\n    private readonly btnUpEvts = new Array<GamepadButtonUpEvent>();\r\n    private readonly wasPressed = new Array<boolean>();\r\n    private axisThresholdMax = 0.9;\r\n    private axisThresholdMin = 0.1;\r\n    private readonly axisMaxEvts = new Array<GamepadAxisMaxedEvent>();\r\n    private readonly wasAxisMaxed = new Array<boolean>();\r\n    private readonly sticks = new Array<Stick>();\r\n\r\n    constructor(private pad: Gamepad) {\r\n        super();\r\n        this._isStick = (a: number) => a % 2 === 0 && a < pad.axes.length - 1;\r\n\r\n        for (let b = 0; b < pad.buttons.length; ++b) {\r\n            this.btnDownEvts[b] = new GamepadButtonDownEvent(b);\r\n            this.btnUpEvts[b] = new GamepadButtonUpEvent(b);\r\n            this.wasPressed[b] = false;\r\n        }\r\n\r\n        for (let a = 0; a < pad.axes.length; ++a) {\r\n            this.axisMaxEvts[a] = new GamepadAxisMaxedEvent(a, 0);\r\n            this.wasAxisMaxed[a] = false;\r\n            if (this._isStick(a)) {\r\n                this.sticks[a / 2] = { x: 0, y: 0 };\r\n            }\r\n\r\n            this.lastAxisValues[a] = pad.axes[a];\r\n        }\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    setPad(pad: Gamepad) {\r\n        this.pad = pad;\r\n        this.update();\r\n    }\r\n\r\n    get id(): string {\r\n        return this.pad.id;\r\n    }\r\n\r\n    get index(): number {\r\n        return this.pad.index;\r\n    }\r\n\r\n    get connected(): boolean {\r\n        return this.pad.connected;\r\n    }\r\n\r\n    get mapping() {\r\n        return this.pad.mapping;\r\n    }\r\n\r\n    get timestamp() {\r\n        return this.pad.timestamp;\r\n    }\r\n\r\n    get hand(): GamepadHand {\r\n        return this.pad.hand;\r\n    }\r\n\r\n    get pose(): GamepadPose {\r\n        return this.pad.pose;\r\n    }\r\n\r\n    get buttons(): readonly GamepadButton[] {\r\n        return this.pad.buttons;\r\n    }\r\n\r\n    get axes(): readonly number[] {\r\n        return this.pad.axes;\r\n    }\r\n\r\n    get hapticActuators(): readonly GamepadHapticActuator[] {\r\n        return this.pad.hapticActuators;\r\n    }\r\n\r\n    update() {\r\n        for (let b = 0; b < this.pad.buttons.length; ++b) {\r\n            const wasPressed = this.wasPressed[b];\r\n            const pressed = this.pad.buttons[b].pressed;\r\n            if (pressed !== wasPressed) {\r\n                this.wasPressed[b] = pressed;\r\n                this.dispatchEvent((pressed\r\n                    ? this.btnDownEvts\r\n                    : this.btnUpEvts)[b]);\r\n            }\r\n        }\r\n\r\n        for (let a = 0; a < this.pad.axes.length; ++a) {\r\n            const wasMaxed = this.wasAxisMaxed[a];\r\n            const val = this.pad.axes[a];\r\n            const dir = Math.sign(val);\r\n            const mag = Math.abs(val);\r\n            const maxed = mag >= this.axisThresholdMax;\r\n            const mined = mag <= this.axisThresholdMin;\r\n            const correctedVal = dir * (maxed ? 1 : (mined ? 0 : mag));\r\n            if (maxed && !wasMaxed) {\r\n                this.axisMaxEvts[a].value = correctedVal;\r\n                this.dispatchEvent(this.axisMaxEvts[a]);\r\n            }\r\n\r\n            this.wasAxisMaxed[a] = maxed;\r\n            this.lastAxisValues[a] = correctedVal;\r\n        }\r\n\r\n        for (let a = 0; a < this.axes.length - 1; a += 2) {\r\n            const stick = this.sticks[a / 2];\r\n            stick.x = this.axes[a];\r\n            stick.y = this.axes[a + 1];\r\n        }\r\n    }\r\n}\r\n", "class GLTFLoader extends THREE.Loader {\r\n\r\n    constructor(manager) {\r\n\r\n        super(manager);\r\n\r\n        this.dracoLoader = null;\r\n        this.ktx2Loader = null;\r\n        this.meshoptDecoder = null;\r\n\r\n        this.pluginCallbacks = [];\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFMaterialsClearcoatExtension(parser);\r\n\r\n        });\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFTextureBasisUExtension(parser);\r\n\r\n        });\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFTextureWebPExtension(parser);\r\n\r\n        });\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFMaterialsSheenExtension(parser);\r\n\r\n        });\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFMaterialsTransmissionExtension(parser);\r\n\r\n        });\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFMaterialsVolumeExtension(parser);\r\n\r\n        });\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFMaterialsIorExtension(parser);\r\n\r\n        });\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFMaterialsSpecularExtension(parser);\r\n\r\n        });\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFLightsExtension(parser);\r\n\r\n        });\r\n\r\n        this.register(function (parser) {\r\n\r\n            return new GLTFMeshoptCompression(parser);\r\n\r\n        });\r\n\r\n    }\r\n\r\n    load(url, onLoad, onProgress, onError) {\r\n\r\n        const scope = this;\r\n\r\n        let resourcePath;\r\n\r\n        if (this.resourcePath !== '') {\r\n\r\n            resourcePath = this.resourcePath;\r\n\r\n        } else if (this.path !== '') {\r\n\r\n            resourcePath = this.path;\r\n\r\n        } else {\r\n\r\n            resourcePath = THREE.LoaderUtils.extractUrlBase(url);\r\n\r\n        }\r\n\r\n        // Tells the LoadingManager to track an extra item, which resolves after\r\n        // the model is fully loaded. This means the count of items loaded will\r\n        // be incorrect, but ensures manager.onLoad() does not fire early.\r\n        this.manager.itemStart(url);\r\n\r\n        const _onError = function (e) {\r\n\r\n            if (onError) {\r\n\r\n                onError(e);\r\n\r\n            } else {\r\n\r\n                console.error(e);\r\n\r\n            }\r\n\r\n            scope.manager.itemError(url);\r\n            scope.manager.itemEnd(url);\r\n\r\n        };\r\n\r\n        const loader = new THREE.FileLoader(this.manager);\r\n\r\n        loader.setPath(this.path);\r\n        loader.setResponseType('arraybuffer');\r\n        loader.setRequestHeader(this.requestHeader);\r\n        loader.setWithCredentials(this.withCredentials);\r\n\r\n        loader.load(url, function (data) {\r\n\r\n            try {\r\n\r\n                scope.parse(data, resourcePath, function (gltf) {\r\n\r\n                    onLoad(gltf);\r\n\r\n                    scope.manager.itemEnd(url);\r\n\r\n                }, _onError);\r\n\r\n            } catch (e) {\r\n\r\n                _onError(e);\r\n\r\n            }\r\n\r\n        }, onProgress, _onError);\r\n\r\n    }\r\n\r\n    setDRACOLoader(dracoLoader) {\r\n\r\n        this.dracoLoader = dracoLoader;\r\n        return this;\r\n\r\n    }\r\n\r\n    setDDSLoader() {\r\n\r\n        throw new Error(\r\n\r\n            'THREE.GLTFLoader: \"MSFT_texture_dds\" no longer supported. Please update to \"KHR_texture_basisu\".'\r\n\r\n        );\r\n\r\n    }\r\n\r\n    setKTX2Loader(ktx2Loader) {\r\n\r\n        this.ktx2Loader = ktx2Loader;\r\n        return this;\r\n\r\n    }\r\n\r\n    setMeshoptDecoder(meshoptDecoder) {\r\n\r\n        this.meshoptDecoder = meshoptDecoder;\r\n        return this;\r\n\r\n    }\r\n\r\n    register(callback) {\r\n\r\n        if (this.pluginCallbacks.indexOf(callback) === - 1) {\r\n\r\n            this.pluginCallbacks.push(callback);\r\n\r\n        }\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    unregister(callback) {\r\n\r\n        if (this.pluginCallbacks.indexOf(callback) !== - 1) {\r\n\r\n            this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(callback), 1);\r\n\r\n        }\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    parse(data, path, onLoad, onError) {\r\n\r\n        let content;\r\n        const extensions = {};\r\n        const plugins = {};\r\n\r\n        if (typeof data === 'string') {\r\n\r\n            content = data;\r\n\r\n        } else {\r\n\r\n            const magic = THREE.LoaderUtils.decodeText(new Uint8Array(data, 0, 4));\r\n\r\n            if (magic === BINARY_EXTENSION_HEADER_MAGIC) {\r\n\r\n                try {\r\n\r\n                    extensions[EXTENSIONS.KHR_BINARY_GLTF] = new GLTFBinaryExtension(data);\r\n\r\n                } catch (error) {\r\n\r\n                    if (onError) onError(error);\r\n                    return;\r\n\r\n                }\r\n\r\n                content = extensions[EXTENSIONS.KHR_BINARY_GLTF].content;\r\n\r\n            } else {\r\n\r\n                content = THREE.LoaderUtils.decodeText(new Uint8Array(data));\r\n\r\n            }\r\n\r\n        }\r\n\r\n        const json = JSON.parse(content);\r\n\r\n        if (json.asset === undefined || json.asset.version[0] < 2) {\r\n\r\n            if (onError) onError(new Error('THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.'));\r\n            return;\r\n\r\n        }\r\n\r\n        const parser = new GLTFParser(json, {\r\n\r\n            path: path || this.resourcePath || '',\r\n            crossOrigin: this.crossOrigin,\r\n            requestHeader: this.requestHeader,\r\n            manager: this.manager,\r\n            ktx2Loader: this.ktx2Loader,\r\n            meshoptDecoder: this.meshoptDecoder\r\n\r\n        });\r\n\r\n        parser.fileLoader.setRequestHeader(this.requestHeader);\r\n\r\n        for (let i = 0; i < this.pluginCallbacks.length; i++) {\r\n\r\n            const plugin = this.pluginCallbacks[i](parser);\r\n            plugins[plugin.name] = plugin;\r\n\r\n            // Workaround to avoid determining as unknown extension\r\n            // in addUnknownExtensionsToUserData().\r\n            // Remove this workaround if we move all the existing\r\n            // extension handlers to plugin system\r\n            extensions[plugin.name] = true;\r\n\r\n        }\r\n\r\n        if (json.extensionsUsed) {\r\n\r\n            for (let i = 0; i < json.extensionsUsed.length; ++i) {\r\n\r\n                const extensionName = json.extensionsUsed[i];\r\n                const extensionsRequired = json.extensionsRequired || [];\r\n\r\n                switch (extensionName) {\r\n\r\n                    case EXTENSIONS.KHR_MATERIALS_UNLIT:\r\n                        extensions[extensionName] = new GLTFMaterialsUnlitExtension();\r\n                        break;\r\n\r\n                    case EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\r\n                        extensions[extensionName] = new GLTFMaterialsPbrSpecularGlossinessExtension();\r\n                        break;\r\n\r\n                    case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\r\n                        extensions[extensionName] = new GLTFDracoMeshCompressionExtension(json, this.dracoLoader);\r\n                        break;\r\n\r\n                    case EXTENSIONS.KHR_TEXTURE_TRANSFORM:\r\n                        extensions[extensionName] = new GLTFTextureTransformExtension();\r\n                        break;\r\n\r\n                    case EXTENSIONS.KHR_MESH_QUANTIZATION:\r\n                        extensions[extensionName] = new GLTFMeshQuantizationExtension();\r\n                        break;\r\n\r\n                    default:\r\n\r\n                        if (extensionsRequired.indexOf(extensionName) >= 0 && plugins[extensionName] === undefined) {\r\n\r\n                            console.warn('THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".');\r\n\r\n                        }\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        parser.setExtensions(extensions);\r\n        parser.setPlugins(plugins);\r\n        parser.parse(onLoad, onError);\r\n\r\n    }\r\n\r\n    parseAsync(data, path) {\r\n\r\n        const scope = this;\r\n\r\n        return new Promise(function (resolve, reject) {\r\n\r\n            scope.parse(data, path, resolve, reject);\r\n\r\n        });\r\n\r\n    }\r\n\r\n}\r\n\r\n/* GLTFREGISTRY */\r\n\r\nfunction GLTFRegistry() {\r\n\r\n    let objects = {};\r\n\r\n    return {\r\n\r\n        get: function (key) {\r\n\r\n            return objects[key];\r\n\r\n        },\r\n\r\n        add: function (key, object) {\r\n\r\n            objects[key] = object;\r\n\r\n        },\r\n\r\n        remove: function (key) {\r\n\r\n            delete objects[key];\r\n\r\n        },\r\n\r\n        removeAll: function () {\r\n\r\n            objects = {};\r\n\r\n        }\r\n\r\n    };\r\n\r\n}\r\n\r\n/*********************************/\r\n/********** EXTENSIONS ***********/\r\n/*********************************/\r\n\r\nconst EXTENSIONS = {\r\n    KHR_BINARY_GLTF: 'KHR_binary_glTF',\r\n    KHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\r\n    KHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\r\n    KHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\r\n    KHR_MATERIALS_IOR: 'KHR_materials_ior',\r\n    KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\r\n    KHR_MATERIALS_SHEEN: 'KHR_materials_sheen',\r\n    KHR_MATERIALS_SPECULAR: 'KHR_materials_specular',\r\n    KHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\r\n    KHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\r\n    KHR_MATERIALS_VOLUME: 'KHR_materials_volume',\r\n    KHR_TEXTURE_BASISU: 'KHR_texture_basisu',\r\n    KHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\r\n    KHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\r\n    EXT_TEXTURE_WEBP: 'EXT_texture_webp',\r\n    EXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression'\r\n};\r\n\r\n/**\r\n * Punctual Lights Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\r\n */\r\nclass GLTFLightsExtension {\r\n\r\n    constructor(parser) {\r\n\r\n        this.parser = parser;\r\n        this.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\r\n\r\n        // THREE.Object3D instance caches\r\n        this.cache = { refs: {}, uses: {} };\r\n\r\n    }\r\n\r\n    _markDefs() {\r\n\r\n        const parser = this.parser;\r\n        const nodeDefs = this.parser.json.nodes || [];\r\n\r\n        for (let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex++) {\r\n\r\n            const nodeDef = nodeDefs[nodeIndex];\r\n\r\n            if (nodeDef.extensions\r\n                && nodeDef.extensions[this.name]\r\n                && nodeDef.extensions[this.name].light !== undefined) {\r\n\r\n                parser._addNodeRef(this.cache, nodeDef.extensions[this.name].light);\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    _loadLight(lightIndex) {\r\n\r\n        const parser = this.parser;\r\n        const cacheKey = 'light:' + lightIndex;\r\n        let dependency = parser.cache.get(cacheKey);\r\n\r\n        if (dependency) return dependency;\r\n\r\n        const json = parser.json;\r\n        const extensions = (json.extensions && json.extensions[this.name]) || {};\r\n        const lightDefs = extensions.lights || [];\r\n        const lightDef = lightDefs[lightIndex];\r\n        let lightNode;\r\n\r\n        const color = new THREE.Color(0xffffff);\r\n\r\n        if (lightDef.color !== undefined) color.fromArray(lightDef.color);\r\n\r\n        const range = lightDef.range !== undefined ? lightDef.range : 0;\r\n\r\n        switch (lightDef.type) {\r\n\r\n            case 'directional':\r\n                lightNode = new THREE.DirectionalLight(color);\r\n                lightNode.target.position.set(0, 0, - 1);\r\n                lightNode.add(lightNode.target);\r\n                break;\r\n\r\n            case 'point':\r\n                lightNode = new THREE.PointLight(color);\r\n                lightNode.distance = range;\r\n                break;\r\n\r\n            case 'spot':\r\n                lightNode = new THREE.SpotLight(color);\r\n                lightNode.distance = range;\r\n                // Handle spotlight properties.\r\n                lightDef.spot = lightDef.spot || {};\r\n                lightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\r\n                lightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\r\n                lightNode.angle = lightDef.spot.outerConeAngle;\r\n                lightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\r\n                lightNode.target.position.set(0, 0, - 1);\r\n                lightNode.add(lightNode.target);\r\n                break;\r\n\r\n            default:\r\n                throw new Error('THREE.GLTFLoader: Unexpected light type: ' + lightDef.type);\r\n\r\n        }\r\n\r\n        // Some lights (e.g. spot) default to a position other than the origin. Reset the position\r\n        // here, because node-level parsing will only override position if explicitly specified.\r\n        lightNode.position.set(0, 0, 0);\r\n\r\n        lightNode.decay = 2;\r\n\r\n        if (lightDef.intensity !== undefined) lightNode.intensity = lightDef.intensity;\r\n\r\n        lightNode.name = parser.createUniqueName(lightDef.name || ('light_' + lightIndex));\r\n\r\n        dependency = Promise.resolve(lightNode);\r\n\r\n        parser.cache.add(cacheKey, dependency);\r\n\r\n        return dependency;\r\n\r\n    }\r\n\r\n    createNodeAttachment(nodeIndex) {\r\n\r\n        const self = this;\r\n        const parser = this.parser;\r\n        const json = parser.json;\r\n        const nodeDef = json.nodes[nodeIndex];\r\n        const lightDef = (nodeDef.extensions && nodeDef.extensions[this.name]) || {};\r\n        const lightIndex = lightDef.light;\r\n\r\n        if (lightIndex === undefined) return null;\r\n\r\n        return this._loadLight(lightIndex).then(function (light) {\r\n\r\n            return parser._getNodeRef(self.cache, lightIndex, light);\r\n\r\n        });\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Unlit Materials Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\r\n */\r\nclass GLTFMaterialsUnlitExtension {\r\n\r\n    constructor() {\r\n\r\n        this.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\r\n\r\n    }\r\n\r\n    getMaterialType() {\r\n\r\n        return THREE.MeshBasicMaterial;\r\n\r\n    }\r\n\r\n    extendParams(materialParams, materialDef, parser) {\r\n\r\n        const pending = [];\r\n\r\n        materialParams.color = new THREE.Color(1.0, 1.0, 1.0);\r\n        materialParams.opacity = 1.0;\r\n\r\n        const metallicRoughness = materialDef.pbrMetallicRoughness;\r\n\r\n        if (metallicRoughness) {\r\n\r\n            if (Array.isArray(metallicRoughness.baseColorFactor)) {\r\n\r\n                const array = metallicRoughness.baseColorFactor;\r\n\r\n                materialParams.color.fromArray(array);\r\n                materialParams.opacity = array[3];\r\n\r\n            }\r\n\r\n            if (metallicRoughness.baseColorTexture !== undefined) {\r\n\r\n                pending.push(parser.assignTexture(materialParams, 'map', metallicRoughness.baseColorTexture));\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return Promise.all(pending);\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Clearcoat Materials Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\r\n */\r\nclass GLTFMaterialsClearcoatExtension {\r\n\r\n    constructor(parser) {\r\n\r\n        this.parser = parser;\r\n        this.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\r\n\r\n    }\r\n\r\n    getMaterialType(materialIndex) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) return null;\r\n\r\n        return THREE.MeshPhysicalMaterial;\r\n\r\n    }\r\n\r\n    extendMaterialParams(materialIndex, materialParams) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) {\r\n\r\n            return Promise.resolve();\r\n\r\n        }\r\n\r\n        const pending = [];\r\n\r\n        const extension = materialDef.extensions[this.name];\r\n\r\n        if (extension.clearcoatFactor !== undefined) {\r\n\r\n            materialParams.clearcoat = extension.clearcoatFactor;\r\n\r\n        }\r\n\r\n        if (extension.clearcoatTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'clearcoatMap', extension.clearcoatTexture));\r\n\r\n        }\r\n\r\n        if (extension.clearcoatRoughnessFactor !== undefined) {\r\n\r\n            materialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\r\n\r\n        }\r\n\r\n        if (extension.clearcoatRoughnessTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture));\r\n\r\n        }\r\n\r\n        if (extension.clearcoatNormalTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture));\r\n\r\n            if (extension.clearcoatNormalTexture.scale !== undefined) {\r\n\r\n                const scale = extension.clearcoatNormalTexture.scale;\r\n\r\n                materialParams.clearcoatNormalScale = new THREE.Vector2(scale, scale);\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return Promise.all(pending);\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Sheen Materials Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen\r\n */\r\nclass GLTFMaterialsSheenExtension {\r\n\r\n    constructor(parser) {\r\n\r\n        this.parser = parser;\r\n        this.name = EXTENSIONS.KHR_MATERIALS_SHEEN;\r\n\r\n    }\r\n\r\n    getMaterialType(materialIndex) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) return null;\r\n\r\n        return THREE.MeshPhysicalMaterial;\r\n\r\n    }\r\n\r\n    extendMaterialParams(materialIndex, materialParams) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) {\r\n\r\n            return Promise.resolve();\r\n\r\n        }\r\n\r\n        const pending = [];\r\n\r\n        materialParams.sheenColor = new THREE.Color(0, 0, 0);\r\n        materialParams.sheenRoughness = 0;\r\n        materialParams.sheen = 1;\r\n\r\n        const extension = materialDef.extensions[this.name];\r\n\r\n        if (extension.sheenColorFactor !== undefined) {\r\n\r\n            materialParams.sheenColor.fromArray(extension.sheenColorFactor);\r\n\r\n        }\r\n\r\n        if (extension.sheenRoughnessFactor !== undefined) {\r\n\r\n            materialParams.sheenRoughness = extension.sheenRoughnessFactor;\r\n\r\n        }\r\n\r\n        if (extension.sheenColorTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'sheenColorMap', extension.sheenColorTexture));\r\n\r\n        }\r\n\r\n        if (extension.sheenRoughnessTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture));\r\n\r\n        }\r\n\r\n        return Promise.all(pending);\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Transmission Materials Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\r\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\r\n */\r\nclass GLTFMaterialsTransmissionExtension {\r\n\r\n    constructor(parser) {\r\n\r\n        this.parser = parser;\r\n        this.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\r\n\r\n    }\r\n\r\n    getMaterialType(materialIndex) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) return null;\r\n\r\n        return THREE.MeshPhysicalMaterial;\r\n\r\n    }\r\n\r\n    extendMaterialParams(materialIndex, materialParams) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) {\r\n\r\n            return Promise.resolve();\r\n\r\n        }\r\n\r\n        const pending = [];\r\n\r\n        const extension = materialDef.extensions[this.name];\r\n\r\n        if (extension.transmissionFactor !== undefined) {\r\n\r\n            materialParams.transmission = extension.transmissionFactor;\r\n\r\n        }\r\n\r\n        if (extension.transmissionTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'transmissionMap', extension.transmissionTexture));\r\n\r\n        }\r\n\r\n        return Promise.all(pending);\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Materials Volume Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume\r\n */\r\nclass GLTFMaterialsVolumeExtension {\r\n\r\n    constructor(parser) {\r\n\r\n        this.parser = parser;\r\n        this.name = EXTENSIONS.KHR_MATERIALS_VOLUME;\r\n\r\n    }\r\n\r\n    getMaterialType(materialIndex) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) return null;\r\n\r\n        return THREE.MeshPhysicalMaterial;\r\n\r\n    }\r\n\r\n    extendMaterialParams(materialIndex, materialParams) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) {\r\n\r\n            return Promise.resolve();\r\n\r\n        }\r\n\r\n        const pending = [];\r\n\r\n        const extension = materialDef.extensions[this.name];\r\n\r\n        materialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;\r\n\r\n        if (extension.thicknessTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'thicknessMap', extension.thicknessTexture));\r\n\r\n        }\r\n\r\n        materialParams.attenuationDistance = extension.attenuationDistance || 0;\r\n\r\n        const colorArray = extension.attenuationColor || [1, 1, 1];\r\n        materialParams.attenuationColor = new THREE.Color(colorArray[0], colorArray[1], colorArray[2]);\r\n\r\n        return Promise.all(pending);\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Materials ior Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior\r\n */\r\nclass GLTFMaterialsIorExtension {\r\n\r\n    constructor(parser) {\r\n\r\n        this.parser = parser;\r\n        this.name = EXTENSIONS.KHR_MATERIALS_IOR;\r\n\r\n    }\r\n\r\n    getMaterialType(materialIndex) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) return null;\r\n\r\n        return THREE.MeshPhysicalMaterial;\r\n\r\n    }\r\n\r\n    extendMaterialParams(materialIndex, materialParams) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) {\r\n\r\n            return Promise.resolve();\r\n\r\n        }\r\n\r\n        const extension = materialDef.extensions[this.name];\r\n\r\n        materialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;\r\n\r\n        return Promise.resolve();\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Materials specular Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular\r\n */\r\nclass GLTFMaterialsSpecularExtension {\r\n\r\n    constructor(parser) {\r\n\r\n        this.parser = parser;\r\n        this.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;\r\n\r\n    }\r\n\r\n    getMaterialType(materialIndex) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) return null;\r\n\r\n        return THREE.MeshPhysicalMaterial;\r\n\r\n    }\r\n\r\n    extendMaterialParams(materialIndex, materialParams) {\r\n\r\n        const parser = this.parser;\r\n        const materialDef = parser.json.materials[materialIndex];\r\n\r\n        if (!materialDef.extensions || !materialDef.extensions[this.name]) {\r\n\r\n            return Promise.resolve();\r\n\r\n        }\r\n\r\n        const pending = [];\r\n\r\n        const extension = materialDef.extensions[this.name];\r\n\r\n        materialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;\r\n\r\n        if (extension.specularTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'specularIntensityMap', extension.specularTexture));\r\n\r\n        }\r\n\r\n        const colorArray = extension.specularColorFactor || [1, 1, 1];\r\n        materialParams.specularColor = new THREE.Color(colorArray[0], colorArray[1], colorArray[2]);\r\n\r\n        if (extension.specularColorTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'specularColorMap', extension.specularColorTexture).then(function (texture) {\r\n\r\n                texture.encoding = THREE.sRGBEncoding;\r\n\r\n            }));\r\n\r\n        }\r\n\r\n        return Promise.all(pending);\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * BasisU THREE.Texture Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\r\n */\r\nclass GLTFTextureBasisUExtension {\r\n\r\n    constructor(parser) {\r\n\r\n        this.parser = parser;\r\n        this.name = EXTENSIONS.KHR_TEXTURE_BASISU;\r\n\r\n    }\r\n\r\n    loadTexture(textureIndex) {\r\n\r\n        const parser = this.parser;\r\n        const json = parser.json;\r\n\r\n        const textureDef = json.textures[textureIndex];\r\n\r\n        if (!textureDef.extensions || !textureDef.extensions[this.name]) {\r\n\r\n            return null;\r\n\r\n        }\r\n\r\n        const extension = textureDef.extensions[this.name];\r\n        const source = json.images[extension.source];\r\n        const loader = parser.options.ktx2Loader;\r\n\r\n        if (!loader) {\r\n\r\n            if (json.extensionsRequired && json.extensionsRequired.indexOf(this.name) >= 0) {\r\n\r\n                throw new Error('THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures');\r\n\r\n            } else {\r\n\r\n                // Assumes that the extension is optional and that a fallback texture is present\r\n                return null;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return parser.loadTextureImage(textureIndex, source, loader);\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * WebP THREE.Texture Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\r\n */\r\nclass GLTFTextureWebPExtension {\r\n\r\n    constructor(parser) {\r\n\r\n        this.parser = parser;\r\n        this.name = EXTENSIONS.EXT_TEXTURE_WEBP;\r\n        this.isSupported = null;\r\n\r\n    }\r\n\r\n    loadTexture(textureIndex) {\r\n\r\n        const name = this.name;\r\n        const parser = this.parser;\r\n        const json = parser.json;\r\n\r\n        const textureDef = json.textures[textureIndex];\r\n\r\n        if (!textureDef.extensions || !textureDef.extensions[name]) {\r\n\r\n            return null;\r\n\r\n        }\r\n\r\n        const extension = textureDef.extensions[name];\r\n        const source = json.images[extension.source];\r\n\r\n        let loader = parser.textureLoader;\r\n        if (source.uri) {\r\n\r\n            const handler = parser.options.manager.getHandler(source.uri);\r\n            if (handler !== null) loader = handler;\r\n\r\n        }\r\n\r\n        return this.detectSupport().then(function (isSupported) {\r\n\r\n            if (isSupported) return parser.loadTextureImage(textureIndex, source, loader);\r\n\r\n            if (json.extensionsRequired && json.extensionsRequired.indexOf(name) >= 0) {\r\n\r\n                throw new Error('THREE.GLTFLoader: WebP required by asset but unsupported.');\r\n\r\n            }\r\n\r\n            // Fall back to PNG or JPEG.\r\n            return parser.loadTexture(textureIndex);\r\n\r\n        });\r\n\r\n    }\r\n\r\n    detectSupport() {\r\n\r\n        if (!this.isSupported) {\r\n\r\n            this.isSupported = new Promise(function (resolve) {\r\n\r\n                const image = new Image();\r\n\r\n                // Lossy test image. Support for lossy images doesn't guarantee support for all\r\n                // WebP images, unfortunately.\r\n                image.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\r\n\r\n                image.onload = image.onerror = function () {\r\n\r\n                    resolve(image.height === 1);\r\n\r\n                };\r\n\r\n            });\r\n\r\n        }\r\n\r\n        return this.isSupported;\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * meshopt BufferView Compression Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\r\n */\r\nclass GLTFMeshoptCompression {\r\n\r\n    constructor(parser) {\r\n\r\n        this.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\r\n        this.parser = parser;\r\n\r\n    }\r\n\r\n    loadBufferView(index) {\r\n\r\n        const json = this.parser.json;\r\n        const bufferView = json.bufferViews[index];\r\n\r\n        if (bufferView.extensions && bufferView.extensions[this.name]) {\r\n\r\n            const extensionDef = bufferView.extensions[this.name];\r\n\r\n            const buffer = this.parser.getDependency('buffer', extensionDef.buffer);\r\n            const decoder = this.parser.options.meshoptDecoder;\r\n\r\n            if (!decoder || !decoder.supported) {\r\n\r\n                if (json.extensionsRequired && json.extensionsRequired.indexOf(this.name) >= 0) {\r\n\r\n                    throw new Error('THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files');\r\n\r\n                } else {\r\n\r\n                    // Assumes that the extension is optional and that fallback buffer data is present\r\n                    return null;\r\n\r\n                }\r\n\r\n            }\r\n\r\n            return Promise.all([buffer, decoder.ready]).then(function (res) {\r\n\r\n                const byteOffset = extensionDef.byteOffset || 0;\r\n                const byteLength = extensionDef.byteLength || 0;\r\n\r\n                const count = extensionDef.count;\r\n                const stride = extensionDef.byteStride;\r\n\r\n                const result = new ArrayBuffer(count * stride);\r\n                const source = new Uint8Array(res[0], byteOffset, byteLength);\r\n\r\n                decoder.decodeGltfBuffer(new Uint8Array(result), count, stride, source, extensionDef.mode, extensionDef.filter);\r\n                return result;\r\n\r\n            });\r\n\r\n        } else {\r\n\r\n            return null;\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n/* BINARY EXTENSION */\r\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\r\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\r\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\r\n\r\nclass GLTFBinaryExtension {\r\n\r\n    constructor(data) {\r\n\r\n        this.name = EXTENSIONS.KHR_BINARY_GLTF;\r\n        this.content = null;\r\n        this.body = null;\r\n\r\n        const headerView = new DataView(data, 0, BINARY_EXTENSION_HEADER_LENGTH);\r\n\r\n        this.header = {\r\n            magic: THREE.LoaderUtils.decodeText(new Uint8Array(data.slice(0, 4))),\r\n            version: headerView.getUint32(4, true),\r\n            length: headerView.getUint32(8, true)\r\n        };\r\n\r\n        if (this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC) {\r\n\r\n            throw new Error('THREE.GLTFLoader: Unsupported glTF-Binary header.');\r\n\r\n        } else if (this.header.version < 2.0) {\r\n\r\n            throw new Error('THREE.GLTFLoader: Legacy binary file detected.');\r\n\r\n        }\r\n\r\n        const chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\r\n        const chunkView = new DataView(data, BINARY_EXTENSION_HEADER_LENGTH);\r\n        let chunkIndex = 0;\r\n\r\n        while (chunkIndex < chunkContentsLength) {\r\n\r\n            const chunkLength = chunkView.getUint32(chunkIndex, true);\r\n            chunkIndex += 4;\r\n\r\n            const chunkType = chunkView.getUint32(chunkIndex, true);\r\n            chunkIndex += 4;\r\n\r\n            if (chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON) {\r\n\r\n                const contentArray = new Uint8Array(data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength);\r\n                this.content = THREE.LoaderUtils.decodeText(contentArray);\r\n\r\n            } else if (chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN) {\r\n\r\n                const byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\r\n                this.body = data.slice(byteOffset, byteOffset + chunkLength);\r\n\r\n            }\r\n\r\n            // Clients must ignore chunks with unknown types.\r\n\r\n            chunkIndex += chunkLength;\r\n\r\n        }\r\n\r\n        if (this.content === null) {\r\n\r\n            throw new Error('THREE.GLTFLoader: JSON content not found.');\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * DRACO THREE.Mesh Compression Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\r\n */\r\nclass GLTFDracoMeshCompressionExtension {\r\n\r\n    constructor(json, dracoLoader) {\r\n\r\n        if (!dracoLoader) {\r\n\r\n            throw new Error('THREE.GLTFLoader: No DRACOLoader instance provided.');\r\n\r\n        }\r\n\r\n        this.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\r\n        this.json = json;\r\n        this.dracoLoader = dracoLoader;\r\n        this.dracoLoader.preload();\r\n\r\n    }\r\n\r\n    decodePrimitive(primitive, parser) {\r\n\r\n        const json = this.json;\r\n        const dracoLoader = this.dracoLoader;\r\n        const bufferViewIndex = primitive.extensions[this.name].bufferView;\r\n        const gltfAttributeMap = primitive.extensions[this.name].attributes;\r\n        const threeAttributeMap = {};\r\n        const attributeNormalizedMap = {};\r\n        const attributeTypeMap = {};\r\n\r\n        for (const attributeName in gltfAttributeMap) {\r\n\r\n            const threeAttributeName = ATTRIBUTES[attributeName] || attributeName.toLowerCase();\r\n\r\n            threeAttributeMap[threeAttributeName] = gltfAttributeMap[attributeName];\r\n\r\n        }\r\n\r\n        for (const attributeName in primitive.attributes) {\r\n\r\n            const threeAttributeName = ATTRIBUTES[attributeName] || attributeName.toLowerCase();\r\n\r\n            if (gltfAttributeMap[attributeName] !== undefined) {\r\n\r\n                const accessorDef = json.accessors[primitive.attributes[attributeName]];\r\n                const componentType = WEBGL_COMPONENT_TYPES[accessorDef.componentType];\r\n\r\n                attributeTypeMap[threeAttributeName] = componentType;\r\n                attributeNormalizedMap[threeAttributeName] = accessorDef.normalized === true;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return parser.getDependency('bufferView', bufferViewIndex).then(function (bufferView) {\r\n\r\n            return new Promise(function (resolve) {\r\n\r\n                dracoLoader.decodeDracoFile(bufferView, function (geometry) {\r\n\r\n                    for (const attributeName in geometry.attributes) {\r\n\r\n                        const attribute = geometry.attributes[attributeName];\r\n                        const normalized = attributeNormalizedMap[attributeName];\r\n\r\n                        if (normalized !== undefined) attribute.normalized = normalized;\r\n\r\n                    }\r\n\r\n                    resolve(geometry);\r\n\r\n                }, threeAttributeMap, attributeTypeMap);\r\n\r\n            });\r\n\r\n        });\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * THREE.Texture Transform Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\r\n */\r\nclass GLTFTextureTransformExtension {\r\n\r\n    constructor() {\r\n\r\n        this.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\r\n\r\n    }\r\n\r\n    extendTexture(texture, transform) {\r\n\r\n        if (transform.texCoord !== undefined) {\r\n\r\n            console.warn('THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.');\r\n\r\n        }\r\n\r\n        if (transform.offset === undefined && transform.rotation === undefined && transform.scale === undefined) {\r\n\r\n            // See https://github.com/mrdoob/three.js/issues/21819.\r\n            return texture;\r\n\r\n        }\r\n\r\n        texture = texture.clone();\r\n\r\n        if (transform.offset !== undefined) {\r\n\r\n            texture.offset.fromArray(transform.offset);\r\n\r\n        }\r\n\r\n        if (transform.rotation !== undefined) {\r\n\r\n            texture.rotation = transform.rotation;\r\n\r\n        }\r\n\r\n        if (transform.scale !== undefined) {\r\n\r\n            texture.repeat.fromArray(transform.scale);\r\n\r\n        }\r\n\r\n        texture.needsUpdate = true;\r\n\r\n        return texture;\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Specular-Glossiness Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Archived/KHR_materials_pbrSpecularGlossiness\r\n */\r\n\r\n/**\r\n * A sub class of StandardMaterial with some of the functionality\r\n * changed via the `onBeforeCompile` callback\r\n * @pailhead\r\n */\r\nclass GLTFMeshStandardSGMaterial extends THREE.MeshStandardMaterial {\r\n\r\n    constructor(params) {\r\n\r\n        super();\r\n\r\n        this.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n        //various chunks that need replacing\r\n        const specularMapParsFragmentChunk = [\r\n            '#ifdef USE_SPECULARMAP',\r\n            '\tuniform sampler2D specularMap;',\r\n            '#endif'\r\n        ].join('\\n');\r\n\r\n        const glossinessMapParsFragmentChunk = [\r\n            '#ifdef USE_GLOSSINESSMAP',\r\n            '\tuniform sampler2D glossinessMap;',\r\n            '#endif'\r\n        ].join('\\n');\r\n\r\n        const specularMapFragmentChunk = [\r\n            'vec3 specularFactor = specular;',\r\n            '#ifdef USE_SPECULARMAP',\r\n            '\tvec4 texelSpecular = texture2D( specularMap, vUv );',\r\n            '\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n            '\tspecularFactor *= texelSpecular.rgb;',\r\n            '#endif'\r\n        ].join('\\n');\r\n\r\n        const glossinessMapFragmentChunk = [\r\n            'float glossinessFactor = glossiness;',\r\n            '#ifdef USE_GLOSSINESSMAP',\r\n            '\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\r\n            '\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n            '\tglossinessFactor *= texelGlossiness.a;',\r\n            '#endif'\r\n        ].join('\\n');\r\n\r\n        const lightPhysicalFragmentChunk = [\r\n            'PhysicalMaterial material;',\r\n            'material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );',\r\n            'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\r\n            'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\r\n            'material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.',\r\n            'material.roughness += geometryRoughness;',\r\n            'material.roughness = min( material.roughness, 1.0 );',\r\n            'material.specularColor = specularFactor;',\r\n        ].join('\\n');\r\n\r\n        const uniforms = {\r\n            specular: { value: new THREE.Color().setHex(0xffffff) },\r\n            glossiness: { value: 1 },\r\n            specularMap: { value: null },\r\n            glossinessMap: { value: null }\r\n        };\r\n\r\n        this._extraUniforms = uniforms;\r\n\r\n        this.onBeforeCompile = function (shader) {\r\n\r\n            for (const uniformName in uniforms) {\r\n\r\n                shader.uniforms[uniformName] = uniforms[uniformName];\r\n\r\n            }\r\n\r\n            shader.fragmentShader = shader.fragmentShader\r\n                .replace('uniform float roughness;', 'uniform vec3 specular;')\r\n                .replace('uniform float metalness;', 'uniform float glossiness;')\r\n                .replace('#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk)\r\n                .replace('#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk)\r\n                .replace('#include <roughnessmap_fragment>', specularMapFragmentChunk)\r\n                .replace('#include <metalnessmap_fragment>', glossinessMapFragmentChunk)\r\n                .replace('#include <lights_physical_fragment>', lightPhysicalFragmentChunk);\r\n\r\n        };\r\n\r\n        Object.defineProperties(this, {\r\n\r\n            specular: {\r\n                get: function () {\r\n\r\n                    return uniforms.specular.value;\r\n\r\n                },\r\n                set: function (v) {\r\n\r\n                    uniforms.specular.value = v;\r\n\r\n                }\r\n            },\r\n\r\n            specularMap: {\r\n                get: function () {\r\n\r\n                    return uniforms.specularMap.value;\r\n\r\n                },\r\n                set: function (v) {\r\n\r\n                    uniforms.specularMap.value = v;\r\n\r\n                    if (v) {\r\n\r\n                        this.defines.USE_SPECULARMAP = ''; // USE_UV is set by the renderer for specular maps\r\n\r\n                    } else {\r\n\r\n                        delete this.defines.USE_SPECULARMAP;\r\n\r\n                    }\r\n\r\n                }\r\n            },\r\n\r\n            glossiness: {\r\n                get: function () {\r\n\r\n                    return uniforms.glossiness.value;\r\n\r\n                },\r\n                set: function (v) {\r\n\r\n                    uniforms.glossiness.value = v;\r\n\r\n                }\r\n            },\r\n\r\n            glossinessMap: {\r\n                get: function () {\r\n\r\n                    return uniforms.glossinessMap.value;\r\n\r\n                },\r\n                set: function (v) {\r\n\r\n                    uniforms.glossinessMap.value = v;\r\n\r\n                    if (v) {\r\n\r\n                        this.defines.USE_GLOSSINESSMAP = '';\r\n                        this.defines.USE_UV = '';\r\n\r\n                    } else {\r\n\r\n                        delete this.defines.USE_GLOSSINESSMAP;\r\n                        delete this.defines.USE_UV;\r\n\r\n                    }\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n\r\n        delete this.metalness;\r\n        delete this.roughness;\r\n        delete this.metalnessMap;\r\n        delete this.roughnessMap;\r\n\r\n        this.setValues(params);\r\n\r\n    }\r\n\r\n    copy(source) {\r\n\r\n        super.copy(source);\r\n\r\n        this.specularMap = source.specularMap;\r\n        this.specular.copy(source.specular);\r\n        this.glossinessMap = source.glossinessMap;\r\n        this.glossiness = source.glossiness;\r\n        delete this.metalness;\r\n        delete this.roughness;\r\n        delete this.metalnessMap;\r\n        delete this.roughnessMap;\r\n        return this;\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nclass GLTFMaterialsPbrSpecularGlossinessExtension {\r\n\r\n    constructor() {\r\n\r\n        this.name = EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\r\n\r\n        this.specularGlossinessParams = [\r\n            'color',\r\n            'map',\r\n            'lightMap',\r\n            'lightMapIntensity',\r\n            'aoMap',\r\n            'aoMapIntensity',\r\n            'emissive',\r\n            'emissiveIntensity',\r\n            'emissiveMap',\r\n            'bumpMap',\r\n            'bumpScale',\r\n            'normalMap',\r\n            'normalMapType',\r\n            'displacementMap',\r\n            'displacementScale',\r\n            'displacementBias',\r\n            'specularMap',\r\n            'specular',\r\n            'glossinessMap',\r\n            'glossiness',\r\n            'alphaMap',\r\n            'envMap',\r\n            'envMapIntensity',\r\n            'refractionRatio',\r\n        ];\r\n\r\n    }\r\n\r\n    getMaterialType() {\r\n\r\n        return GLTFMeshStandardSGMaterial;\r\n\r\n    }\r\n\r\n    extendParams(materialParams, materialDef, parser) {\r\n\r\n        const pbrSpecularGlossiness = materialDef.extensions[this.name];\r\n\r\n        materialParams.color = new THREE.Color(1.0, 1.0, 1.0);\r\n        materialParams.opacity = 1.0;\r\n\r\n        const pending = [];\r\n\r\n        if (Array.isArray(pbrSpecularGlossiness.diffuseFactor)) {\r\n\r\n            const array = pbrSpecularGlossiness.diffuseFactor;\r\n\r\n            materialParams.color.fromArray(array);\r\n            materialParams.opacity = array[3];\r\n\r\n        }\r\n\r\n        if (pbrSpecularGlossiness.diffuseTexture !== undefined) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'map', pbrSpecularGlossiness.diffuseTexture));\r\n\r\n        }\r\n\r\n        materialParams.emissive = new THREE.Color(0.0, 0.0, 0.0);\r\n        materialParams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\r\n        materialParams.specular = new THREE.Color(1.0, 1.0, 1.0);\r\n\r\n        if (Array.isArray(pbrSpecularGlossiness.specularFactor)) {\r\n\r\n            materialParams.specular.fromArray(pbrSpecularGlossiness.specularFactor);\r\n\r\n        }\r\n\r\n        if (pbrSpecularGlossiness.specularGlossinessTexture !== undefined) {\r\n\r\n            const specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\r\n            pending.push(parser.assignTexture(materialParams, 'glossinessMap', specGlossMapDef));\r\n            pending.push(parser.assignTexture(materialParams, 'specularMap', specGlossMapDef));\r\n\r\n        }\r\n\r\n        return Promise.all(pending);\r\n\r\n    }\r\n\r\n    createMaterial(materialParams) {\r\n\r\n        const material = new GLTFMeshStandardSGMaterial(materialParams);\r\n        material.fog = true;\r\n\r\n        material.color = materialParams.color;\r\n\r\n        material.map = materialParams.map === undefined ? null : materialParams.map;\r\n\r\n        material.lightMap = null;\r\n        material.lightMapIntensity = 1.0;\r\n\r\n        material.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\r\n        material.aoMapIntensity = 1.0;\r\n\r\n        material.emissive = materialParams.emissive;\r\n        material.emissiveIntensity = 1.0;\r\n        material.emissiveMap = materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\r\n\r\n        material.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\r\n        material.bumpScale = 1;\r\n\r\n        material.normalMap = materialParams.normalMap === undefined ? null : materialParams.normalMap;\r\n        material.normalMapType = THREE.TangentSpaceNormalMap;\r\n\r\n        if (materialParams.normalScale) material.normalScale = materialParams.normalScale;\r\n\r\n        material.displacementMap = null;\r\n        material.displacementScale = 1;\r\n        material.displacementBias = 0;\r\n\r\n        material.specularMap = materialParams.specularMap === undefined ? null : materialParams.specularMap;\r\n        material.specular = materialParams.specular;\r\n\r\n        material.glossinessMap = materialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\r\n        material.glossiness = materialParams.glossiness;\r\n\r\n        material.alphaMap = null;\r\n\r\n        material.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\r\n        material.envMapIntensity = 1.0;\r\n\r\n        material.refractionRatio = 0.98;\r\n\r\n        return material;\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * THREE.Mesh Quantization Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\r\n */\r\nclass GLTFMeshQuantizationExtension {\r\n\r\n    constructor() {\r\n\r\n        this.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\r\n\r\n    }\r\n\r\n}\r\n\r\n/*********************************/\r\n/********** INTERPOLATION ********/\r\n/*********************************/\r\n\r\n// Spline Interpolation\r\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\r\nclass GLTFCubicSplineInterpolant extends THREE.Interpolant {\r\n\r\n    constructor(parameterPositions, sampleValues, sampleSize, resultBuffer) {\r\n\r\n        super(parameterPositions, sampleValues, sampleSize, resultBuffer);\r\n\r\n    }\r\n\r\n    copySampleValue_(index) {\r\n\r\n        // Copies a sample value to the result buffer. See description of glTF\r\n        // CUBICSPLINE values layout in interpolate_() function below.\r\n\r\n        const result = this.resultBuffer,\r\n            values = this.sampleValues,\r\n            valueSize = this.valueSize,\r\n            offset = index * valueSize * 3 + valueSize;\r\n\r\n        for (let i = 0; i !== valueSize; i++) {\r\n\r\n            result[i] = values[offset + i];\r\n\r\n        }\r\n\r\n        return result;\r\n\r\n    }\r\n\r\n}\r\n\r\nGLTFCubicSplineInterpolant.prototype.beforeStart_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\nGLTFCubicSplineInterpolant.prototype.afterEnd_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\nGLTFCubicSplineInterpolant.prototype.interpolate_ = function (i1, t0, t, t1) {\r\n\r\n    const result = this.resultBuffer;\r\n    const values = this.sampleValues;\r\n    const stride = this.valueSize;\r\n\r\n    const stride2 = stride * 2;\r\n    const stride3 = stride * 3;\r\n\r\n    const td = t1 - t0;\r\n\r\n    const p = (t - t0) / td;\r\n    const pp = p * p;\r\n    const ppp = pp * p;\r\n\r\n    const offset1 = i1 * stride3;\r\n    const offset0 = offset1 - stride3;\r\n\r\n    const s2 = - 2 * ppp + 3 * pp;\r\n    const s3 = ppp - pp;\r\n    const s0 = 1 - s2;\r\n    const s1 = s3 - pp + p;\r\n\r\n    // Layout of keyframe output values for CUBICSPLINE animations:\r\n    //   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\r\n    for (let i = 0; i !== stride; i++) {\r\n\r\n        const p0 = values[offset0 + i + stride]; // splineVertex_k\r\n        const m0 = values[offset0 + i + stride2] * td; // outTangent_k * (t_k+1 - t_k)\r\n        const p1 = values[offset1 + i + stride]; // splineVertex_k+1\r\n        const m1 = values[offset1 + i] * td; // inTangent_k+1 * (t_k+1 - t_k)\r\n\r\n        result[i] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n};\r\n\r\nconst _q = new THREE.Quaternion();\r\n\r\nclass GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {\r\n\r\n    interpolate_(i1, t0, t, t1) {\r\n\r\n        const result = super.interpolate_(i1, t0, t, t1);\r\n\r\n        _q.fromArray(result).normalize().toArray(result);\r\n\r\n        return result;\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n/*********************************/\r\n/********** INTERNALS ************/\r\n/*********************************/\r\n\r\n/* CONSTANTS */\r\n\r\nconst WEBGL_CONSTANTS = {\r\n    FLOAT: 5126,\r\n    //FLOAT_MAT2: 35674,\r\n    FLOAT_MAT3: 35675,\r\n    FLOAT_MAT4: 35676,\r\n    FLOAT_VEC2: 35664,\r\n    FLOAT_VEC3: 35665,\r\n    FLOAT_VEC4: 35666,\r\n    LINEAR: 9729,\r\n    REPEAT: 10497,\r\n    SAMPLER_2D: 35678,\r\n    POINTS: 0,\r\n    LINES: 1,\r\n    LINE_LOOP: 2,\r\n    LINE_STRIP: 3,\r\n    TRIANGLES: 4,\r\n    TRIANGLE_STRIP: 5,\r\n    TRIANGLE_FAN: 6,\r\n    UNSIGNED_BYTE: 5121,\r\n    UNSIGNED_SHORT: 5123\r\n};\r\n\r\nconst WEBGL_COMPONENT_TYPES = {\r\n    5120: Int8Array,\r\n    5121: Uint8Array,\r\n    5122: Int16Array,\r\n    5123: Uint16Array,\r\n    5125: Uint32Array,\r\n    5126: Float32Array\r\n};\r\n\r\nconst WEBGL_FILTERS = {\r\n    9728: THREE.NearestFilter,\r\n    9729: THREE.LinearFilter,\r\n    9984: THREE.NearestMipmapNearestFilter,\r\n    9985: THREE.LinearMipmapNearestFilter,\r\n    9986: THREE.NearestMipmapLinearFilter,\r\n    9987: THREE.LinearMipmapLinearFilter\r\n};\r\n\r\nconst WEBGL_WRAPPINGS = {\r\n    33071: THREE.ClampToEdgeWrapping,\r\n    33648: THREE.MirroredRepeatWrapping,\r\n    10497: THREE.RepeatWrapping\r\n};\r\n\r\nconst WEBGL_TYPE_SIZES = {\r\n    'SCALAR': 1,\r\n    'VEC2': 2,\r\n    'VEC3': 3,\r\n    'VEC4': 4,\r\n    'MAT2': 4,\r\n    'MAT3': 9,\r\n    'MAT4': 16\r\n};\r\n\r\nconst ATTRIBUTES = {\r\n    POSITION: 'position',\r\n    NORMAL: 'normal',\r\n    TANGENT: 'tangent',\r\n    TEXCOORD_0: 'uv',\r\n    TEXCOORD_1: 'uv2',\r\n    COLOR_0: 'color',\r\n    WEIGHTS_0: 'skinWeight',\r\n    JOINTS_0: 'skinIndex',\r\n};\r\n\r\nconst PATH_PROPERTIES = {\r\n    scale: 'scale',\r\n    translation: 'position',\r\n    rotation: 'quaternion',\r\n    weights: 'morphTargetInfluences'\r\n};\r\n\r\nconst INTERPOLATION = {\r\n    CUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\r\n    // keyframe track will be initialized with a default interpolation type, then modified.\r\n    LINEAR: THREE.InterpolateLinear,\r\n    STEP: THREE.InterpolateDiscrete\r\n};\r\n\r\nconst ALPHA_MODES = {\r\n    OPAQUE: 'OPAQUE',\r\n    MASK: 'MASK',\r\n    BLEND: 'BLEND'\r\n};\r\n\r\n/**\r\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\r\n */\r\nfunction createDefaultMaterial(cache) {\r\n\r\n    if (cache['DefaultMaterial'] === undefined) {\r\n\r\n        cache['DefaultMaterial'] = new THREE.MeshStandardMaterial({\r\n            color: 0xFFFFFF,\r\n            emissive: 0x000000,\r\n            metalness: 1,\r\n            roughness: 1,\r\n            transparent: false,\r\n            depthTest: true,\r\n            side: THREE.FrontSide\r\n        });\r\n\r\n    }\r\n\r\n    return cache['DefaultMaterial'];\r\n\r\n}\r\n\r\nfunction addUnknownExtensionsToUserData(knownExtensions, object, objectDef) {\r\n\r\n    // Add unknown glTF extensions to an object's userData.\r\n\r\n    for (const name in objectDef.extensions) {\r\n\r\n        if (knownExtensions[name] === undefined) {\r\n\r\n            object.userData.gltfExtensions = object.userData.gltfExtensions || {};\r\n            object.userData.gltfExtensions[name] = objectDef.extensions[name];\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * @param {THREE.Object3D|THREE.Material|THREE.BufferGeometry} object\r\n * @param {GLTF.definition} gltfDef\r\n */\r\nfunction assignExtrasToUserData(object, gltfDef) {\r\n\r\n    if (gltfDef.extras !== undefined) {\r\n\r\n        if (typeof gltfDef.extras === 'object') {\r\n\r\n            Object.assign(object.userData, gltfDef.extras);\r\n\r\n        } else {\r\n\r\n            console.warn('THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras);\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\r\n *\r\n * @param {THREE.BufferGeometry} geometry\r\n * @param {Array<GLTF.Target>} targets\r\n * @param {GLTFParser} parser\r\n * @return {Promise<THREE.BufferGeometry>}\r\n */\r\nfunction addMorphTargets(geometry, targets, parser) {\r\n\r\n    let hasMorphPosition = false;\r\n    let hasMorphNormal = false;\r\n\r\n    for (let i = 0, il = targets.length; i < il; i++) {\r\n\r\n        const target = targets[i];\r\n\r\n        if (target.POSITION !== undefined) hasMorphPosition = true;\r\n        if (target.NORMAL !== undefined) hasMorphNormal = true;\r\n\r\n        if (hasMorphPosition && hasMorphNormal) break;\r\n\r\n    }\r\n\r\n    if (!hasMorphPosition && !hasMorphNormal) return Promise.resolve(geometry);\r\n\r\n    const pendingPositionAccessors = [];\r\n    const pendingNormalAccessors = [];\r\n\r\n    for (let i = 0, il = targets.length; i < il; i++) {\r\n\r\n        const target = targets[i];\r\n\r\n        if (hasMorphPosition) {\r\n\r\n            const pendingAccessor = target.POSITION !== undefined\r\n                ? parser.getDependency('accessor', target.POSITION)\r\n                : geometry.attributes.position;\r\n\r\n            pendingPositionAccessors.push(pendingAccessor);\r\n\r\n        }\r\n\r\n        if (hasMorphNormal) {\r\n\r\n            const pendingAccessor = target.NORMAL !== undefined\r\n                ? parser.getDependency('accessor', target.NORMAL)\r\n                : geometry.attributes.normal;\r\n\r\n            pendingNormalAccessors.push(pendingAccessor);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return Promise.all([\r\n        Promise.all(pendingPositionAccessors),\r\n        Promise.all(pendingNormalAccessors)\r\n    ]).then(function (accessors) {\r\n\r\n        const morphPositions = accessors[0];\r\n        const morphNormals = accessors[1];\r\n\r\n        if (hasMorphPosition) geometry.morphAttributes.position = morphPositions;\r\n        if (hasMorphNormal) geometry.morphAttributes.normal = morphNormals;\r\n        geometry.morphTargetsRelative = true;\r\n\r\n        return geometry;\r\n\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * @param {THREE.Mesh} mesh\r\n * @param {GLTF.THREE.Mesh} meshDef\r\n */\r\nfunction updateMorphTargets(mesh, meshDef) {\r\n\r\n    mesh.updateMorphTargets();\r\n\r\n    if (meshDef.weights !== undefined) {\r\n\r\n        for (let i = 0, il = meshDef.weights.length; i < il; i++) {\r\n\r\n            mesh.morphTargetInfluences[i] = meshDef.weights[i];\r\n\r\n        }\r\n\r\n    }\r\n\r\n    // .extras has user-defined data, so check that .extras.targetNames is an array.\r\n    if (meshDef.extras && Array.isArray(meshDef.extras.targetNames)) {\r\n\r\n        const targetNames = meshDef.extras.targetNames;\r\n\r\n        if (mesh.morphTargetInfluences.length === targetNames.length) {\r\n\r\n            mesh.morphTargetDictionary = {};\r\n\r\n            for (let i = 0, il = targetNames.length; i < il; i++) {\r\n\r\n                mesh.morphTargetDictionary[targetNames[i]] = i;\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            console.warn('THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.');\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction createPrimitiveKey(primitiveDef) {\r\n\r\n    const dracoExtension = primitiveDef.extensions && primitiveDef.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];\r\n    let geometryKey;\r\n\r\n    if (dracoExtension) {\r\n\r\n        geometryKey = 'draco:' + dracoExtension.bufferView\r\n            + ':' + dracoExtension.indices\r\n            + ':' + createAttributesKey(dracoExtension.attributes);\r\n\r\n    } else {\r\n\r\n        geometryKey = primitiveDef.indices + ':' + createAttributesKey(primitiveDef.attributes) + ':' + primitiveDef.mode;\r\n\r\n    }\r\n\r\n    return geometryKey;\r\n\r\n}\r\n\r\nfunction createAttributesKey(attributes) {\r\n\r\n    let attributesKey = '';\r\n\r\n    const keys = Object.keys(attributes).sort();\r\n\r\n    for (let i = 0, il = keys.length; i < il; i++) {\r\n\r\n        attributesKey += keys[i] + ':' + attributes[keys[i]] + ';';\r\n\r\n    }\r\n\r\n    return attributesKey;\r\n\r\n}\r\n\r\nfunction getNormalizedComponentScale(constructor) {\r\n\r\n    // Reference:\r\n    // https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\r\n\r\n    switch (constructor) {\r\n\r\n        case Int8Array:\r\n            return 1 / 127;\r\n\r\n        case Uint8Array:\r\n            return 1 / 255;\r\n\r\n        case Int16Array:\r\n            return 1 / 32767;\r\n\r\n        case Uint16Array:\r\n            return 1 / 65535;\r\n\r\n        default:\r\n            throw new Error('THREE.GLTFLoader: Unsupported normalized accessor component type.');\r\n\r\n    }\r\n\r\n}\r\n\r\n/* GLTF PARSER */\r\n\r\nclass GLTFParser {\r\n\r\n    constructor(json = {}, options = {}) {\r\n\r\n        this.json = json;\r\n        this.extensions = {};\r\n        this.plugins = {};\r\n        this.options = options;\r\n\r\n        // loader object cache\r\n        this.cache = new GLTFRegistry();\r\n\r\n        // associations between Three.js objects and glTF elements\r\n        this.associations = new Map();\r\n\r\n        // THREE.BufferGeometry caching\r\n        this.primitiveCache = {};\r\n\r\n        // THREE.Object3D instance caches\r\n        this.meshCache = { refs: {}, uses: {} };\r\n        this.cameraCache = { refs: {}, uses: {} };\r\n        this.lightCache = { refs: {}, uses: {} };\r\n\r\n        this.textureCache = {};\r\n\r\n        // Track node names, to ensure no duplicates\r\n        this.nodeNamesUsed = {};\r\n\r\n        // Use an THREE.ImageBitmapLoader if imageBitmaps are supported. Moves much of the\r\n        // expensive work of uploading a texture to the GPU off the main thread.\r\n        if (typeof createImageBitmap !== 'undefined' && /Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent) === false) {\r\n\r\n            this.textureLoader = new THREE.ImageBitmapLoader(this.options.manager);\r\n\r\n        } else {\r\n\r\n            this.textureLoader = new THREE.TextureLoader(this.options.manager);\r\n\r\n        }\r\n\r\n        this.textureLoader.setCrossOrigin(this.options.crossOrigin);\r\n        this.textureLoader.setRequestHeader(this.options.requestHeader);\r\n\r\n        this.fileLoader = new THREE.FileLoader(this.options.manager);\r\n        this.fileLoader.setResponseType('arraybuffer');\r\n\r\n        if (this.options.crossOrigin === 'use-credentials') {\r\n\r\n            this.fileLoader.setWithCredentials(true);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    setExtensions(extensions) {\r\n\r\n        this.extensions = extensions;\r\n\r\n    }\r\n\r\n    setPlugins(plugins) {\r\n\r\n        this.plugins = plugins;\r\n\r\n    }\r\n\r\n    parse(onLoad, onError) {\r\n\r\n        const parser = this;\r\n        const json = this.json;\r\n        const extensions = this.extensions;\r\n\r\n        // Clear the loader cache\r\n        this.cache.removeAll();\r\n\r\n        // Mark the special nodes/meshes in json for efficient parse\r\n        this._invokeAll(function (ext) {\r\n\r\n            return ext._markDefs && ext._markDefs();\r\n\r\n        });\r\n\r\n        Promise.all(this._invokeAll(function (ext) {\r\n\r\n            return ext.beforeRoot && ext.beforeRoot();\r\n\r\n        })).then(function () {\r\n\r\n            return Promise.all([\r\n\r\n                parser.getDependencies('scene'),\r\n                parser.getDependencies('animation'),\r\n                parser.getDependencies('camera'),\r\n\r\n            ]);\r\n\r\n        }).then(function (dependencies) {\r\n\r\n            const result = {\r\n                scene: dependencies[0][json.scene || 0],\r\n                scenes: dependencies[0],\r\n                animations: dependencies[1],\r\n                cameras: dependencies[2],\r\n                asset: json.asset,\r\n                parser: parser,\r\n                userData: {}\r\n            };\r\n\r\n            addUnknownExtensionsToUserData(extensions, result, json);\r\n\r\n            assignExtrasToUserData(result, json);\r\n\r\n            Promise.all(parser._invokeAll(function (ext) {\r\n\r\n                return ext.afterRoot && ext.afterRoot(result);\r\n\r\n            })).then(function () {\r\n\r\n                onLoad(result);\r\n\r\n            });\r\n\r\n        }).catch(onError);\r\n\r\n    }\r\n\r\n    /**\r\n     * Marks the special nodes/meshes in json for efficient parse.\r\n     */\r\n    _markDefs() {\r\n\r\n        const nodeDefs = this.json.nodes || [];\r\n        const skinDefs = this.json.skins || [];\r\n        const meshDefs = this.json.meshes || [];\r\n\r\n        // Nothing in the node definition indicates whether it is a THREE.Bone or an\r\n        // THREE.Object3D. Use the skins' joint references to mark bones.\r\n        for (let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex++) {\r\n\r\n            const joints = skinDefs[skinIndex].joints;\r\n\r\n            for (let i = 0, il = joints.length; i < il; i++) {\r\n\r\n                nodeDefs[joints[i]].isBone = true;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // Iterate over all nodes, marking references to shared resources,\r\n        // as well as skeleton joints.\r\n        for (let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex++) {\r\n\r\n            const nodeDef = nodeDefs[nodeIndex];\r\n\r\n            if (nodeDef.mesh !== undefined) {\r\n\r\n                this._addNodeRef(this.meshCache, nodeDef.mesh);\r\n\r\n                // Nothing in the mesh definition indicates whether it is\r\n                // a THREE.SkinnedMesh or THREE.Mesh. Use the node's mesh reference\r\n                // to mark THREE.SkinnedMesh if node has skin.\r\n                if (nodeDef.skin !== undefined) {\r\n\r\n                    meshDefs[nodeDef.mesh].isSkinnedMesh = true;\r\n\r\n                }\r\n\r\n            }\r\n\r\n            if (nodeDef.camera !== undefined) {\r\n\r\n                this._addNodeRef(this.cameraCache, nodeDef.camera);\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * Counts references to shared node / THREE.Object3D resources. These resources\r\n     * can be reused, or \"instantiated\", at multiple nodes in the scene\r\n     * hierarchy. THREE.Mesh, Camera, and Light instances are instantiated and must\r\n     * be marked. Non-scenegraph resources (like Materials, Geometries, and\r\n     * Textures) can be reused directly and are not marked here.\r\n     *\r\n     * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\r\n     */\r\n    _addNodeRef(cache, index) {\r\n\r\n        if (index === undefined) return;\r\n\r\n        if (cache.refs[index] === undefined) {\r\n\r\n            cache.refs[index] = cache.uses[index] = 0;\r\n\r\n        }\r\n\r\n        cache.refs[index]++;\r\n\r\n    }\r\n\r\n    /** Returns a reference to a shared resource, cloning it if necessary. */\r\n    _getNodeRef(cache, index, object) {\r\n\r\n        if (cache.refs[index] <= 1) return object;\r\n\r\n        const ref = object.clone();\r\n\r\n        // Propagates mappings to the cloned object, prevents mappings on the\r\n        // original object from being lost.\r\n        const updateMappings = (original, clone) => {\r\n\r\n            const mappings = this.associations.get(original);\r\n            if (mappings != null) {\r\n\r\n                this.associations.set(clone, mappings);\r\n\r\n            }\r\n\r\n            for (const [i, child] of original.children.entries()) {\r\n\r\n                updateMappings(child, clone.children[i]);\r\n\r\n            }\r\n\r\n        };\r\n\r\n        updateMappings(object, ref);\r\n\r\n        ref.name += '_instance_' + (cache.uses[index]++);\r\n\r\n        return ref;\r\n\r\n    }\r\n\r\n    _invokeOne(func) {\r\n\r\n        const extensions = Object.values(this.plugins);\r\n        extensions.push(this);\r\n\r\n        for (let i = 0; i < extensions.length; i++) {\r\n\r\n            const result = func(extensions[i]);\r\n\r\n            if (result) return result;\r\n\r\n        }\r\n\r\n        return null;\r\n\r\n    }\r\n\r\n    _invokeAll(func) {\r\n\r\n        const extensions = Object.values(this.plugins);\r\n        extensions.unshift(this);\r\n\r\n        const pending = [];\r\n\r\n        for (let i = 0; i < extensions.length; i++) {\r\n\r\n            const result = func(extensions[i]);\r\n\r\n            if (result) pending.push(result);\r\n\r\n        }\r\n\r\n        return pending;\r\n\r\n    }\r\n\r\n    /**\r\n     * Requests the specified dependency asynchronously, with caching.\r\n     * @param {string} type\r\n     * @param {number} index\r\n     * @return {Promise<THREE.Object3D|THREE.Material|THREE.Texture|THREE.AnimationClip|ArrayBuffer|Object>}\r\n     */\r\n    getDependency(type, index) {\r\n\r\n        const cacheKey = type + ':' + index;\r\n        let dependency = this.cache.get(cacheKey);\r\n\r\n        if (!dependency) {\r\n\r\n            switch (type) {\r\n\r\n                case 'scene':\r\n                    dependency = this.loadScene(index);\r\n                    break;\r\n\r\n                case 'node':\r\n                    dependency = this.loadNode(index);\r\n                    break;\r\n\r\n                case 'mesh':\r\n                    dependency = this._invokeOne(function (ext) {\r\n\r\n                        return ext.loadMesh && ext.loadMesh(index);\r\n\r\n                    });\r\n                    break;\r\n\r\n                case 'accessor':\r\n                    dependency = this.loadAccessor(index);\r\n                    break;\r\n\r\n                case 'bufferView':\r\n                    dependency = this._invokeOne(function (ext) {\r\n\r\n                        return ext.loadBufferView && ext.loadBufferView(index);\r\n\r\n                    });\r\n                    break;\r\n\r\n                case 'buffer':\r\n                    dependency = this.loadBuffer(index);\r\n                    break;\r\n\r\n                case 'material':\r\n                    dependency = this._invokeOne(function (ext) {\r\n\r\n                        return ext.loadMaterial && ext.loadMaterial(index);\r\n\r\n                    });\r\n                    break;\r\n\r\n                case 'texture':\r\n                    dependency = this._invokeOne(function (ext) {\r\n\r\n                        return ext.loadTexture && ext.loadTexture(index);\r\n\r\n                    });\r\n                    break;\r\n\r\n                case 'skin':\r\n                    dependency = this.loadSkin(index);\r\n                    break;\r\n\r\n                case 'animation':\r\n                    dependency = this.loadAnimation(index);\r\n                    break;\r\n\r\n                case 'camera':\r\n                    dependency = this.loadCamera(index);\r\n                    break;\r\n\r\n                default:\r\n                    throw new Error('Unknown type: ' + type);\r\n\r\n            }\r\n\r\n            this.cache.add(cacheKey, dependency);\r\n\r\n        }\r\n\r\n        return dependency;\r\n\r\n    }\r\n\r\n    /**\r\n     * Requests all dependencies of the specified type asynchronously, with caching.\r\n     * @param {string} type\r\n     * @return {Promise<Array<Object>>}\r\n     */\r\n    getDependencies(type) {\r\n\r\n        let dependencies = this.cache.get(type);\r\n\r\n        if (!dependencies) {\r\n\r\n            const parser = this;\r\n            const defs = this.json[type + (type === 'mesh' ? 'es' : 's')] || [];\r\n\r\n            dependencies = Promise.all(defs.map(function (def, index) {\r\n\r\n                return parser.getDependency(type, index);\r\n\r\n            }));\r\n\r\n            this.cache.add(type, dependencies);\r\n\r\n        }\r\n\r\n        return dependencies;\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n     * @param {number} bufferIndex\r\n     * @return {Promise<ArrayBuffer>}\r\n     */\r\n    loadBuffer(bufferIndex) {\r\n\r\n        const bufferDef = this.json.buffers[bufferIndex];\r\n        const loader = this.fileLoader;\r\n\r\n        if (bufferDef.type && bufferDef.type !== 'arraybuffer') {\r\n\r\n            throw new Error('THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.');\r\n\r\n        }\r\n\r\n        // If present, GLB container is required to be the first buffer.\r\n        if (bufferDef.uri === undefined && bufferIndex === 0) {\r\n\r\n            return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);\r\n\r\n        }\r\n\r\n        const options = this.options;\r\n\r\n        return new Promise(function (resolve, reject) {\r\n\r\n            loader.load(THREE.LoaderUtils.resolveURL(bufferDef.uri, options.path), resolve, undefined, function () {\r\n\r\n                reject(new Error('THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".'));\r\n\r\n            });\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n     * @param {number} bufferViewIndex\r\n     * @return {Promise<ArrayBuffer>}\r\n     */\r\n    loadBufferView(bufferViewIndex) {\r\n\r\n        const bufferViewDef = this.json.bufferViews[bufferViewIndex];\r\n\r\n        return this.getDependency('buffer', bufferViewDef.buffer).then(function (buffer) {\r\n\r\n            const byteLength = bufferViewDef.byteLength || 0;\r\n            const byteOffset = bufferViewDef.byteOffset || 0;\r\n            return buffer.slice(byteOffset, byteOffset + byteLength);\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\r\n     * @param {number} accessorIndex\r\n     * @return {Promise<THREE.BufferAttribute|THREE.InterleavedBufferAttribute>}\r\n     */\r\n    loadAccessor(accessorIndex) {\r\n\r\n        const parser = this;\r\n        const json = this.json;\r\n\r\n        const accessorDef = this.json.accessors[accessorIndex];\r\n\r\n        if (accessorDef.bufferView === undefined && accessorDef.sparse === undefined) {\r\n\r\n            // Ignore empty accessors, which may be used to declare runtime\r\n            // information about attributes coming from another source (e.g. Draco\r\n            // compression extension).\r\n            return Promise.resolve(null);\r\n\r\n        }\r\n\r\n        const pendingBufferViews = [];\r\n\r\n        if (accessorDef.bufferView !== undefined) {\r\n\r\n            pendingBufferViews.push(this.getDependency('bufferView', accessorDef.bufferView));\r\n\r\n        } else {\r\n\r\n            pendingBufferViews.push(null);\r\n\r\n        }\r\n\r\n        if (accessorDef.sparse !== undefined) {\r\n\r\n            pendingBufferViews.push(this.getDependency('bufferView', accessorDef.sparse.indices.bufferView));\r\n            pendingBufferViews.push(this.getDependency('bufferView', accessorDef.sparse.values.bufferView));\r\n\r\n        }\r\n\r\n        return Promise.all(pendingBufferViews).then(function (bufferViews) {\r\n\r\n            const bufferView = bufferViews[0];\r\n\r\n            const itemSize = WEBGL_TYPE_SIZES[accessorDef.type];\r\n            const TypedArray = WEBGL_COMPONENT_TYPES[accessorDef.componentType];\r\n\r\n            // For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\r\n            const elementBytes = TypedArray.BYTES_PER_ELEMENT;\r\n            const itemBytes = elementBytes * itemSize;\r\n            const byteOffset = accessorDef.byteOffset || 0;\r\n            const byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[accessorDef.bufferView].byteStride : undefined;\r\n            const normalized = accessorDef.normalized === true;\r\n            let array, bufferAttribute;\r\n\r\n            // The buffer is not interleaved if the stride is the item size in bytes.\r\n            if (byteStride && byteStride !== itemBytes) {\r\n\r\n                // Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own THREE.InterleavedBuffer\r\n                // This makes sure that IBA.count reflects accessor.count properly\r\n                const ibSlice = Math.floor(byteOffset / byteStride);\r\n                const ibCacheKey = 'THREE.InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\r\n                let ib = parser.cache.get(ibCacheKey);\r\n\r\n                if (!ib) {\r\n\r\n                    array = new TypedArray(bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes);\r\n\r\n                    // Integer parameters to IB/IBA are in array elements, not bytes.\r\n                    ib = new THREE.InterleavedBuffer(array, byteStride / elementBytes);\r\n\r\n                    parser.cache.add(ibCacheKey, ib);\r\n\r\n                }\r\n\r\n                bufferAttribute = new THREE.InterleavedBufferAttribute(ib, itemSize, (byteOffset % byteStride) / elementBytes, normalized);\r\n\r\n            } else {\r\n\r\n                if (bufferView === null) {\r\n\r\n                    array = new TypedArray(accessorDef.count * itemSize);\r\n\r\n                } else {\r\n\r\n                    array = new TypedArray(bufferView, byteOffset, accessorDef.count * itemSize);\r\n\r\n                }\r\n\r\n                bufferAttribute = new THREE.BufferAttribute(array, itemSize, normalized);\r\n\r\n            }\r\n\r\n            // https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\r\n            if (accessorDef.sparse !== undefined) {\r\n\r\n                const itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\r\n                const TypedArrayIndices = WEBGL_COMPONENT_TYPES[accessorDef.sparse.indices.componentType];\r\n\r\n                const byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\r\n                const byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\r\n\r\n                const sparseIndices = new TypedArrayIndices(bufferViews[1], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices);\r\n                const sparseValues = new TypedArray(bufferViews[2], byteOffsetValues, accessorDef.sparse.count * itemSize);\r\n\r\n                if (bufferView !== null) {\r\n\r\n                    // Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\r\n                    bufferAttribute = new THREE.BufferAttribute(bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized);\r\n\r\n                }\r\n\r\n                for (let i = 0, il = sparseIndices.length; i < il; i++) {\r\n\r\n                    const index = sparseIndices[i];\r\n\r\n                    bufferAttribute.setX(index, sparseValues[i * itemSize]);\r\n                    if (itemSize >= 2) bufferAttribute.setY(index, sparseValues[i * itemSize + 1]);\r\n                    if (itemSize >= 3) bufferAttribute.setZ(index, sparseValues[i * itemSize + 2]);\r\n                    if (itemSize >= 4) bufferAttribute.setW(index, sparseValues[i * itemSize + 3]);\r\n                    if (itemSize >= 5) throw new Error('THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.');\r\n\r\n                }\r\n\r\n            }\r\n\r\n            return bufferAttribute;\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\r\n     * @param {number} textureIndex\r\n     * @return {Promise<THREE.Texture>}\r\n     */\r\n    loadTexture(textureIndex) {\r\n\r\n        const json = this.json;\r\n        const options = this.options;\r\n        const textureDef = json.textures[textureIndex];\r\n        const source = json.images[textureDef.source];\r\n\r\n        let loader = this.textureLoader;\r\n\r\n        if (source.uri) {\r\n\r\n            const handler = options.manager.getHandler(source.uri);\r\n            if (handler !== null) loader = handler;\r\n\r\n        }\r\n\r\n        return this.loadTextureImage(textureIndex, source, loader);\r\n\r\n    }\r\n\r\n    loadTextureImage(textureIndex, source, loader) {\r\n\r\n        const parser = this;\r\n        const json = this.json;\r\n        const options = this.options;\r\n\r\n        const textureDef = json.textures[textureIndex];\r\n\r\n        const cacheKey = (source.uri || source.bufferView) + ':' + textureDef.sampler;\r\n\r\n        if (this.textureCache[cacheKey]) {\r\n\r\n            // See https://github.com/mrdoob/three.js/issues/21559.\r\n            return this.textureCache[cacheKey];\r\n\r\n        }\r\n\r\n        const URL = self.URL || self.webkitURL;\r\n\r\n        let sourceURI = source.uri || '';\r\n        let isObjectURL = false;\r\n\r\n        if (source.bufferView !== undefined) {\r\n\r\n            // Load binary image data from bufferView, if provided.\r\n\r\n            sourceURI = parser.getDependency('bufferView', source.bufferView).then(function (bufferView) {\r\n\r\n                isObjectURL = true;\r\n                const blob = new Blob([bufferView], { type: source.mimeType });\r\n                sourceURI = URL.createObjectURL(blob);\r\n                return sourceURI;\r\n\r\n            });\r\n\r\n        } else if (source.uri === undefined) {\r\n\r\n            throw new Error('THREE.GLTFLoader: Image ' + textureIndex + ' is missing URI and bufferView');\r\n\r\n        }\r\n\r\n        const promise = Promise.resolve(sourceURI).then(function (sourceURI) {\r\n\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let onLoad = resolve;\r\n\r\n                if (loader.isImageBitmapLoader === true) {\r\n\r\n                    onLoad = function (imageBitmap) {\r\n\r\n                        const texture = new THREE.Texture(imageBitmap);\r\n                        texture.needsUpdate = true;\r\n\r\n                        resolve(texture);\r\n\r\n                    };\r\n\r\n                }\r\n\r\n                loader.load(THREE.LoaderUtils.resolveURL(sourceURI, options.path), onLoad, undefined, reject);\r\n\r\n            });\r\n\r\n        }).then(function (texture) {\r\n\r\n            // Clean up resources and configure THREE.Texture.\r\n\r\n            if (isObjectURL === true) {\r\n\r\n                URL.revokeObjectURL(sourceURI);\r\n\r\n            }\r\n\r\n            texture.flipY = false;\r\n\r\n            if (textureDef.name) texture.name = textureDef.name;\r\n\r\n            const samplers = json.samplers || {};\r\n            const sampler = samplers[textureDef.sampler] || {};\r\n\r\n            texture.magFilter = WEBGL_FILTERS[sampler.magFilter] || THREE.LinearFilter;\r\n            texture.minFilter = WEBGL_FILTERS[sampler.minFilter] || THREE.LinearMipmapLinearFilter;\r\n            texture.wrapS = WEBGL_WRAPPINGS[sampler.wrapS] || THREE.RepeatWrapping;\r\n            texture.wrapT = WEBGL_WRAPPINGS[sampler.wrapT] || THREE.RepeatWrapping;\r\n\r\n            parser.associations.set(texture, { textures: textureIndex });\r\n\r\n            return texture;\r\n\r\n        }).catch(function () {\r\n\r\n            console.error('THREE.GLTFLoader: Couldn\\'t load texture', sourceURI);\r\n            return null;\r\n\r\n        });\r\n\r\n        this.textureCache[cacheKey] = promise;\r\n\r\n        return promise;\r\n\r\n    }\r\n\r\n    /**\r\n     * Asynchronously assigns a texture to the given material parameters.\r\n     * @param {Object} materialParams\r\n     * @param {string} mapName\r\n     * @param {Object} mapDef\r\n     * @return {Promise<THREE.Texture>}\r\n     */\r\n    assignTexture(materialParams, mapName, mapDef) {\r\n\r\n        const parser = this;\r\n\r\n        return this.getDependency('texture', mapDef.index).then(function (texture) {\r\n\r\n            // Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\r\n            // However, we will copy UV set 0 to UV set 1 on demand for aoMap\r\n            if (mapDef.texCoord !== undefined && mapDef.texCoord != 0 && !(mapName === 'aoMap' && mapDef.texCoord == 1)) {\r\n\r\n                console.warn('THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.');\r\n\r\n            }\r\n\r\n            if (parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]) {\r\n\r\n                const transform = mapDef.extensions !== undefined ? mapDef.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM] : undefined;\r\n\r\n                if (transform) {\r\n\r\n                    const gltfReference = parser.associations.get(texture);\r\n                    texture = parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(texture, transform);\r\n                    parser.associations.set(texture, gltfReference);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            materialParams[mapName] = texture;\r\n\r\n            return texture;\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Assigns final material to a THREE.Mesh, THREE.Line, or THREE.Points instance. The instance\r\n     * already has a material (generated from the glTF material options alone)\r\n     * but reuse of the same glTF material may require multiple threejs materials\r\n     * to accommodate different primitive types, defines, etc. New materials will\r\n     * be created if necessary, and reused from a cache.\r\n     * @param  {THREE.Object3D} mesh THREE.Mesh, THREE.Line, or THREE.Points instance.\r\n     */\r\n    assignFinalMaterial(mesh) {\r\n\r\n        const geometry = mesh.geometry;\r\n        let material = mesh.material;\r\n\r\n        const useDerivativeTangents = geometry.attributes.tangent === undefined;\r\n        const useVertexColors = geometry.attributes.color !== undefined;\r\n        const useFlatShading = geometry.attributes.normal === undefined;\r\n\r\n        if (mesh.isPoints) {\r\n\r\n            const cacheKey = 'THREE.PointsMaterial:' + material.uuid;\r\n\r\n            let pointsMaterial = this.cache.get(cacheKey);\r\n\r\n            if (!pointsMaterial) {\r\n\r\n                pointsMaterial = new THREE.PointsMaterial();\r\n                THREE.Material.prototype.copy.call(pointsMaterial, material);\r\n                pointsMaterial.color.copy(material.color);\r\n                pointsMaterial.map = material.map;\r\n                pointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\r\n\r\n                this.cache.add(cacheKey, pointsMaterial);\r\n\r\n            }\r\n\r\n            material = pointsMaterial;\r\n\r\n        } else if (mesh.isLine) {\r\n\r\n            const cacheKey = 'THREE.LineBasicMaterial:' + material.uuid;\r\n\r\n            let lineMaterial = this.cache.get(cacheKey);\r\n\r\n            if (!lineMaterial) {\r\n\r\n                lineMaterial = new THREE.LineBasicMaterial();\r\n                THREE.Material.prototype.copy.call(lineMaterial, material);\r\n                lineMaterial.color.copy(material.color);\r\n\r\n                this.cache.add(cacheKey, lineMaterial);\r\n\r\n            }\r\n\r\n            material = lineMaterial;\r\n\r\n        }\r\n\r\n        // Clone the material if it will be modified\r\n        if (useDerivativeTangents || useVertexColors || useFlatShading) {\r\n\r\n            let cacheKey = 'ClonedMaterial:' + material.uuid + ':';\r\n\r\n            if (material.isGLTFSpecularGlossinessMaterial) cacheKey += 'specular-glossiness:';\r\n            if (useDerivativeTangents) cacheKey += 'derivative-tangents:';\r\n            if (useVertexColors) cacheKey += 'vertex-colors:';\r\n            if (useFlatShading) cacheKey += 'flat-shading:';\r\n\r\n            let cachedMaterial = this.cache.get(cacheKey);\r\n\r\n            if (!cachedMaterial) {\r\n\r\n                cachedMaterial = material.clone();\r\n\r\n                if (useVertexColors) cachedMaterial.vertexColors = true;\r\n                if (useFlatShading) cachedMaterial.flatShading = true;\r\n\r\n                if (useDerivativeTangents) {\r\n\r\n                    // https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\r\n                    if (cachedMaterial.normalScale) cachedMaterial.normalScale.y *= - 1;\r\n                    if (cachedMaterial.clearcoatNormalScale) cachedMaterial.clearcoatNormalScale.y *= - 1;\r\n\r\n                }\r\n\r\n                this.cache.add(cacheKey, cachedMaterial);\r\n\r\n                this.associations.set(cachedMaterial, this.associations.get(material));\r\n\r\n            }\r\n\r\n            material = cachedMaterial;\r\n\r\n        }\r\n\r\n        // workarounds for mesh and geometry\r\n\r\n        if (material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined) {\r\n\r\n            geometry.setAttribute('uv2', geometry.attributes.uv);\r\n\r\n        }\r\n\r\n        mesh.material = material;\r\n\r\n    }\r\n\r\n    getMaterialType( /* materialIndex */) {\r\n\r\n        return THREE.MeshStandardMaterial;\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\r\n     * @param {number} materialIndex\r\n     * @return {Promise<THREE.Material>}\r\n     */\r\n    loadMaterial(materialIndex) {\r\n\r\n        const parser = this;\r\n        const json = this.json;\r\n        const extensions = this.extensions;\r\n        const materialDef = json.materials[materialIndex];\r\n\r\n        let materialType;\r\n        const materialParams = {};\r\n        const materialExtensions = materialDef.extensions || {};\r\n\r\n        const pending = [];\r\n\r\n        if (materialExtensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]) {\r\n\r\n            const sgExtension = extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];\r\n            materialType = sgExtension.getMaterialType();\r\n            pending.push(sgExtension.extendParams(materialParams, materialDef, parser));\r\n\r\n        } else if (materialExtensions[EXTENSIONS.KHR_MATERIALS_UNLIT]) {\r\n\r\n            const kmuExtension = extensions[EXTENSIONS.KHR_MATERIALS_UNLIT];\r\n            materialType = kmuExtension.getMaterialType();\r\n            pending.push(kmuExtension.extendParams(materialParams, materialDef, parser));\r\n\r\n        } else {\r\n\r\n            // Specification:\r\n            // https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\r\n\r\n            const metallicRoughness = materialDef.pbrMetallicRoughness || {};\r\n\r\n            materialParams.color = new THREE.Color(1.0, 1.0, 1.0);\r\n            materialParams.opacity = 1.0;\r\n\r\n            if (Array.isArray(metallicRoughness.baseColorFactor)) {\r\n\r\n                const array = metallicRoughness.baseColorFactor;\r\n\r\n                materialParams.color.fromArray(array);\r\n                materialParams.opacity = array[3];\r\n\r\n            }\r\n\r\n            if (metallicRoughness.baseColorTexture !== undefined) {\r\n\r\n                pending.push(parser.assignTexture(materialParams, 'map', metallicRoughness.baseColorTexture));\r\n\r\n            }\r\n\r\n            materialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\r\n            materialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\r\n\r\n            if (metallicRoughness.metallicRoughnessTexture !== undefined) {\r\n\r\n                pending.push(parser.assignTexture(materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture));\r\n                pending.push(parser.assignTexture(materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture));\r\n\r\n            }\r\n\r\n            materialType = this._invokeOne(function (ext) {\r\n\r\n                return ext.getMaterialType && ext.getMaterialType(materialIndex);\r\n\r\n            });\r\n\r\n            pending.push(Promise.all(this._invokeAll(function (ext) {\r\n\r\n                return ext.extendMaterialParams && ext.extendMaterialParams(materialIndex, materialParams);\r\n\r\n            })));\r\n\r\n        }\r\n\r\n        if (materialDef.doubleSided === true) {\r\n\r\n            materialParams.side = THREE.DoubleSide;\r\n\r\n        }\r\n\r\n        const alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\r\n\r\n        if (alphaMode === ALPHA_MODES.BLEND) {\r\n\r\n            materialParams.transparent = true;\r\n\r\n            // See: https://github.com/mrdoob/three.js/issues/17706\r\n            materialParams.depthWrite = false;\r\n\r\n        } else {\r\n\r\n            materialParams.transparent = false;\r\n\r\n            if (alphaMode === ALPHA_MODES.MASK) {\r\n\r\n                materialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        if (materialDef.normalTexture !== undefined && materialType !== THREE.MeshBasicMaterial) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'normalMap', materialDef.normalTexture));\r\n\r\n            materialParams.normalScale = new THREE.Vector2(1, 1);\r\n\r\n            if (materialDef.normalTexture.scale !== undefined) {\r\n\r\n                const scale = materialDef.normalTexture.scale;\r\n\r\n                materialParams.normalScale.set(scale, scale);\r\n\r\n            }\r\n\r\n        }\r\n\r\n        if (materialDef.occlusionTexture !== undefined && materialType !== THREE.MeshBasicMaterial) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'aoMap', materialDef.occlusionTexture));\r\n\r\n            if (materialDef.occlusionTexture.strength !== undefined) {\r\n\r\n                materialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        if (materialDef.emissiveFactor !== undefined && materialType !== THREE.MeshBasicMaterial) {\r\n\r\n            materialParams.emissive = new THREE.Color().fromArray(materialDef.emissiveFactor);\r\n\r\n        }\r\n\r\n        if (materialDef.emissiveTexture !== undefined && materialType !== THREE.MeshBasicMaterial) {\r\n\r\n            pending.push(parser.assignTexture(materialParams, 'emissiveMap', materialDef.emissiveTexture));\r\n\r\n        }\r\n\r\n        return Promise.all(pending).then(function () {\r\n\r\n            let material;\r\n\r\n            if (materialType === GLTFMeshStandardSGMaterial) {\r\n\r\n                material = extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(materialParams);\r\n\r\n            } else {\r\n\r\n                material = new materialType(materialParams);\r\n\r\n            }\r\n\r\n            if (materialDef.name) material.name = materialDef.name;\r\n\r\n            // baseColorTexture, emissiveTexture, and specularGlossinessTexture use sRGB encoding.\r\n            if (material.map) material.map.encoding = THREE.sRGBEncoding;\r\n            if (material.emissiveMap) material.emissiveMap.encoding = THREE.sRGBEncoding;\r\n\r\n            assignExtrasToUserData(material, materialDef);\r\n\r\n            parser.associations.set(material, { materials: materialIndex });\r\n\r\n            if (materialDef.extensions) addUnknownExtensionsToUserData(extensions, material, materialDef);\r\n\r\n            return material;\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /** When THREE.Object3D instances are targeted by animation, they need unique names. */\r\n    createUniqueName(originalName) {\r\n\r\n        const sanitizedName = THREE.PropertyBinding.sanitizeNodeName(originalName || '');\r\n\r\n        let name = sanitizedName;\r\n\r\n        for (let i = 1; this.nodeNamesUsed[name]; ++i) {\r\n\r\n            name = sanitizedName + '_' + i;\r\n\r\n        }\r\n\r\n        this.nodeNamesUsed[name] = true;\r\n\r\n        return name;\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\r\n     *\r\n     * Creates BufferGeometries from primitives.\r\n     *\r\n     * @param {Array<GLTF.Primitive>} primitives\r\n     * @return {Promise<Array<THREE.BufferGeometry>>}\r\n     */\r\n    loadGeometries(primitives) {\r\n\r\n        const parser = this;\r\n        const extensions = this.extensions;\r\n        const cache = this.primitiveCache;\r\n\r\n        function createDracoPrimitive(primitive) {\r\n\r\n            return extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]\r\n                .decodePrimitive(primitive, parser)\r\n                .then(function (geometry) {\r\n\r\n                    return addPrimitiveAttributes(geometry, primitive, parser);\r\n\r\n                });\r\n\r\n        }\r\n\r\n        const pending = [];\r\n\r\n        for (let i = 0, il = primitives.length; i < il; i++) {\r\n\r\n            const primitive = primitives[i];\r\n            const cacheKey = createPrimitiveKey(primitive);\r\n\r\n            // See if we've already created this geometry\r\n            const cached = cache[cacheKey];\r\n\r\n            if (cached) {\r\n\r\n                // Use the cached geometry if it exists\r\n                pending.push(cached.promise);\r\n\r\n            } else {\r\n\r\n                let geometryPromise;\r\n\r\n                if (primitive.extensions && primitive.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]) {\r\n\r\n                    // Use DRACO geometry if available\r\n                    geometryPromise = createDracoPrimitive(primitive);\r\n\r\n                } else {\r\n\r\n                    // Otherwise create a new geometry\r\n                    geometryPromise = addPrimitiveAttributes(new THREE.BufferGeometry(), primitive, parser);\r\n\r\n                }\r\n\r\n                // Cache this geometry\r\n                cache[cacheKey] = { primitive: primitive, promise: geometryPromise };\r\n\r\n                pending.push(geometryPromise);\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return Promise.all(pending);\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\r\n     * @param {number} meshIndex\r\n     * @return {Promise<THREE.Group|THREE.Mesh|THREE.SkinnedMesh>}\r\n     */\r\n    loadMesh(meshIndex) {\r\n\r\n        const parser = this;\r\n        const json = this.json;\r\n        const extensions = this.extensions;\r\n\r\n        const meshDef = json.meshes[meshIndex];\r\n        const primitives = meshDef.primitives;\r\n\r\n        const pending = [];\r\n\r\n        for (let i = 0, il = primitives.length; i < il; i++) {\r\n\r\n            const material = primitives[i].material === undefined\r\n                ? createDefaultMaterial(this.cache)\r\n                : this.getDependency('material', primitives[i].material);\r\n\r\n            pending.push(material);\r\n\r\n        }\r\n\r\n        pending.push(parser.loadGeometries(primitives));\r\n\r\n        return Promise.all(pending).then(function (results) {\r\n\r\n            const materials = results.slice(0, results.length - 1);\r\n            const geometries = results[results.length - 1];\r\n\r\n            const meshes = [];\r\n\r\n            for (let i = 0, il = geometries.length; i < il; i++) {\r\n\r\n                const geometry = geometries[i];\r\n                const primitive = primitives[i];\r\n\r\n                // 1. create THREE.Mesh\r\n\r\n                let mesh;\r\n\r\n                const material = materials[i];\r\n\r\n                if (primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\r\n                    primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\r\n                    primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\r\n                    primitive.mode === undefined) {\r\n\r\n                    // .isSkinnedMesh isn't in glTF spec. See ._markDefs()\r\n                    mesh = meshDef.isSkinnedMesh === true\r\n                        ? new THREE.SkinnedMesh(geometry, material)\r\n                        : new THREE.Mesh(geometry, material);\r\n\r\n                    if (mesh.isSkinnedMesh === true && !mesh.geometry.attributes.skinWeight.normalized) {\r\n\r\n                        // we normalize floating point skin weight array to fix malformed assets (see #15319)\r\n                        // it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\r\n                        mesh.normalizeSkinWeights();\r\n\r\n                    }\r\n\r\n                    if (primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP) {\r\n\r\n                        mesh.geometry = toTrianglesDrawMode(mesh.geometry, THREE.TriangleStripDrawMode);\r\n\r\n                    } else if (primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN) {\r\n\r\n                        mesh.geometry = toTrianglesDrawMode(mesh.geometry, THREE.TriangleFanDrawMode);\r\n\r\n                    }\r\n\r\n                } else if (primitive.mode === WEBGL_CONSTANTS.LINES) {\r\n\r\n                    mesh = new THREE.LineSegments(geometry, material);\r\n\r\n                } else if (primitive.mode === WEBGL_CONSTANTS.LINE_STRIP) {\r\n\r\n                    mesh = new THREE.Line(geometry, material);\r\n\r\n                } else if (primitive.mode === WEBGL_CONSTANTS.LINE_LOOP) {\r\n\r\n                    mesh = new THREE.LineLoop(geometry, material);\r\n\r\n                } else if (primitive.mode === WEBGL_CONSTANTS.POINTS) {\r\n\r\n                    mesh = new THREE.Points(geometry, material);\r\n\r\n                } else {\r\n\r\n                    throw new Error('THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode);\r\n\r\n                }\r\n\r\n                if (Object.keys(mesh.geometry.morphAttributes).length > 0) {\r\n\r\n                    updateMorphTargets(mesh, meshDef);\r\n\r\n                }\r\n\r\n                mesh.name = parser.createUniqueName(meshDef.name || ('mesh_' + meshIndex));\r\n\r\n                assignExtrasToUserData(mesh, meshDef);\r\n\r\n                if (primitive.extensions) addUnknownExtensionsToUserData(extensions, mesh, primitive);\r\n\r\n                parser.assignFinalMaterial(mesh);\r\n\r\n                meshes.push(mesh);\r\n\r\n            }\r\n\r\n            for (let i = 0, il = meshes.length; i < il; i++) {\r\n\r\n                parser.associations.set(meshes[i], {\r\n                    meshes: meshIndex,\r\n                    primitives: i\r\n                });\r\n\r\n            }\r\n\r\n            if (meshes.length === 1) {\r\n\r\n                return meshes[0];\r\n\r\n            }\r\n\r\n            const group = new THREE.Group();\r\n\r\n            parser.associations.set(group, { meshes: meshIndex });\r\n\r\n            for (let i = 0, il = meshes.length; i < il; i++) {\r\n\r\n                group.add(meshes[i]);\r\n\r\n            }\r\n\r\n            return group;\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\r\n     * @param {number} cameraIndex\r\n     * @return {Promise<THREE.Camera>}\r\n     */\r\n    loadCamera(cameraIndex) {\r\n\r\n        let camera;\r\n        const cameraDef = this.json.cameras[cameraIndex];\r\n        const params = cameraDef[cameraDef.type];\r\n\r\n        if (!params) {\r\n\r\n            console.warn('THREE.GLTFLoader: Missing camera parameters.');\r\n            return;\r\n\r\n        }\r\n\r\n        if (cameraDef.type === 'perspective') {\r\n\r\n            camera = new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(params.yfov), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6);\r\n\r\n        } else if (cameraDef.type === 'orthographic') {\r\n\r\n            camera = new THREE.OrthographicCamera(- params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar);\r\n\r\n        }\r\n\r\n        if (cameraDef.name) camera.name = this.createUniqueName(cameraDef.name);\r\n\r\n        assignExtrasToUserData(camera, cameraDef);\r\n\r\n        return Promise.resolve(camera);\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\r\n     * @param {number} skinIndex\r\n     * @return {Promise<Object>}\r\n     */\r\n    loadSkin(skinIndex) {\r\n\r\n        const skinDef = this.json.skins[skinIndex];\r\n\r\n        const skinEntry = { joints: skinDef.joints };\r\n\r\n        if (skinDef.inverseBindMatrices === undefined) {\r\n\r\n            return Promise.resolve(skinEntry);\r\n\r\n        }\r\n\r\n        return this.getDependency('accessor', skinDef.inverseBindMatrices).then(function (accessor) {\r\n\r\n            skinEntry.inverseBindMatrices = accessor;\r\n\r\n            return skinEntry;\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\r\n     * @param {number} animationIndex\r\n     * @return {Promise<THREE.AnimationClip>}\r\n     */\r\n    loadAnimation(animationIndex) {\r\n\r\n        const json = this.json;\r\n\r\n        const animationDef = json.animations[animationIndex];\r\n\r\n        const pendingNodes = [];\r\n        const pendingInputAccessors = [];\r\n        const pendingOutputAccessors = [];\r\n        const pendingSamplers = [];\r\n        const pendingTargets = [];\r\n\r\n        for (let i = 0, il = animationDef.channels.length; i < il; i++) {\r\n\r\n            const channel = animationDef.channels[i];\r\n            const sampler = animationDef.samplers[channel.sampler];\r\n            const target = channel.target;\r\n            const name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\r\n            const input = animationDef.parameters !== undefined ? animationDef.parameters[sampler.input] : sampler.input;\r\n            const output = animationDef.parameters !== undefined ? animationDef.parameters[sampler.output] : sampler.output;\r\n\r\n            pendingNodes.push(this.getDependency('node', name));\r\n            pendingInputAccessors.push(this.getDependency('accessor', input));\r\n            pendingOutputAccessors.push(this.getDependency('accessor', output));\r\n            pendingSamplers.push(sampler);\r\n            pendingTargets.push(target);\r\n\r\n        }\r\n\r\n        return Promise.all([\r\n\r\n            Promise.all(pendingNodes),\r\n            Promise.all(pendingInputAccessors),\r\n            Promise.all(pendingOutputAccessors),\r\n            Promise.all(pendingSamplers),\r\n            Promise.all(pendingTargets)\r\n\r\n        ]).then(function (dependencies) {\r\n\r\n            const nodes = dependencies[0];\r\n            const inputAccessors = dependencies[1];\r\n            const outputAccessors = dependencies[2];\r\n            const samplers = dependencies[3];\r\n            const targets = dependencies[4];\r\n\r\n            const tracks = [];\r\n\r\n            for (let i = 0, il = nodes.length; i < il; i++) {\r\n\r\n                const node = nodes[i];\r\n                const inputAccessor = inputAccessors[i];\r\n                const outputAccessor = outputAccessors[i];\r\n                const sampler = samplers[i];\r\n                const target = targets[i];\r\n\r\n                if (node === undefined) continue;\r\n\r\n                node.updateMatrix();\r\n                node.matrixAutoUpdate = true;\r\n\r\n                let TypedKeyframeTrack;\r\n\r\n                switch (PATH_PROPERTIES[target.path]) {\r\n\r\n                    case PATH_PROPERTIES.weights:\r\n\r\n                        TypedKeyframeTrack = THREE.NumberKeyframeTrack;\r\n                        break;\r\n\r\n                    case PATH_PROPERTIES.rotation:\r\n\r\n                        TypedKeyframeTrack = THREE.QuaternionKeyframeTrack;\r\n                        break;\r\n\r\n                    case PATH_PROPERTIES.position:\r\n                    case PATH_PROPERTIES.scale:\r\n                    default:\r\n\r\n                        TypedKeyframeTrack = THREE.VectorKeyframeTrack;\r\n                        break;\r\n\r\n                }\r\n\r\n                const targetName = node.name ? node.name : node.uuid;\r\n\r\n                const interpolation = sampler.interpolation !== undefined ? INTERPOLATION[sampler.interpolation] : THREE.InterpolateLinear;\r\n\r\n                const targetNames = [];\r\n\r\n                if (PATH_PROPERTIES[target.path] === PATH_PROPERTIES.weights) {\r\n\r\n                    node.traverse(function (object) {\r\n\r\n                        if (object.morphTargetInfluences) {\r\n\r\n                            targetNames.push(object.name ? object.name : object.uuid);\r\n\r\n                        }\r\n\r\n                    });\r\n\r\n                } else {\r\n\r\n                    targetNames.push(targetName);\r\n\r\n                }\r\n\r\n                let outputArray = outputAccessor.array;\r\n\r\n                if (outputAccessor.normalized) {\r\n\r\n                    const scale = getNormalizedComponentScale(outputArray.constructor);\r\n                    const scaled = new Float32Array(outputArray.length);\r\n\r\n                    for (let j = 0, jl = outputArray.length; j < jl; j++) {\r\n\r\n                        scaled[j] = outputArray[j] * scale;\r\n\r\n                    }\r\n\r\n                    outputArray = scaled;\r\n\r\n                }\r\n\r\n                for (let j = 0, jl = targetNames.length; j < jl; j++) {\r\n\r\n                    const track = new TypedKeyframeTrack(\r\n                        targetNames[j] + '.' + PATH_PROPERTIES[target.path],\r\n                        inputAccessor.array,\r\n                        outputArray,\r\n                        interpolation\r\n                    );\r\n\r\n                    // Override interpolation with custom factory method.\r\n                    if (sampler.interpolation === 'CUBICSPLINE') {\r\n\r\n                        track.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline(result) {\r\n\r\n                            // A CUBICSPLINE keyframe in glTF has three output values for each input value,\r\n                            // representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\r\n                            // must be divided by three to get the interpolant's sampleSize argument.\r\n\r\n                            const interpolantType = (this instanceof THREE.QuaternionKeyframeTrack) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;\r\n\r\n                            return new interpolantType(this.times, this.values, this.getValueSize() / 3, result);\r\n\r\n                        };\r\n\r\n                        // Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\r\n                        track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\r\n\r\n                    }\r\n\r\n                    tracks.push(track);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            const name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\r\n\r\n            return new THREE.AnimationClip(name, undefined, tracks);\r\n\r\n        });\r\n\r\n    }\r\n\r\n    createNodeMesh(nodeIndex) {\r\n\r\n        const json = this.json;\r\n        const parser = this;\r\n        const nodeDef = json.nodes[nodeIndex];\r\n\r\n        if (nodeDef.mesh === undefined) return null;\r\n\r\n        return parser.getDependency('mesh', nodeDef.mesh).then(function (mesh) {\r\n\r\n            const node = parser._getNodeRef(parser.meshCache, nodeDef.mesh, mesh);\r\n\r\n            // if weights are provided on the node, override weights on the mesh.\r\n            if (nodeDef.weights !== undefined) {\r\n\r\n                node.traverse(function (o) {\r\n\r\n                    if (!o.isMesh) return;\r\n\r\n                    for (let i = 0, il = nodeDef.weights.length; i < il; i++) {\r\n\r\n                        o.morphTargetInfluences[i] = nodeDef.weights[i];\r\n\r\n                    }\r\n\r\n                });\r\n\r\n            }\r\n\r\n            return node;\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\r\n     * @param {number} nodeIndex\r\n     * @return {Promise<THREE.Object3D>}\r\n     */\r\n    loadNode(nodeIndex) {\r\n\r\n        const json = this.json;\r\n        const extensions = this.extensions;\r\n        const parser = this;\r\n\r\n        const nodeDef = json.nodes[nodeIndex];\r\n\r\n        // reserve node's name before its dependencies, so the root has the intended name.\r\n        const nodeName = nodeDef.name ? parser.createUniqueName(nodeDef.name) : '';\r\n\r\n        return (function () {\r\n\r\n            const pending = [];\r\n\r\n            const meshPromise = parser._invokeOne(function (ext) {\r\n\r\n                return ext.createNodeMesh && ext.createNodeMesh(nodeIndex);\r\n\r\n            });\r\n\r\n            if (meshPromise) {\r\n\r\n                pending.push(meshPromise);\r\n\r\n            }\r\n\r\n            if (nodeDef.camera !== undefined) {\r\n\r\n                pending.push(parser.getDependency('camera', nodeDef.camera).then(function (camera) {\r\n\r\n                    return parser._getNodeRef(parser.cameraCache, nodeDef.camera, camera);\r\n\r\n                }));\r\n\r\n            }\r\n\r\n            parser._invokeAll(function (ext) {\r\n\r\n                return ext.createNodeAttachment && ext.createNodeAttachment(nodeIndex);\r\n\r\n            }).forEach(function (promise) {\r\n\r\n                pending.push(promise);\r\n\r\n            });\r\n\r\n            return Promise.all(pending);\r\n\r\n        }()).then(function (objects) {\r\n\r\n            let node;\r\n\r\n            // .isBone isn't in glTF spec. See ._markDefs\r\n            if (nodeDef.isBone === true) {\r\n\r\n                node = new THREE.Bone();\r\n\r\n            } else if (objects.length > 1) {\r\n\r\n                node = new THREE.Group();\r\n\r\n            } else if (objects.length === 1) {\r\n\r\n                node = objects[0];\r\n\r\n            } else {\r\n\r\n                node = new THREE.Object3D();\r\n\r\n            }\r\n\r\n            if (node !== objects[0]) {\r\n\r\n                for (let i = 0, il = objects.length; i < il; i++) {\r\n\r\n                    node.add(objects[i]);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            if (nodeDef.name) {\r\n\r\n                node.userData.name = nodeDef.name;\r\n                node.name = nodeName;\r\n\r\n            }\r\n\r\n            assignExtrasToUserData(node, nodeDef);\r\n\r\n            if (nodeDef.extensions) addUnknownExtensionsToUserData(extensions, node, nodeDef);\r\n\r\n            if (nodeDef.matrix !== undefined) {\r\n\r\n                const matrix = new THREE.Matrix4();\r\n                matrix.fromArray(nodeDef.matrix);\r\n                node.applyMatrix4(matrix);\r\n\r\n            } else {\r\n\r\n                if (nodeDef.translation !== undefined) {\r\n\r\n                    node.position.fromArray(nodeDef.translation);\r\n\r\n                }\r\n\r\n                if (nodeDef.rotation !== undefined) {\r\n\r\n                    node.quaternion.fromArray(nodeDef.rotation);\r\n\r\n                }\r\n\r\n                if (nodeDef.scale !== undefined) {\r\n\r\n                    node.scale.fromArray(nodeDef.scale);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            if (!parser.associations.has(node)) {\r\n\r\n                parser.associations.set(node, {});\r\n\r\n            }\r\n\r\n            parser.associations.get(node).nodes = nodeIndex;\r\n\r\n            return node;\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\r\n     * @param {number} sceneIndex\r\n     * @return {Promise<THREE.Group>}\r\n     */\r\n    loadScene(sceneIndex) {\r\n\r\n        const json = this.json;\r\n        const extensions = this.extensions;\r\n        const sceneDef = this.json.scenes[sceneIndex];\r\n        const parser = this;\r\n\r\n        // THREE.Loader returns THREE.Group, not Scene.\r\n        // See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\r\n        const scene = new THREE.Group();\r\n        if (sceneDef.name) scene.name = parser.createUniqueName(sceneDef.name);\r\n\r\n        assignExtrasToUserData(scene, sceneDef);\r\n\r\n        if (sceneDef.extensions) addUnknownExtensionsToUserData(extensions, scene, sceneDef);\r\n\r\n        const nodeIds = sceneDef.nodes || [];\r\n\r\n        const pending = [];\r\n\r\n        for (let i = 0, il = nodeIds.length; i < il; i++) {\r\n\r\n            pending.push(buildNodeHierarchy(nodeIds[i], scene, json, parser));\r\n\r\n        }\r\n\r\n        return Promise.all(pending).then(function () {\r\n\r\n            // Removes dangling associations, associations that reference a node that\r\n            // didn't make it into the scene.\r\n            const reduceAssociations = (node) => {\r\n\r\n                const reducedAssociations = new Map();\r\n\r\n                for (const [key, value] of parser.associations) {\r\n\r\n                    if (key instanceof THREE.Material || key instanceof THREE.Texture) {\r\n\r\n                        reducedAssociations.set(key, value);\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                node.traverse((node) => {\r\n\r\n                    const mappings = parser.associations.get(node);\r\n\r\n                    if (mappings != null) {\r\n\r\n                        reducedAssociations.set(node, mappings);\r\n\r\n                    }\r\n\r\n                });\r\n\r\n                return reducedAssociations;\r\n\r\n            };\r\n\r\n            parser.associations = reduceAssociations(scene);\r\n\r\n            return scene;\r\n\r\n        });\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction buildNodeHierarchy(nodeId, parentObject, json, parser) {\r\n\r\n    const nodeDef = json.nodes[nodeId];\r\n\r\n    return parser.getDependency('node', nodeId).then(function (node) {\r\n\r\n        if (nodeDef.skin === undefined) return node;\r\n\r\n        // build skeleton here as well\r\n\r\n        let skinEntry;\r\n\r\n        return parser.getDependency('skin', nodeDef.skin).then(function (skin) {\r\n\r\n            skinEntry = skin;\r\n\r\n            const pendingJoints = [];\r\n\r\n            for (let i = 0, il = skinEntry.joints.length; i < il; i++) {\r\n\r\n                pendingJoints.push(parser.getDependency('node', skinEntry.joints[i]));\r\n\r\n            }\r\n\r\n            return Promise.all(pendingJoints);\r\n\r\n        }).then(function (jointNodes) {\r\n\r\n            node.traverse(function (mesh) {\r\n\r\n                if (!mesh.isMesh) return;\r\n\r\n                const bones = [];\r\n                const boneInverses = [];\r\n\r\n                for (let j = 0, jl = jointNodes.length; j < jl; j++) {\r\n\r\n                    const jointNode = jointNodes[j];\r\n\r\n                    if (jointNode) {\r\n\r\n                        bones.push(jointNode);\r\n\r\n                        const mat = new THREE.Matrix4();\r\n\r\n                        if (skinEntry.inverseBindMatrices !== undefined) {\r\n\r\n                            mat.fromArray(skinEntry.inverseBindMatrices.array, j * 16);\r\n\r\n                        }\r\n\r\n                        boneInverses.push(mat);\r\n\r\n                    } else {\r\n\r\n                        console.warn('THREE.GLTFLoader: Joint \"%s\" could not be found.', skinEntry.joints[j]);\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                mesh.bind(new THREE.Skeleton(bones, boneInverses), mesh.matrixWorld);\r\n\r\n            });\r\n\r\n            return node;\r\n\r\n        });\r\n\r\n    }).then(function (node) {\r\n\r\n        // build node hierachy\r\n\r\n        parentObject.add(node);\r\n\r\n        const pending = [];\r\n\r\n        if (nodeDef.children) {\r\n\r\n            const children = nodeDef.children;\r\n\r\n            for (let i = 0, il = children.length; i < il; i++) {\r\n\r\n                const child = children[i];\r\n                pending.push(buildNodeHierarchy(child, node, json, parser));\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return Promise.all(pending);\r\n\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * @param {THREE.BufferGeometry} geometry\r\n * @param {GLTF.Primitive} primitiveDef\r\n * @param {GLTFParser} parser\r\n */\r\nfunction computeBounds(geometry, primitiveDef, parser) {\r\n\r\n    const attributes = primitiveDef.attributes;\r\n\r\n    const box = new THREE.Box3();\r\n\r\n    if (attributes.POSITION !== undefined) {\r\n\r\n        const accessor = parser.json.accessors[attributes.POSITION];\r\n\r\n        const min = accessor.min;\r\n        const max = accessor.max;\r\n\r\n        // glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n        if (min !== undefined && max !== undefined) {\r\n\r\n            box.set(\r\n                new THREE.Vector3(min[0], min[1], min[2]),\r\n                new THREE.Vector3(max[0], max[1], max[2])\r\n            );\r\n\r\n            if (accessor.normalized) {\r\n\r\n                const boxScale = getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[accessor.componentType]);\r\n                box.min.multiplyScalar(boxScale);\r\n                box.max.multiplyScalar(boxScale);\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            console.warn('THREE.GLTFLoader: Missing min/max properties for accessor POSITION.');\r\n\r\n            return;\r\n\r\n        }\r\n\r\n    } else {\r\n\r\n        return;\r\n\r\n    }\r\n\r\n    const targets = primitiveDef.targets;\r\n\r\n    if (targets !== undefined) {\r\n\r\n        const maxDisplacement = new THREE.Vector3();\r\n        const vector = new THREE.Vector3();\r\n\r\n        for (let i = 0, il = targets.length; i < il; i++) {\r\n\r\n            const target = targets[i];\r\n\r\n            if (target.POSITION !== undefined) {\r\n\r\n                const accessor = parser.json.accessors[target.POSITION];\r\n                const min = accessor.min;\r\n                const max = accessor.max;\r\n\r\n                // glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n                if (min !== undefined && max !== undefined) {\r\n\r\n                    // we need to get max of absolute components because target weight is [-1,1]\r\n                    vector.setX(Math.max(Math.abs(min[0]), Math.abs(max[0])));\r\n                    vector.setY(Math.max(Math.abs(min[1]), Math.abs(max[1])));\r\n                    vector.setZ(Math.max(Math.abs(min[2]), Math.abs(max[2])));\r\n\r\n\r\n                    if (accessor.normalized) {\r\n\r\n                        const boxScale = getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[accessor.componentType]);\r\n                        vector.multiplyScalar(boxScale);\r\n\r\n                    }\r\n\r\n                    // Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\r\n                    // to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\r\n                    // are used to implement key-frame animations and as such only two are active at a time - this results in very large\r\n                    // boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\r\n                    maxDisplacement.max(vector);\r\n\r\n                } else {\r\n\r\n                    console.warn('THREE.GLTFLoader: Missing min/max properties for accessor POSITION.');\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\r\n        box.expandByVector(maxDisplacement);\r\n\r\n    }\r\n\r\n    geometry.boundingBox = box;\r\n\r\n    const sphere = new THREE.Sphere();\r\n\r\n    box.getCenter(sphere.center);\r\n    sphere.radius = box.min.distanceTo(box.max) / 2;\r\n\r\n    geometry.boundingSphere = sphere;\r\n\r\n}\r\n\r\n/**\r\n * @param {THREE.BufferGeometry} geometry\r\n * @param {GLTF.Primitive} primitiveDef\r\n * @param {GLTFParser} parser\r\n * @return {Promise<THREE.BufferGeometry>}\r\n */\r\nfunction addPrimitiveAttributes(geometry, primitiveDef, parser) {\r\n\r\n    const attributes = primitiveDef.attributes;\r\n\r\n    const pending = [];\r\n\r\n    function assignAttributeAccessor(accessorIndex, attributeName) {\r\n\r\n        return parser.getDependency('accessor', accessorIndex)\r\n            .then(function (accessor) {\r\n\r\n                geometry.setAttribute(attributeName, accessor);\r\n\r\n            });\r\n\r\n    }\r\n\r\n    for (const gltfAttributeName in attributes) {\r\n\r\n        const threeAttributeName = ATTRIBUTES[gltfAttributeName] || gltfAttributeName.toLowerCase();\r\n\r\n        // Skip attributes already provided by e.g. Draco extension.\r\n        if (threeAttributeName in geometry.attributes) continue;\r\n\r\n        pending.push(assignAttributeAccessor(attributes[gltfAttributeName], threeAttributeName));\r\n\r\n    }\r\n\r\n    if (primitiveDef.indices !== undefined && !geometry.index) {\r\n\r\n        const accessor = parser.getDependency('accessor', primitiveDef.indices).then(function (accessor) {\r\n\r\n            geometry.setIndex(accessor);\r\n\r\n        });\r\n\r\n        pending.push(accessor);\r\n\r\n    }\r\n\r\n    assignExtrasToUserData(geometry, primitiveDef);\r\n\r\n    computeBounds(geometry, primitiveDef, parser);\r\n\r\n    return Promise.all(pending).then(function () {\r\n\r\n        return primitiveDef.targets !== undefined\r\n            ? addMorphTargets(geometry, primitiveDef.targets, parser)\r\n            : geometry;\r\n\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * @param {THREE.BufferGeometry} geometry\r\n * @param {Number} drawMode\r\n * @return {THREE.BufferGeometry}\r\n */\r\nfunction toTrianglesDrawMode(geometry, drawMode) {\r\n\r\n    let index = geometry.getIndex();\r\n\r\n    // generate index if not present\r\n\r\n    if (index === null) {\r\n\r\n        const indices = [];\r\n\r\n        const position = geometry.getAttribute('position');\r\n\r\n        if (position !== undefined) {\r\n\r\n            for (let i = 0; i < position.count; i++) {\r\n\r\n                indices.push(i);\r\n\r\n            }\r\n\r\n            geometry.setIndex(indices);\r\n            index = geometry.getIndex();\r\n\r\n        } else {\r\n\r\n            console.error('THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.');\r\n            return geometry;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    //\r\n\r\n    const numberOfTriangles = index.count - 2;\r\n    const newIndices = [];\r\n\r\n    if (drawMode === THREE.TriangleFanDrawMode) {\r\n\r\n        // gl.TRIANGLE_FAN\r\n\r\n        for (let i = 1; i <= numberOfTriangles; i++) {\r\n\r\n            newIndices.push(index.getX(0));\r\n            newIndices.push(index.getX(i));\r\n            newIndices.push(index.getX(i + 1));\r\n\r\n        }\r\n\r\n    } else {\r\n\r\n        // gl.TRIANGLE_STRIP\r\n\r\n        for (let i = 0; i < numberOfTriangles; i++) {\r\n\r\n            if (i % 2 === 0) {\r\n\r\n                newIndices.push(index.getX(i));\r\n                newIndices.push(index.getX(i + 1));\r\n                newIndices.push(index.getX(i + 2));\r\n\r\n\r\n            } else {\r\n\r\n                newIndices.push(index.getX(i + 2));\r\n                newIndices.push(index.getX(i + 1));\r\n                newIndices.push(index.getX(i));\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    if ((newIndices.length / 3) !== numberOfTriangles) {\r\n\r\n        console.error('THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.');\r\n\r\n    }\r\n\r\n    // build final geometry\r\n\r\n    const newGeometry = geometry.clone();\r\n    newGeometry.setIndex(newIndices);\r\n\r\n    return newGeometry;\r\n\r\n}\r\n\r\nexport { GLTFLoader };\r\n", "/**\r\n * @webxr-input-profiles/motion-controllers 1.0.0 https://github.com/immersive-web/webxr-input-profiles\r\n */\r\n\r\nconst Constants = {\r\n  Handedness: Object.freeze({\r\n    NONE: 'none',\r\n    LEFT: 'left',\r\n    RIGHT: 'right'\r\n  }),\r\n\r\n  ComponentState: Object.freeze({\r\n    DEFAULT: 'default',\r\n    TOUCHED: 'touched',\r\n    PRESSED: 'pressed'\r\n  }),\r\n\r\n  ComponentProperty: Object.freeze({\r\n    BUTTON: 'button',\r\n    X_AXIS: 'xAxis',\r\n    Y_AXIS: 'yAxis',\r\n    STATE: 'state'\r\n  }),\r\n\r\n  ComponentType: Object.freeze({\r\n    TRIGGER: 'trigger',\r\n    SQUEEZE: 'squeeze',\r\n    TOUCHPAD: 'touchpad',\r\n    THUMBSTICK: 'thumbstick',\r\n    BUTTON: 'button'\r\n  }),\r\n\r\n  ButtonTouchThreshold: 0.05,\r\n\r\n  AxisTouchThreshold: 0.1,\r\n\r\n  VisualResponseProperty: Object.freeze({\r\n    TRANSFORM: 'transform',\r\n    VISIBILITY: 'visibility'\r\n  })\r\n};\r\n\r\n/**\r\n * @description Static helper function to fetch a JSON file and turn it into a JS object\r\n * @param {string} path - Path to JSON file to be fetched\r\n */\r\nasync function fetchJsonFile(path) {\r\n  const response = await fetch(path);\r\n  if (!response.ok) {\r\n    throw new Error(response.statusText);\r\n  } else {\r\n    return response.json();\r\n  }\r\n}\r\n\r\nasync function fetchProfilesList(basePath) {\r\n  if (!basePath) {\r\n    throw new Error('No basePath supplied');\r\n  }\r\n\r\n  const profileListFileName = 'profilesList.json';\r\n  const profilesList = await fetchJsonFile(`${basePath}/${profileListFileName}`);\r\n  return profilesList;\r\n}\r\n\r\nasync function fetchProfile(xrInputSource, basePath, defaultProfile = null, getAssetPath = true) {\r\n  if (!xrInputSource) {\r\n    throw new Error('No xrInputSource supplied');\r\n  }\r\n\r\n  if (!basePath) {\r\n    throw new Error('No basePath supplied');\r\n  }\r\n\r\n  // Get the list of profiles\r\n  const supportedProfilesList = await fetchProfilesList(basePath);\r\n\r\n  // Find the relative path to the first requested profile that is recognized\r\n  let match;\r\n  xrInputSource.profiles.some((profileId) => {\r\n    const supportedProfile = supportedProfilesList[profileId];\r\n    if (supportedProfile) {\r\n      match = {\r\n        profileId,\r\n        profilePath: `${basePath}/${supportedProfile.path}`,\r\n        deprecated: !!supportedProfile.deprecated\r\n      };\r\n    }\r\n    return !!match;\r\n  });\r\n\r\n  if (!match) {\r\n    if (!defaultProfile) {\r\n      throw new Error('No matching profile name found');\r\n    }\r\n\r\n    const supportedProfile = supportedProfilesList[defaultProfile];\r\n    if (!supportedProfile) {\r\n      throw new Error(`No matching profile name found and default profile \"${defaultProfile}\" missing.`);\r\n    }\r\n\r\n    match = {\r\n      profileId: defaultProfile,\r\n      profilePath: `${basePath}/${supportedProfile.path}`,\r\n      deprecated: !!supportedProfile.deprecated\r\n    };\r\n  }\r\n\r\n  const profile = await fetchJsonFile(match.profilePath);\r\n\r\n  let assetPath;\r\n  if (getAssetPath) {\r\n    let layout;\r\n    if (xrInputSource.handedness === 'any') {\r\n      layout = profile.layouts[Object.keys(profile.layouts)[0]];\r\n    } else {\r\n      layout = profile.layouts[xrInputSource.handedness];\r\n    }\r\n    if (!layout) {\r\n      throw new Error(\r\n        `No matching handedness, ${xrInputSource.handedness}, in profile ${match.profileId}`\r\n      );\r\n    }\r\n\r\n    if (layout.assetPath) {\r\n      assetPath = match.profilePath.replace('profile.json', layout.assetPath);\r\n    }\r\n  }\r\n\r\n  return { profile, assetPath };\r\n}\r\n\r\n/** @constant {Object} */\r\nconst defaultComponentValues = {\r\n  xAxis: 0,\r\n  yAxis: 0,\r\n  button: 0,\r\n  state: Constants.ComponentState.DEFAULT\r\n};\r\n\r\n/**\r\n * @description Converts an X, Y coordinate from the range -1 to 1 (as reported by the Gamepad\r\n * API) to the range 0 to 1 (for interpolation). Also caps the X, Y values to be bounded within\r\n * a circle. This ensures that thumbsticks are not animated outside the bounds of their physical\r\n * range of motion and touchpads do not report touch locations off their physical bounds.\r\n * @param {number} x The original x coordinate in the range -1 to 1\r\n * @param {number} y The original y coordinate in the range -1 to 1\r\n */\r\nfunction normalizeAxes(x = 0, y = 0) {\r\n  let xAxis = x;\r\n  let yAxis = y;\r\n\r\n  // Determine if the point is outside the bounds of the circle\r\n  // and, if so, place it on the edge of the circle\r\n  const hypotenuse = Math.sqrt((x * x) + (y * y));\r\n  if (hypotenuse > 1) {\r\n    const theta = Math.atan2(y, x);\r\n    xAxis = Math.cos(theta);\r\n    yAxis = Math.sin(theta);\r\n  }\r\n\r\n  // Scale and move the circle so values are in the interpolation range.  The circle's origin moves\r\n  // from (0, 0) to (0.5, 0.5). The circle's radius scales from 1 to be 0.5.\r\n  const result = {\r\n    normalizedXAxis: (xAxis * 0.5) + 0.5,\r\n    normalizedYAxis: (yAxis * 0.5) + 0.5\r\n  };\r\n  return result;\r\n}\r\n\r\n/**\r\n * Contains the description of how the 3D model should visually respond to a specific user input.\r\n * This is accomplished by initializing the object with the name of a node in the 3D model and\r\n * property that need to be modified in response to user input, the name of the nodes representing\r\n * the allowable range of motion, and the name of the input which triggers the change. In response\r\n * to the named input changing, this object computes the appropriate weighting to use for\r\n * interpolating between the range of motion nodes.\r\n */\r\nclass VisualResponse {\r\n  constructor(visualResponseDescription) {\r\n    this.componentProperty = visualResponseDescription.componentProperty;\r\n    this.states = visualResponseDescription.states;\r\n    this.valueNodeName = visualResponseDescription.valueNodeName;\r\n    this.valueNodeProperty = visualResponseDescription.valueNodeProperty;\r\n\r\n    if (this.valueNodeProperty === Constants.VisualResponseProperty.TRANSFORM) {\r\n      this.minNodeName = visualResponseDescription.minNodeName;\r\n      this.maxNodeName = visualResponseDescription.maxNodeName;\r\n    }\r\n\r\n    // Initializes the response's current value based on default data\r\n    this.value = 0;\r\n    this.updateFromComponent(defaultComponentValues);\r\n  }\r\n\r\n  /**\r\n   * Computes the visual response's interpolation weight based on component state\r\n   * @param {Object} componentValues - The component from which to update\r\n   * @param {number} xAxis - The reported X axis value of the component\r\n   * @param {number} yAxis - The reported Y axis value of the component\r\n   * @param {number} button - The reported value of the component's button\r\n   * @param {string} state - The component's active state\r\n   */\r\n  updateFromComponent({\r\n    xAxis, yAxis, button, state\r\n  }) {\r\n    const { normalizedXAxis, normalizedYAxis } = normalizeAxes(xAxis, yAxis);\r\n    switch (this.componentProperty) {\r\n      case Constants.ComponentProperty.X_AXIS:\r\n        this.value = (this.states.includes(state)) ? normalizedXAxis : 0.5;\r\n        break;\r\n      case Constants.ComponentProperty.Y_AXIS:\r\n        this.value = (this.states.includes(state)) ? normalizedYAxis : 0.5;\r\n        break;\r\n      case Constants.ComponentProperty.BUTTON:\r\n        this.value = (this.states.includes(state)) ? button : 0;\r\n        break;\r\n      case Constants.ComponentProperty.STATE:\r\n        if (this.valueNodeProperty === Constants.VisualResponseProperty.VISIBILITY) {\r\n          this.value = (this.states.includes(state));\r\n        } else {\r\n          this.value = this.states.includes(state) ? 1.0 : 0.0;\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`);\r\n    }\r\n  }\r\n}\r\n\r\nclass Component {\r\n  /**\r\n   * @param {Object} componentId - Id of the component\r\n   * @param {Object} componentDescription - Description of the component to be created\r\n   */\r\n  constructor(componentId, componentDescription) {\r\n    if (!componentId\r\n     || !componentDescription\r\n     || !componentDescription.visualResponses\r\n     || !componentDescription.gamepadIndices\r\n     || Object.keys(componentDescription.gamepadIndices).length === 0) {\r\n      throw new Error('Invalid arguments supplied');\r\n    }\r\n\r\n    this.id = componentId;\r\n    this.type = componentDescription.type;\r\n    this.rootNodeName = componentDescription.rootNodeName;\r\n    this.touchPointNodeName = componentDescription.touchPointNodeName;\r\n\r\n    // Build all the visual responses for this component\r\n    this.visualResponses = {};\r\n    Object.keys(componentDescription.visualResponses).forEach((responseName) => {\r\n      const visualResponse = new VisualResponse(componentDescription.visualResponses[responseName]);\r\n      this.visualResponses[responseName] = visualResponse;\r\n    });\r\n\r\n    // Set default values\r\n    this.gamepadIndices = Object.assign({}, componentDescription.gamepadIndices);\r\n\r\n    this.values = {\r\n      state: Constants.ComponentState.DEFAULT,\r\n      button: (this.gamepadIndices.button !== undefined) ? 0 : undefined,\r\n      xAxis: (this.gamepadIndices.xAxis !== undefined) ? 0 : undefined,\r\n      yAxis: (this.gamepadIndices.yAxis !== undefined) ? 0 : undefined\r\n    };\r\n  }\r\n\r\n  get data() {\r\n    const data = { id: this.id, ...this.values };\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @description Poll for updated data based on current gamepad state\r\n   * @param {Object} gamepad - The gamepad object from which the component data should be polled\r\n   */\r\n  updateFromGamepad(gamepad) {\r\n    // Set the state to default before processing other data sources\r\n    this.values.state = Constants.ComponentState.DEFAULT;\r\n\r\n    // Get and normalize button\r\n    if (this.gamepadIndices.button !== undefined\r\n        && gamepad.buttons.length > this.gamepadIndices.button) {\r\n      const gamepadButton = gamepad.buttons[this.gamepadIndices.button];\r\n      this.values.button = gamepadButton.value;\r\n      this.values.button = (this.values.button < 0) ? 0 : this.values.button;\r\n      this.values.button = (this.values.button > 1) ? 1 : this.values.button;\r\n\r\n      // Set the state based on the button\r\n      if (gamepadButton.pressed || this.values.button === 1) {\r\n        this.values.state = Constants.ComponentState.PRESSED;\r\n      } else if (gamepadButton.touched || this.values.button > Constants.ButtonTouchThreshold) {\r\n        this.values.state = Constants.ComponentState.TOUCHED;\r\n      }\r\n    }\r\n\r\n    // Get and normalize x axis value\r\n    if (this.gamepadIndices.xAxis !== undefined\r\n        && gamepad.axes.length > this.gamepadIndices.xAxis) {\r\n      this.values.xAxis = gamepad.axes[this.gamepadIndices.xAxis];\r\n      this.values.xAxis = (this.values.xAxis < -1) ? -1 : this.values.xAxis;\r\n      this.values.xAxis = (this.values.xAxis > 1) ? 1 : this.values.xAxis;\r\n\r\n      // If the state is still default, check if the xAxis makes it touched\r\n      if (this.values.state === Constants.ComponentState.DEFAULT\r\n        && Math.abs(this.values.xAxis) > Constants.AxisTouchThreshold) {\r\n        this.values.state = Constants.ComponentState.TOUCHED;\r\n      }\r\n    }\r\n\r\n    // Get and normalize Y axis value\r\n    if (this.gamepadIndices.yAxis !== undefined\r\n        && gamepad.axes.length > this.gamepadIndices.yAxis) {\r\n      this.values.yAxis = gamepad.axes[this.gamepadIndices.yAxis];\r\n      this.values.yAxis = (this.values.yAxis < -1) ? -1 : this.values.yAxis;\r\n      this.values.yAxis = (this.values.yAxis > 1) ? 1 : this.values.yAxis;\r\n\r\n      // If the state is still default, check if the yAxis makes it touched\r\n      if (this.values.state === Constants.ComponentState.DEFAULT\r\n        && Math.abs(this.values.yAxis) > Constants.AxisTouchThreshold) {\r\n        this.values.state = Constants.ComponentState.TOUCHED;\r\n      }\r\n    }\r\n\r\n    // Update the visual response weights based on the current component data\r\n    Object.values(this.visualResponses).forEach((visualResponse) => {\r\n      visualResponse.updateFromComponent(this.values);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n  * @description Builds a motion controller with components and visual responses based on the\r\n  * supplied profile description. Data is polled from the xrInputSource's gamepad.\r\n  * @author Nell Waliczek / https://github.com/NellWaliczek\r\n*/\r\nclass MotionController {\r\n  /**\r\n   * @param {Object} xrInputSource - The XRInputSource to build the MotionController around\r\n   * @param {Object} profile - The best matched profile description for the supplied xrInputSource\r\n   * @param {Object} assetUrl\r\n   */\r\n  constructor(xrInputSource, profile, assetUrl) {\r\n    if (!xrInputSource) {\r\n      throw new Error('No xrInputSource supplied');\r\n    }\r\n\r\n    if (!profile) {\r\n      throw new Error('No profile supplied');\r\n    }\r\n\r\n    this.xrInputSource = xrInputSource;\r\n    this.assetUrl = assetUrl;\r\n    this.id = profile.profileId;\r\n\r\n    // Build child components as described in the profile description\r\n    this.layoutDescription = profile.layouts[xrInputSource.handedness];\r\n    this.components = {};\r\n    Object.keys(this.layoutDescription.components).forEach((componentId) => {\r\n      const componentDescription = this.layoutDescription.components[componentId];\r\n      this.components[componentId] = new Component(componentId, componentDescription);\r\n    });\r\n\r\n    // Initialize components based on current gamepad state\r\n    this.updateFromGamepad();\r\n  }\r\n\r\n  get gripSpace() {\r\n    return this.xrInputSource.gripSpace;\r\n  }\r\n\r\n  get targetRaySpace() {\r\n    return this.xrInputSource.targetRaySpace;\r\n  }\r\n\r\n  /**\r\n   * @description Returns a subset of component data for simplified debugging\r\n   */\r\n  get data() {\r\n    const data = [];\r\n    Object.values(this.components).forEach((component) => {\r\n      data.push(component.data);\r\n    });\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @description Poll for updated data based on current gamepad state\r\n   */\r\n  updateFromGamepad() {\r\n    Object.values(this.components).forEach((component) => {\r\n      component.updateFromGamepad(this.xrInputSource.gamepad);\r\n    });\r\n  }\r\n}\r\n\r\nexport { Constants, MotionController, fetchProfile, fetchProfilesList };\r\n", "import { GLTFLoader } from '../loaders/GLTFLoader';\r\n\r\nimport {\r\n\tConstants as MotionControllerConstants,\r\n\tfetchProfile,\r\n\tMotionController\r\n} from './motion-controllers.module.js';\r\n\r\nconst DEFAULT_PROFILES_PATH = 'https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles';\r\nconst DEFAULT_PROFILE = 'generic-trigger';\r\n\r\nclass XRControllerModel extends THREE.Object3D {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.motionController = null;\r\n\t\tthis.envMap = null;\r\n\r\n\t}\r\n\r\n\tsetEnvironmentMap( envMap ) {\r\n\r\n\t\tif ( this.envMap == envMap ) {\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tthis.envMap = envMap;\r\n\t\tthis.traverse( ( child ) => {\r\n\r\n\t\t\tif ( child.isMesh ) {\r\n\r\n\t\t\t\tchild.material.envMap = this.envMap;\r\n\t\t\t\tchild.material.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Polls data from the XRInputSource and updates the model's components to match\r\n\t * the real world data\r\n\t */\r\n\tupdateMatrixWorld( force ) {\r\n\r\n\t\tsuper.updateMatrixWorld( force );\r\n\r\n\t\tif ( ! this.motionController ) return;\r\n\r\n\t\t// Cause the MotionController to poll the Gamepad for data\r\n\t\tthis.motionController.updateFromGamepad();\r\n\r\n\t\t// Update the 3D model to reflect the button, thumbstick, and touchpad state\r\n\t\tObject.values( this.motionController.components ).forEach( ( component ) => {\r\n\r\n\t\t\t// Update node data based on the visual responses' current states\r\n\t\t\tObject.values( component.visualResponses ).forEach( ( visualResponse ) => {\r\n\r\n\t\t\t\tconst { valueNode, minNode, maxNode, value, valueNodeProperty } = visualResponse;\r\n\r\n\t\t\t\t// Skip if the visual response node is not found. No error is needed,\r\n\t\t\t\t// because it will have been reported at load time.\r\n\t\t\t\tif ( ! valueNode ) return;\r\n\r\n\t\t\t\t// Calculate the new properties based on the weight supplied\r\n\t\t\t\tif ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.VISIBILITY ) {\r\n\r\n\t\t\t\t\tvalueNode.visible = value;\r\n\r\n\t\t\t\t} else if ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.TRANSFORM ) {\r\n\r\n\t\t\t\t\tvalueNode.quaternion.slerpQuaternions(\r\n\t\t\t\t\t\tminNode.quaternion,\r\n\t\t\t\t\t\tmaxNode.quaternion,\r\n\t\t\t\t\t\tvalue\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tvalueNode.position.lerpVectors(\r\n\t\t\t\t\t\tminNode.position,\r\n\t\t\t\t\t\tmaxNode.position,\r\n\t\t\t\t\t\tvalue\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Walks the model's tree to find the nodes needed to animate the components and\r\n * saves them to the motionContoller components for use in the frame loop. When\r\n * touchpads are found, attaches a touch dot to them.\r\n */\r\nfunction findNodes( motionController, scene ) {\r\n\r\n\t// Loop through the components and find the nodes needed for each components' visual responses\r\n\tObject.values( motionController.components ).forEach( ( component ) => {\r\n\r\n\t\tconst { type, touchPointNodeName, visualResponses } = component;\r\n\r\n\t\tif ( type === MotionControllerConstants.ComponentType.TOUCHPAD ) {\r\n\r\n\t\t\tcomponent.touchPointNode = scene.getObjectByName( touchPointNodeName );\r\n\t\t\tif ( component.touchPointNode ) {\r\n\r\n\t\t\t\t// Attach a touch dot to the touchpad.\r\n\t\t\t\tconst sphereGeometry = new THREE.SphereGeometry( 0.001 );\r\n\t\t\t\tconst material = new THREE.MeshBasicMaterial( { color: 0x0000FF } );\r\n\t\t\t\tconst sphere = new THREE.Mesh( sphereGeometry, material );\r\n\t\t\t\tcomponent.touchPointNode.add( sphere );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( `Could not find touch dot, ${component.touchPointNodeName}, in touchpad component ${component.id}` );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Loop through all the visual responses to be applied to this component\r\n\t\tObject.values( visualResponses ).forEach( ( visualResponse ) => {\r\n\r\n\t\t\tconst { valueNodeName, minNodeName, maxNodeName, valueNodeProperty } = visualResponse;\r\n\r\n\t\t\t// If animating a transform, find the two nodes to be interpolated between.\r\n\t\t\tif ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.TRANSFORM ) {\r\n\r\n\t\t\t\tvisualResponse.minNode = scene.getObjectByName( minNodeName );\r\n\t\t\t\tvisualResponse.maxNode = scene.getObjectByName( maxNodeName );\r\n\r\n\t\t\t\t// If the extents cannot be found, skip this animation\r\n\t\t\t\tif ( ! visualResponse.minNode ) {\r\n\r\n\t\t\t\t\tconsole.warn( `Could not find ${minNodeName} in the model` );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( ! visualResponse.maxNode ) {\r\n\r\n\t\t\t\t\tconsole.warn( `Could not find ${maxNodeName} in the model` );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// If the target node cannot be found, skip this animation\r\n\t\t\tvisualResponse.valueNode = scene.getObjectByName( valueNodeName );\r\n\t\t\tif ( ! visualResponse.valueNode ) {\r\n\r\n\t\t\t\tconsole.warn( `Could not find ${valueNodeName} in the model` );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t} );\r\n\r\n}\r\n\r\nfunction addAssetSceneToControllerModel( controllerModel, scene ) {\r\n\r\n\t// Find the nodes needed for animation and cache them on the motionController.\r\n\tfindNodes( controllerModel.motionController, scene );\r\n\r\n\t// Apply any environment map that the mesh already has set.\r\n\tif ( controllerModel.envMap ) {\r\n\r\n\t\tscene.traverse( ( child ) => {\r\n\r\n\t\t\tif ( child.isMesh ) {\r\n\r\n\t\t\t\tchild.material.envMap = controllerModel.envMap;\r\n\t\t\t\tchild.material.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t// Add the glTF scene to the controllerModel.\r\n\tcontrollerModel.add( scene );\r\n\r\n}\r\n\r\nclass XRControllerModelFactory {\r\n\r\n\tconstructor( gltfLoader = null ) {\r\n\r\n\t\tthis.gltfLoader = gltfLoader;\r\n\t\tthis.path = DEFAULT_PROFILES_PATH;\r\n\t\tthis._assetCache = {};\r\n\r\n\t\t// If a GLTFLoader wasn't supplied to the constructor create a new one.\r\n\t\tif ( ! this.gltfLoader ) {\r\n\r\n\t\t\tthis.gltfLoader = new GLTFLoader();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcreateControllerModel( controller ) {\r\n\r\n\t\tconst controllerModel = new XRControllerModel();\r\n\t\tlet scene = null;\r\n\r\n\t\tcontroller.addEventListener( 'connected', ( event ) => {\r\n\r\n\t\t\tconst xrInputSource = event.data;\r\n\r\n\t\t\tif ( xrInputSource.targetRayMode !== 'tracked-pointer' || ! xrInputSource.gamepad ) return;\r\n\r\n\t\t\tfetchProfile( xrInputSource, this.path, DEFAULT_PROFILE ).then( ( { profile, assetPath } ) => {\r\n\r\n\t\t\t\tcontrollerModel.motionController = new MotionController(\r\n\t\t\t\t\txrInputSource,\r\n\t\t\t\t\tprofile,\r\n\t\t\t\t\tassetPath\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst cachedAsset = this._assetCache[ controllerModel.motionController.assetUrl ];\r\n\t\t\t\tif ( cachedAsset ) {\r\n\r\n\t\t\t\t\tscene = cachedAsset.scene.clone();\r\n\r\n\t\t\t\t\taddAssetSceneToControllerModel( controllerModel, scene );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( ! this.gltfLoader ) {\r\n\r\n\t\t\t\t\t\tthrow new Error( 'GLTFLoader not set.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.gltfLoader.setPath( '' );\r\n\t\t\t\t\tthis.gltfLoader.load( controllerModel.motionController.assetUrl, ( asset ) => {\r\n\r\n\t\t\t\t\t\tthis._assetCache[ controllerModel.motionController.assetUrl ] = asset;\r\n\r\n\t\t\t\t\t\tscene = asset.scene.clone();\r\n\r\n\t\t\t\t\t\taddAssetSceneToControllerModel( controllerModel, scene );\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnull,\r\n\t\t\t\t\t() => {\r\n\r\n\t\t\t\t\t\tthrow new Error( `Asset ${controllerModel.motionController.assetUrl} missing or malformed.` );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} ).catch( ( err ) => {\r\n\r\n\t\t\t\tconsole.warn( err );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t\tcontroller.addEventListener( 'disconnected', () => {\r\n\r\n\t\t\tcontrollerModel.motionController = null;\r\n\t\t\tcontrollerModel.remove( scene );\r\n\t\t\tscene = null;\r\n\r\n\t\t} );\r\n\r\n\t\treturn controllerModel;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { XRControllerModelFactory };\r\n", "const _matrix = new THREE.Matrix4();\r\nconst _vector = new THREE.Vector3();\r\nconst _oculusBrowserV14CorrectionRight = new THREE.Matrix4().identity();\r\nconst _oculusBrowserV14CorrectionLeft = new THREE.Matrix4().identity();\r\n\r\nif (/OculusBrowser\\/14\\./.test(navigator.userAgent)) {\r\n    _oculusBrowserV14CorrectionRight.makeRotationY(Math.PI / 2);\r\n    _oculusBrowserV14CorrectionLeft.makeRotationY(-Math.PI / 2);\r\n}\r\n\r\nclass XRHandPrimitiveModel {\r\n\r\n    constructor(handModel, controller, path, handedness, options) {\r\n\r\n        this.controller = controller;\r\n        this.handModel = handModel;\r\n        this.envMap = null;\r\n\r\n        this.oculusBrowserV14Correction = handedness === 'left' ? _oculusBrowserV14CorrectionLeft : _oculusBrowserV14CorrectionRight;\r\n\r\n        let geometry;\r\n\r\n        if (!options || !options.primitive || options.primitive === 'sphere') {\r\n\r\n            geometry = new THREE.SphereGeometry(1, 10, 10);\r\n\r\n        } else if (options.primitive === 'box') {\r\n\r\n            geometry = new THREE.BoxGeometry(1, 1, 1);\r\n\r\n        } else if (options.primitive === 'bone') {\r\n\r\n            geometry = new THREE.CylinderGeometry(0.5, 0.75, 2.25, 10, 1).rotateX(-Math.PI / 2);\r\n\r\n        }\r\n\r\n        const material = new THREE.MeshStandardMaterial();\r\n\r\n        this.handMesh = new THREE.InstancedMesh(geometry, material, 30);\r\n        this.handMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage); // will be updated every frame\r\n        this.handMesh.castShadow = true;\r\n        this.handMesh.receiveShadow = true;\r\n        this.handModel.add(this.handMesh);\r\n\r\n        this.joints = [\r\n            'wrist',\r\n            'thumb-metacarpal',\r\n            'thumb-phalanx-proximal',\r\n            'thumb-phalanx-distal',\r\n            'thumb-tip',\r\n            'index-finger-metacarpal',\r\n            'index-finger-phalanx-proximal',\r\n            'index-finger-phalanx-intermediate',\r\n            'index-finger-phalanx-distal',\r\n            'index-finger-tip',\r\n            'middle-finger-metacarpal',\r\n            'middle-finger-phalanx-proximal',\r\n            'middle-finger-phalanx-intermediate',\r\n            'middle-finger-phalanx-distal',\r\n            'middle-finger-tip',\r\n            'ring-finger-metacarpal',\r\n            'ring-finger-phalanx-proximal',\r\n            'ring-finger-phalanx-intermediate',\r\n            'ring-finger-phalanx-distal',\r\n            'ring-finger-tip',\r\n            'pinky-finger-metacarpal',\r\n            'pinky-finger-phalanx-proximal',\r\n            'pinky-finger-phalanx-intermediate',\r\n            'pinky-finger-phalanx-distal',\r\n            'pinky-finger-tip'\r\n        ];\r\n\r\n    }\r\n\r\n    updateMesh() {\r\n\r\n        const defaultRadius = 0.008;\r\n        const joints = this.controller.joints;\r\n\r\n        let count = 0;\r\n\r\n        for (let i = 0; i < this.joints.length; i++) {\r\n\r\n            const joint = joints[this.joints[i]];\r\n\r\n            if (joint.visible) {\r\n\r\n                _vector.setScalar(joint.jointRadius || defaultRadius);\r\n                _matrix.compose(joint.position, joint.quaternion, _vector);\r\n                _matrix.multiply(this.oculusBrowserV14Correction);\r\n                this.handMesh.setMatrixAt(i, _matrix);\r\n\r\n                count++;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.handMesh.count = count;\r\n        this.handMesh.instanceMatrix.needsUpdate = true;\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { XRHandPrimitiveModel };\r\n", "import { GLTFLoader } from '../loaders/GLTFLoader';\r\n\r\nconst _oculusBrowserV14CorrectionRight = new THREE.Quaternion().identity();\r\nconst _oculusBrowserV14CorrectionLeft = new THREE.Quaternion().identity();\r\n\r\nif (/OculusBrowser\\/14\\./.test(navigator.userAgent)) {\r\n    _oculusBrowserV14CorrectionRight.setFromAxisAngle({ x: 0, y: 1, z: 0 }, Math.PI / 2);\r\n    _oculusBrowserV14CorrectionLeft.setFromAxisAngle({ x: 1, y: 0, z: 0 }, Math.PI)\r\n        .premultiply(_oculusBrowserV14CorrectionRight);\r\n}\r\n\r\nconst DEFAULT_HAND_PROFILE_PATH = 'https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/';\r\n\r\nclass XRHandMeshModel {\r\n\r\n    constructor(handModel, controller, path, handedness) {\r\n\r\n        this.controller = controller;\r\n        this.handModel = handModel;\r\n\r\n        this.oculusBrowserV14Correction = handedness === 'left' ? _oculusBrowserV14CorrectionLeft : _oculusBrowserV14CorrectionRight;\r\n\r\n        this.bones = [];\r\n\r\n        const loader = new GLTFLoader();\r\n        loader.setPath(path || DEFAULT_HAND_PROFILE_PATH);\r\n        loader.load(`${handedness}.glb`, gltf => {\r\n\r\n            const object = gltf.scene.children[0];\r\n            this.handModel.add(object);\r\n\r\n            const mesh = object.getObjectByProperty('type', 'SkinnedMesh');\r\n            mesh.frustumCulled = false;\r\n            mesh.castShadow = true;\r\n            mesh.receiveShadow = true;\r\n\r\n            const joints = [\r\n                'wrist',\r\n                'thumb-metacarpal',\r\n                'thumb-phalanx-proximal',\r\n                'thumb-phalanx-distal',\r\n                'thumb-tip',\r\n                'index-finger-metacarpal',\r\n                'index-finger-phalanx-proximal',\r\n                'index-finger-phalanx-intermediate',\r\n                'index-finger-phalanx-distal',\r\n                'index-finger-tip',\r\n                'middle-finger-metacarpal',\r\n                'middle-finger-phalanx-proximal',\r\n                'middle-finger-phalanx-intermediate',\r\n                'middle-finger-phalanx-distal',\r\n                'middle-finger-tip',\r\n                'ring-finger-metacarpal',\r\n                'ring-finger-phalanx-proximal',\r\n                'ring-finger-phalanx-intermediate',\r\n                'ring-finger-phalanx-distal',\r\n                'ring-finger-tip',\r\n                'pinky-finger-metacarpal',\r\n                'pinky-finger-phalanx-proximal',\r\n                'pinky-finger-phalanx-intermediate',\r\n                'pinky-finger-phalanx-distal',\r\n                'pinky-finger-tip',\r\n            ];\r\n\r\n            joints.forEach(jointName => {\r\n\r\n                const bone = object.getObjectByName(jointName);\r\n\r\n                if (bone !== undefined) {\r\n\r\n                    bone.jointName = jointName;\r\n\r\n                } else {\r\n\r\n                    console.warn(`Couldn't find ${jointName} in ${handedness} hand mesh`);\r\n\r\n                }\r\n\r\n                this.bones.push(bone);\r\n\r\n            });\r\n\r\n        });\r\n\r\n    }\r\n\r\n    updateMesh() {\r\n\r\n        // XR Joints\r\n        const XRJoints = this.controller.joints;\r\n\r\n        for (let i = 0; i < this.bones.length; i++) {\r\n\r\n            const bone = this.bones[i];\r\n\r\n            if (bone) {\r\n\r\n                const XRJoint = XRJoints[bone.jointName];\r\n\r\n                if (XRJoint.visible) {\r\n\r\n                    const position = XRJoint.position;\r\n\r\n                    if (bone) {\r\n\r\n                        bone.position.copy(position);\r\n                        bone.quaternion.copy(XRJoint.quaternion)\r\n                            .multiply(this.oculusBrowserV14Correction);\r\n                        // bone.scale.setScalar( XRJoint.jointRadius || defaultRadius );\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { XRHandMeshModel };\r\n", "import { XRHandPrimitiveModel } from './XRHandPrimitiveModel';\r\nimport { XRHandMeshModel } from './XRHandMeshModel';\r\n\r\nclass XRHandModel extends THREE.Object3D {\r\n\r\n    constructor(controller) {\r\n\r\n        super();\r\n\r\n        this.controller = controller;\r\n        this.motionController = null;\r\n        this.envMap = null;\r\n\r\n        this.mesh = null;\r\n\r\n    }\r\n\r\n    updateMatrixWorld(force) {\r\n\r\n        super.updateMatrixWorld(force);\r\n\r\n        if (this.motionController) {\r\n\r\n            this.motionController.updateMesh();\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nclass XRHandModelFactory {\r\n\r\n    constructor() {\r\n\r\n        this.path = null;\r\n\r\n    }\r\n\r\n    setPath(path) {\r\n\r\n        this.path = path;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    createHandModel(controller, profile) {\r\n\r\n        const handModel = new XRHandModel(controller);\r\n\r\n        controller.addEventListener('connected', (event) => {\r\n\r\n            const xrInputSource = event.data;\r\n\r\n            if (xrInputSource.hand && !handModel.motionController) {\r\n\r\n                handModel.xrInputSource = xrInputSource;\r\n\r\n                // @todo Detect profile if not provided\r\n\t\t\t\tif ( profile === undefined || profile === 'spheres' ) {\r\n\r\n\t\t\t\t\thandModel.motionController = new XRHandPrimitiveModel( handModel, controller, this.path, xrInputSource.handedness, { primitive: 'sphere' } );\r\n\r\n\t\t\t\t} else if ( profile === 'boxes' ) {\r\n\r\n\t\t\t\t\thandModel.motionController = new XRHandPrimitiveModel( handModel, controller, this.path, xrInputSource.handedness, { primitive: 'box' } );\r\n\r\n\t\t\t\t} else if ( profile === 'bones' ) {\r\n\r\n\t\t\t\t\thandModel.motionController = new XRHandPrimitiveModel( handModel, controller, this.path, xrInputSource.handedness, { primitive: 'bone' } );\r\n\r\n\t\t\t\t} else if ( profile === 'mesh' ) {\r\n\r\n\t\t\t\t\thandModel.motionController = new XRHandMeshModel( handModel, controller, this.path, xrInputSource.handedness );\r\n\r\n\t\t\t\t}\r\n            }\r\n\r\n        });\r\n\r\n        controller.addEventListener('disconnected', () => {\r\n\r\n            // handModel.motionController = null;\r\n            // handModel.remove( scene );\r\n            // scene = null;\r\n\r\n        });\r\n\r\n        return handModel;\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { XRHandModelFactory };\r\n", "export class PointerState {\r\n    buttons = 0;\r\n    moveDistance = 0;\r\n    dragDistance = 0;\r\n    readonly position = new THREE.Vector2();\r\n    readonly motion = new THREE.Vector2();\r\n    dz = 0;\r\n    readonly uv = new THREE.Vector2();\r\n    readonly duv = new THREE.Vector2();\r\n    canClick = false;\r\n    dragging = false;\r\n    ctrl = false;\r\n    alt = false;\r\n    shift = false;\r\n    meta = false;\r\n\r\n    constructor() {\r\n        Object.seal(this);\r\n    }\r\n\r\n    copy(ptr: PointerState) {\r\n        this.buttons = ptr.buttons;\r\n        this.moveDistance = ptr.moveDistance;\r\n        this.dragDistance = ptr.dragDistance;\r\n        this.position.copy(ptr.position);\r\n        this.motion.copy(ptr.motion);\r\n        this.dz = ptr.dz;\r\n        this.uv.copy(ptr.uv);\r\n        this.duv.copy(ptr.duv);\r\n        this.canClick = ptr.canClick;\r\n        this.dragging = ptr.dragging;\r\n        this.ctrl = ptr.ctrl;\r\n        this.alt = ptr.alt;\r\n        this.shift = ptr.shift;\r\n        this.meta = ptr.meta;\r\n    }\r\n}\r\n", "/**\r\n * Recalculates the UV coordinates for a BufferGeometry\r\n * object to be able to map to a Cubemap that is packed as\r\n * a cross-configuration in a single image.\r\n */\r\nexport function setGeometryUVsForCubemaps(geom: THREE.ShapeBufferGeometry) {\r\n    const positions = geom.attributes.position;\r\n    const normals = geom.attributes.normal;\r\n    const uvs = geom.attributes.uv;\r\n\r\n    for (let n = 0; n < normals.count; ++n) {\r\n        const _x = n * normals.itemSize,\r\n            _y = n * normals.itemSize + 1,\r\n            _z = n * normals.itemSize + 2,\r\n            nx = normals.array[_x],\r\n            ny = normals.array[_y],\r\n            nz = normals.array[_z],\r\n            _nx_ = Math.abs(nx),\r\n            _ny_ = Math.abs(ny),\r\n            _nz_ = Math.abs(nz),\r\n            px = positions.array[_x],\r\n            py = positions.array[_y],\r\n            pz = positions.array[_z],\r\n            _px_ = Math.abs(px),\r\n            _py_ = Math.abs(py),\r\n            _pz_ = Math.abs(pz),\r\n            _u = n * uvs.itemSize,\r\n            _v = n * uvs.itemSize + 1;\r\n\r\n        let u = uvs.array[_u],\r\n            v = uvs.array[_v],\r\n            largest = 0,\r\n            mx = _nx_,\r\n            max = _px_;\r\n\r\n        if (_ny_ > mx) {\r\n            largest = 1;\r\n            mx = _ny_;\r\n            max = _py_;\r\n        }\r\n        if (_nz_ > mx) {\r\n            largest = 2;\r\n            mx = _nz_;\r\n            max = _pz_;\r\n        }\r\n\r\n        if (largest === 0) {\r\n            if (px < 0) {\r\n                //left\r\n                u = -pz;\r\n                v = py;\r\n            }\r\n            else {\r\n                // right\r\n                u = pz;\r\n                v = py;\r\n            }\r\n        }\r\n        else if (largest === 1) {\r\n            if (py < 0) {\r\n                // bottom\r\n                u = px;\r\n                v = -pz;\r\n            }\r\n            else {\r\n                // top\r\n                u = px;\r\n                v = pz;\r\n            }\r\n        }\r\n        else {\r\n            if (pz < 0) {\r\n                // front\r\n                u = px;\r\n                v = py;\r\n            }\r\n            else {\r\n                // back\r\n                u = -px;\r\n                v = py;\r\n            }\r\n        }\r\n\r\n        u = (u / max + 1) / 8;\r\n        v = (v / max + 1) / 6;\r\n\r\n        if (largest === 0) {\r\n            if (px < 0) {\r\n                //left\r\n                u += 0;\r\n                v += 1 / 3;\r\n            }\r\n            else {\r\n                // right\r\n                u += 0.5;\r\n                v += 1 / 3;\r\n            }\r\n        }\r\n        else if (largest === 1) {\r\n            if (py < 0) {\r\n                // bottom\r\n                u += 0.25;\r\n                v += 0;\r\n            }\r\n            else {\r\n                // top\r\n                u += 0.25;\r\n                v += 2 / 3;\r\n            }\r\n        }\r\n        else {\r\n            if (pz < 0) {\r\n                // front\r\n                u += 0.25;\r\n                v += 1 / 3;\r\n            }\r\n            else {\r\n                // back\r\n                u += 0.75;\r\n                v += 1 / 3;\r\n            }\r\n        }\r\n\r\n        const arr = uvs.array as any;\r\n        arr[_u] = u;\r\n        arr[_v] = v;\r\n    }\r\n}\r\n", "import type { SolidMaterial } from \"./materials\";\r\nimport { setGeometryUVsForCubemaps } from \"./setGeometryUVsForCubemaps\";\r\n\r\nexport const cube = new THREE.BoxBufferGeometry(1, 1, 1, 1, 1, 1);\r\ncube.name = \"CubeGeom\";\r\n\r\nexport const invCube = cube.clone() as THREE.BoxBufferGeometry;\r\ninvCube.name = \"InvertedCubeGeom\";\r\nsetGeometryUVsForCubemaps(invCube);\r\n\r\nexport class Cube extends THREE.Mesh {\r\n    constructor(sx: number, sy: number, sz: number, material: SolidMaterial) {\r\n        super(cube, material);\r\n        this.scale.set(sx, sy, sz);\r\n    }\r\n}\r\n\r\nexport class InvCube extends THREE.Mesh {\r\n    constructor(sx: number, sy: number, sz: number, material: SolidMaterial) {\r\n        super(invCube, material);\r\n        this.scale.set(sx, sy, sz);\r\n    }\r\n}", "import { isArray } from \"@juniper-lib/tslib\";\r\nimport { Cube } from \"../Cube\";\r\nimport { solid } from \"../materials\";\r\nimport { objectIsVisible, objectSetVisible } from \"../objects\";\r\nimport { isMesh } from \"../typeChecks\";\r\nimport { BaseCursor } from \"./BaseCursor\";\r\n\r\nexport class CursorColor extends BaseCursor {\r\n    private _currentStyle: string;\r\n    private material: THREE.MeshBasicMaterial;\r\n\r\n    constructor() {\r\n        super();\r\n        this.material = solid({\r\n            name: \"CursorMat\",\r\n            color: 0xffff00\r\n        });\r\n        this.object = new Cube(0.01, 0.01, 0.01, this.material);\r\n    }\r\n\r\n    get position() {\r\n        return this.object.position;\r\n    }\r\n\r\n    override get style() {\r\n        return this._currentStyle;\r\n    }\r\n\r\n    override set style(v) {\r\n        this._currentStyle = v;\r\n        if (isMesh(this.object)\r\n            && !isArray(this.object.material)) {\r\n            switch (this._currentStyle) {\r\n                case \"pointer\":\r\n                    this.material.color = new THREE.Color(0x00ff00);\r\n                    this.material.needsUpdate = true;\r\n                    break;\r\n                case \"not-allowed\":\r\n                    this.material.color = new THREE.Color(0xff0000);\r\n                    this.material.needsUpdate = true;\r\n                    break;\r\n                case \"move\":\r\n                    this.material.color = new THREE.Color(0x0000ff);\r\n                    this.material.needsUpdate = true;\r\n                    break;\r\n                case \"grab\":\r\n                    this.material.color = new THREE.Color(0xff00ff);\r\n                    this.material.needsUpdate = true;\r\n                    break;\r\n                case \"grabbing\":\r\n                    this.material.color = new THREE.Color(0x00ffff);\r\n                    this.material.needsUpdate = true;\r\n                    break;\r\n                default:\r\n                    this._currentStyle = \"default\";\r\n                    this.material.color = new THREE.Color(0xffff00);\r\n                    this.material.needsUpdate = true;\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    override get visible() {\r\n        return objectIsVisible(this);\r\n    }\r\n\r\n    override set visible(v) {\r\n        objectSetVisible(this, v);\r\n    }\r\n}", "import { BaseCursor } from \"./BaseCursor\";\r\n\r\nexport class CursorSystem extends BaseCursor {\r\n    private _hidden = false;\r\n\r\n    constructor(public element: HTMLElement) {\r\n        super();\r\n\r\n        this.visible = true;\r\n        this.style = \"default\";\r\n\r\n        document.addEventListener(\"pointerlockchange\", () => {\r\n            this._hidden = !!document.pointerLockElement;\r\n            this.refresh();\r\n        });\r\n    }\r\n\r\n    get position(): THREE.Vector3 {\r\n        throw new Error(\"BaseCursor::get_Position(): Method not implemented.\");\r\n    }\r\n\r\n    override get style() {\r\n        return super.style;\r\n    }\r\n\r\n    override set style(v) {\r\n        super.style = v;\r\n        this.refresh();\r\n    }\r\n\r\n    override get visible() {\r\n        return super.visible\r\n            && !this._hidden;\r\n    }\r\n\r\n    override set visible(v) {\r\n        super.visible = v;\r\n        this.refresh();\r\n    }\r\n\r\n    private refresh() {\r\n        this.element.style.cursor = this.visible\r\n            ? this.style\r\n            : \"none\";\r\n    }\r\n}", "import { objectSetVisible } from \"../objects\";\r\nimport { BaseCursor } from \"./BaseCursor\";\r\nimport { CursorColor } from \"./CursorColor\";\r\nimport { CursorSystem } from \"./CursorSystem\";\r\n\r\nexport class CursorXRMouse extends BaseCursor {\r\n    private readonly system: CursorSystem;\r\n    private xr: BaseCursor = new CursorColor();\r\n\r\n    constructor(private readonly renderer: THREE.WebGLRenderer) {\r\n        super();\r\n\r\n        this.system = new CursorSystem(this.renderer.domElement);\r\n        this.visible = false;\r\n    }\r\n\r\n    override get object() {\r\n        return this.xr.object;\r\n    }\r\n\r\n    get cursor() {\r\n        return this.xr;\r\n    }\r\n\r\n    set cursor(v) {\r\n        this.xr = v;\r\n        this._refresh();\r\n    }\r\n\r\n    get position() {\r\n        return this.object.position;\r\n    }\r\n\r\n    override get style() {\r\n        return this.system.style;\r\n    }\r\n\r\n    override get visible() {\r\n        return this.renderer.xr.isPresenting\r\n            && this.xr.visible\r\n            || !this.renderer.xr.isPresenting\r\n            && this.system.visible;\r\n    }\r\n\r\n    override set visible(v) {\r\n        super.visible = v;\r\n        this._refresh();\r\n    }\r\n\r\n    override set style(v) {\r\n        this.system.style = v;\r\n        this.xr.style = v;\r\n        this._refresh();\r\n    }\r\n\r\n    _refresh() {\r\n        objectSetVisible(this.xr, this.visible\r\n            && (this.renderer.xr.isPresenting\r\n                || document.pointerLockElement != null));\r\n    }\r\n\r\n    override lookAt(v: THREE.Vector3) {\r\n        this.xr.lookAt(v);\r\n    }\r\n}", "import { MouseButtons } from \"@juniper-lib/threejs/eventSystem/MouseButton\";\r\nimport { SourcePointerEventTypes } from \"@juniper-lib/threejs/eventSystem/PointerEventTypes\";\r\nimport { PointerState } from \"@juniper-lib/threejs/eventSystem/PointerState\";\r\nimport { VirtualButtons } from \"@juniper-lib/threejs/eventSystem/VirtualButtons\";\r\nimport { PointerName } from \"@juniper-lib/tslib/events/PointerName\";\r\nimport type { BaseCursor } from \"./BaseCursor\";\r\nimport { CursorXRMouse } from \"./CursorXRMouse\";\r\nimport type { EventSystem } from \"./EventSystem\";\r\nimport type { IPointer, PointerType } from \"./IPointer\";\r\nimport { getMeshTarget } from \"./RayTarget\";\r\n\r\nconst MAX_DRAG_DISTANCE = 5;\r\n\r\nexport abstract class BasePointer\r\n    implements IPointer {\r\n    private _cursor: BaseCursor;\r\n    private _canMoveView = false;\r\n    private _enabled = false;\r\n\r\n    isActive = false;\r\n    movementDragThreshold = MAX_DRAG_DISTANCE;\r\n    state = new PointerState();\r\n    lastState: PointerState = null;\r\n    origin = new THREE.Vector3();\r\n    direction = new THREE.Vector3();\r\n\r\n    curHit: THREE.Intersection = null;\r\n    hoveredHit: THREE.Intersection = null;\r\n    private _pressedHit: THREE.Intersection = null;\r\n    draggedHit: THREE.Intersection = null;\r\n\r\n\r\n    constructor(\r\n        public readonly type: PointerType,\r\n        public name: PointerName,\r\n        protected readonly evtSys: EventSystem,\r\n        cursor: BaseCursor) {\r\n        //super();\r\n\r\n        this._cursor = cursor;\r\n        this.enabled = false;\r\n        this.canMoveView = false;\r\n    }\r\n\r\n    get pressedHit(): THREE.Intersection {\r\n        return this._pressedHit;\r\n    }\r\n\r\n    set pressedHit(v: THREE.Intersection) {\r\n        this._pressedHit = v;\r\n        const target = getMeshTarget(v);\r\n        if (target && target.draggable && !target.clickable) {\r\n            this.onDragStart();\r\n        }\r\n    }\r\n\r\n    get canMoveView() {\r\n        return this._canMoveView;\r\n    }\r\n\r\n    set canMoveView(v) {\r\n        this._canMoveView = v;\r\n    }\r\n\r\n    vibrate(): void {\r\n        // nothing to do in the base case.\r\n    }\r\n\r\n    get cursor() {\r\n        return this._cursor;\r\n    }\r\n\r\n    set cursor(newCursor) {\r\n        if (newCursor !== this.cursor) {\r\n            const oldCursor = this.cursor;\r\n            const oldName = this.cursor && this.cursor.object && this.cursor.object.name || \"cursor\";\r\n            const oldParent = oldCursor && oldCursor.object && oldCursor.object.parent;\r\n            if (oldParent) {\r\n                oldParent.remove(oldCursor.object);\r\n            }\r\n\r\n            if (newCursor) {\r\n                newCursor.object.name = oldName;\r\n\r\n                if (oldCursor instanceof CursorXRMouse) {\r\n                    oldCursor.cursor = newCursor;\r\n                    if (oldParent) {\r\n                        oldParent.add(oldCursor.object);\r\n                    }\r\n                }\r\n                else {\r\n                    this._cursor = newCursor;\r\n                    if (oldCursor) {\r\n                        if (oldParent) {\r\n                            oldParent.add(newCursor.object);\r\n                        }\r\n                        newCursor.style = oldCursor.style;\r\n                        newCursor.visible = oldCursor.visible;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    get enabled() {\r\n        return this._enabled;\r\n    }\r\n\r\n    set enabled(v) {\r\n        this._enabled = v;\r\n        if (this.cursor) {\r\n            this.cursor.visible = v;\r\n        }\r\n    }\r\n\r\n    get needsUpdate() {\r\n        return this.enabled\r\n            && this.isActive;\r\n    }\r\n\r\n    protected setEventState(type: SourcePointerEventTypes): void {\r\n        this.evtSys.checkPointer(this, type);\r\n    }\r\n\r\n    update(): void {\r\n        this.onUpdate();\r\n        if (!this.lastState) {\r\n            this.lastState = new PointerState();\r\n        }\r\n        this.lastState.copy(this.state);\r\n        this.state.motion.setScalar(0);\r\n        this.state.dz = 0;\r\n        this.state.duv.setScalar(0);\r\n    }\r\n\r\n    protected abstract onUpdate(): void;\r\n\r\n    updateCursor(avatarHeadPos: THREE.Vector3, curHit: THREE.Intersection, defaultDistance: number) {\r\n        if (this.cursor) {\r\n            this.cursor.update(avatarHeadPos, curHit, defaultDistance, this.canMoveView, this.state, this.origin, this.direction);\r\n        }\r\n    }\r\n\r\n    protected onPointerDown(): void {\r\n        this.state.dragging = false;\r\n        this.state.canClick = true;\r\n        this.setEventState(\"down\");\r\n    }\r\n\r\n    protected onPointerMove() {\r\n        this.setEventState(\"move\");\r\n        if (this.state.buttons !== MouseButtons.None) {\r\n            const target = getMeshTarget(this.pressedHit);\r\n            const canDrag = !target || target.draggable;\r\n            if (canDrag) {\r\n                if (this.lastState && this.lastState.buttons === this.state.buttons) {\r\n                    this.state.dragDistance += this.state.moveDistance;\r\n                    if (this.state.dragDistance > this.movementDragThreshold) {\r\n                        this.onDragStart();\r\n                    }\r\n                }\r\n                else if (this.state.dragging) {\r\n                    this.state.dragging = false;\r\n                    this.setEventState(\"dragcancel\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private onDragStart() {\r\n        this.state.dragging = true;\r\n\r\n        if (this.lastState && !this.lastState.dragging) {\r\n            this.setEventState(\"dragstart\");\r\n        }\r\n\r\n        this.state.canClick = false;\r\n        this.setEventState(\"drag\");\r\n    }\r\n\r\n    protected onPointerUp() {\r\n        if (this.state.canClick && this.lastState) {\r\n            const lastButtons = this.state.buttons;\r\n            this.state.buttons = this.lastState.buttons;\r\n            this.setEventState(\"click\");\r\n            this.state.buttons = lastButtons;\r\n        }\r\n\r\n        this.setEventState(\"up\");\r\n\r\n        this.state.dragDistance = 0;\r\n        this.state.dragging = false;\r\n        if (this.lastState && this.lastState.dragging) {\r\n            this.setEventState(\"dragend\");\r\n        }\r\n    }\r\n\r\n    abstract isPressed(button: VirtualButtons): boolean;\r\n}\r\n\r\n", "const _box = new THREE.Box3();\r\nconst _vector = new THREE.Vector3();\r\n\r\nclass LineSegmentsGeometry extends THREE.InstancedBufferGeometry {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'LineSegmentsGeometry';\r\n\r\n\t\tconst positions = [ - 1, 2, 0, 1, 2, 0, - 1, 1, 0, 1, 1, 0, - 1, 0, 0, 1, 0, 0, - 1, - 1, 0, 1, - 1, 0 ];\r\n\t\tconst uvs = [ - 1, 2, 1, 2, - 1, 1, 1, 1, - 1, - 1, 1, - 1, - 1, - 2, 1, - 2 ];\r\n\t\tconst index = [ 0, 2, 1, 2, 3, 1, 2, 4, 3, 4, 5, 3, 4, 6, 5, 6, 7, 5 ];\r\n\r\n\t\tthis.setIndex( index );\r\n\t\tthis.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );\r\n\t\tthis.setAttribute( 'uv', new THREE.Float32BufferAttribute( uvs, 2 ) );\r\n\r\n\t}\r\n\r\n\tapplyMatrix4( matrix ) {\r\n\r\n\t\tconst start = this.attributes.instanceStart;\r\n\t\tconst end = this.attributes.instanceEnd;\r\n\r\n\t\tif ( start !== undefined ) {\r\n\r\n\t\t\tstart.applyMatrix4( matrix );\r\n\r\n\t\t\tend.applyMatrix4( matrix );\r\n\r\n\t\t\tstart.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingBox !== null ) {\r\n\r\n\t\t\tthis.computeBoundingBox();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingSphere !== null ) {\r\n\r\n\t\t\tthis.computeBoundingSphere();\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetPositions( array ) {\r\n\r\n\t\tlet lineSegments;\r\n\r\n\t\tif ( array instanceof Float32Array ) {\r\n\r\n\t\t\tlineSegments = array;\r\n\r\n\t\t} else if ( Array.isArray( array ) ) {\r\n\r\n\t\t\tlineSegments = new Float32Array( array );\r\n\r\n\t\t}\r\n\r\n\t\tconst instanceBuffer = new THREE.InstancedInterleavedBuffer( lineSegments, 6, 1 ); // xyz, xyz\r\n\r\n\t\tthis.setAttribute( 'instanceStart', new THREE.InterleavedBufferAttribute( instanceBuffer, 3, 0 ) ); // xyz\r\n\t\tthis.setAttribute( 'instanceEnd', new THREE.InterleavedBufferAttribute( instanceBuffer, 3, 3 ) ); // xyz\r\n\r\n\t\t//\r\n\r\n\t\tthis.computeBoundingBox();\r\n\t\tthis.computeBoundingSphere();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetColors( array ) {\r\n\r\n\t\tlet colors;\r\n\r\n\t\tif ( array instanceof Float32Array ) {\r\n\r\n\t\t\tcolors = array;\r\n\r\n\t\t} else if ( Array.isArray( array ) ) {\r\n\r\n\t\t\tcolors = new Float32Array( array );\r\n\r\n\t\t}\r\n\r\n\t\tconst instanceColorBuffer = new THREE.InstancedInterleavedBuffer( colors, 6, 1 ); // rgb, rgb\r\n\r\n\t\tthis.setAttribute( 'instanceColorStart', new THREE.InterleavedBufferAttribute( instanceColorBuffer, 3, 0 ) ); // rgb\r\n\t\tthis.setAttribute( 'instanceColorEnd', new THREE.InterleavedBufferAttribute( instanceColorBuffer, 3, 3 ) ); // rgb\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tfromWireframeGeometry( geometry ) {\r\n\r\n\t\tthis.setPositions( geometry.attributes.position.array );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tfromEdgesGeometry( geometry ) {\r\n\r\n\t\tthis.setPositions( geometry.attributes.position.array );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tfromMesh( mesh ) {\r\n\r\n\t\tthis.fromWireframeGeometry( new THREE.WireframeGeometry( mesh.geometry ) );\r\n\r\n\t\t// set colors, maybe\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tfromLineSegments( lineSegments ) {\r\n\r\n\t\tconst geometry = lineSegments.geometry;\r\n\r\n\t\tif ( geometry.isGeometry ) {\r\n\r\n\t\t\tconsole.error( 'THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.' );\r\n\t\t\treturn;\r\n\r\n\t\t} else if ( geometry.isBufferGeometry ) {\r\n\r\n\t\t\tthis.setPositions( geometry.attributes.position.array ); // assumes non-indexed\r\n\r\n\t\t}\r\n\r\n\t\t// set colors, maybe\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcomputeBoundingBox() {\r\n\r\n\t\tif ( this.boundingBox === null ) {\r\n\r\n\t\t\tthis.boundingBox = new THREE.Box3();\r\n\r\n\t\t}\r\n\r\n\t\tconst start = this.attributes.instanceStart;\r\n\t\tconst end = this.attributes.instanceEnd;\r\n\r\n\t\tif ( start !== undefined && end !== undefined ) {\r\n\r\n\t\t\tthis.boundingBox.setFromBufferAttribute( start );\r\n\r\n\t\t\t_box.setFromBufferAttribute( end );\r\n\r\n\t\t\tthis.boundingBox.union( _box );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcomputeBoundingSphere() {\r\n\r\n\t\tif ( this.boundingSphere === null ) {\r\n\r\n\t\t\tthis.boundingSphere = new THREE.Sphere();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingBox === null ) {\r\n\r\n\t\t\tthis.computeBoundingBox();\r\n\r\n\t\t}\r\n\r\n\t\tconst start = this.attributes.instanceStart;\r\n\t\tconst end = this.attributes.instanceEnd;\r\n\r\n\t\tif ( start !== undefined && end !== undefined ) {\r\n\r\n\t\t\tconst center = this.boundingSphere.center;\r\n\r\n\t\t\tthis.boundingBox.getCenter( center );\r\n\r\n\t\t\tlet maxRadiusSq = 0;\r\n\r\n\t\t\tfor ( let i = 0, il = start.count; i < il; i ++ ) {\r\n\r\n\t\t\t\t_vector.fromBufferAttribute( start, i );\r\n\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( _vector ) );\r\n\r\n\t\t\t\t_vector.fromBufferAttribute( end, i );\r\n\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( _vector ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.boundingSphere.radius = Math.sqrt( maxRadiusSq );\r\n\r\n\t\t\tif ( isNaN( this.boundingSphere.radius ) ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.', this );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\ttoJSON() {\r\n\r\n\t\t// todo\r\n\r\n\t}\r\n\r\n\tapplyMatrix( matrix ) {\r\n\r\n\t\tconsole.warn( 'THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4().' );\r\n\r\n\t\treturn this.applyMatrix4( matrix );\r\n\r\n\t}\r\n\r\n}\r\n\r\nLineSegmentsGeometry.prototype.isLineSegmentsGeometry = true;\r\n\r\nexport { LineSegmentsGeometry };\r\n", "import { LineSegmentsGeometry } from './LineSegmentsGeometry';\r\nimport { LineMaterial } from './LineMaterial';\r\n\r\nconst _start = new THREE.Vector3();\r\nconst _end = new THREE.Vector3();\r\n\r\nconst _start4 = new THREE.Vector4();\r\nconst _end4 = new THREE.Vector4();\r\n\r\nconst _ssOrigin = new THREE.Vector4();\r\nconst _ssOrigin3 = new THREE.Vector3();\r\nconst _mvMatrix = new THREE.Matrix4();\r\nconst _line = new THREE.Line3();\r\nconst _closestPoint = new THREE.Vector3();\r\n\r\nconst _box = new THREE.Box3();\r\nconst _sphere = new THREE.Sphere();\r\nconst _clipToWorldVector = new THREE.Vector4();\r\n\r\n// Returns the margin required to expand by in world space given the distance from the camera,\r\n// line width, resolution, and camera projection\r\nfunction getWorldSpaceHalfWidth(camera, distance, lineWidth, resolution) {\r\n\r\n    // transform into clip space, adjust the x and y values by the pixel width offset, then\r\n    // transform back into world space to get world offset. Note clip space is [-1, 1] so full\r\n    // width does not need to be halved.\r\n    _clipToWorldVector.set(0, 0, - distance, 1.0).applyMatrix4(camera.projectionMatrix);\r\n    _clipToWorldVector.multiplyScalar(1.0 / _clipToWorldVector.w);\r\n    _clipToWorldVector.x = lineWidth / resolution.width;\r\n    _clipToWorldVector.y = lineWidth / resolution.height;\r\n    _clipToWorldVector.applyMatrix4(camera.projectionMatrixInverse);\r\n    _clipToWorldVector.multiplyScalar(1.0 / _clipToWorldVector.w);\r\n\r\n    return Math.abs(Math.max(_clipToWorldVector.x, _clipToWorldVector.y));\r\n\r\n}\r\n\r\nclass LineSegments2 extends THREE.Mesh {\r\n\r\n    constructor(geometry = new LineSegmentsGeometry(), material = new LineMaterial({ color: Math.random() * 0xffffff })) {\r\n\r\n        super(geometry, material);\r\n\r\n        this.type = 'LineSegments2';\r\n\r\n    }\r\n\r\n    // for backwards-compatability, but could be a method of LineSegmentsGeometry...\r\n\r\n    computeLineDistances() {\r\n\r\n        const geometry = this.geometry;\r\n\r\n        const instanceStart = geometry.attributes.instanceStart;\r\n        const instanceEnd = geometry.attributes.instanceEnd;\r\n        const lineDistances = new Float32Array(2 * instanceStart.count);\r\n\r\n        for (let i = 0, j = 0, l = instanceStart.count; i < l; i++, j += 2) {\r\n\r\n            _start.fromBufferAttribute(instanceStart, i);\r\n            _end.fromBufferAttribute(instanceEnd, i);\r\n\r\n            lineDistances[j] = (j === 0) ? 0 : lineDistances[j - 1];\r\n            lineDistances[j + 1] = lineDistances[j] + _start.distanceTo(_end);\r\n\r\n        }\r\n\r\n        const instanceDistanceBuffer = new THREE.InstancedInterleavedBuffer(lineDistances, 2, 1); // d0, d1\r\n\r\n        geometry.setAttribute('instanceDistanceStart', new THREE.InterleavedBufferAttribute(instanceDistanceBuffer, 1, 0)); // d0\r\n        geometry.setAttribute('instanceDistanceEnd', new THREE.InterleavedBufferAttribute(instanceDistanceBuffer, 1, 1)); // d1\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    raycast(raycaster, intersects) {\r\n\r\n        if (raycaster.camera === null) {\r\n\r\n            console.error('LineSegments2: \"Raycaster.camera\" needs to be set in order to raycast against LineSegments2.');\r\n\r\n        }\r\n\r\n        const threshold = (raycaster.params.Line2 !== undefined) ? raycaster.params.Line2.threshold || 0 : 0;\r\n\r\n        const ray = raycaster.ray;\r\n        const camera = raycaster.camera;\r\n        const projectionMatrix = camera.projectionMatrix;\r\n\r\n        const matrixWorld = this.matrixWorld;\r\n        const geometry = this.geometry;\r\n        const material = this.material;\r\n        const resolution = material.resolution;\r\n        const lineWidth = material.linewidth + threshold;\r\n\r\n        const instanceStart = geometry.attributes.instanceStart;\r\n        const instanceEnd = geometry.attributes.instanceEnd;\r\n\r\n        // camera forward is negative\r\n        const near = - camera.near;\r\n\r\n        //\r\n\r\n        // check if we intersect the sphere bounds\r\n        if (geometry.boundingSphere === null) {\r\n\r\n            geometry.computeBoundingSphere();\r\n\r\n        }\r\n\r\n        _sphere.copy(geometry.boundingSphere).applyMatrix4(matrixWorld);\r\n        const distanceToSphere = Math.max(camera.near, _sphere.distanceToPoint(ray.origin));\r\n\r\n        // increase the sphere bounds by the worst case line screen space width\r\n        const sphereMargin = getWorldSpaceHalfWidth(camera, distanceToSphere, lineWidth, resolution);\r\n        _sphere.radius += sphereMargin;\r\n\r\n        if (raycaster.ray.intersectsSphere(_sphere) === false) {\r\n\r\n            return;\r\n\r\n        }\r\n\r\n        //\r\n\r\n        // check if we intersect the box bounds\r\n        if (geometry.boundingBox === null) {\r\n\r\n            geometry.computeBoundingBox();\r\n\r\n        }\r\n\r\n        _box.copy(geometry.boundingBox).applyMatrix4(matrixWorld);\r\n        const distanceToBox = Math.max(camera.near, _box.distanceToPoint(ray.origin));\r\n\r\n        // increase the box bounds by the worst case line screen space width\r\n        const boxMargin = getWorldSpaceHalfWidth(camera, distanceToBox, lineWidth, resolution);\r\n        _box.max.x += boxMargin;\r\n        _box.max.y += boxMargin;\r\n        _box.max.z += boxMargin;\r\n        _box.min.x -= boxMargin;\r\n        _box.min.y -= boxMargin;\r\n        _box.min.z -= boxMargin;\r\n\r\n        if (raycaster.ray.intersectsBox(_box) === false) {\r\n\r\n            return;\r\n\r\n        }\r\n\r\n        //\r\n\r\n        // pick a point 1 unit out along the ray to avoid the ray origin\r\n        // sitting at the camera origin which will cause \"w\" to be 0 when\r\n        // applying the projection matrix.\r\n        ray.at(1, _ssOrigin);\r\n\r\n        // ndc space [ - 1.0, 1.0 ]\r\n        _ssOrigin.w = 1;\r\n        _ssOrigin.applyMatrix4(camera.matrixWorldInverse);\r\n        _ssOrigin.applyMatrix4(projectionMatrix);\r\n        _ssOrigin.multiplyScalar(1 / _ssOrigin.w);\r\n\r\n        // screen space\r\n        _ssOrigin.x *= resolution.x / 2;\r\n        _ssOrigin.y *= resolution.y / 2;\r\n        _ssOrigin.z = 0;\r\n\r\n        _ssOrigin3.copy(_ssOrigin);\r\n\r\n        _mvMatrix.multiplyMatrices(camera.matrixWorldInverse, matrixWorld);\r\n\r\n        for (let i = 0, l = instanceStart.count; i < l; i++) {\r\n\r\n            _start4.fromBufferAttribute(instanceStart, i);\r\n            _end4.fromBufferAttribute(instanceEnd, i);\r\n\r\n            _start4.w = 1;\r\n            _end4.w = 1;\r\n\r\n            // camera space\r\n            _start4.applyMatrix4(_mvMatrix);\r\n            _end4.applyMatrix4(_mvMatrix);\r\n\r\n            // skip the segment if it's entirely behind the camera\r\n            var isBehindCameraNear = _start4.z > near && _end4.z > near;\r\n            if (isBehindCameraNear) {\r\n\r\n                continue;\r\n\r\n            }\r\n\r\n            // trim the segment if it extends behind camera near\r\n            if (_start4.z > near) {\r\n\r\n                const deltaDist = _start4.z - _end4.z;\r\n                const t = (_start4.z - near) / deltaDist;\r\n                _start4.lerp(_end4, t);\r\n\r\n            } else if (_end4.z > near) {\r\n\r\n                const deltaDist = _end4.z - _start4.z;\r\n                const t = (_end4.z - near) / deltaDist;\r\n                _end4.lerp(_start4, t);\r\n\r\n            }\r\n\r\n            // clip space\r\n            _start4.applyMatrix4(projectionMatrix);\r\n            _end4.applyMatrix4(projectionMatrix);\r\n\r\n            // ndc space [ - 1.0, 1.0 ]\r\n            _start4.multiplyScalar(1 / _start4.w);\r\n            _end4.multiplyScalar(1 / _end4.w);\r\n\r\n            // screen space\r\n            _start4.x *= resolution.x / 2;\r\n            _start4.y *= resolution.y / 2;\r\n\r\n            _end4.x *= resolution.x / 2;\r\n            _end4.y *= resolution.y / 2;\r\n\r\n            // create 2d segment\r\n            _line.start.copy(_start4);\r\n            _line.start.z = 0;\r\n\r\n            _line.end.copy(_end4);\r\n            _line.end.z = 0;\r\n\r\n            // get closest point on ray to segment\r\n            const param = _line.closestPointToPointParameter(_ssOrigin3, true);\r\n            _line.at(param, _closestPoint);\r\n\r\n            // check if the intersection point is within clip space\r\n            const zPos = THREE.MathUtils.lerp(_start4.z, _end4.z, param);\r\n            const isInClipSpace = zPos >= - 1 && zPos <= 1;\r\n\r\n            const isInside = _ssOrigin3.distanceTo(_closestPoint) < lineWidth * 0.5;\r\n\r\n            if (isInClipSpace && isInside) {\r\n\r\n                _line.start.fromBufferAttribute(instanceStart, i);\r\n                _line.end.fromBufferAttribute(instanceEnd, i);\r\n\r\n                _line.start.applyMatrix4(matrixWorld);\r\n                _line.end.applyMatrix4(matrixWorld);\r\n\r\n                const pointOnLine = new THREE.Vector3();\r\n                const point = new THREE.Vector3();\r\n\r\n                ray.distanceSqToSegment(_line.start, _line.end, point, pointOnLine);\r\n\r\n                intersects.push({\r\n\r\n                    point: point,\r\n                    pointOnLine: pointOnLine,\r\n                    distance: ray.origin.distanceTo(point),\r\n\r\n                    object: this,\r\n                    face: null,\r\n                    faceIndex: i,\r\n                    uv: null,\r\n                    uv2: null,\r\n\r\n                });\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nLineSegments2.prototype.isLineSegments2 = true;\r\n\r\nexport { LineSegments2 };", "import { LineSegmentsGeometry } from './LineSegmentsGeometry';\r\n\r\nclass LineGeometry extends LineSegmentsGeometry {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\t\tthis.type = 'LineGeometry';\r\n\r\n\t}\r\n\r\n\tsetPositions( array ) {\r\n\r\n\t\t// converts [ x1, y1, z1,  x2, y2, z2, ... ] to pairs format\r\n\r\n\t\tvar length = array.length - 3;\r\n\t\tvar points = new Float32Array( 2 * length );\r\n\r\n\t\tfor ( var i = 0; i < length; i += 3 ) {\r\n\r\n\t\t\tpoints[ 2 * i ] = array[ i ];\r\n\t\t\tpoints[ 2 * i + 1 ] = array[ i + 1 ];\r\n\t\t\tpoints[ 2 * i + 2 ] = array[ i + 2 ];\r\n\r\n\t\t\tpoints[ 2 * i + 3 ] = array[ i + 3 ];\r\n\t\t\tpoints[ 2 * i + 4 ] = array[ i + 4 ];\r\n\t\t\tpoints[ 2 * i + 5 ] = array[ i + 5 ];\r\n\r\n\t\t}\r\n\r\n\t\tsuper.setPositions( points );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetColors( array ) {\r\n\r\n\t\t// converts [ r1, g1, b1,  r2, g2, b2, ... ] to pairs format\r\n\r\n\t\tvar length = array.length - 3;\r\n\t\tvar colors = new Float32Array( 2 * length );\r\n\r\n\t\tfor ( var i = 0; i < length; i += 3 ) {\r\n\r\n\t\t\tcolors[ 2 * i ] = array[ i ];\r\n\t\t\tcolors[ 2 * i + 1 ] = array[ i + 1 ];\r\n\t\t\tcolors[ 2 * i + 2 ] = array[ i + 2 ];\r\n\r\n\t\t\tcolors[ 2 * i + 3 ] = array[ i + 3 ];\r\n\t\t\tcolors[ 2 * i + 4 ] = array[ i + 4 ];\r\n\t\t\tcolors[ 2 * i + 5 ] = array[ i + 5 ];\r\n\r\n\t\t}\r\n\r\n\t\tsuper.setColors( colors );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tfromLine( line ) {\r\n\r\n\t\tvar geometry = line.geometry;\r\n\r\n\t\tif ( geometry.isGeometry ) {\r\n\r\n\t\t\tconsole.error( 'THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.' );\r\n\t\t\treturn;\r\n\r\n\t\t} else if ( geometry.isBufferGeometry ) {\r\n\r\n\t\t\tthis.setPositions( geometry.attributes.position.array ); // assumes non-indexed\r\n\r\n\t\t}\r\n\r\n\t\t// set colors, maybe\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nLineGeometry.prototype.isLineGeometry = true;\r\n\r\nexport { LineGeometry };\r\n", "import { LineSegments2 } from './LineSegments2';\r\nimport { LineGeometry } from './LineGeometry';\r\nimport { LineMaterial } from './LineMaterial';\r\n\r\nclass Line2 extends LineSegments2 {\r\n\r\n\tconstructor( geometry = new LineGeometry(), material = new LineMaterial( { color: Math.random() * 0xffffff } ) ) {\r\n\r\n\t\tsuper( geometry, material );\r\n\r\n\t\tthis.type = 'Line2';\r\n\r\n\t}\r\n\r\n}\r\n\r\nLine2.prototype.isLine2 = true;\r\n\r\nexport { Line2 };\r\n", "import { Line2 } from \"../examples/lines/Line2\";\r\nimport { LineGeometry } from \"../examples/lines/LineGeometry\";\r\nimport { line2 } from \"../materials\";\r\n\r\nconst geom = new LineGeometry();\r\ngeom.setPositions([\r\n    0, 0, 0,\r\n    0, 0, -1\r\n]);\r\n\r\nexport class Laser extends THREE.Object3D {\r\n    line: Line2;\r\n    private _length = 1;\r\n\r\n    constructor(color: number, linewidth = 1) {\r\n        super();\r\n            \r\n        this.line = new Line2(geom, line2({\r\n            color,\r\n            linewidth\r\n        }));\r\n        this.line.computeLineDistances();\r\n\r\n        this.add(this.line);\r\n    }\r\n\r\n    get length() {\r\n        return this._length;\r\n    }\r\n\r\n    set length(v) {\r\n        this._length = v;\r\n        this.line.scale.set(1, 1, v);\r\n    }\r\n}", "import { MouseButtons } from \"@juniper-lib/threejs/eventSystem/MouseButton\";\r\nimport { VirtualButtons } from \"@juniper-lib/threejs/eventSystem/VirtualButtons\";\r\nimport {\r\n    isChrome,\r\n    isDefined,\r\n    isDesktop,\r\n    isNullOrUndefined,\r\n    isOculusBrowser, PriorityMap\r\n} from \"@juniper-lib/tslib\";\r\nimport { PointerName } from \"@juniper-lib/tslib/events/PointerName\";\r\nimport { EventedGamepad, GamepadAxisMaxedEvent } from \"@juniper-lib/widgets/EventedGamepad\";\r\nimport { XRControllerModelFactory } from \"../examples/webxr/XRControllerModelFactory\";\r\nimport { XRHandModelFactory } from \"../examples/webxr/XRHandModelFactory\";\r\nimport { white } from \"../materials\";\r\nimport { ErsatzObject } from \"../objects\";\r\nimport { BasePointer } from \"./BasePointer\";\r\nimport { CursorColor } from \"./CursorColor\";\r\nimport type { EventSystem } from \"./EventSystem\";\r\nimport { Laser } from \"./Laser\";\r\n\r\nconst mcModelFactory = new XRControllerModelFactory();\r\nconst handModelFactory = new XRHandModelFactory();\r\nconst riftSCorrection = new THREE.Matrix4().makeRotationX(-7 * Math.PI / 9);\r\nconst newOrigin = new THREE.Vector3();\r\nconst newDirection = new THREE.Vector3();\r\nconst delta = new THREE.Vector3();\r\nconst buttonIndices = new PriorityMap<XRHandedness, VirtualButtons, number>([\r\n    [\"left\", VirtualButtons.Primary, 0],\r\n    [\"left\", VirtualButtons.Secondary, 1],\r\n    [\"left\", VirtualButtons.Menu, 2],\r\n    [\"left\", VirtualButtons.Info, 3],\r\n    [\"right\", VirtualButtons.Primary, 0],\r\n    [\"right\", VirtualButtons.Secondary, 1],\r\n    [\"right\", VirtualButtons.Menu, 2],\r\n    [\"right\", VirtualButtons.Info, 3]\r\n]);\r\n\r\nconst pointerNames = new Map<XRHandedness, PointerName>([\r\n    [\"none\", PointerName.MotionController],\r\n    [\"left\", PointerName.MotionControllerLeft],\r\n    [\"right\", PointerName.MotionControllerRight]\r\n]);\r\n\r\nexport class PointerHand\r\n    extends BasePointer\r\n    implements ErsatzObject {\r\n    private readonly laser = new Laser(white, 0.002);\r\n    readonly object = new THREE.Object3D();\r\n\r\n    private _handedness: XRHandedness = \"none\";\r\n    private _isHand = false;\r\n    private inputSource: XRInputSource = null;\r\n    private _gamepad: EventedGamepad = null;\r\n\r\n    private readonly controller: THREE.Group;\r\n    private readonly grip: THREE.Group;\r\n    private readonly hand: THREE.Group;\r\n    private readonly onAxisMaxed: (evt: GamepadAxisMaxedEvent) => void;\r\n\r\n    constructor(evtSys: EventSystem, private readonly renderer: THREE.WebGLRenderer, index: number) {\r\n        super(\"hand\", PointerName.MotionController, evtSys, new CursorColor());\r\n\r\n        this.object.add(\r\n            this.controller = this.renderer.xr.getController(index),\r\n            this.grip = this.renderer.xr.getControllerGrip(index),\r\n            this.hand = this.renderer.xr.getHand(index)\r\n        );\r\n\r\n        // isDesktop and isOculus can both be true if the user\r\n        // has requested the Desktop version of a site in Oculus Browser.\r\n        if (isDesktop() && isChrome() && !isOculusBrowser) {\r\n            let maybeOculusRiftS = false;\r\n            this.controller.traverse((child) => {\r\n                const key = child.name.toLocaleLowerCase();\r\n                if (key.indexOf(\"oculus\") >= 0) {\r\n                    maybeOculusRiftS = true;\r\n                }\r\n            });\r\n            if (maybeOculusRiftS) {\r\n                this.laser.matrix.copy(riftSCorrection);\r\n            }\r\n        }\r\n\r\n        this.controller.add(this.laser);\r\n        this.grip.add(mcModelFactory.createControllerModel(this.controller));\r\n\r\n        this.hand.add(handModelFactory.createHandModel(this.hand, \"mesh\"));\r\n\r\n        this.onAxisMaxed = (evt: GamepadAxisMaxedEvent) => {\r\n            if (evt.axis === 2) {\r\n                this.evtSys.onFlick(evt.value);\r\n            }\r\n        };\r\n\r\n        this.controller.addEventListener(\"connected\", () => {\r\n            const session = this.renderer.xr.getSession();\r\n\r\n            this.inputSource = session.inputSources[index];\r\n            this.setGamepad(this.inputSource.gamepad);\r\n            this._isHand = isDefined(this.inputSource.hand);\r\n            this._handedness = this.inputSource.handedness;\r\n            this.name = pointerNames.get(this.handedness);\r\n            this.updateCursorSide();\r\n\r\n            this.grip.visible = !this.isHand;\r\n            this.controller.visible = !this.isHand;\r\n            this.hand.visible = this.isHand;\r\n\r\n            this.enabled = true;\r\n            this.isActive = true;\r\n            this.evtSys.onConnected(this);\r\n        });\r\n\r\n        this.controller.addEventListener(\"disconnected\", () => {\r\n            this.inputSource = null;\r\n            this.setGamepad(null);\r\n            this._isHand = false;\r\n            this._handedness = \"none\";\r\n            this.name = pointerNames.get(this.handedness);\r\n            this.updateCursorSide();\r\n\r\n            this.grip.visible = false;\r\n            this.controller.visible = false;\r\n            this.hand.visible = false;\r\n\r\n            this.enabled = false;\r\n            this.isActive = false;\r\n            this.evtSys.onDisconnected(this);\r\n            this.isActive = false;\r\n        });\r\n\r\n        const buttonDown = (btn: MouseButtons) => {\r\n            this.updateState();\r\n            this.state.buttons = this.state.buttons | btn;\r\n            this.onPointerDown();\r\n        };\r\n\r\n        const buttonUp = (btn: MouseButtons) => {\r\n            this.updateState();\r\n            this.state.buttons = this.state.buttons & ~btn;\r\n            this.onPointerUp();\r\n        };\r\n\r\n        this.controller.addEventListener(\"selectstart\", () =>\r\n            buttonDown(MouseButtons.Mouse0));\r\n        this.controller.addEventListener(\"selectend\", () =>\r\n            buttonUp(MouseButtons.Mouse0));\r\n        this.controller.addEventListener(\"squeezestart\", () =>\r\n            buttonDown(MouseButtons.Mouse1));\r\n        this.controller.addEventListener(\"squeezeend\", () =>\r\n            buttonUp(MouseButtons.Mouse1));\r\n    }\r\n\r\n    override vibrate(): void {\r\n        this._vibrate();\r\n    }\r\n\r\n    private useHaptics = true;\r\n\r\n    private async _vibrate(): Promise<void> {\r\n        if (this._gamepad && this.useHaptics) {\r\n            try {\r\n                await Promise.all(this._gamepad.hapticActuators.map((actuator) =>\r\n                    actuator.pulse(0.25, 125)));\r\n            }\r\n            catch {\r\n                this.useHaptics = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    private setGamepad(pad: Gamepad) {\r\n        if (isDefined(this._gamepad) && isNullOrUndefined(pad)) {\r\n            this._gamepad.clearEventListeners();\r\n            this._gamepad = null;\r\n        }\r\n\r\n        if (isDefined(pad)) {\r\n            if (isDefined(this._gamepad)) {\r\n                this._gamepad.setPad(pad);\r\n            }\r\n            else {\r\n                this._gamepad = new EventedGamepad(pad);\r\n                this._gamepad.addEventListener(\"gamepadaxismaxed\", this.onAxisMaxed);\r\n            }\r\n        }\r\n    }\r\n\r\n    get gamepad() {\r\n        return this._gamepad;\r\n    }\r\n\r\n    get gamepadId() {\r\n        return this._gamepad && this._gamepad.id;\r\n    }\r\n\r\n    get handedness() {\r\n        return this._handedness;\r\n    }\r\n\r\n    get isHand() {\r\n        return this._isHand;\r\n    }\r\n\r\n    override get cursor() {\r\n        return super.cursor;\r\n    }\r\n\r\n    override set cursor(v) {\r\n        super.cursor = v;\r\n        this.updateCursorSide();\r\n    }\r\n\r\n    private updateCursorSide() {\r\n        const obj = this.cursor.object;\r\n        if (obj) {\r\n            const sx = this.handedness === \"left\" ? -1 : 1;\r\n            obj.scale.set(sx, 1, 1);\r\n        }\r\n    }\r\n\r\n    protected onUpdate() {\r\n        if (this.enabled) {\r\n            this.updateState();\r\n            this.onPointerMove();\r\n        }\r\n    }\r\n\r\n    private updateState() {\r\n        this.laser.getWorldPosition(newOrigin);\r\n        this.laser.getWorldDirection(newDirection)\r\n            .multiplyScalar(-1);\r\n\r\n        delta.copy(this.origin)\r\n            .add(this.direction);\r\n\r\n        this.origin.lerp(newOrigin, 0.9);\r\n        this.direction.lerp(newDirection, 0.9)\r\n            .normalize();\r\n\r\n        delta.sub(this.origin)\r\n            .sub(this.direction);\r\n\r\n        this.state.moveDistance += 0.001 * delta.length();\r\n\r\n        if (isDefined(this._gamepad)\r\n            && isDefined(this.inputSource)) {\r\n            this.setGamepad(this.inputSource.gamepad);\r\n        }\r\n    }\r\n\r\n    isPressed(button: VirtualButtons): boolean {\r\n        if (!this._gamepad\r\n            || !buttonIndices.has(this.handedness)\r\n            || !buttonIndices.get(this.handedness).has(button)) {\r\n            return false;\r\n        }\r\n\r\n        const index = buttonIndices.get(this.handedness).get(button);\r\n        return this._gamepad.buttons[index].pressed;\r\n    }\r\n}", "import { VirtualButtons } from \"@juniper-lib/threejs/eventSystem/VirtualButtons\";\r\nimport { PointerName } from \"@juniper-lib/tslib/events/PointerName\";\r\nimport { resolveCamera } from \"../resolveCamera\";\r\nimport type { BaseCursor } from \"./BaseCursor\";\r\nimport { BasePointer } from \"./BasePointer\";\r\nimport type { EventSystem } from \"./EventSystem\";\r\nimport type { PointerType } from \"./IPointer\";\r\n\r\nexport abstract class BaseScreenPointer extends BasePointer {\r\n    id: number = null;\r\n    element: HTMLCanvasElement;\r\n\r\n    private readonly sizeInv = new THREE.Vector2();\r\n    private readonly uvComp = new THREE.Vector2(1, -1);\r\n    private readonly uvOff = new THREE.Vector2(-1, 1);\r\n\r\n    constructor(\r\n        type: PointerType,\r\n        name: PointerName,\r\n        evtSys: EventSystem,\r\n        protected readonly renderer: THREE.WebGLRenderer,\r\n        protected readonly camera: THREE.PerspectiveCamera,\r\n        cursor: BaseCursor) {\r\n        super(type, name, evtSys, cursor);\r\n\r\n        const onPointerDown = (evt: PointerEvent) => {\r\n            if (this.checkEvent(evt)) {\r\n                this.readEvent(evt);\r\n                this.onPointerDown();\r\n            }\r\n        };\r\n\r\n        this.element = this.renderer.domElement;\r\n        this.element.addEventListener(\"pointerdown\", onPointerDown);\r\n\r\n        const setSizeInv = () => this.sizeInv.set(1 / this.element.clientWidth, 1 / this.element.clientHeight);\r\n        this.element.addEventListener(\"resize\", setSizeInv);\r\n        setSizeInv();        \r\n\r\n        const onPointerMove = (evt: PointerEvent) => {\r\n            if (this.checkEvent(evt)) {\r\n                this.readEvent(evt);\r\n            }\r\n        };\r\n\r\n        this.element.addEventListener(\"pointermove\", onPointerMove);\r\n\r\n        const onPointerUp = (evt: PointerEvent) => {\r\n            if (this.checkEvent(evt)) {\r\n                this.readEvent(evt);\r\n                this.onPointerUp();\r\n            }\r\n        };\r\n\r\n        this.element.addEventListener(\"pointerup\", onPointerUp);\r\n        this.element.addEventListener(\"pointercancel\", onPointerUp);\r\n    }\r\n\r\n    protected checkEvent(evt: PointerEvent) {\r\n        return evt.pointerType === this.type\r\n            && evt.pointerId === this.id;\r\n    }\r\n\r\n    get isTracking() {\r\n        return this.id != null;\r\n    }\r\n\r\n    isPressed(button: VirtualButtons): boolean {\r\n        const mask = 1 << button;\r\n        return this.state.buttons === mask;\r\n    }\r\n\r\n    private readEvent(evt: PointerEvent): void {\r\n        if (this.checkEvent(evt)) {\r\n            this.state.ctrl = evt.ctrlKey;\r\n            this.state.alt = evt.altKey;\r\n            this.state.shift = evt.shiftKey;\r\n            this.state.meta = evt.metaKey;\r\n\r\n            this.onReadEvent(evt);\r\n\r\n            if (evt.type === \"pointermove\"\r\n                && document.pointerLockElement\r\n                && this.lastState) {\r\n                this.state.position\r\n                    .copy(this.lastState.position)\r\n                    .add(this.state.motion);\r\n            }\r\n\r\n            this.state.moveDistance = this.state.motion.length();\r\n            this.state.uv\r\n                .copy(this.state.position)\r\n                .multiplyScalar(2)\r\n                .multiply(this.sizeInv)\r\n                .multiply(this.uvComp)\r\n                .add(this.uvOff);\r\n            this.state.duv\r\n                .copy(this.state.motion)\r\n                .multiplyScalar(2)\r\n                .multiply(this.sizeInv)\r\n                .multiply(this.uvComp);\r\n        }\r\n    }\r\n\r\n    protected abstract onReadEvent(evt: PointerEvent): void;\r\n\r\n    protected onUpdate() {\r\n        const cam = resolveCamera(this.renderer, this.camera);\r\n\r\n        this.updateRay(cam);\r\n\r\n        if (this.state.motion.manhattanLength() > 0) {\r\n            this.onPointerMove();\r\n            this.updateRay(cam);\r\n        }\r\n    }\r\n\r\n    private updateRay(cam: THREE.Camera) {\r\n        this.origin.setFromMatrixPosition(cam.matrixWorld);\r\n        this.direction\r\n            .set(this.state.uv.x, this.state.uv.y, 0.5)\r\n            .unproject(cam)\r\n            .sub(this.origin)\r\n            .normalize();\r\n    }\r\n}\r\n", "import { PointerName } from \"@juniper-lib/tslib/events/PointerName\";\r\nimport { BaseScreenPointer } from \"./BaseScreenPointer\";\r\nimport { CursorXRMouse } from \"./CursorXRMouse\";\r\nimport type { EventSystem } from \"./EventSystem\";\r\nimport { PointerType } from \"./IPointer\";\r\n\r\nexport abstract class BaseScreenPointerSinglePoint extends BaseScreenPointer {\r\n    constructor(type: PointerType, name: PointerName, evtSys: EventSystem, renderer: THREE.WebGLRenderer, camera: THREE.PerspectiveCamera) {\r\n\r\n        const onPrep = (evt: PointerEvent) => {\r\n            if (evt.pointerType === type\r\n                && this.id == null) {\r\n                this.id = evt.pointerId;\r\n            }\r\n        };\r\n\r\n        const unPrep = (evt: PointerEvent) => {\r\n            if (evt.pointerType === type\r\n                && this.id != null) {\r\n                this.id = null;\r\n            }\r\n        };\r\n\r\n        const element = renderer.domElement;\r\n        element.addEventListener(\"pointerdown\", onPrep);\r\n        element.addEventListener(\"pointermove\", onPrep);\r\n\r\n        super(type, name, evtSys, renderer, camera, new CursorXRMouse(renderer));\r\n\r\n        element.addEventListener(\"pointerup\", unPrep);\r\n        element.addEventListener(\"pointercancel\", unPrep);\r\n\r\n        this.canMoveView = true;\r\n    }\r\n\r\n    protected onReadEvent(evt: PointerEvent) {\r\n        this.state.buttons = evt.buttons;\r\n        this.state.position.set(evt.offsetX, evt.offsetY);\r\n        this.state.motion.set(evt.movementX, evt.movementY);\r\n    }\r\n}\r\n", "import { PointerName } from \"@juniper-lib/tslib/events/PointerName\";\r\nimport { BaseScreenPointerSinglePoint } from \"./BaseScreenPointerSinglePoint\";\r\nimport type { EventSystem } from \"./EventSystem\";\r\n\r\nexport class PointerMouse extends BaseScreenPointerSinglePoint {\r\n    allowPointerLock: boolean = false;\r\n\r\n    constructor(evtSys: EventSystem, renderer: THREE.WebGLRenderer, camera: THREE.PerspectiveCamera) {\r\n        super(\"mouse\", PointerName.Mouse, evtSys, renderer, camera);\r\n\r\n        this.element.addEventListener(\"wheel\", (evt: WheelEvent) => {\r\n            evt.preventDefault();\r\n            this.state.dz = -evt.deltaY * 0.5;\r\n        }, { passive: false });\r\n\r\n        this.element.addEventListener(\"contextmenu\", (evt: Event) => {\r\n            evt.preventDefault();\r\n        });\r\n\r\n        this.element.addEventListener(\"pointerdown\", () => {\r\n            if (this.allowPointerLock\r\n                && !this.isPointerLocked) {\r\n                this.lockPointer();\r\n            }\r\n        });\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    lockPointer() {\r\n        this.element.requestPointerLock();\r\n    }\r\n\r\n    unlockPointer() {\r\n        document.exitPointerLock();\r\n    }\r\n\r\n    get isPointerLocked() {\r\n        return document.pointerLockElement != null;\r\n    }\r\n}\r\n", "import { PointerName } from \"@juniper-lib/tslib/events/PointerName\";\r\nimport { BaseScreenPointer } from \"./BaseScreenPointer\";\r\nimport type { EventSystem } from \"./EventSystem\";\r\n\r\nfunction dist(a: PointerEvent, b: PointerEvent) {\r\n    const dx = b.offsetX - a.offsetY;\r\n    const dy = b.offsetY - a.offsetY;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\nexport class PointerMultiTouch extends BaseScreenPointer {\r\n    private lastPinchDist = 0;\r\n    private readonly points = new Map<number, PointerEvent>();\r\n\r\n    constructor(evtSys: EventSystem, renderer: THREE.WebGLRenderer, camera: THREE.PerspectiveCamera) {\r\n        super(\"touch\", PointerName.Touches, evtSys, renderer, camera, null);\r\n        this.canMoveView = true;\r\n        Object.seal(this);\r\n    }\r\n\r\n    protected override checkEvent(evt: PointerEvent) {\r\n        return evt.pointerType === this.type;\r\n    }\r\n\r\n    protected onReadEvent(evt: PointerEvent) {\r\n        if (evt.type === \"pointerdown\" || evt.type === \"pointermove\") {\r\n            this.points.set(evt.pointerId, evt);\r\n        }\r\n        else if (this.points.has(evt.pointerId)\r\n            && (evt.type === \"pointerup\" || evt.type === \"pointercancel\")) {\r\n            this.points.delete(evt.pointerId);\r\n        }\r\n\r\n        this.state.buttons = 0;\r\n\r\n        if (this.points.size > 0) {\r\n            this.state.position.setScalar(0);\r\n\r\n            const K = 1 / this.points.size;\r\n            for (const point of this.points.values()) {\r\n                this.state.buttons |= point.buttons << (this.points.size - 1);\r\n                this.state.position.x += K * point.offsetX;\r\n                this.state.position.y += K * point.offsetY;\r\n                this.state.motion.x += K * point.movementX;\r\n                this.state.motion.y += K * point.movementY;\r\n            }\r\n\r\n            if (this.points.size === 2) {\r\n                const [a, b] = Array.from(this.points.values());\r\n                const pinchDist = dist(a, b);\r\n                if (this.lastState && this.lastState.buttons === 2) {\r\n                    this.state.dz = (pinchDist - this.lastPinchDist) * 2.5;\r\n                }\r\n\r\n                this.lastPinchDist = pinchDist;\r\n            }\r\n        }\r\n    }\r\n\r\n    override vibrate() {\r\n        navigator.vibrate(125);\r\n    }\r\n}\r\n", "import { PointerName } from \"@juniper-lib/tslib/events/PointerName\";\r\nimport { BaseScreenPointerSinglePoint } from \"./BaseScreenPointerSinglePoint\";\r\nimport type { EventSystem } from \"./EventSystem\";\r\n\r\nexport class PointerPen extends BaseScreenPointerSinglePoint {\r\n    constructor(evtSys: EventSystem, renderer: THREE.WebGLRenderer, camera: THREE.PerspectiveCamera) {\r\n        super(\"pen\", PointerName.Pen, evtSys, renderer, camera);\r\n        Object.seal(this);\r\n    }\r\n}\r\n", "import { isModifierless } from \"@juniper-lib/dom/evts\";\r\nimport { ObjectMovedEvent } from \"@juniper-lib/threejs/eventSystem/ObjectMovedEvent\";\r\nimport { PointerEventTypes, SourcePointerEventTypes } from \"@juniper-lib/threejs/eventSystem/PointerEventTypes\";\r\nimport { VirtualButtons } from \"@juniper-lib/threejs/eventSystem/VirtualButtons\";\r\nimport { arrayClear, arrayScan, assertNever, isDefined, TypedEventBase } from \"@juniper-lib/tslib\";\r\nimport type { BaseEnvironment } from \"../environment/BaseEnvironment\";\r\nimport { FOREGROUND } from \"../layers\";\r\nimport { objGraph } from \"../objects\";\r\nimport { EventSystemEvent, EventSystemEvents } from \"./EventSystemEvent\";\r\nimport type { IPointer } from \"./IPointer\";\r\nimport { PointerHand } from \"./PointerHand\";\r\nimport { PointerMouse } from \"./PointerMouse\";\r\nimport { PointerMultiTouch } from \"./PointerMultiTouch\";\r\nimport { PointerPen } from \"./PointerPen\";\r\nimport { getMeshTarget } from \"./RayTarget\";\r\n\r\nfunction correctHit(hit: THREE.Intersection, pointer: IPointer) {\r\n    if (isDefined(hit)) {\r\n        hit.point\r\n            .copy(pointer.direction)\r\n            .multiplyScalar(hit.distance)\r\n            .add(pointer.origin);\r\n    }\r\n}\r\n\r\nexport class EventSystem extends TypedEventBase<EventSystemEvents> {\r\n    private readonly raycaster = new THREE.Raycaster();\r\n\r\n    public readonly mouse: PointerMouse;\r\n    private readonly pen: PointerPen;\r\n    private readonly touches: PointerMultiTouch;\r\n    readonly hands = new Array<PointerHand>();\r\n\r\n    private readonly pointers: IPointer[];\r\n    private readonly localPointerMovedEvt = new ObjectMovedEvent();\r\n\r\n    private readonly hits = new Array<THREE.Intersection>();\r\n\r\n    private infoPressed = false;\r\n    private menuPressed = false;\r\n\r\n    private readonly pointerEvents = new Map<IPointer, Map<string, EventSystemEvent<PointerEventTypes>>>();\r\n\r\n    constructor(\r\n        private readonly env: BaseEnvironment<unknown>) {\r\n        super();\r\n\r\n        this.raycaster.camera = this.env.camera;\r\n        this.raycaster.layers.set(FOREGROUND);\r\n\r\n        this.mouse = new PointerMouse(this, this.env.renderer, this.env.camera);\r\n        this.pen = new PointerPen(this, this.env.renderer, this.env.camera);\r\n        this.touches = new PointerMultiTouch(this, this.env.renderer, this.env.camera);\r\n\r\n        for (let i = 0; i < 2; ++i) {\r\n            this.hands[i] = new PointerHand(this, this.env.renderer, i);\r\n        }\r\n\r\n        this.pointers = [\r\n            this.mouse,\r\n            this.pen,\r\n            this.touches,\r\n            ...this.hands\r\n        ];\r\n\r\n        for (const pointer of this.pointers) {\r\n            if (pointer.cursor) {\r\n                objGraph(this.env.stage, pointer.cursor);\r\n            }\r\n        }\r\n\r\n        window.addEventListener(\"keydown\", (evt) => {\r\n            const ok = isModifierless(evt);\r\n            if (evt.key === \"/\") this.infoPressed = ok;\r\n            if (evt.key === \"ContextMenu\") this.menuPressed = ok;\r\n        });\r\n\r\n        window.addEventListener(\"keyup\", (evt) => {\r\n            if (evt.key === \"/\") this.infoPressed = false;\r\n            if (evt.key === \"ContextMenu\") this.menuPressed = false;\r\n        });\r\n\r\n        this.env.avatar.evtSys = this;\r\n\r\n        this.checkXRMouse();\r\n    }\r\n\r\n    onFlick(direction: number) {\r\n        this.env.avatar.onFlick(direction);\r\n    }\r\n\r\n    onConnected(_hand: PointerHand) {\r\n        this.checkXRMouse();\r\n    }\r\n\r\n    onDisconnected(_hand: PointerHand) {\r\n        this.checkXRMouse();\r\n    }\r\n\r\n    private checkXRMouse() {\r\n        let count = 0;\r\n        for (const hand of this.hands.values()) {\r\n            if (hand.enabled) {\r\n                ++count;\r\n            }\r\n        }\r\n\r\n        const enableScreenPointers = count === 0;\r\n        this.mouse.enabled = enableScreenPointers;\r\n        this.pen.enabled = enableScreenPointers;\r\n        this.touches.enabled = enableScreenPointers;\r\n    }\r\n\r\n    checkPointer(pointer: IPointer, eventType: SourcePointerEventTypes) {\r\n        pointer.isActive = true;\r\n\r\n        this.fireRay(pointer);\r\n\r\n        const { curHit, hoveredHit, pressedHit, draggedHit } = pointer;\r\n\r\n        const curTarget = getMeshTarget(curHit);\r\n        const hovTarget = getMeshTarget(hoveredHit);\r\n        const prsTarget = getMeshTarget(pressedHit);\r\n        const drgTarget = getMeshTarget(draggedHit);\r\n\r\n        if (eventType === \"move\" || eventType === \"drag\") {\r\n            correctHit(hoveredHit, pointer);\r\n            correctHit(pressedHit, pointer);\r\n            correctHit(draggedHit, pointer);\r\n        }\r\n\r\n        switch (eventType) {\r\n            case \"move\":\r\n                {\r\n                    const moveEvt = this.getEvent(pointer, \"move\", curHit);\r\n                    this.env.avatar.onMove(moveEvt);\r\n                    this.env.fovControl.onMove(moveEvt);\r\n\r\n                    if (isDefined(draggedHit)) {\r\n                        drgTarget.dispatchEvent(moveEvt);\r\n                    }\r\n                    else if (isDefined(pressedHit)) {\r\n                        prsTarget.dispatchEvent(moveEvt);\r\n                    }\r\n                    else if (pointer.state.buttons === 0) {\r\n                        this.checkExit(curHit, hoveredHit, pointer);\r\n                        this.checkEnter(curHit, hoveredHit, pointer);\r\n                        if (curTarget) {\r\n                            curTarget.dispatchEvent(moveEvt);\r\n                        }\r\n                    }\r\n\r\n                    this.localPointerMovedEvt.name = pointer.name;\r\n                    this.localPointerMovedEvt.set(\r\n                        pointer.origin.x, pointer.origin.y, pointer.origin.z,\r\n                        pointer.direction.x, pointer.direction.y, pointer.direction.z,\r\n                        0, 1, 0);\r\n\r\n                    this.dispatchEvent(this.localPointerMovedEvt);\r\n                }\r\n                break;\r\n\r\n            case \"down\":\r\n                {\r\n                    const downEvt = this.getEvent(pointer, \"down\", curHit);\r\n                    this.env.avatar.onDown(downEvt);\r\n\r\n                    if (hovTarget &&\r\n                        (hovTarget.clickable\r\n                        || hovTarget.draggable)) {\r\n                        pointer.pressedHit = hoveredHit;\r\n\r\n                        hovTarget.dispatchEvent(downEvt);\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case \"up\":\r\n                {\r\n                    const upEvt = this.getEvent(pointer, \"up\", curHit);\r\n                    this.dispatchEvent(upEvt);\r\n\r\n                    if (pointer.state.buttons === 0) {\r\n                        if (isDefined(pressedHit)) {\r\n                            pointer.pressedHit = null;\r\n                            prsTarget.dispatchEvent(upEvt);\r\n                        }\r\n\r\n                        this.checkExit(curHit, hoveredHit, pointer);\r\n                        this.checkEnter(curHit, hoveredHit, pointer);\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case \"click\":\r\n                {\r\n                    const clickEvt = this.getEvent(pointer, \"click\", curHit);\r\n                    this.dispatchEvent(clickEvt);\r\n\r\n                    if (curTarget && curTarget.clickable) {\r\n                        pointer.vibrate();\r\n                        curTarget.dispatchEvent(clickEvt);\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case \"dragstart\":\r\n                {\r\n                    const dragStartEvt = this.getEvent(pointer, \"dragstart\", pressedHit, curHit);\r\n                    this.dispatchEvent(dragStartEvt);\r\n\r\n                    if (isDefined(pressedHit)) {\r\n                        pointer.draggedHit = pressedHit;\r\n                        prsTarget.dispatchEvent(dragStartEvt);\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case \"drag\":\r\n                {\r\n                    const dragEvt = this.getEvent(pointer, \"drag\", draggedHit, curHit);\r\n                    this.dispatchEvent(dragEvt);\r\n\r\n                    if (isDefined(draggedHit)) {\r\n                        drgTarget.dispatchEvent(dragEvt);\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case \"dragcancel\":\r\n                {\r\n                    const dragCancelEvt = this.getEvent(pointer, \"dragcancel\", draggedHit, curHit);\r\n                    this.dispatchEvent(dragCancelEvt);\r\n\r\n                    if (isDefined(draggedHit)) {\r\n                        pointer.draggedHit = null;\r\n                        drgTarget.dispatchEvent(dragCancelEvt);\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case \"dragend\":\r\n                {\r\n                    const dragEndEvt = this.getEvent(pointer, \"dragend\", draggedHit, curHit);\r\n                    this.dispatchEvent(dragEndEvt);\r\n\r\n                    if (isDefined(draggedHit)) {\r\n                        pointer.draggedHit = null;\r\n                        drgTarget.dispatchEvent(dragEndEvt);\r\n                    }\r\n                }\r\n                break;\r\n\r\n            default:\r\n                assertNever(eventType);\r\n        }\r\n\r\n        pointer.updateCursor(\r\n            this.env.avatar.worldPos,\r\n            draggedHit || pressedHit || hoveredHit || curHit,\r\n            2);\r\n    }\r\n\r\n    private getEvent<T extends PointerEventTypes>(pointer: IPointer, type: T, ...hits: THREE.Intersection[]): EventSystemEvent<T> {\r\n        if (!this.pointerEvents.has(pointer)) {\r\n            this.pointerEvents.set(pointer, new Map<PointerEventTypes, EventSystemEvent<PointerEventTypes>>());\r\n        }\r\n\r\n        const pointerEvents = this.pointerEvents.get(pointer);\r\n        if (!pointerEvents.has(type)) {\r\n            pointerEvents.set(type, new EventSystemEvent(type, pointer));\r\n        }\r\n\r\n        const evt = pointerEvents.get(type) as EventSystemEvent<T>\r\n        if (hits.length > 0) {\r\n            evt.hit = arrayScan(hits, isDefined);\r\n            const lastHit = arrayScan(hits, (h) => isDefined(h) && h !== evt.hit);\r\n            if (isDefined(lastHit)) {\r\n                evt.hit.uv = lastHit.uv;\r\n            }\r\n        }\r\n        return evt;\r\n    }\r\n\r\n    private checkExit(curHit: THREE.Intersection, hoveredHit: THREE.Intersection, pointer: IPointer) {\r\n        const curObj = getMeshTarget(curHit);\r\n        const hoveredObj = getMeshTarget(hoveredHit);\r\n        if (curObj !== hoveredObj && isDefined(hoveredObj)) {\r\n            pointer.hoveredHit = null;\r\n\r\n            const exitEvt = this.getEvent(pointer, \"exit\", hoveredHit);\r\n            this.dispatchEvent(exitEvt);\r\n            hoveredObj.dispatchEvent(exitEvt);\r\n        }\r\n    }\r\n\r\n    private checkEnter(curHit: THREE.Intersection, hoveredHit: THREE.Intersection, pointer: IPointer) {\r\n        const curObj = getMeshTarget(curHit);\r\n        const hoveredObj = getMeshTarget(hoveredHit);\r\n        if (curObj !== hoveredObj && isDefined(curHit)) {\r\n            pointer.hoveredHit = curHit;\r\n\r\n            const enterEvt = this.getEvent(pointer, \"enter\", curHit);\r\n            this.dispatchEvent(enterEvt);\r\n            curObj.dispatchEvent(enterEvt);\r\n        }\r\n    }\r\n\r\n    refreshCursors() {\r\n        for (const pointer of this.pointers) {\r\n            if (pointer.cursor) {\r\n                pointer.cursor = this.env.cursor3D.clone();\r\n            }\r\n        }\r\n    }\r\n\r\n    fireRay(pointer: IPointer): void {\r\n        arrayClear(this.hits);\r\n\r\n        this.raycaster.ray.origin.copy(pointer.origin);\r\n        this.raycaster.ray.direction.copy(pointer.direction);\r\n        this.raycaster.intersectObject(this.env.scene, true, this.hits);\r\n\r\n        pointer.curHit = null;\r\n        let minDist = Number.MAX_VALUE;\r\n        for (const hit of this.hits) {\r\n            const rayTarget = getMeshTarget(hit);\r\n            if (rayTarget\r\n                && rayTarget.object.visible\r\n                && hit.distance < minDist) {\r\n                pointer.curHit = hit;\r\n                minDist = hit.distance;\r\n            }\r\n        }\r\n\r\n        if (pointer.curHit\r\n            && pointer.hoveredHit\r\n            && pointer.curHit.object === pointer.hoveredHit.object) {\r\n            pointer.hoveredHit = pointer.curHit;\r\n        }\r\n    }\r\n\r\n    update() {\r\n        for (const pointer of this.pointers) {\r\n            if (pointer.needsUpdate) {\r\n                pointer.update();\r\n            }\r\n        }\r\n    }\r\n\r\n    isPressed(button: VirtualButtons): boolean {\r\n        for (const pointer of this.pointers) {\r\n            if (pointer.isPressed(button)) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return button === VirtualButtons.Menu && this.menuPressed\r\n            || button === VirtualButtons.Info && this.infoPressed;\r\n    }\r\n}", "import { clamp, once, TypedEvent, TypedEventBase } from \"@juniper-lib/tslib\";\r\nimport { cube as geom } from \"./Cube\";\r\nimport { solidTransparent } from \"./materials\";\r\nimport { ErsatzObject } from \"./objects\";\r\n\r\ninterface FaderEvents {\r\n    fadecomplete: TypedEvent<\"fadecomplete\">;\r\n}\r\n\r\nconst completeEvt = new TypedEvent(\"fadecomplete\");\r\n\r\nexport class Fader extends TypedEventBase<FaderEvents>\r\n    implements ErsatzObject {\r\n    opacity = 1;\r\n    direction = 0;\r\n\r\n    speed: number;\r\n\r\n    readonly object: THREE.Mesh;\r\n    private readonly material: THREE.MeshBasicMaterial;\r\n\r\n    constructor(name: string, t = 0.15) {\r\n        super();\r\n\r\n        this.material = solidTransparent({\r\n            name: \"FaderMaterial\",\r\n            color: 0x000000,\r\n            side: THREE.BackSide\r\n        });\r\n        this.object = new THREE.Mesh(geom, this.material);\r\n\r\n        this.object.name = name;\r\n        this.object.renderOrder = Number.MAX_VALUE;\r\n        this.speed = 1 / t;\r\n        this.object.layers.enableAll();\r\n    }\r\n\r\n    async fadeOut() {\r\n        if (this.direction != 1) {\r\n            this.direction = 1;\r\n            await once(this, \"fadecomplete\");\r\n        }\r\n    }\r\n\r\n    async fadeIn() {\r\n        if (this.direction != -1) {\r\n            this.direction = -1;\r\n            await once(this, \"fadecomplete\");\r\n        }\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this.direction !== 0) {\r\n            const dOpacity = this.direction * this.speed * dt / 1000;\r\n            if (0 <= this.opacity && this.opacity <= 1) {\r\n                this.opacity += dOpacity;\r\n            }\r\n\r\n            if (this.direction === 1 && this.opacity >= 1\r\n                || this.direction === -1 && this.opacity <= 0) {\r\n                this.opacity = clamp(this.opacity, 0, 1);\r\n                this.direction = 0;\r\n                this.dispatchEvent(completeEvt);\r\n            }\r\n        }\r\n\r\n        this.material.opacity = this.opacity;\r\n        this.material.transparent = this.opacity < 1;\r\n        this.material.needsUpdate = true;\r\n    }\r\n}\r\n", "import { BaseProgress, IProgress } from \"@juniper-lib/tslib\";\r\nimport { Cube } from \"./Cube\";\r\nimport { deepSetLayer, PURGATORY } from \"./layers\";\r\nimport { litGrey, litWhite } from \"./materials\";\r\nimport { ErsatzObject, objectIsVisible, objectSetVisible, objGraph } from \"./objects\";\r\n\r\nfunction chrome(x: number, y: number, z: number, w: number, h: number, d: number) {\r\n    const chromeMesh = new Cube(w, h, d, litWhite);\r\n    chromeMesh.position.set(x, y, z);\r\n    return chromeMesh;\r\n}\r\n\r\nconst velocity = 0.1;\r\nexport class LoadingBar\r\n    extends BaseProgress\r\n    implements IProgress, ErsatzObject {\r\n\r\n    private readonly valueBar: Cube;\r\n    private value = 0;\r\n    private targetValue = 0;\r\n    readonly object = new THREE.Object3D();\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.valueBar = new Cube(0, 1, 1, litGrey);\r\n        this.valueBar.scale.set(0, 1, 1);\r\n\r\n        const valueBarContainer = new THREE.Object3D();\r\n        valueBarContainer.scale.set(1, 0.1, 0.1);\r\n\r\n        objGraph(this,\r\n            objGraph(valueBarContainer,\r\n                this.valueBar),\r\n            chrome(-0.5, 0, -0.05, 0.01, 0.1, 0.01),\r\n            chrome(-0.5, 0, 0.05, 0.01, 0.1, 0.01),\r\n            chrome(0.5, 0, -0.05, 0.01, 0.1, 0.01),\r\n            chrome(0.5, 0, 0.05, 0.01, 0.1, 0.01),\r\n            chrome(-0.5, -0.05, 0, 0.01, 0.01, 0.1),\r\n            chrome(0.5, -0.05, 0, 0.01, 0.01, 0.1),\r\n            chrome(-0.5, 0.05, 0, 0.01, 0.01, 0.1),\r\n            chrome(0.5, 0.05, 0, 0.01, 0.01, 0.1),\r\n            chrome(0, -0.05, -0.05, 1, 0.01, 0.01),\r\n            chrome(0, 0.05, -0.05, 1, 0.01, 0.01),\r\n            chrome(0, -0.05, 0.05, 1, 0.01, 0.01),\r\n            chrome(0, 0.05, 0.05, 1, 0.01, 0.01));\r\n\r\n        deepSetLayer(this, PURGATORY);\r\n    }\r\n\r\n    private _enabled: boolean = true;\r\n    get enabled(): boolean {\r\n        return this._enabled;\r\n    }\r\n\r\n    set enabled(v: boolean) {\r\n        if (v !== this._enabled) {\r\n            this._enabled = v;\r\n            objectSetVisible(this, objectIsVisible(this) || this.enabled);\r\n        }\r\n    }\r\n\r\n    override report(soFar: number, total: number, msg?: string) {\r\n        super.report(soFar, total, msg);\r\n        this.targetValue = this.p;\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this.object.parent.visible) {\r\n            this.value = Math.min(this.targetValue, this.value + velocity * dt);\r\n            this.valueBar.scale.set(this.value, 1, 1);\r\n            this.valueBar.position.x = this.value / 2 - 0.5;\r\n            objectSetVisible(this, this.enabled && this.value > 0);\r\n        }\r\n    }\r\n}", "if (!hasFullscreenAPI()) {\r\n    const Elm = Element.prototype as any;\r\n    const Doc = Document.prototype as any;\r\n\r\n    if (\"webkitRequestFullscreen\" in Elm) {\r\n        Elm.requestFullscreen = Elm.webkitRequestFullscreen;\r\n        Doc.exitFullscreen = Doc.webkitRequestFullscreen;\r\n        Object.defineProperties(Doc, {\r\n            \"fullscreenEnabled\": {\r\n                get: function () {\r\n                    return this.webkitFullscreenEnabled;\r\n                }\r\n            },\r\n            \"fullscreenElement\": {\r\n                get: function () {\r\n                    return this.webkitFullscreenElement;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    else if (\"mozRequestFullScreen\" in Elm) {\r\n        Elm.requestFullscreen = Elm.mozRequestFullScreen;\r\n        Doc.exitFullscreen = Doc.mozCancelFullScreen;\r\n        Object.defineProperties(Doc, {\r\n            \"fullscreenEnabled\": {\r\n                get: function () {\r\n                    return this.mozFullScreenEnabled;\r\n                }\r\n            },\r\n            \"fullscreenElement\": {\r\n                get: function () {\r\n                    return this.mozFullScreenElement;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    else if (\"msRequestFullscreen\" in Elm) {\r\n        Elm.requestFullscreen = Elm.msRequestFullscreen;\r\n        Doc.exitFullscreen = Doc.msExitFullscreen;\r\n        Object.defineProperties(Doc, {\r\n            \"fullscreenEnabled\": {\r\n                get: function () {\r\n                    return this.msFullscreenEnabled;\r\n                }\r\n            },\r\n            \"fullscreenElement\": {\r\n                get: function () {\r\n                    return this.msFullscreenElement;\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport function hasFullscreenAPI() {\r\n    return \"requestFullscreen\" in HTMLElement.prototype;\r\n}\r\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * A library for including application global. Similar to\n * logic provided by `rollup-plugin-node-globals` without the\n * rest of the functionality needed.\n */\n\nconst _global = typeof global !== 'undefined' ? global :\n                typeof self !== 'undefined' ? self :\n                typeof window !== 'undefined' ? window : {};\n\nexport default _global;\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst PRIVATE = Symbol('@@webxr-polyfill/EventTarget');\n\nexport default class EventTarget {\n  constructor() {\n    this[PRIVATE] = {\n      listeners: new Map(),\n    };\n  }\n\n  /**\n   * @param {string} type\n   * @param {Function} listener\n   */\n  addEventListener(type, listener) {\n    if (typeof type !== 'string') { throw new Error('`type` must be a string'); }\n    if (typeof listener !== 'function') { throw new Error('`listener` must be a function'); }\n\n    const typedListeners = this[PRIVATE].listeners.get(type) || [];\n    typedListeners.push(listener);\n    this[PRIVATE].listeners.set(type, typedListeners);\n  }\n\n  /**\n   * @param {string} type\n   * @param {Function} listener\n   */\n  removeEventListener(type, listener) {\n    if (typeof type !== 'string') { throw new Error('`type` must be a string'); }\n    if (typeof listener !== 'function') { throw new Error('`listener` must be a function'); }\n\n    const typedListeners = this[PRIVATE].listeners.get(type) || [];\n\n    for (let i = typedListeners.length; i >= 0; i--) {\n      if (typedListeners[i] === listener) {\n        typedListeners.pop();\n      }\n    }\n  }\n\n  /**\n   * @param {string} type\n   * @param {object} event\n   */\n  dispatchEvent(type, event) {\n    const typedListeners = this[PRIVATE].listeners.get(type) || [];\n\n    // Copy over all the listeners because a callback could remove\n    // an event listener, preventing all listeners from firing when\n    // the event was first dispatched.\n    const queue = [];\n    for (let i = 0; i < typedListeners.length; i++) {\n      queue[i] = typedListeners[i];\n    }\n\n    for (let listener of queue) {\n      listener(event);\n    }\n\n    // Also fire if this EventTarget has an `on${EVENT_TYPE}` property\n    // that's a function\n    if (typeof this[`on${type}`] === 'function') {\n      this[`on${type}`](event);\n    }\n  }\n}\n", "/**\n * Common utilities\n * @module glMatrix\n */\n\n// Configuration Constants\nexport const EPSILON = 0.000001;\nexport let ARRAY_TYPE = (typeof Float32Array !== 'undefined') ? Float32Array : Array;\nexport const RANDOM = Math.random;\n\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Type} type Array type, such as Float32Array or Array\n */\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\n\nconst degree = Math.PI / 180;\n\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\nexport function toRadian(a) {\n  return a * degree;\n}\n\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON*Math.max(1.0, Math.abs(a), Math.abs(b));\n}\n", "import * as glMatrix from \"./common.js\";\n\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\nexport function create() {\n  let out = new glMatrix.ARRAY_TYPE(16);\n  if(glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {mat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\nexport function clone(a) {\n  let out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the source matrix\n * @returns {mat4} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  let out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n\n\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the source matrix\n * @returns {mat4} out\n */\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    let a01 = a[1], a02 = a[2], a03 = a[3];\n    let a12 = a[6], a13 = a[7];\n    let a23 = a[11];\n\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the source matrix\n * @returns {mat4} out\n */\nexport function invert(out, a) {\n  let a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n  let a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n  let a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n  let a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n\n  let b00 = a00 * a11 - a01 * a10;\n  let b01 = a00 * a12 - a02 * a10;\n  let b02 = a00 * a13 - a03 * a10;\n  let b03 = a01 * a12 - a02 * a11;\n  let b04 = a01 * a13 - a03 * a11;\n  let b05 = a02 * a13 - a03 * a12;\n  let b06 = a20 * a31 - a21 * a30;\n  let b07 = a20 * a32 - a22 * a30;\n  let b08 = a20 * a33 - a23 * a30;\n  let b09 = a21 * a32 - a22 * a31;\n  let b10 = a21 * a33 - a23 * a31;\n  let b11 = a22 * a33 - a23 * a32;\n\n  // Calculate the determinant\n  let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n\n  return out;\n}\n\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the source matrix\n * @returns {mat4} out\n */\nexport function adjoint(out, a) {\n  let a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n  let a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n  let a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n  let a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n\n  out[0]  =  (a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22));\n  out[1]  = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n  out[2]  =  (a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12));\n  out[3]  = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n  out[4]  = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n  out[5]  =  (a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22));\n  out[6]  = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n  out[7]  =  (a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12));\n  out[8]  =  (a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21));\n  out[9]  = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n  out[10] =  (a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11));\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n  out[13] =  (a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21));\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n  out[15] =  (a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11));\n  return out;\n}\n\n/**\n * Calculates the determinant of a mat4\n *\n * @param {mat4} a the source matrix\n * @returns {Number} determinant of a\n */\nexport function determinant(a) {\n  let a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n  let a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n  let a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n  let a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n\n  let b00 = a00 * a11 - a01 * a10;\n  let b01 = a00 * a12 - a02 * a10;\n  let b02 = a00 * a13 - a03 * a10;\n  let b03 = a01 * a12 - a02 * a11;\n  let b04 = a01 * a13 - a03 * a11;\n  let b05 = a02 * a13 - a03 * a12;\n  let b06 = a20 * a31 - a21 * a30;\n  let b07 = a20 * a32 - a22 * a30;\n  let b08 = a20 * a33 - a23 * a30;\n  let b09 = a21 * a32 - a22 * a31;\n  let b10 = a21 * a33 - a23 * a31;\n  let b11 = a22 * a33 - a23 * a32;\n\n  // Calculate the determinant\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the first operand\n * @param {mat4} b the second operand\n * @returns {mat4} out\n */\nexport function multiply(out, a, b) {\n  let a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n  let a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n  let a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n  let a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n\n  // Cache only the current line of the second matrix\n  let b0  = b[0], b1 = b[1], b2 = b[2], b3 = b[3];\n  out[0] = b0*a00 + b1*a10 + b2*a20 + b3*a30;\n  out[1] = b0*a01 + b1*a11 + b2*a21 + b3*a31;\n  out[2] = b0*a02 + b1*a12 + b2*a22 + b3*a32;\n  out[3] = b0*a03 + b1*a13 + b2*a23 + b3*a33;\n\n  b0 = b[4]; b1 = b[5]; b2 = b[6]; b3 = b[7];\n  out[4] = b0*a00 + b1*a10 + b2*a20 + b3*a30;\n  out[5] = b0*a01 + b1*a11 + b2*a21 + b3*a31;\n  out[6] = b0*a02 + b1*a12 + b2*a22 + b3*a32;\n  out[7] = b0*a03 + b1*a13 + b2*a23 + b3*a33;\n\n  b0 = b[8]; b1 = b[9]; b2 = b[10]; b3 = b[11];\n  out[8] = b0*a00 + b1*a10 + b2*a20 + b3*a30;\n  out[9] = b0*a01 + b1*a11 + b2*a21 + b3*a31;\n  out[10] = b0*a02 + b1*a12 + b2*a22 + b3*a32;\n  out[11] = b0*a03 + b1*a13 + b2*a23 + b3*a33;\n\n  b0 = b[12]; b1 = b[13]; b2 = b[14]; b3 = b[15];\n  out[12] = b0*a00 + b1*a10 + b2*a20 + b3*a30;\n  out[13] = b0*a01 + b1*a11 + b2*a21 + b3*a31;\n  out[14] = b0*a02 + b1*a12 + b2*a22 + b3*a32;\n  out[15] = b0*a03 + b1*a13 + b2*a23 + b3*a33;\n  return out;\n}\n\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the matrix to translate\n * @param {vec3} v vector to translate by\n * @returns {mat4} out\n */\nexport function translate(out, a, v) {\n  let x = v[0], y = v[1], z = v[2];\n  let a00, a01, a02, a03;\n  let a10, a11, a12, a13;\n  let a20, a21, a22, a23;\n\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0]; a01 = a[1]; a02 = a[2]; a03 = a[3];\n    a10 = a[4]; a11 = a[5]; a12 = a[6]; a13 = a[7];\n    a20 = a[8]; a21 = a[9]; a22 = a[10]; a23 = a[11];\n\n    out[0] = a00; out[1] = a01; out[2] = a02; out[3] = a03;\n    out[4] = a10; out[5] = a11; out[6] = a12; out[7] = a13;\n    out[8] = a20; out[9] = a21; out[10] = a22; out[11] = a23;\n\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n\n  return out;\n}\n\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the matrix to scale\n * @param {vec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\nexport function scale(out, a, v) {\n  let x = v[0], y = v[1], z = v[2];\n\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {vec3} axis the axis to rotate around\n * @returns {mat4} out\n */\nexport function rotate(out, a, rad, axis) {\n  let x = axis[0], y = axis[1], z = axis[2];\n  let len = Math.sqrt(x * x + y * y + z * z);\n  let s, c, t;\n  let a00, a01, a02, a03;\n  let a10, a11, a12, a13;\n  let a20, a21, a22, a23;\n  let b00, b01, b02;\n  let b10, b11, b12;\n  let b20, b21, b22;\n\n  if (len < glMatrix.EPSILON) { return null; }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n\n  a00 = a[0]; a01 = a[1]; a02 = a[2]; a03 = a[3];\n  a10 = a[4]; a11 = a[5]; a12 = a[6]; a13 = a[7];\n  a20 = a[8]; a21 = a[9]; a22 = a[10]; a23 = a[11];\n\n  // Construct the elements of the rotation matrix\n  b00 = x * x * t + c; b01 = y * x * t + z * s; b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s; b11 = y * y * t + c; b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s; b21 = y * z * t - x * s; b22 = z * z * t + c;\n\n  // Perform rotation-specific matrix multiplication\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n\n  if (a !== out) { // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateX(out, a, rad) {\n  let s = Math.sin(rad);\n  let c = Math.cos(rad);\n  let a10 = a[4];\n  let a11 = a[5];\n  let a12 = a[6];\n  let a13 = a[7];\n  let a20 = a[8];\n  let a21 = a[9];\n  let a22 = a[10];\n  let a23 = a[11];\n\n  if (a !== out) { // If the source and destination differ, copy the unchanged rows\n    out[0]  = a[0];\n    out[1]  = a[1];\n    out[2]  = a[2];\n    out[3]  = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateY(out, a, rad) {\n  let s = Math.sin(rad);\n  let c = Math.cos(rad);\n  let a00 = a[0];\n  let a01 = a[1];\n  let a02 = a[2];\n  let a03 = a[3];\n  let a20 = a[8];\n  let a21 = a[9];\n  let a22 = a[10];\n  let a23 = a[11];\n\n  if (a !== out) { // If the source and destination differ, copy the unchanged rows\n    out[4]  = a[4];\n    out[5]  = a[5];\n    out[6]  = a[6];\n    out[7]  = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateZ(out, a, rad) {\n  let s = Math.sin(rad);\n  let c = Math.cos(rad);\n  let a00 = a[0];\n  let a01 = a[1];\n  let a02 = a[2];\n  let a03 = a[3];\n  let a10 = a[4];\n  let a11 = a[5];\n  let a12 = a[6];\n  let a13 = a[7];\n\n  if (a !== out) { // If the source and destination differ, copy the unchanged last row\n    out[8]  = a[8];\n    out[9]  = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {vec3} v Translation vector\n * @returns {mat4} out\n */\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {vec3} v Scaling vector\n * @returns {mat4} out\n */\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {vec3} axis the axis to rotate around\n * @returns {mat4} out\n */\nexport function fromRotation(out, rad, axis) {\n  let x = axis[0], y = axis[1], z = axis[2];\n  let len = Math.sqrt(x * x + y * y + z * z);\n  let s, c, t;\n\n  if (len < glMatrix.EPSILON) { return null; }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n\n  // Perform rotation-specific matrix multiplication\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromXRotation(out, rad) {\n  let s = Math.sin(rad);\n  let c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0]  = 1;\n  out[1]  = 0;\n  out[2]  = 0;\n  out[3]  = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromYRotation(out, rad) {\n  let s = Math.sin(rad);\n  let c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0]  = c;\n  out[1]  = 0;\n  out[2]  = -s;\n  out[3]  = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromZRotation(out, rad) {\n  let s = Math.sin(rad);\n  let c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0]  = c;\n  out[1]  = s;\n  out[2]  = 0;\n  out[3]  = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {vec3} v Translation vector\n * @returns {mat4} out\n */\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  let x = q[0], y = q[1], z = q[2], w = q[3];\n  let x2 = x + x;\n  let y2 = y + y;\n  let z2 = z + z;\n\n  let xx = x * x2;\n  let xy = x * y2;\n  let xz = x * z2;\n  let yy = y * y2;\n  let yz = y * z2;\n  let zz = z * z2;\n  let wx = w * x2;\n  let wy = w * y2;\n  let wz = w * z2;\n\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n\n  return out;\n}\n\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {quat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\nexport function fromQuat2(out, a) {\n  let translation = new glMatrix.ARRAY_TYPE(3);\n  let bx = -a[0], by = -a[1], bz = -a[2], bw = a[3],\n  ax = a[4], ay = a[5], az = a[6], aw = a[7];\n\n  let magnitude = bx * bx + by * by + bz * bz + bw * bw;\n  //Only scale if it makes sense\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {mat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n\n  return out;\n}\n\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion paramter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {mat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\nexport function getScaling(out, mat) {\n  let m11 = mat[0];\n  let m12 = mat[1];\n  let m13 = mat[2];\n  let m21 = mat[4];\n  let m22 = mat[5];\n  let m23 = mat[6];\n  let m31 = mat[8];\n  let m32 = mat[9];\n  let m33 = mat[10];\n\n  out[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n  out[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n  out[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n\n  return out;\n}\n\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {mat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\nexport function getRotation(out, mat) {\n  // Algorithm taken from http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\n  let trace = mat[0] + mat[5] + mat[10];\n  let S = 0;\n\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (mat[6] - mat[9]) / S;\n    out[1] = (mat[8] - mat[2]) / S;\n    out[2] = (mat[1] - mat[4]) / S;\n  } else if ((mat[0] > mat[5]) && (mat[0] > mat[10])) {\n    S = Math.sqrt(1.0 + mat[0] - mat[5] - mat[10]) * 2;\n    out[3] = (mat[6] - mat[9]) / S;\n    out[0] = 0.25 * S;\n    out[1] = (mat[1] + mat[4]) / S;\n    out[2] = (mat[8] + mat[2]) / S;\n  } else if (mat[5] > mat[10]) {\n    S = Math.sqrt(1.0 + mat[5] - mat[0] - mat[10]) * 2;\n    out[3] = (mat[8] - mat[2]) / S;\n    out[0] = (mat[1] + mat[4]) / S;\n    out[1] = 0.25 * S;\n    out[2] = (mat[6] + mat[9]) / S;\n  } else {\n    S = Math.sqrt(1.0 + mat[10] - mat[0] - mat[5]) * 2;\n    out[3] = (mat[1] - mat[4]) / S;\n    out[0] = (mat[8] + mat[2]) / S;\n    out[1] = (mat[6] + mat[9]) / S;\n    out[2] = 0.25 * S;\n  }\n\n  return out;\n}\n\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {vec3} v Translation vector\n * @param {vec3} s Scaling vector\n * @returns {mat4} out\n */\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  let x = q[0], y = q[1], z = q[2], w = q[3];\n  let x2 = x + x;\n  let y2 = y + y;\n  let z2 = z + z;\n\n  let xx = x * x2;\n  let xy = x * y2;\n  let xz = x * z2;\n  let yy = y * y2;\n  let yz = y * z2;\n  let zz = z * z2;\n  let wx = w * x2;\n  let wy = w * y2;\n  let wz = w * z2;\n  let sx = s[0];\n  let sy = s[1];\n  let sz = s[2];\n\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n\n  return out;\n}\n\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     mat4.translate(dest, origin);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *     mat4.translate(dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {vec3} v Translation vector\n * @param {vec3} s Scaling vector\n * @param {vec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  let x = q[0], y = q[1], z = q[2], w = q[3];\n  let x2 = x + x;\n  let y2 = y + y;\n  let z2 = z + z;\n\n  let xx = x * x2;\n  let xy = x * y2;\n  let xz = x * z2;\n  let yy = y * y2;\n  let yz = y * z2;\n  let zz = z * z2;\n  let wx = w * x2;\n  let wy = w * y2;\n  let wz = w * z2;\n\n  let sx = s[0];\n  let sy = s[1];\n  let sz = s[2];\n\n  let ox = o[0];\n  let oy = o[1];\n  let oz = o[2];\n\n  let out0 = (1 - (yy + zz)) * sx;\n  let out1 = (xy + wz) * sx;\n  let out2 = (xz - wy) * sx;\n  let out4 = (xy - wz) * sy;\n  let out5 = (1 - (xx + zz)) * sy;\n  let out6 = (yz + wx) * sy;\n  let out8 = (xz + wy) * sz;\n  let out9 = (yz - wx) * sz;\n  let out10 = (1 - (xx + yy)) * sz;\n\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n\n  return out;\n}\n\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\nexport function fromQuat(out, q) {\n  let x = q[0], y = q[1], z = q[2], w = q[3];\n  let x2 = x + x;\n  let y2 = y + y;\n  let z2 = z + z;\n\n  let xx = x * x2;\n  let yx = y * x2;\n  let yy = y * y2;\n  let zx = z * x2;\n  let zy = z * y2;\n  let zz = z * z2;\n  let wx = w * x2;\n  let wy = w * y2;\n  let wz = w * z2;\n\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n\n  return out;\n}\n\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function frustum(out, left, right, bottom, top, near, far) {\n  let rl = 1 / (right - left);\n  let tb = 1 / (top - bottom);\n  let nf = 1 / (near - far);\n  out[0] = (near * 2) * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = (near * 2) * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = (far * near * 2) * nf;\n  out[15] = 0;\n  return out;\n}\n\n/**\n * Generates a perspective projection matrix with the given bounds.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\nexport function perspective(out, fovy, aspect, near, far) {\n  let f = 1.0 / Math.tan(fovy / 2), nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = (2 * far * near) * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n  return out;\n}\n\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  let upTan = Math.tan(fov.upDegrees * Math.PI/180.0);\n  let downTan = Math.tan(fov.downDegrees * Math.PI/180.0);\n  let leftTan = Math.tan(fov.leftDegrees * Math.PI/180.0);\n  let rightTan = Math.tan(fov.rightDegrees * Math.PI/180.0);\n  let xScale = 2.0 / (leftTan + rightTan);\n  let yScale = 2.0 / (upTan + downTan);\n\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = ((upTan - downTan) * yScale * 0.5);\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = (far * near) / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n\n/**\n * Generates a orthogonal projection matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function ortho(out, left, right, bottom, top, near, far) {\n  let lr = 1 / (left - right);\n  let bt = 1 / (bottom - top);\n  let nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {vec3} eye Position of the viewer\n * @param {vec3} center Point the viewer is looking at\n * @param {vec3} up vec3 pointing up\n * @returns {mat4} out\n */\nexport function lookAt(out, eye, center, up) {\n  let x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  let eyex = eye[0];\n  let eyey = eye[1];\n  let eyez = eye[2];\n  let upx = up[0];\n  let upy = up[1];\n  let upz = up[2];\n  let centerx = center[0];\n  let centery = center[1];\n  let centerz = center[2];\n\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON &&\n      Math.abs(eyey - centery) < glMatrix.EPSILON &&\n      Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n\n  len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n\n  len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n\n  return out;\n}\n\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {vec3} eye Position of the viewer\n * @param {vec3} center Point the viewer is looking at\n * @param {vec3} up vec3 pointing up\n * @returns {mat4} out\n */\nexport function targetTo(out, eye, target, up) {\n  let eyex = eye[0],\n      eyey = eye[1],\n      eyez = eye[2],\n      upx = up[0],\n      upy = up[1],\n      upz = up[2];\n\n  let z0 = eyex - target[0],\n      z1 = eyey - target[1],\n      z2 = eyez - target[2];\n\n  let len = z0*z0 + z1*z1 + z2*z2;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n\n  let x0 = upy * z2 - upz * z1,\n      x1 = upz * z0 - upx * z2,\n      x2 = upx * z1 - upy * z0;\n\n  len = x0*x0 + x1*x1 + x2*x2;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n};\n\n/**\n * Returns a string representation of a mat4\n *\n * @param {mat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\nexport function str(a) {\n  return 'mat4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' +\n          a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ', ' +\n          a[8] + ', ' + a[9] + ', ' + a[10] + ', ' + a[11] + ', ' +\n          a[12] + ', ' + a[13] + ', ' + a[14] + ', ' + a[15] + ')';\n}\n\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {mat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\nexport function frob(a) {\n  return(Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + Math.pow(a[6], 2) + Math.pow(a[7], 2) + Math.pow(a[8], 2) + Math.pow(a[9], 2) + Math.pow(a[10], 2) + Math.pow(a[11], 2) + Math.pow(a[12], 2) + Math.pow(a[13], 2) + Math.pow(a[14], 2) + Math.pow(a[15], 2) ))\n}\n\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the first operand\n * @param {mat4} b the second operand\n * @returns {mat4} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the first operand\n * @param {mat4} b the second operand\n * @returns {mat4} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {mat4} a the first operand\n * @param {mat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + (b[0] * scale);\n  out[1] = a[1] + (b[1] * scale);\n  out[2] = a[2] + (b[2] * scale);\n  out[3] = a[3] + (b[3] * scale);\n  out[4] = a[4] + (b[4] * scale);\n  out[5] = a[5] + (b[5] * scale);\n  out[6] = a[6] + (b[6] * scale);\n  out[7] = a[7] + (b[7] * scale);\n  out[8] = a[8] + (b[8] * scale);\n  out[9] = a[9] + (b[9] * scale);\n  out[10] = a[10] + (b[10] * scale);\n  out[11] = a[11] + (b[11] * scale);\n  out[12] = a[12] + (b[12] * scale);\n  out[13] = a[13] + (b[13] * scale);\n  out[14] = a[14] + (b[14] * scale);\n  out[15] = a[15] + (b[15] * scale);\n  return out;\n}\n\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {mat4} a The first matrix.\n * @param {mat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] &&\n         a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] &&\n         a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] &&\n         a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {mat4} a The first matrix.\n * @param {mat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function equals(a, b) {\n  let a0  = a[0],  a1  = a[1],  a2  = a[2],  a3  = a[3];\n  let a4  = a[4],  a5  = a[5],  a6  = a[6],  a7  = a[7];\n  let a8  = a[8],  a9  = a[9],  a10 = a[10], a11 = a[11];\n  let a12 = a[12], a13 = a[13], a14 = a[14], a15 = a[15];\n\n  let b0  = b[0],  b1  = b[1],  b2  = b[2],  b3  = b[3];\n  let b4  = b[4],  b5  = b[5],  b6  = b[6],  b7  = b[7];\n  let b8  = b[8],  b9  = b[9],  b10 = b[10], b11 = b[11];\n  let b12 = b[12], b13 = b[13], b14 = b[14], b15 = b[15];\n\n  return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\n          Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\n          Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\n          Math.abs(a3 - b3) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a3), Math.abs(b3)) &&\n          Math.abs(a4 - b4) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a4), Math.abs(b4)) &&\n          Math.abs(a5 - b5) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a5), Math.abs(b5)) &&\n          Math.abs(a6 - b6) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a6), Math.abs(b6)) &&\n          Math.abs(a7 - b7) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a7), Math.abs(b7)) &&\n          Math.abs(a8 - b8) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a8), Math.abs(b8)) &&\n          Math.abs(a9 - b9) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a9), Math.abs(b9)) &&\n          Math.abs(a10 - b10) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a10), Math.abs(b10)) &&\n          Math.abs(a11 - b11) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a11), Math.abs(b11)) &&\n          Math.abs(a12 - b12) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a12), Math.abs(b12)) &&\n          Math.abs(a13 - b13) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a13), Math.abs(b13)) &&\n          Math.abs(a14 - b14) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a14), Math.abs(b14)) &&\n          Math.abs(a15 - b15) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a15), Math.abs(b15)));\n}\n\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\nexport const mul = multiply;\n\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\nexport const sub = subtract;\n", "import * as glMatrix from \"./common.js\";\n\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\nexport function create() {\n  let out = new glMatrix.ARRAY_TYPE(3);\n  if(glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n  return out;\n}\n\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {vec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n\n/**\n * Calculates the length of a vec3\n *\n * @param {vec3} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport function length(a) {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  return Math.sqrt(x*x + y*y + z*z);\n}\n\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\nexport function fromValues(x, y, z) {\n  let out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the source vector\n * @returns {vec3} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to ceil\n * @returns {vec3} out\n */\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to floor\n * @returns {vec3} out\n */\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to round\n * @returns {vec3} out\n */\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + (b[0] * scale);\n  out[1] = a[1] + (b[1] * scale);\n  out[2] = a[2] + (b[2] * scale);\n  return out;\n}\n\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {Number} distance between a and b\n */\nexport function distance(a, b) {\n  let x = b[0] - a[0];\n  let y = b[1] - a[1];\n  let z = b[2] - a[2];\n  return Math.sqrt(x*x + y*y + z*z);\n}\n\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\nexport function squaredDistance(a, b) {\n  let x = b[0] - a[0];\n  let y = b[1] - a[1];\n  let z = b[2] - a[2];\n  return x*x + y*y + z*z;\n}\n\n/**\n * Calculates the squared length of a vec3\n *\n * @param {vec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nexport function squaredLength(a) {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  return x*x + y*y + z*z;\n}\n\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to negate\n * @returns {vec3} out\n */\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to invert\n * @returns {vec3} out\n */\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to normalize\n * @returns {vec3} out\n */\nexport function normalize(out, a) {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  let len = x*x + y*y + z*z;\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n    out[0] = a[0] * len;\n    out[1] = a[1] * len;\n    out[2] = a[2] * len;\n  }\n  return out;\n}\n\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {Number} dot product of a and b\n */\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nexport function cross(out, a, b) {\n  let ax = a[0], ay = a[1], az = a[2];\n  let bx = b[0], by = b[1], bz = b[2];\n\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function lerp(out, a, b, t) {\n  let ax = a[0];\n  let ay = a[1];\n  let az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @param {vec3} c the third operand\n * @param {vec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function hermite(out, a, b, c, d, t) {\n  let factorTimes2 = t * t;\n  let factor1 = factorTimes2 * (2 * t - 3) + 1;\n  let factor2 = factorTimes2 * (t - 2) + t;\n  let factor3 = factorTimes2 * (t - 1);\n  let factor4 = factorTimes2 * (3 - 2 * t);\n\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n\n  return out;\n}\n\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @param {vec3} c the third operand\n * @param {vec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function bezier(out, a, b, c, d, t) {\n  let inverseFactor = 1 - t;\n  let inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  let factorTimes2 = t * t;\n  let factor1 = inverseFactorTimesTwo * inverseFactor;\n  let factor2 = 3 * t * inverseFactorTimesTwo;\n  let factor3 = 3 * factorTimes2 * inverseFactor;\n  let factor4 = factorTimes2 * t;\n\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n\n  return out;\n}\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\nexport function random(out, scale) {\n  scale = scale || 1.0;\n\n  let r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  let z = (glMatrix.RANDOM() * 2.0) - 1.0;\n  let zScale = Math.sqrt(1.0-z*z) * scale;\n\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to transform\n * @param {mat4} m matrix to transform with\n * @returns {vec3} out\n */\nexport function transformMat4(out, a, m) {\n  let x = a[0], y = a[1], z = a[2];\n  let w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to transform\n * @param {mat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\nexport function transformMat3(out, a, m) {\n  let x = a[0], y = a[1], z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to transform\n * @param {quat} q quaternion to transform with\n * @returns {vec3} out\n */\nexport function transformQuat(out, a, q) {\n    // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n    let qx = q[0], qy = q[1], qz = q[2], qw = q[3];\n    let x = a[0], y = a[1], z = a[2];\n    // var qvec = [qx, qy, qz];\n    // var uv = vec3.cross([], qvec, a);\n    let uvx = qy * z - qz * y,\n        uvy = qz * x - qx * z,\n        uvz = qx * y - qy * x;\n    // var uuv = vec3.cross([], qvec, uv);\n    let uuvx = qy * uvz - qz * uvy,\n        uuvy = qz * uvx - qx * uvz,\n        uuvz = qx * uvy - qy * uvx;\n    // vec3.scale(uv, uv, 2 * w);\n    let w2 = qw * 2;\n    uvx *= w2;\n    uvy *= w2;\n    uvz *= w2;\n    // vec3.scale(uuv, uuv, 2);\n    uuvx *= 2;\n    uuvy *= 2;\n    uuvz *= 2;\n    // return vec3.add(out, a, vec3.add(out, uv, uuv));\n    out[0] = x + uvx + uuvx;\n    out[1] = y + uvy + uuvy;\n    out[2] = z + uvz + uuvz;\n    return out;\n}\n\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {vec3} a The vec3 point to rotate\n * @param {vec3} b The origin of the rotation\n * @param {Number} c The angle of rotation\n * @returns {vec3} out\n */\nexport function rotateX(out, a, b, c){\n  let p = [], r=[];\n  //Translate point to the origin\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2];\n\n  //perform rotation\n  r[0] = p[0];\n  r[1] = p[1]*Math.cos(c) - p[2]*Math.sin(c);\n  r[2] = p[1]*Math.sin(c) + p[2]*Math.cos(c);\n\n  //translate to correct position\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n\n  return out;\n}\n\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {vec3} a The vec3 point to rotate\n * @param {vec3} b The origin of the rotation\n * @param {Number} c The angle of rotation\n * @returns {vec3} out\n */\nexport function rotateY(out, a, b, c){\n  let p = [], r=[];\n  //Translate point to the origin\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2];\n\n  //perform rotation\n  r[0] = p[2]*Math.sin(c) + p[0]*Math.cos(c);\n  r[1] = p[1];\n  r[2] = p[2]*Math.cos(c) - p[0]*Math.sin(c);\n\n  //translate to correct position\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n\n  return out;\n}\n\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {vec3} a The vec3 point to rotate\n * @param {vec3} b The origin of the rotation\n * @param {Number} c The angle of rotation\n * @returns {vec3} out\n */\nexport function rotateZ(out, a, b, c){\n  let p = [], r=[];\n  //Translate point to the origin\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2];\n\n  //perform rotation\n  r[0] = p[0]*Math.cos(c) - p[1]*Math.sin(c);\n  r[1] = p[0]*Math.sin(c) + p[1]*Math.cos(c);\n  r[2] = p[2];\n\n  //translate to correct position\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n\n  return out;\n}\n\n/**\n * Get the angle between two 3D vectors\n * @param {vec3} a The first operand\n * @param {vec3} b The second operand\n * @returns {Number} The angle in radians\n */\nexport function angle(a, b) {\n  let tempA = fromValues(a[0], a[1], a[2]);\n  let tempB = fromValues(b[0], b[1], b[2]);\n\n  normalize(tempA, tempA);\n  normalize(tempB, tempB);\n\n  let cosine = dot(tempA, tempB);\n\n  if(cosine > 1.0) {\n    return 0;\n  }\n  else if(cosine < -1.0) {\n    return Math.PI;\n  } else {\n    return Math.acos(cosine);\n  }\n}\n\n/**\n * Returns a string representation of a vector\n *\n * @param {vec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return 'vec3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ')';\n}\n\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {vec3} a The first vector.\n * @param {vec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {vec3} a The first vector.\n * @param {vec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function equals(a, b) {\n  let a0 = a[0], a1 = a[1], a2 = a[2];\n  let b0 = b[0], b1 = b[1], b2 = b[2];\n  return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\n          Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\n          Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)));\n}\n\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\nexport const sub = subtract;\n\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\nexport const mul = multiply;\n\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\nexport const div = divide;\n\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\nexport const dist = distance;\n\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\nexport const sqrDist = squaredDistance;\n\n/**\n * Alias for {@link vec3.length}\n * @function\n */\nexport const len = length;\n\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\nexport const sqrLen = squaredLength;\n\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nexport const forEach = (function() {\n  let vec = create();\n\n  return function(a, stride, offset, count, fn, arg) {\n    let i, l;\n    if(!stride) {\n      stride = 3;\n    }\n\n    if(!offset) {\n      offset = 0;\n    }\n\n    if(count) {\n      l = Math.min((count * stride) + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for(i = offset; i < l; i += stride) {\n      vec[0] = a[i]; vec[1] = a[i+1]; vec[2] = a[i+2];\n      fn(vec, vec, arg);\n      a[i] = vec[0]; a[i+1] = vec[1]; a[i+2] = vec[2];\n    }\n\n    return a;\n  };\n})();\n", "import * as glMatrix from \"./common.js\";\n\n/**\n * 3x3 Matrix\n * @module mat3\n */\n\n/**\n * Creates a new identity mat3\n *\n * @returns {mat3} a new 3x3 matrix\n */\nexport function create() {\n  let out = new glMatrix.ARRAY_TYPE(9);\n  if(glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n  }\n  out[0] = 1;\n  out[4] = 1;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Copies the upper-left 3x3 values into the given mat3.\n *\n * @param {mat3} out the receiving 3x3 matrix\n * @param {mat4} a   the source 4x4 matrix\n * @returns {mat3} out\n */\nexport function fromMat4(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[4];\n  out[4] = a[5];\n  out[5] = a[6];\n  out[6] = a[8];\n  out[7] = a[9];\n  out[8] = a[10];\n  return out;\n}\n\n/**\n * Creates a new mat3 initialized with values from an existing matrix\n *\n * @param {mat3} a matrix to clone\n * @returns {mat3} a new 3x3 matrix\n */\nexport function clone(a) {\n  let out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Copy the values from one mat3 to another\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the source matrix\n * @returns {mat3} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Create a new mat3 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} A new mat3\n */\nexport function fromValues(m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  let out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n\n/**\n * Set the components of a mat3 to the given values\n *\n * @param {mat3} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} out\n */\nexport function set(out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n\n/**\n * Set a mat3 to the identity matrix\n *\n * @param {mat3} out the receiving matrix\n * @returns {mat3} out\n */\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Transpose the values of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the source matrix\n * @returns {mat3} out\n */\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    let a01 = a[1], a02 = a[2], a12 = a[5];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a01;\n    out[5] = a[7];\n    out[6] = a02;\n    out[7] = a12;\n  } else {\n    out[0] = a[0];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a[1];\n    out[4] = a[4];\n    out[5] = a[7];\n    out[6] = a[2];\n    out[7] = a[5];\n    out[8] = a[8];\n  }\n\n  return out;\n}\n\n/**\n * Inverts a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the source matrix\n * @returns {mat3} out\n */\nexport function invert(out, a) {\n  let a00 = a[0], a01 = a[1], a02 = a[2];\n  let a10 = a[3], a11 = a[4], a12 = a[5];\n  let a20 = a[6], a21 = a[7], a22 = a[8];\n\n  let b01 = a22 * a11 - a12 * a21;\n  let b11 = -a22 * a10 + a12 * a20;\n  let b21 = a21 * a10 - a11 * a20;\n\n  // Calculate the determinant\n  let det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n\n  out[0] = b01 * det;\n  out[1] = (-a22 * a01 + a02 * a21) * det;\n  out[2] = (a12 * a01 - a02 * a11) * det;\n  out[3] = b11 * det;\n  out[4] = (a22 * a00 - a02 * a20) * det;\n  out[5] = (-a12 * a00 + a02 * a10) * det;\n  out[6] = b21 * det;\n  out[7] = (-a21 * a00 + a01 * a20) * det;\n  out[8] = (a11 * a00 - a01 * a10) * det;\n  return out;\n}\n\n/**\n * Calculates the adjugate of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the source matrix\n * @returns {mat3} out\n */\nexport function adjoint(out, a) {\n  let a00 = a[0], a01 = a[1], a02 = a[2];\n  let a10 = a[3], a11 = a[4], a12 = a[5];\n  let a20 = a[6], a21 = a[7], a22 = a[8];\n\n  out[0] = (a11 * a22 - a12 * a21);\n  out[1] = (a02 * a21 - a01 * a22);\n  out[2] = (a01 * a12 - a02 * a11);\n  out[3] = (a12 * a20 - a10 * a22);\n  out[4] = (a00 * a22 - a02 * a20);\n  out[5] = (a02 * a10 - a00 * a12);\n  out[6] = (a10 * a21 - a11 * a20);\n  out[7] = (a01 * a20 - a00 * a21);\n  out[8] = (a00 * a11 - a01 * a10);\n  return out;\n}\n\n/**\n * Calculates the determinant of a mat3\n *\n * @param {mat3} a the source matrix\n * @returns {Number} determinant of a\n */\nexport function determinant(a) {\n  let a00 = a[0], a01 = a[1], a02 = a[2];\n  let a10 = a[3], a11 = a[4], a12 = a[5];\n  let a20 = a[6], a21 = a[7], a22 = a[8];\n\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n}\n\n/**\n * Multiplies two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the first operand\n * @param {mat3} b the second operand\n * @returns {mat3} out\n */\nexport function multiply(out, a, b) {\n  let a00 = a[0], a01 = a[1], a02 = a[2];\n  let a10 = a[3], a11 = a[4], a12 = a[5];\n  let a20 = a[6], a21 = a[7], a22 = a[8];\n\n  let b00 = b[0], b01 = b[1], b02 = b[2];\n  let b10 = b[3], b11 = b[4], b12 = b[5];\n  let b20 = b[6], b21 = b[7], b22 = b[8];\n\n  out[0] = b00 * a00 + b01 * a10 + b02 * a20;\n  out[1] = b00 * a01 + b01 * a11 + b02 * a21;\n  out[2] = b00 * a02 + b01 * a12 + b02 * a22;\n\n  out[3] = b10 * a00 + b11 * a10 + b12 * a20;\n  out[4] = b10 * a01 + b11 * a11 + b12 * a21;\n  out[5] = b10 * a02 + b11 * a12 + b12 * a22;\n\n  out[6] = b20 * a00 + b21 * a10 + b22 * a20;\n  out[7] = b20 * a01 + b21 * a11 + b22 * a21;\n  out[8] = b20 * a02 + b21 * a12 + b22 * a22;\n  return out;\n}\n\n/**\n * Translate a mat3 by the given vector\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the matrix to translate\n * @param {vec2} v vector to translate by\n * @returns {mat3} out\n */\nexport function translate(out, a, v) {\n  let a00 = a[0], a01 = a[1], a02 = a[2],\n    a10 = a[3], a11 = a[4], a12 = a[5],\n    a20 = a[6], a21 = a[7], a22 = a[8],\n    x = v[0], y = v[1];\n\n  out[0] = a00;\n  out[1] = a01;\n  out[2] = a02;\n\n  out[3] = a10;\n  out[4] = a11;\n  out[5] = a12;\n\n  out[6] = x * a00 + y * a10 + a20;\n  out[7] = x * a01 + y * a11 + a21;\n  out[8] = x * a02 + y * a12 + a22;\n  return out;\n}\n\n/**\n * Rotates a mat3 by the given angle\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\nexport function rotate(out, a, rad) {\n  let a00 = a[0], a01 = a[1], a02 = a[2],\n    a10 = a[3], a11 = a[4], a12 = a[5],\n    a20 = a[6], a21 = a[7], a22 = a[8],\n\n    s = Math.sin(rad),\n    c = Math.cos(rad);\n\n  out[0] = c * a00 + s * a10;\n  out[1] = c * a01 + s * a11;\n  out[2] = c * a02 + s * a12;\n\n  out[3] = c * a10 - s * a00;\n  out[4] = c * a11 - s * a01;\n  out[5] = c * a12 - s * a02;\n\n  out[6] = a20;\n  out[7] = a21;\n  out[8] = a22;\n  return out;\n};\n\n/**\n * Scales the mat3 by the dimensions in the given vec2\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the matrix to rotate\n * @param {vec2} v the vec2 to scale the matrix by\n * @returns {mat3} out\n **/\nexport function scale(out, a, v) {\n  let x = v[0], y = v[1];\n\n  out[0] = x * a[0];\n  out[1] = x * a[1];\n  out[2] = x * a[2];\n\n  out[3] = y * a[3];\n  out[4] = y * a[4];\n  out[5] = y * a[5];\n\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.translate(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {vec2} v Translation vector\n * @returns {mat3} out\n */\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = v[0];\n  out[7] = v[1];\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a given angle\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.rotate(dest, dest, rad);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\nexport function fromRotation(out, rad) {\n  let s = Math.sin(rad), c = Math.cos(rad);\n\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n\n  out[3] = -s;\n  out[4] = c;\n  out[5] = 0;\n\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.scale(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {vec2} v Scaling vector\n * @returns {mat3} out\n */\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n\n  out[3] = 0;\n  out[4] = v[1];\n  out[5] = 0;\n\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Copies the values from a mat2d into a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {mat2d} a the matrix to copy\n * @returns {mat3} out\n **/\nexport function fromMat2d(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = 0;\n\n  out[3] = a[2];\n  out[4] = a[3];\n  out[5] = 0;\n\n  out[6] = a[4];\n  out[7] = a[5];\n  out[8] = 1;\n  return out;\n}\n\n/**\n* Calculates a 3x3 matrix from the given quaternion\n*\n* @param {mat3} out mat3 receiving operation result\n* @param {quat} q Quaternion to create matrix from\n*\n* @returns {mat3} out\n*/\nexport function fromQuat(out, q) {\n  let x = q[0], y = q[1], z = q[2], w = q[3];\n  let x2 = x + x;\n  let y2 = y + y;\n  let z2 = z + z;\n\n  let xx = x * x2;\n  let yx = y * x2;\n  let yy = y * y2;\n  let zx = z * x2;\n  let zy = z * y2;\n  let zz = z * z2;\n  let wx = w * x2;\n  let wy = w * y2;\n  let wz = w * z2;\n\n  out[0] = 1 - yy - zz;\n  out[3] = yx - wz;\n  out[6] = zx + wy;\n\n  out[1] = yx + wz;\n  out[4] = 1 - xx - zz;\n  out[7] = zy - wx;\n\n  out[2] = zx - wy;\n  out[5] = zy + wx;\n  out[8] = 1 - xx - yy;\n\n  return out;\n}\n\n/**\n* Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\n*\n* @param {mat3} out mat3 receiving operation result\n* @param {mat4} a Mat4 to derive the normal matrix from\n*\n* @returns {mat3} out\n*/\nexport function normalFromMat4(out, a) {\n  let a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n  let a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n  let a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n  let a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n\n  let b00 = a00 * a11 - a01 * a10;\n  let b01 = a00 * a12 - a02 * a10;\n  let b02 = a00 * a13 - a03 * a10;\n  let b03 = a01 * a12 - a02 * a11;\n  let b04 = a01 * a13 - a03 * a11;\n  let b05 = a02 * a13 - a03 * a12;\n  let b06 = a20 * a31 - a21 * a30;\n  let b07 = a20 * a32 - a22 * a30;\n  let b08 = a20 * a33 - a23 * a30;\n  let b09 = a21 * a32 - a22 * a31;\n  let b10 = a21 * a33 - a23 * a31;\n  let b11 = a22 * a33 - a23 * a32;\n\n  // Calculate the determinant\n  let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n\n  out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n\n  out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n\n  return out;\n}\n\n/**\n * Generates a 2D projection matrix with the given bounds\n *\n * @param {mat3} out mat3 frustum matrix will be written into\n * @param {number} width Width of your gl context\n * @param {number} height Height of gl context\n * @returns {mat3} out\n */\nexport function projection(out, width, height) {\n    out[0] = 2 / width;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = -2 / height;\n    out[5] = 0;\n    out[6] = -1;\n    out[7] = 1;\n    out[8] = 1;\n    return out;\n}\n\n/**\n * Returns a string representation of a mat3\n *\n * @param {mat3} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\nexport function str(a) {\n  return 'mat3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' +\n          a[3] + ', ' + a[4] + ', ' + a[5] + ', ' +\n          a[6] + ', ' + a[7] + ', ' + a[8] + ')';\n}\n\n/**\n * Returns Frobenius norm of a mat3\n *\n * @param {mat3} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\nexport function frob(a) {\n  return(Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + Math.pow(a[6], 2) + Math.pow(a[7], 2) + Math.pow(a[8], 2)))\n}\n\n/**\n * Adds two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the first operand\n * @param {mat3} b the second operand\n * @returns {mat3} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  return out;\n}\n\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the first operand\n * @param {mat3} b the second operand\n * @returns {mat3} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  return out;\n}\n\n\n\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat3} out the receiving matrix\n * @param {mat3} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat3} out\n */\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  return out;\n}\n\n/**\n * Adds two mat3's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat3} out the receiving vector\n * @param {mat3} a the first operand\n * @param {mat3} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat3} out\n */\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + (b[0] * scale);\n  out[1] = a[1] + (b[1] * scale);\n  out[2] = a[2] + (b[2] * scale);\n  out[3] = a[3] + (b[3] * scale);\n  out[4] = a[4] + (b[4] * scale);\n  out[5] = a[5] + (b[5] * scale);\n  out[6] = a[6] + (b[6] * scale);\n  out[7] = a[7] + (b[7] * scale);\n  out[8] = a[8] + (b[8] * scale);\n  return out;\n}\n\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {mat3} a The first matrix.\n * @param {mat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] &&\n         a[3] === b[3] && a[4] === b[4] && a[5] === b[5] &&\n         a[6] === b[6] && a[7] === b[7] && a[8] === b[8];\n}\n\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {mat3} a The first matrix.\n * @param {mat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function equals(a, b) {\n  let a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3], a4 = a[4], a5 = a[5], a6 = a[6], a7 = a[7], a8 = a[8];\n  let b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3], b4 = b[4], b5 = b[5], b6 = b[6], b7 = b[7], b8 = b[8];\n  return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\n          Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\n          Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\n          Math.abs(a3 - b3) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a3), Math.abs(b3)) &&\n          Math.abs(a4 - b4) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a4), Math.abs(b4)) &&\n          Math.abs(a5 - b5) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a5), Math.abs(b5)) &&\n          Math.abs(a6 - b6) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a6), Math.abs(b6)) &&\n          Math.abs(a7 - b7) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a7), Math.abs(b7)) &&\n          Math.abs(a8 - b8) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a8), Math.abs(b8)));\n}\n\n/**\n * Alias for {@link mat3.multiply}\n * @function\n */\nexport const mul = multiply;\n\n/**\n * Alias for {@link mat3.subtract}\n * @function\n */\nexport const sub = subtract;\n", "import * as glMatrix from \"./common.js\";\n\n/**\n * 4 Dimensional Vector\n * @module vec4\n */\n\n/**\n * Creates a new, empty vec4\n *\n * @returns {vec4} a new 4D vector\n */\nexport function create() {\n  let out = new glMatrix.ARRAY_TYPE(4);\n  if(glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n  }\n  return out;\n}\n\n/**\n * Creates a new vec4 initialized with values from an existing vector\n *\n * @param {vec4} a vector to clone\n * @returns {vec4} a new 4D vector\n */\nexport function clone(a) {\n  let out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n\n/**\n * Creates a new vec4 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} a new 4D vector\n */\nexport function fromValues(x, y, z, w) {\n  let out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n\n/**\n * Copy the values from one vec4 to another\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the source vector\n * @returns {vec4} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n\n/**\n * Set the components of a vec4 to the given values\n *\n * @param {vec4} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} out\n */\nexport function set(out, x, y, z, w) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n\n/**\n * Adds two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @returns {vec4} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  return out;\n}\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @returns {vec4} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  return out;\n}\n\n/**\n * Multiplies two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @returns {vec4} out\n */\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  out[3] = a[3] * b[3];\n  return out;\n}\n\n/**\n * Divides two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @returns {vec4} out\n */\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  out[3] = a[3] / b[3];\n  return out;\n}\n\n/**\n * Math.ceil the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a vector to ceil\n * @returns {vec4} out\n */\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  out[3] = Math.ceil(a[3]);\n  return out;\n}\n\n/**\n * Math.floor the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a vector to floor\n * @returns {vec4} out\n */\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  out[3] = Math.floor(a[3]);\n  return out;\n}\n\n/**\n * Returns the minimum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @returns {vec4} out\n */\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  out[3] = Math.min(a[3], b[3]);\n  return out;\n}\n\n/**\n * Returns the maximum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @returns {vec4} out\n */\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  out[3] = Math.max(a[3], b[3]);\n  return out;\n}\n\n/**\n * Math.round the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a vector to round\n * @returns {vec4} out\n */\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  out[3] = Math.round(a[3]);\n  return out;\n}\n\n/**\n * Scales a vec4 by a scalar number\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec4} out\n */\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  return out;\n}\n\n/**\n * Adds two vec4's after scaling the second operand by a scalar value\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec4} out\n */\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + (b[0] * scale);\n  out[1] = a[1] + (b[1] * scale);\n  out[2] = a[2] + (b[2] * scale);\n  out[3] = a[3] + (b[3] * scale);\n  return out;\n}\n\n/**\n * Calculates the euclidian distance between two vec4's\n *\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @returns {Number} distance between a and b\n */\nexport function distance(a, b) {\n  let x = b[0] - a[0];\n  let y = b[1] - a[1];\n  let z = b[2] - a[2];\n  let w = b[3] - a[3];\n  return Math.sqrt(x*x + y*y + z*z + w*w);\n}\n\n/**\n * Calculates the squared euclidian distance between two vec4's\n *\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @returns {Number} squared distance between a and b\n */\nexport function squaredDistance(a, b) {\n  let x = b[0] - a[0];\n  let y = b[1] - a[1];\n  let z = b[2] - a[2];\n  let w = b[3] - a[3];\n  return x*x + y*y + z*z + w*w;\n}\n\n/**\n * Calculates the length of a vec4\n *\n * @param {vec4} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport function length(a) {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  let w = a[3];\n  return Math.sqrt(x*x + y*y + z*z + w*w);\n}\n\n/**\n * Calculates the squared length of a vec4\n *\n * @param {vec4} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nexport function squaredLength(a) {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  let w = a[3];\n  return x*x + y*y + z*z + w*w;\n}\n\n/**\n * Negates the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a vector to negate\n * @returns {vec4} out\n */\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = -a[3];\n  return out;\n}\n\n/**\n * Returns the inverse of the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a vector to invert\n * @returns {vec4} out\n */\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  out[3] = 1.0 / a[3];\n  return out;\n}\n\n/**\n * Normalize a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a vector to normalize\n * @returns {vec4} out\n */\nexport function normalize(out, a) {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  let w = a[3];\n  let len = x*x + y*y + z*z + w*w;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    out[0] = x * len;\n    out[1] = y * len;\n    out[2] = z * len;\n    out[3] = w * len;\n  }\n  return out;\n}\n\n/**\n * Calculates the dot product of two vec4's\n *\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @returns {Number} dot product of a and b\n */\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\n\n/**\n * Performs a linear interpolation between two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the first operand\n * @param {vec4} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec4} out\n */\nexport function lerp(out, a, b, t) {\n  let ax = a[0];\n  let ay = a[1];\n  let az = a[2];\n  let aw = a[3];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  out[3] = aw + t * (b[3] - aw);\n  return out;\n}\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec4} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec4} out\n */\nexport function random(out, scale) {\n  scale = scale || 1.0;\n\n  // Marsaglia, George. Choosing a Point from the Surface of a\n  // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\n  // http://projecteuclid.org/euclid.aoms/1177692644;\n  var v1, v2, v3, v4;\n  var s1, s2;\n  do {\n    v1 = glMatrix.RANDOM() * 2 - 1;\n    v2 = glMatrix.RANDOM() * 2 - 1;\n    s1 = v1 * v1 + v2 * v2;\n  } while (s1 >= 1);\n  do {\n    v3 = glMatrix.RANDOM() * 2 - 1;\n    v4 = glMatrix.RANDOM() * 2 - 1;\n    s2 = v3 * v3 + v4 * v4;\n  } while (s2 >= 1);\n\n  var d = Math.sqrt((1 - s1) / s2);\n  out[0] = scale * v1;\n  out[1] = scale * v2;\n  out[2] = scale * v3 * d;\n  out[3] = scale * v4 * d;\n  return out;\n}\n\n/**\n * Transforms the vec4 with a mat4.\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the vector to transform\n * @param {mat4} m matrix to transform with\n * @returns {vec4} out\n */\nexport function transformMat4(out, a, m) {\n  let x = a[0], y = a[1], z = a[2], w = a[3];\n  out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\n  out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n  return out;\n}\n\n/**\n * Transforms the vec4 with a quat\n *\n * @param {vec4} out the receiving vector\n * @param {vec4} a the vector to transform\n * @param {quat} q quaternion to transform with\n * @returns {vec4} out\n */\nexport function transformQuat(out, a, q) {\n  let x = a[0], y = a[1], z = a[2];\n  let qx = q[0], qy = q[1], qz = q[2], qw = q[3];\n\n  // calculate quat * vec\n  let ix = qw * x + qy * z - qz * y;\n  let iy = qw * y + qz * x - qx * z;\n  let iz = qw * z + qx * y - qy * x;\n  let iw = -qx * x - qy * y - qz * z;\n\n  // calculate result * inverse quat\n  out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n  out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n  out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n  out[3] = a[3];\n  return out;\n}\n\n/**\n * Returns a string representation of a vector\n *\n * @param {vec4} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return 'vec4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';\n}\n\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {vec4} a The first vector.\n * @param {vec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {vec4} a The first vector.\n * @param {vec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function equals(a, b) {\n  let a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];\n  let b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];\n  return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\n          Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\n          Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\n          Math.abs(a3 - b3) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a3), Math.abs(b3)));\n}\n\n/**\n * Alias for {@link vec4.subtract}\n * @function\n */\nexport const sub = subtract;\n\n/**\n * Alias for {@link vec4.multiply}\n * @function\n */\nexport const mul = multiply;\n\n/**\n * Alias for {@link vec4.divide}\n * @function\n */\nexport const div = divide;\n\n/**\n * Alias for {@link vec4.distance}\n * @function\n */\nexport const dist = distance;\n\n/**\n * Alias for {@link vec4.squaredDistance}\n * @function\n */\nexport const sqrDist = squaredDistance;\n\n/**\n * Alias for {@link vec4.length}\n * @function\n */\nexport const len = length;\n\n/**\n * Alias for {@link vec4.squaredLength}\n * @function\n */\nexport const sqrLen = squaredLength;\n\n/**\n * Perform some operation over an array of vec4s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nexport const forEach = (function() {\n  let vec = create();\n\n  return function(a, stride, offset, count, fn, arg) {\n    let i, l;\n    if(!stride) {\n      stride = 4;\n    }\n\n    if(!offset) {\n      offset = 0;\n    }\n\n    if(count) {\n      l = Math.min((count * stride) + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for(i = offset; i < l; i += stride) {\n      vec[0] = a[i]; vec[1] = a[i+1]; vec[2] = a[i+2]; vec[3] = a[i+3];\n      fn(vec, vec, arg);\n      a[i] = vec[0]; a[i+1] = vec[1]; a[i+2] = vec[2]; a[i+3] = vec[3];\n    }\n\n    return a;\n  };\n})();\n", "import * as glMatrix from \"./common.js\"\nimport * as mat3 from \"./mat3.js\"\nimport * as vec3 from \"./vec3.js\"\nimport * as vec4 from \"./vec4.js\"\n\n/**\n * Quaternion\n * @module quat\n */\n\n/**\n * Creates a new identity quat\n *\n * @returns {quat} a new quaternion\n */\nexport function create() {\n  let out = new glMatrix.ARRAY_TYPE(4);\n  if(glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n  out[3] = 1;\n  return out;\n}\n\n/**\n * Set a quat to the identity quaternion\n *\n * @param {quat} out the receiving quaternion\n * @returns {quat} out\n */\nexport function identity(out) {\n  out[0] = 0;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 1;\n  return out;\n}\n\n/**\n * Sets a quat from the given angle and rotation axis,\n * then returns it.\n *\n * @param {quat} out the receiving quaternion\n * @param {vec3} axis the axis around which to rotate\n * @param {Number} rad the angle in radians\n * @returns {quat} out\n **/\nexport function setAxisAngle(out, axis, rad) {\n  rad = rad * 0.5;\n  let s = Math.sin(rad);\n  out[0] = s * axis[0];\n  out[1] = s * axis[1];\n  out[2] = s * axis[2];\n  out[3] = Math.cos(rad);\n  return out;\n}\n\n/**\n * Gets the rotation axis and angle for a given\n *  quaternion. If a quaternion is created with\n *  setAxisAngle, this method will return the same\n *  values as providied in the original parameter list\n *  OR functionally equivalent values.\n * Example: The quaternion formed by axis [0, 0, 1] and\n *  angle -90 is the same as the quaternion formed by\n *  [0, 0, 1] and 270. This method favors the latter.\n * @param  {vec3} out_axis  Vector receiving the axis of rotation\n * @param  {quat} q     Quaternion to be decomposed\n * @return {Number}     Angle, in radians, of the rotation\n */\nexport function getAxisAngle(out_axis, q) {\n  let rad = Math.acos(q[3]) * 2.0;\n  let s = Math.sin(rad / 2.0);\n  if (s > glMatrix.EPSILON) {\n    out_axis[0] = q[0] / s;\n    out_axis[1] = q[1] / s;\n    out_axis[2] = q[2] / s;\n  } else {\n    // If s is zero, return any axis (no rotation - axis does not matter)\n    out_axis[0] = 1;\n    out_axis[1] = 0;\n    out_axis[2] = 0;\n  }\n  return rad;\n}\n\n/**\n * Multiplies two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a the first operand\n * @param {quat} b the second operand\n * @returns {quat} out\n */\nexport function multiply(out, a, b) {\n  let ax = a[0], ay = a[1], az = a[2], aw = a[3];\n  let bx = b[0], by = b[1], bz = b[2], bw = b[3];\n\n  out[0] = ax * bw + aw * bx + ay * bz - az * by;\n  out[1] = ay * bw + aw * by + az * bx - ax * bz;\n  out[2] = az * bw + aw * bz + ax * by - ay * bx;\n  out[3] = aw * bw - ax * bx - ay * by - az * bz;\n  return out;\n}\n\n/**\n * Rotates a quaternion by the given angle about the X axis\n *\n * @param {quat} out quat receiving operation result\n * @param {quat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\nexport function rotateX(out, a, rad) {\n  rad *= 0.5;\n\n  let ax = a[0], ay = a[1], az = a[2], aw = a[3];\n  let bx = Math.sin(rad), bw = Math.cos(rad);\n\n  out[0] = ax * bw + aw * bx;\n  out[1] = ay * bw + az * bx;\n  out[2] = az * bw - ay * bx;\n  out[3] = aw * bw - ax * bx;\n  return out;\n}\n\n/**\n * Rotates a quaternion by the given angle about the Y axis\n *\n * @param {quat} out quat receiving operation result\n * @param {quat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\nexport function rotateY(out, a, rad) {\n  rad *= 0.5;\n\n  let ax = a[0], ay = a[1], az = a[2], aw = a[3];\n  let by = Math.sin(rad), bw = Math.cos(rad);\n\n  out[0] = ax * bw - az * by;\n  out[1] = ay * bw + aw * by;\n  out[2] = az * bw + ax * by;\n  out[3] = aw * bw - ay * by;\n  return out;\n}\n\n/**\n * Rotates a quaternion by the given angle about the Z axis\n *\n * @param {quat} out quat receiving operation result\n * @param {quat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\nexport function rotateZ(out, a, rad) {\n  rad *= 0.5;\n\n  let ax = a[0], ay = a[1], az = a[2], aw = a[3];\n  let bz = Math.sin(rad), bw = Math.cos(rad);\n\n  out[0] = ax * bw + ay * bz;\n  out[1] = ay * bw - ax * bz;\n  out[2] = az * bw + aw * bz;\n  out[3] = aw * bw - az * bz;\n  return out;\n}\n\n/**\n * Calculates the W component of a quat from the X, Y, and Z components.\n * Assumes that quaternion is 1 unit in length.\n * Any existing W component will be ignored.\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a quat to calculate W component of\n * @returns {quat} out\n */\nexport function calculateW(out, a) {\n  let x = a[0], y = a[1], z = a[2];\n\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));\n  return out;\n}\n\n/**\n * Performs a spherical linear interpolation between two quat\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a the first operand\n * @param {quat} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n */\nexport function slerp(out, a, b, t) {\n  // benchmarks:\n  //    http://jsperf.com/quaternion-slerp-implementations\n  let ax = a[0], ay = a[1], az = a[2], aw = a[3];\n  let bx = b[0], by = b[1], bz = b[2], bw = b[3];\n\n  let omega, cosom, sinom, scale0, scale1;\n\n  // calc cosine\n  cosom = ax * bx + ay * by + az * bz + aw * bw;\n  // adjust signs (if necessary)\n  if ( cosom < 0.0 ) {\n    cosom = -cosom;\n    bx = - bx;\n    by = - by;\n    bz = - bz;\n    bw = - bw;\n  }\n  // calculate coefficients\n  if ( (1.0 - cosom) > glMatrix.EPSILON ) {\n    // standard case (slerp)\n    omega  = Math.acos(cosom);\n    sinom  = Math.sin(omega);\n    scale0 = Math.sin((1.0 - t) * omega) / sinom;\n    scale1 = Math.sin(t * omega) / sinom;\n  } else {\n    // \"from\" and \"to\" quaternions are very close\n    //  ... so we can do a linear interpolation\n    scale0 = 1.0 - t;\n    scale1 = t;\n  }\n  // calculate final values\n  out[0] = scale0 * ax + scale1 * bx;\n  out[1] = scale0 * ay + scale1 * by;\n  out[2] = scale0 * az + scale1 * bz;\n  out[3] = scale0 * aw + scale1 * bw;\n\n  return out;\n}\n\n/**\n * Generates a random quaternion\n *\n * @param {quat} out the receiving quaternion\n * @returns {quat} out\n */\nexport function random(out) {\n  // Implementation of http://planning.cs.uiuc.edu/node198.html\n  // TODO: Calling random 3 times is probably not the fastest solution\n  let u1 = glMatrix.RANDOM();\n  let u2 = glMatrix.RANDOM();\n  let u3 = glMatrix.RANDOM();\n\n  let sqrt1MinusU1 = Math.sqrt(1 - u1);\n  let sqrtU1 = Math.sqrt(u1);\n\n  out[0] = sqrt1MinusU1 * Math.sin(2.0 * Math.PI * u2);\n  out[1] = sqrt1MinusU1 * Math.cos(2.0 * Math.PI * u2);\n  out[2] = sqrtU1 * Math.sin(2.0 * Math.PI * u3);\n  out[3] = sqrtU1 * Math.cos(2.0 * Math.PI * u3);\n  return out;\n}\n\n/**\n * Calculates the inverse of a quat\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a quat to calculate inverse of\n * @returns {quat} out\n */\nexport function invert(out, a) {\n  let a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];\n  let dot = a0*a0 + a1*a1 + a2*a2 + a3*a3;\n  let invDot = dot ? 1.0/dot : 0;\n\n  // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0\n\n  out[0] = -a0*invDot;\n  out[1] = -a1*invDot;\n  out[2] = -a2*invDot;\n  out[3] = a3*invDot;\n  return out;\n}\n\n/**\n * Calculates the conjugate of a quat\n * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a quat to calculate conjugate of\n * @returns {quat} out\n */\nexport function conjugate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = a[3];\n  return out;\n}\n\n/**\n * Creates a quaternion from the given 3x3 rotation matrix.\n *\n * NOTE: The resultant quaternion is not normalized, so you should be sure\n * to renormalize the quaternion yourself where necessary.\n *\n * @param {quat} out the receiving quaternion\n * @param {mat3} m rotation matrix\n * @returns {quat} out\n * @function\n */\nexport function fromMat3(out, m) {\n  // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes\n  // article \"Quaternion Calculus and Fast Animation\".\n  let fTrace = m[0] + m[4] + m[8];\n  let fRoot;\n\n  if ( fTrace > 0.0 ) {\n    // |w| > 1/2, may as well choose w > 1/2\n    fRoot = Math.sqrt(fTrace + 1.0);  // 2w\n    out[3] = 0.5 * fRoot;\n    fRoot = 0.5/fRoot;  // 1/(4w)\n    out[0] = (m[5]-m[7])*fRoot;\n    out[1] = (m[6]-m[2])*fRoot;\n    out[2] = (m[1]-m[3])*fRoot;\n  } else {\n    // |w| <= 1/2\n    let i = 0;\n    if ( m[4] > m[0] )\n      i = 1;\n    if ( m[8] > m[i*3+i] )\n      i = 2;\n    let j = (i+1)%3;\n    let k = (i+2)%3;\n\n    fRoot = Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k] + 1.0);\n    out[i] = 0.5 * fRoot;\n    fRoot = 0.5 / fRoot;\n    out[3] = (m[j*3+k] - m[k*3+j]) * fRoot;\n    out[j] = (m[j*3+i] + m[i*3+j]) * fRoot;\n    out[k] = (m[k*3+i] + m[i*3+k]) * fRoot;\n  }\n\n  return out;\n}\n\n/**\n * Creates a quaternion from the given euler angle x, y, z.\n *\n * @param {quat} out the receiving quaternion\n * @param {x} Angle to rotate around X axis in degrees.\n * @param {y} Angle to rotate around Y axis in degrees.\n * @param {z} Angle to rotate around Z axis in degrees.\n * @returns {quat} out\n * @function\n */\nexport function fromEuler(out, x, y, z) {\n    let halfToRad = 0.5 * Math.PI / 180.0;\n    x *= halfToRad;\n    y *= halfToRad;\n    z *= halfToRad;\n\n    let sx = Math.sin(x);\n    let cx = Math.cos(x);\n    let sy = Math.sin(y);\n    let cy = Math.cos(y);\n    let sz = Math.sin(z);\n    let cz = Math.cos(z);\n\n    out[0] = sx * cy * cz - cx * sy * sz;\n    out[1] = cx * sy * cz + sx * cy * sz;\n    out[2] = cx * cy * sz - sx * sy * cz;\n    out[3] = cx * cy * cz + sx * sy * sz;\n\n    return out;\n}\n\n/**\n * Returns a string representation of a quatenion\n *\n * @param {quat} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return 'quat(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';\n}\n\n/**\n * Creates a new quat initialized with values from an existing quaternion\n *\n * @param {quat} a quaternion to clone\n * @returns {quat} a new quaternion\n * @function\n */\nexport const clone = vec4.clone;\n\n/**\n * Creates a new quat initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {quat} a new quaternion\n * @function\n */\nexport const fromValues = vec4.fromValues;\n\n/**\n * Copy the values from one quat to another\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a the source quaternion\n * @returns {quat} out\n * @function\n */\nexport const copy = vec4.copy;\n\n/**\n * Set the components of a quat to the given values\n *\n * @param {quat} out the receiving quaternion\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {quat} out\n * @function\n */\nexport const set = vec4.set;\n\n/**\n * Adds two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a the first operand\n * @param {quat} b the second operand\n * @returns {quat} out\n * @function\n */\nexport const add = vec4.add;\n\n/**\n * Alias for {@link quat.multiply}\n * @function\n */\nexport const mul = multiply;\n\n/**\n * Scales a quat by a scalar number\n *\n * @param {quat} out the receiving vector\n * @param {quat} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {quat} out\n * @function\n */\nexport const scale = vec4.scale;\n\n/**\n * Calculates the dot product of two quat's\n *\n * @param {quat} a the first operand\n * @param {quat} b the second operand\n * @returns {Number} dot product of a and b\n * @function\n */\nexport const dot = vec4.dot;\n\n/**\n * Performs a linear interpolation between two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a the first operand\n * @param {quat} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n * @function\n */\nexport const lerp = vec4.lerp;\n\n/**\n * Calculates the length of a quat\n *\n * @param {quat} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport const length = vec4.length;\n\n/**\n * Alias for {@link quat.length}\n * @function\n */\nexport const len = length;\n\n/**\n * Calculates the squared length of a quat\n *\n * @param {quat} a vector to calculate squared length of\n * @returns {Number} squared length of a\n * @function\n */\nexport const squaredLength = vec4.squaredLength;\n\n/**\n * Alias for {@link quat.squaredLength}\n * @function\n */\nexport const sqrLen = squaredLength;\n\n/**\n * Normalize a quat\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a quaternion to normalize\n * @returns {quat} out\n * @function\n */\nexport const normalize = vec4.normalize;\n\n/**\n * Returns whether or not the quaternions have exactly the same elements in the same position (when compared with ===)\n *\n * @param {quat} a The first quaternion.\n * @param {quat} b The second quaternion.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport const exactEquals = vec4.exactEquals;\n\n/**\n * Returns whether or not the quaternions have approximately the same elements in the same position.\n *\n * @param {quat} a The first vector.\n * @param {quat} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport const equals = vec4.equals;\n\n/**\n * Sets a quaternion to represent the shortest rotation from one\n * vector to another.\n *\n * Both vectors are assumed to be unit length.\n *\n * @param {quat} out the receiving quaternion.\n * @param {vec3} a the initial vector\n * @param {vec3} b the destination vector\n * @returns {quat} out\n */\nexport const rotationTo = (function() {\n  let tmpvec3 = vec3.create();\n  let xUnitVec3 = vec3.fromValues(1,0,0);\n  let yUnitVec3 = vec3.fromValues(0,1,0);\n\n  return function(out, a, b) {\n    let dot = vec3.dot(a, b);\n    if (dot < -0.999999) {\n      vec3.cross(tmpvec3, xUnitVec3, a);\n      if (vec3.len(tmpvec3) < 0.000001)\n        vec3.cross(tmpvec3, yUnitVec3, a);\n      vec3.normalize(tmpvec3, tmpvec3);\n      setAxisAngle(out, tmpvec3, Math.PI);\n      return out;\n    } else if (dot > 0.999999) {\n      out[0] = 0;\n      out[1] = 0;\n      out[2] = 0;\n      out[3] = 1;\n      return out;\n    } else {\n      vec3.cross(tmpvec3, a, b);\n      out[0] = tmpvec3[0];\n      out[1] = tmpvec3[1];\n      out[2] = tmpvec3[2];\n      out[3] = 1 + dot;\n      return normalize(out, out);\n    }\n  };\n})();\n\n/**\n * Performs a spherical linear interpolation with two control points\n *\n * @param {quat} out the receiving quaternion\n * @param {quat} a the first operand\n * @param {quat} b the second operand\n * @param {quat} c the third operand\n * @param {quat} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n */\nexport const sqlerp = (function () {\n  let temp1 = create();\n  let temp2 = create();\n\n  return function (out, a, b, c, d, t) {\n    slerp(temp1, a, d, t);\n    slerp(temp2, b, c, t);\n    slerp(out, temp1, temp2, 2 * t * (1 - t));\n\n    return out;\n  };\n}());\n\n/**\n * Sets the specified quaternion with values corresponding to the given\n * axes. Each axis is a vec3 and is expected to be unit length and\n * perpendicular to all other specified axes.\n *\n * @param {vec3} view  the vector representing the viewing direction\n * @param {vec3} right the vector representing the local \"right\" direction\n * @param {vec3} up    the vector representing the local \"up\" direction\n * @returns {quat} out\n */\nexport const setAxes = (function() {\n  let matr = mat3.create();\n\n  return function(out, view, right, up) {\n    matr[0] = right[0];\n    matr[3] = right[1];\n    matr[6] = right[2];\n\n    matr[1] = up[0];\n    matr[4] = up[1];\n    matr[7] = up[2];\n\n    matr[2] = -view[0];\n    matr[5] = -view[1];\n    matr[8] = -view[2];\n\n    return normalize(out, fromMat3(out, matr));\n  };\n})();\n", "/*\n * Copyright 2019 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4';\nimport * as vec3 from 'gl-matrix/src/gl-matrix/vec3';\nimport * as quat from 'gl-matrix/src/gl-matrix/quat';\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRRigidTransform');\n\nexport default class XRRigidTransform {\n  // no arguments: identity transform\n  // (Float32Array): transform based on matrix\n  // (DOMPointReadOnly): transform based on position without any rotation\n  // (DOMPointReadOnly, DOMPointReadOnly): transform based on position and\n  // orientation quaternion\n  constructor() {\n    this[PRIVATE] = {\n      matrix: null,\n      position: null,\n      orientation: null,\n      inverse: null,\n    };\n\n    if (arguments.length === 0) {\n      this[PRIVATE].matrix = mat4.identity(new Float32Array(16));\n    } else if (arguments.length === 1) {\n      if (arguments[0] instanceof Float32Array) {\n        this[PRIVATE].matrix = arguments[0];\n      } else {\n        this[PRIVATE].position = this._getPoint(arguments[0]);\n        this[PRIVATE].orientation = DOMPointReadOnly.fromPoint({\n            x: 0, y: 0, z: 0, w: 1\n        });\n      }\n    } else if (arguments.length === 2) {\n      this[PRIVATE].position = this._getPoint(arguments[0]);\n      this[PRIVATE].orientation = this._getPoint(arguments[1]);\n    } else {\n      throw new Error(\"Too many arguments!\");\n    }\n\n    if (this[PRIVATE].matrix) {\n        // Decompose matrix into position and orientation.\n        let position = vec3.create();\n        mat4.getTranslation(position, this[PRIVATE].matrix);\n        this[PRIVATE].position = DOMPointReadOnly.fromPoint({\n            x: position[0],\n            y: position[1],\n            z: position[2]\n        });\n\n        let orientation = quat.create();\n        mat4.getRotation(orientation, this[PRIVATE].matrix);\n        this[PRIVATE].orientation = DOMPointReadOnly.fromPoint({\n          x: orientation[0],\n          y: orientation[1],\n          z: orientation[2],\n          w: orientation[3]\n        });\n    } else {\n        // Compose matrix from position and orientation.\n        this[PRIVATE].matrix = mat4.identity(new Float32Array(16));\n        mat4.fromRotationTranslation(\n          this[PRIVATE].matrix,\n          quat.fromValues(\n            this[PRIVATE].orientation.x,\n            this[PRIVATE].orientation.y,\n            this[PRIVATE].orientation.z,\n            this[PRIVATE].orientation.w),\n          vec3.fromValues(\n            this[PRIVATE].position.x,\n            this[PRIVATE].position.y,\n            this[PRIVATE].position.z)\n        );\n    }\n  }\n\n  /**\n   * Try to convert arg to a DOMPointReadOnly if it isn't already one.\n   * @param {*} arg\n   * @return {DOMPointReadOnly}\n   */\n  _getPoint(arg) {\n    if (arg instanceof DOMPointReadOnly) {\n      return arg;\n    }\n\n    return DOMPointReadOnly.fromPoint(arg);\n  }\n\n  /**\n   * @return {Float32Array}\n   */\n  get matrix() { return this[PRIVATE].matrix; }\n\n  /**\n   * @return {DOMPointReadOnly}\n   */\n  get position() { return this[PRIVATE].position; }\n\n  /**\n   * @return {DOMPointReadOnly}\n   */\n  get orientation() { return this[PRIVATE].orientation; }\n\n  /**\n   * @return {XRRigidTransform}\n   */\n  get inverse() {\n    if (this[PRIVATE].inverse === null) {\n      let invMatrix = mat4.identity(new Float32Array(16));\n      mat4.invert(invMatrix, this[PRIVATE].matrix);\n      this[PRIVATE].inverse = new XRRigidTransform(invMatrix);\n      this[PRIVATE].inverse[PRIVATE].inverse = this;\n    }\n\n    return this[PRIVATE].inverse;\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport XRRigidTransform from './XRRigidTransform';\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4';\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRSpace');\n\n// Not exposed, for reference only\nexport const XRSpaceSpecialTypes = [\n  \"grip\",\n  \"target-ray\"\n];\n\nexport default class XRSpace {\n  /**\n   * @param {string?} specialType\n   * @param {XRInputSource?} inputSource \n   */\n  constructor(specialType = null, inputSource = null) {\n    this[PRIVATE] = {\n      specialType,\n      inputSource,\n      // The transform for the space in the base space, along with it's inverse\n      baseMatrix: null,\n      inverseBaseMatrix: null,\n      lastFrameId: -1\n    };\n  }\n\n  /**\n   * @return {string?}\n   */\n  get _specialType() {\n    return this[PRIVATE].specialType;\n  }\n\n  /**\n   * @return {XRInputSource?}\n   */\n  get _inputSource() {\n    return this[PRIVATE].inputSource;\n  }\n\n  /**\n   * NON-STANDARD\n   * Trigger an update for this space's base pose if necessary\n   * @param {XRDevice} device\n   * @param {Number} frameId\n   */\n  _ensurePoseUpdated(device, frameId) {\n    if (frameId == this[PRIVATE].lastFrameId) return;\n    this[PRIVATE].lastFrameId = frameId;\n    this._onPoseUpdate(device);\n  }\n\n  /**\n   * NON-STANDARD\n   * Called when this space's base pose needs to be updated\n   * @param {XRDevice} device\n   */\n  _onPoseUpdate(device) {\n    if (this[PRIVATE].specialType == 'viewer') {\n      this._baseMatrix = device.getBasePoseMatrix();\n    }\n  }\n\n  /**\n   * NON-STANDARD\n   * @param {Float32Array(16)} matrix\n   */\n  set _baseMatrix(matrix) {\n    this[PRIVATE].baseMatrix = matrix;\n    this[PRIVATE].inverseBaseMatrix = null;\n  }\n\n  /**\n   * NON-STANDARD\n   * @return {Float32Array(16)}\n   */\n  get _baseMatrix() {\n    if (!this[PRIVATE].baseMatrix) {\n      if (this[PRIVATE].inverseBaseMatrix) {\n        this[PRIVATE].baseMatrix = new Float32Array(16);\n        mat4.invert(this[PRIVATE].baseMatrix, this[PRIVATE].inverseBaseMatrix);\n      }\n    }\n    return this[PRIVATE].baseMatrix;\n  }\n\n  /**\n   * NON-STANDARD\n   * @param {Float32Array(16)} matrix\n   */\n  set _inverseBaseMatrix(matrix) {\n    this[PRIVATE].inverseBaseMatrix = matrix;\n    this[PRIVATE].baseMatrix = null;\n  }\n\n  /**\n   * NON-STANDARD\n   * @return {Float32Array(16)}\n   */\n  get _inverseBaseMatrix() {\n    if (!this[PRIVATE].inverseBaseMatrix) {\n      if (this[PRIVATE].baseMatrix) {\n        this[PRIVATE].inverseBaseMatrix = new Float32Array(16);\n        mat4.invert(this[PRIVATE].inverseBaseMatrix, this[PRIVATE].baseMatrix);\n      }\n    }\n    return this[PRIVATE].inverseBaseMatrix;\n  }\n\n  /**\n   * NON-STANDARD\n   * Gets the transform of the given space in this space\n   *\n   * @param {XRSpace} space\n   * @return {XRRigidTransform}\n   */\n  _getSpaceRelativeTransform(space) {\n    if (!this._inverseBaseMatrix || !space._baseMatrix) {\n      return null;\n    }\n    let out = new Float32Array(16);\n    mat4.multiply(out, this._inverseBaseMatrix, space._baseMatrix);\n    return new XRRigidTransform(out);\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport XRSpace from './XRSpace';\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4';\n\nconst DEFAULT_EMULATION_HEIGHT = 1.6;\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRReferenceSpace');\n\nexport const XRReferenceSpaceTypes = [\n  'viewer',\n  'local',\n  'local-floor',\n  'bounded-floor',\n  'unbounded' // TODO: 'unbounded' is not supported by the polyfill.\n];\n\n/**\n * @param {string} type \n * @return {boolean}\n */\nfunction isFloor(type) {\n  return type === 'bounded-floor' || type === 'local-floor';\n}\n\nexport default class XRReferenceSpace extends XRSpace {\n  /**\n   * Optionally takes a `transform` from a device's requestFrameOfReferenceMatrix\n   * so device's can provide their own transforms for stage (or if they\n   * wanted to override eye-level/head-model).\n   *\n   * @param {XRReferenceSpaceType} type\n   * @param {Float32Array?} transform\n   */\n  constructor(type, transform = null) {\n    if (!XRReferenceSpaceTypes.includes(type)) {\n      throw new Error(`XRReferenceSpaceType must be one of ${XRReferenceSpaceTypes}`);\n    }\n\n    super(type);\n\n    // If stage emulation is disabled, and this is a stage frame of reference,\n    // and the XRDevice did not provide a transform, this is an invalid\n    // configuration and we shouldn't emulate here. XRSession.requestFrameOfReference\n    // should check this as well.\n    if (type === 'bounded-floor' && !transform) {\n      throw new Error(`XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level`);\n    }\n\n    // If we're using floor-level reference and no transform, we're emulating.\n    // Set emulated height from option or use the default\n    if (isFloor(type) && !transform) {\n      // Apply an emulated height to the `y` translation\n      transform = mat4.identity(new Float32Array(16));\n      transform[13] = DEFAULT_EMULATION_HEIGHT;\n    }\n\n    this._inverseBaseMatrix = transform || mat4.identity(new Float32Array(16));\n\n    this[PRIVATE] = {\n      type,\n      transform,\n      originOffset : mat4.identity(new Float32Array(16)),\n    };\n  }\n\n  /**\n   * NON-STANDARD\n   * Takes a base pose model matrix and transforms it by the\n   * frame of reference.\n   *\n   * @param {Float32Array} out\n   * @param {Float32Array} pose\n   */\n  _transformBasePoseMatrix(out, pose) {\n    mat4.multiply(out, this._inverseBaseMatrix, pose);\n  }\n\n  /**\n   * NON-STANDARD\n   * \n   * @return {Float32Array}\n   */\n  _originOffsetMatrix() {\n    return this[PRIVATE].originOffset;\n  }\n\n  /**\n   * transformMatrix = Inv(OriginOffsetMatrix) * transformMatrix\n   * @param {Float32Array} transformMatrix \n   */\n  _adjustForOriginOffset(transformMatrix) {\n    let inverseOriginOffsetMatrix = new Float32Array(16);\n    mat4.invert(inverseOriginOffsetMatrix, this[PRIVATE].originOffset);\n    mat4.multiply(transformMatrix, inverseOriginOffsetMatrix, transformMatrix);\n  }\n\n  /**\n   * Gets the transform of the given space in this space\n   *\n   * @param {XRSpace} space\n   * @return {XRRigidTransform}\n   */\n  _getSpaceRelativeTransform(space) {\n    let transform = super._getSpaceRelativeTransform(space);\n    // TODO: Optimize away double creation of XRRigidTransform\n    this._adjustForOriginOffset(transform.matrix)\n    return new XRRigidTransform(transform.matrix);\n  }\n\n  /**\n   * Doesn't update the bound geometry for bounded reference spaces.\n   * @param {XRRigidTransform} additionalOffset\n   * @return {XRReferenceSpace}\n  */\n  getOffsetReferenceSpace(additionalOffset) {\n    let newSpace = new XRReferenceSpace(\n      this[PRIVATE].type,\n      this[PRIVATE].transform,\n      this[PRIVATE].bounds);\n\n    mat4.multiply(newSpace[PRIVATE].originOffset, this[PRIVATE].originOffset, additionalOffset.matrix);\n    return newSpace;\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport EventTarget from '../lib/EventTarget';\nimport { XRReferenceSpaceTypes } from './XRReferenceSpace';\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XR');\n\nexport const XRSessionModes = ['inline', 'immersive-vr', 'immersive-ar'];\n\nconst DEFAULT_SESSION_OPTIONS = {\n  'inline': {\n    requiredFeatures: ['viewer'],\n    optionalFeatures: [],\n  },\n  'immersive-vr': {\n    requiredFeatures: ['viewer', 'local'],\n    optionalFeatures: [],\n  },\n  'immersive-ar': {\n    requiredFeatures: ['viewer', 'local'],\n    optionalFeatures: [],\n  }\n};\n\nconst POLYFILL_REQUEST_SESSION_ERROR = \n`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.`\n\nexport default class XRSystem extends EventTarget {\n  /**\n   * Receives a promise of an XRDevice, so that the polyfill\n   * can pass in some initial checks to asynchronously provide XRDevices\n   * if content immediately requests `requestDevice()`.\n   *\n   * @param {Promise<XRDevice>} devicePromise\n   */\n  constructor(devicePromise) {\n    super();\n    this[PRIVATE] = {\n      device: null,\n      devicePromise,\n      immersiveSession: null,\n      inlineSessions: new Set(),\n    };\n\n    devicePromise.then((device) => { this[PRIVATE].device = device; });\n  }\n\n  /**\n   * @param {XRSessionMode} mode\n   * @return {Promise<boolean>}\n   */\n  async isSessionSupported(mode) {\n    // Always ensure that we wait for the device promise to resolve.\n    if (!this[PRIVATE].device) {\n      await this[PRIVATE].devicePromise;\n    }\n\n    // 'inline' is always guaranteed to be supported.\n    if (mode != 'inline') {\n      return Promise.resolve(this[PRIVATE].device.isSessionSupported(mode));\n    } \n\n    return Promise.resolve(true);\n  }\n\n  /**\n   * @param {XRSessionMode} mode\n   * @param {XRSessionInit} options\n   * @return {Promise<XRSession>}\n   */\n  async requestSession(mode, options) {\n    // If the device hasn't resolved yet, wait for it and try again.\n    if (!this[PRIVATE].device) {\n      if (mode != 'inline') {\n        // Because requesting immersive modes requires a user gesture, we can't\n        // wait for a promise to resolve before making the real session request.\n        // For that reason, we'll throw a polyfill-specific error here.\n        throw new Error(POLYFILL_REQUEST_SESSION_ERROR);\n      } else {\n        await this[PRIVATE].devicePromise;\n      }\n    }\n\n    if (!XRSessionModes.includes(mode)) {\n      throw new TypeError(\n          `The provided value '${mode}' is not a valid enum value of type XRSessionMode`);\n    }\n\n    // Resolve which of the requested features are supported and reject if a\n    // required feature isn't available.\n    const defaultOptions = DEFAULT_SESSION_OPTIONS[mode];\n    const requiredFeatures = defaultOptions.requiredFeatures.concat(\n        options && options.requiredFeatures ? options.requiredFeatures : []);\n    const optionalFeatures = defaultOptions.optionalFeatures.concat(\n        options && options.optionalFeatures ? options.optionalFeatures : []);\n    const enabledFeatures = new Set();\n\n    let requirementsFailed = false;\n    for (let feature of requiredFeatures) {\n      if (!this[PRIVATE].device.isFeatureSupported(feature)) {\n        console.error(`The required feature '${feature}' is not supported`);\n        requirementsFailed = true;\n      } else {\n        enabledFeatures.add(feature);\n      }\n    }\n\n    if (requirementsFailed) {\n      throw new DOMException('Session does not support some required features', 'NotSupportedError');\n    }\n\n    for (let feature of optionalFeatures) {\n      if (!this[PRIVATE].device.isFeatureSupported(feature)) {\n        console.log(`The optional feature '${feature}' is not supported`);\n      } else {\n        enabledFeatures.add(feature);\n      }\n    }\n\n    // Call device's requestSession, which does some initialization (1.1 \n    // fallback calls `vrDisplay.requestPresent()` for example). Could throw \n    // due to missing user gesture.\n    const sessionId = await this[PRIVATE].device.requestSession(mode, enabledFeatures);\n    const session = new XRSession(this[PRIVATE].device, mode, sessionId);\n\n    if (mode == 'inline') {\n      this[PRIVATE].inlineSessions.add(session);\n    } else {\n      this[PRIVATE].immersiveSession = session;\n    }\n\n    const onSessionEnd = () => {\n      if (mode == 'inline') {\n        this[PRIVATE].inlineSessions.delete(session);\n      } else {\n        this[PRIVATE].immersiveSession = null;\n      }\n      session.removeEventListener('end', onSessionEnd);\n    };\n    session.addEventListener('end', onSessionEnd);\n\n    return session;\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * A wrapper around `performance.now()` so that we can run unit tests\n * in Node.\n */\n\nimport GLOBAL from './global';\n\nlet now;\nif ('performance' in GLOBAL === false) {\n  let startTime = Date.now();\n  now = () => Date.now() - startTime;\n} else {\n  now = () => performance.now();\n}\n\nexport default now;\n", "/*\n * Copyright 2019 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRPose');\n\nexport default class XRPose {\n  /**\n   * @param {XRRigidTransform} transform \n   * @param {boolean} emulatedPosition \n   */\n  constructor(transform, emulatedPosition) {\n    this[PRIVATE] = {\n      transform,\n      emulatedPosition,\n    };\n  }\n\n  /**\n   * @return {XRRigidTransform}\n   */\n  get transform() { return this[PRIVATE].transform; }\n\n  /**\n   * @return {bool}\n   */\n  get emulatedPosition() { return this[PRIVATE].emulatedPosition; }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport XRPose from './XRPose';\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRViewerPose');\n\nexport default class XRViewerPose extends XRPose {\n  /**\n   * @param {XRDevice} device\n   */\n  constructor(transform, views, emulatedPosition = false) {\n    super(transform, emulatedPosition);\n    this[PRIVATE] = {\n      views\n    };\n  }\n\n  /**\n   * @return {Array<XRView>}\n   */\n  get views() {\n    return this[PRIVATE].views;\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRViewport');\n\nexport default class XRViewport {\n  /**\n   * Takes a proxy object that this viewport's XRView\n   * updates and we serve here to match API.\n   *\n   * @param {Object} target\n   */\n  constructor(target) {\n    this[PRIVATE] = { target };\n  }\n\n  /**\n   * @return {number}\n   */\n  get x() { return this[PRIVATE].target.x; }\n\n  /**\n   * @return {number}\n   */\n  get y() { return this[PRIVATE].target.y; }\n\n  /**\n   * @return {number}\n   */\n  get width() { return this[PRIVATE].target.width; }\n\n  /**\n   * @return {number}\n   */\n  get height() { return this[PRIVATE].target.height; }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4';\n\nimport XRViewport from './XRViewport';\nimport XRRigidTransform from './XRRigidTransform';\n\nconst XREyes = ['left', 'right', 'none'];\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRView');\n\nexport default class XRView {\n  /**\n   * @param {XRDevice} device\n   * @param {XREye} eye\n   * @param {number} sessionId\n   */\n  constructor(device, transform, eye, sessionId) {\n    if (!XREyes.includes(eye)) {\n      throw new Error(`XREye must be one of: ${XREyes}`);\n    }\n\n    // Create a shared object that can be updated by other code\n    // that can update XRViewport values to adhere to API.\n    // Ugly but it works.\n    const temp = Object.create(null);\n    const viewport = new XRViewport(temp);\n\n    this[PRIVATE] = {\n      device,\n      eye,\n      viewport,\n      temp,\n      sessionId,\n      transform,\n    };\n  }\n\n  /**\n   * @return {XREye}\n   */\n  get eye() { return this[PRIVATE].eye; }\n\n  /**\n   * @return {Float32Array}\n   */\n  get projectionMatrix() { return this[PRIVATE].device.getProjectionMatrix(this.eye); }\n\n  /**\n   * @return {XRRigidTransform}\n   */\n  get transform() { return this[PRIVATE].transform; }\n\n  /**\n   * NON-STANDARD\n   *\n   * `getViewport` is now exposed via XRWebGLLayer instead of XRView.\n   * XRWebGLLayer delegates all the actual work to this function.\n   *\n   * @param {XRWebGLLayer} layer\n   * @return {XRViewport?}\n   */\n  _getViewport(layer) {\n    if (this[PRIVATE].device.getViewport(this[PRIVATE].sessionId,\n                                           this.eye,\n                                           layer,\n                                           this[PRIVATE].temp)) {\n      return this[PRIVATE].viewport;\n    }\n    return undefined;\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {PRIVATE as SESSION_PRIVATE} from './XRSession';\nimport XRViewerPose from './XRViewerPose';\nimport XRView from './XRView';\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRFrame');\n\nconst NON_ACTIVE_MSG = \"XRFrame access outside the callback that produced it is invalid.\";\nconst NON_ANIMFRAME_MSG = \"getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.\";\n\nlet NEXT_FRAME_ID = 0;\n\nexport default class XRFrame {\n  /**\n   * @param {XRDevice} device\n   * @param {XRSession} session\n   * @param {number} sessionId\n   */\n  constructor(device, session, sessionId) {\n    this[PRIVATE] = {\n      id: ++NEXT_FRAME_ID,\n      active: false,\n      animationFrame: false,\n      device,\n      session,\n      sessionId\n    };\n  }\n\n  /**\n   * @return {XRSession} session\n   */\n  get session() { return this[PRIVATE].session; }\n\n  /**\n   * @param {XRReferenceSpace} referenceSpace\n   * @return {XRViewerPose?}\n   */\n  getViewerPose(referenceSpace) {\n    if (!this[PRIVATE].animationFrame) {\n      throw new DOMException(NON_ANIMFRAME_MSG, 'InvalidStateError');\n    }\n    if (!this[PRIVATE].active) {\n      throw new DOMException(NON_ACTIVE_MSG, 'InvalidStateError');\n    }\n\n    const device = this[PRIVATE].device;\n    const session = this[PRIVATE].session;\n\n    session[SESSION_PRIVATE].viewerSpace._ensurePoseUpdated(device, this[PRIVATE].id);\n    referenceSpace._ensurePoseUpdated(device, this[PRIVATE].id);\n\n    let viewerTransform = referenceSpace._getSpaceRelativeTransform(session[SESSION_PRIVATE].viewerSpace);\n\n    const views = [];\n    for (let viewSpace of session[SESSION_PRIVATE].viewSpaces) {\n      viewSpace._ensurePoseUpdated(device, this[PRIVATE].id);\n      let viewTransform = referenceSpace._getSpaceRelativeTransform(viewSpace);\n      let view = new XRView(device, viewTransform, viewSpace.eye, this[PRIVATE].sessionId);\n      views.push(view);\n    }\n    let viewerPose = new XRViewerPose(viewerTransform, views, false /* TODO: emulatedPosition */);\n\n    return viewerPose;\n  }\n\n  /**\n   * @param {XRSpace} space\n   * @param {XRSpace} baseSpace\n   * @return {XRPose?} pose\n   */\n  getPose(space, baseSpace) {\n    if (!this[PRIVATE].active) {\n      throw new DOMException(NON_ACTIVE_MSG, 'InvalidStateError');\n    }\n\n    const device = this[PRIVATE].device;\n    if (space._specialType === \"target-ray\" || space._specialType === \"grip\") {\n      // TODO: Stop special-casing input.\n      return device.getInputPose(\n        space._inputSource, baseSpace, space._specialType);\n    } else {\n      space._ensurePoseUpdated(device, this[PRIVATE].id);\n      baseSpace._ensurePoseUpdated(device, this[PRIVATE].id);\n      let transform = baseSpace._getSpaceRelativeTransform(space);\n      if (!transform) { return null; }\n      return new XRPose(transform, false /* TODO: emulatedPosition */);\n    }\n\n    return null;\n  }\n}\n", "/*\n * Copyright 2019 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRRenderState');\n\nexport const XRRenderStateInit = Object.freeze({\n  depthNear: 0.1,\n  depthFar: 1000.0,\n  inlineVerticalFieldOfView: null,\n  baseLayer: null\n});\n\nexport default class XRRenderState {\n  /**\n   * @param {Object?} stateInit\n   */\n  constructor(stateInit = {}) {\n    const config = Object.assign({}, XRRenderStateInit, stateInit);\n    this[PRIVATE] = { config };\n  }\n\n  /**\n   * @return {number}\n   */\n  get depthNear() { return this[PRIVATE].config.depthNear; }\n\n  /**\n   * @return {number}\n   */\n  get depthFar() { return this[PRIVATE].config.depthFar; }\n\n  /**\n   * @return {number?}\n   */\n  get inlineVerticalFieldOfView() { return this[PRIVATE].config.inlineVerticalFieldOfView; }\n\n  /**\n   * @return {XRWebGLLayer}\n   */\n  get baseLayer() { return this[PRIVATE].config.baseLayer; }\n}\n", "/*\r\n * Copyright 2017 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * Token for storing whether or not a WebGLRenderingContext has\r\n * a polyfill for `xrCompatible`/`makeXRCompatible()`\r\n */\r\nexport const POLYFILLED_XR_COMPATIBLE = Symbol('@@webxr-polyfill/polyfilled-xr-compatible');\r\n\r\n/**\r\n * Token for storing the XR compatible boolean set on a WebGLRenderingContext\r\n * via `gl.makeXRCompatible()` or via creation\r\n * parameters like `canvas.getContext('webgl', { xrCompatible })`\r\n */\r\nexport const XR_COMPATIBLE = Symbol('@@webxr-polyfill/xr-compatible');\r\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport XRSession, { PRIVATE as SESSION_PRIVATE } from './XRSession';\nimport {\n  POLYFILLED_XR_COMPATIBLE,\n  XR_COMPATIBLE,\n} from '../constants';\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRWebGLLayer');\n\nexport const XRWebGLLayerInit = Object.freeze({\n  antialias: true,\n  depth: false,\n  stencil: false,\n  alpha: true,\n  multiview: false,\n  ignoreDepthValues: false,\n  framebufferScaleFactor: 1.0,\n});\n\nexport default class XRWebGLLayer {\n  /**\n   * @param {XRSession} session \n   * @param {XRWebGLRenderingContext} context \n   * @param {Object?} layerInit \n   */\n  constructor(session, context, layerInit={}) {\n    const config = Object.assign({}, XRWebGLLayerInit, layerInit);\n\n    if (!(session instanceof XRSession)) {\n      throw new Error('session must be a XRSession');\n    }\n\n    if (session.ended) {\n      throw new Error(`InvalidStateError`);\n    }\n\n    // Since we're polyfilling, we're probably polyfilling\n    // the compatible XR device bit as well. It'd be\n    // unusual for this bit to not be polyfilled.\n    if (context[POLYFILLED_XR_COMPATIBLE]) {\n      if (context[XR_COMPATIBLE] !== true) {\n        throw new Error(`InvalidStateError`);\n      }\n    }\n\n    // Use the default framebuffer\n    const framebuffer = context.getParameter(context.FRAMEBUFFER_BINDING);\n\n    this[PRIVATE] = {\n      context,\n      config,\n      framebuffer,\n      session,\n    };\n  }\n\n  /**\n   * @return {WebGLRenderingContext}\n   */\n  get context() { return this[PRIVATE].context; }\n\n  /**\n   * @return {boolean}\n   */\n  get antialias() { return this[PRIVATE].config.antialias; }\n\n  /**\n   * The polyfill will always ignore depth values.\n   *\n   * @return {boolean}\n   */\n  get ignoreDepthValues() { return true; }\n\n  /**\n   * @return {WebGLFramebuffer}\n   */\n  get framebuffer() { return this[PRIVATE].framebuffer; }\n\n  /**\n   * @return {number}\n   */\n  get framebufferWidth() { return this[PRIVATE].context.drawingBufferWidth; }\n\n  /**\n   * @return {number}\n   */\n  get framebufferHeight() { return this[PRIVATE].context.drawingBufferHeight; }\n\n  /**\n   * @return {XRSession}\n   */\n  get _session() { return this[PRIVATE].session; }\n\n  /**\n   * @TODO No mention in spec on not reusing the XRViewport on every frame.\n   * \n   * @TODO In the future maybe all this logic should be handled here instead of\n   * delegated to the XRView?\n   *\n   * @param {XRView} view\n   * @return {XRViewport?}\n   */\n  getViewport(view) {\n    return view._getViewport(this);\n  }\n\n  /**\n   * Gets the scale factor to be requested if you want to match the device\n   * resolution at the center of the user's vision. The polyfill will always\n   * report 1.0.\n   * \n   * @param {XRSession} session \n   * @return {number}\n   */\n  static getNativeFramebufferScaleFactor(session) {\n    if (!session) {\n      throw new TypeError('getNativeFramebufferScaleFactor must be passed a session.')\n    }\n\n    if (session[SESSION_PRIVATE].ended) { return 0.0; }\n\n    return 1.0;\n  }\n}\n", "/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRInputSourceEvent');\n\nexport default class XRInputSourceEvent extends Event {\n  /**\n   * @param {string} type\n   * @param {Object} eventInitDict\n   */\n  constructor(type, eventInitDict) {\n    super(type, eventInitDict);\n    this[PRIVATE] = {\n      frame: eventInitDict.frame,\n      inputSource: eventInitDict.inputSource\n    };\n    // safari bug:  super() seems to return object of type Event, with Event as prototype\n    Object.setPrototypeOf(this, XRInputSourceEvent.prototype);\n  }\n\n  /**\n   * @return {XRFrame}\n   */\n  get frame() { return this[PRIVATE].frame; }\n\n  /**\n   * @return {XRInputSource}\n   */\n  get inputSource() { return this[PRIVATE].inputSource; }\n}", "/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRSessionEvent');\n\nexport default class XRSessionEvent extends Event {\n  /**\n   * @param {string} type\n   * @param {Object} eventInitDict\n   */\n  constructor(type, eventInitDict) {\n    super(type, eventInitDict);\n    this[PRIVATE] = {\n      session: eventInitDict.session\n    };\n    // safari bug:  super() seems to return object of type Event, with Event as prototype\n    Object.setPrototypeOf(this, XRSessionEvent.prototype);\n  }\n\n  /**\n   * @return {XRSession}\n   */\n  get session() { return this[PRIVATE].session; }\n}", "/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRInputSourcesChangeEvent');\n\nexport default class XRInputSourcesChangeEvent extends Event {\n  /**\n   * @param {string} type\n   * @param {Object} eventInitDict\n   */\n  constructor(type, eventInitDict) {\n    super(type, eventInitDict);\n    this[PRIVATE] = {\n      session: eventInitDict.session,\n      added: eventInitDict.added,\n      removed: eventInitDict.removed\n    };\n    // safari bug:  super() seems to return object of type Event, with Event as prototype\n    Object.setPrototypeOf(this, XRInputSourcesChangeEvent.prototype);\n  }\n\n  /**\n   * @return {XRSession}\n   */\n  get session() { return this[PRIVATE].session; }\n\n  /**\n   * @return {Array<XRInputSource>}\n   */\n  get added() { return this[PRIVATE].added; }\n\n  /**\n   * @return {Array<XRInputSource>}\n   */\n  get removed() { return this[PRIVATE].removed; }\n}", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport EventTarget from '../lib/EventTarget';\nimport now from '../lib/now';\nimport XRFrame, {PRIVATE as XRFRAME_PRIVATE} from './XRFrame';\nimport XRReferenceSpace, {\n  XRReferenceSpaceTypes\n} from './XRReferenceSpace';\nimport XRRenderState from './XRRenderState';\nimport XRWebGLLayer from './XRWebGLLayer';\nimport XRInputSourceEvent from './XRInputSourceEvent';\nimport XRSessionEvent from './XRSessionEvent';\nimport XRSpace from './XRSpace';\nimport XRInputSourcesChangeEvent from './XRInputSourcesChangeEvent';\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRSession');\n\n// Nonstandard helper class. Not exposed by the API anywhere.\nclass XRViewSpace extends XRSpace {\n  constructor(eye) {\n    super(eye);\n  }\n\n  get eye() {\n    return this._specialType;\n  }\n\n  /**\n   * Called when this space's base pose needs to be updated\n   * @param {XRDevice} device\n   */\n  _onPoseUpdate(device) {\n    this._inverseBaseMatrix = device.getBaseViewMatrix(this._specialType);\n  }\n}\n\nexport default class XRSession extends EventTarget {\n  /**\n   * @param {XRDevice} device\n   * @param {XRSessionMode} mode\n   * @param {number} id\n   */\n  constructor(device, mode, id) {\n    super();\n\n    let immersive = mode != 'inline';\n\n    // inlineVerticalFieldOfView must initialize to PI/2 for inline sessions.\n    let initialRenderState = new XRRenderState({\n      inlineVerticalFieldOfView: immersive ? null : Math.PI * 0.5\n    });\n\n    this[PRIVATE] = {\n      device,\n      mode,\n      immersive,\n      ended: false,\n      suspended: false,\n      frameCallbacks: [],\n      currentFrameCallbacks: null,\n      frameHandle: 0,\n      deviceFrameHandle: null,\n      id,\n      activeRenderState: initialRenderState,\n      pendingRenderState: null,\n      viewerSpace: new XRReferenceSpace(\"viewer\"),\n      viewSpaces: [],\n      currentInputSources: []\n    };\n\n    if (immersive) {\n      this[PRIVATE].viewSpaces.push(new XRViewSpace('left'),\n                                    new XRViewSpace('right'));\n    } else {\n      this[PRIVATE].viewSpaces.push(new XRViewSpace('none'));\n    }\n\n    // Single handler for animation frames from the device. The spec says this must\n    // run on every candidate frame even if there are no callbacks queued up.\n    this[PRIVATE].onDeviceFrame = () => {\n      if (this[PRIVATE].ended || this[PRIVATE].suspended) {\n        return;\n      }\n\n      // Queue next frame\n      this[PRIVATE].deviceFrameHandle = null;\n      this[PRIVATE].startDeviceFrameLoop();\n\n      // - If session\u2019s pending render state is not null, apply the pending render state.\n      if (this[PRIVATE].pendingRenderState !== null) {\n        // Apply pending render state.\n        this[PRIVATE].activeRenderState = new XRRenderState(this[PRIVATE].pendingRenderState);\n        this[PRIVATE].pendingRenderState = null;\n\n        // Report to the device since it'll need to handle the layer for rendering.\n        if (this[PRIVATE].activeRenderState.baseLayer) {\n          this[PRIVATE].device.onBaseLayerSet(\n            this[PRIVATE].id,\n            this[PRIVATE].activeRenderState.baseLayer);\n        }\n      }\n\n      // - If session\u2019s renderState's baseLayer is null, abort these steps.\n      if (this[PRIVATE].activeRenderState.baseLayer === null) {\n        return;\n      }\n\n      // - If session\u2019s mode is \"inline\" and session\u2019s renderState's output canvas is null,\n      //   abort these steps.\n      // ???\n\n      const frame = new XRFrame(device, this, this[PRIVATE].id);\n\n      // - Let callbacks be a list of the entries in session\u2019s list of animation frame\n      //   callback, in the order in which they were added to the list.\n      const callbacks = this[PRIVATE].currentFrameCallbacks = this[PRIVATE].frameCallbacks;\n\n      // - Set session\u2019s list of animation frame callbacks to the empty list.\n      this[PRIVATE].frameCallbacks = [];\n\n      // - Set frame\u2019s active boolean to true.\n      frame[XRFRAME_PRIVATE].active = true;\n\n      // - Set frame\u2019s animationFrame boolean to true.\n      frame[XRFRAME_PRIVATE].animationFrame = true;\n\n      this[PRIVATE].device.onFrameStart(this[PRIVATE].id, this[PRIVATE].activeRenderState);\n      // inputSources can be populated in .onFrameStart()\n      // so check the change and fire inputsourceschange event if needed\n      this._checkInputSourcesChange();\n\n      // - For each entry in callbacks, in order:\n      //   - If the entry\u2019s cancelled boolean is true, continue to the next entry.\n      //   - Invoke the Web IDL callback function, passing now and frame as the arguments\n      //   - If an exception is thrown, report the exception.\n      const rightNow = now(); //should we get this from arguments?\n      for (let i = 0; i < callbacks.length; i++) {\n        try {\n          if (!callbacks[i].cancelled && typeof callbacks[i].callback === 'function') {\n            callbacks[i].callback(rightNow, frame);\n          }\n        } catch(err) {\n          console.error(err);\n        }\n      }\n      this[PRIVATE].currentFrameCallbacks = null;\n\n      // - Set frame\u2019s active boolean to false.\n      frame[XRFRAME_PRIVATE].active = false;\n\n      this[PRIVATE].device.onFrameEnd(this[PRIVATE].id);\n    };\n\n    this[PRIVATE].startDeviceFrameLoop = () => {\n      if (this[PRIVATE].deviceFrameHandle === null) {\n        this[PRIVATE].deviceFrameHandle = this[PRIVATE].device.requestAnimationFrame(\n          this[PRIVATE].onDeviceFrame\n        );\n      }\n    };\n\n    this[PRIVATE].stopDeviceFrameLoop = () => {\n      const handle = this[PRIVATE].deviceFrameHandle;\n      if (handle !== null) {\n        this[PRIVATE].device.cancelAnimationFrame(handle);\n        this[PRIVATE].deviceFrameHandle = null;\n      }\n    };\n\n    // Hook into the XRDisplay's `vr-present-end` event so we can\n    // wrap up things here if we're cut off from the underlying\n    // polyfilled device or explicitly ended via `session.end()` for this\n    // session.\n    this[PRIVATE].onPresentationEnd = sessionId => {\n      // If this session was suspended, resume it now that an immersive\n      // session has ended.\n      if (sessionId !== this[PRIVATE].id) {\n        this[PRIVATE].suspended = false;\n        this[PRIVATE].startDeviceFrameLoop();\n        this.dispatchEvent('focus', { session: this });\n        return;\n      }\n\n      // Otherwise, this is the immersive session that has ended.\n      // Set `ended` to true so we can disable all functionality\n      // in this XRSession\n      this[PRIVATE].ended = true;\n      this[PRIVATE].stopDeviceFrameLoop();\n      device.removeEventListener('@@webxr-polyfill/vr-present-end', this[PRIVATE].onPresentationEnd);\n      device.removeEventListener('@@webxr-polyfill/vr-present-start', this[PRIVATE].onPresentationStart);\n      device.removeEventListener('@@webxr-polyfill/input-select-start', this[PRIVATE].onSelectStart);\n      device.removeEventListener('@@webxr-polyfill/input-select-end', this[PRIVATE].onSelectEnd);\n      this.dispatchEvent('end', new XRSessionEvent('end', { session: this }));\n    };\n    device.addEventListener('@@webxr-polyfill/vr-present-end', this[PRIVATE].onPresentationEnd);\n\n    // Hook into the XRDisplay's `vr-present-start` event so we can\n    // suspend if another session has begun immersive presentation.\n    this[PRIVATE].onPresentationStart = sessionId => {\n      // Ignore if this is the session that has begun immersive presenting\n      if (sessionId === this[PRIVATE].id) {\n        return;\n      }\n\n      this[PRIVATE].suspended = true;\n      this[PRIVATE].stopDeviceFrameLoop();\n      this.dispatchEvent('blur', { session: this });\n    };\n    device.addEventListener('@@webxr-polyfill/vr-present-start', this[PRIVATE].onPresentationStart);\n\n    this[PRIVATE].onSelectStart = evt => {\n      // Ignore if this event is not for this session.\n      if (evt.sessionId !== this[PRIVATE].id) {\n        return;\n      }\n\n      this[PRIVATE].dispatchInputSourceEvent('selectstart',  evt.inputSource);\n    };\n    device.addEventListener('@@webxr-polyfill/input-select-start', this[PRIVATE].onSelectStart);\n\n    this[PRIVATE].onSelectEnd = evt => {\n      // Ignore if this event is not for this session.\n      if (evt.sessionId !== this[PRIVATE].id) {\n        return;\n      }\n\n      this[PRIVATE].dispatchInputSourceEvent('selectend',  evt.inputSource);\n\n      // Sadly, there's no way to make this a user gesture.\n      this[PRIVATE].dispatchInputSourceEvent('select',  evt.inputSource);\n    };\n    device.addEventListener('@@webxr-polyfill/input-select-end', this[PRIVATE].onSelectEnd);\n\n    this[PRIVATE].onSqueezeStart = evt => {\n      // Ignore if this event is not for this session.\n      if (evt.sessionId !== this[PRIVATE].id) {\n        return;\n      }\n\n      this[PRIVATE].dispatchInputSourceEvent('squeezestart',  evt.inputSource);\n    };\n    device.addEventListener('@@webxr-polyfill/input-squeeze-start', this[PRIVATE].onSqueezeStart);\n\n    this[PRIVATE].onSqueezeEnd = evt => {\n      // Ignore if this event is not for this session.\n      if (evt.sessionId !== this[PRIVATE].id) {\n        return;\n      }\n\n      this[PRIVATE].dispatchInputSourceEvent('squeezeend',  evt.inputSource);\n\n      // Following the same way as select event\n      this[PRIVATE].dispatchInputSourceEvent('squeeze',  evt.inputSource);\n    };\n    device.addEventListener('@@webxr-polyfill/input-squeeze-end', this[PRIVATE].onSqueezeEnd);\n\n    this[PRIVATE].dispatchInputSourceEvent = (type, inputSource) => {\n      const frame = new XRFrame(device, this, this[PRIVATE].id);\n      const event = new XRInputSourceEvent(type, { frame, inputSource });\n      frame[XRFRAME_PRIVATE].active = true;\n      this.dispatchEvent(type, event);\n      frame[XRFRAME_PRIVATE].active = false;\n    };\n\n    // Start the frame loop\n    this[PRIVATE].startDeviceFrameLoop();\n\n    this.onblur = undefined;\n    this.onfocus = undefined;\n    this.onresetpose = undefined;\n    this.onend = undefined;\n    this.onselect = undefined;\n    this.onselectstart = undefined;\n    this.onselectend = undefined;\n  }\n\n  /**\n   * @return {XRRenderState}\n   */\n  get renderState() { return this[PRIVATE].activeRenderState; }\n\n  /**\n   * @return {XREnvironmentBlendMode}\n   */\n  get environmentBlendMode() {\n    return this[PRIVATE].device.environmentBlendMode || 'opaque';\n  }\n\n  /**\n   * @param {string} type\n   * @return {XRReferenceSpace}\n   */\n  async requestReferenceSpace(type) {\n    if (this[PRIVATE].ended) {\n      return;\n    }\n\n    if (!XRReferenceSpaceTypes.includes(type)) {\n      throw new TypeError(`XRReferenceSpaceType must be one of ${XRReferenceSpaceTypes}`);\n    }\n\n    if (!this[PRIVATE].device.doesSessionSupportReferenceSpace(this[PRIVATE].id, type)) {\n      throw new DOMException(`The ${type} reference space is not supported by this session.`, 'NotSupportedError');\n    }\n\n    if (type === 'viewer') {\n      return this[PRIVATE].viewerSpace;\n    }\n\n    // Request a transform from the device given the values. If returning a\n    // transform (probably \"local-floor\" or \"bounded-floor\"), use it, and if\n    // undefined, XRReferenceSpace will use a default transform. This call can\n    // throw, rejecting the promise, indicating the device does not support that\n    // frame of reference.\n    let transform = await this[PRIVATE].device.requestFrameOfReferenceTransform(type);\n\n    // TODO: 'bounded-floor' is only blocked because we currently don't report\n    // the bounds geometry correctly.\n    if (type === 'bounded-floor') {\n      if (!transform) {\n        // 'bounded-floor' spaces must have a transform supplied by the device.\n        throw new DOMException(`${type} XRReferenceSpace not supported by this device.`, 'NotSupportedError');\n      }\n      \n      let bounds = this[PRIVATE].device.requestStageBounds();\n      if (!bounds) {\n        // 'bounded-floor' spaces must have bounds geometry.\n        throw new DOMException(`${type} XRReferenceSpace not supported by this device.`, 'NotSupportedError');\n        \n      }\n      // TODO: Create an XRBoundedReferenceSpace with the correct boundaries.\n      throw new DOMException(`The WebXR polyfill does not support the ${type} reference space yet.`, 'NotSupportedError');\n    }\n\n    return new XRReferenceSpace(type, transform);\n  }\n\n  /**\n   * @param {Function} callback\n   * @return {number}\n   */\n  requestAnimationFrame(callback) {\n    if (this[PRIVATE].ended) {\n      return;\n    }\n\n    // Add callback to the queue and return its handle\n    const handle = ++this[PRIVATE].frameHandle;\n    this[PRIVATE].frameCallbacks.push({\n      handle,\n      callback,\n      cancelled: false\n    });\n    return handle;\n  }\n\n  /**\n   * @param {number} handle\n   */\n  cancelAnimationFrame(handle) {\n    // Remove the callback with that handle from the queue\n    let callbacks = this[PRIVATE].frameCallbacks;\n    let index = callbacks.findIndex(d => d && d.handle === handle);\n    if (index > -1) {\n      callbacks[index].cancelled = true;\n      callbacks.splice(index, 1);\n    }\n    // If cancelAnimationFrame is called from within a frame callback, also check\n    // the remaining callbacks for the current frame:\n    callbacks = this[PRIVATE].currentFrameCallbacks;\n    if (callbacks) {\n      index = callbacks.findIndex(d => d && d.handle === handle);\n      if (index > -1) {\n        callbacks[index].cancelled = true;\n        // Rely on cancelled flag only; don't mutate this array while it's being iterated\n      }\n    }\n  }\n\n  /**\n   * @return {Array<XRInputSource>} input sources\n   */\n  get inputSources() {\n    return this[PRIVATE].device.getInputSources();\n  }\n\n  /**\n   * @return {Promise<void>}\n   */\n  async end() {\n    if (this[PRIVATE].ended) {\n      return;\n    }\n\n    // If this is an immersive session, trigger the platform to end, which\n    // will call the `onPresentationEnd` handler, wrapping this up.\n    if (this[PRIVATE].immersive) {\n      this[PRIVATE].ended = true;\n      this[PRIVATE].device.removeEventListener('@@webxr-polyfill/vr-present-start',\n                                                 this[PRIVATE].onPresentationStart);\n      this[PRIVATE].device.removeEventListener('@@webxr-polyfill/vr-present-end',\n                                                 this[PRIVATE].onPresentationEnd);\n      this[PRIVATE].device.removeEventListener('@@webxr-polyfill/input-select-start',\n                                                 this[PRIVATE].onSelectStart);\n      this[PRIVATE].device.removeEventListener('@@webxr-polyfill/input-select-end',\n                                                 this[PRIVATE].onSelectEnd);\n\n      this.dispatchEvent('end', new XRSessionEvent('end', { session: this }));\n    }\n\n    this[PRIVATE].stopDeviceFrameLoop();\n    return this[PRIVATE].device.endSession(this[PRIVATE].id);\n  }\n\n  /**\n   * Queues an update to the active render state to be applied on the next\n   * frame. Unset fields of newState will not be changed.\n   * \n   * @param {XRRenderStateInit?} newState \n   */\n  updateRenderState(newState) {\n    if (this[PRIVATE].ended) {\n      const message = \"Can't call updateRenderState on an XRSession \" +\n                      \"that has already ended.\";\n      throw new Error(message);\n    }\n\n    if (newState.baseLayer && (newState.baseLayer._session !== this)) {\n      const message = \"Called updateRenderState with a base layer that was \" +\n                      \"created by a different session.\";\n      throw new Error(message);\n    }\n\n    const fovSet = (newState.inlineVerticalFieldOfView !== null) &&\n                   (newState.inlineVerticalFieldOfView !== undefined);\n\n    if (fovSet) {\n      if (this[PRIVATE].immersive) {\n        const message = \"inlineVerticalFieldOfView must not be set for an \" +\n                        \"XRRenderState passed to updateRenderState for an \" +\n                        \"immersive session.\";\n        throw new Error(message);\n      } else {\n        // Clamp the inline FoV to a sane range.\n        newState.inlineVerticalFieldOfView = Math.min(\n          3.13, Math.max(0.01, newState.inlineVerticalFieldOfView));\n      }\n    }\n\n    if (this[PRIVATE].pendingRenderState === null) {\n      const activeRenderState = this[PRIVATE].activeRenderState;\n      this[PRIVATE].pendingRenderState = {\n        depthNear: activeRenderState.depthNear,\n        depthFar: activeRenderState.depthFar,\n        inlineVerticalFieldOfView: activeRenderState.inlineVerticalFieldOfView,\n        baseLayer: activeRenderState.baseLayer\n      };\n    }\n    Object.assign(this[PRIVATE].pendingRenderState, newState);\n  }\n\n  /**\n   * Compares the inputSources with the ones in the previous frame.\n   * Fires imputsourceschange event if any added or removed\n   * inputSource is found.\n   */\n  _checkInputSourcesChange() {\n    const added = [];\n    const removed = [];\n    const newInputSources = this.inputSources;\n    const oldInputSources = this[PRIVATE].currentInputSources;\n\n    for (const newInputSource of newInputSources) {\n      if (!oldInputSources.includes(newInputSource)) {\n        added.push(newInputSource);\n      }\n    }\n\n    for (const oldInputSource of oldInputSources) {\n      if (!newInputSources.includes(oldInputSource)) {\n        removed.push(oldInputSource);\n      }\n    }\n\n    if (added.length > 0 || removed.length > 0) {\n      this.dispatchEvent('inputsourceschange', new XRInputSourcesChangeEvent('inputsourceschange', {\n        session: this,\n        added: added,\n        removed: removed\n      }));\n    }\n\n    this[PRIVATE].currentInputSources.length = 0;\n    for (const newInputSource of newInputSources) {\n      this[PRIVATE].currentInputSources.push(newInputSource);\n    }\n  }\n}\n", "/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport XRSpace from './XRSpace';\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRInputSource');\n\nexport default class XRInputSource {\n  /**\n   * @param {GamepadXRInputSource} impl \n   */\n  constructor(impl) {\n    this[PRIVATE] = {\n      impl,\n      gripSpace: new XRSpace(\"grip\", this),\n      targetRaySpace: new XRSpace(\"target-ray\", this)\n    };\n  }\n\n  /**\n   * @return {XRHandedness}\n   */\n  get handedness() { return this[PRIVATE].impl.handedness; }\n\n  /**\n   * @return {XRTargetRayMode}\n   */\n  get targetRayMode() { return this[PRIVATE].impl.targetRayMode; }\n\n  /**\n   * @return {XRSpace}\n   */\n  get gripSpace() {\n    let mode = this[PRIVATE].impl.targetRayMode;\n    if (mode === \"gaze\" || mode === \"screen\") {\n      // grip space must be null for non-trackable input sources\n      return null;\n    }\n    return this[PRIVATE].gripSpace;\n  }\n\n  /**\n   * @return {XRSpace}\n   */\n  get targetRaySpace() { return this[PRIVATE].targetRaySpace; }\n\n  /**\n   * @return {Array<String>}\n   */\n  get profiles() { return this[PRIVATE].impl.profiles; }\n\n  /**\n   * @return {Gamepad}\n   */\n  get gamepad() { return this[PRIVATE].impl.gamepad; }\n}\n", "/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRReferenceSpaceEvent');\n\nexport default class XRReferenceSpaceEvent extends Event {\n  /**\n   * @param {string} type\n   * @param {Object} eventInitDict\n   */\n  constructor(type, eventInitDict) {\n    super(type, eventInitDict);\n    this[PRIVATE] = {\n      referenceSpace: eventInitDict.referenceSpace,\n      transform: eventInitDict.transform || null\n    };\n    // safari bug:  super() seems to return object of type Event, with Event as prototype\n    Object.setPrototypeOf(this, XRReferenceSpaceEvent.prototype);\n  }\n\n  /**\n   * @return {XRFrame}\n   */\n  get referenceSpace() { return this[PRIVATE].referenceSpace; }\n\n  /**\n   * @return {XRInputSource}\n   */\n  get transform() { return this[PRIVATE].transform; }\n}", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport XRSystem from './XRSystem';\nimport XRSession from './XRSession';\nimport XRSessionEvent from './XRSessionEvent';\nimport XRFrame from './XRFrame';\nimport XRView from './XRView';\nimport XRViewport from './XRViewport';\nimport XRViewerPose from './XRViewerPose';\nimport XRInputSource from './XRInputSource';\nimport XRInputSourceEvent from './XRInputSourceEvent';\nimport XRInputSourcesChangeEvent from './XRInputSourcesChangeEvent';\nimport XRWebGLLayer from './XRWebGLLayer';\nimport XRSpace from './XRSpace';\nimport XRReferenceSpace from './XRReferenceSpace';\nimport XRReferenceSpaceEvent from './XRReferenceSpaceEvent';\nimport XRRenderState from './XRRenderState';\nimport XRRigidTransform from './XRRigidTransform';\nimport XRPose from './XRPose';\n\n/**\n * Everything exposed here will also be attached to the window\n */\nexport default {\n  XRSystem,\n  XRSession,\n  XRSessionEvent,\n  XRFrame,\n  XRView,\n  XRViewport,\n  XRViewerPose,\n  XRWebGLLayer,\n  XRSpace,\n  XRReferenceSpace,\n  XRReferenceSpaceEvent,\n  XRInputSource,\n  XRInputSourceEvent,\n  XRInputSourcesChangeEvent,\n  XRRenderState,\n  XRRigidTransform,\n  XRPose,\n};\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  POLYFILLED_XR_COMPATIBLE,\n  XR_COMPATIBLE,\n} from './constants';\n\nconst contextTypes = ['webgl', 'experimental-webgl'];\n\n/**\n * Takes the WebGLRenderingContext constructor\n * and creates a `makeXRCompatible` function if it does not exist.\n * Returns a boolean indicating whether or not the function\n * was polyfilled.\n *\n * @param {WebGLRenderingContext}\n * @return {boolean}\n */\nexport const polyfillMakeXRCompatible = Context => {\n  if (typeof Context.prototype.makeXRCompatible === 'function') {\n    return false;\n  }\n\n  // Create `makeXRCompatible` and if successful, store\n  // the XRDevice as a private attribute for error checking\n  Context.prototype.makeXRCompatible = function () {\n    this[XR_COMPATIBLE] = true;\n    // This is all fake, so just resolve immediately.\n    return Promise.resolve();\n  };\n\n  return true;\n};\n\n\n/**\n * Takes the HTMLCanvasElement or OffscreenCanvas constructor\n * and wraps its `getContext` function to patch the context with a\n * POLYFILLED_XR_COMPATIBLE bit so the API knows it's also working with a\n * polyfilled `xrCompatible` bit. Can do extra checking for validity.\n *\n * @param {HTMLCanvasElement} Canvas\n */\nexport const polyfillGetContext = (Canvas) => {\n  const getContext = Canvas.prototype.getContext;\n  Canvas.prototype.getContext = function (contextType, glAttribs) {\n    const ctx = getContext.call(this, contextType, glAttribs);\n\n    if (ctx) {\n      // Set this bit so the API knows the WebGLRenderingContext is\n      // also polyfilled a bit\n      ctx[POLYFILLED_XR_COMPATIBLE] = true;\n\n      // If we've polyfilled WebGLRenderingContext's xrCompatible\n      // bit, store the boolean in the private token if created via\n      // creation parameters\n      if (glAttribs && ('xrCompatible' in glAttribs)) {\n        ctx[XR_COMPATIBLE] = glAttribs.xrCompatible;\n      }\n    }\n\n    return ctx;\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Whether or an ImageBitMapRenderingContext should be used to polyfill\n * an XRPresentationContext.\n *\n * @return {Boolean}\n */\nexport const isImageBitmapSupported = global =>\n  !!(global.ImageBitmapRenderingContext &&\n     global.createImageBitmap);\n\n/**\n * Determines whether or not this global's user agent is\n * considered a mobile device. Taken from webvr-polyfill.\n *\n * @param {Object} global\n */\nexport const isMobile = global => {\n  var check = false;\n  (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4)))check = true})(global.navigator.userAgent||global.navigator.vendor||global.opera);\n  return check;\n};\n\nexport const applyCanvasStylesForMinimalRendering = canvas => {\n  canvas.style.display = 'block';\n  canvas.style.position = 'absolute';\n  canvas.style.width = canvas.style.height = '1px';\n  canvas.style.top = canvas.style.left = '0px';\n};\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport CardboardVRDisplay from 'cardboard-vr-display';\nimport WebVRDevice from './WebVRDevice';\n\nexport default class CardboardXRDevice extends WebVRDevice {\n  /**\n   * Takes a VRDisplay instance and a VRFrameData\n   * constructor from the WebVR 1.1 spec.\n   *\n   * @param {VRDisplay} display\n   * @param {Object?} cardboardConfig\n   */\n  constructor(global, cardboardConfig) {\n    const display = new CardboardVRDisplay(cardboardConfig || {});\n    super(global, display);\n\n    this.display = display;\n    this.frame = {\n      rightViewMatrix: new Float32Array(16),\n      leftViewMatrix: new Float32Array(16),\n      rightProjectionMatrix: new Float32Array(16),\n      leftProjectionMatrix: new Float32Array(16),\n      pose: null,\n      timestamp: null,\n    };\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport EventTarget from '../lib/EventTarget';\nimport XRReferenceSpace from '../api/XRReferenceSpace';\n\nexport default class XRDevice extends EventTarget {\n  /**\n   * Takes a VRDisplay object from the WebVR 1.1 spec.\n   *\n   * @param {Object} global\n   */\n  constructor(global) {\n    super();\n\n    this.global = global;\n    this.onWindowResize = this.onWindowResize.bind(this);\n\n    this.global.window.addEventListener('resize', this.onWindowResize);\n\n    // Value is used for `XRSession.prototype.environmentBlendMode`\n    // and should be one of XREnvironmentBlendMode types: 'opaque', 'additive',\n    // or 'alpha-blend'.\n    this.environmentBlendMode = 'opaque';\n  }\n\n  /**\n   * Called when a XRSession has a `baseLayer` property set.\n   *\n   * @param {number} sessionId\n   * @param {XRWebGLLayer} layer\n   */\n  onBaseLayerSet(sessionId, layer) { throw new Error('Not implemented'); }\n\n  /**\n   * @param {XRSessionMode} mode\n   * @return {boolean}\n   */\n  isSessionSupported(mode) { throw new Error('Not implemented'); }\n\n  /**\n   * @param {string} featureDescriptor\n   * @return {boolean}\n   */\n  isFeatureSupported(featureDescriptor) { throw new Error('Not implemented'); }\n\n  /**\n   * Returns a promise if creating a session is successful.\n   * Usually used to set up presentation in the device.\n   *\n   * @param {XRSessionMode} mode\n   * @param {Set<string>} enabledFeatures\n   * @return {Promise<number>}\n   */\n  async requestSession(mode, enabledFeatures) { throw new Error('Not implemented'); }\n\n  /**\n   * @return {Function}\n   */\n  requestAnimationFrame(callback) { throw new Error('Not implemented'); }\n\n  /**\n   * @param {number} sessionId\n   */\n  onFrameStart(sessionId) { throw new Error('Not implemented'); }\n\n  /**\n   * @param {number} sessionId\n   */\n  onFrameEnd(sessionId) { throw new Error('Not implemented'); }\n\n  /**\n   * @param {number} sessionId\n   * @param {XRReferenceSpaceType} type\n   * @return {boolean}\n   */\n  doesSessionSupportReferenceSpace(sessionId, type) { throw new Error('Not implemented'); }\n\n  /**\n   * @return {Object?}\n   */\n  requestStageBounds() { throw new Error('Not implemented'); }\n\n  /**\n   * Returns a promise resolving to a transform if XRDevice\n   * can support frame of reference and provides its own values.\n   * Can resolve to `undefined` if the polyfilled API can provide\n   * a default. Rejects if this XRDevice cannot\n   * support the frame of reference.\n   *\n   * @param {XRFrameOfReferenceType} type\n   * @param {XRFrameOfReferenceOptions} options\n   * @return {Promise<XRFrameOfReference>}\n   */\n  async requestFrameOfReferenceTransform(type, options) {\n    return undefined;\n  }\n\n  /**\n   * @param {number} handle\n   */\n  cancelAnimationFrame(handle) { throw new Error('Not implemented'); }\n\n  /**\n   * @param {number} sessionId\n   */\n  endSession(sessionId) { throw new Error('Not implemented'); }\n\n  /**\n   * Takes a XREye and a target to apply properties of\n   * `x`, `y`, `width` and `height` on. Returns a boolean\n   * indicating if it successfully was able to populate\n   * target's values.\n   *\n   * @param {number} sessionId\n   * @param {XREye} eye\n   * @param {XRWebGLLayer} layer\n   * @param {Object?} target\n   * @return {boolean}\n   */\n  getViewport(sessionId, eye, layer, target) { throw new Error('Not implemented'); }\n\n  /**\n   * @param {XREye} eye\n   * @return {Float32Array}\n   */\n  getProjectionMatrix(eye) { throw new Error('Not implemented'); }\n\n  /**\n   * Get model matrix unaffected by frame of reference.\n   *\n   * @return {Float32Array}\n   */\n  getBasePoseMatrix() { throw new Error('Not implemented'); }\n\n  /**\n   * Get view matrix unaffected by frame of reference.\n   *\n   * @param {XREye} eye\n   * @return {Float32Array}\n   */\n  getBaseViewMatrix(eye) { throw new Error('Not implemented'); }\n\n  /**\n   * Get a list of input sources.\n   *\n   * @return {Array<XRInputSource>}\n   */\n  getInputSources() { throw new Error('Not implemented'); }\n\n  /**\n   * Get the current pose of an input source.\n   *\n   * @param {XRInputSource} inputSource\n   * @param {XRCoordinateSystem} coordinateSystem\n   * @param {String} poseType\n   * @return {XRPose}\n   */\n  getInputPose(inputSource, coordinateSystem, poseType) { throw new Error('Not implemented'); }\n\n  /**\n   * Called on window resize.\n   */\n  onWindowResize() {\n    // Bound by XRDevice and called on resize, but\n    // this will call child class onWindowResize (or, if not defined,\n    // call an infinite loop I guess)\n    this.onWindowResize();\n  }\n}\n", "/*\n * Copyright 2019 Immersive Web Community Group. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/*\nExample Gamepad mapping. Any of the values may be omitted for the original\ngamepad values to pass through unchanged.\n\n\"Gamepad ID String\": { // The Gamepad.id that this entry maps to.\n  mapping: 'xr-standard', // Overrides the Gamepad.mapping that is reported\n  profiles: ['gamepad-id-string'], // The profiles array that should be reported\n  displayProfiles: {\n    // Alternative profiles arrays to report if the VRDevice.displayName matches\n    \"WebVR Display Name\": ['gamepad-id-string']\n  },\n  axes: { // Remaps the reported axes\n    length: 2, // Overrides the length of the reported axes array\n    invert: [0] // List of mapped axes who's value should be inverted\n    0: 2, // Remaps axes[0] to report axis[2] from the original gamepad object\n    1: null, // Remaps axes[1] to a placeholder axis (always reports 0)\n  },\n  buttons: { // Remaps the reported buttons\n    length: 2, // Overrides the length of the reported buttons array\n    0: 2, // Remaps buttons[0] to report buttons[2] from the original gamepad object\n    1: null // Remaps buttons[1] to a placeholder button (always reports 0/false)\n  },\n  gripTransform: { // An additional transform to apply to the gripSpace's pose\n    position: [0, 0, 0.5], // Additional translation vector to apply\n    orientation: [0, 0, 0, 1] // Additional rotation quaternion to apply\n  },\n  targetRayTransform: { // An additional transform to apply to the targetRaySpace's pose\n    position: [0, 0, 0.5], // Additional translation vector to apply\n    orientation: [0, 0, 0, 1] // Additional rotation quaternion to apply\n  }\n}\n*/\n\nlet daydream = {\n  mapping: '',\n  profiles: ['google-daydream', 'generic-trigger-touchpad'],\n  buttons: {\n    length: 3,\n    0: null,\n    1: null,\n    2: 0\n  },\n};\n\nlet viveFocus = {\n  mapping: 'xr-standard',\n  profiles: ['htc-vive-focus', 'generic-trigger-touchpad'],\n  buttons: {\n    length: 3,\n    0: 1,\n    1: null,\n    2: 0\n  },\n};\n\nlet oculusGo = {\n  mapping: 'xr-standard',\n  profiles: ['oculus-go', 'generic-trigger-touchpad'],\n  buttons: {\n    length: 3,\n    0: 1,\n    1: null,\n    2: 0\n  },\n  // Grip adjustments determined experimentally.\n  gripTransform: {\n    orientation: [Math.PI * 0.11, 0, 0, 1]\n  }\n};\n\n// Applies to both left and right Oculus Touch controllers.\nlet oculusTouch = {\n  mapping: 'xr-standard',\n  displayProfiles: {\n    'Oculus Quest': ['oculus-touch-v2', 'oculus-touch', 'generic-trigger-squeeze-thumbstick']\n  },\n  profiles: ['oculus-touch', 'generic-trigger-squeeze-thumbstick'],\n  axes: {\n    length: 4,\n    0: null,\n    1: null,\n    2: 0,\n    3: 1\n  },\n  buttons: {\n    length: 7,\n    0: 1,\n    1: 2,\n    2: null,\n    3: 0,\n    4: 3,\n    5: 4,\n    6: null\n  },\n  // Grip adjustments determined experimentally.\n  gripTransform: {\n    position: [0, -0.02, 0.04, 1],\n    orientation: [Math.PI * 0.11, 0, 0, 1]\n  }\n};\n\nlet openVr = {\n  mapping: 'xr-standard',\n  profiles: ['htc-vive', 'generic-trigger-squeeze-touchpad'],\n  displayProfiles: {\n    'HTC Vive': ['htc-vive', 'generic-trigger-squeeze-touchpad'],\n    'HTC Vive DVT': ['htc-vive', 'generic-trigger-squeeze-touchpad'],\n    'Valve Index': ['valve-index', 'generic-trigger-squeeze-touchpad-thumbstick']\n  },\n  buttons: {\n    length: 3,\n    0: 1,\n    1: 2,\n    2: 0\n  },\n  // Transform adjustments determined experimentally.\n  gripTransform: {\n    position: [0, 0, 0.05, 1],\n  },\n  targetRayTransform: {\n    orientation: [Math.PI * -0.08, 0, 0, 1]\n  },\n  userAgentOverrides: {\n    \"Firefox\": {\n      axes: {\n        invert: [1, 3]\n      }\n    }\n  }\n};\n\nlet samsungGearVR = {\n  mapping: 'xr-standard',\n  profiles: ['samsung-gearvr', 'generic-trigger-touchpad'],\n  buttons: {\n    length: 3,\n    0: 1,\n    1: null,\n    2: 0\n  },\n  gripTransform: {\n    orientation: [Math.PI * 0.11, 0, 0, 1]\n  }\n};\n\nlet samsungOdyssey = {\n  mapping: 'xr-standard',\n  profiles: ['samsung-odyssey', 'microsoft-mixed-reality', 'generic-trigger-squeeze-touchpad-thumbstick'],\n  buttons: {\n    length: 4,\n    0: 1, // index finger trigger\n    1: 0, // pressable joystick\n    2: 2, // grip trigger\n    3: 4, // pressable touchpad\n  },\n  // Grip adjustments determined experimentally.\n  gripTransform: {\n    position: [0, -0.02, 0.04, 1],\n    orientation: [Math.PI * 0.11, 0, 0, 1]\n  }\n};\n\nlet windowsMixedReality = {\n  mapping: 'xr-standard',\n  profiles: ['microsoft-mixed-reality', 'generic-trigger-squeeze-touchpad-thumbstick'],\n  buttons: {\n    length: 4,\n    0: 1, // index finger trigger\n    1: 0, // pressable joystick\n    2: 2, // grip trigger\n    3: 4, // pressable touchpad\n  },\n  // Grip adjustments determined experimentally.\n  gripTransform: {\n    position: [0, -0.02, 0.04, 1],\n    orientation: [Math.PI * 0.11, 0, 0, 1]\n  }\n};\n\nlet GamepadMappings = {\n  'Daydream Controller': daydream,\n  'Gear VR Controller': samsungGearVR,\n  'HTC Vive Focus Controller': viveFocus,\n  'Oculus Go Controller': oculusGo,\n  'Oculus Touch (Right)': oculusTouch,\n  'Oculus Touch (Left)': oculusTouch,\n  'OpenVR Gamepad': openVr,\n  'Spatial Controller (Spatial Interaction Source) 045E-065A': windowsMixedReality,\n  'Spatial Controller (Spatial Interaction Source) 045E-065D': samsungOdyssey,\n  'Windows Mixed Reality (Right)': windowsMixedReality,\n  'Windows Mixed Reality (Left)': windowsMixedReality,\n};\n\nexport default GamepadMappings;\n", "/*\n * Copyright 2016 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport now from './now';\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4';\nimport * as vec3 from 'gl-matrix/src/gl-matrix/vec3';\nimport * as quat from 'gl-matrix/src/gl-matrix/quat';\n\nconst HEAD_ELBOW_OFFSET_RIGHTHANDED = vec3.fromValues(0.155, -0.465, -0.15);\nconst HEAD_ELBOW_OFFSET_LEFTHANDED = vec3.fromValues(-0.155, -0.465, -0.15);\nconst ELBOW_WRIST_OFFSET = vec3.fromValues(0, 0, -0.25);\nconst WRIST_CONTROLLER_OFFSET = vec3.fromValues(0, 0, 0.05);\nconst ARM_EXTENSION_OFFSET = vec3.fromValues(-0.08, 0.14, 0.08);\n\nconst ELBOW_BEND_RATIO = 0.4; // 40% elbow, 60% wrist.\nconst EXTENSION_RATIO_WEIGHT = 0.4;\n\nconst MIN_ANGULAR_SPEED = 0.61; // 35 degrees per second (in radians).\nconst MIN_ANGLE_DELTA = 0.175; // 10 degrees (in radians).\n\nconst MIN_EXTENSION_COS = 0.12; // cos of 83 degrees.\nconst MAX_EXTENSION_COS = 0.87; // cos of 30 degrees.\n\nconst RAD_TO_DEG = 180 / Math.PI;\n\nfunction eulerFromQuaternion(out, q, order) {\n  function clamp(value, min, max) {\n    return (value < min ? min : (value > max ? max : value));\n  }\n  // Borrowed from Three.JS :)\n  // q is assumed to be normalized\n  // http://www.mathworks.com/matlabcentral/fileexchange/20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/content/SpinCalc.m\n  var sqx = q[0] * q[0];\n  var sqy = q[1] * q[1];\n  var sqz = q[2] * q[2];\n  var sqw = q[3] * q[3];\n\n  if ( order === 'XYZ' ) {\n    out[0] = Math.atan2( 2 * ( q[0] * q[3] - q[1] * q[2] ), ( sqw - sqx - sqy + sqz ) );\n    out[1] = Math.asin(  clamp( 2 * ( q[0] * q[2] + q[1] * q[3] ), -1, 1 ) );\n    out[2] = Math.atan2( 2 * ( q[2] * q[3] - q[0] * q[1] ), ( sqw + sqx - sqy - sqz ) );\n  } else if ( order ===  'YXZ' ) {\n    out[0] = Math.asin(  clamp( 2 * ( q[0] * q[3] - q[1] * q[2] ), -1, 1 ) );\n    out[1] = Math.atan2( 2 * ( q[0] * q[2] + q[1] * q[3] ), ( sqw - sqx - sqy + sqz ) );\n    out[2] = Math.atan2( 2 * ( q[0] * q[1] + q[2] * q[3] ), ( sqw - sqx + sqy - sqz ) );\n  } else if ( order === 'ZXY' ) {\n    out[0] = Math.asin(  clamp( 2 * ( q[0] * q[3] + q[1] * q[2] ), -1, 1 ) );\n    out[1] = Math.atan2( 2 * ( q[1] * q[3] - q[2] * q[0] ), ( sqw - sqx - sqy + sqz ) );\n    out[2] = Math.atan2( 2 * ( q[2] * q[3] - q[0] * q[1] ), ( sqw - sqx + sqy - sqz ) );\n  } else if ( order === 'ZYX' ) {\n    out[0] = Math.atan2( 2 * ( q[0] * q[3] + q[2] * q[1] ), ( sqw - sqx - sqy + sqz ) );\n    out[1] = Math.asin(  clamp( 2 * ( q[1] * q[3] - q[0] * q[2] ), -1, 1 ) );\n    out[2] = Math.atan2( 2 * ( q[0] * q[1] + q[2] * q[3] ), ( sqw + sqx - sqy - sqz ) );\n  } else if ( order === 'YZX' ) {\n    out[0] = Math.atan2( 2 * ( q[0] * q[3] - q[2] * q[1] ), ( sqw - sqx + sqy - sqz ) );\n    out[1] = Math.atan2( 2 * ( q[1] * q[3] - q[0] * q[2] ), ( sqw + sqx - sqy - sqz ) );\n    out[2] = Math.asin(  clamp( 2 * ( q[0] * q[1] + q[2] * q[3] ), -1, 1 ) );\n  } else if ( order === 'XZY' ) {\n    out[0] = Math.atan2( 2 * ( q[0] * q[3] + q[1] * q[2] ), ( sqw - sqx + sqy - sqz ) );\n    out[1] = Math.atan2( 2 * ( q[0] * q[2] + q[1] * q[3] ), ( sqw + sqx - sqy - sqz ) );\n    out[2] = Math.asin(  clamp( 2 * ( q[2] * q[3] - q[0] * q[1] ), -1, 1 ) );\n  } else {\n    console.log('No order given for quaternion to euler conversion.');\n    return;\n  }\n}\n\n/**\n * Represents the arm model for the Daydream controller. Feed it a camera and\n * the controller. Update it on a RAF.\n *\n * Get the model's pose using getPose().\n */\nexport default class OrientationArmModel {\n  constructor() {\n    this.hand = 'right';\n    this.headElbowOffset = HEAD_ELBOW_OFFSET_RIGHTHANDED;\n\n    // Current and previous controller orientations.\n    this.controllerQ = quat.create();\n    this.lastControllerQ = quat.create();\n\n    // Current and previous head orientations.\n    this.headQ = quat.create();\n\n    // Current head position.\n    this.headPos = vec3.create();\n\n    // Positions of other joints (mostly for debugging).\n    this.elbowPos = vec3.create();\n    this.wristPos = vec3.create();\n\n    // Current and previous times the model was updated.\n    this.time = null;\n    this.lastTime = null;\n\n    // Root rotation.\n    this.rootQ = quat.create();\n\n    // Current position that this arm model calculates.\n    this.position = vec3.create();\n  }\n\n  setHandedness(hand) {\n    if (this.hand != hand) {\n      this.hand = hand;\n      if (this.hand == 'left') {\n        this.headElbowOffset = HEAD_ELBOW_OFFSET_LEFTHANDED;\n      } else {\n        this.headElbowOffset = HEAD_ELBOW_OFFSET_RIGHTHANDED;\n      }\n    }\n  }\n\n  /**\n   * Called on a RAF.\n   */\n  update(controllerOrientation, headPoseMatrix) {\n    this.time = now();\n\n    // Update the internal copies of the controller and head pose.\n    if (controllerOrientation) {\n      quat.copy(this.lastControllerQ, this.controllerQ);\n      quat.copy(this.controllerQ, controllerOrientation);\n    }\n\n    if (headPoseMatrix) {\n      mat4.getTranslation(this.headPos, headPoseMatrix);\n      mat4.getRotation(this.headQ, headPoseMatrix);\n    }\n\n    // If the controller's angular velocity is above a certain amount, we can\n    // assume torso rotation and move the elbow joint relative to the\n    // camera orientation.\n    let headYawQ = this.getHeadYawOrientation_();\n    let angleDelta = this.quatAngle_(this.lastControllerQ, this.controllerQ);\n    let timeDelta = (this.time - this.lastTime) / 1000;\n    let controllerAngularSpeed = angleDelta / timeDelta;\n    if (controllerAngularSpeed > MIN_ANGULAR_SPEED) {\n      // Attenuate the Root rotation slightly.\n      quat.slerp(this.rootQ, this.rootQ, headYawQ,\n                 Math.min(angleDelta / MIN_ANGLE_DELTA, 1.0));\n    } else {\n      quat.copy(this.rootQ, headYawQ);\n    }\n\n    // We want to move the elbow up and to the center as the user points the\n    // controller upwards, so that they can easily see the controller and its\n    // tool tips.\n    let controllerForward = vec3.fromValues(0, 0, -1.0);\n    vec3.transformQuat(controllerForward, controllerForward, this.controllerQ);\n    let controllerDotY = vec3.dot(controllerForward, [0, 1, 0]);\n    let extensionRatio = this.clamp_(\n        (controllerDotY - MIN_EXTENSION_COS) / MAX_EXTENSION_COS, 0.0, 1.0);\n\n    // Controller orientation in camera space.\n    let controllerCameraQ = quat.clone(this.rootQ);\n    quat.invert(controllerCameraQ, controllerCameraQ);\n    quat.multiply(controllerCameraQ, controllerCameraQ, this.controllerQ);\n\n\n    // Calculate elbow position.\n    let elbowPos = this.elbowPos;\n    vec3.copy(elbowPos, this.headPos);\n    vec3.add(elbowPos, elbowPos, this.headElbowOffset);\n    let elbowOffset = vec3.clone(ARM_EXTENSION_OFFSET);\n    vec3.scale(elbowOffset, elbowOffset, extensionRatio);\n    vec3.add(elbowPos, elbowPos, elbowOffset);\n\n    // Calculate joint angles. Generally 40% of rotation applied to elbow, 60%\n    // to wrist, but if controller is raised higher, more rotation comes from\n    // the wrist.\n    let totalAngle = this.quatAngle_(controllerCameraQ, quat.create());\n    let totalAngleDeg = totalAngle * RAD_TO_DEG;\n    let lerpSuppression = 1 - Math.pow(totalAngleDeg / 180, 4);sssss\n\n    let elbowRatio = ELBOW_BEND_RATIO;\n    let wristRatio = 1 - ELBOW_BEND_RATIO;\n    let lerpValue = lerpSuppression *\n        (elbowRatio + wristRatio * extensionRatio * EXTENSION_RATIO_WEIGHT);\n\n    let wristQ = quat.create();\n    quat.slerp(wristQ, wristQ, controllerCameraQ, lerpValue);\n    let invWristQ = quat.invert(quat.create(), wristQ);\n    let elbowQ = quat.clone(controllerCameraQ);\n    quat.multiply(elbowQ, elbowQ, invWristQ);\n\n    // Calculate our final controller position based on all our joint rotations\n    // and lengths.\n    /*\n    position_ =\n      root_rot_ * (\n        controller_root_offset_ +\n2:      (arm_extension_ * amt_extension) +\n1:      elbow_rot * (kControllerForearm + (wrist_rot * kControllerPosition))\n      );\n    */\n    let wristPos = this.wristPos;\n    vec3.copy(wristPos, WRIST_CONTROLLER_OFFSET);\n    vec3.transformQuat(wristPos, wristPos, wristQ);\n    vec3.add(wristPos, wristPos, ELBOW_WRIST_OFFSET);\n    vec3.transformQuat(wristPos, wristPos, elbowQ);\n    vec3.add(wristPos, wristPos, elbowPos);\n\n    let offset = vec3.clone(ARM_EXTENSION_OFFSET);\n    vec3.scale(offset, offset, extensionRatio);\n\n    // Set the resulting pose orientation and position.\n    vec3.add(this.position, this.wristPos, offset);\n    vec3.transformQuat(this.position, this.position, this.rootQ);\n\n    this.lastTime = this.time;\n  }\n\n  /**\n   * Returns the position calculated by the model.\n   */\n  getPosition() {\n    return this.position;\n  }\n\n  getHeadYawOrientation_() {\n    let headEuler = vec3.create();\n    eulerFromQuaternion(headEuler, this.headQ, 'YXZ');\n    let destinationQ = quat.fromEuler(quat.create(), 0, headEuler[1] * RAD_TO_DEG, 0);\n    return destinationQ;\n  }\n\n  clamp_(value, min, max) {\n    return Math.min(Math.max(value, min), max);\n  }\n\n  quatAngle_(q1, q2) {\n    let vec1 = [0, 0, -1];\n    let vec2 = [0, 0, -1];\n    vec3.transformQuat(vec1, vec1, q1);\n    vec3.transformQuat(vec2, vec2, q2);\n    return vec3.angle(vec1, vec2);\n  }\n}", "/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport GamepadMappings from './GamepadMappings';\nimport XRInputSource from '../api/XRInputSource';\nimport OrientationArmModel from '../lib/OrientationArmModel';\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4';\nimport * as vec3 from 'gl-matrix/src/gl-matrix/vec3';\nimport * as quat from 'gl-matrix/src/gl-matrix/quat';\n\nexport const PRIVATE = Symbol('@@webxr-polyfill/XRRemappedGamepad');\n\nconst PLACEHOLDER_BUTTON = { pressed: false, touched: false, value: 0.0 };\nObject.freeze(PLACEHOLDER_BUTTON);\n\nclass XRRemappedGamepad {\n  constructor(gamepad, display, map) {\n    if (!map) {\n      map = {};\n    }\n\n    // Apply user-agent-specific overrides to the mapping when applicable.\n    if (map.userAgentOverrides) {\n      for (let agent in map.userAgentOverrides) {\n        if (navigator.userAgent.includes(agent)) {\n          let override = map.userAgentOverrides[agent];\n\n          for (let key in override) {\n            if (key in map) {\n              // If the key already exists, merge the override values into the\n              // existing dictionary.\n              Object.assign(map[key], override[key]);\n            } else {\n              // If the base mapping doesn't have this key, insert the override\n              // values wholesale.\n              map[key] = override[key];\n            }\n          }\n          break;\n        }\n      }\n    }\n\n    let axes = new Array(map.axes && map.axes.length ? map.axes.length : gamepad.axes.length);\n    let buttons = new Array(map.buttons && map.buttons.length ? map.buttons.length : gamepad.buttons.length);\n\n    let gripTransform = null;\n    if (map.gripTransform) {\n      let orientation = map.gripTransform.orientation || [0, 0, 0, 1];\n      gripTransform = mat4.create();\n      mat4.fromRotationTranslation(\n        gripTransform,\n        quat.normalize(orientation, orientation),\n        map.gripTransform.position || [0, 0, 0]\n      );\n    }\n\n    let targetRayTransform = null;\n    if (map.targetRayTransform) {\n      let orientation =  map.targetRayTransform.orientation || [0, 0, 0, 1];\n      targetRayTransform = mat4.create();\n      mat4.fromRotationTranslation(\n        targetRayTransform,\n        quat.normalize(orientation, orientation),\n        map.targetRayTransform.position || [0, 0, 0]\n      );\n    }\n\n    let profiles = map.profiles;\n    if (map.displayProfiles) {\n      if (display.displayName in map.displayProfiles) {\n        profiles = map.displayProfiles[display.displayName];\n      }\n    }\n\n    this[PRIVATE] = {\n      gamepad,\n      map,\n      profiles: profiles || [gamepad.id],\n      mapping: map.mapping || gamepad.mapping,\n      axes,\n      buttons,\n      gripTransform,\n      targetRayTransform,\n    };\n\n    this._update();\n  }\n\n  _update() {\n    let gamepad = this[PRIVATE].gamepad;\n    let map = this[PRIVATE].map;\n\n    let axes = this[PRIVATE].axes;\n    for (let i = 0; i < axes.length; ++i) {\n      if (map.axes && i in map.axes) {\n        if (map.axes[i] === null) {\n          axes[i] = 0;\n        } else {\n          axes[i] = gamepad.axes[map.axes[i]];\n        }\n      } else {\n        axes[i] = gamepad.axes[i];\n      }\n    }\n\n    if (map.axes && map.axes.invert) {\n      for (let axis of map.axes.invert) {\n        if (axis < axes.length) {\n          axes[axis] *= -1;\n        }\n      }\n    }\n\n    let buttons = this[PRIVATE].buttons;\n    for (let i = 0; i < buttons.length; ++i) {\n      if (map.buttons && i in map.buttons) {\n        if (map.buttons[i] === null) {\n          buttons[i] = PLACEHOLDER_BUTTON;\n        } else {\n          buttons[i] = gamepad.buttons[map.buttons[i]];\n        }\n      } else {\n        buttons[i] = gamepad.buttons[i];\n      }\n    }\n  }\n\n  get id() {\n    return '';\n  }\n\n  get _profiles() {\n    return this[PRIVATE].profiles;\n  }\n\n  get index() {\n    return -1; \n  }\n\n  get connected() {\n    return this[PRIVATE].gamepad.connected;\n  }\n\n  get timestamp() {\n    return this[PRIVATE].gamepad.timestamp;\n  }\n\n  get mapping() {\n    return this[PRIVATE].mapping;\n  }\n\n  get axes() {\n    return this[PRIVATE].axes;\n  }\n\n  get buttons() {\n    return this[PRIVATE].buttons;\n  }\n\n  // Non-standard extension\n  get hapticActuators() {\n    return this[PRIVATE].gamepad.hapticActuators;\n  }\n}\n\nexport default class GamepadXRInputSource {\n  constructor(polyfill, display, primaryButtonIndex = 0, primarySqueezeButtonIndex = -1) {\n    this.polyfill = polyfill;\n    this.display = display;\n    this.nativeGamepad = null;\n    this.gamepad = null;\n    this.inputSource = new XRInputSource(this);\n    this.lastPosition = vec3.create();\n    this.emulatedPosition = false;\n    this.basePoseMatrix = mat4.create();\n    this.outputMatrix = mat4.create();\n    this.primaryButtonIndex = primaryButtonIndex;\n    this.primaryActionPressed = false;\n    this.primarySqueezeButtonIndex = primarySqueezeButtonIndex;\n    this.primarySqueezeActionPressed = false;\n    this.handedness = '';\n    this.targetRayMode = 'gaze';\n    this.armModel = null;\n  }\n\n  get profiles() {\n    return this.gamepad ? this.gamepad._profiles : [];\n  }\n\n  updateFromGamepad(gamepad) {\n    if (this.nativeGamepad !== gamepad) {\n      this.nativeGamepad = gamepad;\n      if (gamepad) {\n        this.gamepad = new XRRemappedGamepad(gamepad, this.display, GamepadMappings[gamepad.id]);\n      } else {\n        this.gamepad = null;\n      }\n    }\n    this.handedness = gamepad.hand === '' ? 'none' : gamepad.hand\n\n    if (this.gamepad) {\n      this.gamepad._update();\n    }\n\n    if (gamepad.pose) {\n      this.targetRayMode = 'tracked-pointer';\n      this.emulatedPosition = !gamepad.pose.hasPosition;\n    } else if (gamepad.hand === '') {\n      this.targetRayMode = 'gaze';\n      this.emulatedPosition = false;\n    }\n  }\n\n  updateBasePoseMatrix() {\n    if (this.nativeGamepad && this.nativeGamepad.pose) {\n      let pose = this.nativeGamepad.pose;\n      let position = pose.position;\n      let orientation = pose.orientation;\n      // On initialization, we might not have any values\n      if (!position && !orientation) {\n        return;\n      }\n      if (!position) {\n        if (!pose.hasPosition) {\n          if (!this.armModel) {\n            this.armModel = new OrientationArmModel();\n          }\n\n          this.armModel.setHandedness(this.nativeGamepad.hand);\n          this.armModel.update(orientation, this.polyfill.getBasePoseMatrix());\n          position = this.armModel.getPosition();\n        } else {\n          position = this.lastPosition;\n        }\n      } else {\n        // This is if we temporarily lose tracking, so the controller doesn't\n        // snap back to the origin.\n        this.lastPosition[0] = position[0];\n        this.lastPosition[1] = position[1];\n        this.lastPosition[2] = position[2];\n      }\n      mat4.fromRotationTranslation(this.basePoseMatrix, orientation, position);\n    } else {\n      mat4.copy(this.basePoseMatrix, this.polyfill.getBasePoseMatrix());\n    }\n    return this.basePoseMatrix;\n  }\n\n  /**\n   * @param {XRReferenceSpace} coordinateSystem\n   * @param {string} poseType\n   * @return {XRPose?}\n   */\n  getXRPose(coordinateSystem, poseType) {\n    this.updateBasePoseMatrix();\n\n    switch(poseType) {\n      case \"target-ray\":\n        coordinateSystem._transformBasePoseMatrix(this.outputMatrix, this.basePoseMatrix);\n        if (this.gamepad && this.gamepad[PRIVATE].targetRayTransform) {\n          mat4.multiply(this.outputMatrix, this.outputMatrix, this.gamepad[PRIVATE].targetRayTransform);\n        }\n        break;\n      case \"grip\":\n        if (!this.nativeGamepad || !this.nativeGamepad.pose) {\n          return null;\n        }\n        // TODO: Does the grip matrix need to be tweaked?\n        coordinateSystem._transformBasePoseMatrix(this.outputMatrix, this.basePoseMatrix);\n        if (this.gamepad && this.gamepad[PRIVATE].gripTransform) {\n          mat4.multiply(this.outputMatrix, this.outputMatrix, this.gamepad[PRIVATE].gripTransform);\n        }\n        break;\n      default:\n        return null;\n    }\n\n    coordinateSystem._adjustForOriginOffset(this.outputMatrix);\n\n    return new XRPose(new XRRigidTransform(this.outputMatrix), this.emulatedPosition);\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4';\nimport XRDevice from './XRDevice';\nimport GamepadXRInputSource from './GamepadXRInputSource';\nimport {\n  isImageBitmapSupported,\n  applyCanvasStylesForMinimalRendering\n} from '../utils';\n\nconst PRIVATE = Symbol('@@webxr-polyfill/WebVRDevice');\nconst TEST_ENV = process.env.NODE_ENV === 'test';\n\nconst EXTRA_PRESENTATION_ATTRIBUTES = {\n  // Non-standard attribute to enable running at the native device refresh rate\n  // on the Oculus Go.\n  highRefreshRate: true,\n};\n\n// If a gamepad id string includes the name of the key from the map, the button\n// index given will be the one used as that controller's primary action button\n// rather than the default of button 0.\nconst PRIMARY_BUTTON_MAP = {\n  oculus: 1,\n  openvr: 1,\n  'spatial controller (spatial interaction source)': 1\n};\n\n/**\n * A Session helper class to mirror an XRSession and correlate\n * between an XRSession, and tracking sessions in a XRDevice.\n * Mostly referenced via `session.id` due to needing to verify\n * session creation is possible on the XRDevice before\n * the XRSession can be created.\n */\nlet SESSION_ID = 0;\nclass Session {\n  constructor(mode, enabledFeatures, polyfillOptions={}) {\n    this.mode = mode;\n    this.enabledFeatures = enabledFeatures;\n    this.outputContext = null;\n    this.immersive = mode == 'immersive-vr' || mode == 'immersive-ar';\n    this.ended = null;\n    this.baseLayer = null;\n    this.id = ++SESSION_ID;\n    // A flag indicating whether or not the canvas used for\n    // XRWebGLLayer was injected into the DOM to work around\n    // Firefox Desktop bug: https://bugzil.la/1435339\n    this.modifiedCanvasLayer = false;\n\n    // Since XRPresentationContext is created outside of the main API\n    // and does not expose the real 2d/bitmaprender context, manually fetch\n    // it and store it.\n    if (this.outputContext && !TEST_ENV) {\n      const renderContextType = polyfillOptions.renderContextType || '2d';\n      this.renderContext = this.outputContext.canvas.getContext(renderContextType);\n    }\n  }\n};\n\nexport default class WebVRDevice extends XRDevice {\n  /**\n   * Takes a VRDisplay instance and a VRFrameData\n   * constructor from the WebVR 1.1 spec.\n   *\n   * @param {VRDisplay} display\n   * @param {VRFrameData} VRFrameData\n   */\n  constructor(global, display) {\n    const { canPresent } = display.capabilities;\n    super(global);\n\n    this.display = display;\n    this.frame = new global.VRFrameData();\n    this.sessions = new Map();\n    this.immersiveSession = null;\n    this.canPresent = canPresent;\n    this.baseModelMatrix = mat4.create();\n    this.gamepadInputSources = {};\n    this.tempVec3 = new Float32Array(3);\n\n    this.onVRDisplayPresentChange = this.onVRDisplayPresentChange.bind(this);\n\n    global.window.addEventListener('vrdisplaypresentchange', this.onVRDisplayPresentChange);\n\n    this.CAN_USE_GAMEPAD = global.navigator && ('getGamepads' in global.navigator);\n    this.HAS_BITMAP_SUPPORT = isImageBitmapSupported(global);\n  }\n\n  /**\n   * @return {number}\n   */\n  get depthNear() { return this.display.depthNear; }\n\n  /**\n   * @param {number}\n   */\n  set depthNear(val) { this.display.depthNear = val; }\n\n  /**\n   * @return {number}\n   */\n  get depthFar() { return this.display.depthFar; }\n\n  /**\n   * @param {number}\n   */\n  set depthFar(val) { this.display.depthFar = val; }\n\n  /**\n   * Called when a XRSession has a `baseLayer` property set.\n   *\n   * @param {number} sessionId\n   * @param {XRWebGLLayer} layer\n   */\n  onBaseLayerSet(sessionId, layer) {\n    const session = this.sessions.get(sessionId);\n    const canvas = layer.context.canvas;\n\n    // If we're in an immersive session, replace the dummy layer on\n    // the 1.1 device.\n    if (session.immersive) {\n      // Wait for this to resolve before setting session.baseLayer,\n      // but we can still safely return this function synchronously\n      // We have to set the underlying canvas to the size\n      // requested by the 1.1 device.\n      const left = this.display.getEyeParameters('left');\n      const right = this.display.getEyeParameters('right');\n\n      // Generate height/width due to optics as per 1.1 spec\n      canvas.width = Math.max(left.renderWidth, right.renderWidth) * 2;\n      canvas.height = Math.max(left.renderHeight, right.renderHeight);\n      this.display.requestPresent([{\n          source: canvas, attributes: EXTRA_PRESENTATION_ATTRIBUTES\n        }]).then(() => {\n        // If canvas is not in the DOM, we must inject it anyway,\n        // due to a bug in Firefox Desktop, and ensure it is visible,\n        // so style it to be 1x1 in the upper left corner.\n        // https://bugzil.la/1435339\n        // Our test environment doesn't have the canvas package, skip\n        // in tests for now.\n        if (!TEST_ENV && !this.global.document.body.contains(canvas)) {\n          session.modifiedCanvasLayer = true;\n          this.global.document.body.appendChild(canvas);\n          applyCanvasStylesForMinimalRendering(canvas);\n        }\n        session.baseLayer = layer;\n      });\n    }\n    // If a non-immersive session that has an outputContext\n    // we only have a magic window.\n    else {\n      session.baseLayer = layer;\n    }\n  }\n\n  /**\n   * If a 1.1 VRDisplay cannot present, it could be a 6DOF device\n   * that doesn't have its own way to present, but used in magic\n   * window mode. So in WebXR lingo, this cannot support an\n   * \"immersive\" session.\n   *\n   * @param {XRSessionMode} mode\n   * @return {boolean}\n   */\n  isSessionSupported(mode) {\n    // AR is not supported by the WebVRDevice\n    if (mode == 'immersive-ar') {\n      return false;\n    }\n    if (mode == 'immersive-vr' && this.canPresent === false) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * @param {string} featureDescriptor\n   * @return {boolean}\n   */\n  isFeatureSupported(featureDescriptor) {\n    switch(featureDescriptor) {\n      case 'viewer': return true;\n      case 'local': return true;\n      case 'local-floor': return true;\n\n      // TODO: We *can* support 'bounded-floor' reference spaces with what WebVR\n      // gives us, but it'll take some additional work and may have tricky\n      // timing issues.\n      case 'bounded': return false;\n\n      // 'unbounded' is unlikely to ever be supported by the polyfill, since\n      // it's pretty much impossible to do correctly without native support.\n      case 'unbounded': return false;\n      default: return false;\n    }\n  }\n\n  /**\n   * Returns a promise of a session ID if creating a session is successful.\n   * Usually used to set up presentation in the device.\n   * We can't start presenting in a 1.1 device until we have a canvas\n   * layer, so use a dummy layer until `onBaseLayerSet` is called.\n   * May reject if session is not supported, or if an error is thrown\n   * when calling `requestPresent`.\n   *\n   * @param {XRSessionMode} mode\n   * @param {Set<string>} enabledFeatures\n   * @return {Promise<number>}\n   */\n  async requestSession(mode, enabledFeatures) {\n    if (!this.isSessionSupported(mode)) {\n      return Promise.reject();\n    }\n\n    let immersive = mode == 'immersive-vr';\n\n    // If we're going to present to device, immediately call `requestPresent`\n    // since this needs to be inside of a user gesture for Cardboard\n    // (requires a user gesture for `requestFullscreen`), as well as\n    // WebVR 1.1 requiring to be in a user gesture. Use a dummy canvas,\n    // until we get the real canvas to present via `onBaseLayerSet`.\n    if (immersive) {\n      const canvas = this.global.document.createElement('canvas');\n\n      // Our test environment doesn't have the canvas package, nor this\n      // restriction, so skip.\n      if (!TEST_ENV) {\n        // Create and discard a context to avoid\n        // \"DOMException: Layer source must have a WebGLRenderingContext\"\n        const ctx = canvas.getContext('webgl');\n      }\n      await this.display.requestPresent([{\n          source: canvas, attributes: EXTRA_PRESENTATION_ATTRIBUTES }]);\n    }\n\n    const session = new Session(mode, enabledFeatures, {\n      renderContextType: this.HAS_BITMAP_SUPPORT ? 'bitmaprenderer' : '2d'\n    });\n\n    this.sessions.set(session.id, session);\n\n    if (immersive) {\n      this.immersiveSession = session;\n      this.dispatchEvent('@@webxr-polyfill/vr-present-start', session.id);\n    }\n\n    return Promise.resolve(session.id);\n  }\n\n  /**\n   * @return {Function}\n   */\n  requestAnimationFrame(callback) {\n    return this.display.requestAnimationFrame(callback);\n  }\n\n  getPrimaryButtonIndex(gamepad) {\n    let primaryButton = 0;\n    let name = gamepad.id.toLowerCase();\n    for (let key in PRIMARY_BUTTON_MAP) {\n      if (name.includes(key)) {\n        primaryButton = PRIMARY_BUTTON_MAP[key];\n        break;\n      }\n    }\n    // Make sure the index is actually in the button range.\n    return Math.min(primaryButton, gamepad.buttons.length - 1);\n  }\n\n  onFrameStart(sessionId, renderState) {\n    this.display.depthNear = renderState.depthNear;\n    this.display.depthFar = renderState.depthFar\n\n    this.display.getFrameData(this.frame);\n\n    const session = this.sessions.get(sessionId);\n\n    if (session.immersive && this.CAN_USE_GAMEPAD) {\n      // Update inputs from gamepad data\n      let prevInputSources = this.gamepadInputSources;\n      this.gamepadInputSources = {};\n      let gamepads = this.global.navigator.getGamepads();\n      for (let i = 0; i < gamepads.length; ++i) {\n        let gamepad = gamepads[i];\n        // Supposedly the gamepad's displayId should match the VRDisplay's id,\n        // but in practice anything with a non-zero displayId is an XR\n        // controller, which is almost certainly associated with any VRDisplay\n        // we were able to get.\n        if (gamepad && gamepad.displayId > 0) {\n          // Found a gamepad input source for this index.\n          let inputSourceImpl = prevInputSources[i];\n          if (!inputSourceImpl) {\n            inputSourceImpl = new GamepadXRInputSource(this, this.display, this.getPrimaryButtonIndex(gamepad));\n          }\n          inputSourceImpl.updateFromGamepad(gamepad);\n          this.gamepadInputSources[i] = inputSourceImpl;\n\n          // Process the primary action for the controller\n          if (inputSourceImpl.primaryButtonIndex != -1) {\n            let primaryActionPressed = gamepad.buttons[inputSourceImpl.primaryButtonIndex].pressed;\n            if (primaryActionPressed && !inputSourceImpl.primaryActionPressed) {\n              this.dispatchEvent('@@webxr-polyfill/input-select-start', { sessionId: session.id, inputSource: inputSourceImpl.inputSource });\n            } else if (!primaryActionPressed && inputSourceImpl.primaryActionPressed) {\n              // This will also fire a select event\n              this.dispatchEvent('@@webxr-polyfill/input-select-end', { sessionId: session.id, inputSource: inputSourceImpl.inputSource });\n            }\n            inputSourceImpl.primaryActionPressed = primaryActionPressed;\n          }\n          if (inputSourceImpl.primarySqueezeButtonIndex != -1) {\n            let primarySqueezeActionPressed = gamepad.buttons[inputSourceImpl.primarySqueezeButtonIndex].pressed;\n            if (primarySqueezeActionPressed && !inputSourceImpl.primarySqueezeActionPressed) {\n              this.dispatchEvent('@@webxr-polyfill/input-squeeze-start', { sessionId: session.id, inputSource: inputSourceImpl.inputSource });\n            } else if (!primarySqueezeActionPressed && inputSourceImpl.primarySqueezeActionPressed) {\n              // This will also fire a select event\n              this.dispatchEvent('@@webxr-polyfill/input-squeeze-end', { sessionId: session.id, inputSource: inputSourceImpl.inputSource });\n            }\n            inputSourceImpl.primarySqueezeActionPressed = primarySqueezeActionPressed;\n          }\n        }\n      }\n    }\n\n    // @TODO Our test environment doesn't have the canvas package for now,\n    // but this could be something we add to the tests.\n    if (TEST_ENV) {\n      return;\n    }\n\n    // If the session is inline make sure the projection matrix matches the \n    // aspect ratio of the underlying WebGL canvas.\n    if (!session.immersive && session.baseLayer) {\n      const canvas = session.baseLayer.context.canvas;\n      // Update the projection matrix.\n      mat4.perspective(this.frame.leftProjectionMatrix, renderState.inlineVerticalFieldOfView,\n          canvas.width/canvas.height, renderState.depthNear, renderState.depthFar);\n    }\n  }\n\n  onFrameEnd(sessionId) {\n    const session = this.sessions.get(sessionId);\n\n    // Discard if this session is already ended, or if it does\n    // not yet have a baseLayer.\n    if (session.ended || !session.baseLayer) {\n      return;\n    }\n\n    // If session is has an outputContext, whether magic window\n    // or mirroring (session.immersive === true), copy the baseLayer\n    // pixels to the XRPresentationContext\n    // However, abort if this a mirrored context, and our VRDisplay\n    // does not have an external display; this kills performance rather\n    // quickly on mobile for a canvas that's not seen.\n    if (session.outputContext &&\n        !(session.immersive && !this.display.capabilities.hasExternalDisplay)) {\n      const mirroring =\n        session.immersive && this.display.capabilities.hasExternalDisplay;\n\n      const iCanvas = session.baseLayer.context.canvas;\n      const iWidth = mirroring ? iCanvas.width / 2 : iCanvas.width;\n      const iHeight = iCanvas.height;\n\n      // @TODO Our test environment doesn't have the canvas package for now,\n      // but this could be something we add to the tests.\n      if (!TEST_ENV) {\n        const oCanvas = session.outputContext.canvas;\n        const oWidth = oCanvas.width;\n        const oHeight = oCanvas.height;\n\n        // The real underlying RenderContext that will display content\n        // for the polyfilled XRPresentationContext\n        const renderContext = session.renderContext;\n\n        // If we're using an ImageBitmapRenderingContext as our XRPresentationContext\n        if (this.HAS_BITMAP_SUPPORT) {\n          // If the developer is using an OffscreenCanvas, and ImageBitmapRenderingContext\n          // is supported, transfer the bitmap directly.\n          if (iCanvas.transferToImageBitmap) {\n            renderContext.transferFromImageBitmap(iCanvas.transferToImageBitmap());\n          }\n          // Otherwise we're using an HTMLCanvasElement, so we async generate\n          // a bitmap and then transfer the bitmap directly.\n          // @TODO does this technique result in always being a frame behind?\n          else {\n            this.global.createImageBitmap(iCanvas, 0, 0, iWidth, iHeight, {\n              resizeWidth: oWidth,\n              resizeHeight: oHeight,\n            }).then(bitmap => renderContext.transferFromImageBitmap(bitmap));\n          }\n        } else {\n\n          // We want to render only half of the layer context (left eye)\n          // proportional to the size of the outputContext canvas.\n          // ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\n          renderContext.drawImage(iCanvas, 0, 0, iWidth, iHeight,\n                                           0, 0, oWidth, oHeight);\n        }\n      }\n    }\n\n    // Only submit frame if we're presenting an immersive session.\n    // on a session will start presenting in 1.1 but we still have\n    // to set up the width/height correctly and wait for `baseLayer` to\n    // be set.\n    if (session.immersive && session.baseLayer) {\n      this.display.submitFrame();\n    }\n  }\n\n  /**\n   * @param {number} handle\n   */\n  cancelAnimationFrame(handle) {\n    this.display.cancelAnimationFrame(handle);\n  }\n\n  /**\n   * @TODO Spec\n   */\n  async endSession(sessionId) {\n    const session = this.sessions.get(sessionId);\n\n    if (session.ended) {\n      return;\n    }\n\n    // If this is an immersive session, end presenting;\n    // the vrdisplaypresentchange event will flip the `ended` bit.\n    if (session.immersive) {\n      return this.display.exitPresent();\n    } else {\n      session.ended = true;\n    }\n  }\n\n  /**\n   * @param {number} sessionId\n   * @param {XRReferenceSpaceType} type\n   * @return {boolean}\n   */\n  doesSessionSupportReferenceSpace(sessionId, type) {\n    const session = this.sessions.get(sessionId);\n    if (session.ended) {\n      return false;\n    }\n\n    return session.enabledFeatures.has(type);\n  }\n\n  /**\n   * If the VRDisplay has stage parameters, convert them\n   * to an array of X, Z pairings.\n   *\n   * @return {Object?}\n   */\n  requestStageBounds() {\n    if (this.display.stageParameters) {\n      const width = this.display.stageParameters.sizeX;\n      const depth = this.display.stageParameters.sizeZ;\n      const data = [];\n\n      data.push(-width / 2); // X\n      data.push(-depth / 2); // Z\n      data.push(width / 2); // X\n      data.push(-depth / 2); // Z\n      data.push(width / 2); // X\n      data.push(depth / 2); // Z\n      data.push(-width / 2); // X\n      data.push(depth / 2); // Z\n\n      return data;\n    }\n    return null;\n  }\n\n  /**\n   * Returns a promise resolving to a transform if XRDevice\n   * can support frame of reference and provides its own values.\n   * Can resolve to `undefined` if the polyfilled API can provide\n   * a default. Rejects if this XRDevice cannot\n   * support the frame of reference.\n   *\n   * @param {XRFrameOfReferenceType} type\n   * @param {XRFrameOfReferenceOptions} options\n   * @return {Promise<float32rray>}\n   */\n  async requestFrameOfReferenceTransform(type, options) {\n    if ((type === 'local-floor' || type === 'bounded-floor') &&\n        this.display.stageParameters &&\n        this.display.stageParameters.sittingToStandingTransform) {\n      return this.display.stageParameters.sittingToStandingTransform;\n    }\n\n    return null;\n  }\n\n  /**\n   * @param {XREye} eye\n   * @return {Float32Array}\n   */\n  getProjectionMatrix(eye) {\n    if (eye === 'left') {\n      return this.frame.leftProjectionMatrix;\n    } else if (eye === 'right') {\n      return this.frame.rightProjectionMatrix;\n    } else if (eye === 'none') {\n      return this.frame.leftProjectionMatrix;\n    } else {\n      throw new Error(`eye must be of type 'left' or 'right'`);\n    }\n  }\n\n  /**\n   * Takes a XREye and a target to apply properties of\n   * `x`, `y`, `width` and `height` on. Returns a boolean\n   * indicating if it successfully was able to populate\n   * target's values.\n   *\n   * @param {number} sessionId\n   * @param {XREye} eye\n   * @param {XRWebGLLayer} layer\n   * @param {Object?} target\n   * @return {boolean}\n   */\n  getViewport(sessionId, eye, layer, target) {\n    // @TODO can we have another layer passed in that\n    // wasn't the same one as the `baseLayer`?\n\n    const session = this.sessions.get(sessionId);\n    const { width, height } = layer.context.canvas;\n\n    // If this is a non-immersive session, return the\n    // whole canvas as the viewport\n    if (!session.immersive) {\n      target.x = target.y = 0;\n      target.width = width;\n      target.height = height;\n      return true;\n    }\n\n    // WebGL 1.1 viewports are just\n    if (eye === 'left' || eye === 'none') {\n      target.x = 0;\n    } else if (eye === 'right') {\n      target.x = width / 2;\n    } else {\n      return false;\n    }\n\n    target.y = 0;\n    target.width = width / 2;\n    target.height = height;\n\n    return true;\n  }\n\n  /**\n   * Get model matrix unaffected by frame of reference.\n   *\n   * @return {Float32Array}\n   */\n  getBasePoseMatrix() {\n    let { position, orientation } = this.frame.pose;\n    // On initialization, we might not have any values\n    if (!position && !orientation) {\n      return this.baseModelMatrix;\n    }\n    if (!position) {\n      position = this.tempVec3;\n      position[0] = position[1] = position[2] = 0;\n    }\n    mat4.fromRotationTranslation(this.baseModelMatrix, orientation, position);\n    return this.baseModelMatrix;\n  }\n\n  /**\n   * Get view matrix unaffected by frame of reference.\n   *\n   * @param {XREye} eye\n   * @return {Float32Array}\n   */\n  getBaseViewMatrix(eye) {\n    if (eye === 'left' || eye === 'none') {\n      return this.frame.leftViewMatrix;\n    } else if (eye === 'right') {\n      return this.frame.rightViewMatrix;\n    } else {\n      throw new Error(`eye must be of type 'left' or 'right'`);\n    }\n  }\n\n  getInputSources() {\n    let inputSources = [];\n    for (let i in this.gamepadInputSources) {\n      inputSources.push(this.gamepadInputSources[i].inputSource);\n    }\n    return inputSources;\n  }\n\n  getInputPose(inputSource, coordinateSystem, poseType) {\n    if (!coordinateSystem) {\n      return null;\n    }\n\n    for (let i in this.gamepadInputSources) {\n      let inputSourceImpl = this.gamepadInputSources[i];\n      if (inputSourceImpl.inputSource === inputSource) {\n        return inputSourceImpl.getXRPose(coordinateSystem, poseType);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Triggered on window resize.\n   *\n   */\n  onWindowResize() {\n  }\n\n  /**\n   * Listens to the Native 1.1 `window.addEventListener('vrdisplaypresentchange')`\n   * event.\n   *\n   * @param {Event} event\n   */\n  onVRDisplayPresentChange(e) {\n    if (!this.display.isPresenting) {\n      this.sessions.forEach(session => {\n        if (session.immersive && !session.ended) {\n          // If we injected and modified the canvas layer\n          // due to https://bugzil.la/1435339, then remove it from the DOM\n          // and remove styles.\n          if (session.modifiedCanvasLayer) {\n            const canvas = session.baseLayer.context.canvas;\n            document.body.removeChild(canvas);\n            canvas.setAttribute('style', '');\n          }\n          if (this.immersiveSession === session) {\n            this.immersiveSession = null;\n          }\n          this.dispatchEvent('@@webxr-polyfill/vr-present-end', session.id);\n        }\n      });\n    }\n  }\n}\n", "/*\n * Copyright 2019 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4';\nimport XRDevice from './XRDevice';\n\nconst TEST_ENV = process.env.NODE_ENV === 'test';\n\n/**\n * A Session helper class to mirror an XRSession and correlate\n * between an XRSession, and tracking sessions in a XRDevice.\n * Mostly referenced via `session.id` due to needing to verify\n * session creation is possible on the XRDevice before\n * the XRSession can be created.\n */\nlet SESSION_ID = 0;\nclass Session {\n  constructor(mode, enabledFeatures) {\n    this.mode = mode;\n    this.enabledFeatures = enabledFeatures;\n    this.ended = null;\n    this.baseLayer = null;\n    this.id = ++SESSION_ID;\n  }\n};\n\n/**\n * An XRDevice which only supports sensorless inline sessions, used as a\n * fallback when no other type of XRDevice is available as a way to satisfy the\n * spec requirement that inline sessions are always supported.\n */\nexport default class InlineDevice extends XRDevice {\n  /**\n   * Constructs an inline-only XRDevice\n   */\n  constructor(global) {\n    super(global);\n\n    this.sessions = new Map();\n    this.projectionMatrix = mat4.create();\n    this.identityMatrix = mat4.create();\n  }\n\n  /**\n   * Called when a XRSession has a `baseLayer` property set.\n   *\n   * @param {number} sessionId\n   * @param {XRWebGLLayer} layer\n   */\n  onBaseLayerSet(sessionId, layer) {\n    const session = this.sessions.get(sessionId);\n    session.baseLayer = layer;\n  }\n\n  /**\n   * Returns true if the requested mode is inline\n   *\n   * @param {XRSessionMode} mode\n   * @return {boolean}\n   */\n  isSessionSupported(mode) {\n    return mode == 'inline';\n  }\n\n  /**\n   * @param {string} featureDescriptor\n   * @return {boolean}\n   */\n  isFeatureSupported(featureDescriptor) {\n    switch(featureDescriptor) {\n      // Only viewer reference spaces are supported\n      case 'viewer': return true;\n      default: return false;\n    }\n  }\n\n  /**\n   * Returns a promise of a session ID if creating a session is successful.\n   *\n   * @param {XRSessionMode} mode\n   * @param {Set<string>} enabledFeatures\n   * @return {Promise<number>}\n   */\n  async requestSession(mode, enabledFeatures) {\n    if (!this.isSessionSupported(mode)) {\n      return Promise.reject();\n    }\n\n    const session = new Session(mode, enabledFeatures);\n\n    this.sessions.set(session.id, session);\n\n    return Promise.resolve(session.id);\n  }\n\n  /**\n   * @return {Function}\n   */\n  requestAnimationFrame(callback) {\n    return window.requestAnimationFrame(callback);\n  }\n\n  /**\n   * @param {number} handle\n   */\n  cancelAnimationFrame(handle) {\n    window.cancelAnimationFrame(handle);\n  }\n\n  onFrameStart(sessionId, renderState) {\n    // @TODO Our test environment doesn't have the canvas package for now,\n    // but this could be something we add to the tests.\n    if (TEST_ENV) {\n      return;\n    }\n\n    const session = this.sessions.get(sessionId);\n\n    // If the session is inline make sure the projection matrix matches the \n    // aspect ratio of the underlying WebGL canvas.\n    if (session.baseLayer) {\n      const canvas = session.baseLayer.context.canvas;\n      // Update the projection matrix.\n      mat4.perspective(this.projectionMatrix, renderState.inlineVerticalFieldOfView,\n          canvas.width/canvas.height, renderState.depthNear, renderState.depthFar);\n    }\n  }\n\n  onFrameEnd(sessionId) {\n    // Nothing to do here because inline always renders to the canvas backbuffer\n    // directly.\n  }\n\n  /**\n   * @TODO Spec\n   */\n  async endSession(sessionId) {\n    const session = this.sessions.get(sessionId);\n    session.ended = true;\n  }\n\n  /**\n   * @param {number} sessionId\n   * @param {XRReferenceSpaceType} type\n   * @return {boolean}\n   */\n  doesSessionSupportReferenceSpace(sessionId, type) {\n    const session = this.sessions.get(sessionId);\n    if (session.ended) {\n      return false;\n    }\n\n    return session.enabledFeatures.has(type);\n  }\n\n  /**\n   * Inline sessions don't have stage bounds\n   *\n   * @return {Object?}\n   */\n  requestStageBounds() {\n    return null;\n  }\n\n  /**\n   * Inline sessions don't have multiple frames of reference\n   *\n   * @param {XRFrameOfReferenceType} type\n   * @param {XRFrameOfReferenceOptions} options\n   * @return {Promise<Float32Array>}\n   */\n  async requestFrameOfReferenceTransform(type, options) {\n    return null;\n  }\n\n  /**\n   * @param {XREye} eye\n   * @return {Float32Array}\n   */\n  getProjectionMatrix(eye) {\n    return this.projectionMatrix;\n  }\n\n  /**\n   * Takes a XREye and a target to apply properties of\n   * `x`, `y`, `width` and `height` on. Returns a boolean\n   * indicating if it successfully was able to populate\n   * target's values.\n   *\n   * @param {number} sessionId\n   * @param {XREye} eye\n   * @param {XRWebGLLayer} layer\n   * @param {Object?} target\n   * @return {boolean}\n   */\n  getViewport(sessionId, eye, layer, target) {\n    // @TODO can we have another layer passed in that\n    // wasn't the same one as the `baseLayer`?\n\n    const session = this.sessions.get(sessionId);\n    const { width, height } = layer.context.canvas;\n\n    // Inline sessions return the whole canvas as the viewport\n    target.x = target.y = 0;\n    target.width = width;\n    target.height = height;\n    return true;\n  }\n\n  /**\n   * Get model matrix unaffected by frame of reference.\n   *\n   * @return {Float32Array}\n   */\n  getBasePoseMatrix() {\n    return this.identityMatrix;\n  }\n\n  /**\n   * Get view matrix unaffected by frame of reference.\n   *\n   * @param {XREye} eye\n   * @return {Float32Array}\n   */\n  getBaseViewMatrix(eye) {\n    return this.identityMatrix;\n  }\n\n  /**\n   * No persistent input sources for the inline session\n   */\n  getInputSources() {\n    return [];\n  }\n\n  getInputPose(inputSource, coordinateSystem, poseType) {\n    return null;\n  }\n\n  /**\n   * Triggered on window resize.\n   */\n  onWindowResize() {\n  }\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport CardboardXRDevice from './devices/CardboardXRDevice';\nimport InlineDevice from './devices/InlineDevice';\nimport WebVRDevice from './devices/WebVRDevice';\n\nimport { isMobile } from './utils';\n\n/**\n * Queries browser to see if any VRDisplay exists.\n * Resolves to a polyfilled XRDevice or null.\n */\nconst getWebVRDevice = async function (global) {\n  let device = null;\n  if ('getVRDisplays' in global.navigator) {\n    try {\n      const displays = await global.navigator.getVRDisplays();\n      if (displays && displays.length) {\n        device = new WebVRDevice(global, displays[0]);\n      }\n    } catch (e) {}\n  }\n\n  return device;\n};\n\n/**\n * Return an XRDevice interface based off of configuration\n * and platform.\n *\n * @param {Object} global\n * @param {Object} config\n * @return {Promise<XRDevice?>}\n */\nexport const requestXRDevice = async function (global, config) {\n  // Check for a 1.1 VRDisplay.\n  if (config.webvr) {\n    let xr = await getWebVRDevice(global);\n    if (xr) {\n      return xr;\n    }\n  }\n\n  // If no WebVR devices are present, check to see if a Cardboard device is\n  // allowed and if so return that.\n  // TODO: This probably requires more changes to allow creating an\n  // immersive session in a headset that gets connected later.\n  let mobile = isMobile(global);\n  if ((mobile && config.cardboard) ||\n      (!mobile && config.allowCardboardOnDesktop)) {\n    // If we're on Cardboard, make sure that VRFrameData is a global\n    if (!global.VRFrameData) {\n      global.VRFrameData = function () {\n        this.rightViewMatrix = new Float32Array(16);\n        this.leftViewMatrix = new Float32Array(16);\n        this.rightProjectionMatrix = new Float32Array(16);\n        this.leftProjectionMatrix = new Float32Array(16);\n        this.pose = null;\n      };\n    }\n\n    return new CardboardXRDevice(global, config.cardboardConfig);\n  }\n\n  // Inline sessions are always allowed, so if no other device is available\n  // create one that only supports sensorless inline sessions.\n  return new InlineDevice(global);\n}\n", "/*\n * Copyright 2017 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport GLOBAL from './lib/global';\nimport API from './api/index';\nimport {\n  polyfillMakeXRCompatible,\n  polyfillGetContext\n} from './polyfill-globals';\nimport { isImageBitmapSupported, isMobile } from './utils';\nimport { requestXRDevice } from './devices';\n\nconst CONFIG_DEFAULTS = {\n  // The default global to use for needed APIs.\n  global: GLOBAL,\n  // Whether support for a browser implementing WebVR 1.1 is enabled.\n  // If enabled, XR support is powered by native WebVR 1.1 VRDisplays,\n  // exposed as XRDevices.\n  webvr: true,\n  // Whether a CardboardXRDevice should be discoverable if on\n  // a mobile device, and no other native (1.1 VRDisplay if `webvr` on,\n  // or XRDevice) found.\n  cardboard: true,\n  // The configuration to be used for CardboardVRDisplay when used.\n  // Has no effect if `cardboard: false` or another XRDevice is used.\n  // Configuration can be found: https://github.com/immersive-web/cardboard-vr-display/blob/master/src/options.js\n  cardboardConfig: null,\n  // Whether a CardboardXRDevice should be created if no WebXR API found\n  // on desktop or not. Stereoscopic rendering with a gyro often does not make sense on desktop, and probably only useful for debugging.\n  allowCardboardOnDesktop: false,\n};\n\nconst partials = ['navigator', 'HTMLCanvasElement', 'WebGLRenderingContext'];\n\nexport default class WebXRPolyfill {\n  /**\n   * @param {object?} config\n   */\n  constructor(config={}) {\n    this.config = Object.freeze(Object.assign({}, CONFIG_DEFAULTS, config));\n    this.global = this.config.global;\n    this.nativeWebXR = 'xr' in this.global.navigator;\n    this.injected = false;\n\n    // If no native WebXR implementation found, inject one\n    if (!this.nativeWebXR) {\n      this._injectPolyfill(this.global);\n    } else {\n      this._injectCompatibilityShims(this.global);\n    }\n  }\n\n  _injectPolyfill(global) {\n    if (!partials.every(iface => !!global[iface])) {\n      throw new Error(`Global must have the following attributes : ${partials}`);\n    }\n\n    // Apply classes as globals\n    for (const className of Object.keys(API)) {\n      if (global[className] !== undefined) {\n        console.warn(`${className} already defined on global.`);\n      } else {\n        global[className] = API[className];\n      }\n    }\n\n    // Test environment does not have rendering contexts\n    if (process.env.NODE_ENV !== 'test') {\n      // Attempts to polyfill WebGLRenderingContext's `makeXRCompatible`\n      // if it does not exist.\n      const polyfilledCtx = polyfillMakeXRCompatible(global.WebGLRenderingContext);\n\n      // If we polyfilled `makeXRCompatible`, also polyfill the context creation\n      // parameter `{ xrCompatible }`.\n      if (polyfilledCtx) {\n        polyfillGetContext(global.HTMLCanvasElement);\n\n        // If OffscreenCanvas is available, patch its `getContext` method as well\n        // for the compatible XRDevice bit.\n        if (global.OffscreenCanvas) {\n          polyfillGetContext(global.OffscreenCanvas);\n        }\n\n        // If we needed to polyfill WebGLRenderingContext, do the same\n        // for WebGL2 contexts if it exists.\n        if (global.WebGL2RenderingContext){\n          polyfillMakeXRCompatible(global.WebGL2RenderingContext);\n        }\n\n        if (!window.isSecureContext) {\n          console.warn(`WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n`);\n        }\n      }\n    }\n\n    this.injected = true;\n\n    this._patchNavigatorXR();\n  }\n\n  _patchNavigatorXR() {\n    // Request a polyfilled XRDevice.\n    let devicePromise = requestXRDevice(this.global, this.config);\n\n    // Create `navigator.xr` instance populated with the XRDevice promise\n    // requested above. The promise resolve will be monitored by the XR object.\n    this.xr = new API.XRSystem(devicePromise);\n    Object.defineProperty(this.global.navigator, 'xr', {\n      value: this.xr,\n      configurable: true,\n    });\n  }\n\n  _injectCompatibilityShims(global) {\n    if (!partials.every(iface => !!global[iface])) {\n      throw new Error(`Global must have the following attributes : ${partials}`);\n    }\n\n    // Patch for Chrome 76-78: exposed supportsSession rather than\n    // isSessionSupported. Wraps the function to ensure the promise properly\n    // resolves with a boolean.\n    if (global.navigator.xr &&\n        'supportsSession' in global.navigator.xr &&\n        !('isSessionSupported' in global.navigator.xr)) {\n      let originalSupportsSession = global.navigator.xr.supportsSession;\n      global.navigator.xr.isSessionSupported = function(mode) {\n        return originalSupportsSession.call(this, mode).then(() => {\n          return true;\n        }).catch(() => {\n          return false;\n        });\n      }\n\n      global.navigator.xr.supportsSession = function(mode) {\n        console.warn(\"navigator.xr.supportsSession() is deprecated. Please \" +\n        \"call navigator.xr.isSessionSupported() instead and check the boolean \" +\n        \"value returned when the promise resolves.\");\n        return originalSupportsSession.call(this, mode);\n      }\n    }\n  }\n}\n", "import { hasFullscreenAPI } from \"@juniper-lib/dom/fullscreen\";\r\nimport { elementIsDisplayed, elementSetDisplay } from \"@juniper-lib/dom/tags\";\r\nimport { hasVR, hasWebVR, hasWebXR, isDefined, isMobileVR, TypedEvent, TypedEventBase } from \"@juniper-lib/tslib\";\r\nimport WebXRPolyfill from \"webxr-polyfill/src/WebXRPolyfill\";\r\nimport { ScreenMode } from \"./ScreenMode\";\r\nimport type { ScreenUI } from \"./ScreenUI\";\r\nimport type { ScreenModeToggleButton } from \"./widgets/ScreenModeToggleButton\";\r\n\r\nif (!navigator.xr) {\r\n    console.info(\"Polyfilling WebXR API\");\r\n    new WebXRPolyfill();\r\n}\r\n\r\nexport class XRSessionToggleEvent<T extends string> extends TypedEvent<T> {\r\n    constructor(type: T,\r\n        public readonly mode: ScreenMode,\r\n        public readonly session: XRSession,\r\n        public readonly referenceSpaceType: XRReferenceSpaceType,\r\n        public readonly sessionMode: XRSessionMode) {\r\n        super(type);\r\n    }\r\n}\r\n\r\nexport class XRSessionStartedEvent extends XRSessionToggleEvent<\"sessionstarted\"> {\r\n    constructor(mode: ScreenMode, session: XRSession, referenceSpaceType: XRReferenceSpaceType, sessionMode: XRSessionMode) {\r\n        super(\"sessionstarted\", mode, session, referenceSpaceType, sessionMode);\r\n    }\r\n}\r\n\r\nexport class XRSessionStoppedEvent extends XRSessionToggleEvent<\"sessionstopped\"> {\r\n    constructor(mode: ScreenMode, session: XRSession, referenceSpaceType: XRReferenceSpaceType, sessionMode: XRSessionMode) {\r\n        super(\"sessionstopped\", mode, session, referenceSpaceType, sessionMode);\r\n    }\r\n}\r\n\r\ninterface ScreenControlEvents {\r\n    sessionstarted: XRSessionStartedEvent;\r\n    sessionstopped: XRSessionStoppedEvent;\r\n}\r\n\r\nconst xrModes = new Map<ScreenMode, XRMode>([\r\n    [ScreenMode.VR, {\r\n        referenceSpaceType: \"local-floor\",\r\n        sessionMode: \"immersive-vr\"\r\n    }],\r\n    [ScreenMode.AR, {\r\n        referenceSpaceType: \"local-floor\",\r\n        sessionMode: \"immersive-ar\"\r\n    }]\r\n]);\r\n\r\ninterface XRMode {\r\n    referenceSpaceType: XRReferenceSpaceType;\r\n    sessionMode: XRSessionMode;\r\n}\r\n\r\nexport class ScreenControl\r\n    extends TypedEventBase<ScreenControlEvents> {\r\n\r\n    private _currentMode: ScreenMode = ScreenMode.None;\r\n    private buttons = new Map<ScreenMode, ScreenModeToggleButton>();\r\n    private currentSession: XRSession = null;\r\n    private screenUI: ScreenUI = null;\r\n    private readonly wasVisible = new Map<ScreenModeToggleButton, boolean>();\r\n\r\n    constructor(\r\n        private readonly renderer: THREE.WebGLRenderer,\r\n        private readonly camera: THREE.PerspectiveCamera,\r\n        private readonly fullscreenElement: HTMLElement,\r\n        private readonly enableFullResolution: boolean) {\r\n        super();\r\n\r\n        this.addEventListener(\"sessionstarted\", (evt) => {\r\n            if (evt.sessionMode === \"inline\") {\r\n                this.camera.fov = evt.session.renderState.inlineVerticalFieldOfView * 180 / Math.PI;\r\n            }\r\n        });\r\n\r\n        this.addEventListener(\"sessionstopped\", (evt) => {\r\n            if (evt.sessionMode === \"inline\") {\r\n                this.camera.fov = 50;\r\n            }\r\n        });\r\n\r\n        this.renderer.xr.addEventListener(\"sessionstart\", () => this.onSessionStarted());\r\n        this.renderer.xr.addEventListener(\"sessionend\", () => this.onSessionEnded());\r\n\r\n        this.refresh();\r\n    }\r\n\r\n    setUI(screenUI: ScreenUI, fullscreenButton: ScreenModeToggleButton, vrButton: ScreenModeToggleButton, arButton?: ScreenModeToggleButton) {\r\n        this.screenUI = screenUI;\r\n\r\n        this.buttons.set(fullscreenButton.mode, fullscreenButton);\r\n        this.buttons.set(vrButton.mode, vrButton);\r\n\r\n        if (arButton) {\r\n            this.buttons.set(arButton.mode, arButton);\r\n            arButton.available = hasWebXR();\r\n        }\r\n\r\n        for (const button of this.buttons.values()) {\r\n            this.wasVisible.set(button, button.visible);\r\n            button.addEventListener(\"click\", this.toggleMode.bind(this, button.mode));\r\n        }\r\n\r\n        fullscreenButton.available = !isMobileVR() && hasFullscreenAPI();\r\n        vrButton.available = hasVR();\r\n    }\r\n\r\n    get visible() {\r\n        return elementIsDisplayed(this.renderer.domElement);\r\n    }\r\n\r\n    set visible(v: boolean) {\r\n        elementSetDisplay(this.renderer.domElement, v);\r\n        if (this.screenUI) {\r\n            elementSetDisplay(this.screenUI, v, \"grid\");\r\n        }\r\n    }\r\n\r\n    get currentMode(): ScreenMode {\r\n        return this._currentMode;\r\n    }\r\n\r\n    private lastWidth: number = 0;\r\n    private lastHeight: number = 0;\r\n    resize(): void {\r\n        if (!this.renderer.xr.isPresenting) {\r\n            const width = this.renderer.domElement.clientWidth;\r\n            const height = this.renderer.domElement.clientHeight;\r\n            if (width > 0\r\n                && height > 0\r\n                && (width !== this.lastWidth\r\n                    || height !== this.lastHeight)) {\r\n                this.renderer.setPixelRatio(devicePixelRatio);\r\n                this.renderer.setSize(width, height, false);\r\n                this.camera.aspect = width / height;\r\n                this.camera.updateProjectionMatrix();\r\n                this.lastWidth = width;\r\n                this.lastHeight = height;\r\n            }\r\n        }\r\n    }\r\n\r\n    getMetrics() {\r\n        const width = this.renderer.domElement.clientWidth;\r\n        const height = this.renderer.domElement.clientHeight;\r\n        const pixelRatio = this.renderer.getPixelRatio();\r\n        const fov = this.camera.fov;\r\n        return { width, height, pixelRatio, fov };\r\n    }\r\n\r\n    setMetrics(width: number, height: number, pixelRatio: number, fov: number): void {\r\n        this.renderer.setPixelRatio(pixelRatio);\r\n        this.renderer.setSize(width, height, false);\r\n        this.camera.aspect = width / height;\r\n        this.camera.fov = fov;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n    async refresh(): Promise<void> {\r\n        await Promise.all(\r\n            Array.from(this.buttons.values())\r\n                .filter((btn) =>\r\n                    btn.available\r\n                    && btn.mode !== ScreenMode.Fullscreen)\r\n                .map(async (btn) => {\r\n                    const xrMode = xrModes.get(btn.mode);\r\n                    btn.available = isDefined(xrMode);\r\n                    if (btn.available) {\r\n                        const typeSupported = navigator.xr\r\n                            && await navigator.xr.isSessionSupported(xrMode.sessionMode);\r\n                        const webVROverride = !hasWebXR()\r\n                            && hasWebVR()\r\n                            && xrMode.sessionMode === \"immersive-vr\"\r\n                            && xrMode.referenceSpaceType === \"local-floor\";\r\n                        btn.available = typeSupported\r\n                            || webVROverride;\r\n                    }\r\n                }));\r\n    }\r\n\r\n    private async toggleMode(mode: ScreenMode): Promise<void> {\r\n        if (mode === ScreenMode.Fullscreen) {\r\n            await this.toggleFullscreen();\r\n        }\r\n        else if (mode !== ScreenMode.None) {\r\n            await this.toggleXR(mode);\r\n        }\r\n    }\r\n\r\n    async start(mode: ScreenMode): Promise<void> {\r\n        if (mode !== this.currentMode) {\r\n            await this.toggleMode(this.currentMode);\r\n            await this.toggleMode(mode);\r\n        }\r\n    }\r\n\r\n    async stop(): Promise<void> {\r\n        await this.toggleMode(this.currentMode);\r\n    }\r\n\r\n    get isFullscreen(): boolean {\r\n        return document.fullscreen;\r\n    }\r\n\r\n    private async startFullscreen() {\r\n        if (!this.isFullscreen) {\r\n            await this.fullscreenElement.requestFullscreen({\r\n                navigationUI: \"show\"\r\n            });\r\n            this.setActive(ScreenMode.Fullscreen);\r\n            this.dispatchEvent(new XRSessionStartedEvent(ScreenMode.Fullscreen, null, null, null));\r\n        }\r\n    }\r\n\r\n    private async stopFullscreen() {\r\n        if (this.isFullscreen) {\r\n            await document.exitFullscreen();\r\n            this.setActive(ScreenMode.None);\r\n            this.dispatchEvent(new XRSessionStoppedEvent(ScreenMode.Fullscreen, null, null, null));\r\n        }\r\n    }\r\n\r\n    private async toggleFullscreen(): Promise<void> {\r\n        if (this.isFullscreen) {\r\n            await this.stopFullscreen();\r\n        }\r\n        else {\r\n            await this.startFullscreen();\r\n        }\r\n    }\r\n\r\n    private async toggleXR(mode: ScreenMode): Promise<void> {\r\n        const xrMode = xrModes.get(mode);\r\n        if (isDefined(xrMode)) {\r\n            if (this.currentSession) {\r\n                this.currentSession.end();\r\n            }\r\n            else if (navigator.xr) {\r\n                this.camera.position.setScalar(0);\r\n                this.camera.quaternion.identity();\r\n                // WebXR\"s requestReferenceSpace only works if the corresponding feature\r\n                // was requested at session creation time. For simplicity, just ask for\r\n                // the interesting ones as optional features, but be aware that the\r\n                // requestReferenceSpace call will fail if it turns out to be unavailable.\r\n                // (\"local\" is always available for immersive sessions and doesn\"t need to\r\n                // be requested separately.)\r\n                try {\r\n                    const session = await navigator.xr.requestSession(xrMode.sessionMode, {\r\n                        optionalFeatures: [\r\n                            \"local-floor\",\r\n                            \"bounded-floor\",\r\n                            \"high-refresh-rate\",\r\n                            \"hand-tracking\",\r\n                            \"layers\"\r\n                        ]\r\n                    });\r\n\r\n\r\n                    this.setActive(mode);\r\n                    this.currentSession = session;\r\n                    this.renderer.xr.setReferenceSpaceType(xrMode.referenceSpaceType);\r\n                    if (this.enableFullResolution\r\n                        && \"XRWebGLLayer\" in window\r\n                        && \"getNativeFramebufferScaleFactor\" in XRWebGLLayer) {\r\n                        const size = XRWebGLLayer.getNativeFramebufferScaleFactor(session);\r\n                        this.renderer.xr.setFramebufferScaleFactor(size);\r\n                    }\r\n                    this.renderer.xr.setSession(session as any);\r\n                }\r\n                catch (exp) {\r\n                    console.error(`Couldn't start session type '${xrMode.sessionMode}'. Reason: ${exp && exp.message || exp || 'UNKNOWN'}`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private onSessionStarted() {\r\n        const mode = this.currentMode;\r\n        const xrMode = xrModes.get(this.currentMode);\r\n        const session = this.currentSession;\r\n\r\n        if (session.supportedFrameRates) {\r\n            const max = Math.max(...session.supportedFrameRates);\r\n            console.log(\"Changing framerate to\", max);\r\n            session.updateTargetFrameRate(max);\r\n        }\r\n\r\n        this.dispatchEvent(new XRSessionStartedEvent(\r\n            mode,\r\n            session,\r\n            xrMode.referenceSpaceType,\r\n            xrMode.sessionMode));\r\n    }\r\n\r\n    private onSessionEnded() {\r\n        const mode = this.currentMode;\r\n        const xrMode = xrModes.get(this.currentMode);\r\n        const session = this.currentSession;\r\n        this.currentSession = null;\r\n        this.renderer.xr.setSession(null);\r\n        this.setActive(ScreenMode.None);\r\n        this.dispatchEvent(new XRSessionStoppedEvent(\r\n            mode,\r\n            session,\r\n            xrMode.referenceSpaceType,\r\n            xrMode.sessionMode));\r\n    }\r\n\r\n    private setActive(mode: ScreenMode): void {\r\n        for (const button of this.buttons.values()) {\r\n            button.active = button.mode === mode;\r\n            button.visible = this.wasVisible.get(button)\r\n                && (mode === ScreenMode.None\r\n                    || button.mode === mode\r\n                    || mode === ScreenMode.Fullscreen);\r\n        }\r\n\r\n        this._currentMode = mode;\r\n    }\r\n}", "import { CubeMapFaceIndex } from \"@juniper-lib/graphics2d/CubeMapFaceIndex\";\r\nimport type { CanvasImageTypes, CanvasTypes, Context2D } from \"@juniper-lib/dom/canvas\";\r\nimport { createUtilityCanvas } from \"@juniper-lib/dom/canvas\";\r\nimport { isArray, isDefined, isGoodNumber, isNumber } from \"@juniper-lib/tslib\";\r\nimport { cleanup } from \"./cleanup\";\r\nimport type { BaseEnvironment } from \"./environment/BaseEnvironment\";\r\nimport { isEuler, isQuaternion } from \"./typeChecks\";\r\n\r\ntype SkyboxRotation = THREE.Quaternion | THREE.Euler | number[] | number;\r\n\r\nconst U = new THREE.Vector3(0, 1, 0);\r\nconst FACE_SIZE = 2048;\r\nconst FACE_SIZE_HALF = FACE_SIZE / 2;\r\nconst FACES = [1,\r\n    0,\r\n    2,\r\n    3,\r\n    4,\r\n    5\r\n];\r\n\r\nexport const CUBEMAP_PATTERN = {\r\n    rows: 3,\r\n    columns: 4,\r\n    indices: [\r\n        [CubeMapFaceIndex.None, CubeMapFaceIndex.Up, CubeMapFaceIndex.None, CubeMapFaceIndex.None],\r\n        [CubeMapFaceIndex.Left, CubeMapFaceIndex.Front, CubeMapFaceIndex.Right, CubeMapFaceIndex.Back],\r\n        [CubeMapFaceIndex.None, CubeMapFaceIndex.Down, CubeMapFaceIndex.None, CubeMapFaceIndex.None]\r\n    ],\r\n    rotations: [\r\n        [0, Math.PI, 0, 0],\r\n        [0, 0, 0, 0],\r\n        [0, Math.PI, 0, 0]\r\n    ]\r\n};\r\n\r\nconst black = new THREE.Color(0x000000);\r\n\r\nexport class Skybox {\r\n\r\n    private readonly rt = new THREE.WebGLCubeRenderTarget(FACE_SIZE);\r\n    private readonly rtScene = new THREE.Scene();\r\n    private readonly rtCamera = new THREE.CubeCamera(0.01, 10, this.rt);\r\n    private readonly _rotation = new THREE.Quaternion();\r\n    private readonly layerRotation = new THREE.Quaternion().identity();\r\n    private readonly stageRotation = new THREE.Quaternion().identity();\r\n\r\n    private images: CanvasImageTypes[] = null;\r\n    private readonly canvases = new Array<CanvasTypes>(6);\r\n    private readonly contexts = new Array<Context2D>(6);\r\n\r\n    private cube: THREE.CubeTexture;\r\n    private readonly flipped: CanvasTypes;\r\n    private readonly flipper: Context2D;\r\n    \r\n    private curImagePath: string = null;\r\n    private layer: XRCubeLayer = null;\r\n    private wasVisible = false;\r\n    private wasWebXRLayerAvailable: boolean = null;\r\n    private stageHeading = 0;\r\n    private rotationNeedsUpdate = false;\r\n    private imageNeedsUpdate = false;\r\n    private webXRLayerEnabled = true;\r\n\r\n    visible = true;\r\n\r\n    constructor(private readonly env: BaseEnvironment<unknown>) {\r\n\r\n        this.webXRLayerEnabled &&= this.env.hasXRCompositionLayers;\r\n\r\n        this.env.scene.background = black;\r\n\r\n        for (let i = 0; i < this.canvases.length; ++i) {\r\n            const f = this.canvases[i] = createUtilityCanvas(FACE_SIZE, FACE_SIZE);\r\n            this.contexts[i] = f.getContext(\"2d\");\r\n        }\r\n\r\n        for (let row = 0; row < CUBEMAP_PATTERN.rows; ++row) {\r\n            const indices = CUBEMAP_PATTERN.indices[row];\r\n            const rotations = CUBEMAP_PATTERN.rotations[row];\r\n            for (let column = 0; column < CUBEMAP_PATTERN.columns; ++column) {\r\n                const i = indices[column];\r\n                if (i > -1) {\r\n                    const g = this.contexts[i];\r\n                    const rotation = rotations[column];\r\n                    if (rotation > 0) {\r\n                        if ((rotation % 2) === 0) {\r\n                            g.translate(FACE_SIZE_HALF, FACE_SIZE_HALF);\r\n                        }\r\n                        else {\r\n                            g.translate(FACE_SIZE_HALF, FACE_SIZE_HALF);\r\n                        }\r\n                        g.rotate(rotation);\r\n                        g.translate(-FACE_SIZE_HALF, -FACE_SIZE_HALF);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        this.rt.texture.name = \"SkyboxOutput\";\r\n        this.rtScene.add(this.rtCamera);\r\n\r\n        this.flipped = createUtilityCanvas(FACE_SIZE, FACE_SIZE);\r\n        this.flipper = this.flipped.getContext(\"2d\");\r\n        this.flipper.fillStyle = black.getHexString();\r\n        this.flipper.scale(-1, 1);\r\n        this.flipper.translate(-FACE_SIZE, 0);\r\n\r\n        this.setImages(\"\", this.canvases);\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    setImage(imageID: string, image: CanvasImageTypes) {\r\n        if (imageID !== this.curImagePath) {\r\n            const width = image.width / CUBEMAP_PATTERN.columns;\r\n            const height = image.height / CUBEMAP_PATTERN.rows;\r\n            for (let row = 0; row < CUBEMAP_PATTERN.rows; ++row) {\r\n                const indices = CUBEMAP_PATTERN.indices[row];\r\n                for (let column = 0; column < CUBEMAP_PATTERN.columns; ++column) {\r\n                    const i = indices[column];\r\n                    if (i > -1) {\r\n                        const g = this.contexts[i];\r\n                        g.drawImage(\r\n                            image,\r\n                            column * width, row * height,\r\n                            width, height,\r\n                            0, 0,\r\n                            FACE_SIZE, FACE_SIZE);\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.setImages(imageID, this.canvases);\r\n        }\r\n    }\r\n\r\n    setImages(imageID: string, images: CanvasImageTypes[]) {\r\n        if (imageID !== this.curImagePath\r\n            || images !== this.images) {\r\n\r\n            this.curImagePath = imageID;\r\n\r\n            if (images !== this.images) {\r\n                if (isDefined(this.cube)) {\r\n                    cleanup(this.cube);\r\n                }\r\n\r\n                this.images = images;\r\n\r\n                this.rtScene.background = this.cube = new THREE.CubeTexture(this.images);\r\n                this.cube.name = \"SkyboxInput\";\r\n            }\r\n        }\r\n\r\n        this.updateImages();\r\n    }\r\n\r\n    updateImages() {\r\n        this.cube.needsUpdate = true;\r\n        this.imageNeedsUpdate = true;\r\n    }\r\n\r\n    get rotation(): THREE.Quaternion {\r\n        return this._rotation;\r\n    }\r\n\r\n    set rotation(rotation: SkyboxRotation) {\r\n        const { x, y, z, w } = this._rotation;\r\n\r\n        if (isQuaternion(rotation)) {\r\n            this._rotation.copy(rotation);\r\n        }\r\n        else if (isEuler(rotation)) {\r\n            this._rotation.setFromEuler(rotation);\r\n        }\r\n        else if (isArray(rotation)) {\r\n            if (rotation.length === 4\r\n                && isNumber(rotation[0])\r\n                && isNumber(rotation[1])\r\n                && isNumber(rotation[2])\r\n                && isNumber(rotation[3])) {\r\n                this._rotation.fromArray(rotation);\r\n            }\r\n            else {\r\n                throw new Error(\"Skybox rotation was not a valid array format. Needs an array of 4 numbers.\");\r\n            }\r\n        }\r\n        else if (isGoodNumber(rotation)) {\r\n            this._rotation.setFromAxisAngle(U, rotation);\r\n        }\r\n        else {\r\n            if (isDefined(rotation)) {\r\n                console.warn(\"Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis).\");\r\n            }\r\n            this._rotation.identity();\r\n        }\r\n\r\n        this.rotationNeedsUpdate = this._rotation.x !== x\r\n            || this._rotation.y !== y\r\n            || this._rotation.z !== z\r\n            || this._rotation.w !== w;\r\n    }\r\n\r\n    update(frame: XRFrame) {\r\n        if (this.cube) {\r\n            const isWebXRLayerAvailable = this.webXRLayerEnabled\r\n                && this.env.renderer.xr.isPresenting\r\n                && isDefined(frame)\r\n                && isDefined(this.env.xrBinding);\r\n\r\n            if (isWebXRLayerAvailable !== this.wasWebXRLayerAvailable) {\r\n                if (isWebXRLayerAvailable) {\r\n                    const space = this.env.renderer.xr.getReferenceSpace();\r\n\r\n                    this.layer = this.env.xrBinding.createCubeLayer({\r\n                        space,\r\n                        layout: \"mono\",\r\n                        isStatic: false,\r\n                        viewPixelWidth: FACE_SIZE,\r\n                        viewPixelHeight: FACE_SIZE\r\n                    });\r\n\r\n                    this.env.addWebXRLayer(this.layer, Number.MAX_VALUE);\r\n                }\r\n                else if (this.layer) {\r\n                    this.env.removeWebXRLayer(this.layer);\r\n                    this.layer.destroy();\r\n                    this.layer = null;\r\n                }\r\n\r\n                this.imageNeedsUpdate\r\n                    = this.rotationNeedsUpdate\r\n                    = true;\r\n            }\r\n\r\n            this.env.scene.background = this.layer\r\n                ? null\r\n                : this.visible\r\n                    ? this.rt.texture\r\n                    : black;\r\n\r\n            if (this.layer) {\r\n                if (this.visible !== this.wasVisible\r\n                    || this.layer.needsRedraw) {\r\n                    this.imageNeedsUpdate = true;\r\n                }\r\n\r\n                if (this.env.avatar.heading !== this.stageHeading) {\r\n                    this.rotationNeedsUpdate = true;\r\n                    this.stageHeading = this.env.avatar.heading;\r\n                    this.stageRotation.setFromAxisAngle(U, this.env.avatar.heading);\r\n                }\r\n            }\r\n            else {\r\n                this.rotationNeedsUpdate\r\n                    = this.imageNeedsUpdate\r\n                    = this.imageNeedsUpdate\r\n                    || this.rotationNeedsUpdate;\r\n            }\r\n\r\n            if (this.rotationNeedsUpdate) {\r\n                this.layerRotation\r\n                    .copy(this.rotation)\r\n                    .invert();\r\n\r\n                if (this.layer) {\r\n                    this.layerRotation.multiply(this.stageRotation);\r\n                    this.layer.orientation = new DOMPointReadOnly(\r\n                        this.layerRotation.x,\r\n                        this.layerRotation.y,\r\n                        this.layerRotation.z,\r\n                        this.layerRotation.w);\r\n                }\r\n                else {\r\n                    this.rtCamera.quaternion.copy(this.layerRotation);\r\n                }\r\n            }\r\n\r\n\r\n            if (this.imageNeedsUpdate) {\r\n                if (this.layer) {\r\n                    const gl = this.env.renderer.getContext();\r\n                    const gLayer = this.env.xrBinding.getSubImage(this.layer, frame);\r\n                    const imgs = this.cube.images as CanvasImageTypes[];\r\n\r\n                    this.flipper.fillRect(0, 0, FACE_SIZE, FACE_SIZE);\r\n\r\n                    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n                    gl.bindTexture(gl.TEXTURE_CUBE_MAP, gLayer.colorTexture);\r\n\r\n                    for (let i = 0; i < imgs.length; ++i) {\r\n                        if (this.visible) {\r\n                            const img = imgs[FACES[i]];\r\n                            this.flipper.drawImage(\r\n                                img,\r\n                                0, 0, img.width, img.height,\r\n                                0, 0, FACE_SIZE, FACE_SIZE);\r\n                        }\r\n\r\n                        gl.texSubImage2D(\r\n                            gl.TEXTURE_CUBE_MAP_POSITIVE_X + i,\r\n                            0,\r\n                            0, 0,\r\n                            gl.RGBA,\r\n                            gl.UNSIGNED_BYTE,\r\n                            this.flipped);\r\n                    }\r\n\r\n                    gl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\r\n                }\r\n                else {\r\n                    this.rtCamera.update(this.env.renderer, this.rtScene);\r\n                }\r\n            }\r\n\r\n            this.imageNeedsUpdate = false;\r\n            this.rotationNeedsUpdate = false;\r\n            this.wasVisible = this.visible;\r\n            this.wasWebXRLayerAvailable = isWebXRLayerAvailable;\r\n        }\r\n    }\r\n}", "import { arrayRemove, BaseTimerTickEvent, isDefined, ITimer } from \"@juniper-lib/tslib\";\r\n\r\nexport class XRTimerTickEvent extends BaseTimerTickEvent {\r\n    frame?: XRFrame = null;\r\n\r\n    constructor() {\r\n        super();\r\n        Object.seal(this);\r\n    }\r\n\r\n    override set(t: number, dt: number, frame?: XRFrame) {\r\n        super.set(t, dt);\r\n        this.frame = frame;\r\n    }\r\n}\r\n\r\ntype TimerTickCallback = (evt: XRTimerTickEvent) => void;\r\n\r\nexport class XRTimer implements ITimer {\r\n    private tickHandlers = new Array<TimerTickCallback>();\r\n    private _onTick: (t: number, frame?: XRFrame) => void;\r\n    private lt = -1;\r\n\r\n    constructor(private readonly renderer: THREE.WebGLRenderer) {\r\n        const tickEvt = new XRTimerTickEvent();\r\n        let dt = 0;\r\n        this._onTick = (t: number, frame?: XRFrame) => {\r\n            if (this.lt >= 0) {\r\n                dt = t - this.lt;\r\n                tickEvt.set(t, dt, frame);\r\n                this.tick(tickEvt);\r\n            }\r\n            this.lt = t;\r\n        };\r\n    }\r\n\r\n    private _isRunning = false;\r\n    get isRunning() {\r\n        return this._isRunning;\r\n    }\r\n\r\n    restart() {\r\n        this.stop();\r\n        this.start();\r\n    }\r\n\r\n    addTickHandler(onTick: (evt: XRTimerTickEvent) => void): void {\r\n        this.tickHandlers.push(onTick);\r\n    }\r\n\r\n    removeTickHandler(onTick: (evt: XRTimerTickEvent) => void): void {\r\n        arrayRemove(this.tickHandlers, onTick);\r\n    }\r\n\r\n    private setAnimationLoop(loop: XRFrameRequestCallback) {\r\n        this.renderer.setAnimationLoop(loop);\r\n        this._isRunning = isDefined(loop);\r\n    }\r\n\r\n    start() {\r\n        if (!this.isRunning) {\r\n            this.setAnimationLoop(this._onTick);\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        if (this.isRunning) {\r\n            this.setAnimationLoop(null);\r\n            this.lt = -1;\r\n        }\r\n    }\r\n\r\n    private tick(evt: XRTimerTickEvent): void {\r\n        for (const handler of this.tickHandlers) {\r\n            handler(evt);\r\n        }\r\n    }\r\n}\r\n", "import { CanvasTypes, isHTMLCanvas } from \"@juniper-lib/dom/canvas\";\r\nimport {\r\n    border,\r\n    height,\r\n    left,\r\n    margin,\r\n    padding,\r\n    position,\r\n    rule,\r\n    top,\r\n    touchAction,\r\n    width\r\n} from \"@juniper-lib/dom/css\";\r\nimport { Style } from \"@juniper-lib/dom/tags\";\r\nimport type { IFetcher } from \"@juniper-lib/fetcher\";\r\nimport {\r\n    arrayRemove, arraySortByKeyInPlace, IProgress, isDefined,\r\n    isDesktop,\r\n    isFirefox, isFunction, isOculusBrowser, oculusBrowserVersion, TimerTickEvent, TypedEvent, TypedEventBase\r\n} from \"@juniper-lib/tslib\";\r\nimport { feet2Meters } from \"@juniper-lib/tslib/units/length\";\r\nimport { BodyFollower } from \"../animation/BodyFollower\";\r\nimport { updateScalings } from \"../animation/scaleOnHover\";\r\nimport { AvatarLocal } from \"../AvatarLocal\";\r\nimport { CameraControl } from \"../CameraFOVControl\";\r\nimport { cleanup } from \"../cleanup\";\r\nimport { Cursor3D } from \"../eventSystem/Cursor3D\";\r\nimport { EventSystem } from \"../eventSystem/EventSystem\";\r\nimport { GLTFLoader } from \"../examples/loaders/GLTFLoader\";\r\nimport { Fader } from \"../Fader\";\r\nimport { IModelLoader } from \"../IModelLoader\";\r\nimport { IWebXRLayerManager } from \"../IWebXRLayerManager\";\r\nimport { FOREGROUND, PURGATORY } from \"../layers\";\r\nimport { LoadingBar } from \"../LoadingBar\";\r\nimport { obj, objGraph } from \"../objects\";\r\nimport { resolveCamera } from \"../resolveCamera\";\r\nimport { ScreenControl } from \"../ScreenControl\";\r\nimport { Skybox } from \"../Skybox\";\r\nimport { XRTimer, XRTimerTickEvent } from \"./XRTimer\";\r\n\r\n\r\nconst spectator = new THREE.PerspectiveCamera();\r\nconst lastViewport = new THREE.Vector4();\r\nconst curViewport = new THREE.Vector4();\r\n\r\nconst gridWidth = 15;\r\nconst gridSize = feet2Meters(gridWidth);\r\n\r\ninterface BaseEnvironmentEvents {\r\n    sceneclearing: TypedEvent<\"sceneclearing\">;\r\n    scenecleared: TypedEvent<\"scenecleared\">;\r\n    quitting: TypedEvent<\"quitting\">;\r\n    newcursorloaded: TypedEvent<\"newcursorloaded\">;\r\n}\r\n\r\nStyle(\r\n    rule(\"#frontBuffer\",\r\n        position(\"absolute\"),\r\n        left(0),\r\n        top(0),\r\n        width(\"100%\"),\r\n        height(\"100%\"),\r\n        margin(0),\r\n        padding(0),\r\n        border(0),\r\n        touchAction(\"none\")\r\n    )\r\n);\r\n\r\nexport class BaseEnvironment<Events = void>\r\n    extends TypedEventBase<Events & BaseEnvironmentEvents>\r\n    implements IWebXRLayerManager, IModelLoader {\r\n\r\n    private baseLayer: XRWebGLLayer | XRProjectionLayer;\r\n    private readonly layers = new Array<XRLayer>();\r\n    private readonly layerSortOrder = new Map<XRLayer, number>();\r\n\r\n    private readonly fader: Fader;\r\n    private fadeDepth = 0;\r\n\r\n    readonly cursor3D = new Cursor3D();\r\n    readonly camera = new THREE.PerspectiveCamera(50, 1, 0.01, 1000);\r\n    readonly scene = new THREE.Scene();\r\n    readonly stage = obj(\"Stage\");\r\n    readonly ambient = new THREE.AmbientLight(0xffffff, 0.5);\r\n    readonly sun = new THREE.DirectionalLight(0xffffff, 0.75);\r\n    readonly ground = new THREE.GridHelper(gridSize, gridWidth, 0xc0c0c0, 0x808080);\r\n    readonly foreground = obj(\"Foreground\");\r\n    readonly loadingBar = new LoadingBar();\r\n\r\n    readonly renderer: THREE.WebGLRenderer;\r\n    readonly timer: XRTimer;\r\n    readonly worldUISpace: BodyFollower;\r\n    readonly skybox: Skybox;\r\n    readonly avatar: AvatarLocal;\r\n    readonly fovControl: CameraControl;\r\n    readonly screenControl: ScreenControl;\r\n    readonly eventSystem: EventSystem;\r\n\r\n    enableSpectator = false;\r\n\r\n    constructor(canvas: CanvasTypes, public readonly fetcher: IFetcher, public readonly defaultAvatarHeight: number, enableFullResolution: boolean, public DEBUG: boolean) {\r\n        super();\r\n\r\n        if (isHTMLCanvas(canvas)) {\r\n            canvas.style.backgroundColor = \"black\";\r\n        }\r\n\r\n        this.renderer = new THREE.WebGLRenderer({\r\n            canvas,\r\n            powerPreference: \"high-performance\",\r\n            precision: \"lowp\",\r\n            antialias: true,\r\n            alpha: true,\r\n            premultipliedAlpha: true,\r\n            depth: true,\r\n            logarithmicDepthBuffer: true,\r\n            stencil: false,\r\n            preserveDrawingBuffer: false\r\n        });\r\n\r\n        this.renderer.domElement.tabIndex = 1;\r\n\r\n        this.fovControl = new CameraControl(this.camera);\r\n\r\n        this.screenControl = new ScreenControl(\r\n            this.renderer,\r\n            this.camera,\r\n            this.renderer.domElement.parentElement,\r\n            enableFullResolution);\r\n\r\n\r\n        this.fader = new Fader(\"ViewFader\");\r\n\r\n        this.worldUISpace = new BodyFollower(\"WorldUISpace\", 0.2, 20, 0.125);\r\n\r\n        this.avatar = new AvatarLocal(\r\n            this.renderer,\r\n            this.camera,\r\n            this.fader,\r\n            defaultAvatarHeight);\r\n\r\n\r\n        this.eventSystem = new EventSystem(this);\r\n\r\n        this.skybox = new Skybox(this);\r\n\r\n        this.timer = new XRTimer(this.renderer);\r\n\r\n        this.renderer.xr.enabled = true;\r\n        this.sun.name = \"Sun\";\r\n        this.sun.position.set(0, 1, 1);\r\n        this.sun.lookAt(0, 0, 0);\r\n        this.sun.layers.enableAll();\r\n\r\n        const showGround = () => {\r\n            this.ground.visible = this.renderer.xr.isPresenting;\r\n        };\r\n        this.screenControl.addEventListener(\"sessionstarted\", showGround);\r\n        this.screenControl.addEventListener(\"sessionstopped\", showGround);\r\n        showGround();\r\n\r\n        this.ambient.name = \"Fill\";\r\n        this.ambient.layers.enableAll();\r\n\r\n        this.loadingBar.object.name = \"MainLoadingBar\";\r\n        this.loadingBar.object.position.set(0, -0.25, -2);\r\n\r\n        this.scene.layers.enableAll();\r\n\r\n        this.avatar.addFollower(this.worldUISpace);\r\n\r\n        this.timer.addTickHandler((evt) => this.update(evt));\r\n\r\n        objGraph(this.scene,\r\n            this.sun,\r\n            this.ambient,\r\n            objGraph(this.stage,\r\n                this.ground,\r\n                this.camera,\r\n                this.avatar,\r\n                ...this.eventSystem.hands\r\n            ),\r\n            this.foreground,\r\n            objGraph(this.worldUISpace,\r\n                this.loadingBar\r\n            )\r\n        );\r\n\r\n        this.timer.start();\r\n\r\n        (globalThis as any).env = this;\r\n    }\r\n\r\n    get gl(): WebGLRenderingContext {\r\n        return this.renderer.getContext();\r\n    }\r\n\r\n    get referenceSpace(): XRReferenceSpace {\r\n        return this.renderer.xr.getReferenceSpace();\r\n    }\r\n\r\n    private update(evt: XRTimerTickEvent): void {\r\n        if (this.screenControl.visible) {\r\n            const session = this.xrSession;\r\n\r\n            this._xrBinding = this.renderer.xr.getBinding();\r\n\r\n            if (this.hasXRMediaLayers && (this._xrMediaBinding === null) === this.renderer.xr.isPresenting) {\r\n                if (this._xrMediaBinding === null && isDefined(session)) {\r\n                    this._xrMediaBinding = new XRMediaBinding(session);\r\n                    console.log(\"Media binding created\");\r\n                }\r\n                else {\r\n                    this._xrMediaBinding = null;\r\n                }\r\n            }\r\n\r\n            const baseLayer = session && this.renderer.xr.getBaseLayer();\r\n            if (baseLayer !== this.baseLayer) {\r\n                if (isDefined(this.baseLayer)) {\r\n                    this.removeWebXRLayer(this.baseLayer);\r\n                    this.baseLayer = null;\r\n                }\r\n\r\n                if (isDefined(baseLayer)) {\r\n                    this.baseLayer = baseLayer;\r\n                    this.addWebXRLayer(baseLayer, 0);\r\n                }\r\n            }\r\n\r\n            this.screenControl.resize();\r\n            this.eventSystem.update();\r\n            this.fovControl.update(evt.dt);\r\n            this.avatar.update(evt.dt);\r\n            this.worldUISpace.update(this.avatar.height, this.avatar.worldPos, this.avatar.worldHeading, evt.dt);\r\n            this.fader.update(evt.dt);\r\n            updateScalings(evt.dt);\r\n            this.loadingBar.update(evt.sdt);\r\n\r\n            this.preRender(evt);\r\n\r\n            this.skybox.update(evt.frame);\r\n\r\n            const cam = resolveCamera(this.renderer, this.camera);\r\n            if (cam !== this.camera) {\r\n                const vrCam = cam as THREE.WebXRArrayCamera;\r\n                vrCam.layers.mask = this.camera.layers.mask;\r\n                for (let i = 0; i < vrCam.cameras.length; ++i) {\r\n                    const subCam = vrCam.cameras[i];\r\n                    subCam.layers.mask = this.camera.layers.mask;\r\n                    subCam.layers.enable(i + 1);\r\n                    vrCam.layers.enable(i + 1);\r\n                }\r\n            }\r\n\r\n            this.renderer.clear();\r\n            this.renderer.render(this.scene, this.camera);\r\n            if (this.enableSpectator) {\r\n                if (!this.renderer.xr.isPresenting) {\r\n                    lastViewport.copy(curViewport);\r\n                    this.renderer.getViewport(curViewport);\r\n                }\r\n                else if (isDesktop()\r\n                    && !isFirefox()) {\r\n                    spectator.projectionMatrix.copy(this.camera.projectionMatrix);\r\n                    spectator.position.copy(cam.position);\r\n                    spectator.quaternion.copy(cam.quaternion);\r\n                    const curRT = this.renderer.getRenderTarget();\r\n                    this.renderer.xr.isPresenting = false;\r\n                    this.renderer.setRenderTarget(null);\r\n                    this.renderer.setViewport(lastViewport);\r\n                    this.renderer.clear();\r\n                    this.renderer.render(this.scene, spectator);\r\n                    this.renderer.setViewport(curViewport);\r\n                    this.renderer.setRenderTarget(curRT);\r\n                    this.renderer.xr.isPresenting = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected preRender(_evt: TimerTickEvent) {\r\n    }\r\n\r\n    protected async onQuitting(): Promise<void> {\r\n        this.dispatchEvent(new TypedEvent(\"quitting\"));\r\n        window.location.href = \"/\";\r\n    }\r\n\r\n    get hasAlpha() {\r\n        return this.renderer.getContextAttributes().alpha;\r\n    }\r\n\r\n    get xrSession(): XRSession {\r\n        return this.renderer.xr.getSession();\r\n    }\r\n\r\n    private _xrBinding: XRWebGLBinding = null;\r\n    get xrBinding(): XRWebGLBinding {\r\n        return this._xrBinding;\r\n    }\r\n\r\n    private _xrMediaBinding: XRMediaBinding = null;\r\n    get xrMediaBinding(): XRMediaBinding {\r\n        return this._xrMediaBinding;\r\n    }\r\n\r\n    private get isReadyForLayers(): boolean {\r\n        return this.hasAlpha\r\n            && (!isOculusBrowser\r\n                || oculusBrowserVersion.major >= 15);\r\n    }\r\n\r\n    private _hasXRMediaLayers: boolean = null;\r\n    get hasXRMediaLayers(): boolean {\r\n        if (this._hasXRMediaLayers === null) {\r\n            this._hasXRMediaLayers = this.isReadyForLayers\r\n                && \"XRMediaBinding\" in globalThis\r\n                && isFunction(XRMediaBinding.prototype.createQuadLayer);\r\n        }\r\n\r\n        return this._hasXRMediaLayers;\r\n    }\r\n\r\n    private _hasXRCompositionLayers: boolean = null;\r\n    get hasXRCompositionLayers(): boolean {\r\n        if (this._hasXRCompositionLayers === null) {\r\n            this._hasXRCompositionLayers = this.isReadyForLayers\r\n                && \"XRWebGLBinding\" in globalThis\r\n                && isFunction(XRWebGLBinding.prototype.createCubeLayer);\r\n        }\r\n\r\n        return this._hasXRCompositionLayers;\r\n    }\r\n\r\n    addWebXRLayer(layer: XRLayer, sortOrder: number) {\r\n        this.layers.push(layer);\r\n        this.layerSortOrder.set(layer, sortOrder);\r\n        arraySortByKeyInPlace(this.layers, (l) => -this.layerSortOrder.get(l));\r\n        this.updateLayers();\r\n    }\r\n\r\n    removeWebXRLayer(layer: XRLayer) {\r\n        this.layerSortOrder.delete(layer);\r\n        arrayRemove(this.layers, layer);\r\n        this.updateLayers();\r\n    }\r\n\r\n    private updateLayers() {\r\n        const session = this.xrSession;\r\n        if (isDefined(session)) {\r\n            session.updateRenderState({\r\n                layers: this.layers\r\n            });\r\n        }\r\n    }\r\n\r\n    clearScene() {\r\n        this.dispatchEvent(new TypedEvent(\"sceneclearing\"));\r\n        cleanup(this.foreground);\r\n        this.dispatchEvent(new TypedEvent(\"scenecleared\"));\r\n    }\r\n\r\n    async fadeOut() {\r\n        ++this.fadeDepth;\r\n        if (this.fadeDepth === 1) {\r\n            await this.fader.fadeOut();\r\n            this.skybox.visible = false;\r\n            this.camera.layers.set(PURGATORY);\r\n            this.loadingBar.start();\r\n            await this.fader.fadeIn();\r\n        }\r\n    }\r\n\r\n    async fadeIn() {\r\n        --this.fadeDepth;\r\n        if (this.fadeDepth === 0) {\r\n            await this.fader.fadeOut();\r\n            this.camera.layers.set(FOREGROUND);\r\n            this.skybox.visible = true;\r\n            await this.fader.fadeIn();\r\n        }\r\n    }\r\n\r\n    async loadModel(path: string, prog?: IProgress): Promise<THREE.Group> {\r\n        const loader = new GLTFLoader();\r\n        const model = await loader.loadAsync(path, (evt) => {\r\n            if (isDefined(prog)) {\r\n                prog.report(evt.loaded, evt.total, path);\r\n            }\r\n        });\r\n        return model.scene;\r\n    }\r\n\r\n    async load3DCursor(path: string, prog?: IProgress) {\r\n        const model = await this.loadModel(path, prog);\r\n        const children = model.children.slice(0);\r\n        for (const child of children) {\r\n            this.cursor3D.add(child.name, child);\r\n        }\r\n        this.eventSystem.refreshCursors();\r\n        this.dispatchEvent(new TypedEvent(\"newcursorloaded\"));\r\n    }\r\n\r\n    async load(prog?: IProgress) {\r\n        await this.load3DCursor(\"/models/Cursors.glb\", prog);\r\n    }\r\n}\r\n", "import { Analyser, ErsatzAudioNode, removeVertex } from \"@juniper-lib/audio/nodes\";\r\n\r\nexport class ActivityDetector implements ErsatzAudioNode {\r\n\r\n    private _level = 0;\r\n    private maxLevel = 0;\r\n    private analyzer: AnalyserNode;\r\n    private buffer: Uint8Array;\r\n\r\n    constructor(private readonly name: string, audioCtx: AudioContext) {\r\n        this.analyzer = Analyser(this.name, audioCtx, {\r\n            fftSize: 32,\r\n            minDecibels: -70\r\n        });\r\n\r\n        this.buffer = new Uint8Array(this.analyzer.frequencyBinCount);\r\n    }\r\n\r\n    dispose() {\r\n        removeVertex(this.analyzer);\r\n    }\r\n\r\n    get level() {\r\n        this.analyzer.getByteFrequencyData(this.buffer);\r\n        this._level = Math.max(...this.buffer);\r\n        if (isFinite(this._level)) {\r\n            this.maxLevel = Math.max(this.maxLevel, this._level);\r\n            if (this.maxLevel > 0) {\r\n                this._level /= this.maxLevel;\r\n            }\r\n        }\r\n\r\n        return this._level;\r\n    }\r\n\r\n    get input() {\r\n        return this.analyzer;\r\n    }\r\n\r\n    get output() {\r\n        return this.analyzer;\r\n    }\r\n}\r\n", "import { className } from \"@juniper-lib/dom/attrs\";\r\nimport { columnGap, display, gridAutoFlow, gridTemplateColumns, rule } from \"@juniper-lib/dom/css\";\r\nimport { Div, ElementChild, ErsatzElement, InputNumber, InputRange, Style } from \"@juniper-lib/dom/tags\";\r\nimport { TypedEvent, TypedEventBase } from \"@juniper-lib/tslib\";\r\n\r\nStyle(\r\n    rule(\".input-range-with-number\",\r\n        display(\"grid\"),\r\n        gridAutoFlow(\"column\"),\r\n        columnGap(\"5px\"),\r\n        gridTemplateColumns(\"1fr auto\"))\r\n);\r\n\r\nexport class InputRangeWithNumberElement\r\n    extends TypedEventBase<{\r\n        \"input\": TypedEvent<\"input\">;\r\n    }>\r\n    implements ErsatzElement {\r\n    public readonly element: HTMLElement;\r\n    private rangeInput: HTMLInputElement;\r\n    private numberInput: HTMLInputElement;\r\n\r\n    constructor(...rest: ElementChild[]) {\r\n        super();\r\n\r\n        this.element = Div(\r\n            className(\"input-range-with-number\"),\r\n            this.rangeInput = InputRange(...rest),\r\n            this.numberInput = InputNumber());\r\n\r\n        this.numberInput.min = this.rangeInput.min;\r\n        this.numberInput.max = this.rangeInput.max;\r\n        this.numberInput.step = this.rangeInput.step;\r\n        this.numberInput.valueAsNumber = this.rangeInput.valueAsNumber;\r\n        this.numberInput.disabled = this.rangeInput.disabled;\r\n        this.numberInput.placeholder = this.rangeInput.placeholder;\r\n\r\n        this.numberInput.addEventListener(\"input\", () => {\r\n            this.rangeInput.valueAsNumber = this.numberInput.valueAsNumber;\r\n            this.rangeInput.dispatchEvent(new Event(\"input\"));\r\n        });\r\n\r\n        this.rangeInput.addEventListener(\"input\", () => {\r\n            this.numberInput.valueAsNumber = this.rangeInput.valueAsNumber;\r\n            this.dispatchEvent(new TypedEvent(\"input\"));\r\n        });\r\n    }\r\n\r\n    get value(): string {\r\n        return this.rangeInput.value;\r\n    }\r\n\r\n    set value(v: string) {\r\n        this.rangeInput.value\r\n            = this.numberInput.value\r\n            = v;\r\n    }\r\n\r\n    get valueAsNumber(): number {\r\n        return this.rangeInput.valueAsNumber;\r\n    }\r\n\r\n    set valueAsNumber(v: number) {\r\n        this.rangeInput.valueAsNumber = this.numberInput.valueAsNumber = v;\r\n    }\r\n\r\n    get disabled(): boolean {\r\n        return this.rangeInput.disabled;\r\n    }\r\n\r\n    set disabled(v: boolean) {\r\n        this.rangeInput.disabled\r\n            = this.numberInput.disabled\r\n            = v;\r\n    }\r\n}\r\n\r\nexport function InputRangeWithNumber(...rest: ElementChild[]) {\r\n    return new InputRangeWithNumberElement(...rest);\r\n}", "import { display, gridAutoFlow, gridColumn, gridTemplateColumns, margin, marginInlineStart, paddingRight, rule, textAlign, width } from \"@juniper-lib/dom/css\";\r\nimport { DD, Div, DL, DT, elementApply, ElementChild, elementSetDisplay, ErsatzElement, H2, isErsatzElement, isErsatzElements, Label, Style } from \"@juniper-lib/dom/tags\";\r\nimport { identity, isArray, isBoolean, isDate, isNumber, isString, stringRandom } from \"@juniper-lib/tslib\";\r\n\r\ntype PropertyElement = [string, ...ElementChild[]] | string | ElementChild;\r\n\r\nclass PropertyGroup {\r\n    readonly properties: PropertyElement[];\r\n\r\n    constructor(public readonly name: string, ...properties: PropertyElement[]) {\r\n        this.properties = properties;\r\n    }\r\n}\r\n\r\nexport function group(name: string, ...properties: PropertyElement[]) {\r\n    return new PropertyGroup(name, ...properties);\r\n}\r\n\r\ntype Property = PropertyElement | PropertyGroup;\r\ntype RowElement = Exclude<ElementChild, string | number | boolean | Date>;\r\ntype Row = Array<RowElement>;\r\n\r\nStyle(\r\n    rule(\"dl\",\r\n        display(\"grid\"),\r\n        gridAutoFlow(\"row\"),\r\n        gridTemplateColumns(\"auto 1fr\"),\r\n        margin(\"1em\")\r\n    ),\r\n\r\n    rule(\"dt\",\r\n        gridColumn(1),\r\n        textAlign(\"right\"),\r\n        paddingRight(\"1em\")\r\n    ),\r\n\r\n    rule(\"dd\",\r\n        textAlign(\"left\"),\r\n        gridColumn(2),\r\n        marginInlineStart(\"0\")\r\n    ),\r\n\r\n    rule(\"dl > span, dl > div\",\r\n        gridColumn(1, 3)\r\n    ),\r\n\r\n    rule(\"dl .alert\",\r\n        width(\"20em\"))\r\n);\r\n\r\nconst DEFAULT_PROPERTY_GROUP = \"DefaultPropertyGroup\" + stringRandom(16);\r\n\r\nexport class PropertyList\r\n    implements ErsatzElement {\r\n\r\n    public readonly element: HTMLElement;\r\n    private readonly rowGroups = new Map<string, Row[]>();\r\n\r\n    constructor(...rest: Property[]) {\r\n        this.element = DL(...this.createElements(rest));\r\n    }\r\n\r\n    append(...rest: Property[]): void {\r\n        elementApply(this.element, ...this.createElements(rest));\r\n    }\r\n\r\n    private createElements(rest: Property[]) {\r\n        return rest.flatMap((entry) =>\r\n            this.createGroups(entry)\r\n                .flatMap(identity));\r\n    }\r\n\r\n    private createGroups(entry: Property): Row[] {\r\n        let name: string = DEFAULT_PROPERTY_GROUP;\r\n        const group = new Array<Row>();\r\n\r\n        if (entry instanceof PropertyGroup) {\r\n            name = entry.name;\r\n            group.push(...entry.properties.map((e) => this.createRow(e)));\r\n        }\r\n        else {\r\n            group.push(this.createRow(entry));\r\n        }\r\n\r\n        if (!this.rowGroups.has(name)) {\r\n            this.rowGroups.set(name, []);\r\n        }\r\n\r\n        this.rowGroups.get(name).push(...group);\r\n        return group;\r\n    }\r\n\r\n    private createRow(entry: PropertyElement): Row {\r\n        if (isArray(entry)) {\r\n            const [labelText, ...fields] = entry;\r\n            const label = Label(labelText);\r\n            for (const field of fields) {\r\n                if (field instanceof HTMLInputElement\r\n                    || field instanceof HTMLTextAreaElement\r\n                    || field instanceof HTMLSelectElement) {\r\n                    if (field.id.length === 0) {\r\n                        field.id = stringRandom(10);\r\n                    }\r\n                    label.htmlFor = field.id;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            return [\r\n                DT(label),\r\n                DD(...fields)\r\n            ];\r\n        }\r\n        else if (isString(entry)\r\n            || isNumber(entry)\r\n            || isBoolean(entry)\r\n            || isDate(entry)) {\r\n            return [\r\n                Div(H2(entry))\r\n            ];\r\n        }\r\n        else {\r\n            return [\r\n                entry\r\n            ];\r\n        }\r\n    }\r\n\r\n    setGroupVisible(id: string, v: boolean): void {\r\n        const rows = this.rowGroups.get(id);\r\n        if (rows) {\r\n            for (const row of rows) {\r\n                for (const elem of row) {\r\n                    if (isErsatzElements(elem)) {\r\n                        for (const e of elem.elements) {\r\n                            elementSetDisplay(e, v);\r\n                        }\r\n                    }\r\n                    else if (isErsatzElement(elem) || elem instanceof HTMLElement) {\r\n                        elementSetDisplay(elem, v);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function PropList(...rest: Property[]) {\r\n    return new PropertyList(...rest);\r\n}", "import { canChangeAudioOutput } from \"@juniper-lib/audio/DeviceManager\";\r\nimport { connect } from \"@juniper-lib/audio/nodes\";\r\nimport {\r\n    className,\r\n    max,\r\n    min,\r\n    step,\r\n    title,\r\n    value\r\n} from \"@juniper-lib/dom/attrs\";\r\nimport { buttonSetEnabled } from \"@juniper-lib/dom/buttonSetEnabled\";\r\nimport { marginLeft, minWidth, styles } from \"@juniper-lib/dom/css\";\r\nimport { onClick, onInput } from \"@juniper-lib/dom/evts\";\r\nimport {\r\n    ButtonSecondary,\r\n    Div,\r\n    elementApply,\r\n    elementSetDisplay,\r\n    InputCheckbox,\r\n    Meter,\r\n    Option,\r\n    Select\r\n} from \"@juniper-lib/dom/tags\";\r\nimport { makeLookup, SetTimeoutTimer, stringRandom } from \"@juniper-lib/tslib\";\r\nimport { ActivityDetector } from \"@juniper-lib/webrtc/ActivityDetector\";\r\nimport { DialogBox } from \"@juniper-lib/widgets/DialogBox\";\r\nimport { InputRangeWithNumber, InputRangeWithNumberElement } from \"@juniper-lib/widgets/InputRangeWithNumber\";\r\nimport { group, PropertyList } from \"@juniper-lib/widgets/PropertyList\";\r\nimport type { Environment } from \"./Environment\";\r\n\r\nconst MIC_GROUP = \"micFields\" + stringRandom(8);\r\n\r\nexport class DeviceDialog extends DialogBox {\r\n    private micLookup: Map<string, MediaDeviceInfo> = null;\r\n    private spkrLookup: Map<string, MediaDeviceInfo> = null;\r\n\r\n    private readonly microphones: HTMLSelectElement;\r\n    private readonly micScenario: HTMLMeterElement;\r\n    private readonly activity: ActivityDetector;\r\n    private readonly micVolumeControl: InputRangeWithNumberElement;\r\n    private readonly spkrVolumeControl: InputRangeWithNumberElement = null;\r\n    private ready: Promise<void> = null;\r\n    private readonly speakers: HTMLSelectElement = null;\r\n    private readonly properties: PropertyList;\r\n    private readonly testSpkrButton: HTMLButtonElement;\r\n    private readonly useHeadphones: HTMLInputElement;\r\n    private readonly headphoneWarning: HTMLDivElement;\r\n\r\n    private readonly timer = new SetTimeoutTimer(30);\r\n\r\n    constructor(private readonly env: Environment) {\r\n        super(\"Configure devices\");\r\n\r\n        this.cancelButton.style.display = \"none\";\r\n\r\n        const clipLoaded = this.env.audio.loadBasicClip(\"test-audio\", \"/audio/test-clip.mp3\", 0.5);\r\n\r\n        elementApply(this.container,\r\n            styles(\r\n                minWidth(\"max-content\")));\r\n\r\n        elementApply(this.contentArea,\r\n            this.properties = new PropertyList(\r\n                group(\r\n                    MIC_GROUP,\r\n                    \"Input\",\r\n\r\n                    [\"Microphones\",\r\n                        this.microphones = Select(\r\n                            onInput(async () => {\r\n                                const deviceId = this.microphones.value;\r\n                                const device = this.micLookup.get(deviceId);\r\n                                await this.env.audio.devices.setAudioInputDevice(device);\r\n                            })\r\n                        )],\r\n\r\n                    [\"Input level\",\r\n                        this.micScenario = Meter()],\r\n\r\n                    [\"Volume\", this.micVolumeControl = InputRangeWithNumber(\r\n                        min(0),\r\n                        max(100),\r\n                        step(1),\r\n                        value(0),\r\n                        onInput(() => {\r\n                            env.audio.input.gain.setValueAtTime(this.micVolumeControl.valueAsNumber / 100, 0);\r\n                        })\r\n                    )],\r\n\r\n                    \"Output\"\r\n                )\r\n            )\r\n        );\r\n\r\n        this.env.audio.devices.addEventListener(\"audioinputchanged\", (evt) => {\r\n            this.microphones.value = evt.audio && evt.audio.deviceId || \"\";\r\n        });\r\n\r\n        if (canChangeAudioOutput) {\r\n            this.properties.append(\r\n                [\"Speakers\",\r\n                    this.speakers = Select(\r\n                        onInput(async () => {\r\n                            const deviceId = this.speakers.value;\r\n                            const device = this.spkrLookup.get(deviceId);\r\n                            await this.env.audio.devices.setAudioOutputDevice(device);\r\n                        })\r\n                    )]\r\n            );\r\n\r\n            this.env.audio.devices.addEventListener(\"audiooutputchanged\", (evt) => {\r\n                this.speakers.value = evt.device && evt.device.deviceId || \"\";\r\n            });\r\n        }\r\n\r\n        this.properties.append(\r\n            [\"Using headphones\",\r\n                this.useHeadphones = InputCheckbox(\r\n                    onInput(() => {\r\n                        this.env.audio.useHeadphones = this.useHeadphones.checked;\r\n                        elementSetDisplay(this.headphoneWarning, !this.env.audio.useHeadphones, \"inline-block\");\r\n                    })\r\n                ),\r\n\r\n                this.testSpkrButton = ButtonSecondary(\"Test\",\r\n                    title(\"Test audio\"),\r\n                    styles(\r\n                        marginLeft(\"0.5em\")\r\n                    ),\r\n                    onClick(async () => {\r\n                        buttonSetEnabled(this.testSpkrButton, false, \"secondary\");\r\n                        await clipLoaded;\r\n                        await this.env.audio.playClipThrough(\"test-audio\");\r\n                        buttonSetEnabled(this.testSpkrButton, true, \"secondary\");\r\n                    }))],\r\n\r\n            this.headphoneWarning = Div(\r\n                className(\"alert alert-warning\"),\r\n                \"\uD83C\uDFA7\uD83C\uDF99\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones.\"\r\n            ),\r\n\r\n            [\"Volume\",\r\n                this.spkrVolumeControl = InputRangeWithNumber(\r\n                    min(0),\r\n                    max(100),\r\n                    step(1),\r\n                    value(0),\r\n                    onInput(() =>\r\n                        env.audio.audioDestination.volume\r\n                        = this.spkrVolumeControl.valueAsNumber / 100)\r\n                )]\r\n        );\r\n\r\n        this.activity = new ActivityDetector(\"device-settings-dialog-activity\", this.env.audio.audioCtx);\r\n\r\n        this.timer.addTickHandler(() => {\r\n            this.micScenario.value = this.activity.level;\r\n        });\r\n    }\r\n\r\n    private async load() {\r\n        await this.env.audio.ready;\r\n        await this.env.audio.devices.ready;\r\n\r\n        const mics = await this.env.audio.devices.getAudioInputDevices();\r\n        this.micLookup = makeLookup(mics, (m) => m.deviceId);\r\n\r\n        elementApply(this.microphones,\r\n            Option(value(\"\"), \"NONE\"),\r\n            ...mics.map((device) =>\r\n                Option(\r\n                    value(device.deviceId),\r\n                    device.label\r\n                )\r\n            )\r\n        );\r\n\r\n        if (canChangeAudioOutput) {\r\n            const spkrs = await this.env.audio.devices.getAudioOutputDevices();\r\n            this.spkrLookup = makeLookup(spkrs, (device) => device.deviceId);\r\n\r\n            elementApply(this.speakers,\r\n                ...spkrs.map((device) =>\r\n                    Option(\r\n                        value(device.deviceId),\r\n                        device.label\r\n                    )\r\n                )\r\n            );\r\n        }\r\n\r\n        connect(this.env.audio.input, this.activity);\r\n    }\r\n\r\n    protected override async onShowing(): Promise<void> {\r\n        if (this.ready === null) {\r\n            this.ready = this.load();\r\n        }\r\n        await this.ready;\r\n\r\n        const curMic = await this.env.audio.devices.getAudioInputDevice();\r\n        this.microphones.value = curMic && curMic.deviceId || \"\";\r\n        this.micVolumeControl.valueAsNumber = this.env.audio.input.gain.value * 100;\r\n\r\n        if (canChangeAudioOutput) {\r\n            const curSpker = await this.env.audio.devices.getAudioOutputDevice();\r\n            this.speakers.value = curSpker && curSpker.deviceId || \"\";\r\n        }\r\n\r\n        this.spkrVolumeControl.valueAsNumber = this.env.audio.audioDestination.volume * 100;\r\n\r\n        this.useHeadphones.checked = this.env.audio.useHeadphones;\r\n        elementSetDisplay(this.headphoneWarning, !this.env.audio.useHeadphones, \"inline-block\");\r\n\r\n        this.timer.start();\r\n\r\n        await super.onShowing();\r\n    }\r\n\r\n    protected override onClosed() {\r\n        this.timer.stop();\r\n        super.onClosed();\r\n    }\r\n\r\n    private _showMic = true;\r\n    get showMic(): boolean {\r\n        return this._showMic;\r\n    }\r\n\r\n    set showMic(v: boolean) {\r\n        if (v !== this.showMic) {\r\n            this._showMic = v;\r\n            this.properties.setGroupVisible(MIC_GROUP, this.showMic);\r\n        }\r\n    }\r\n}", "import { ArtificialHorizon } from \"@juniper-lib/graphics2d/ArtificialHorizon\";\r\nimport { BatteryImage } from \"@juniper-lib/graphics2d/BatteryImage\";\r\nimport { ClockImage } from \"@juniper-lib/graphics2d/ClockImage\";\r\nimport { AudioManager } from \"@juniper-lib/audio/AudioManager\";\r\nimport { AudioPlayer } from \"@juniper-lib/audio/sources/AudioPlayer\";\r\nimport type { CanvasTypes } from \"@juniper-lib/dom/canvas\";\r\nimport { elementApply } from \"@juniper-lib/dom/tags\";\r\nimport type { IFetcher } from \"@juniper-lib/fetcher\";\r\nimport { hasVR, IProgress, isDesktop, isMobile, isMobileVR, PriorityMap, progressTasks, rad2deg, TypedEvent } from \"@juniper-lib/tslib\";\r\nimport { DEFAULT_LOCAL_USER_ID } from \"@juniper-lib/webrtc/constants\";\r\nimport { ButtonFactory } from \"../ButtonFactory\";\r\nimport { ConfirmationDialog } from \"../ConfirmationDialog\";\r\nimport { InteractionAudio } from \"../eventSystem/InteractionAudio\";\r\nimport { ScreenMode } from \"../ScreenMode\";\r\nimport { ScreenUI } from \"../ScreenUI\";\r\nimport { SpaceUI } from \"../SpaceUI\";\r\nimport { VideoPlayer3D } from \"../VideoPlayer3D\";\r\nimport { ButtonImageWidget } from \"../widgets/ButtonImageWidget\";\r\nimport { CanvasImageMesh } from \"../widgets/CanvasImageMesh\";\r\nimport { ScreenModeToggleButton } from \"../widgets/ScreenModeToggleButton\";\r\nimport { ToggleButton } from \"../widgets/ToggleButton\";\r\nimport { widgetSetEnabled } from \"../widgets/widgets\";\r\nimport { ApplicationLoader } from \"./ApplicationLoader\";\r\nimport { BaseEnvironment } from \"./BaseEnvironment\";\r\nimport { DeviceDialog } from \"./DeviceDialog\";\r\nimport { XRTimerTickEvent } from \"./XRTimer\";\r\n\r\nexport class EnvironmentRoomJoinedEvent extends TypedEvent<\"roomjoined\"> {\r\n    constructor(public readonly roomName: string) {\r\n        super(\"roomjoined\");\r\n    }\r\n}\r\n\r\nexport interface EnvironmentEvents {\r\n    home: TypedEvent<\"home\">;\r\n    environmentaudiotoggled: TypedEvent<\"environmentaudiotoggled\">;\r\n    roomjoined: EnvironmentRoomJoinedEvent;\r\n}\r\n\r\nexport interface EnvironmentOptions {\r\n    JS_EXT: string;\r\n    DEBUG: boolean;\r\n}\r\n\r\nexport class Environment\r\n    extends BaseEnvironment<EnvironmentEvents> {\r\n\r\n    readonly audio: AudioManager;\r\n    readonly interactionAudio: InteractionAudio;\r\n\r\n    readonly xrUI: SpaceUI;\r\n    readonly screenUISpace = new ScreenUI();\r\n    readonly confirmationDialog: ConfirmationDialog;\r\n    readonly compassImage: CanvasImageMesh<ArtificialHorizon>;\r\n    readonly clockImage: CanvasImageMesh<ClockImage>;\r\n    readonly batteryImage: CanvasImageMesh<BatteryImage>;\r\n    readonly settingsButton: ButtonImageWidget;\r\n    readonly muteMicButton: ToggleButton;\r\n    readonly muteEnvAudioButton: ToggleButton;\r\n    readonly quitButton: ButtonImageWidget;\r\n    readonly lobbyButton: ButtonImageWidget;\r\n    //readonly arButton: ScreenModeToggleButton;\r\n    readonly vrButton: ScreenModeToggleButton;\r\n    readonly fullscreenButton: ScreenModeToggleButton;\r\n    readonly devicesDialog: DeviceDialog;\r\n    readonly apps: ApplicationLoader;\r\n    readonly uiButtons: ButtonFactory;\r\n    readonly audioPlayer: AudioPlayer;\r\n    readonly videoPlayer: VideoPlayer3D;\r\n\r\n    private readonly envAudioToggleEvt = new TypedEvent(\"environmentaudiotoggled\");\r\n\r\n    private _currentRoom: string = null;\r\n    get currentRoom() {\r\n        return this._currentRoom;\r\n    }\r\n\r\n    constructor(canvas: CanvasTypes,\r\n        fetcher: IFetcher,\r\n        dialogFontFamily: string,\r\n        uiImagePaths: PriorityMap<string, string, string>,\r\n        defaultAvatarHeight: number,\r\n        enableFullResolution: boolean,\r\n        options?: Partial<EnvironmentOptions>) {\r\n        super(canvas, fetcher, defaultAvatarHeight, enableFullResolution, options && options.DEBUG);\r\n\r\n        this.compassImage = new CanvasImageMesh(this, \"Horizon\", new ArtificialHorizon());\r\n        this.compassImage.mesh.renderOrder = 5;\r\n\r\n        this.clockImage = new CanvasImageMesh(this, \"Clock\", new ClockImage());\r\n        this.clockImage.mesh.renderOrder = 5;\r\n\r\n        options = options || {};\r\n        const JS_EXT = options.JS_EXT || \".js\";\r\n\r\n        this.apps = new ApplicationLoader(this, JS_EXT);\r\n        this.apps.addEventListener(\"apploading\", (evt) => {\r\n            evt.preLoadTask = this.fadeOut()\r\n                .then(() => {\r\n                    this.clearScene();\r\n                    this.avatar.reset();\r\n                });\r\n        });\r\n\r\n        this.apps.addEventListener(\"apploaded\", (evt) => {\r\n            evt.app.addEventListener(\"joinroom\", (evt) => {\r\n                if (evt.roomName !== this._currentRoom) {\r\n                    this._currentRoom = evt.roomName;\r\n                    this.dispatchEvent(new EnvironmentRoomJoinedEvent(evt.roomName));\r\n                }\r\n            });\r\n        });\r\n\r\n        this.apps.addEventListener(\"appshown\", async (evt) => {\r\n            this.lobbyButton.visible = evt.appName !== \"menu\";\r\n            await this.fadeIn();\r\n        });\r\n\r\n        this.audio = new AudioManager(DEFAULT_LOCAL_USER_ID);\r\n        this.audio.setAudioProperties(1, 4, \"exponential\");\r\n\r\n        this.audioPlayer = new AudioPlayer(this.audio.audioCtx);\r\n\r\n        this.videoPlayer = new VideoPlayer3D(this, this.audio.audioCtx);\r\n        this.videoPlayer.object.visible = false;\r\n\r\n        this.interactionAudio = new InteractionAudio(this.audio, this.eventSystem);\r\n\r\n        this.confirmationDialog = new ConfirmationDialog(this, dialogFontFamily);\r\n        this.devicesDialog = new DeviceDialog(this);\r\n\r\n        elementApply(\r\n            this.renderer.domElement.parentElement,\r\n            this.screenUISpace,\r\n            this.confirmationDialog,\r\n            this.devicesDialog);\r\n\r\n        this.uiButtons = new ButtonFactory(this.fetcher, uiImagePaths, 20);\r\n\r\n        this.settingsButton = new ButtonImageWidget(this.uiButtons, \"ui\", \"settings\");\r\n        this.quitButton = new ButtonImageWidget(this.uiButtons, \"ui\", \"quit\");\r\n        this.lobbyButton = new ButtonImageWidget(this.uiButtons, \"ui\", \"lobby\");\r\n        this.muteMicButton = new ToggleButton(this.uiButtons, \"microphone\", \"mute\", \"unmute\");\r\n        this.muteEnvAudioButton = new ToggleButton(this.uiButtons, \"environment-audio\", \"mute\", \"unmute\");\r\n\r\n        this.vrButton = new ScreenModeToggleButton(this.uiButtons, ScreenMode.VR);\r\n        this.fullscreenButton = new ScreenModeToggleButton(this.uiButtons, ScreenMode.Fullscreen);\r\n        //this.arButton = new ScreenModeToggleButton(this.uiButtons, ScreenMode.AR);\r\n\r\n        this.xrUI = new SpaceUI();\r\n        this.xrUI.addItem(this.clockImage, { x: -1, y: 1, scale: 1 });\r\n        this.xrUI.addItem(this.quitButton, { x: 1, y: 1, scale: 0.5 });\r\n        this.xrUI.addItem(this.confirmationDialog, { x: 0, y: 0, scale: 0.25 });\r\n        this.xrUI.addItem(this.settingsButton, { x: -1, y: -1, scale: 0.5 });\r\n        this.xrUI.addItem(this.muteMicButton, { x: -0.84, y: -1, scale: 0.5 });\r\n        this.xrUI.addItem(this.muteEnvAudioButton, { x: -0.68, y: -1, scale: 0.5 });\r\n        this.xrUI.addItem(this.lobbyButton, { x: -0.473, y: -1, scale: 0.5 });\r\n        this.xrUI.addItem(this.vrButton, { x: 1, y: -1, scale: 0.5 });\r\n        this.xrUI.addItem(this.fullscreenButton, { x: 1, y: -1, scale: 0.5 });\r\n        //this.xrUI.addItem(this.arButton, { x: 1, y: -1, scale: 0.5 });\r\n\r\n        this.worldUISpace.add(this.xrUI);\r\n\r\n        elementApply(this.screenUISpace.topRowLeft, this.compassImage, this.clockImage);\r\n        elementApply(this.screenUISpace.topRowRight, this.quitButton);\r\n        elementApply(this.screenUISpace.bottomRowLeft, this.settingsButton, this.muteMicButton, this.muteEnvAudioButton, this.lobbyButton);\r\n        elementApply(this.screenUISpace.bottomRowRight, this.fullscreenButton, this.vrButton); //, this.arButton);\r\n\r\n        if (BatteryImage.isAvailable && isMobile()) {\r\n            this.batteryImage = new CanvasImageMesh(this, \"Battery\", new BatteryImage());\r\n            this.xrUI.addItem(this.batteryImage, { x: 0.75, y: -1, scale: 1 });\r\n            elementApply(this.screenUISpace.topRowRight, this.batteryImage);\r\n        }\r\n\r\n        this.vrButton.visible = isDesktop() && hasVR() || isMobileVR();\r\n        this.lobbyButton.visible = false;\r\n        this.muteMicButton.visible = false;\r\n\r\n        this.screenControl.setUI(this.screenUISpace, this.fullscreenButton, this.vrButton); //, this.arButton);\r\n\r\n        this.refreshSpaceUI();\r\n\r\n        this.quitButton.addEventListener(\"click\", () =>\r\n            this.withConfirmation(\r\n                \"Confirm quit\",\r\n                \"Are you sure you want to quit?\",\r\n                async () => {\r\n                    if (this.renderer.xr.isPresenting) {\r\n                        this.screenControl.stop();\r\n                    }\r\n\r\n                    await this.onQuitting();\r\n                }));\r\n\r\n        this.lobbyButton.addEventListener(\"click\", () =>\r\n            this.withConfirmation(\r\n                \"Confirm return to lobby\",\r\n                \"Are you sure you want to return to the lobby?\",\r\n                () =>\r\n                    this.dispatchEvent(new TypedEvent(\"home\"))));\r\n\r\n        this.settingsButton.addEventListener(\"click\", async () => {\r\n            const mode = this.screenControl.currentMode;\r\n            const wasPresenting = this.renderer.xr.isPresenting;\r\n            if (wasPresenting) {\r\n                await this.screenControl.stop();\r\n            }\r\n            await this.devicesDialog.showDialog();\r\n            if (wasPresenting) {\r\n                await this.screenControl.start(mode);\r\n            }\r\n        });\r\n\r\n        const onSessionChange = () => this.refreshSpaceUI();\r\n        this.screenControl.addEventListener(\"sessionstarted\", onSessionChange);\r\n        this.screenControl.addEventListener(\"sessionstopped\", onSessionChange);\r\n\r\n        this.muteEnvAudioButton.addEventListener(\"click\", () => {\r\n            this.muteEnvAudioButton.active = !this.muteEnvAudioButton.active;\r\n            this.dispatchEvent(this.envAudioToggleEvt);\r\n        });\r\n\r\n        this.avatar.addEventListener(\"avatarmoved\", (evt) =>\r\n            this.audio.setUserPose(\r\n                this.audio.localUserID,\r\n                evt.px, evt.py, evt.pz,\r\n                evt.fx, evt.fy, evt.fz,\r\n                evt.ux, evt.uy, evt.uz));\r\n    }\r\n\r\n    private refreshSpaceUI() {\r\n        this.xrUI.visible = this.renderer.xr.isPresenting\r\n            || this.testSpaceLayout;\r\n        this.clockImage.isVisible = this.xrUI.visible\r\n            || this.DEBUG;\r\n    }\r\n\r\n    private _testSpaceLayout = false;\r\n    get testSpaceLayout() {\r\n        return this._testSpaceLayout;\r\n    }\r\n\r\n    set testSpaceLayout(v) {\r\n        if (v !== this.testSpaceLayout) {\r\n            this._testSpaceLayout = v;\r\n            this.refreshSpaceUI();\r\n        }\r\n    }\r\n\r\n    private countTick = 0;\r\n    private fpses = new Array<number>();\r\n    private avgFPS = 0;\r\n\r\n    override preRender(evt: XRTimerTickEvent) {\r\n        super.preRender(evt);\r\n\r\n        this.audio.update();\r\n        this.videoPlayer.update(evt.dt, evt.frame);\r\n\r\n        this.compassImage.image.setPitchAndHeading(\r\n            rad2deg(this.avatar.worldPitch),\r\n            rad2deg(this.avatar.worldHeading));\r\n\r\n        if (this.DEBUG) {\r\n            const fps = Math.round(evt.fps);\r\n            this.avgFPS += fps / 100;\r\n            this.fpses.push(fps);\r\n            if (this.fpses.length > 100) {\r\n                const fps = this.fpses.shift();\r\n                this.avgFPS -= fps / 100;\r\n            }\r\n\r\n            if ((++this.countTick) % 100 === 0) {\r\n                this.clockImage.image.setStats(\r\n                    this.avgFPS,\r\n                    this.renderer.info.render.calls,\r\n                    this.renderer.info.render.triangles);\r\n            }\r\n        }\r\n\r\n\r\n        this.confirmationDialog.update(evt.dt);\r\n\r\n        for (const app of this.apps) {\r\n            app.update(evt);\r\n        }\r\n    }\r\n\r\n    get environmentAudioMuted() {\r\n        return this.muteEnvAudioButton.active;\r\n    }\r\n\r\n    async withConfirmation(title: string, msg: string, act: () => void) {\r\n        this.onConfirmationShowing(true);\r\n        if (await this.confirmationDialog.prompt(title, msg)) {\r\n            act();\r\n        }\r\n        this.onConfirmationShowing(false);\r\n    }\r\n\r\n    protected onConfirmationShowing(showing: boolean) {\r\n        widgetSetEnabled(this.quitButton, !showing, \"primary\");\r\n        widgetSetEnabled(this.lobbyButton, !showing, \"primary\");\r\n    }\r\n\r\n    override async load(prog?: IProgress) {\r\n        await progressTasks(prog,\r\n            (prog) => super.load(prog),\r\n            (prog) => this.uiButtons.load(prog),\r\n            (prog) => this.audio.loadBasicClip(\"footsteps\", \"/audio/TransitionFootstepAudio.mp3\", 0.5, prog),\r\n            (prog) => this.interactionAudio.load(\"enter\", \"/audio/basic_enter.mp3\", 0.25, prog),\r\n            (prog) => this.interactionAudio.load(\"exit\", \"/audio/basic_exit.mp3\", 0.25, prog),\r\n            (prog) => this.interactionAudio.load(\"error\", \"/audio/basic_error.mp3\", 0.25, prog),\r\n            (prog) => this.interactionAudio.load(\"click\", \"/audio/vintage_radio_button_pressed.mp3\", 1, prog));\r\n    }\r\n}\r\n", "import { Environment } from \"@juniper-lib/threejs/environment/Environment\";\r\nexport default Environment;"],
  "mappings": "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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAsOP,eACO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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",
  "names": []
}
