var Of=Object.create;var Vs=Object.defineProperty;var Bf=Object.getOwnPropertyDescriptor;var Ff=Object.getOwnPropertyNames;var Hf=Object.getPrototypeOf,kf=Object.prototype.hasOwnProperty;var Nf=(r,t,e)=>t in r?Vs(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Vf=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),Uf=(r,t)=>{for(var e in t)Vs(r,e,{get:t[e],enumerable:!0})},zf=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ff(t))!kf.call(r,i)&&i!==e&&Vs(r,i,{get:()=>t[i],enumerable:!(n=Bf(t,i))||n.enumerable});return r};var Gf=(r,t,e)=>(e=r!=null?Of(Hf(r)):{},zf(t||!r||!r.__esModule?Vs(e,"default",{value:r,enumerable:!0}):e,r));var d=(r,t,e)=>(Nf(r,typeof t!="symbol"?t+"":t,e),e),ed=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var Us=(r,t,e)=>(ed(r,t,"read from private field"),e?e.call(r):t.get(r)),zs=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},Gs=(r,t,e,n)=>(ed(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e);var Hm=Vf((Ou,Bu)=>{(function(r,t){typeof Ou=="object"&&typeof Bu!="undefined"?Bu.exports=t():typeof define=="function"&&define.amd?define(t):r.CardboardVRDisplay=t()})(Ou,function(){"use strict";var r=function(){function a(p){this.value=p}function c(p){var h,g;function E(M,y){return new Promise(function(w,_){var O={key:M,arg:y,resolve:w,reject:_,next:null};g?g=g.next=O:(h=g=O,b(M,y))})}function b(M,y){try{var w=p[M](y),_=w.value;_ instanceof a?Promise.resolve(_.value).then(function(O){b("next",O)},function(O){b("throw",O)}):R(w.done?"return":"normal",w.value)}catch(O){R("throw",O)}}function R(M,y){switch(M){case"return":h.resolve({value:y,done:!0});break;case"throw":h.reject(y);break;default:h.resolve({value:y,done:!1});break}h=h.next,h?b(h.key,h.arg):g=null}this._invoke=E,typeof p.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(c.prototype[Symbol.asyncIterator]=function(){return this}),c.prototype.next=function(p){return this._invoke("next",p)},c.prototype.throw=function(p){return this._invoke("throw",p)},c.prototype.return=function(p){return this._invoke("return",p)},{wrap:function(p){return function(){return new c(p.apply(this,arguments))}},await:function(p){return new a(p)}}}(),t=function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")},e=function(){function a(c,p){for(var h=0;h<p.length;h++){var g=p[h];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(c,g.key,g)}}return function(c,p,h){return p&&a(c.prototype,p),h&&a(c,h),c}}(),n=function(){function a(c,p){var h=[],g=!0,E=!1,b=void 0;try{for(var R=c[Symbol.iterator](),M;!(g=(M=R.next()).done)&&(h.push(M.value),!(p&&h.length===p));g=!0);}catch(y){E=!0,b=y}finally{try{!g&&R.return&&R.return()}finally{if(E)throw b}}return h}return function(c,p){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c))return a(c,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=.001,s=1,o=function(c,p){return"data:"+c+","+encodeURIComponent(p)},l=function(c,p,h){return c+(p-c)*h},u=function(){var a=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return a}}(),m=function(){var a=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return a}}(),f=function(){var a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return a}}(),v=function(){var a=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return a}}(),A=function(){var a=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),c=a?parseInt(a[1],10):null;return function(){return c}}(),T=function(){var a=!1;return a=u()&&f()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return a}}(),C=function(){var a=!1;if(A()===65){var c=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(c){var p=c[1].split("."),h=n(p,4),g=h[0],E=h[1],b=h[2],R=h[3];a=parseInt(b,10)===3325&&parseInt(R,10)<148}}return function(){return a}}(),I=function(){var a=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return a}}(),P=function(){var c=window.orientation==90||window.orientation==-90;return I()?!c:c},B=function(c){return!(isNaN(c)||c<=i||c>s)},H=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},D=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},V=function(c){if(m())return!1;if(c.requestFullscreen)c.requestFullscreen();else if(c.webkitRequestFullscreen)c.webkitRequestFullscreen();else if(c.mozRequestFullScreen)c.mozRequestFullScreen();else if(c.msRequestFullscreen)c.msRequestFullscreen();else return!1;return!0},N=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},L=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},k=function(c,p,h,g){var E=c.createShader(c.VERTEX_SHADER);c.shaderSource(E,p),c.compileShader(E);var b=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(b,h),c.compileShader(b);var R=c.createProgram();c.attachShader(R,E),c.attachShader(R,b);for(var M in g)c.bindAttribLocation(R,g[M],M);return c.linkProgram(R),c.deleteShader(E),c.deleteShader(b),R},Z=function(c,p){for(var h={},g=c.getProgramParameter(p,c.ACTIVE_UNIFORMS),E="",b=0;b<g;b++){var R=c.getActiveUniform(p,b);E=R.name.replace("[0]",""),h[E]=c.getUniformLocation(p,E)}return h},ie=function(c,p,h,g,E,b,R){var M=1/(p-h),y=1/(g-E),w=1/(b-R);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*y,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*w,c[11]=0,c[12]=(p+h)*M,c[13]=(E+g)*y,c[14]=(R+b)*w,c[15]=1,c},X=function(){var c=!1;return function(p){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(p)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(p.substr(0,4)))&&(c=!0)}(navigator.userAgent||navigator.vendor||window.opera),c},se=function(c,p){for(var h in p)p.hasOwnProperty(h)&&(c[h]=p[h]);return c},xe=function(c){if(u()){var p=c.style.width,h=c.style.height;c.style.width=parseInt(p)+1+"px",c.style.height=parseInt(h)+"px",setTimeout(function(){c.style.width=p,c.style.height=h},100)}window.canvas=c},me=function(){var a=Math.PI/180,c=Math.PI*.25;function p(y,w,_,O){var U=Math.tan(w?w.upDegrees*a:c),z=Math.tan(w?w.downDegrees*a:c),K=Math.tan(w?w.leftDegrees*a:c),W=Math.tan(w?w.rightDegrees*a:c),j=2/(K+W),le=2/(U+z);return y[0]=j,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=le,y[6]=0,y[7]=0,y[8]=-((K-W)*j*.5),y[9]=(U-z)*le*.5,y[10]=O/(_-O),y[11]=-1,y[12]=0,y[13]=0,y[14]=O*_/(_-O),y[15]=0,y}function h(y,w,_){var O=w[0],U=w[1],z=w[2],K=w[3],W=O+O,j=U+U,le=z+z,ye=O*W,Pe=O*j,ge=O*le,ke=U*j,Ye=U*le,qe=z*le,$e=K*W,Ze=K*j,ar=K*le;return y[0]=1-(ke+qe),y[1]=Pe+ar,y[2]=ge-Ze,y[3]=0,y[4]=Pe-ar,y[5]=1-(ye+qe),y[6]=Ye+$e,y[7]=0,y[8]=ge+Ze,y[9]=Ye-$e,y[10]=1-(ye+ke),y[11]=0,y[12]=_[0],y[13]=_[1],y[14]=_[2],y[15]=1,y}function g(y,w,_){var O=_[0],U=_[1],z=_[2],K,W,j,le,ye,Pe,ge,ke,Ye,qe,$e,Ze;return w===y?(y[12]=w[0]*O+w[4]*U+w[8]*z+w[12],y[13]=w[1]*O+w[5]*U+w[9]*z+w[13],y[14]=w[2]*O+w[6]*U+w[10]*z+w[14],y[15]=w[3]*O+w[7]*U+w[11]*z+w[15]):(K=w[0],W=w[1],j=w[2],le=w[3],ye=w[4],Pe=w[5],ge=w[6],ke=w[7],Ye=w[8],qe=w[9],$e=w[10],Ze=w[11],y[0]=K,y[1]=W,y[2]=j,y[3]=le,y[4]=ye,y[5]=Pe,y[6]=ge,y[7]=ke,y[8]=Ye,y[9]=qe,y[10]=$e,y[11]=Ze,y[12]=K*O+ye*U+Ye*z+w[12],y[13]=W*O+Pe*U+qe*z+w[13],y[14]=j*O+ge*U+$e*z+w[14],y[15]=le*O+ke*U+Ze*z+w[15]),y}function E(y,w){var _=w[0],O=w[1],U=w[2],z=w[3],K=w[4],W=w[5],j=w[6],le=w[7],ye=w[8],Pe=w[9],ge=w[10],ke=w[11],Ye=w[12],qe=w[13],$e=w[14],Ze=w[15],ar=_*W-O*K,Ai=_*j-U*K,yi=_*le-z*K,wi=O*j-U*W,Ti=O*le-z*W,Si=U*le-z*j,Mi=ye*qe-Pe*Ye,Ri=ye*$e-ge*Ye,_i=ye*Ze-ke*Ye,Ci=Pe*$e-ge*qe,Pi=Pe*Ze-ke*qe,Ii=ge*Ze-ke*$e,Re=ar*Ii-Ai*Pi+yi*Ci+wi*_i-Ti*Ri+Si*Mi;return Re?(Re=1/Re,y[0]=(W*Ii-j*Pi+le*Ci)*Re,y[1]=(U*Pi-O*Ii-z*Ci)*Re,y[2]=(qe*Si-$e*Ti+Ze*wi)*Re,y[3]=(ge*Ti-Pe*Si-ke*wi)*Re,y[4]=(j*_i-K*Ii-le*Ri)*Re,y[5]=(_*Ii-U*_i+z*Ri)*Re,y[6]=($e*yi-Ye*Si-Ze*Ai)*Re,y[7]=(ye*Si-ge*yi+ke*Ai)*Re,y[8]=(K*Pi-W*_i+le*Mi)*Re,y[9]=(O*_i-_*Pi-z*Mi)*Re,y[10]=(Ye*Ti-qe*yi+Ze*ar)*Re,y[11]=(Pe*yi-ye*Ti-ke*ar)*Re,y[12]=(W*Ri-K*Ci-j*Mi)*Re,y[13]=(_*Ci-O*Ri+U*Mi)*Re,y[14]=(qe*Ai-Ye*wi-$e*ar)*Re,y[15]=(ye*wi-Pe*Ai+ge*ar)*Re,y):null}var b=new Float32Array([0,0,0,1]),R=new Float32Array([0,0,0]);function M(y,w,_,O,U,z){p(y,O||null,z.depthNear,z.depthFar);var K=_.orientation||b,W=_.position||R;h(w,K,W),U&&g(w,w,U),E(w,w)}return function(y,w,_){return!y||!w?!1:(y.pose=w,y.timestamp=w.timestamp,M(y.leftProjectionMatrix,y.leftViewMatrix,w,_._getFieldOfView("left"),_._getEyeOffset("left"),_),M(y.rightProjectionMatrix,y.rightViewMatrix,w,_._getFieldOfView("right"),_._getEyeOffset("right"),_),!0)}}(),J=function(){var c=window.self!==window.top,p=ze(document.referrer),h=ze(window.location.href);return c&&p!==h},ze=function(c){var p,h=c.indexOf("://");h!==-1?p=h+3:p=0;var g=c.indexOf("/",p);return g===-1&&(g=c.length),c.substring(0,g)},Cn=function(c){if(c.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var p=2*Math.acos(c.w);return p},or=function(){var a={};return function(c,p){a[c]===void 0&&(console.warn("webvr-polyfill: "+p),a[c]=!0)}}(),Nt=function(c,p){var h=p?"Please use "+p+" instead.":"";or(c,c+" has been deprecated. This may not work on native WebVR displays. "+h)};function tf(a,c,p){if(!c){p(a);return}for(var h=[],g=null,E=0;E<c.length;++E){var b=c[E];switch(b){case a.TEXTURE_BINDING_2D:case a.TEXTURE_BINDING_CUBE_MAP:var R=c[++E];if(R<a.TEXTURE0||R>a.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),h.push(null,null);break}g||(g=a.getParameter(a.ACTIVE_TEXTURE)),a.activeTexture(R),h.push(a.getParameter(b),null);break;case a.ACTIVE_TEXTURE:g=a.getParameter(a.ACTIVE_TEXTURE),h.push(null);break;default:h.push(a.getParameter(b));break}}p(a);for(var E=0;E<c.length;++E){var b=c[E],M=h[E];switch(b){case a.ACTIVE_TEXTURE:break;case a.ARRAY_BUFFER_BINDING:a.bindBuffer(a.ARRAY_BUFFER,M);break;case a.COLOR_CLEAR_VALUE:a.clearColor(M[0],M[1],M[2],M[3]);break;case a.COLOR_WRITEMASK:a.colorMask(M[0],M[1],M[2],M[3]);break;case a.CURRENT_PROGRAM:a.useProgram(M);break;case a.ELEMENT_ARRAY_BUFFER_BINDING:a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,M);break;case a.FRAMEBUFFER_BINDING:a.bindFramebuffer(a.FRAMEBUFFER,M);break;case a.RENDERBUFFER_BINDING:a.bindRenderbuffer(a.RENDERBUFFER,M);break;case a.TEXTURE_BINDING_2D:var R=c[++E];if(R<a.TEXTURE0||R>a.TEXTURE31)break;a.activeTexture(R),a.bindTexture(a.TEXTURE_2D,M);break;case a.TEXTURE_BINDING_CUBE_MAP:var R=c[++E];if(R<a.TEXTURE0||R>a.TEXTURE31)break;a.activeTexture(R),a.bindTexture(a.TEXTURE_CUBE_MAP,M);break;case a.VIEWPORT:a.viewport(M[0],M[1],M[2],M[3]);break;case a.BLEND:case a.CULL_FACE:case a.DEPTH_TEST:case a.SCISSOR_TEST:case a.STENCIL_TEST:M?a.enable(b):a.disable(b);break;default:console.log("No GL restore behavior for 0x"+b.toString(16));break}g&&a.activeTexture(g)}}var Ei=tf,rf=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),nf=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function ft(a,c,p,h){this.gl=a,this.cardboardUI=c,this.bufferScale=p,this.dirtySubmitFrameBindings=h,this.ctxAttribs=a.getContextAttributes(),this.instanceExt=a.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=a.drawingBufferWidth,this.bufferHeight=a.drawingBufferHeight,this.realBindFramebuffer=a.bindFramebuffer,this.realEnable=a.enable,this.realDisable=a.disable,this.realColorMask=a.colorMask,this.realClearColor=a.clearColor,this.realViewport=a.viewport,u()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=k(a,rf,nf,this.attribs),this.uniforms=Z(a,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.indexCount=0,this.renderTarget=a.createTexture(),this.framebuffer=a.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=a.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=a.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=a.createRenderbuffer()),this.patch(),this.onResize()}ft.prototype.destroy=function(){var a=this.gl;this.unpatch(),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.indexBuffer),a.deleteTexture(this.renderTarget),a.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&a.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&a.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&a.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},ft.prototype.onResize=function(){var a=this.gl,c=this,p=[a.RENDERBUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0];Ei(a,p,function(h){c.realBindFramebuffer.call(h,h.FRAMEBUFFER,null),c.scissorTest&&c.realDisable.call(h,h.SCISSOR_TEST),c.realColorMask.call(h,!0,!0,!0,!0),c.realViewport.call(h,0,0,h.drawingBufferWidth,h.drawingBufferHeight),c.realClearColor.call(h,0,0,0,1),h.clear(h.COLOR_BUFFER_BIT),c.realBindFramebuffer.call(h,h.FRAMEBUFFER,c.framebuffer),h.bindTexture(h.TEXTURE_2D,c.renderTarget),h.texImage2D(h.TEXTURE_2D,0,c.ctxAttribs.alpha?h.RGBA:h.RGB,c.bufferWidth,c.bufferHeight,0,c.ctxAttribs.alpha?h.RGBA:h.RGB,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c.renderTarget,0),c.ctxAttribs.depth&&c.ctxAttribs.stencil?(h.bindRenderbuffer(h.RENDERBUFFER,c.depthStencilBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,c.bufferWidth,c.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,c.depthStencilBuffer)):c.ctxAttribs.depth?(h.bindRenderbuffer(h.RENDERBUFFER,c.depthBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,c.bufferWidth,c.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,c.depthBuffer)):c.ctxAttribs.stencil&&(h.bindRenderbuffer(h.RENDERBUFFER,c.stencilBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.STENCIL_INDEX8,c.bufferWidth,c.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.STENCIL_ATTACHMENT,h.RENDERBUFFER,c.stencilBuffer)),!h.checkFramebufferStatus(h.FRAMEBUFFER)===h.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),c.realBindFramebuffer.call(h,h.FRAMEBUFFER,c.lastBoundFramebuffer),c.scissorTest&&c.realEnable.call(h,h.SCISSOR_TEST),c.realColorMask.apply(h,c.colorMask),c.realViewport.apply(h,c.viewport),c.realClearColor.apply(h,c.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},ft.prototype.patch=function(){if(!this.isPatched){var a=this,c=this.gl.canvas,p=this.gl;u()||(c.width=H()*this.bufferScale,c.height=D()*this.bufferScale,Object.defineProperty(c,"width",{configurable:!0,enumerable:!0,get:function(){return a.bufferWidth},set:function(g){a.bufferWidth=g,a.realCanvasWidth.set.call(c,g),a.onResize()}}),Object.defineProperty(c,"height",{configurable:!0,enumerable:!0,get:function(){return a.bufferHeight},set:function(g){a.bufferHeight=g,a.realCanvasHeight.set.call(c,g),a.onResize()}})),this.lastBoundFramebuffer=p.getParameter(p.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(p.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(h,g){a.lastBoundFramebuffer=g||a.framebuffer,a.realBindFramebuffer.call(p,h,a.lastBoundFramebuffer)},this.cullFace=p.getParameter(p.CULL_FACE),this.depthTest=p.getParameter(p.DEPTH_TEST),this.blend=p.getParameter(p.BLEND),this.scissorTest=p.getParameter(p.SCISSOR_TEST),this.stencilTest=p.getParameter(p.STENCIL_TEST),p.enable=function(h){switch(h){case p.CULL_FACE:a.cullFace=!0;break;case p.DEPTH_TEST:a.depthTest=!0;break;case p.BLEND:a.blend=!0;break;case p.SCISSOR_TEST:a.scissorTest=!0;break;case p.STENCIL_TEST:a.stencilTest=!0;break}a.realEnable.call(p,h)},p.disable=function(h){switch(h){case p.CULL_FACE:a.cullFace=!1;break;case p.DEPTH_TEST:a.depthTest=!1;break;case p.BLEND:a.blend=!1;break;case p.SCISSOR_TEST:a.scissorTest=!1;break;case p.STENCIL_TEST:a.stencilTest=!1;break}a.realDisable.call(p,h)},this.colorMask=p.getParameter(p.COLOR_WRITEMASK),p.colorMask=function(h,g,E,b){a.colorMask[0]=h,a.colorMask[1]=g,a.colorMask[2]=E,a.colorMask[3]=b,a.realColorMask.call(p,h,g,E,b)},this.clearColor=p.getParameter(p.COLOR_CLEAR_VALUE),p.clearColor=function(h,g,E,b){a.clearColor[0]=h,a.clearColor[1]=g,a.clearColor[2]=E,a.clearColor[3]=b,a.realClearColor.call(p,h,g,E,b)},this.viewport=p.getParameter(p.VIEWPORT),p.viewport=function(h,g,E,b){a.viewport[0]=h,a.viewport[1]=g,a.viewport[2]=E,a.viewport[3]=b,a.realViewport.call(p,h,g,E,b)},this.isPatched=!0,xe(c)}},ft.prototype.unpatch=function(){if(!!this.isPatched){var a=this.gl,c=this.gl.canvas;u()||(Object.defineProperty(c,"width",this.realCanvasWidth),Object.defineProperty(c,"height",this.realCanvasHeight)),c.width=this.bufferWidth,c.height=this.bufferHeight,a.bindFramebuffer=this.realBindFramebuffer,a.enable=this.realEnable,a.disable=this.realDisable,a.colorMask=this.realColorMask,a.clearColor=this.realClearColor,a.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&a.bindFramebuffer(a.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){xe(c)},1)}},ft.prototype.setTextureBounds=function(a,c){a||(a=[0,0,.5,1]),c||(c=[.5,0,.5,1]),this.viewportOffsetScale[0]=a[0],this.viewportOffsetScale[1]=a[1],this.viewportOffsetScale[2]=a[2],this.viewportOffsetScale[3]=a[3],this.viewportOffsetScale[4]=c[0],this.viewportOffsetScale[5]=c[1],this.viewportOffsetScale[6]=c[2],this.viewportOffsetScale[7]=c[3]},ft.prototype.submitFrame=function(){var a=this.gl,c=this,p=[];if(this.dirtySubmitFrameBindings||p.push(a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING,a.ELEMENT_ARRAY_BUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0),Ei(a,p,function(g){c.realBindFramebuffer.call(g,g.FRAMEBUFFER,null);var E=0,b=0;c.instanceExt&&(E=g.getVertexAttrib(c.attribs.position,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),b=g.getVertexAttrib(c.attribs.texCoord,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),c.cullFace&&c.realDisable.call(g,g.CULL_FACE),c.depthTest&&c.realDisable.call(g,g.DEPTH_TEST),c.blend&&c.realDisable.call(g,g.BLEND),c.scissorTest&&c.realDisable.call(g,g.SCISSOR_TEST),c.stencilTest&&c.realDisable.call(g,g.STENCIL_TEST),c.realColorMask.call(g,!0,!0,!0,!0),c.realViewport.call(g,0,0,g.drawingBufferWidth,g.drawingBufferHeight),(c.ctxAttribs.alpha||u())&&(c.realClearColor.call(g,0,0,0,1),g.clear(g.COLOR_BUFFER_BIT)),g.useProgram(c.program),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,c.indexBuffer),g.bindBuffer(g.ARRAY_BUFFER,c.vertexBuffer),g.enableVertexAttribArray(c.attribs.position),g.enableVertexAttribArray(c.attribs.texCoord),g.vertexAttribPointer(c.attribs.position,2,g.FLOAT,!1,20,0),g.vertexAttribPointer(c.attribs.texCoord,3,g.FLOAT,!1,20,8),c.instanceExt&&(E!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,0),b!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,0)),g.activeTexture(g.TEXTURE0),g.uniform1i(c.uniforms.diffuse,0),g.bindTexture(g.TEXTURE_2D,c.renderTarget),g.uniform4fv(c.uniforms.viewportOffsetScale,c.viewportOffsetScale),g.drawElements(g.TRIANGLES,c.indexCount,g.UNSIGNED_SHORT,0),c.cardboardUI&&c.cardboardUI.renderNoState(),c.realBindFramebuffer.call(c.gl,g.FRAMEBUFFER,c.framebuffer),c.ctxAttribs.preserveDrawingBuffer||(c.realClearColor.call(g,0,0,0,0),g.clear(g.COLOR_BUFFER_BIT)),c.dirtySubmitFrameBindings||c.realBindFramebuffer.call(g,g.FRAMEBUFFER,c.lastBoundFramebuffer),c.cullFace&&c.realEnable.call(g,g.CULL_FACE),c.depthTest&&c.realEnable.call(g,g.DEPTH_TEST),c.blend&&c.realEnable.call(g,g.BLEND),c.scissorTest&&c.realEnable.call(g,g.SCISSOR_TEST),c.stencilTest&&c.realEnable.call(g,g.STENCIL_TEST),c.realColorMask.apply(g,c.colorMask),c.realViewport.apply(g,c.viewport),(c.ctxAttribs.alpha||!c.ctxAttribs.preserveDrawingBuffer)&&c.realClearColor.apply(g,c.clearColor),c.instanceExt&&(E!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,E),b!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,b))}),u()){var h=a.canvas;(h.width!=c.bufferWidth||h.height!=c.bufferHeight)&&(c.bufferWidth=h.width,c.bufferHeight=h.height,c.onResize())}},ft.prototype.updateDeviceInfo=function(a){var c=this.gl,p=this,h=[c.ARRAY_BUFFER_BINDING,c.ELEMENT_ARRAY_BUFFER_BINDING];Ei(c,h,function(g){var E=p.computeMeshVertices_(p.meshWidth,p.meshHeight,a);if(g.bindBuffer(g.ARRAY_BUFFER,p.vertexBuffer),g.bufferData(g.ARRAY_BUFFER,E,g.STATIC_DRAW),!p.indexCount){var b=p.computeMeshIndices_(p.meshWidth,p.meshHeight);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,p.indexBuffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,b,g.STATIC_DRAW),p.indexCount=b.length}})},ft.prototype.computeMeshVertices_=function(a,c,p){for(var h=new Float32Array(2*a*c*5),g=p.getLeftEyeVisibleTanAngles(),E=p.getLeftEyeNoLensTanAngles(),b=p.getLeftEyeVisibleScreenRect(E),R=0,M=0;M<2;M++){for(var y=0;y<c;y++)for(var w=0;w<a;w++,R++){var _=w/(a-1),O=y/(c-1),U=_,z=O,K=l(g[0],g[2],_),W=l(g[3],g[1],O),j=Math.sqrt(K*K+W*W),le=p.distortion.distortInverse(j),ye=K*le/j,Pe=W*le/j;_=(ye-E[0])/(E[2]-E[0]),O=(Pe-E[3])/(E[1]-E[3]),_=(b.x+_*b.width-.5)*2,O=(b.y+O*b.height-.5)*2,h[R*5+0]=_,h[R*5+1]=O,h[R*5+2]=U,h[R*5+3]=z,h[R*5+4]=M}var ge=g[2]-g[0];g[0]=-(ge+g[0]),g[2]=ge-g[2],ge=E[2]-E[0],E[0]=-(ge+E[0]),E[2]=ge-E[2],b.x=1-(b.x+b.width)}return h},ft.prototype.computeMeshIndices_=function(a,c){for(var p=new Uint16Array(2*(a-1)*(c-1)*6),h=a/2,g=c/2,E=0,b=0,R=0;R<2;R++)for(var M=0;M<c;M++)for(var y=0;y<a;y++,E++)y==0||M==0||(y<=h==M<=g?(p[b++]=E,p[b++]=E-a-1,p[b++]=E-a,p[b++]=E-a-1,p[b++]=E,p[b++]=E-1):(p[b++]=E-1,p[b++]=E-a,p[b++]=E,p[b++]=E-a,p[b++]=E-1,p[b++]=E-a-1));return p},ft.prototype.getOwnPropertyDescriptor_=function(a,c){var p=Object.getOwnPropertyDescriptor(a,c);return(p.get===void 0||p.set===void 0)&&(p.configurable=!0,p.enumerable=!0,p.get=function(){return this.getAttribute(c)},p.set=function(h){this.setAttribute(c,h)}),p};var sf=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),of=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),Xu=Math.PI/180,bl=60,Qu=12,Ku=20,Al=1,Yu=.75,qu=.3125,af=4,kr=28,yl=1.5;function Nr(a){this.gl=a,this.attribs={position:0},this.program=k(a,sf,of,this.attribs),this.uniforms=Z(a,this.program),this.vertexBuffer=a.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}Nr.prototype.destroy=function(){var a=this.gl;this.listener&&a.canvas.removeEventListener("click",this.listener,!1),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer)},Nr.prototype.listen=function(a,c){var p=this.gl.canvas;this.listener=function(h){var g=p.clientWidth/2,E=kr*yl;h.clientX>g-E&&h.clientX<g+E&&h.clientY>p.clientHeight-E?a(h):h.clientX<E&&h.clientY<E&&c(h)},p.addEventListener("click",this.listener,!1)},Nr.prototype.onResize=function(){var a=this.gl,c=this,p=[a.ARRAY_BUFFER_BINDING];Ei(a,p,function(h){var g=[],E=h.drawingBufferWidth/2,b=Math.max(screen.width,screen.height)*window.devicePixelRatio,R=h.drawingBufferWidth/b,M=R*window.devicePixelRatio,y=af*M/2,w=kr*yl*M,_=kr*M/2,O=(kr*yl-kr)*M;g.push(E-y,w),g.push(E-y,h.drawingBufferHeight),g.push(E+y,w),g.push(E+y,h.drawingBufferHeight),c.gearOffset=g.length/2;function U(le,ye){var Pe=(90-le)*Xu,ge=Math.cos(Pe),ke=Math.sin(Pe);g.push(qu*ge*_+E,qu*ke*_+_),g.push(ye*ge*_+E,ye*ke*_+_)}for(var z=0;z<=6;z++){var K=z*bl;U(K,Al),U(K+Qu,Al),U(K+Ku,Yu),U(K+(bl-Ku),Yu),U(K+(bl-Qu),Al)}c.gearVertexCount=g.length/2-c.gearOffset,c.arrowOffset=g.length/2;function W(le,ye){g.push(O+le,h.drawingBufferHeight-O-ye)}var j=y/Math.sin(45*Xu);W(0,_),W(_,0),W(_+j,j),W(j,_+j),W(j,_-j),W(0,_),W(_,_*2),W(_+j,_*2-j),W(j,_-j),W(0,_),W(j,_-y),W(kr*M,_-y),W(j,_+y),W(kr*M,_+y),c.arrowVertexCount=g.length/2-c.arrowOffset,h.bindBuffer(h.ARRAY_BUFFER,c.vertexBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(g),h.STATIC_DRAW)})},Nr.prototype.render=function(){var a=this.gl,c=this,p=[a.CULL_FACE,a.DEPTH_TEST,a.BLEND,a.SCISSOR_TEST,a.STENCIL_TEST,a.COLOR_WRITEMASK,a.VIEWPORT,a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING];Ei(a,p,function(h){h.disable(h.CULL_FACE),h.disable(h.DEPTH_TEST),h.disable(h.BLEND),h.disable(h.SCISSOR_TEST),h.disable(h.STENCIL_TEST),h.colorMask(!0,!0,!0,!0),h.viewport(0,0,h.drawingBufferWidth,h.drawingBufferHeight),c.renderNoState()})},Nr.prototype.renderNoState=function(){var a=this.gl;a.useProgram(this.program),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.enableVertexAttribArray(this.attribs.position),a.vertexAttribPointer(this.attribs.position,2,a.FLOAT,!1,8,0),a.uniform4f(this.uniforms.color,1,1,1,1),ie(this.projMat,0,a.drawingBufferWidth,0,a.drawingBufferHeight,.1,1024),a.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.drawArrays(a.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),a.drawArrays(a.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function ks(a){this.coefficients=a}ks.prototype.distortInverse=function(a){for(var c=0,p=1,h=a-this.distort(c);Math.abs(p-c)>1e-4;){var g=a-this.distort(p),E=p-g*((p-c)/(g-h));c=p,p=E,h=g}return p},ks.prototype.distort=function(a){for(var c=a*a,p=0,h=0;h<this.coefficients.length;h++)p=c*(p+this.coefficients[h]);return(p+1)*a};var Tt=Math.PI/180,St=180/Math.PI,fe=function(c,p,h){this.x=c||0,this.y=p||0,this.z=h||0};fe.prototype={constructor:fe,set:function(c,p,h){return this.x=c,this.y=p,this.z=h,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var c=this.length();if(c!==0){var p=1/c;this.multiplyScalar(p)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(c){this.x*=c,this.y*=c,this.z*=c},applyQuaternion:function(c){var p=this.x,h=this.y,g=this.z,E=c.x,b=c.y,R=c.z,M=c.w,y=M*p+b*g-R*h,w=M*h+R*p-E*g,_=M*g+E*h-b*p,O=-E*p-b*h-R*g;return this.x=y*M+O*-E+w*-R-_*-b,this.y=w*M+O*-b+_*-E-y*-R,this.z=_*M+O*-R+y*-b-w*-E,this},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},crossVectors:function(c,p){var h=c.x,g=c.y,E=c.z,b=p.x,R=p.y,M=p.z;return this.x=g*M-E*R,this.y=E*b-h*M,this.z=h*R-g*b,this}};var ee=function(c,p,h,g){this.x=c||0,this.y=p||0,this.z=h||0,this.w=g!==void 0?g:1};ee.prototype={constructor:ee,set:function(c,p,h,g){return this.x=c,this.y=p,this.z=h,this.w=g,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this.w=c.w,this},setFromEulerXYZ:function(c,p,h){var g=Math.cos(c/2),E=Math.cos(p/2),b=Math.cos(h/2),R=Math.sin(c/2),M=Math.sin(p/2),y=Math.sin(h/2);return this.x=R*E*b+g*M*y,this.y=g*M*b-R*E*y,this.z=g*E*y+R*M*b,this.w=g*E*b-R*M*y,this},setFromEulerYXZ:function(c,p,h){var g=Math.cos(c/2),E=Math.cos(p/2),b=Math.cos(h/2),R=Math.sin(c/2),M=Math.sin(p/2),y=Math.sin(h/2);return this.x=R*E*b+g*M*y,this.y=g*M*b-R*E*y,this.z=g*E*y-R*M*b,this.w=g*E*b+R*M*y,this},setFromAxisAngle:function(c,p){var h=p/2,g=Math.sin(h);return this.x=c.x*g,this.y=c.y*g,this.z=c.z*g,this.w=Math.cos(h),this},multiply:function(c){return this.multiplyQuaternions(this,c)},multiplyQuaternions:function(c,p){var h=c.x,g=c.y,E=c.z,b=c.w,R=p.x,M=p.y,y=p.z,w=p.w;return this.x=h*w+b*R+g*y-E*M,this.y=g*w+b*M+E*R-h*y,this.z=E*w+b*y+h*M-g*R,this.w=b*w-h*R-g*M-E*y,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return c===0?(this.x=0,this.y=0,this.z=0,this.w=1):(c=1/c,this.x=this.x*c,this.y=this.y*c,this.z=this.z*c,this.w=this.w*c),this},slerp:function(c,p){if(p===0)return this;if(p===1)return this.copy(c);var h=this.x,g=this.y,E=this.z,b=this.w,R=b*c.w+h*c.x+g*c.y+E*c.z;if(R<0?(this.w=-c.w,this.x=-c.x,this.y=-c.y,this.z=-c.z,R=-R):this.copy(c),R>=1)return this.w=b,this.x=h,this.y=g,this.z=E,this;var M=Math.acos(R),y=Math.sqrt(1-R*R);if(Math.abs(y)<.001)return this.w=.5*(b+this.w),this.x=.5*(h+this.x),this.y=.5*(g+this.y),this.z=.5*(E+this.z),this;var w=Math.sin((1-p)*M)/y,_=Math.sin(p*M)/y;return this.w=b*w+this.w*_,this.x=h*w+this.x*_,this.y=g*w+this.y*_,this.z=E*w+this.z*_,this},setFromUnitVectors:function(){var a,c,p=1e-6;return function(h,g){return a===void 0&&(a=new fe),c=h.dot(g)+1,c<p?(c=0,Math.abs(h.x)>Math.abs(h.z)?a.set(-h.y,h.x,0):a.set(0,-h.z,h.y)):a.crossVectors(h,g),this.x=a.x,this.y=a.y,this.z=a.z,this.w=c,this.normalize(),this}}()};function wl(a){this.width=a.width||H(),this.height=a.height||D(),this.widthMeters=a.widthMeters,this.heightMeters=a.heightMeters,this.bevelMeters=a.bevelMeters}var lf=new wl({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),cf=new wl({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Tl={CardboardV1:new Sl({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Sl({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Se(a,c){this.viewer=Tl.CardboardV2,this.updateDeviceParams(a),this.distortion=new ks(this.viewer.distortionCoefficients);for(var p=0;p<c.length;p++){var h=c[p];Tl[h.id]=new Sl(h)}}Se.prototype.updateDeviceParams=function(a){this.device=this.determineDevice_(a)||this.device},Se.prototype.getDevice=function(){return this.device},Se.prototype.setViewer=function(a){this.viewer=a,this.distortion=new ks(this.viewer.distortionCoefficients)},Se.prototype.determineDevice_=function(a){if(!a)return u()?(console.warn("Using fallback iOS device measurements."),cf):(console.warn("Using fallback Android device measurements."),lf);var c=.0254,p=c/a.xdpi,h=c/a.ydpi,g=H(),E=D();return new wl({widthMeters:p*g,heightMeters:h*E,bevelMeters:a.bevelMm*.001})},Se.prototype.getDistortedFieldOfViewLeftEye=function(){var a=this.viewer,c=this.device,p=this.distortion,h=a.screenLensDistance,g=(c.widthMeters-a.interLensDistance)/2,E=a.interLensDistance/2,b=a.baselineLensDistance-c.bevelMeters,R=c.heightMeters-b,M=St*Math.atan(p.distort(g/h)),y=St*Math.atan(p.distort(E/h)),w=St*Math.atan(p.distort(b/h)),_=St*Math.atan(p.distort(R/h));return{leftDegrees:Math.min(M,a.fov),rightDegrees:Math.min(y,a.fov),downDegrees:Math.min(w,a.fov),upDegrees:Math.min(_,a.fov)}},Se.prototype.getLeftEyeVisibleTanAngles=function(){var a=this.viewer,c=this.device,p=this.distortion,h=Math.tan(-Tt*a.fov),g=Math.tan(Tt*a.fov),E=Math.tan(Tt*a.fov),b=Math.tan(-Tt*a.fov),R=c.widthMeters/4,M=c.heightMeters/2,y=a.baselineLensDistance-c.bevelMeters-M,w=a.interLensDistance/2-R,_=-y,O=a.screenLensDistance,U=p.distort((w-R)/O),z=p.distort((_+M)/O),K=p.distort((w+R)/O),W=p.distort((_-M)/O),j=new Float32Array(4);return j[0]=Math.max(h,U),j[1]=Math.min(g,z),j[2]=Math.min(E,K),j[3]=Math.max(b,W),j},Se.prototype.getLeftEyeNoLensTanAngles=function(){var a=this.viewer,c=this.device,p=this.distortion,h=new Float32Array(4),g=p.distortInverse(Math.tan(-Tt*a.fov)),E=p.distortInverse(Math.tan(Tt*a.fov)),b=p.distortInverse(Math.tan(Tt*a.fov)),R=p.distortInverse(Math.tan(-Tt*a.fov)),M=c.widthMeters/4,y=c.heightMeters/2,w=a.baselineLensDistance-c.bevelMeters-y,_=a.interLensDistance/2-M,O=-w,U=a.screenLensDistance,z=(_-M)/U,K=(O+y)/U,W=(_+M)/U,j=(O-y)/U;return h[0]=Math.max(g,z),h[1]=Math.min(E,K),h[2]=Math.min(b,W),h[3]=Math.max(R,j),h},Se.prototype.getLeftEyeVisibleScreenRect=function(a){var c=this.viewer,p=this.device,h=c.screenLensDistance,g=(p.widthMeters-c.interLensDistance)/2,E=c.baselineLensDistance-p.bevelMeters,b=(a[0]*h+g)/p.widthMeters,R=(a[1]*h+E)/p.heightMeters,M=(a[2]*h+g)/p.widthMeters,y=(a[3]*h+E)/p.heightMeters;return{x:b,y,width:M-b,height:R-y}},Se.prototype.getFieldOfViewLeftEye=function(a){return a?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Se.prototype.getFieldOfViewRightEye=function(a){var c=this.getFieldOfViewLeftEye(a);return{leftDegrees:c.rightDegrees,rightDegrees:c.leftDegrees,upDegrees:c.upDegrees,downDegrees:c.downDegrees}},Se.prototype.getUndistortedFieldOfViewLeftEye=function(){var a=this.getUndistortedParams_();return{leftDegrees:St*Math.atan(a.outerDist),rightDegrees:St*Math.atan(a.innerDist),downDegrees:St*Math.atan(a.bottomDist),upDegrees:St*Math.atan(a.topDist)}},Se.prototype.getUndistortedViewportLeftEye=function(){var a=this.getUndistortedParams_(),c=this.viewer,p=this.device,h=c.screenLensDistance,g=p.widthMeters/h,E=p.heightMeters/h,b=p.width/g,R=p.height/E,M=Math.round((a.eyePosX-a.outerDist)*b),y=Math.round((a.eyePosY-a.bottomDist)*R);return{x:M,y,width:Math.round((a.eyePosX+a.innerDist)*b)-M,height:Math.round((a.eyePosY+a.topDist)*R)-y}},Se.prototype.getUndistortedParams_=function(){var a=this.viewer,c=this.device,p=this.distortion,h=a.screenLensDistance,g=a.interLensDistance/2/h,E=c.widthMeters/h,b=c.heightMeters/h,R=E/2-g,M=(a.baselineLensDistance-c.bevelMeters)/h,y=a.fov,w=p.distortInverse(Math.tan(Tt*y)),_=Math.min(R,w),O=Math.min(g,w),U=Math.min(M,w),z=Math.min(b-M,w);return{outerDist:_,innerDist:O,topDist:z,bottomDist:U,eyePosX:R,eyePosY:M}};function Sl(a){this.id=a.id,this.label=a.label,this.fov=a.fov,this.interLensDistance=a.interLensDistance,this.baselineLensDistance=a.baselineLensDistance,this.screenLensDistance=a.screenLensDistance,this.distortionCoefficients=a.distortionCoefficients,this.inverseCoefficients=a.inverseCoefficients}Se.Viewers=Tl;var uf=1,df="2019-11-09T17:36:14Z",pf=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],hf={format:uf,last_updated:df,devices:pf};function xi(a,c){if(this.dpdb=hf,this.recalculateDeviceParams_(),a){this.onDeviceParamsUpdated=c;var p=new XMLHttpRequest,h=this;p.open("GET",a,!0),p.addEventListener("load",function(){h.loading=!1,p.status>=200&&p.status<=299?(h.dpdb=JSON.parse(p.response),h.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),p.send()}}xi.prototype.getDeviceParams=function(){return this.deviceParams},xi.prototype.recalculateDeviceParams_=function(){var a=this.calcDeviceParams_();a?(this.deviceParams=a,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},xi.prototype.calcDeviceParams_=function(){var a=this.dpdb;if(!a)return console.error("DPDB not available."),null;if(a.format!=1)return console.error("DPDB has unexpected format version."),null;if(!a.devices||!a.devices.length)return console.error("DPDB does not have a devices section."),null;var c=navigator.userAgent||navigator.vendor||window.opera,p=H(),h=D();if(!a.devices)return console.error("DPDB has no devices section."),null;for(var g=0;g<a.devices.length;g++){var E=a.devices[g];if(!E.rules){console.warn("Device["+g+"] has no rules section.");continue}if(E.type!="ios"&&E.type!="android"){console.warn("Device["+g+"] has invalid type.");continue}if(u()==(E.type=="ios")){for(var b=!1,R=0;R<E.rules.length;R++){var M=E.rules[R];if(this.ruleMatches_(M,c,p,h)){b=!0;break}}if(!!b){var y=E.dpi[0]||E.dpi,w=E.dpi[1]||E.dpi;return new mf({xdpi:y,ydpi:w,bevelMm:E.bw})}}}return console.warn("No DPDB device match."),null},xi.prototype.ruleMatches_=function(a,c,p,h){if(!a.ua&&!a.res||(a.ua&&a.ua.substring(0,2)==="SM"&&(a.ua=a.ua.substring(0,7)),a.ua&&c.indexOf(a.ua)<0))return!1;if(a.res){if(!a.res[0]||!a.res[1])return!1;var g=a.res[0],E=a.res[1];if(Math.min(p,h)!=Math.min(g,E)||Math.max(p,h)!=Math.max(g,E))return!1}return!0};function mf(a){this.xdpi=a.xdpi,this.ydpi=a.ydpi,this.bevelMm=a.bevelMm}function bi(a,c){this.set(a,c)}bi.prototype.set=function(a,c){this.sample=a,this.timestampS=c},bi.prototype.copy=function(a){this.set(a.sample,a.timestampS)};function Vr(a,c){this.kFilter=a,this.isDebug=c,this.currentAccelMeasurement=new bi,this.currentGyroMeasurement=new bi,this.previousGyroMeasurement=new bi,u()?this.filterQ=new ee(-1,0,0,1):this.filterQ=new ee(1,0,0,1),this.previousFilterQ=new ee,this.previousFilterQ.copy(this.filterQ),this.accelQ=new ee,this.isOrientationInitialized=!1,this.estimatedGravity=new fe,this.measuredGravity=new fe,this.gyroIntegralQ=new ee}Vr.prototype.addAccelMeasurement=function(a,c){this.currentAccelMeasurement.set(a,c)},Vr.prototype.addGyroMeasurement=function(a,c){this.currentGyroMeasurement.set(a,c);var p=c-this.previousGyroMeasurement.timestampS;B(p)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Vr.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var a=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,c=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,a);this.gyroIntegralQ.multiply(c),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(c);var p=new ee;p.copy(this.filterQ),p.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(p),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var h=new ee;h.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),h.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",St*Cn(h),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var g=new ee;g.copy(this.filterQ),g.multiply(h),this.filterQ.slerp(g,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Vr.prototype.getOrientation=function(){return this.filterQ},Vr.prototype.accelToQuaternion_=function(a){var c=new fe;c.copy(a),c.normalize();var p=new ee;return p.setFromUnitVectors(new fe(0,0,-1),c),p.inverse(),p},Vr.prototype.gyroToQuaternionDelta_=function(a,c){var p=new ee,h=new fe;return h.copy(a),h.normalize(),p.setFromAxisAngle(h,a.length()*c),p};function $u(a,c){this.predictionTimeS=a,this.isDebug=c,this.previousQ=new ee,this.previousTimestampS=null,this.deltaQ=new ee,this.outQ=new ee}$u.prototype.getPrediction=function(a,c,p){if(!this.previousTimestampS)return this.previousQ.copy(a),this.previousTimestampS=p,a;var h=new fe;h.copy(c),h.normalize();var g=c.length();if(g<Tt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(St*g).toFixed(1)),this.outQ.copy(a),this.previousQ.copy(a),this.outQ;var E=g*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(h,E),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(a),this.previousTimestampS=p,this.outQ};function it(a,c,p,h){this.yawOnly=p,this.accelerometer=new fe,this.gyroscope=new fe,this.filter=new Vr(a,h),this.posePredictor=new $u(c,h),this.isFirefoxAndroid=v(),this.isIOS=u();var g=A();this.isDeviceMotionInRadians=!this.isIOS&&g&&g<66,this.isWithoutDeviceMotion=C()||T(),this.filterToWorldQ=new ee,u()?this.filterToWorldQ.setFromAxisAngle(new fe(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new fe(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new ee,this.worldToScreenQ=new ee,this.originalPoseAdjustQ=new ee,this.originalPoseAdjustQ.setFromAxisAngle(new fe(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),P()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new ee,this.orientationOut_=new Float32Array(4),this.start()}it.prototype.getPosition=function(){return null},it.prototype.getOrientation=function(){var a=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var g=new ee().setFromAxisAngle(new fe(0,0,-1),0),E=new ee;return window.orientation===-90?E.setFromAxisAngle(new fe(0,1,0),Math.PI/-2):E.setFromAxisAngle(new fe(0,1,0),Math.PI/2),g.multiply(E)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var g=new ee;return g.setFromAxisAngle(new fe(1,0,0),-Math.PI/2),g}(),a=this._deviceOrientationQ;var p=new ee;return p.copy(a),p.multiply(this.deviceOrientationFilterToWorldQ),p.multiply(this.resetQ),p.multiply(this.worldToScreenQ),p.multiplyQuaternions(this.deviceOrientationFixQ,p),this.yawOnly&&(p.x=0,p.z=0,p.normalize()),this.orientationOut_[0]=p.x,this.orientationOut_[1]=p.y,this.orientationOut_[2]=p.z,this.orientationOut_[3]=p.w,this.orientationOut_}else{var c=this.filter.getOrientation();a=this.posePredictor.getPrediction(c,this.gyroscope,this.previousTimestampS)}var p=new ee;return p.copy(this.filterToWorldQ),p.multiply(this.resetQ),p.multiply(a),p.multiply(this.worldToScreenQ),this.yawOnly&&(p.x=0,p.z=0,p.normalize()),this.orientationOut_[0]=p.x,this.orientationOut_[1]=p.y,this.orientationOut_[2]=p.z,this.orientationOut_[3]=p.w,this.orientationOut_},it.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),P()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},it.prototype.onDeviceOrientation_=function(a){this._deviceOrientationQ=this._deviceOrientationQ||new ee;var c=a.alpha,p=a.beta,h=a.gamma;c=(c||0)*Math.PI/180,p=(p||0)*Math.PI/180,h=(h||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(p,c,-h)},it.prototype.onDeviceMotion_=function(a){this.updateDeviceMotion_(a)},it.prototype.updateDeviceMotion_=function(a){var c=a.accelerationIncludingGravity,p=a.rotationRate,h=a.timeStamp/1e3,g=h-this.previousTimestampS;if(g<0){or("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=h;return}else if(g<=i||g>s){or("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=h;return}this.accelerometer.set(-c.x,-c.y,-c.z),p&&(I()?this.gyroscope.set(-p.beta,p.alpha,p.gamma):this.gyroscope.set(p.alpha,p.beta,p.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,h)),this.filter.addAccelMeasurement(this.accelerometer,h),this.previousTimestampS=h},it.prototype.onOrientationChange_=function(a){this.setScreenTransform_()},it.prototype.onMessage_=function(a){var c=a.data;if(!(!c||!c.type)){var p=c.type.toLowerCase();p==="devicemotion"&&this.updateDeviceMotion_(c.deviceMotionEvent)}},it.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new fe(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new fe(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},it.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),u()&&J()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},it.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var ff=60,gf=new fe(1,0,0),vf=new fe(0,0,1),Ml=new ee;Ml.setFromAxisAngle(gf,-Math.PI/2),Ml.multiply(new ee().setFromAxisAngle(vf,Math.PI/2));var Ef=function(){function a(c){t(this,a),this.config=c,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new ee,this._outQ=new ee,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return e(a,[{key:"init",value:function(){var p=null;try{p=new RelativeOrientationSensor({frequency:ff,referenceFrame:"screen"}),p.addEventListener("error",this._onSensorError)}catch(h){this.errors.push(h),h.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):h.name==="ReferenceError"?this.useDeviceMotion():console.error(h)}p&&(this.api="sensor",this.sensor=p,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new it(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var p=this.sensor.quaternion;this._sensorQ.set(p[0],p[1],p[2],p[3]);var h=this._outQ;return h.copy(Ml),h.multiply(this._sensorQ),this.config.YAW_ONLY&&(h.x=h.z=0,h.normalize()),this._out[0]=h.x,this._out[1]=h.y,this._out[2]=h.z,this._out[3]=h.w,this._out}},{key:"_onSensorError",value:function(p){this.errors.push(p.error),p.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):p.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(p.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),a}(),xf="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Ur(){this.loadIcon_();var a=document.createElement("div"),b=a.style;b.position="fixed",b.top=0,b.right=0,b.bottom=0,b.left=0,b.backgroundColor="gray",b.fontFamily="sans-serif",b.zIndex=1e6;var c=document.createElement("img");c.src=this.icon;var b=c.style;b.marginLeft="25%",b.marginTop="25%",b.width="50%",a.appendChild(c);var p=document.createElement("div"),b=p.style;b.textAlign="center",b.fontSize="16px",b.lineHeight="24px",b.margin="24px 25%",b.width="50%",p.innerHTML="Place your phone into your Cardboard viewer.",a.appendChild(p);var h=document.createElement("div"),b=h.style;b.backgroundColor="#CFD8DC",b.position="fixed",b.bottom=0,b.width="100%",b.height="48px",b.padding="14px 24px",b.boxSizing="border-box",b.color="#656A6B",a.appendChild(h);var g=document.createElement("div");g.style.float="left",g.innerHTML="No Cardboard viewer?";var E=document.createElement("a");E.href="https://www.google.com/get/cardboard/get-cardboard/",E.innerHTML="get one",E.target="_blank";var b=E.style;b.float="right",b.fontWeight=600,b.textTransform="uppercase",b.borderLeft="1px solid gray",b.paddingLeft="24px",b.textDecoration="none",b.color="#656A6B",h.appendChild(g),h.appendChild(E),this.overlay=a,this.text=p,this.hide()}Ur.prototype.show=function(a){!a&&!this.overlay.parentElement?document.body.appendChild(this.overlay):a&&(this.overlay.parentElement&&this.overlay.parentElement!=a&&this.overlay.parentElement.removeChild(this.overlay),a.appendChild(this.overlay)),this.overlay.style.display="block";var c=this.overlay.querySelector("img"),p=c.style;P()?(p.width="20%",p.marginLeft="40%",p.marginTop="3%"):(p.width="50%",p.marginLeft="25%",p.marginTop="25%")},Ur.prototype.hide=function(){this.overlay.style.display="none"},Ur.prototype.showTemporarily=function(a,c){this.show(c),this.timer=setTimeout(this.hide.bind(this),a)},Ur.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Ur.prototype.update=function(){this.disableShowTemporarily(),!P()&&X()?this.show():this.hide()},Ur.prototype.loadIcon_=function(){this.icon=o("image/svg+xml",xf)};var bf="CardboardV1",Zu="WEBVR_CARDBOARD_VIEWER",Af="webvr-polyfill-viewer-selector";function st(a){try{this.selectedKey=localStorage.getItem(Zu)}catch(c){console.error("Failed to load viewer profile: %s",c)}this.selectedKey||(this.selectedKey=a||bf),this.dialog=this.createDialog_(Se.Viewers),this.root=null,this.onChangeCallbacks_=[]}st.prototype.show=function(a){this.root=a,a.appendChild(this.dialog);var c=this.dialog.querySelector("#"+this.selectedKey);c.checked=!0,this.dialog.style.display="block"},st.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},st.prototype.getCurrentViewer=function(){return Se.Viewers[this.selectedKey]},st.prototype.getSelectedKey_=function(){var a=this.dialog.querySelector("input[name=field]:checked");return a?a.id:null},st.prototype.onChange=function(a){this.onChangeCallbacks_.push(a)},st.prototype.fireOnChange_=function(a){for(var c=0;c<this.onChangeCallbacks_.length;c++)this.onChangeCallbacks_[c](a)},st.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Se.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Se.Viewers[this.selectedKey]);try{localStorage.setItem(Zu,this.selectedKey)}catch(a){console.error("Failed to save viewer profile: %s",a)}this.hide()},st.prototype.createDialog_=function(a){var c=document.createElement("div");c.classList.add(Af),c.style.display="none";var p=document.createElement("div"),E=p.style;E.position="fixed",E.left=0,E.top=0,E.width="100%",E.height="100%",E.background="rgba(0, 0, 0, 0.3)",p.addEventListener("click",this.hide.bind(this));var h=280,g=document.createElement("div"),E=g.style;E.boxSizing="border-box",E.position="fixed",E.top="24px",E.left="50%",E.marginLeft=-h/2+"px",E.width=h+"px",E.padding="24px",E.overflow="hidden",E.background="#fafafa",E.fontFamily="'Roboto', sans-serif",E.boxShadow="0px 5px 20px #666",g.appendChild(this.createH1_("Select your viewer"));for(var b in a)g.appendChild(this.createChoice_(b,a[b].label));return g.appendChild(this.createButton_("Save",this.onSave_.bind(this))),c.appendChild(p),c.appendChild(g),c},st.prototype.createH1_=function(a){var c=document.createElement("h1"),p=c.style;return p.color="black",p.fontSize="20px",p.fontWeight="bold",p.marginTop=0,p.marginBottom="24px",c.innerHTML=a,c},st.prototype.createChoice_=function(a,c){var p=document.createElement("div");p.style.marginTop="8px",p.style.color="black";var h=document.createElement("input");h.style.fontSize="30px",h.setAttribute("id",a),h.setAttribute("type","radio"),h.setAttribute("value",a),h.setAttribute("name","field");var g=document.createElement("label");return g.style.marginLeft="4px",g.setAttribute("for",a),g.innerHTML=c,p.appendChild(h),p.appendChild(g),p},st.prototype.createButton_=function(a,c){var p=document.createElement("button");p.innerHTML=a;var h=p.style;return h.float="right",h.textTransform="uppercase",h.color="#1094f7",h.fontSize="14px",h.letterSpacing=0,h.border=0,h.background="none",h.marginTop="16px",p.addEventListener("click",c),p};var yf=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function wf(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function Tf(a,c){return c={exports:{}},a(c,c.exports),c.exports}var Sf=Tf(function(a,c){(function(h,g){a.exports=g()})(yf,function(){return function(p){var h={};function g(E){if(h[E])return h[E].exports;var b=h[E]={i:E,l:!1,exports:{}};return p[E].call(b.exports,b,b.exports,g),b.l=!0,b.exports}return g.m=p,g.c=h,g.d=function(E,b,R){g.o(E,b)||Object.defineProperty(E,b,{configurable:!1,enumerable:!0,get:R})},g.n=function(E){var b=E&&E.__esModule?function(){return E.default}:function(){return E};return g.d(b,"a",b),b},g.o=function(E,b){return Object.prototype.hasOwnProperty.call(E,b)},g.p="",g(g.s=0)}([function(p,h,g){"use strict";var E=function(){function w(_,O){for(var U=0;U<O.length;U++){var z=O[U];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(_,z.key,z)}}return function(_,O,U){return O&&w(_.prototype,O),U&&w(_,U),_}}();function b(w,_){if(!(w instanceof _))throw new TypeError("Cannot call a class as a function")}var R=g(1),M=typeof navigator!="undefined"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,y=function(){function w(){b(this,w),M?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",R),this.noSleepVideo.addEventListener("timeupdate",function(_){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return E(w,[{key:"enable",value:function(){M?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){M?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),w}();p.exports=y},function(p,h,g){"use strict";p.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),Mf=wf(Sf),Rf=1e3,_f=[0,0,.5,1],Cf=[.5,0,.5,1],Pf=window.requestAnimationFrame,If=window.cancelAnimationFrame;function Lf(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function Ju(a){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:a.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:a.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:a.canPresent},maxLayers:{writable:!1,enumerable:!0,value:a.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Nt("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),a.hasOrientation}}})}function ue(a){a=a||{};var c="wakelock"in a?a.wakelock:!0;this.isPolyfilled=!0,this.displayId=Rf++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Nt("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Ju({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,c&&X()&&(this.wakelock_=new Mf)}ue.prototype.getFrameData=function(a){return me(a,this._getPose(),this)},ue.prototype.getPose=function(){return Nt("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},ue.prototype.resetPose=function(){return Nt("VRDisplay.prototype.resetPose"),this._resetPose()},ue.prototype.getImmediatePose=function(){return Nt("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},ue.prototype.requestAnimationFrame=function(a){return Pf(a)},ue.prototype.cancelAnimationFrame=function(a){return If(a)},ue.prototype.wrapForFullscreen=function(a){if(u())return a;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var c=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",c.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==a)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=a,this.originalParent_=a.parentElement,this.originalParent_||document.body.appendChild(a),!this.fullscreenWrapper_.parentElement){var p=this.fullscreenElement_.parentElement;p.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),p.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var h=this;function g(){if(!!h.fullscreenElement_){var E=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];h.fullscreenElement_.setAttribute("style",E.join("; ")+";")}}return g(),this.fullscreenWrapper_},ue.prototype.removeFullscreenWrapper=function(){if(!!this.fullscreenElement_){var a=this.fullscreenElement_;this.fullscreenElementCachedStyle_?a.setAttribute("style",this.fullscreenElementCachedStyle_):a.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var c=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(a),this.originalParent_===c?c.insertBefore(a,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(a),c.removeChild(this.fullscreenWrapper_),a}},ue.prototype.requestPresent=function(a){var c=this.isPresenting,p=this;return a instanceof Array||(Nt("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),a=[a]),new Promise(function(h,g){if(!p.capabilities.canPresent){g(new Error("VRDisplay is not capable of presenting."));return}if(a.length==0||a.length>p.capabilities.maxLayers){g(new Error("Invalid number of layers."));return}var E=a[0];if(!E.source){h();return}var b=E.leftBounds||_f,R=E.rightBounds||Cf;if(c){var M=p.layer_;M.source!==E.source&&(M.source=E.source);for(var y=0;y<4;y++)M.leftBounds[y]=b[y],M.rightBounds[y]=R[y];p.wrapForFullscreen(p.layer_.source),p.updatePresent_(),h();return}if(p.layer_={predistorted:E.predistorted,source:E.source,leftBounds:b.slice(0),rightBounds:R.slice(0)},p.waitingForPresent_=!1,p.layer_&&p.layer_.source){var w=p.wrapForFullscreen(p.layer_.source),_=function(){var z=L();p.isPresenting=w===z,p.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(K){console.error("screen.orientation.lock() failed due to",K.message)}),p.waitingForPresent_=!1,p.beginPresent_(),h()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),p.removeFullscreenWrapper(),p.disableWakeLock(),p.endPresent_(),p.removeFullscreenListeners_()),p.fireVRDisplayPresentChange_()},O=function(){!p.waitingForPresent_||(p.removeFullscreenWrapper(),p.removeFullscreenListeners_(),p.disableWakeLock(),p.waitingForPresent_=!1,p.isPresenting=!1,g(new Error("Unable to present.")))};p.addFullscreenListeners_(w,_,O),V(w)?(p.enableWakeLock(),p.waitingForPresent_=!0):(u()||m())&&(p.enableWakeLock(),p.isPresenting=!0,p.beginPresent_(),p.fireVRDisplayPresentChange_(),h())}!p.waitingForPresent_&&!u()&&(N(),g(new Error("Unable to present.")))})},ue.prototype.exitPresent=function(){var a=this.isPresenting,c=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(p,h){a?(!N()&&u()&&(c.endPresent_(),c.fireVRDisplayPresentChange_()),m()&&(c.removeFullscreenWrapper(),c.removeFullscreenListeners_(),c.endPresent_(),c.fireVRDisplayPresentChange_()),p()):h(new Error("Was not presenting to VRDisplay."))})},ue.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},ue.prototype.fireVRDisplayPresentChange_=function(){var a=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(a)},ue.prototype.fireVRDisplayConnect_=function(){var a=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(a)},ue.prototype.addFullscreenListeners_=function(a,c,p){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=a,this.fullscreenChangeHandler_=c,this.fullscreenErrorHandler_=p,c&&(document.fullscreenEnabled?a.addEventListener("fullscreenchange",c,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenchange",c,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",c,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenchange",c,!1)),p&&(document.fullscreenEnabled?a.addEventListener("fullscreenerror",p,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenerror",p,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",p,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenerror",p,!1))},ue.prototype.removeFullscreenListeners_=function(){if(!!this.fullscreenEventTarget_){var a=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var c=this.fullscreenChangeHandler_;a.removeEventListener("fullscreenchange",c,!1),a.removeEventListener("webkitfullscreenchange",c,!1),document.removeEventListener("mozfullscreenchange",c,!1),a.removeEventListener("msfullscreenchange",c,!1)}if(this.fullscreenErrorHandler_){var p=this.fullscreenErrorHandler_;a.removeEventListener("fullscreenerror",p,!1),a.removeEventListener("webkitfullscreenerror",p,!1),document.removeEventListener("mozfullscreenerror",p,!1),a.removeEventListener("msfullscreenerror",p,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},ue.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},ue.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},ue.prototype.beginPresent_=function(){},ue.prototype.endPresent_=function(){},ue.prototype.submitFrame=function(a){},ue.prototype.getEyeParameters=function(a){return null};var Df={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Ns={LEFT:"left",RIGHT:"right"};function Me(a){var c=se({},Df);a=se(c,a||{}),ue.call(this,{wakelock:a.MOBILE_WAKE_LOCK}),this.config=a,this.displayName="Cardboard VRDisplay",this.capabilities=new Ju({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new Ef(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new xi(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Se(this.dpdb_.getDeviceParams(),a.ADDITIONAL_VIEWERS),this.viewerSelector_=new st(a.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Ur),u()&&window.addEventListener("resize",this.onResize_.bind(this))}return Me.prototype=Object.create(ue.prototype),Me.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Me.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Me.prototype._getFieldOfView=function(a){var c;if(a==Ns.LEFT)c=this.deviceInfo_.getFieldOfViewLeftEye();else if(a==Ns.RIGHT)c=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",a),null;return c},Me.prototype._getEyeOffset=function(a){var c;if(a==Ns.LEFT)c=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(a==Ns.RIGHT)c=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",a),null;return c},Me.prototype.getEyeParameters=function(a){var c=this._getEyeOffset(a),p=this._getFieldOfView(a),h={offset:c,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(h,"fieldOfView",{enumerable:!0,get:function(){return Nt("VRFieldOfView","VRFrameData's projection matrices"),p}}),h},Me.prototype.onDeviceParamsUpdated_=function(a){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Me.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Me.prototype.beginPresent_=function(){var a=this.layer_.source.getContext("webgl");a||(a=this.layer_.source.getContext("experimental-webgl")),a||(a=this.layer_.source.getContext("webgl2")),a&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(a.canvas.width=H()*this.bufferScale_,a.canvas.height=D()*this.bufferScale_,this.cardboardUI_=new Nr(a)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Nr(a)),this.distorter_=new ft(a,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(c){this.viewerSelector_.show(this.layer_.source.parentElement),c.stopPropagation(),c.preventDefault()}.bind(this),function(c){this.exitPresent(),c.stopPropagation(),c.preventDefault()}.bind(this)),this.rotateInstructions_&&(P()&&X()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Me.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Me.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Me.prototype.submitFrame=function(a){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var p=c.canvas;(p.width!=this.lastWidth||p.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=p.width,this.lastHeight=p.height,this.cardboardUI_.render()}},Me.prototype.onOrientationChange_=function(a){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Me.prototype.onResize_=function(a){if(this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var p=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];c.canvas.setAttribute("style",p.join("; ")+";"),xe(c.canvas)}},Me.prototype.onViewerChanged_=function(a){this.deviceInfo_.setViewer(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Me.prototype.fireVRDisplayDeviceParamsChange_=function(){var a=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(a)},Me.VRFrameData=Lf,Me.VRDisplay=ue,Me})});function jf(r){return r}function td(r,t,e){let n=0,i=r.length,s=Math.floor((n+i)/2),o=!1;for(;n<i&&s<r.length;){let l=r[s],u=F(l)?null:e(l);x(u)&&t<u?i=s:(t===u&&(o=!0),n=s+1),s=Math.floor((n+i)/2)}return o||(s+=.5),s}function Rl(r,t,e){e=e||jf;let n=e(t);return td(r,n,e)}function Li(r,t){return r.splice(t,1)[0]}function be(r){return r.splice(0)}function _l(r,t){for(let e=0;e<r.length;++e)if(r[e]!==t[e])return e;return-1}function js(r,t,e){r.splice(e,0,t)}function Ge(r,t){let e=r.indexOf(t);return e>-1?(Li(r,e),!0):!1}function rd(r,...t){r.splice(0,r.length,...t)}function Je(r,...t){for(let e of t)for(let n of r)if(e(n))return n;return null}function Di(r,t,e,n){let i;return ae(e)?i=e:Le(e)&&(n=e),F(n)&&(n=!0),Wf(r,t,i,n)}function Wf(r,t,e,n){let i=Rl(r,t,e),s=i%1===0;return i=i|0,(!s||n)&&js(r,t,i),i}function nd(r,t){let e=Array.from(r);return zr(e,t),e}function zr(r,t){r.sort((e,n)=>{let i=t(e),s=t(n);return i<s?-1:i>s?1:0})}var Oi=class{constructor(t){this.value=t;d(this,"_forward",new Array);d(this,"_reverse",new Array)}connectSorted(t,e){x(e)?(Di(this._forward,t,n=>e(n.value)),t._reverse.push(this)):this.connectTo(t)}connectTo(t){this.connectAt(t,this._forward.length)}connectAt(t,e){js(this._forward,t,e),t._reverse.push(this)}disconnectFrom(t){Ge(this._forward,t),Ge(t._reverse,this)}isConnectedTo(t){return this._forward.indexOf(t)>=0||this._reverse.indexOf(t)>=0}flatten(){let t=new Set,e=[this];for(;e.length>0;){let n=e.shift();t.has(n)||(t.add(n),e.push(...n._forward))}return Array.from(t)}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var Ws=class extends Oi{connectTo(t){super.connectTo(t)}connectAt(t,e){super.connectAt(t,e)}connectSorted(t,e){super.connectSorted(t,e)}disconnectFrom(t){super.disconnectFrom(t)}isConnectedTo(t){return super.isConnectedTo(t)}flatten(){return super.flatten()}get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};function Xs(r,t,e){return new Map(r.map(n=>[t(n),e(n)]))}function Cl(r,t){return Xs(r,t,Pn)}var In=class{constructor(t){d(this,"items",new Map);d(this,"defaultItems",new Array);if(x(t))for(let[e,n]of t)this.add(e,n)}add(t,e){if(F(t))this.defaultItems.push(e);else{let n=this.items.get(t);F(n)&&this.items.set(t,n=[]),n.push(e)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return x(t)?this.items.has(t):this.defaultItems.length>0}get(t){return F(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(F(t))return this.defaultItems.length;let e=this.get(t);return x(e)?e.length:null}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return F(t)?be(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(F(t))Ge(this.defaultItems,e);else{let n=this.items.get(t);x(n)&&(Ge(n,e),n.length===0&&this.items.delete(t))}}clear(){this.items.clear(),be(this.defaultItems)}};var gt=class{constructor(t){d(this,"items",new Map);if(x(t))for(let[e,n,i]of t)this.add(e,n,i)}add(t,e,n){let i=this.items.get(t);return F(i)&&this.items.set(t,i=new Map),i.set(e,n),this}*entries(){for(let[t,e]of this.items)for(let[n,i]of e)yield[t,n,i]}keys(t){return F(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(F(e)||this.items.get(t).has(e))}get(t,e){return F(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){return F(e)?this.items.delete(t):this.items.has(t)?this.items.get(t).delete(e):!1}clear(){this.items.clear()}};var Bi=class{constructor(){d(this,"listeners",new Map);d(this,"listenerOptions",new Map)}addEventListener(t,e,n){if(ae(e)){let i=this.listeners.get(t);i||(i=new Array,this.listeners.set(t,i)),i.find(s=>s===e)||(i.push(e),n&&this.listenerOptions.set(e,n))}}removeEventListener(t,e){if(ae(e)){let n=this.listeners.get(t);n&&this.removeListener(n,e)}}clearEventListeners(t){for(let[e,n]of this.listeners)if(F(t)||t===e){for(let i of n)this.removeEventListener(t,i);be(n),this.listeners.delete(e)}}removeListener(t,e){let n=t.findIndex(i=>i===e);n>=0&&(Li(t,n),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let n of e){let i=this.listenerOptions.get(n);x(i)&&!Le(i)&&i.once&&this.removeListener(e,n),n.call(this,t)}return!t.defaultPrevented}},G=class extends Event{get type(){return super.type}constructor(t){super(t)}},te=class extends Bi{constructor(){super(...arguments);d(this,"bubblers",new Set);d(this,"scopes",new WeakMap)}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,n,i){super.addEventListener(e,n,i)}removeEventListener(e,n){super.removeEventListener(e,n)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,n,i,s){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([n,i]),this.addEventListener(n,i,s)}removeScope(e){let n=this.scopes.get(e);if(n){this.scopes.delete(e);for(let[i,s]of n)this.removeEventListener(i,s)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;for(let n of this.bubblers)if(!n.dispatchEvent(e))return!1;return!0}};var ot=class{constructor(t,e,n=!0){d(this,"promise");d(this,"_resolve",null);d(this,"_reject",null);d(this,"_result",null);d(this,"_error",null);d(this,"_started",!1);d(this,"_finished",!1);d(this,"resolve",null);d(this,"reject",null);let i=Fi,s=Fi;ae(t)&&(i=t),ae(e)&&(s=e),Le(t)?n=t:Le(e)&&(n=e),this.resolve=o=>{x(this._resolve)&&this._resolve(o)},this.reject=o=>{x(this._reject)&&this._reject(o)},this.promise=new Promise((o,l)=>{this._resolve=u=>{i(u)&&(this._result=u,this._finished=!0,o(u))},this._reject=u=>{s(u)&&(this._error=u,this._finished=!0,l(u))}}),n&&this.start()}get result(){if(x(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}start(){this._started=!0}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};function id(r,t){return"on"+t in r}function De(r,t,e,...n){F(n)&&(n=[]);let i;if(oe(e)?n.unshift(e):ce(e)&&(i=e),!(r instanceof Bi)){if(!id(r,t))throw new Vt(`Target does not have a ${t} rejection event`);for(let m of n)if(!id(r,m))throw new Vt(`Target does not have a ${m} rejection event`)}let s=new ot;if(ce(i)){let m=setTimeout(s.reject,i,`'${t}' has timed out.`);s.finally(clearTimeout.bind(globalThis,m))}let o=(m,f)=>{r.addEventListener(m,f),s.finally(()=>r.removeEventListener(m,f))},l=m=>s.resolve(m),u=m=>s.reject(m);o(t,l);for(let m of n)o(m,u);return s}function Pl(r){return r.then(Fi).catch(sd)}var od=class{constructor(t,e,n){d(this,"promise");d(this,"callback",null);this.promise=new Promise((i,s)=>{this.callback=(...o)=>{t(...o)?i(e(...o)):s(n(...o))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var Vt=class extends Error{constructor(e,n=null){super(e);this.innerError=n}};function ad(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function ld(){return"InstallTrigger"in globalThis}function Xf(){return/^mac/i.test(navigator.platform)}function Qf(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||Xf()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function Mt(){return/Mobile VR/.test(navigator.userAgent)||Ut}function Hi(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function Il(){return"getVRDisplays"in navigator}function Ks(){return Hi()||Il()}function ki(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||Qf()||Mt()}function Ln(){return!ki()}var Kf=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,Qs=navigator.userAgent.match(Kf),Ut=!!Qs,cd=Ut&&{major:parseFloat(Qs[1]),minor:parseFloat(Qs[2]),patch:parseFloat(Qs[3])},Ix=Ut&&/pacific/i.test(navigator.userAgent),Lx=Ut&&/quest/i.test(navigator.userAgent),Dx=Ut&&/quest 2/i.test(navigator.userAgent);var Ox=!("Document"in globalThis);var Yf=298.257223563,qf=6378137;var Ll=1/Yf,qs=1-Ll,$=Ll/(2-Ll),Fx=qf/(1+$)*(1+$*$/4+$*$*$*$/64),Ys=Math.sqrt(1-qs*qs),at=1-qs*qs,Hx=Ys*Ys/(1-Ys*Ys),kx=1-at*(.25+at*(3/64+5*at/256)),Nx=at*(3/8+at*(3/32+45*at/1024)),Vx=at*at*(15/256+at*45/1024),Ux=at*at*at*(35/3072),zx=[$/2-2*$*$/3+37*$*$*$/96,$*$/48+$*$*$/15,17*$*$*$/480],Gx=[2*$-2*$*$/3,7*$*$/3-8*$*$*$/5,56*$*$*$/15];function Pn(r){return r}function Fi(){return!0}function sd(){return!1}function ud(r,t){return r&&t}var Dl=2*Math.PI;function cr(r){return(r%Dl+Dl)%Dl}function et(r,t,e){return Math.min(e,Math.max(t,r))}function Qe(r){return r*Math.PI/180}function Zs(r,t,e){let n=e-t;return n===0?0:(r-t)/n}function Js(r,t,e){return r*(e-t)+t}function dd(r,t,e){return(1-e)*r+e*t}function Ol(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function $s(r){return r*180/Math.PI}function Ni(r){return Math.abs(r)>1e-4?r:0}function Vi(r,t,e){return typeof r===t||r instanceof e}function ae(r){return Vi(r,"function",Function)}function oe(r){return Vi(r,"string",String)}function Le(r){return Vi(r,"boolean",Boolean)}function ce(r){return Vi(r,"number",Number)}function pd(r){return ce(r)&&!Number.isNaN(r)}function lr(r){return x(r)&&Vi(r,"object",Object)}function Bl(r){return r instanceof Date}function lt(r){return r instanceof Array}function zt(r,t){throw new Error((t||"Unexpected object: ")+r)}function F(r){return r==null}function x(r){return!F(r)}var hd=/([^\/]+)\/(.+)/,Zf=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/,Gr=class{constructor(t,e,n){this._type=t;this._fullSubType=e;d(this,"_tree");d(this,"_subType");d(this,"_suffix");d(this,"_parameters");d(this,"_value");d(this,"_fullValue");d(this,"_extensions");d(this,"_primaryExtension",null);d(this,"depMessage",null);let i=new Map;this._parameters=i;let s=this._fullSubType.match(Zf);this._tree=s[1],this._subType=s[2],this._suffix=s[3];let o=s[4];if(this._value=this._fullValue=this._type+"/",x(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,x(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),x(o)){let l=o.split(";").map(u=>u.trim()).filter(u=>u.length>0).map(u=>u.split("="));for(let[u,...m]of l){let f=m.join("=");i.set(u,f);let v=`; ${u}=${f}`;this._fullValue+=v,u!=="q"&&(this._value+=v)}}this._extensions=n||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(hd);if(!e)return null;let n=e[1],i=e[2];return new Gr(n,i)}deprecate(t){return this.depMessage=t,this}check(){x(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(F(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,n=null;if(oe(t)){let i=t.match(hd);if(!i)return!1;e=i[1],n=i[2]}else e=t.typeName,n=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===n)}withParameter(t,e){let n=`${this._fullSubType}; ${t}=${e}`;return new Gr(this.typeName,n,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let n=t.substring(e+1);this.extensions.indexOf(n)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function Jf(r,t,...e){return new Gr(r,t,e)}function md(r){return Jf.bind(null,r)}var ur=class extends te{constructor(){super(...arguments);d(this,"attached",new Array);d(this,"soFar",null);d(this,"total",null);d(this,"msg",null);d(this,"est",null)}get p(){return this.total>0?this.soFar/this.total:0}report(e,n,i,s){this.soFar=e,this.total=n,this.msg=i,this.est=s;for(let o of this.attached)o.report(e,n,i,s)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,be(this.attached)}};var Ui=class extends ur{constructor(e,n){super();this.i=e;this.prog=n}report(e,n,i,s){super.report(e,n,i,s),this.prog.update(this.i,e,n,i)}};var Dn=class{constructor(t){this.prog=t;d(this,"weightTotal",0);d(this,"start");d(this,"subProgressCallbacks",new Array);d(this,"subProgressWeights",new Array);d(this,"subProgressValues",new Array);this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new Ui(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new Ui(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,n,i){if(this.prog){this.subProgressValues[t]=e/n;let s=0;for(let m=0;m<this.subProgressWeights.length;++m)s+=this.subProgressValues[m]*this.subProgressWeights[m];let o=performance.now(),l=o-this.start,u=this.start-o+l*this.weightTotal/s;this.prog.report(s,this.weightTotal,i,u)}}};function zi(r,t){return new Fl(t,r).subProgressCallbacks}var Fl=class extends Dn{constructor(t,e){super(e);for(let n of t)this.addSubProgress(n)}};function eo(r){return new Hl(r)}var Hl=class extends Dn{pop(t){return this.addSubProgress(t)}};async function eg(r,t){let e=new Array(t.length),n=new Array(t.length);for(let o=0;o<t.length;++o){let l=t[o];e[o]=l[0],n[o]=l[1]}let i=zi(r,e),s=new Array(t.length);for(let o=0;o<t.length;++o)s[o]=n[o](i[o]);return await Promise.all(s)}function to(r,...t){let e=t.map(n=>[1,n]);return eg(r,e)}function Gt(r,t){let e=globalThis,n=e[r];if(F(n)){if(F(t))throw new Error(`No value ${r} found`);n=t(),e[r]=n}return n}var tg="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function vt(r,t){if(r<0)throw new Error("Length must be greater than 0");F(t)&&(t=tg);let e="";for(let n=0;n<r;++n){let i=Math.floor(Math.random()*t.length);e+=t[i]}return e}function jr(...r){let t=[];for(let e of r)x(e)&&e.length>0&&t.indexOf(e)===-1&&t.push(e);return t.join("-")}var Gi=class{constructor(){d(this,"t",0);d(this,"dt",0);d(this,"sdt",0);d(this,"fps",0)}set(t,e){this.t=t,this.dt=e,this.sdt=dd(this.sdt,e,.01),e>0&&(this.fps=1e3/e)}},ro=class extends Gi{constructor(){super(),Object.seal(this)}};var ji,On=class{constructor(t){d(this,"timer",null);d(this,"onTick");d(this,"lt",-1);d(this,"tickHandlers",new Array);zs(this,ji,null);this.targetFPS=t;let e=new ro,n=0;this.onTick=i=>{this.lt>=0&&(n=i-this.lt,e.set(i,n),this.tick(e)),this.lt=i}}get targetFPS(){return Us(this,ji)}set targetFPS(t){Gs(this,ji,t)}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){Ge(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};ji=new WeakMap;var no=class extends On{constructor(t){super(t)}start(){let t=()=>{this.timer=setTimeout(t,this.targetFrameTime),this.onTick(performance.now())};this.timer=setTimeout(t,this.targetFrameTime)}stop(){this.isRunning&&(clearTimeout(this.timer),super.stop())}};function kl(r){return x(r)&&r.length>0?parseFloat(r):null}var fd=class{constructor(t,e){d(this,"_url",null);d(this,"_base");d(this,"_protocol",null);d(this,"_host",null);d(this,"_hostName",null);d(this,"_userName",null);d(this,"_password",null);d(this,"_port",null);d(this,"_pathName",null);d(this,"_hash",null);d(this,"_query",new Map);t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){x(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),x(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),x(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),x(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),x(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),x(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),x(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),x(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=kl(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if(x(this._protocol)&&(x(this._host)||x(this._hostName))){if(x(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=kl(this._url.port),this.rehydrate(),!1;if(x(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(x(this._pathName)&&x(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return x(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=kl(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^\/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function Nl(r){let t=new Map;for(let[e,n]of r)t.set(n,e);return t}var rg=new Map([[1,"KiB"],[2,"MiB"],[3,"GiB"],[4,"TiB"]]),ng=new Map([[1,"KB"],[2,"MB"],[3,"GB"],[4,"TB"]]),by=Nl(rg),Ay=Nl(ng);var gd=304.79999999999995,wy=gd*3,ig=10*100,sg=gd*16.5,og=sg*40,Ty=ig*1e3,Sy=og*8,vd=2.54*4,Ed=vd*3,My=Ed*3,ag=Ed*16.5,lg=ag*40,Ry=100*1e3,_y=lg*8,Vl=4*3,cg=Vl*3,Ul=100/2.54,ug=Vl*16.5,dg=ug*40,Cy=Ul*1e3,Py=dg*8,Iy=3*3,pg=100/vd,hg=3*16.5,mg=hg*40,Ly=pg*1e3,Dy=mg*8,zl=Ul/Vl,fg=16.5*40,Oy=zl*1e3,By=fg*8,gg=Ul/cg,vg=16.5/3,Eg=vg*40,Fy=gg*1e3,Hy=Eg*8,xd=16.5/zl,bd=xd*40,ky=bd*8,Ny=1e3/xd,Vy=40*8,xg=1e3/bd,Uy=8/xg;function Ad(r){return r/zl}function Gl(r,...t){if(!lr(r))return!1;r=r;for(let e of t){if(!(e in r))return!1;let n=r[e];if(!ae(n))return!1}return!0}function Bn(r){return Gl(r,"dispose")}function bg(r){return Gl(r,"destroy")}function Ag(r){return Gl(r,"close")}function yd(r){Bn(r)&&r.dispose(),Ag(r)&&r.close(),bg(r)&&r.destroy()}var pe=class{constructor(t,e,n,...i){this.key=t;this.value=e;this.bySetAttribute=n;this.tags=i.map(s=>s.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let i=this.key.substring(5);t.dataset[i]=this.value}else this.key==="style"?Object.assign(t.style,this.value):this.key==="classList"?this.value.forEach(i=>t.classList.add(i)):this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function dr(r){return new pe("autoplay",r,!1,"audio","video")}function Ae(r){return new pe("className",r,!1)}function Fn(...r){return new pe("classList",r,!1)}function Wr(r){return new pe("controls",r,!1,"audio","video")}function wd(r,t){return new pe("data-"+r,t,!1)}function Td(r){return new pe("height",r,!1,"canvas","embed","iframe","img","input","object","video")}function io(r){return new pe("id",r,!1)}function Hn(r){return new pe("loop",r,!1,"audio","bgsound","marquee","video")}function jl(r){return new pe("max",r,!1,"input","meter","progress")}function Wl(r){return new pe("min",r,!1,"input","meter")}function Sd(r){return new pe("muted",r,!1,"audio","video")}function pr(r){return new pe("playsInline",r,!1,"audio","video")}function yg(r){return r instanceof URL&&(r=r.href),r}function Wi(r){return new pe("src",yg(r),!1,"audio","embed","iframe","img","input","script","source","track","video")}function Xl(r){return new pe("srcObject",r,!1,"audio","video")}function Ql(r){return new pe("step",r,!1,"input")}function kn(r){return new pe("title",r,!1)}function Xi(r){return oe(r)||(r=r.value),new pe("type",r,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Nn(r){return new pe("value",r,!1,"button","data","input","li","meter","option","progress","param")}function Md(r){return new pe("width",r,!1,"canvas","embed","iframe","img","input","object","video")}var Q=class{constructor(t,e){this.key=t;this.value=e;this.name=t.replace(/[A-Z]/g,n=>`-${n.toLocaleLowerCase()}`)}applyToElement(t){t.style[this.key]=this.value}},Kl=class{constructor(...t){this.rest=t}applyToElement(t){for(let e of this.rest)e.applyToElement(t)}};function ct(...r){return new Kl(...r)}function Qi(r){return new Q("backgroundColor",r)}function Rd(r){return new Q("border",r)}function _d(r){return new Q("borderRadius",r)}function Cd(r){return new Q("boxShadow",r)}function Pd(r){return new Q("columnGap",r)}function je(r){return new Q("display",r)}function Id(r){return new Q("flexFlow",r)}function Ld(r){return new Q("float",r)}function so(r){return new Q("fontSize",r)}function oo(r,t,e,n){return oe(r)||(r=[r,t,e,n].filter(x).join("/")),new Q("gridArea",r)}function ao(r){return new Q("gridAutoFlow",r)}function Xr(r,t){return oe(r)||(r=[r,t].filter(x).join("/")),new Q("gridColumn",r)}function lo(r,t){return oe(r)||(r=[r,t].filter(x).join("/")),new Q("gridRow",r)}function hr(r){return new Q("gridTemplateColumns",r)}function co(r){return new Q("gridTemplateRows",r)}function jt(r){return new Q("height",r)}function Qr(r){return new Q("left",r)}function mr(r){return new Q("margin",r)}function Dd(r){return new Q("marginInlineStart",r)}function Od(r){return new Q("marginLeft",r)}function Bd(r){return new Q("maxHeight",r)}function Ki(r){return new Q("maxWidth",r)}function Fd(r){return new Q("minWidth",r)}function Hd(r){return new Q("overflow",r)}function fr(...r){return new Q("padding",r.join(" "))}function kd(r){return new Q("paddingRight",r)}function ql(r){return new Q("pointerEvents",r)}function Vn(r){return new Q("position",r)}function Kr(r){return new Q("textAlign",r)}function Yr(r){return new Q("top",r)}function Nd(r){return new Q("touchAction",r)}function Vd(r){return new Q("transform",r)}function Et(r){return new Q("width",r)}function Ud(r){return new Q("zIndex",ce(r)?r.toFixed(0):r)}function zd(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var Yl=class{constructor(t,e){this.selector=t;this.props=e}apply(t){let e=this.props.map(n=>`${n.name}: ${n.value};`).join("");t.insertRule(`${this.selector} {${e}}`,t.cssRules.length)}};function q(r,...t){return new Yl(r,t)}function $r(r){return lr(r)?r.element instanceof Node:!1}function $l(r){return lr(r)&&"elements"in r&&r.elements instanceof Array}function qr(r){return $r(r)?r.element:r}function wg(r){return lr(r)&&"applyToElement"in r&&ae(r.applyToElement)}function _e(r,t,e="block"){r=qr(r),r.style.display=t?e:"none"}function Rt(r){return r=qr(r),r.style.display!=="none"}function de(r,...t){r=qr(r);for(let e of t)x(e)&&(e instanceof Node?r.append(e):$r(e)?r.append(qr(e)):$l(e)?r.append(...e.elements.map(qr)):wg(e)?e.applyToElement(r):r.append(document.createTextNode(e.toLocaleString())));return r}function Ne(r,...t){let e=null;for(let n of t)if(n instanceof pe&&n.key==="id"){e=document.getElementById(n.value);break}return e==null&&(e=document.createElement(r)),de(e,...t),e}function uo(r){return"disabled"in r&&Le(r.disabled)}function Gd(r){for(r=qr(r);r.lastChild;)r.lastChild.remove()}function Un(r,t){r=qr(r),Gd(r),r.append(Sg(t))}async function jd(r,t,e){x(e)&&e.start();let n=r==="canplay"?t.HAVE_CURRENT_DATA:t.HAVE_ENOUGH_DATA;if(t.readyState>=n)return!0;try{return await De(t,r,"error"),!0}catch(i){return console.warn(t.error,i),!1}finally{x(e)&&e.end()}}function po(r,t){return jd("canplay",r,t)}function ho(r,t){return jd("canplaythrough",r,t)}function Zr(...r){return Ne("audio",...r)}function Tg(...r){return Ne("button",...r)}function Wd(...r){return Tg(...r,Xi("button"))}function zn(...r){return Wd(...r,Fn("btn","btn-primary"))}function mo(...r){return Wd(...r,Fn("btn","btn-secondary"))}function Xd(...r){return Ne("canvas",...r)}function Qd(...r){return Ne("dd",...r)}function ve(...r){return Ne("div",...r)}function Kd(...r){return Ne("dl",...r)}function Yd(...r){return Ne("dt",...r)}function qd(...r){return Ne("h1",...r)}function $d(...r){return Ne("h2",...r)}function Yi(...r){return Ne("img",...r)}function Zl(...r){return Ne("input",...r)}function Zd(...r){return Ne("label",...r)}function Jd(...r){return Ne("meter",...r)}function fo(...r){return Ne("option",...r)}function Jl(...r){return Ne("select",...r)}function ep(...r){return Ne("video",...r)}function tp(...r){return Zl(Xi("checkbox"),...r)}function rp(...r){return Zl(Xi("number"),...r)}function np(...r){return Zl(Xi("range"),...r)}function Sg(r){return document.createTextNode(r)}function _t(...r){let t=document.createElement("style");document.head.append(t);for(let e of r)e.apply(t.sheet);return t}function ec(r,t,e,...n){return Zr(pr(!0),Wr(!1),Sd(t),dr(r),Hn(e),ct(je("none")),...n)}var go="HTMLCanvasElement"in globalThis,C2="HTMLImageElement"in globalThis,ip=!1,vo=!ip&&"OffscreenCanvas"in globalThis,sp=!ip&&"createImageBitmap"in globalThis;function Gn(r){return go&&r instanceof HTMLCanvasElement}function op(r){return vo&&r instanceof OffscreenCanvas}function ap(r){return sp&&r instanceof ImageBitmap}function Mg(r,t){let e=r.getContext("2d");if(F(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Rg(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var _g=vo&&Rg(),Jr=_g&&Ig||go&&tc||null,Eo=go?tc:Jr;function Cg(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var P2=vo&&Cg();function Pg(){if(!go&&!vo)return!1;try{return Jr(1,1).getContext("bitmaprenderer")!=null}catch{return!1}}var I2=sp&&Pg();function Ig(r,t){return new OffscreenCanvas(r,t)}function tc(r,t){return Xd(Md(r),Td(t))}function lp(r){let t=tc(r.width,r.height);return Mg(t,r),t}function cp(r,t,e,n=1){return t=Math.floor(t*n),e=Math.floor(e*n),r.width!=t||r.height!=e?(r.width=t,r.height=e,!0):!1}function Lg(r){return x(r.textBaseline)}function Dg(r,t,e,n=1){let i=r.imageSmoothingEnabled,s=r.textBaseline,o=r.textAlign,l=r.font,u=cp(r.canvas,t,e,n);return u&&(r.imageSmoothingEnabled=i,r.textBaseline=s,r.textAlign=o,r.font=l),u}function rc(r,t,e,n=1){return Lg(r)?Dg(r,t,e,n):cp(r.canvas,t,e,n)}var gr=class extends te{constructor(e,n,i){super();d(this,"_canvas");d(this,"_scale",250);d(this,"_g");d(this,"_visible",!0);d(this,"wasVisible",null);d(this,"redrawnEvt",new G("redrawn"));d(this,"element",null);x(i)&&x(i.scale)&&(this._scale=i.scale),this._canvas=Eo(e,n),this._g=this.canvas.getContext("2d"),Gn(this._canvas)&&(this.element=this._canvas)}fillRect(e,n,i,s,o,l){this.g.fillStyle=e,this.g.fillRect(n+l,i+l,s-2*l,o-2*l)}drawText(e,n,i,s){this.g.textAlign=s,this.g.strokeText(e,n,i),this.g.fillText(e,n,i)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var xo=class extends gr{constructor(){super(128,128);this._pitch=0;this._heading=0;this.redraw()}get pitch(){return this._pitch}set pitch(e){e!==this.pitch&&(this._pitch=e,this.redraw())}get heading(){return this._heading}set heading(e){e!==this.heading&&(this._heading=e,this.redraw())}setPitchAndHeading(e,n){(e!==this.pitch||n!==this.heading)&&(this._pitch=e,this._heading=n,this.redraw())}onRedraw(){let e=Qe(this.pitch),n=Qe(this.heading-180),i=5,s=this.canvas.width-2*i,o=this.canvas.height-2*i,l=.5*s,u=.5*o,m=Math.sin(e),f=this.g;return f.save(),f.clearRect(0,0,this.canvas.width,this.canvas.height),f.translate(i,i),f.scale(l,u),f.translate(1,1),f.fillStyle="#808080",f.beginPath(),f.arc(0,0,1,0,2*Math.PI),f.fill(),f.fillStyle="#d0d0d0",f.beginPath(),f.arc(0,0,1,0,Math.PI,!0),f.fill(),f.save(),f.scale(1,Math.abs(m)),m<0&&(f.fillStyle="#808080"),f.beginPath(),f.arc(0,0,1,0,Math.PI,m<0),f.fill(),f.restore(),f.save(),f.shadowColor="#404040",f.shadowBlur=4,f.shadowOffsetX=3,f.shadowOffsetY=3,f.rotate(n),f.fillStyle="#ff0000",f.beginPath(),f.moveTo(-.1,0),f.lineTo(0,.667),f.lineTo(.1,0),f.closePath(),f.fill(),f.fillStyle="#ffffff",f.beginPath(),f.moveTo(-.1,0),f.lineTo(0,-.667),f.lineTo(.1,0),f.closePath(),f.fill(),f.restore(),f.beginPath(),f.strokeStyle="#000000",f.lineWidth=.1,f.arc(0,0,1,0,2*Math.PI),f.stroke(),f.restore(),!0}};var V2=Gt("juniper::loadedFonts",()=>[]);function bo(r){let t=[];return r.fontStyle&&r.fontStyle!=="normal"&&t.push(r.fontStyle),r.fontVariant&&r.fontVariant!=="normal"&&t.push(r.fontVariant),r.fontWeight&&r.fontWeight!=="normal"&&t.push(r.fontWeight),t.push(`${r.fontSize}px`),t.push(r.fontFamily),t.join(" ")}function up(r){return"getBattery"in r}var Og=["","N/A","charging"],jn=class extends gr{constructor(){super(256,128);this.battery=null;this.lastChargeDirection=null;this.lastLevel=null;this.chargeDirection=0;this.level=.5;up(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,n=this.level!==this.lastLevel;if(!e&&!n)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let i=this.level<.1?"red":"#ccc",s=7,o=.7,l=(1-o)/2,u=this.canvas.width-2*s,m=u-4*s,f=this.canvas.height-4*s,v=u/2,A=this.canvas.height/2,T=Og[this.chargeDirection+1];return this.g.clearRect(0,0,u,this.canvas.height),this.g.save(),this.g.translate(l*this.canvas.width,l*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(o,o),this.fillRect("#ccc",0,0,u,this.canvas.height,0),this.fillRect("#ccc",u,A-2*s-10,s+10,4*s+20,0),this.g.clearRect(s,s,u-2*s,this.canvas.height-2*s),this.fillRect("black",s,s,u-2*s,this.canvas.height-2*s,0),this.g.clearRect(2*s,2*s,m*this.level,f),this.fillRect(i,2*s,2*s,m*this.level,f,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=bo({fontSize:f/2,fontFamily:"Lato"}),this.drawText(T,v,A,"center"),this.g.restore(),!0}async readBattery(e){let n=this.redraw.bind(this);n(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",n),this.battery.addEventListener("levelchange",n),setInterval(n,1e3),n()}};jn.isAvailable=up(navigator);var vr=class extends gr{constructor(e){super(10,10,e);d(this,"trueWidth",null);d(this,"trueHeight",null);d(this,"trueFontSize",null);d(this,"dx",null);d(this,"_minWidth",null);d(this,"_maxWidth",null);d(this,"_minHeight",null);d(this,"_maxHeight",null);d(this,"_freezeDimensions",!1);d(this,"_dimensionsFrozen",!1);d(this,"_bgFillColor",null);d(this,"_bgStrokeColor",null);d(this,"_bgStrokeSize",null);d(this,"_textStrokeColor",null);d(this,"_textStrokeSize",null);d(this,"_textFillColor","black");d(this,"_textDirection","horizontal");d(this,"_wrapWords",!0);d(this,"_fontStyle","normal");d(this,"_fontVariant","normal");d(this,"_fontWeight","normal");d(this,"_fontFamily","sans-serif");d(this,"_fontSize",20);d(this,"_padding");d(this,"_value",null);x(e)&&(x(e.minWidth)&&(this._minWidth=e.minWidth),x(e.maxWidth)&&(this._maxWidth=e.maxWidth),x(e.minHeight)&&(this._minHeight=e.minHeight),x(e.maxHeight)&&(this._maxHeight=e.maxHeight),x(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),x(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),x(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),x(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),x(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),x(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),x(e.value)&&(this._value=e.value),x(e.textFillColor)&&(this._textFillColor=e.textFillColor),x(e.textDirection)&&(this._textDirection=e.textDirection),x(e.wrapWords)&&(this._wrapWords=e.wrapWords),x(e.fontStyle)&&(this._fontStyle=e.fontStyle),x(e.fontVariant)&&(this._fontVariant=e.fontVariant),x(e.fontWeight)&&(this._fontWeight=e.fontWeight),x(e.fontFamily)&&(this._fontFamily=e.fontFamily),x(e.fontSize)&&(this._fontSize=e.fontSize),x(e.padding)&&(ce(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),F(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get wrapWords(){return this._wrapWords}set wrapWords(e){this.wrapWords!==e&&(this._wrapWords=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}draw(e,n,i){this.canvas.width>0&&this.canvas.height>0&&e.drawImage(this.canvas,n,i,this.width,this.height)}split(e){return this.wrapWords?e.split(" ").join(`
`).replace(/\r\n/,`
`).split(`
`):e.replace(/\r\n/,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value){let e=this.split(this.value),n=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let s=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,o=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,l=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,u=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,m=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,f=n?u:o,v=n?m:l,A=n?o:u,T=n?l:m,C=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let I=!1,P=!1,B=1e4,H=0;this.trueFontSize=et(this.fontSize*this.scale,H,B);let D=null,V=Number.MAX_VALUE;do{let k=this.fontSize;this._fontSize=this.trueFontSize;let Z=bo(this);this._fontSize=k,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=Z,this.trueWidth=0,this.trueHeight=0;for(let ie of e){let X=this.g.measureText(ie);this.trueWidth=Math.max(this.trueWidth,X.width),this.trueHeight+=this.trueFontSize,ce(X.actualBoundingBoxLeft)&&ce(X.actualBoundingBoxRight)&&ce(X.actualBoundingBoxAscent)&&ce(X.actualBoundingBoxDescent)&&(s||(this.trueWidth=X.actualBoundingBoxLeft+X.actualBoundingBoxRight,this.trueHeight=X.actualBoundingBoxAscent+X.actualBoundingBoxDescent,this.dx=(X.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(s){let ie=this.trueWidth-f,X=this.trueWidth-v,se=this.trueHeight-A,xe=this.trueHeight-T,me=Math.abs(ie),J=Math.abs(X),ze=Math.abs(se),Cn=Math.abs(xe);I=X>1||xe>1,P=ie<-1&&se<-1;let or=Math.min(me,Math.min(J,Math.min(ze,Cn)));or<V&&(V=or,D=this.g.font),(I||P)&&C.indexOf(this.g.font)>-1&&D&&(this.g.font=D,I=!1,P=!1),I?(B=this.trueFontSize,this.trueFontSize=(H+this.trueFontSize)/2):P&&(H=this.trueFontSize,this.trueFontSize=(this.trueFontSize+B)/2)}C.push(this.g.font)}while(I||P);s&&(this.trueWidth<f?this.trueWidth=f:this.trueWidth>v&&(this.trueWidth=v),this.trueHeight<A?this.trueHeight=A:this.trueHeight>T&&(this.trueHeight=T));let N=this.trueWidth+this.scale*(this.padding.right+this.padding.left),L=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{rc(this.g,N,L)}catch(k){throw console.error(k),k}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let i=.5*(e.length-1);for(let s=0;s<e.length;++s){let o=e[s],l=(s-i)*this.trueFontSize,u=this.dx+this.trueWidth/2+this.scale*this.padding.left,m=l+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(o,u,m),this.textFillColor&&this.g.fillText(o,u,m)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let s=this.bgStrokeSize/2;this.g.strokeRect(s,s,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(n){let s=Jr(this.canvas.height,this.canvas.width),o=s.getContext("2d");o?(o.translate(s.width/2,s.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?o.rotate(Math.PI/2):this.textDirection==="vertical-right"&&o.rotate(-Math.PI/2),o.translate(-this.canvas.width/2,-this.canvas.height/2),o.drawImage(this.canvas,0,0),rc(this.g,s.width,s.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(s,0,0)}return!0}else return!1}};var Ao=class extends vr{constructor(){super({textFillColor:"#ffffff",textStrokeColor:"rgba(0, 0, 0, 0.25)",textStrokeSize:.05,fontFamily:zd(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,wrapWords:!1,freezeDimensions:!0});this._fps=null;this.lastLen=0;let e=this.update.bind(this);setInterval(e,500),e()}get fps(){return this._fps}set fps(e){e!==this.fps&&(this._fps=e,this.update())}update(){let n=new Date().toLocaleTimeString();this.fps!==null&&(n+=` ${Math.round(this.fps).toFixed(0)}hz`),n.length!==this.lastLen&&(this.lastLen=n.length,this.unfreeze()),this.value=n}};var dp=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function pp(r,t){let e=t||(async()=>!0),n=async i=>{if(i.isTrusted&&await e()){for(let s of dp)window.removeEventListener(s,n);await r()}};for(let i of dp)window.addEventListener(i,n)}var Bg="AudioContext"in globalThis,hp=Bg&&"AudioListener"in globalThis,mp=hp&&"setPosition"in AudioListener.prototype,qi=hp&&"positionX"in AudioListener.prototype,ow=ae(HTMLMediaElement.prototype.captureStream)||ae(HTMLMediaElement.prototype.mozCaptureStream);function fp(r){return x(r)&&r.node instanceof AudioNode}function gp(r){return x(r)&&r.input instanceof AudioNode&&r.output instanceof AudioNode}var Er=Gt("Juniper:Audio:connections",()=>new Map),nc=Gt("Juniper:Audio:names",()=>new Map);function vp(r){return gp(r)?r.output:fp(r)?r.node:r}function Ep(r){if(F(r))return;let t=null;lt(r)?r.length===2?t=r[1]:t=r[2]:t=r;let e=null;return gp(t)?e=t.input:fp(t)?e=t.node:e=t,e}function xp(r){return lt(r)?r.length===2?[r[0]]:[r[0],r[1]]:[]}function Fg(r){return x(r)&&x(r.context)}function bp(r,t){nc.set(t,r)}function re(r){nc.delete(r),Fg(r)&&Ct(r)}function Ap(...r){for(let t=1;t<r.length;++t)xt(r[t-1],r[t])}function xt(r,t){let e=vp(r),n=Ep(t),i=xp(t);if(F(n))throw new Error("Must have a target to connect to");n instanceof AudioParam?e.connect(n,i[0]):n instanceof AudioNode?e.connect(n,i[0],i[1]):zt(n),Er.has(e)||Er.set(e,new Set);let s=Er.get(e);return s.has(n)?!1:(s.add(n),!0)}function Ct(r,t){let e=vp(r),n=Ep(t),i=xp(t);if(F(n)?e.disconnect():n instanceof AudioParam?e.disconnect(n,i[0]):n instanceof AudioNode?e.disconnect(n,i[0],i[1]):zt(n),!Er.has(e))return!1;let s=Er.get(e),o=!1;return F(n)?(o=s.size>0,s.clear()):s.has(n)&&(o=!0,s.delete(n)),s.size===0&&Er.delete(e),o}function Hg(){let r=new Map;function t(e){r.has(e)||r.set(e,new Ws(e))}for(let e of nc.keys())t(e);for(let[e,n]of Er){t(e);for(let i of n)t(i)}for(let[e,n]of Er){let i=r.get(e);for(let s of n)r.has(s)&&i.connectTo(r.get(s))}return Array.from(r.values())}globalThis.getAudioGraph=Hg;async function yp(r){if(bp("speakers",r.destination),r.state!=="running")if(r.state==="closed")await r.resume();else if(r.state==="suspended"){let t=De(r,"statechange");pp(()=>r.resume()),await t}else zt(r.state)}function Wt(r,t,...e){bp(r,t);for(let n of e)x(n)&&xt(t,n);return t}function wp(r,t,e,...n){return Wt(r,new AnalyserNode(t,e),...n)}function Wn(r,t,e,...n){return Wt(r,new BiquadFilterNode(t,e),...n)}function Tp(r,t,e,...n){return Wt(r,new DelayNode(t,e),...n)}function Sp(r,t,e,...n){return Wt(r,new DynamicsCompressorNode(t,e),...n)}function Oe(r,t,e,...n){return Wt(r,new GainNode(t,e),...n)}function en(r,t,e,...n){return Wt(r,t.createMediaElementSource(e),...n)}function ic(r,t,e,...n){return Wt(r,new MediaStreamAudioDestinationNode(t,e),...n)}function Mp(r,t,e,...n){return Wt(r,t.createMediaStreamSource(e),...n)}function Rp(r,t,e,...n){return Wt(r,new PannerNode(t,e),...n)}var yo=1e-6,$i=typeof Float32Array!="undefined"?Float32Array:Array,sc=Math.random;var lw=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Be={};Uf(Be,{add:()=>Gg,angle:()=>d0,bezier:()=>n0,ceil:()=>jg,clone:()=>Ng,copy:()=>Ug,create:()=>_p,cross:()=>e0,dist:()=>x0,distance:()=>Dp,div:()=>E0,divide:()=>Lp,dot:()=>Fp,equals:()=>f0,exactEquals:()=>m0,floor:()=>Wg,forEach:()=>w0,fromValues:()=>Vg,hermite:()=>r0,inverse:()=>Zg,len:()=>A0,length:()=>Cp,lerp:()=>t0,max:()=>Qg,min:()=>Xg,mul:()=>v0,multiply:()=>Ip,negate:()=>$g,normalize:()=>Jg,random:()=>i0,rotateX:()=>l0,rotateY:()=>c0,rotateZ:()=>u0,round:()=>Kg,scale:()=>Yg,scaleAndAdd:()=>qg,set:()=>zg,sqrDist:()=>b0,sqrLen:()=>y0,squaredDistance:()=>Op,squaredLength:()=>Bp,str:()=>h0,sub:()=>g0,subtract:()=>Pp,transformMat3:()=>o0,transformMat4:()=>s0,transformQuat:()=>a0,zero:()=>p0});function _p(){var r=new $i(3);return $i!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ng(r){var t=new $i(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function Cp(r){var t=r[0],e=r[1],n=r[2];return Math.hypot(t,e,n)}function Vg(r,t,e){var n=new $i(3);return n[0]=r,n[1]=t,n[2]=e,n}function Ug(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function zg(r,t,e,n){return r[0]=t,r[1]=e,r[2]=n,r}function Gg(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function Pp(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function Ip(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function Lp(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}function jg(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r}function Wg(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r}function Xg(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r}function Qg(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r}function Kg(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r}function Yg(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function qg(r,t,e,n){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function Dp(r,t){var e=t[0]-r[0],n=t[1]-r[1],i=t[2]-r[2];return Math.hypot(e,n,i)}function Op(r,t){var e=t[0]-r[0],n=t[1]-r[1],i=t[2]-r[2];return e*e+n*n+i*i}function Bp(r){var t=r[0],e=r[1],n=r[2];return t*t+e*e+n*n}function $g(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function Zg(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r}function Jg(r,t){var e=t[0],n=t[1],i=t[2],s=e*e+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r}function Fp(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function e0(r,t,e){var n=t[0],i=t[1],s=t[2],o=e[0],l=e[1],u=e[2];return r[0]=i*u-s*l,r[1]=s*o-n*u,r[2]=n*l-i*o,r}function t0(r,t,e,n){var i=t[0],s=t[1],o=t[2];return r[0]=i+n*(e[0]-i),r[1]=s+n*(e[1]-s),r[2]=o+n*(e[2]-o),r}function r0(r,t,e,n,i,s){var o=s*s,l=o*(2*s-3)+1,u=o*(s-2)+s,m=o*(s-1),f=o*(3-2*s);return r[0]=t[0]*l+e[0]*u+n[0]*m+i[0]*f,r[1]=t[1]*l+e[1]*u+n[1]*m+i[1]*f,r[2]=t[2]*l+e[2]*u+n[2]*m+i[2]*f,r}function n0(r,t,e,n,i,s){var o=1-s,l=o*o,u=s*s,m=l*o,f=3*s*l,v=3*u*o,A=u*s;return r[0]=t[0]*m+e[0]*f+n[0]*v+i[0]*A,r[1]=t[1]*m+e[1]*f+n[1]*v+i[1]*A,r[2]=t[2]*m+e[2]*f+n[2]*v+i[2]*A,r}function i0(r,t){t=t||1;var e=sc()*2*Math.PI,n=sc()*2-1,i=Math.sqrt(1-n*n)*t;return r[0]=Math.cos(e)*i,r[1]=Math.sin(e)*i,r[2]=n*t,r}function s0(r,t,e){var n=t[0],i=t[1],s=t[2],o=e[3]*n+e[7]*i+e[11]*s+e[15];return o=o||1,r[0]=(e[0]*n+e[4]*i+e[8]*s+e[12])/o,r[1]=(e[1]*n+e[5]*i+e[9]*s+e[13])/o,r[2]=(e[2]*n+e[6]*i+e[10]*s+e[14])/o,r}function o0(r,t,e){var n=t[0],i=t[1],s=t[2];return r[0]=n*e[0]+i*e[3]+s*e[6],r[1]=n*e[1]+i*e[4]+s*e[7],r[2]=n*e[2]+i*e[5]+s*e[8],r}function a0(r,t,e){var n=e[0],i=e[1],s=e[2],o=e[3],l=t[0],u=t[1],m=t[2],f=i*m-s*u,v=s*l-n*m,A=n*u-i*l,T=i*A-s*v,C=s*f-n*A,I=n*v-i*f,P=o*2;return f*=P,v*=P,A*=P,T*=2,C*=2,I*=2,r[0]=l+f+T,r[1]=u+v+C,r[2]=m+A+I,r}function l0(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function c0(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function u0(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function d0(r,t){var e=r[0],n=r[1],i=r[2],s=t[0],o=t[1],l=t[2],u=Math.sqrt(e*e+n*n+i*i),m=Math.sqrt(s*s+o*o+l*l),f=u*m,v=f&&Fp(r,t)/f;return Math.acos(Math.min(Math.max(v,-1),1))}function p0(r){return r[0]=0,r[1]=0,r[2]=0,r}function h0(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function m0(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function f0(r,t){var e=r[0],n=r[1],i=r[2],s=t[0],o=t[1],l=t[2];return Math.abs(e-s)<=yo*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(n-o)<=yo*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-l)<=yo*Math.max(1,Math.abs(i),Math.abs(l))}var g0=Pp,v0=Ip,E0=Lp,x0=Dp,b0=Op,A0=Cp,y0=Bp,w0=function(){var r=_p();return function(t,e,n,i,s,o){var l,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,t.length):u=t.length,l=n;l<u;l+=e)r[0]=t[l],r[1]=t[l+1],r[2]=t[l+2],s(r,r,o),t[l]=r[0],t[l+1]=r[1],t[l+2]=r[2];return t}}();var wo=class{constructor(){d(this,"t",0);d(this,"p",Be.create());d(this,"f",Be.set(Be.create(),0,0,-1));d(this,"u",Be.set(Be.create(),0,1,0));d(this,"o",Be.create());Object.seal(this)}set(t,e,n,i,s,o,l,u,m){this.setPosition(t,e,n),this.setOrientation(i,s,o,l,u,m)}setPosition(t,e,n){Be.set(this.p,t,e,n)}setOrientation(t,e,n,i,s,o){Be.set(this.f,t,e,n),Be.set(this.u,i,s,o)}setOffset(t,e,n){Be.set(this.o,t,e,n)}copy(t){Be.copy(this.p,t.p),Be.copy(this.f,t.f),Be.copy(this.u,t.u),Be.copy(this.o,t.o)}};var Xn=class extends te{constructor(e,n,i){super();this.id=e;this.audioCtx=n;this.spatializer=i;d(this,"pose",new wo);d(this,"volumeControl");d(this,"disposed",!1);this.volumeControl=Oe(`volume-control-${this.id}`,n)}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){re(this.volumeControl),Bn(this.spatializer)&&this.spatializer.dispose()}audioTick(e){this.spatializer.setPose(this.pose,e)}};var Qn=class{constructor(t){this.id=t;d(this,"minDistance",1);d(this,"maxDistance",10);d(this,"algorithm","inverse")}setAudioProperties(t,e,n){this.minDistance=t,this.maxDistance=e,this.algorithm=n}};var Kn=class extends Qn{constructor(){super(...arguments);d(this,"input");d(this,"output");d(this,"disposed",!1)}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){re(this.input)}};var oc=Gt("Juniper:Audio:Destinations:Spatializers:NoSpatializationNode:nodes",()=>new WeakMap),Ve=class extends Kn{static instance(t){if(!oc.has(t)){let e=`no-spatialization-hook-${vt(8)}`;oc.set(t,new Ve(e,t))}return oc.get(t)}constructor(t,e){super(t),this.input=this.output=Oe(this.id,e),Object.seal(this)}setPose(t,e){}};var To=class extends Xn{constructor(e,n,i){super("final",e,i);this._trueDestination=n;d(this,"_remoteUserInput");d(this,"_spatializedInput");d(this,"_nonSpatializedInput");this._remoteUserInput=Oe("remote-user-input",this.audioCtx,null,this._spatializedInput=Oe("spatialized-input",this.audioCtx,null,this.volumeControl)),this._nonSpatializedInput=Oe("non-spatialized-input",this.audioCtx,null,this.volumeControl),xt(this.volumeControl,this._trueDestination),xt(Ve.instance(this.audioCtx),this.nonSpatializedInput)}onDisposing(){re(this._remoteUserInput),re(this._spatializedInput),re(this._nonSpatializedInput),super.onDisposing()}get remoteUserInput(){return this._remoteUserInput}get spatializedInput(){return this._spatializedInput}get nonSpatializedInput(){return this._nonSpatializedInput}get trueDestination(){return this._trueDestination}};var Yn=class extends Qn{constructor(e){super("listener");this.audioCtx=e}get listener(){return this.audioCtx.listener}};var So=class extends Yn{constructor(t){if(super(t),!qi)throw new Error("Latest WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:n,f:i,u:s}=t;this.listener.positionX.setValueAtTime(n[0],e),this.listener.positionY.setValueAtTime(n[1],e),this.listener.positionZ.setValueAtTime(n[2],e),this.listener.forwardX.setValueAtTime(i[0],e),this.listener.forwardY.setValueAtTime(i[1],e),this.listener.forwardZ.setValueAtTime(i[2],e),this.listener.upX.setValueAtTime(s[0],e),this.listener.upY.setValueAtTime(s[1],e),this.listener.upZ.setValueAtTime(s[2],e)}};var Mo=class extends Yn{constructor(t){if(super(t),!mp)throw new Error("WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:n,f:i,u:s}=t;this.listener.setPosition(n[0],n[1],n[2]),this.listener.setOrientation(i[0],i[1],i[2],s[0],s[1],s[2])}};var tt=ae(HTMLAudioElement.prototype.setSinkId);function T0(r){let t=[];for(let e=0;e<r.length;++e){let n=r[e],i=!1;for(let s=0;s<t.length&&!i;++s){let o=t[s];i=n.kind===o.kind&&o.label.indexOf(n.label)>0}i||t.push(n)}return t}var ac=class extends G{constructor(e){super("audiooutputchanged");this.device=e}},lc=class extends G{constructor(e){super("audioinputchanged");this.audio=e}},cc=class extends G{constructor(e){super("videoinputchanged");this.video=e}},Hp="calla:preferredAudioOutputID",kp="calla:preferredAudioInputID",Np="calla:preferredVideoInputID",Ro=class extends te{constructor(e,n=!1){super();this.element=e;this.needsVideoDevice=n;d(this,"_hasAudioPermission",!1);d(this,"_hasVideoPermission",!1);d(this,"_currentStream",null);d(this,"ready");this.ready=this.start(),Object.seal(this)}get hasAudioPermission(){return this._hasAudioPermission}get hasVideoPermission(){return this._hasVideoPermission}get currentStream(){return this._currentStream}set currentStream(e){if(e!==this.currentStream){if(x(this.currentStream)&&this.currentStream.active)for(let n of this.currentStream.getTracks())n.stop();this._currentStream=e}}async start(){if(tt){let e=await this.getPreferredAudioOutput();e&&await this.setAudioOutputDevice(e)}}async startPreferredAudioInput(){let e=await this.getPreferredAudioInput();e&&(await this.setAudioInputDevice(e),this.currentStream=await this.startStream())}async startPreferredVideoInput(){let e=await this.getPreferredVideoInput();e&&(await this.setVideoInputDevice(e),this.currentStream=await this.startStream())}get preferredAudioOutputID(){return tt?localStorage.getItem(Hp):null}get preferredAudioInputID(){return localStorage.getItem(kp)}get preferredVideoInputID(){return localStorage.getItem(Np)}async getAudioOutputDevices(e=!1){if(!tt)return[];let n=await this.getAvailableDevices(e);return n&&n.audioOutput||[]}async getAudioInputDevices(e=!1){let n=await this.getAvailableDevices(e);return n&&n.audioInput||[]}async getVideoInputDevices(e=!1){let n=await this.getAvailableDevices(e);return n&&n.videoInput||[]}async getAudioOutputDevice(){if(!tt)return null;let e=this.element&&this.element.sinkId;if(F(e))return null;let n=await this.getAudioOutputDevices();return Je(n,s=>s.deviceId===e)}async getAudioInputDevice(){if(F(this.currentStream)||!this.currentStream.active)return null;let e=this.currentStream.getAudioTracks();if(e.length===0)return null;let n=e[0],i=await this.getAudioInputDevices();return Je(i,o=>n.label===o.label)}async getVideoInputDevice(){if(F(this.currentStream)||!this.currentStream.active)return null;let e=this.currentStream.getVideoTracks();if(e.length===0)return null;let n=e[0],i=await this.getVideoInputDevices();return Je(i,o=>n.label===o.label)}async getPreferredAudioOutput(){if(!tt)return null;let e=await this.getAudioOutputDevices();return Je(e,i=>i.deviceId===this.preferredAudioOutputID,i=>i.deviceId==="default",i=>i.deviceId.length>0)}async getPreferredAudioInput(){let e=await this.getAudioInputDevices();return Je(e,i=>i.deviceId===this.preferredAudioInputID,i=>i.deviceId==="default",i=>i.deviceId.length>0)}async getPreferredVideoInput(){let e=await this.getVideoInputDevices();return Je(e,i=>i.deviceId===this.preferredVideoInputID,i=>this.needsVideoDevice&&i.deviceId.length>0)}async setAudioOutputDevice(e){if(tt){if(x(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(Hp,e&&e.deviceId||null);let n=this.element,i=n&&n.sinkId;this.preferredAudioOutputID!==i&&(x(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new ac(e)))}}async setAudioInputDevice(e){if(x(e)&&e.kind!=="audioinput")throw new Error(`Device is not an audio input device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(kp,e&&e.deviceId||null);let n=await this.getAudioInputDevice(),i=n&&n.deviceId;this.preferredAudioInputID!==i&&this.dispatchEvent(new lc(e))}async setVideoInputDevice(e){if(x(e)&&e.kind!=="videoinput")throw new Error(`Device is not an video input device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(Np,e&&e.deviceId||null);let n=await this.getVideoInputDevice(),i=n&&n.deviceId;this.preferredVideoInputID!==i&&this.dispatchEvent(new cc(e))}async getAvailableDevices(e=!1){let n=await this.getDevices();return e&&(n=T0(n)),{audioOutput:tt?n.filter(i=>i.kind==="audiooutput"):[],audioInput:n.filter(i=>i.kind==="audioinput"),videoInput:n.filter(i=>i.kind==="videoinput")}}async getDevices(){let e=null,n=null;for(let i=0;i<3;++i){e=await navigator.mediaDevices.enumerateDevices();for(let s of e)s.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=s.kind==="audioinput"&&s.label.length>0),this.needsVideoDevice&&!this.hasVideoPermission&&(this._hasVideoPermission=s.kind==="videoinput"&&s.label.length>0));if(this.hasAudioPermission&&(!this.needsVideoDevice||this.hasVideoPermission))break;try{(!this.hasAudioPermission||this.needsVideoDevice&&!this.hasVideoPermission)&&(n=await this.startStream())}catch(s){console.warn(s)}}if(n)for(let i of n.getTracks())i.stop();return e=nd(e||[],i=>i.label),e}startStream(){return navigator.mediaDevices.getUserMedia({audio:this.preferredAudioInputID&&{deviceId:this.preferredAudioInputID}||!0,video:this.needsVideoDevice&&(this.preferredVideoInputID&&{deviceId:this.preferredVideoInputID}||!0)||!1})}async getMediaPermissions(){return await this.getDevices(),{audio:this.hasAudioPermission,video:this.hasVideoPermission}}};function*S0(r,t,e=-1){let n=0;for(;e<0||n<e;){yield r,++n;let i=r+t;r=t,t=i}}function Vp(r,t,e){return new dc(r,t,3,e)}var uc=class{constructor(t,e,n,i,s){d(this,"input");d(this,"output");this.input=Oe(`${t}-input`,e,{gain:n},this.output=Tp(`${t}-delay`,e,{maxDelayTime:i,delayTime:i},s))}dispose(){re(this.input),re(this.output)}},dc=class{constructor(t,e,n,i){d(this,"input");d(this,"layers");d(this,"output");this.output=Oe(`${t}-output`,e,null,i);let s=Array.from(S0(1,2,n));this.layers=s.map(o=>new uc(`${t}-echo-layer-${o}`,e,.5/o,o,this.output)),this.input=Oe(`${t}-input`,e,null,...this.layers)}dispose(){re(this.input);for(let t of this.layers)t.dispose();re(this.output),be(this.layers)}};function Up(r,t,e){return new pc(r,t,e)}var pc=class{constructor(t,e,n){d(this,"node");this.node=Wn(`${t}-biquad-filter`,e,{type:"bandpass",frequency:2500,Q:4.5},n)}dispose(){re(this.node)}};function zp(r,t,e){return new hc(r,t,e)}var hc=class{constructor(t,e,n){d(this,"node");this.node=Wn(`${t}-biquad-filter`,e,{type:"bandpass",frequency:400,Q:4.5},n)}dispose(){re(this.node)}};var Gp=new Map([["Radio",Up],["Wall",zp],["Echo",Vp]]);var mc=class extends G{constructor(e){super("sourceadded");this.source=e}},Pt=class extends Xn{constructor(e,n,i,...s){super(e,n,i);d(this,"source",null);d(this,"effects",new Array);d(this,"_connected",!1);this.setEffects(...s)}onDisposing(){for(let e of this.effects)Bn(e)&&e.dispose();be(this.effects),super.onDisposing()}setEffects(...e){Ct(this.volumeControl);for(let n of this.effects)Bn(n)&&n.dispose();be(this.effects);for(let n of e)if(x(n)){let i=Gp.get(n);x(i)&&this.effects.push(i(`${n}-${this.id}`,this.audioCtx))}Ap(this.volumeControl,...this.effects,this.spatializer)}get spatialized(){return!(this.spatializer instanceof Ve)}get input(){return this.source}get connected(){return this._connected}connect(){this.connected||xt(this.source,this.volumeControl)}disconnect(){this.connected&&Ct(this.source,this.volumeControl)}set input(e){e!==this.input&&(this.source&&re(this.source),e&&(this.source=e,this.connect(),this.dispatchEvent(new mc(this.source))))}get output(){return this.volumeControl}};var It=class extends G{constructor(e,n){super(e);this.source=n}},xr=class extends It{constructor(t){super("loaded",t)}},_o=class extends It{constructor(e,n){super("errored",e);this.error=n}},br=class extends It{constructor(t){super("played",t)}},Ar=class extends It{constructor(t){super("paused",t)}},yr=class extends It{constructor(t){super("stopped",t)}},wr=class extends It{constructor(e){super("progress",e);d(this,"value",0);d(this,"total",0)}};var Co=new WeakMap,Po=new WeakMap;function jp(r,t){let e=(Po.get(r)||0)+t;Po.set(r,e);let n=r.mediaElement,i=(Co.get(n)||0)+t;return Co.set(n,i),i}function M0(r){jp(r,1)}function R0(r){jp(r,-1),Po.get(r)===0&&(Po.delete(r),re(r)),Co.get(r.mediaElement)===0&&(Co.delete(r.mediaElement),r.mediaElement.isConnected&&r.mediaElement.remove())}var Io=class extends Pt{constructor(e,n,i,s,o,...l){super(e,n,o,...l);this.randomize=s;d(this,"loadEvt");d(this,"playEvt");d(this,"pauseEvt");d(this,"stopEvt");d(this,"progEvt");d(this,"audio");M0(this.input=i),this.audio=i.mediaElement,this.disconnect(),this.loadEvt=new xr(this),this.playEvt=new br(this),this.pauseEvt=new Ar(this),this.stopEvt=new yr(this),this.progEvt=new wr(this);let u=m=>{this.disconnect(),this.audio.currentTime===0||m.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",u),this.audio.addEventListener("pause",u),this.audio.addEventListener("play",()=>{if(this.connect(),this.randomize&&this.audio.loop&&this.audio.duration>1){let m=this.audio.duration*Math.random();this.audio.currentTime=m}this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),po(this.audio).then(m=>this.dispatchEvent(m?this.loadEvt:new _o(this,this.audio.error)))}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}play(){return this.audio.play()}async playThrough(){let e=De(this,"stopped");await this.play(),await e}pause(){this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}onDisposing(){this.disconnect(),R0(this.input),super.onDisposing()}};var Lo=class extends Pt{constructor(t,e,n,...i){super(t,e,n,...i)}};var qn=class extends Kn{constructor(e,n){super(e);d(this,"panner");d(this,"lpx",0);d(this,"lpy",0);d(this,"lpz",0);d(this,"lox",0);d(this,"loy",0);d(this,"loz",0);this.input=this.output=this.panner=Rp(this.id,n,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0})}setAudioProperties(e,n,i){super.setAudioProperties(e,n,i),this.panner.refDistance=this.minDistance,this.panner.distanceModel=i,this.maxDistance<=0?this.panner.rolloffFactor=1/0:this.panner.rolloffFactor=1/this.maxDistance}setPose(e,n){let{p:i,f:s}=e,[o,l,u]=i,[m,f,v]=s;(o!==this.lpx||l!==this.lpy||u!==this.lpz)&&(this.lpx=o,this.lpy=l,this.lpz=u,this.setPosition(o,l,u,n)),(m!==this.lox||f!==this.loy||v!==this.loz)&&(this.lox=m,this.loy=f,this.loz=v,this.setOrientation(m,f,v,n))}};var Do=class extends qn{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,n,i){this.panner.positionX.setValueAtTime(t,i),this.panner.positionY.setValueAtTime(e,i),this.panner.positionZ.setValueAtTime(n,i)}setOrientation(t,e,n,i){this.panner.orientationX.setValueAtTime(-t,i),this.panner.orientationY.setValueAtTime(-e,i),this.panner.orientationZ.setValueAtTime(-n,i)}};var Oo=class extends qn{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,n,i){this.panner.setPosition(t,e,n)}setOrientation(t,e,n,i){this.panner.setOrientation(t,e,n)}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var Wp="juniper::useHeadphones",_0=new G("useheadphonestoggled"),C0="createMediaStreamSource"in AudioContext.prototype,Xp=!C0,Bo=class extends te{constructor(e){super();this.sortedUserIDs=new Array;this.users=new Map;this.clips=new Map;this.clipPaths=new Map;this.pathSources=new Map;this.pathCounts=new Map;this._minDistance=1;this._maxDistance=10;this._offsetRadius=0;this._useHeadphones=!1;this._algorithm="inverse";this.element=null;this.audioDestination=null;this.localUserID=null;this.counter=0;this.audioCtx=new AudioContext;let n=null;tt?(n=ic("final-destination",this.audioCtx),this.element=Zr(io("Audio-Device-Manager"),pr(!0),dr(!0),Xl(n.stream),ct(je("none"))),de(document.body,this)):n=this.audioCtx.destination,this.devices=new Ro(this.element),this.input=Oe("local-mic-user-gain",this.audioCtx,null,this.localAutoControlledGain=Oe("local-mic-auto-gain",this.audioCtx,null,this.localFilter=Wn("local-mic-filter",this.audioCtx,{type:"bandpass",frequency:1500,Q:.25},this.localCompressor=Sp("local-mic-compressor",this.audioCtx,{threshold:-15,knee:40,ratio:17},this.output=ic("local-mic-destination",this.audioCtx))))),this.audioDestination=new To(this.audioCtx,n,qi?new So(this.audioCtx):new Mo(this.audioCtx)),Ve.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm),this.setLocalUserID(e);let i=localStorage.getItem(Wp);x(i)?this._useHeadphones=i==="true":this._useHeadphones=Mt(),this.ready=this.start(),Object.seal(this)}get algorithm(){return this._algorithm}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(Wp,this.useHeadphones.toString()),this.dispatchEvent(_0))}dispose(){for(let e of this.sortedUserIDs)this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);Ct(this.input),Ct(this.localAutoControlledGain),Ct(this.localFilter),Ct(this.localCompressor),Ct(this.output),this.audioDestination.dispose(),this.audioCtx.suspend()}async start(){await yp(this.audioCtx),this.element&&await this.element.play(),await this.devices.ready}get offsetRadius(){return this._offsetRadius}set offsetRadius(e){this._offsetRadius=e,this.updateUserOffsets()}get filter(){return this.localFilter}get filterFrequency(){return this.localFilter.frequency.value}set filterFrequency(e){this.localFilter.frequency.value=e}get compressor(){return this.localCompressor}get isReady(){return this.audioCtx.state==="running"}get currentTime(){return this.audioCtx.currentTime}update(){let e=this.currentTime;this.audioDestination.audioTick(e);for(let n of this.clips.values())n.audioTick(e);for(let n of this.users.values())n.audioTick(e)}newSpatializer(e,n,i){if(n){let s=i?this.audioDestination.remoteUserInput:this.audioDestination.spatializedInput,o=`spatializer-${++this.counter}-${e}`,l=qi?new Do(o+"-new-wa",this.audioCtx):new Oo(e+"-old-wa",this.audioCtx);return xt(l,s),l}else return Ve.instance(this.audioCtx)}createSpatializer(e,n,i){let s=this.newSpatializer(e,n,i);return s.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),s}createUser(e,n){if(!this.users.has(e)){let i=jr(n,e),s=this.createSpatializer(i,!0,!0),o=new Lo(i,this.audioCtx,s);this.users.set(e,o),Di(this.sortedUserIDs,e),this.updateUserOffsets()}return this.users.get(e)}setLocalUserID(e){return this.audioDestination&&(Ge(this.sortedUserIDs,this.localUserID),this.localUserID=e,Di(this.sortedUserIDs,this.localUserID),this.updateUserOffsets()),this.audioDestination}loadBasicClip(e,n,i,s){return this.loadClip(e,n,!1,!1,!1,!1,i,[],s)}createBasicClip(e,n,i){return this.createClip(e,n,!1,!1,!1,i,[])}async loadClip(e,n,i,s,o,l,u,m,f){if(F(n)||oe(n)&&n.length===0)throw new Error("No clip source path provided");x(f)&&f.start(n);let v=await this.getSourceTask(e,n,n,i,s,f),A=this.makeClip(v,e,n,o,l,s,u,...m);return this.clips.set(e,A),x(f)&&f.end(n),A}createClip(e,n,i,s,o,l,u){if(F(n)||oe(n)&&n.length===0)throw new Error("No clip source path provided");let m=n.currentSrc,f=this.createSourceFromElement(e,n),v=this.makeClip(f,e,m,s,o,i,l,...u);return this.clips.set(e,v),v}getSourceTask(e,n,i,s,o,l){this.clipPaths.set(e,n);let u=this.pathSources.get(n);return x(u)?this.pathCounts.set(n,this.pathCounts.get(n)+1):(u=this.createSourceFromFile(e,i,s,o,l),this.pathSources.set(n,u),this.pathCounts.set(n,1)),u}async createSourceFromFile(e,n,i,s,o){x(o)&&o.start(e);let l=ec(s,!1,i,Wi(n));if(!await po(l))throw l.error;return x(o)&&o.end(e),this.createSourceFromElement(e,l)}createSourceFromStream(e,n){let i=ec(!0,!Xp,!1,Xl(n));return Xp?this.createSourceFromElement(e,i):Mp(jr("media-stream-source",e,n.id),this.audioCtx,n)}createSourceFromElement(e,n){return en(jr("media-element-source",e),this.audioCtx,n)}makeClip(e,n,i,s,o,l,u,...m){let f=jr(n,i),v=this.createSpatializer(f,s,!1),A=new Io(jr("audio-clip-element",f),this.audioCtx,e,o,v,...m);return l&&A.play(),A.volume=u,A}hasClip(e){return this.clips.has(e)}async playClip(e){this.isReady&&this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.isReady&&this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.isReady&&this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,n){let i=e.get(n);return x(i)&&(e.delete(n),i.dispose()),i}removeUser(e){let n=this.removeSource(this.users,e);x(n.input)&&(n.input=null),Ge(this.sortedUserIDs,e),this.updateUserOffsets()}removeClip(e){let n=this.clipPaths.get(e);return this.pathCounts.set(n,this.pathCounts.get(n)-1),this.pathCounts.get(n)===0&&(this.pathCounts.delete(n),this.pathSources.delete(n)),this.removeSource(this.clips,e)}setUserStream(e,n,i){if(this.users.has(e)){let s=this.users.get(e);i?s.input=this.createSourceFromStream(jr(n,e),i):x(s.input)&&(s.input=null)}}updateUserOffsets(){if(this.offsetRadius>0){let e=this.sortedUserIDs.indexOf(this.localUserID),n=2*Math.PI/this.sortedUserIDs.length,i=(e+1)*n,s=this.offsetRadius*Math.sin(i),o=this.offsetRadius*(Math.cos(i)-1);for(let l=0;l<this.sortedUserIDs.length;++l){let u=this.sortedUserIDs[l],m=(l+1)*n,f=this.offsetRadius*Math.sin(m)-s,v=this.offsetRadius*(Math.cos(m)-1)-o;this.setUserOffset(u,f,0,v)}}}setAudioProperties(e,n,i){this._minDistance=e,this._maxDistance=n,this._algorithm=i,Ve.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let s of this.users.values())s.spatializer.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let s of this.clips.values())s.spatializer.setAudioProperties(s.spatializer.minDistance,s.spatializer.maxDistance,this.algorithm)}withPose(e,n,i){let s=e.get(n),o=null;return s?o=s.pose:n===this.localUserID&&(o=this.audioDestination.pose),o?i(o):null}withUser(e,n){return this.withPose(this.users,e,n)}setUserOffset(e,n,i,s){this.withUser(e,o=>{o.setOffset(n,i,s)})}getUserOffset(e){return this.withUser(e,n=>n.o)}setUserPose(e,n,i,s,o,l,u,m,f,v){this.withUser(e,A=>{A.set(n,i,s,o,l,u,m,f,v)})}withClip(e,n){return this.withPose(this.clips,e,n)}setClipPosition(e,n,i,s){this.withClip(e,o=>{o.setPosition(n,i,s)})}setClipOrientation(e,n,i,s,o,l,u){this.withClip(e,m=>{m.setOrientation(n,i,s,o,l,u)})}setClipPose(e,n,i,s,o,l,u,m,f,v){this.withClip(e,A=>{A.set(n,i,s,o,l,u,m,f,v)})}};var fc=class extends It{constructor(t,e){super(t,e)}},$n=class extends fc{constructor(t){super("loading",t)}};var Fo=class extends Pt{constructor(e){super("JuniperAudioPlayer",e,Ve.instance(e));this._data=null;this._loaded=!1;this.sourcesByURL=new Map;this.sources=new Array;this.potatoes=new Array;this.element=Zr(pr(!0),dr(!1),Hn(!1),Wr(!0)),this.input=en("JuniperAudioPlayer-Input",e,this.element),this.loadingEvt=new $n(this),this.loadEvt=new xr(this),this.playEvt=new br(this),this.pauseEvt=new Ar(this),this.stopEvt=new yr(this),this.progEvt=new wr(this),this.onPlay=async()=>{this.connect(),this.dispatchEvent(this.playEvt)},this.onPause=n=>{this.disconnect(),this.element.currentTime===0||n.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.element.currentTime,this.progEvt.total=this.element.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.element.addEventListener("play",this.onPlay),this.element.addEventListener("pause",this.onPause),this.element.addEventListener("ended",this.onPause),this.element.addEventListener("error",this.onError),this.element.addEventListener("waiting",this.onWaiting),this.element.addEventListener("canplay",this.onCanPlay),this.element.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.element.title}setTitle(e){this.element.title=e}get hasAudio(){let e=this.sourcesByURL.get(this.element.src);return x(e)&&e.acodec!=="none"||x(this.element.audioTracks)&&this.element.audioTracks.length>0||x(this.element.webkitAudioDecodedByteCount)&&this.element.webkitAudioDecodedByteCount>0||x(this.element.mozHasAudio)&&this.element.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),re(this.input),re(this.audioSource),this.element.removeEventListener("play",this.onPlay),this.element.removeEventListener("pause",this.onPause),this.element.removeEventListener("ended",this.onPause),this.element.removeEventListener("error",this.onError),this.element.removeEventListener("waiting",this.onWaiting),this.element.removeEventListener("canplay",this.onCanPlay),this.element.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop(),this.sourcesByURL.clear(),be(this.sources),be(this.potatoes),this.element.src="",this._data=null,this._loaded=!1}async load(e,n){this.clear(),this._data=e,oe(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),zr(e.audios,i=>-i.resolution),rd(this.sources,...e.audios));for(let i of this.sources)this.sourcesByURL.set(i.url,i);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(n),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let n={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(n)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:n}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(x(e)&&e.start(),this.element.removeEventListener("error",this.onError);this.hasSources;){let n=null,i=this.sources.shift();if(x(i)){let s=await this.getMediaCapabilities(i);if(!s.smooth||!s.powerEfficient){this.potatoes.push(i.url);continue}else n=i.url}else n=this.potatoes.shift();if(this.element.src=n,this.element.load(),await ho(this.element)){x(i)?this.sources.unshift(i):this.potatoes.unshift(n),this.element.addEventListener("error",this.onError),x(e)&&e.end();return}}}get playbackState(){return F(this.data)?"empty":this.loaded?this.element.error?"errored":this.element.ended||this.element.paused&&this.element.currentTime===0?"stopped":this.element.paused?"paused":"playing":"loading"}play(){return this.element.play()}async playThrough(){let e=De(this,"stopped");await this.play(),await e}pause(){this.element.pause()}stop(){this.pause(),this.element.currentTime=0}restart(){return this.stop(),this.play()}};var Qp="local-user";async function P0(r,t,e,n,i){let{content:s}=await r.get(n).progress(i.pop()).image();return[t,e,s]}var Ho=class{constructor(t,e,n){this.fetcher=t;this.imagePaths=e;this.padding=n;d(this,"uvDescrips",new gt);d(this,"geoms",new gt);d(this,"readyTask");d(this,"canvas",null);d(this,"texture",null);d(this,"enabledMaterial",null);d(this,"disabledMaterial",null);this.readyTask=new ot}async load(t){let e=eo(t),n=new gt(await Promise.all(Array.from(this.imagePaths.entries()).map(([N,L,k])=>P0(this.fetcher,N,L,k,e)))),i=Array.from(n.values()),s=Math.max(...i.map(N=>N.width)),o=Math.max(...i.map(N=>N.height)),l=s*o*i.length,u=Math.sqrt(l),m=Math.floor(u/s),f=Math.ceil(i.length/m),v=m*s,A=f*o,T=Ol(v),C=Ol(A),I=v/T,P=A/C,B=s/T,H=o/C;this.canvas=Eo(T,C);let D=this.canvas.getContext("2d");D.fillStyle="#1e4388",D.fillRect(0,0,T,C);let V=0;for(let[N,L,k]of n.entries()){let Z=V%m,ie=(V-Z)/m,X=I*(Z*s/v),se=P*(1-ie/f)-H,xe=Z*s,me=ie*o+C-A,J=s-2*this.padding,ze=o-2*this.padding;D.drawImage(k,0,0,k.width,k.height,xe+this.padding,me+this.padding,J,ze),this.uvDescrips.add(N,L,{u:X,v:se,du:B,dv:H}),++V}this.texture=new THREE.CanvasTexture(this.canvas),this.enabledMaterial=new THREE.MeshBasicMaterial({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new THREE.MeshBasicMaterial({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0,this.readyTask.resolve()}getSets(){return Array.from(this.imagePaths.keys())}getIcons(t){if(!this.imagePaths.has(t))throw new Vt(`Button set ${t} does not exist`);return Array.from(this.imagePaths.get(t).keys())}async getMaterial(t){return await this.readyTask,t?this.enabledMaterial:this.disabledMaterial}async getGeometry(t,e){await this.readyTask;let n=this.uvDescrips.get(t),i=n&&n.get(e);if(!n||!i)throw new Vt(`Button ${t}/${e} does not exist`,this.uvDescrips);let s=this.geoms.get(t,e);if(!s){s=new THREE.PlaneBufferGeometry(1,1,1,1),s.name=`Geometry:${t}/${e}`,this.geoms.add(t,e,s);let o=s.getAttribute("uv");for(let l=0;l<o.count;++l){let u=o.getX(l)*i.du+i.u,m=o.getY(l)*i.dv+i.v;o.setX(l,u),o.setY(l,m)}}return s}async getMesh(t,e,n){let i=await this.getGeometry(t,e),s=new THREE.Mesh(i,n?this.enabledMaterial:this.disabledMaterial);return s.name=`Mesh:${t}/${e}`,s}async getGeometryAndMaterials(t,e){let[n,i,s]=await Promise.all([this.getGeometry(t,e),this.getMaterial(!0),this.getMaterial(!1)]);return{geometry:n,enabledMaterial:i,disabledMaterial:s}}getImageSrc(t,e){let n=this.imagePaths.get(t),i=n&&n.get(e);if(!n||!i)throw new Vt(`Button ${t}/${e} does not exist`,this.uvDescrips);return i}getImageElement(t,e){return Yi(kn(t+" "+e),Wi(this.getImageSrc(t,e)))}};var ko=class{constructor(){this.animations=new Array}update(t){t=.001*t;for(let e of this.animations)e(t)}clear(){be(this.animations)}start(t,e,n){let i=-t;n(0);let s=new ot;return this.animations.push(o=>{i+=o/e,i>=1?(n(1),s.resolve()):i>=0&&n(i)}),s}};function Kp(r,t){var e=r*Math.PI;return .5*(1-Math.cos(e))-t*Math.sin(2*e)}function Yp(r,t){var e=(r-.5)*Math.PI;return r*r+t*Math.cos(e)}_t(q(".dialog, .dialog-container",Vn("fixed")),q(".dialog",Yr(0),Qr(0),Et("100%"),jt("100%"),Qi("rgba(0, 0, 0, 0.5)"),Ud(100)),q(".dialog-container",Yr("50%"),Qr("50%"),Ki("100%"),Bd("100%"),Vd("translateX(-50%) translateY(-50%)"),Qi("white"),Cd("rgba(0,0,0,0.5) 0px 5px 30px"),je("grid"),hr("2em auto 2em"),co("auto 1fr auto 2em")),q(".dialog .title-bar",oo(1,1,2,-1),fr("0.25em")),q(".dialog-content",oo(2,2,-4,-2),Hd("auto")),q(".dialog-controls",oo(-2,2,-3,-2)),q(".dialog .confirm-button",Ld("right")),q(".dialog h1, .dialog h2, .dialog h3, .dialog h4, .dialog h5, .dialog h6",Kr("left")),q(".dialog select",Ki("10em")));var Zn=class{constructor(t){this.subEventer=new te;this.element=ve(Ae("dialog"),wd("dialogname",t),ct(je("none")),this.container=ve(Ae("dialog-container"),this.titleElement=qd(Ae("title-bar"),t),this.contentArea=ve(Ae("dialog-content")),ve(Ae("dialog-controls"),this.confirmButton=zn("Confirm",Fn("confirm-button")),this.cancelButton=mo("Cancel",Fn("cancel-button"))))),this.confirmButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new G("confirm"))),this.cancelButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new G("cancel"))),de(document.body,this)}get title(){return this._title}set title(t){Un(this.titleElement,this._title=t)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(t){_e(this,t)}get isOpen(){return Rt(this)}async showDialog(){await this.onShowing(),this.show(!0),this.onShown();let t=De(this.subEventer,"confirm","cancel"),e=await Pl(t);return e?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),e}};function No(r){return x(r)&&r.isMesh}function I0(r){return x(r)&&r.isMaterial}function qp(r){return I0(r)&&r.type==="MeshBasicMaterial"}function Zi(r){return x(r)&&r.isObject3D}function $p(r){return x(r)&&r.isQuaternion}function Zp(r){return x(r)&&r.isEuler}function Jp(r){return x(r)&&Zi(r.object)}function bt(r){return Jp(r)?r.object:r}function Ie(r,t){return r=bt(r),r.visible=t,t}function Jn(r){return r=bt(r),r.visible}function eh(r){for(r=bt(r);r;){if(!r.visible)return!1;r=r.parent}return!0}function we(r,...t){let e=t.filter(x).map(bt);return e.length>0&&bt(r).add(...e),r}function At(r,...t){let e=new THREE.Object3D;return e.name=r,we(e,...t),e}function Vo(r,t){r=bt(r),uo(r)&&(r.disabled=!t)}var Uo=Gt("Juniper:ScaledItems",()=>new Map),th=1,L0=1.1,D0=.005,gc=class{constructor(t){this.obj=t;d(this,"base");d(this,"onEnter");d(this,"onExit");d(this,"p");d(this,"dir");d(this,"running");d(this,"wasDisabled");this.base=t.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.onEnter=()=>this.run(1),this.onExit=()=>this.run(-1),this.obj.addEventListener("enter",this.onEnter),this.obj.addEventListener("exit",this.onExit)}get enabled(){return!this.obj.disabled}get disabled(){return!this.enabled}run(t){(this.enabled||t===-1||this.p>0)&&(this.dir=t,this.running=!0)}updateScaling(t){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.onExit()),this.running){this.p+=this.dir*t,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let e=Kp(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(e*(L0-th)+th)}}dispose(){this.obj.removeEventListener("enter",this.onEnter),this.obj.removeEventListener("exit",this.onExit)}};function rh(r){r*=D0;for(let t of Uo.values())t.updateScaling(r)}function nh(r){let t=Uo.get(r);t&&(Uo.delete(r),t.dispose())}function zo(r){Uo.set(r,new gc(r))}THREE.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new THREE.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};THREE.ShaderLib.line={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var Xt=class extends THREE.ShaderMaterial{constructor(t){super({type:"LineMaterial",uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.line.uniforms),vertexShader:THREE.ShaderLib.line.vertexShader,fragmentShader:THREE.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};Xt.prototype.isLineMaterial=!0;var vc=new Map;function O0(r,t){t in r&&delete r[t]}function ei(r,t,e){let n=`${r}_${Object.keys(e).map(i=>`${i}:${e[i]}`).join(",")}`;return vc.has(n)||(O0(e,"name"),vc.set(n,new t(e))),vc.get(n)}function B0(r){return Object.assign(r,{transparent:!0})}function yt(r){return ei("solid",THREE.MeshBasicMaterial,r)}function tn(r){return ei("solidTransparent",THREE.MeshBasicMaterial,B0(r))}function Qt(r){return ei("lit",THREE.MeshStandardMaterial,r)}function Kt(r){return ei("line",THREE.LineBasicMaterial,r)}function ih(r){return ei("line2",Xt,r)}function Yt(r){return ei("sprite",THREE.SpriteMaterial,r)}var Ji=0,Go=255,jo=65280,Wo=65535,Xo=16711680,Qo=16711935,Ko=16776960,Yo=12632256,ti=16777215,US=yt({color:Ji}),zS=yt({color:Go}),GS=yt({color:jo}),jS=yt({color:Wo}),WS=yt({color:Xo}),XS=yt({color:Qo}),QS=yt({color:Ko}),KS=yt({color:Yo}),YS=yt({color:ti});function es(r){return tn({color:Ji,opacity:r})}var qS=Qt({color:Ji}),$S=Qt({color:Go}),ZS=Qt({color:jo}),JS=Qt({color:Wo}),eM=Qt({color:Xo}),tM=Qt({color:Qo}),rM=Qt({color:Ko}),sh=Qt({color:Yo}),oh=Qt({color:ti});var nM=Kt({color:Ji}),iM=Kt({color:Go}),sM=Kt({color:jo}),oM=Kt({color:Wo}),aM=Kt({color:Xo}),lM=Kt({color:Qo}),cM=Kt({color:Ko}),uM=Kt({color:Yo}),dM=Kt({color:ti});var pM=Yt({color:Ji}),hM=Yt({color:Go}),mM=Yt({color:jo}),fM=Yt({color:Wo}),gM=Yt({color:Xo}),vM=Yt({color:Qo}),EM=Yt({color:Ko}),xM=Yt({color:Yo}),bM=Yt({color:ti});var $o=new THREE.PlaneBufferGeometry(1,1,1,1);$o.name="PlaneGeom";var Ec=class extends THREE.Mesh{constructor(e,n,i,s){super($o,i);this.isCollider=s;this.scale.set(e,n,1)}};var qo=class extends Ec{constructor(t,e){super(t,e,es(0),!0),this.visible=!1}};function Tr(r){let t=new Array,e=new Set;for(t.push(r);t.length>0;){let n=t.shift();n&&!e.has(n)&&(e.add(n),n.isMesh&&t.push(n.material,n.geometry),n.isMaterial&&t.push(...Object.values(n)),n.isObject3D&&(t.push(...n.children),n.clear(),nh(n)),lt(n)&&t.push(...n),yd(n))}e.clear()}var F0=new THREE.Matrix4,Zo=new THREE.Vector3;function xc(r,t,e,n,i){F0.copy(r.matrixWorld).invert().multiply(t.matrixWorld).decompose(Zo,n,i),e.set(Zo.x,Zo.y,Zo.z,1)}var ah=39.3701,ri=class extends THREE.Mesh{constructor(e,n){super(e,n);d(this,"_imageWidth",0);d(this,"_imageHeight",0)}copy(e,n=!0){return super.copy(e,n),this._imageWidth=e.imageWidth,this._imageHeight=e.imageHeight,this}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.x=e,this.scale.y=e/this.imageAspectRatio}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.x=this.imageAspectRatio*e,this.scale.y=e}get pixelDensity(){return this.imageWidth/this.objectWidth/ah}set pixelDensity(e){let n=e*ah;this.objectWidth=this.imageWidth/n}setImage(e){return ap(e)&&(e=lp(e)),op(e)&&(e=e),e instanceof HTMLVideoElement?(this.material.map=new THREE.VideoTexture(e),this._imageWidth=e.videoWidth,this._imageHeight=e.videoHeight):(this.material.map=new THREE.Texture(e),this._imageWidth=e.width,this._imageHeight=e.height,this.material.map.needsUpdate=!0),this.material.needsUpdate=!0,this.material.map}async loadImage(e,n,i){let{content:s}=await e.get(n).progress(i).image(),o=this.setImage(s);o.name=n}updateTexture(){let e=this.material.map.image;ce(e.width)&&ce(e.height)&&(this.imageWidth!==e.width||this.imageHeight!==e.height)&&(this._imageWidth=e.width,this._imageHeight=e.height,this.material.map.dispose(),this.material.map=new THREE.Texture(e),this.material.needsUpdate=!0),this.material.map.needsUpdate=!0}};var Jo=new THREE.Vector4,ea=new THREE.Quaternion,ni=new THREE.Vector3,H0=0,Lt=class extends THREE.Object3D{constructor(e,n,i,s=null){super();this.isStatic=i;d(this,"lastMatrixWorld",new THREE.Matrix4);d(this,"layer",null);d(this,"tryWebXRLayers",!0);d(this,"wasUsingLayer",!1);d(this,"lastImage",null);d(this,"lastWidth",null);d(this,"lastHeight",null);d(this,"stereoLayoutName","mono");d(this,"env",null);d(this,"mesh",null);d(this,"webXRLayersEnabled",!0);if(e){this.setEnvAndName(e,n);let o=qp(s)?s:tn(Object.assign({},s,{name:this.name}));this.mesh=new ri($o,o),this.add(this.mesh)}}dispose(){Tr(this.layer)}setEnvAndName(e,n){this.env=e,this.name=n,this.tryWebXRLayers&&(this.tryWebXRLayers=this.env&&this.env.hasXRCompositionLayers)}copy(e,n=!0){super.copy(e,n),this.setEnvAndName(e.env,e.name+ ++H0);for(let i=this.children.length-1;i>=0;--i){let s=this.children[i];s.parent instanceof Lt&&s instanceof ri&&(s.removeFromParent(),this.mesh=new ri(s.geometry,s.material))}return F(this.mesh)&&(this.mesh=e.mesh.clone(),this.add(this.mesh)),this}get needsLayer(){if(!eh(this)||F(this.mesh.material.map)||F(this.mesh.material.map.image))return!1;let e=this.mesh.material.map.image;return e instanceof HTMLVideoElement?!e.paused||e.currentTime>0:!0}removeWebXRLayer(){if(x(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer);let e=this.layer;this.layer=null,setTimeout(()=>{e.destroy(),this.mesh.visible=!0},100)}}update(e,n){if(this.mesh.material.map&&this.mesh.material.map.image){let i=this.mesh.material.map instanceof THREE.VideoTexture,o=this.tryWebXRLayers&&this.webXRLayersEnabled&&x(n)&&(i&&x(this.env.xrMediaBinding)||!i&&x(this.env.xrBinding))&&this.needsLayer,l=o!==this.wasUsingLayer,u=this.mesh.material.map.image!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate,m=this.mesh.imageWidth!==this.lastWidth||this.mesh.imageHeight!==this.lastHeight;if(this.wasUsingLayer=o,this.lastImage=this.mesh.material.map.image,this.lastWidth=this.mesh.imageWidth,this.lastHeight=this.mesh.imageHeight,(l||m)&&((!o||m)&&this.layer&&this.removeWebXRLayer(),o)){let f=this.env.referenceSpace;xc(this.env.stage,this.mesh,Jo,ea,ni),this.lastMatrixWorld.copy(this.matrixWorld);let v=new XRRigidTransform(Jo,ea),A=ni.x/2,T=ni.y/2,C=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(i){let I=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.mesh.material.map.image,{space:f,layout:C,invertStereo:I,transform:v,width:A,height:T})}else this.layer=this.env.xrBinding.createQuadLayer({space:f,layout:C,textureType:"texture",isStatic:this.isStatic,viewPixelWidth:this.mesh.imageWidth,viewPixelHeight:this.mesh.imageHeight,transform:v,width:A,height:T});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(u||this.layer.needsRedraw){let f=this.env.gl,v=this.env.xrBinding.getSubImage(this.layer,n);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0),f.bindTexture(f.TEXTURE_2D,v.colorTexture),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.mesh.material.map.image),f.generateMipmap(f.TEXTURE_2D),f.bindTexture(f.TEXTURE_2D,null)}_l(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(xc(this.env.stage,this.mesh,Jo,ea,ni),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.transform=new XRRigidTransform(Jo,ea),this.layer.width=ni.x/2,this.layer.height=ni.y/2)}}}};var k0={type:"redrawn"},ta=class extends Lt{constructor(e,n,i){super(e,n,!1,i);d(this,"_textImage",null);d(this,"_onRedrawn");this._onRedrawn=this.onRedrawn.bind(this)}onRedrawn(){this.mesh.updateTexture(),this.scale.set(this._textImage.width,this._textImage.height,.01),this.dispatchEvent(k0)}get textImage(){return this._textImage}set textImage(e){e!==this.textImage&&(this.textImage&&this.textImage.clearEventListeners(),this._textImage=e,this.textImage&&(this.textImage.addEventListener("redrawn",this._onRedrawn),this.mesh.setImage(this.textImage.canvas),this._onRedrawn()))}createTextImage(e){this.textImage=new vr(e)}get wrapWords(){return this._textImage.wrapWords}set wrapWords(e){this._textImage.wrapWords=e}get minWidth(){return this._textImage.minWidth}set minWidth(e){this._textImage.minWidth=e}get maxWidth(){return this._textImage.maxWidth}set maxWidth(e){this._textImage.maxWidth=e}get minHeight(){return this._textImage.minHeight}set minHeight(e){this._textImage.minHeight=e}get maxHeight(){return this._textImage.maxHeight}set maxHeight(e){this._textImage.maxHeight=e}get textDirection(){return this._textImage.textDirection}set textDirection(e){this._textImage.textDirection=e}get textScale(){return this._textImage.scale}set textScale(e){this._textImage.scale=e}get textWidth(){return this._textImage.width}get textHeight(){return this._textImage.height}get textPadding(){return this._textImage.padding}set textPadding(e){this._textImage.padding=e}get fontStyle(){return this._textImage.fontStyle}set fontStyle(e){this._textImage.fontStyle=e}get fontVariant(){return this._textImage.fontVariant}set fontVariant(e){this._textImage.fontVariant=e}get fontWeight(){return this._textImage.fontWeight}set fontWeight(e){this._textImage.fontWeight=e}get fontSize(){return this._textImage.fontSize}set fontSize(e){this._textImage.fontSize=e}get fontFamily(){return this._textImage.fontFamily}set fontFamily(e){this._textImage.fontFamily=e}get textFillColor(){return this._textImage.textFillColor}set textFillColor(e){this._textImage.textFillColor=e}get textStrokeColor(){return this._textImage.textStrokeColor}set textStrokeColor(e){this._textImage.textStrokeColor=e}get textStrokeSize(){return this._textImage.textStrokeSize}set textStrokeSize(e){this._textImage.textStrokeSize=e}get textBgColor(){return this._textImage.bgFillColor}set textBgColor(e){this._textImage.bgFillColor=e}get value(){return this._textImage.value}set value(e){this._textImage.value=e}};var ii=class extends THREE.Object3D{constructor(e,n,i,s,o){super();this.fetcher=e;this.env=n;d(this,"_disabled",!1);d(this,"image");d(this,"enabledImage");d(this,"disabledImage");if(x(s)){this.name=i,o=Object.assign({textFillColor:"#ffffff",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},o,{value:s}),this.image=new vr(o);let l=vt(16);this.enabledImage=this.createImage(`${l}-enabled`,1),this.disabledImage=this.createImage(`${l}-disabled`,.5),this.disabledImage.visible=!1,this.add(this.enabledImage,this.disabledImage)}}createImage(e,n){let i=new ta(this.env,`text-${e}`,{side:THREE.FrontSide,opacity:n});return i.textImage=this.image,i}get disabled(){return this._disabled}set disabled(e){e!==this.disabled&&(this._disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e)}};var ts=class extends ii{constructor(e,n,i,s,o){super(e,n,i,s,o);d(this,"collider",null);d(this,"isClickable",!0);x(s)&&(this.image.addEventListener("redrawn",()=>{this.collider.scale.x=this.image.width,this.collider.scale.y=this.image.height}),this.collider=new qo(this.image.width,this.image.height),this.collider.name=`collider-${this.name}`,this.add(this.collider),zo(this))}};var lh={bgStrokeColor:"#000000",bgStrokeSize:.04,wrapWords:!1,textFillColor:"#ffffff",scale:150},ch=Object.assign({},lh,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),N0=Object.assign({},ch,{bgFillColor:"#0078d7"}),V0=Object.assign({},ch,{bgFillColor:"#780000"}),U0=Object.assign({},lh,{bgFillColor:"#ffffff",textFillColor:"#000000",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),z0=.9;function bc(r,t){return Object.assign({},r,{fontFamily:t})}var ra=class extends Zn{constructor(e,n){super("Confirm action");this.env=e;d(this,"object",new THREE.Object3D);d(this,"name","ConfirmationDialog");d(this,"root",new THREE.Object3D);d(this,"mesh");d(this,"confirmButton3D");d(this,"cancelButton3D");d(this,"animator",new ko);this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new ii(this.env.fetcher,this.env,"confirmationDialogLabel","",bc(U0,n)),this.confirmButton3D=new ts(this.env.fetcher,this.env,"confirmationDialogConfirmButton","Yes",bc(N0,n)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.position.set(1,-.5,.5),this.cancelButton3D=new ts(this.env.fetcher,this.env,"confirmationDialogCancelButton","No",bc(V0,n)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.position.set(2,-.5,.5),de(this.container,ct(Ki("calc(100% - 2em)"),Et("max-content"))),de(this.contentArea,ct(so("18pt"),Kr("center"),fr("1em"))),we(this,we(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),Ie(this.root,!1)}get visible(){return Rt(this)}set visible(e){_e(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,n){await this.animator.start(0,.25,i=>{let s=Yp(e+n*i,z0);this.root.scale.set(s,s,.01)}),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,n){return this.title=e,Un(this.contentArea,n),this.mesh.image.value=n,this.showDialog()}};function Ac(r){for(;r!=null;){if(!r.visible)return!1;r=r.parent}return!0}function rn(r){return Zi(r)&&Le(r.isCollider)&&x(r.parent)}function rs(r){return x(r)&&rn(r.object)}function hh(r){return x(r)&&rn(r.object)&&(qt(r.object)&&Ac(r.object)||qt(r.object.parent)&&Ac(r.object.parent))}function qt(r){return Zi(r)&&(Le(r.disabled)||Le(r.isDraggable)||Le(r.isClickable))}function uh(r){return qt(r)&&r.isClickable&&!r.disabled}function nn(r){return rs(r)&&rn(r.object)&&(uh(r.object)||uh(r.object.parent))}function dh(r){return qt(r)&&r.isDraggable&&!r.disabled}function sn(r){return rs(r)&&rn(r.object)&&(dh(r.object)||dh(r.object.parent))}function ph(r){return qt(r)&&r.disabled}function mh(r){return rs(r)&&rn(r.object)&&(ph(r.object)||ph(r.object.parent))}function fh(r,t){return r==="click"&&t&&(r="error"),`InteractionAudio-${r}`}var na=class{constructor(t,e){d(this,"audio");d(this,"eventSys");d(this,"enabled");this.audio=t,this.eventSys=e,this.enabled=!0;let n=i=>{let s=i.object;if(this.enabled&&qt(s)&&s.isClickable){let o=fh(i.type,s.disabled);if(this.audio.hasClip(o)){let{x:l,y:u,z:m}=i.point;this.audio.setClipPosition(o,l,u,m),this.audio.playClip(o)}}};this.eventSys.addEventListener("enter",n),this.eventSys.addEventListener("exit",n),this.eventSys.addEventListener("click",n)}async load(t,e,n,i){return await this.audio.loadClip(fh(t,!1),e,!1,!1,!0,!1,n,[],i)}};var ns=(i=>(i.None="None",i.Fullscreen="Fullscreen",i.VR="VR",i.AR="AR",i))(ns||{});_t(q("#controls",Vn("absolute"),Qr(0),Yr(0),Et("100%"),jt("100%")),q("#controls",je("grid"),so("20pt"),co("auto 1fr auto")),q("#controls, #controls *",ql("none")),q("#controls canvas",jt("58px")),q("#controls > .row",je("grid"),mr("10px 5px"),hr("repeat(2, auto)")),q("#controls > .row.top",lo(1)),q("#controls > .row.middle",lo(2,-2)),q("#controls > .row.bottom",lo(-2)),q("#controls > .row > .cell",je("flex")),q("#controls > .row > .cell.left",Xr(1)),q("#controls > .row > .cell.right",Xr(-2),Id("row-reverse")),q("#controls > .row > .cell > .btn",_d(0),Qi("#1e4388"),jt("58px !important"),Et("58px"),fr("0.25em"),mr("0 5px"),ql("initial")),q("#controls .btn-primary img",jt("calc(100% - 0.5em)")));var ia=class{constructor(){d(this,"element");d(this,"topRowLeft");d(this,"topRowRight");d(this,"middleRowLeft");d(this,"middleRowRight");d(this,"bottomRowLeft");d(this,"bottomRowRight");d(this,"cells");this.element=ve(io("controls"),ve(Ae("row top"),this.topRowLeft=ve(Ae("cell left")),this.topRowRight=ve(Ae("cell right"))),ve(Ae("row middle"),this.middleRowLeft=ve(Ae("cell left")),this.middleRowRight=ve(Ae("cell right"))),ve(Ae("row bottom"),this.bottomRowLeft=ve(Ae("cell left")),this.bottomRowRight=ve(Ae("cell right")))),this.cells=[[this.topRowLeft,this.topRowRight],[this.middleRowLeft,this.middleRowRight],[this.bottomRowLeft,this.bottomRowRight]]}};var yc=1.25,gh=Qe(30),G0=Qe(32),j0=new THREE.Vector3(0,0,0),sa=class extends THREE.Object3D{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(t,e){t=bt(t),we(this,t),this.add(t),t.position.set(yc*Math.sin(e.x*gh),yc*Math.sin(e.y*G0),-yc*Math.cos(e.x*gh)),t.scale.set(e.scale,e.scale,1);for(let n of this.children)n.lookAt(j0)}};var W0=md("video");var vh=W0("vnd.mpeg.dash.mpd","mpd");function Eh(r){return oe(r.vcodec)}var oa=class extends Pt{constructor(e){super("JuniperVideoPlayer",e,Ve.instance(e));this.onTimeUpdate=null;this.wasUsingAudioElement=!1;this._data=null;this._loaded=!1;this.onError=new Map;this.sourcesByURL=new Map;this.sources=new In;this.potatoes=new In;this.video=this.createMediaElement(ep,Wr(!0)),this.audio=this.createMediaElement(Zr,Wr(!1)),this.input=Oe("JuniperVideoPlayer-combiner",e),this.videoSource=en("JuniperVideoPlayer-VideoNode",e,this.video,this.input),this.audioSource=en("JuniperVideoPlayer-AudioNode",e,this.audio,this.input),this.loadingEvt=new $n(this),this.loadEvt=new xr(this),this.playEvt=new br(this),this.pauseEvt=new Ar(this),this.stopEvt=new yr(this),this.progEvt=new wr(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.connect(),this.onSeeked(),this.useAudioElement&&await this.audio.play(),this.dispatchEvent(this.playEvt)},this.onPause=i=>{this.disconnect(),this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||i.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let n=!1;this.onWaiting=()=>{this.useAudioElement&&(n=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&n&&(await this.audio.play(),n=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let s=this.onError.get(this.video);x(s)&&await s()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let s=this.video.currentTime-this.audio.currentTime;Math.abs(s)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}elementHasAudio(e){let n=this.sourcesByURL.get(e.src);return x(n)&&n.acodec!=="none"||x(e.audioTracks)&&e.audioTracks.length>0||x(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||x(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){super.onDisposing(),this.clear(),re(this.input),re(this.videoSource),re(this.audioSource),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop();for(let[e,n]of this.onError)e.removeEventListener("error",n);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,n){if(this.clear(),this._data=e,oe(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await to(n,i=>this.loadMediaElement(this.audio,i),i=>this.loadMediaElement(this.video,i)),!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,n){zr(n,i=>-i.resolution);for(let i of n)vh.matches(i.contentType)||(this.sources.add(e,i),this.sourcesByURL.set(i.url,i))}createMediaElement(e,...n){return e(pr(!0),dr(!1),Hn(!1),...n)}async getMediaCapabilities(e){let n={type:"file"};Eh(e)?n.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(n.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(n)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:n}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,n){for(x(n)&&n.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let i=null,s=this.sources.get(e).shift();if(x(s)){let o=await this.getMediaCapabilities(s);if(!o.smooth||!o.powerEfficient){this.potatoes.add(e,s.url);continue}else i=s.url}else i=this.potatoes.get(e).shift();if(e.src=i,e.load(),await ho(e)){x(s)?this.sources.get(e).unshift(s):this.potatoes.get(e).unshift(i);let o=()=>this.loadMediaElement(e,n);e.addEventListener("error",o),this.onError.set(e,o),this.wasUsingAudioElement=this.wasUsingAudioElement,x(n)&&n.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return F(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}play(){return this.video.play()}async playThrough(){let e=De(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};function X0(r){return[bh([r[1],r[0],r[2]]),bh([r[2],r[0],r[3]])]}function yh(r){return r.map(X0).flat()}var wc=new THREE.Vector3,xh=new THREE.Vector3,aa=new THREE.Vector3;function bh(r){let t=[[r[0][0],r[0][1],r[0][2]],[r[1][0],r[1][1],r[1][2]],[r[2][0],r[2][1],r[2][2]]],e=[[r[0][3],r[0][4]],[r[1][3],r[1][4]],[r[2][3],r[2][4]]];aa.fromArray(t[0]),wc.fromArray(t[1]).sub(aa),aa.fromArray(t[2]),xh.fromArray(t[1]).sub(aa),wc.cross(xh);let n=wc.toArray();return{positions:t,uvs:e,normal:n}}function wh(r){let t=r.map(s=>s.positions).flat(2),e=r.map(s=>s.uvs).flat(2),n=r.flatMap(s=>s.normal),i=new THREE.BufferGeometry;return i.setAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3,!1)),i.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(e),2,!1)),i.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(n),3,!0)),i}function wt(...r){let t=yh(r);return wh(t)}function si(r,...t){let e=Q0(t);for(let i=0;i<r;++i)e=Y0(e);t=K0(e);let n=yh(t);return wh(n)}function Q0(r){return r.map(t=>{let e=Number.MAX_VALUE,n=Number.MIN_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(let u of t){let m=u[3],f=u[4];e=Math.min(e,m),n=Math.max(n,m),i=Math.min(i,f),s=Math.max(s,f)}let o=[e,i],l=[n-e,s-i];return{minUV:o,deltaUV:l,verts:[la(o,l,t[0]),la(o,l,t[1]),la(o,l,t[2]),la(o,l,t[3])]}})}function la(r,t,e){return{pos:[e[0],e[1],e[2]],uv:[e[3],e[4]],pUV:[(e[3]-r[0])/t[0],(e[4]-r[1])/t[1]]}}function K0(r){return r.map(t=>[ca(t,0),ca(t,1),ca(t,2),ca(t,3)])}function ca(r,t){let e=r.verts[t];return[e.pos[0],e.pos[1],e.pos[2],e.uv[0],e.uv[1]]}function Y0(r){return r.flatMap(t=>{let e=is(t,t.verts[0],t.verts[1]),n=is(t,t.verts[2],t.verts[3]),i=is(t,t.verts[0],t.verts[3]),s=is(t,t.verts[1],t.verts[2]),o=is(t,e,n);return[{minUV:t.minUV,deltaUV:t.deltaUV,verts:[t.verts[0],e,o,i]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[e,t.verts[1],s,o]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[o,s,t.verts[2],n]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[i,o,n,t.verts[3]]}]})}function is(r,t,e){let n=e.pos[0]-t.pos[0],i=e.pos[1]-t.pos[1],s=e.pos[2]-t.pos[2],o=t.pos[0]+.5*n,l=t.pos[1]+.5*i,u=t.pos[2]+.5*s,m=e.pUV[0]-t.pUV[0],f=e.pUV[1]-t.pUV[1],v=t.pUV[0]+.5*m,A=t.pUV[1]+.5*f,T=Ah(v-.5)+.5,C=Ah(A-.5)+.5,I=T*r.deltaUV[0]+r.minUV[0],P=C*r.deltaUV[1]+r.minUV[1];return{pos:[o,l,u],pUV:[v,A],uv:[I,P]}}function Ah(r){return 2*Math.atan(2*r)/Math.PI}var da=class extends oa{constructor(e,n){super(n);d(this,"material");d(this,"vidMeshes");d(this,"object");this.material=tn({name:"videoPlayer-material"}),this.vidMeshes=[];for(let i=0;i<2;++i){let s=new Lt(e,`videoPlayer-view${i+1}`,!1,this.material);s.mesh.setImage(this.video),s.renderOrder=4,i>0?s.mesh.layers.disable(0):s.mesh.layers.enable(0),this.vidMeshes.push(s)}this.object=At("videoPlayer",...this.vidMeshes)}onDisposing(){super.onDisposing(),Tr(this.object),be(this.vidMeshes)}update(e,n){for(let i of this.vidMeshes)i.update(e,n)}isSupported(e,n){return n.split("-").map(i=>Th.has(e,i)).reduce(ud,!0)}setStereoParameters(e,n){if(!this.isSupported(e,n))throw new Error(`Not supported [encoding: ${e}, layout: ${n}]`);for(let o=0;o<this.vidMeshes.length;++o){let l=this.vidMeshes[o];l.webXRLayersEnabled=!1,l.mesh.layers.disable(1),l.mesh.layers.disable(2),n==="left-right"||n==="top-bottom"?l.mesh.layers.enable(this.vidMeshes.length-o):n!=="mono"&&l.mesh.layers.enable(o+1)}let i=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.set(100,100,100):n==="mono"?this.vidMeshes[0].scale.set(1,i,1):n==="left-right"||n==="right-left"?this.vidMeshes[0].scale.set(1,2*i,1):this.vidMeshes[0].scale.set(1,.5*i,1);for(let o=1;o<this.vidMeshes.length;++o)this.vidMeshes[o].scale.copy(this.vidMeshes[0].scale);let s=n.split("-");for(let o=0;o<s.length;++o){let l=s[o],u=Th.get(e,l),m=this.vidMeshes[o];m.webXRLayersEnabled=!0,m.visible=!0,m.mesh.geometry!==u&&(m.mesh.geometry.dispose(),m.mesh.geometry=u)}}},q0=wt([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),Sh=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],Mh=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],Rh=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],Tc=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],Sc=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],$0=wt(Sh),Z0=wt(Mh),J0=wt(Mc(Sh)),ev=wt(Mc(Mh)),_h=Ph(Tc),Ch=Ph(Sc),tv=wt(...Rh),rv=wt(...Tc),nv=wt(...Sc),iv=wt(..._h),sv=wt(...Ch),ss=4,ov=si(ss,...Rh),av=si(ss,...Tc),lv=si(ss,...Sc),cv=si(ss,..._h),uv=si(ss,...Ch),Th=new gt([["N/A","mono",q0],["N/A","left",$0],["N/A","right",Z0],["N/A","top",J0],["N/A","bottom",ev],["Cubemap Strips","mono",tv],["Cubemap Strips","left",rv],["Cubemap Strips","right",nv],["Cubemap Strips","top",iv],["Cubemap Strips","bottom",sv],["Equi-Angular Cubemap (YouTube)","mono",ov],["Equi-Angular Cubemap (YouTube)","left",av],["Equi-Angular Cubemap (YouTube)","right",lv],["Equi-Angular Cubemap (YouTube)","top",cv],["Equi-Angular Cubemap (YouTube)","bottom",uv]]);function ua(r){return[r[0],r[1],r[2],r[4],1-r[3]]}function Mc(r){return[ua(r[0]),ua(r[1]),ua(r[2]),ua(r[3])]}function Ph(r){return r.map(Mc)}var pa=class extends THREE.Mesh{constructor(e){super(e,es(0));d(this,"isCollider",!0);this.visible=!1}};var ha=class extends THREE.Object3D{constructor(e,n,i,s,o){super();d(this,"_disabled",!1);d(this,"enabledMesh");d(this,"disabledMesh");let l=vt(16);this.name=e+l,this.enabledMesh=this.createMesh(`${this.name}-enabled`,n,i),this.disabledMesh=this.createMesh(`${this.name}-disabled`,n,s),this.disabledMesh.visible=!1,this.size=o,this.add(this.enabledMesh,this.disabledMesh)}get size(){return this.enabledMesh.scale.x}set size(e){this.enabledMesh.scale.setScalar(e),this.disabledMesh.scale.setScalar(e)}createMesh(e,n,i){let s=new THREE.Mesh(n,i);return s.name="Mesh-"+e,s}get disabled(){return this._disabled}set disabled(e){e!==this.disabled&&(this._disabled=e,this.enabledMesh.visible=!e,this.disabledMesh.visible=e)}};var on=class extends ha{constructor(e,n,i,s,o){super(e,n,i,s,o);d(this,"collider");d(this,"isDraggable",!1);d(this,"isClickable",!0);this.collider=new pa(n),this.collider.name=`Collider-${this.name}`,this.size=o,this.add(this.collider),zo(this)}set size(e){super.size=e,this.collider&&this.collider.scale.setScalar(e)}};var oi=class{constructor(t,e,n){d(this,"element");d(this,"object");d(this,"mesh",null);this.element=zn(kn(n),t.getImageElement(e,n)),this.object=At(`${name}-button`),this.load(t,e,n)}async load(t,e,n){let{geometry:i,enabledMaterial:s,disabledMaterial:o}=await t.getGeometryAndMaterials(e,n);this.mesh=new on(n,i,s,o,.2),this.object.add(this.mesh),this.mesh.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get name(){return this.object.name}addEventListener(t,e,n){this.element.addEventListener(t,e,n)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,n){this.element.removeEventListener(t,e,n)}click(){this.element.click()}get visible(){return Rt(this)}set visible(t){_e(this,t,"inline-block"),this.mesh&&(this.mesh.visible=t)}};var ai=class extends Lt{constructor(e,n,i){super(e,n,!1);this.image=i;this.mesh&&this.setImage(i)}get object(){return this}setImage(e){this.mesh.setImage(e.canvas),this.mesh.objectHeight=.1,this.mesh.updateTexture(),e.addEventListener("redrawn",()=>this.mesh.updateTexture())}copy(e,n=!0){return super.copy(e,n),this.setImage(e.image),this}get element(){return Gn(this.image.canvas)?this.image.canvas:null}get isVisible(){return Rt(this)}set isVisible(e){_e(this,e,"inline-block"),Ie(this,e),Ie(this.mesh,e),this.image.visible=e}};function Rc(r,t,e){let n=x(e),i=n&&r.classList.contains(e);n&&i!==t&&(t?r.classList.add(e):r.classList.remove(e))}var dv=["danger","dark","info","light","primary","secondary","success","warning"];function an(r,t,e,n){if($r(r)&&(r=r.element),oe(e))for(let i of dv)Rc(r,t&&i===e,`btn-${i}`),Rc(r,!t&&i===e,`btn-outline-${i}`);uo(r)&&(r.disabled=!t),n&&Un(r,n)}var ln=class{constructor(t,e,n,i){this.buttons=t;this.setName=e;this.activeName=n;this.inactiveName=i;d(this,"element");d(this,"object");d(this,"enterButton",null);d(this,"exitButton",null);d(this,"btnImage");d(this,"_isAvailable",!0);d(this,"_isEnabled",!0);d(this,"_isVisible",!0);d(this,"_isActive",!1);this.element=zn(this.btnImage=Yi()),this.object=At(`${this.setName}-button`),this.load()}get name(){return this.object.name}addEventListener(t,e,n){this.element.addEventListener(t,e,n)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,n){this.element.removeEventListener(t,e,n)}click(){this.element.click()}async load(){let[t,e]=await Promise.all([this.buttons.getGeometryAndMaterials(this.setName,this.activeName),this.buttons.getGeometryAndMaterials(this.setName,this.inactiveName)]);we(this.object,this.enterButton=new on(`${this.setName}-activate-button`,t.geometry,t.enabledMaterial,t.disabledMaterial,.2),this.exitButton=new on(`${this.setName}-deactivate-button`,e.geometry,e.enabledMaterial,e.disabledMaterial,.2)),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(t){this._isAvailable=t,this.refreshState()}get active(){return this._isActive}set active(t){this._isActive=t,this.refreshState()}get enabled(){return this._isEnabled}set enabled(t){this._isEnabled=t,this.refreshState()}get visible(){return this._isVisible}set visible(t){this._isVisible=t,this.refreshState()}refreshState(){let t=this.active?this.inactiveName:this.activeName,e=`${t} ${this.setName}`;if(this.element.title=this.btnImage.title=e,this.btnImage.src=this.buttons.getImageSrc(this.setName,t),an(this,this.available&&this.visible&&this.enabled,"primary"),_e(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){Vo(this,this.available&&this.visible&&this.enabled);let n=Ie(this.object,this.available&&this.visible);Ie(this.enterButton,n&&!this.active),Ie(this.exitButton,n&&this.active)}}};var os=class extends ln{constructor(e,n){let i=ns[n];super(e,i.toLowerCase(),"enter","exit");this.mode=n}};function _c(r,t,e){r.element instanceof HTMLButtonElement&&an(r,t,e),Vo(r,t)}var as=class extends G{constructor(e,n){super(e);this.appName=n}},Cc=class extends as{constructor(e,n){super("apploading",e);this.appLoadParams=n;d(this,"preLoadTask",null)}},Pc=class extends as{constructor(e,n){super("apploaded",e);this.app=n}},Ic=class extends as{constructor(e,n){super("appshown",e);this.app=n}},Lc=class{constructor(t,e){this.loader=t;this.name=e;d(this,"params",new Map)}param(t,e){return this.params.set(t,e),this}load(t){return this.loader(this.name,this.params,t)}},ma=class extends te{constructor(e,n){super();this.env=e;this.JS_EXT=n;d(this,"loadedModules",new Map);d(this,"loadingApps",new Map);d(this,"currentApps",new Map);d(this,"cacheBustString",null)}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}async loadAppConstructor(e,n){if(this.loadedModules.has(e))x(n)&&n.end();else{let s=`/js/${e}/index${this.JS_EXT}`;x(this.cacheBustString)&&(s+="#"+this.cacheBustString);let o=this.env.fetcher.get(s).progress(n).module();this.loadedModules.set(e,o)}let{default:i}=await this.loadedModules.get(e);return i}app(e){return new Lc(this.loadApp.bind(this),e)}loadApp(e,n,i){let s=null;n instanceof Map?s=n:i=n,i=i||this.env.loadingBar;let o=new Cc(e,s);this.dispatchEvent(o);let l=o.preLoadTask||Promise.resolve();if(!this.loadingApps.has(e)){let m=eo(i),f=l.then(()=>this.loadAppInstance(this.env,e,s,m.pop(10)));this.loadingApps.set(e,f),i=m.pop(1)}return this.loadingApps.get(e).then(async m=>(await m.show(i),this.dispatchEvent(new Ic(e,m)),m))}async loadAppInstance(e,n,i,s){if(!this.currentApps.has(n)){let[o,l]=zi(s,[1,10]),u=await this.loadAppConstructor(n,o),m=new u(e);m.addEventListener("quit",()=>this.unloadApp(n)),x(i)&&await m.init(i),await m.load(l),this.currentApps.set(n,m),this.dispatchEvent(new Pc(n,m))}return x(s)&&s.end(),this.currentApps.get(n)}unloadApp(e){let n=this.currentApps.get(e);n.clearEventListeners(),n.dispose(),this.currentApps.delete(e),this.loadingApps.delete(e)}};var ls=new THREE.Vector3;function fa(r){return ls.copy(r),ls.y=0,ls.normalize(),cr(Math.atan2(ls.x,ls.z))}function Ih(r){return cr(Math.asin(r.y))}var li=new THREE.Vector3,Lh=0,pv=new THREE.Vector3,ga=new THREE.Vector3,Dh=new THREE.Vector3,va=new THREE.Quaternion,Oh=0,hv=0;function mv(r,t){let e=r-t,n=e+2*Math.PI,i=e-2*Math.PI,s=Math.abs(e),o=Math.abs(n),l=Math.abs(i);return s<o&&s<l?e:o<l?n:i}var Ea=class extends THREE.Object3D{constructor(e,n,i,s,o=1){super();this.minDistance=n;this.heightOffset=s;this.speed=o;d(this,"lerp");d(this,"maxDistance");d(this,"minAngle");d(this,"maxAngle");this.name=e,this.lerp=this.minAngle>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minAngle=Qe(i),this.maxAngle=Math.PI-this.minAngle,Object.seal(this)}copy(e,n=!0){return super.copy(e,n),this.name=e.name+ ++hv,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minAngle=e.minAngle,this.maxAngle=e.maxAngle,this}update(e,n,i,s){s*=.001,this.clampTo(this.lerp,e,n,this.minDistance,this.maxDistance,i,this.minAngle,this.maxAngle,s)}reset(e,n,i){this.clampTo(!1,e,n,0,0,i,0,0,0)}clampTo(e,n,i,s,o,l,u,m,f){li.copy(i),li.y-=this.heightOffset*n,Lh=l,this.getWorldPosition(ga),this.getWorldDirection(Dh),Oh=fa(Dh),va.identity();let v=!e,A=!e;if(e){let T=pv.copy(li).sub(ga).length();s<T&&(T<o&&li.lerpVectors(ga,li,this.speed*f),v=!0);let C=mv(Lh,Oh),I=Math.abs(C);u<I&&(I<m?va.setFromAxisAngle(this.up,C*this.speed*f):va.setFromAxisAngle(this.up,C),A=!0)}(v||A)&&(v&&this.position.add(li.sub(ga)),A&&this.quaternion.multiply(va))}};function xa(r){return!(r.shiftKey||r.altKey||r.ctrlKey||r.metaKey)}var ba=class extends G{constructor(){super("avatarmoved");this.px=0;this.py=0;this.pz=0;this.fx=0;this.fy=0;this.fz=0;this.ux=0;this.uy=0;this.uz=0;this.height=0;this.name=0}set(e,n,i,s,o,l,u,m,f,v){this.px=e,this.py=n,this.pz=i,this.fx=s,this.fy=o,this.fz=l,this.ux=u,this.uy=m,this.uz=f,this.height=v}};function Sr(r,t){return r.xr.isPresenting?r.xr.getCamera(t):t}function Bh(r,t,e,n,i){let s=r.elements;t.set(s[0],s[1],s[2]),e.set(s[4],s[5],s[6]),n.set(-s[8],-s[9],-s[10]),i.set(s[12],s[13],s[14]),t.normalize(),e.normalize(),n.normalize()}var Fh=100,fv=50,gv=1,vv=Math.PI/3,Ev=new THREE.Vector3(0,0,1),xv=new THREE.Vector3,cn=new THREE.Vector3,Aa=new THREE.Vector3,ya=new THREE.Vector3,Hh=new THREE.Matrix4,ci=new THREE.Euler,kh=new THREE.Quaternion,Nh=new THREE.Quaternion,bv=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),un=new THREE.Vector3,Vh=new THREE.Quaternion,Dc=new THREE.Vector3,Uh=new THREE.Matrix4,zh=new ba;function Av(r){return r===DeviceOrientationEvent&&"requestPermission"in r&&ae(r.requestPermission)}var wa=class extends te{constructor(e,n,i,s){super();this.renderer=e;this.camera=n;d(this,"controlMode","none");d(this,"requiredMouseButton",new Map([["mousedrag",1],["touchswipe",1]]));d(this,"_heading",0);d(this,"_pitch",0);d(this,"_roll",0);d(this,"fwrd",!1);d(this,"back",!1);d(this,"left",!1);d(this,"rgth",!1);d(this,"up",!1);d(this,"down",!1);d(this,"grow",!1);d(this,"shrk",!1);d(this,"viewEuler",new THREE.Euler);d(this,"move",new THREE.Vector3);d(this,"followers",new Array);d(this,"head");d(this,"worldPos",new THREE.Vector3);d(this,"_worldHeading",0);d(this,"_worldPitch",0);d(this,"evtSys",null);d(this,"requiredTouchCount",1);d(this,"disableHorizontal",!1);d(this,"disableVertical",!1);d(this,"invertHorizontal",!1);d(this,"invertVertical",!0);d(this,"minimumX",-85*Math.PI/180);d(this,"maximumX",85*Math.PI/180);d(this,"target",new THREE.Quaternion(0,0,0,1));d(this,"edgeFactor",1/3);d(this,"accelerationX",2);d(this,"accelerationY",2);d(this,"speedX",3);d(this,"speedY",2);d(this,"deviceQ",new THREE.Quaternion().identity());d(this,"_height");d(this,"u",0);d(this,"v",0);d(this,"du",0);d(this,"dv",0);d(this,"_keyboardControlEnabled",!1);d(this,"onKeyDown");d(this,"onKeyUp");d(this,"deviceOrientation",null);d(this,"screenOrientation",0);d(this,"alphaOffset",0);d(this,"onDeviceOrientationChangeEvent",null);d(this,"onScreenOrientationChangeEvent",null);d(this,"motionEnabled",!1);this._height=s,this.head=At("Head",i),this.onKeyDown=o=>{let l=xa(o);o.key==="w"&&(this.fwrd=l),o.key==="s"&&(this.back=l),o.key==="a"&&(this.left=l),o.key==="d"&&(this.rgth=l),o.key==="e"&&(this.up=l),o.key==="q"&&(this.down=l),o.key==="r"&&(this.grow=l),o.key==="f"&&(this.shrk=l)},this.onKeyUp=o=>{o.key==="w"&&(this.fwrd=!1),o.key==="s"&&(this.back=!1),o.key==="a"&&(this.left=!1),o.key==="d"&&(this.rgth=!1),o.key==="e"&&(this.up=!1),o.key==="q"&&(this.down=!1),o.key==="r"&&(this.grow=!1),o.key==="f"&&(this.shrk=!1)},this.keyboardControlEnabled=!0,Mt()?this.controlMode="motioncontroller":matchMedia("(pointer: coarse)").matches?this.controlMode="touchswipe":matchMedia("(pointer: fine)").matches&&(this.controlMode="mousedrag"),globalThis.isSecureContext&&ki()&&!Mt()&&(this.onDeviceOrientationChangeEvent=o=>{this.deviceOrientation=o,o&&(o.alpha||o.beta||o.gamma)&&this.motionEnabled&&(this.controlMode="magicwindow")},this.onScreenOrientationChangeEvent=()=>{oe(globalThis.orientation)||(this.screenOrientation=globalThis.orientation||0)},this.startMotionControl())}get worldHeading(){return this._worldHeading}get worldPitch(){return this._worldPitch}get height(){return this.head.position.y}get object(){return this.head}get stage(){return this.head.parent}onFlick(e){Dc.set(vv*e,0,0)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(globalThis.addEventListener("keydown",this.onKeyDown),globalThis.addEventListener("keyup",this.onKeyUp)):(globalThis.removeEventListener("keydown",this.onKeyDown),globalThis.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onDown(e){e.pointer.enabled&&this.setMode(e)}onMove(e){e.pointer.enabled&&(this.setMode(e),e.pointer.canMoveView&&this.checkMode(this.controlMode,e)&&(this.u=e.pointer.state.u,this.v=e.pointer.state.v,this.du=e.pointer.state.du,this.dv=e.pointer.state.dv))}setMode(e){e.pointer.type==="mouse"?e.pointer.draggedHit?this.controlMode="mouseedge":this.controlMode="mousedrag":e.pointer.type==="touch"||e.pointer.type==="pen"?this.controlMode="touchswipe":e.pointer.type==="gamepad"?this.controlMode="gamepad":e.pointer.type==="hand"?this.controlMode="motioncontroller":this.controlMode="none"}checkMode(e,n){return e!=="none"&&this.gestureSatisfied(e,n)&&this.dragSatisfied(e,n)}gestureSatisfied(e,n){let i=this.requiredMouseButton.get(e);return F(i)?e==="mouseedge"||e==="touchswipe"||e==="gamepad":n.pointer.state.buttons===i}dragSatisfied(e,n){return!this.requiredMouseButton.has(e)||this.requiredMouseButton.get(e)==0||n.pointer.state.dragging}get name(){return this.object.name}set name(e){this.object.name=e}get heading(){return this._heading}setHeading(e){this._heading=cr(e)}get pitch(){return this._pitch}setPitch(e,n,i){this._pitch=cr(e+Math.PI)-Math.PI,this._pitch=et(this._pitch,n,i)}get roll(){return this._roll}setRoll(e){this._roll=cr(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,n){this.setHeading(e),this._pitch=cr(n),this.updateOrientation()}update(e){if(e*=.001,this.controlMode==="magicwindow"){let n=this.deviceOrientation;if(n){let i=n.alpha?Qe(n.alpha)+this.alphaOffset:0,s=n.beta?Qe(n.beta):0,o=n.gamma?Qe(n.gamma):0,l=this.screenOrientation?Qe(this.screenOrientation):0;ci.set(s,i,-o,"YXZ"),Nh.setFromAxisAngle(Ev,-l),this.deviceQ.setFromEuler(ci).multiply(bv).multiply(Nh)}}else if(this.controlMode!=="none"){let n=this.pitch,i=this.heading,s=this.orientationDelta(this.controlMode,this.disableVertical,e);this.rotateView(s,this.minimumX,this.maximumX),this.evtSys&&(n!==this.pitch||i!==this.heading)&&this.controlMode==="mouseedge"&&this.evtSys.recheckPointers()}if(this.fwrd||this.back||this.left||this.rgth||this.up||this.down){kh.setFromAxisAngle(this.stage.up,this.worldHeading);let n=(this.left?-1:0)+(this.rgth?1:0),i=(this.down?-1:0)+(this.up?1:0),s=(this.fwrd?-1:0)+(this.back?1:0);this.move.set(n,i,s);let o=this.move.length();o>0&&(this.move.multiplyScalar(e/o).applyQuaternion(kh),this.stage.position.add(this.move))}if(this.grow||this.shrk){let n=(this.shrk?-1:0)+(this.grow?1:0);this._height+=n*e,this._height=et(this._height,1,2)}this.updateOrientation(),zh.set(ya.x,ya.y,ya.z,cn.x,cn.y,cn.z,Aa.x,Aa.y,Aa.z,this.height),this.dispatchEvent(zh)}rotateView(e,n=-Math.PI,i=Math.PI){this.viewEuler.setFromQuaternion(e,"YXZ");let{x:s,y:o}=this.viewEuler;this.setHeading(this.heading+o),this.setPitch(this.pitch+s,n,i),this.setRoll(0)}updateOrientation(){let e=Sr(this.renderer,this.camera);Uh.makeRotationY(this._heading),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(Uh),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.renderer.xr.isPresenting?(Hh.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(Hh),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(0,this._height,0),ci.set(this._pitch,0,this._roll,"XYZ"),this.head.quaternion.setFromEuler(ci).premultiply(this.deviceQ)),this.camera.position.copy(this.head.position),this.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldDirection(cn),this._worldHeading=fa(cn),this._worldPitch=Ih(cn),Bh(this.head.matrixWorld,xv,Aa,cn,ya)}reset(){this.stage.position.set(0,0,0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeading)}orientationDelta(e,n,i){var s=this.pointerMovement(e);if(this.controlMode==="mousedrag"||this.controlMode==="touchswipe"){let o=Math.pow(.95,100*i);this.du=Ni(o*this.du),this.dv=Ni(o*this.dv)}return n?s.x=0:this.invertVertical&&(s.x*=-1),this.disableHorizontal?s.y=0:this.invertHorizontal&&(s.y*=-1),e!=="motioncontroller"&&s.multiplyScalar(i),ci.set(s.y,s.x,0,"YXZ"),Vh.setFromEuler(ci),Vh}pointerMovement(e){switch(e){case"mousedrag":return this.getAxialMovement(Fh);case"mousefirstperson":return this.getAxialMovement(Fh);case"touchswipe":return this.getAxialMovement(fv);case"gamepad":return this.getAxialMovement(gv);case"mouseedge":return this.getRadiusMovement();case"motioncontroller":return un.copy(Dc),Dc.set(0,0,0),un;case"none":case"magicwindow":return un.set(0,0,0);default:zt(e)}}getAxialMovement(e){return un.set(-e*this.du,e*this.dv,0),un}getRadiusMovement(){return un.set(this.scaleRadialComponent(this.u,this.speedX,this.accelerationX),this.scaleRadialComponent(-this.v,this.speedY,this.accelerationY),0),un}scaleRadialComponent(e,n,i){let s=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,s-this.edgeFactor)/(1-this.edgeFactor),i)*n}async getPermission(){return"DeviceOrientationEvent"in globalThis?Av(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&(globalThis.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&(globalThis.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}};var Ta=class{constructor(t){this.camera=t;d(this,"fovZoomEnabled",!0);d(this,"minFOV",15);d(this,"maxFOV",120);d(this,"dz",0)}onMove(t){t.pointer.enabled&&t.pointer.canMoveView&&t.pointer.state.dz!==0&&(this.dz=t.pointer.state.dz)}get fov(){return this.camera.fov}set fov(t){t!==this.fov&&(this.camera.fov=t,this.camera.updateProjectionMatrix())}update(t){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let e=Math.pow(.95,5*t);this.dz=Ni(e*this.dz),this.fov=et(this.camera.fov-this.dz,this.minFOV,this.maxFOV)}}};var Sa=0;var ui=3;function Gh(r,t){r=bt(r),r.traverse(e=>e.layers.set(t))}function jh(r,t){r=bt(r),r.traverse(e=>e.layers.enable(t))}var Bc=new THREE.Vector3,us=new THREE.Vector3,Wh=new THREE.Quaternion,Dt=class{constructor(){d(this,"_object",null);d(this,"_visible",!0);d(this,"_style","default")}get object(){return this._object}set object(t){this._object=t}get style(){return this._style}set style(t){this._style=t}get visible(){return this._visible}set visible(t){this._visible=t}update(t,e,n,i,s,o,l){e&&e.face?(this.position.copy(e.point),e.object.getWorldQuaternion(Wh),Bc.copy(e.face.normal).applyQuaternion(Wh),us.copy(Bc).multiplyScalar(.02),this.position.add(us),us.copy(Bc).multiplyScalar(10).add(this.position)):(this.position.copy(l).multiplyScalar(n).add(o),us.copy(t)),this.object.parent.worldToLocal(this.position),this.lookAt(us),this.style=e?mh(e)?"not-allowed":sn(e)?s.dragging?"grabbing":"move":nn(e)?"pointer":"default":i?s.buttons===1?"grabbing":"grab":"default"}lookAt(t){}};var di=class extends Dt{constructor(e){super();d(this,"cursorSystem",null);this.object=new THREE.Object3D,this.cursorSystem=e}add(e,n){this.object.add(n),jh(n,ui),n.visible=e==="default"}get position(){return this.object.position}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let n of this.object.children)n.visible=n.name===e;if(this.style==null&&this.object.children.length>0){let n=Je(this.object.children,i=>i.name==="default",i=>i!=null);n!=null&&(n.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return Jn(this)}set visible(e){Ie(this,e)}lookAt(e){this.object.lookAt(e)}clone(){let e=new di;for(let n of this.object.children)e.add(n.name,n.clone());return e}};var Ma=class extends G{constructor(e=null){super("objectMoved");this.name=e;this.px=0;this.py=0;this.pz=0;this.fx=0;this.fy=0;this.fz=0;this.ux=0;this.uy=0;this.uz=0}set(e,n,i,s,o,l,u,m,f){this.px=e,this.py=n,this.pz=i,this.fx=s,this.fy=o,this.fz=l,this.ux=u,this.uy=m,this.uz=f}};function ut(r){if(!r||!rn(r.object))return null;let t=r.object;for(;x(t)&&!qt(t);)t=t.parent;return t}var dt=class extends G{constructor(e,n){super(e);this.pointer=n;d(this,"_hit",null);d(this,"_point",null);d(this,"_distance",Number.POSITIVE_INFINITY);d(this,"_object",null);Object.seal(this)}get hit(){return this._hit}set hit(e){e!==this.hit&&(this._hit=e,this._point=null,this._distance=Number.POSITIVE_INFINITY,this._object=null,e&&(this._point=e.point,this._distance=e.distance,this._object=ut(e)))}get object(){return this._object}get point(){return this._point}get distance(){return this._distance}to3(e){return new Fc(this.type,e,this.pointer.state.buttons)}},Fc=class{constructor(t,e,n){this.type=t;this.hit=e;this.buttons=n;d(this,"_point");d(this,"_distance");d(this,"_object");this._point=this.hit&&this.hit.point,this._distance=this.hit&&this.hit.distance||Number.POSITIVE_INFINITY,this._object=ut(this.hit)}get object(){return this._object}get point(){return this._point}get distance(){return this._distance}};var Ra=class extends G{constructor(e,n){super(e);this.button=n}},Hc=class extends Ra{constructor(t){super("gamepadbuttonup",t)}},kc=class extends Ra{constructor(t){super("gamepadbuttondown",t)}},Nc=class extends G{constructor(e,n,i){super(e);this.axis=n;this.value=i}},Vc=class extends Nc{constructor(t,e){super("gamepadaxismaxed",t,e)}},_a=class extends te{constructor(e){super();this.pad=e;this.lastAxisValues=new Array;this.btnDownEvts=new Array;this.btnUpEvts=new Array;this.wasPressed=new Array;this.axisThresholdMax=.9;this.axisThresholdMin=.1;this.axisMaxEvts=new Array;this.wasAxisMaxed=new Array;this.sticks=new Array;this._isStick=n=>n%2===0&&n<e.axes.length-1;for(let n=0;n<e.buttons.length;++n)this.btnDownEvts[n]=new kc(n),this.btnUpEvts[n]=new Hc(n),this.wasPressed[n]=!1;for(let n=0;n<e.axes.length;++n)this.axisMaxEvts[n]=new Vc(n,0),this.wasAxisMaxed[n]=!1,this._isStick(n)&&(this.sticks[n/2]={x:0,y:0}),this.lastAxisValues[n]=e.axes[n];Object.seal(this)}setPad(e){this.pad=e,this.update()}get id(){return this.pad.id}get index(){return this.pad.index}get connected(){return this.pad.connected}get mapping(){return this.pad.mapping}get timestamp(){return this.pad.timestamp}get hand(){return this.pad.hand}get pose(){return this.pad.pose}get buttons(){return this.pad.buttons}get axes(){return this.pad.axes}get hapticActuators(){return this.pad.hapticActuators}update(){for(let e=0;e<this.pad.buttons.length;++e){let n=this.wasPressed[e],i=this.pad.buttons[e].pressed;i!==n&&(this.wasPressed[e]=i,this.dispatchEvent((i?this.btnDownEvts:this.btnUpEvts)[e]))}for(let e=0;e<this.pad.axes.length;++e){let n=this.wasAxisMaxed[e],i=this.pad.axes[e],s=Math.sign(i),o=Math.abs(i),l=o>=this.axisThresholdMax,u=o<=this.axisThresholdMin,m=s*(l?1:u?0:o);l&&!n&&(this.axisMaxEvts[e].value=m,this.dispatchEvent(this.axisMaxEvts[e])),this.wasAxisMaxed[e]=l,this.lastAxisValues[e]=m}for(let e=0;e<this.axes.length-1;e+=2){let n=this.sticks[e/2];n.x=this.axes[e],n.y=this.axes[e+1]}}};var Rr=class extends THREE.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new jc(e)}),this.register(function(e){return new qc(e)}),this.register(function(e){return new $c(e)}),this.register(function(e){return new Wc(e)}),this.register(function(e){return new Xc(e)}),this.register(function(e){return new Qc(e)}),this.register(function(e){return new Kc(e)}),this.register(function(e){return new Yc(e)}),this.register(function(e){return new zc(e)}),this.register(function(e){return new Zc(e)})}load(t,e,n,i){let s=this,o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=THREE.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);let l=function(m){i?i(m):console.error(m),s.manager.itemError(t),s.manager.itemEnd(t)},u=new THREE.FileLoader(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(t,function(m){try{s.parse(m,o,function(f){e(f),s.manager.itemEnd(t)},l)}catch(f){l(f)}},n,l)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let s,o={},l={};if(typeof t=="string")s=t;else if(THREE.LoaderUtils.decodeText(new Uint8Array(t,0,4))===Jh){try{o[Y.KHR_BINARY_GLTF]=new Jc(t)}catch(v){i&&i(v);return}s=o[Y.KHR_BINARY_GLTF].content}else s=THREE.LoaderUtils.decodeText(new Uint8Array(t));let u=JSON.parse(s);if(u.asset===void 0||u.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let m=new au(u,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});m.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){let v=this.pluginCallbacks[f](m);l[v.name]=v,o[v.name]=!0}if(u.extensionsUsed)for(let f=0;f<u.extensionsUsed.length;++f){let v=u.extensionsUsed[f],A=u.extensionsRequired||[];switch(v){case Y.KHR_MATERIALS_UNLIT:o[v]=new Gc;break;case Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[v]=new ru;break;case Y.KHR_DRACO_MESH_COMPRESSION:o[v]=new eu(u,this.dracoLoader);break;case Y.KHR_TEXTURE_TRANSFORM:o[v]=new tu;break;case Y.KHR_MESH_QUANTIZATION:o[v]=new nu;break;default:A.indexOf(v)>=0&&l[v]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+v+'".')}}m.setExtensions(o),m.setPlugins(l),m.parse(n,i)}parseAsync(t,e){let n=this;return new Promise(function(i,s){n.parse(t,e,i,s)})}};function yv(){let r={};return{get:function(t){return r[t]},add:function(t,e){r[t]=e},remove:function(t){delete r[t]},removeAll:function(){r={}}}}var Y={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},zc=class{constructor(t){this.parser=t,this.name=Y.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){let s=e[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(t){let e=this.parser,n="light:"+t,i=e.cache.get(n);if(i)return i;let s=e.json,u=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t],m,f=new THREE.Color(16777215);u.color!==void 0&&f.fromArray(u.color);let v=u.range!==void 0?u.range:0;switch(u.type){case"directional":m=new THREE.DirectionalLight(f),m.target.position.set(0,0,-1),m.add(m.target);break;case"point":m=new THREE.PointLight(f),m.distance=v;break;case"spot":m=new THREE.SpotLight(f),m.distance=v,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,m.angle=u.spot.outerConeAngle,m.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,m.target.position.set(0,0,-1),m.add(m.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return m.position.set(0,0,0),m.decay=2,u.intensity!==void 0&&(m.intensity=u.intensity),m.name=e.createUniqueName(u.name||"light_"+t),i=Promise.resolve(m),e.cache.add(n,i),i}createNodeAttachment(t){let e=this,n=this.parser,s=n.json.nodes[t],l=(s.extensions&&s.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(u){return n._getNodeRef(e.cache,l,u)})}},Gc=class{constructor(){this.name=Y.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(t,e,n){let i=[];t.color=new THREE.Color(1,1,1),t.opacity=1;let s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){let o=s.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}s.baseColorTexture!==void 0&&i.push(n.assignTexture(t,"map",s.baseColorTexture))}return Promise.all(i)}},jc=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let s=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(n.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){let l=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new THREE.Vector2(l,l)}return Promise.all(s)}},Wc=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_SHEEN}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let s=[];e.sheenColor=new THREE.Color(0,0,0),e.sheenRoughness=0,e.sheen=1;let o=i.extensions[this.name];return o.sheenColorFactor!==void 0&&e.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(n.assignTexture(e,"sheenColorMap",o.sheenColorTexture)),o.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}},Xc=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let s=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(n.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(s)}},Qc=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_VOLUME}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let s=[],o=i.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(n.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||0;let l=o.attenuationColor||[1,1,1];return e.attenuationColor=new THREE.Color(l[0],l[1],l[2]),Promise.all(s)}},Kc=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_IOR}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let s=i.extensions[this.name];return e.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}},Yc=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_SPECULAR}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let s=[],o=i.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(n.assignTexture(e,"specularIntensityMap",o.specularTexture));let l=o.specularColorFactor||[1,1,1];return e.specularColor=new THREE.Color(l[0],l[1],l[2]),o.specularColorTexture!==void 0&&s.push(n.assignTexture(e,"specularColorMap",o.specularColorTexture).then(function(u){u.encoding=THREE.sRGBEncoding})),Promise.all(s)}},qc=class{constructor(t){this.parser=t,this.name=Y.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;let s=i.extensions[this.name],o=n.images[s.source],l=e.options.ktx2Loader;if(!l){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,o,l)}},$c=class{constructor(t){this.parser=t,this.name=Y.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,n=this.parser,i=n.json,s=i.textures[t];if(!s.extensions||!s.extensions[e])return null;let o=s.extensions[e],l=i.images[o.source],u=n.textureLoader;if(l.uri){let m=n.options.manager.getHandler(l.uri);m!==null&&(u=m)}return this.detectSupport().then(function(m){if(m)return n.loadTextureImage(t,l,u);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},Zc=class{constructor(t){this.name=Y.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){let i=n.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([s,o.ready]).then(function(l){let u=i.byteOffset||0,m=i.byteLength||0,f=i.count,v=i.byteStride,A=new ArrayBuffer(f*v),T=new Uint8Array(l[0],u,m);return o.decodeGltfBuffer(new Uint8Array(A),f,v,T,i.mode,i.filter),A})}else return null}},Jh="glTF",ds=12,Xh={JSON:1313821514,BIN:5130562},Jc=class{constructor(t){this.name=Y.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,ds);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Jh)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let n=this.header.length-ds,i=new DataView(t,ds),s=0;for(;s<n;){let o=i.getUint32(s,!0);s+=4;let l=i.getUint32(s,!0);if(s+=4,l===Xh.JSON){let u=new Uint8Array(t,ds+s,o);this.content=THREE.LoaderUtils.decodeText(u)}else if(l===Xh.BIN){let u=ds+s;this.body=t.slice(u,u+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},eu=class{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Y.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let n=this.json,i=this.dracoLoader,s=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,l={},u={},m={};for(let f in o){let v=su[f]||f.toLowerCase();l[v]=o[f]}for(let f in t.attributes){let v=su[f]||f.toLowerCase();if(o[f]!==void 0){let A=n.accessors[t.attributes[f]],T=ms[A.componentType];m[v]=T,u[v]=A.normalized===!0}}return e.getDependency("bufferView",s).then(function(f){return new Promise(function(v){i.decodeDracoFile(f,function(A){for(let T in A.attributes){let C=A.attributes[T],I=u[T];I!==void 0&&(C.normalized=I)}v(A)},l,m)})})}},tu=class{constructor(){this.name=Y.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return e.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},hs=class extends THREE.MeshStandardMaterial{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;let e=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),l={specular:{value:new THREE.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=l,this.onBeforeCompile=function(u){for(let m in l)u.uniforms[m]=l[m];u.fragmentShader=u.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return l.specular.value},set:function(u){l.specular.value=u}},specularMap:{get:function(){return l.specularMap.value},set:function(u){l.specularMap.value=u,u?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return l.glossiness.value},set:function(u){l.glossiness.value=u}},glossinessMap:{get:function(){return l.glossinessMap.value},set:function(u){l.glossinessMap.value=u,u?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},ru=class{constructor(){this.name=Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return hs}extendParams(t,e,n){let i=e.extensions[this.name];t.color=new THREE.Color(1,1,1),t.opacity=1;let s=[];if(Array.isArray(i.diffuseFactor)){let o=i.diffuseFactor;t.color.fromArray(o),t.opacity=o[3]}if(i.diffuseTexture!==void 0&&s.push(n.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new THREE.Color(0,0,0),t.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,t.specular=new THREE.Color(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){let o=i.specularGlossinessTexture;s.push(n.assignTexture(t,"glossinessMap",o)),s.push(n.assignTexture(t,"specularMap",o))}return Promise.all(s)}createMaterial(t){let e=new hs(t);return e.fog=!0,e.color=t.color,e.map=t.map===void 0?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=t.aoMap===void 0?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=t.emissiveMap===void 0?null:t.emissiveMap,e.bumpMap=t.bumpMap===void 0?null:t.bumpMap,e.bumpScale=1,e.normalMap=t.normalMap===void 0?null:t.normalMap,e.normalMapType=THREE.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=t.specularMap===void 0?null:t.specularMap,e.specular=t.specular,e.glossinessMap=t.glossinessMap===void 0?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=t.envMap===void 0?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}},nu=class{constructor(){this.name=Y.KHR_MESH_QUANTIZATION}},Zt=class extends THREE.Interpolant{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=t*i*3+i;for(let o=0;o!==i;o++)e[o]=n[s+o];return e}};Zt.prototype.beforeStart_=Zt.prototype.copySampleValue_;Zt.prototype.afterEnd_=Zt.prototype.copySampleValue_;Zt.prototype.interpolate_=function(r,t,e,n){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=o*2,u=o*3,m=n-t,f=(e-t)/m,v=f*f,A=v*f,T=r*u,C=T-u,I=-2*A+3*v,P=A-v,B=1-I,H=P-v+f;for(let D=0;D!==o;D++){let V=s[C+D+o],N=s[C+D+l]*m,L=s[T+D+o],k=s[T+D]*m;i[D]=B*V+H*N+I*L+P*k}return i};var wv=new THREE.Quaternion,iu=class extends Zt{interpolate_(t,e,n,i){let s=super.interpolate_(t,e,n,i);return wv.fromArray(s).normalize().toArray(s),s}},$t={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ms={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qh={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},Kh={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},Yh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},su={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Mr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Tv={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},Uc={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Sv(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),r.DefaultMaterial}function ps(r,t,e){for(let n in e.extensions)r[n]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=e.extensions[n])}function dn(r,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(r.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Mv(r,t,e){let n=!1,i=!1;for(let l=0,u=t.length;l<u;l++){let m=t[l];if(m.POSITION!==void 0&&(n=!0),m.NORMAL!==void 0&&(i=!0),n&&i)break}if(!n&&!i)return Promise.resolve(r);let s=[],o=[];for(let l=0,u=t.length;l<u;l++){let m=t[l];if(n){let f=m.POSITION!==void 0?e.getDependency("accessor",m.POSITION):r.attributes.position;s.push(f)}if(i){let f=m.NORMAL!==void 0?e.getDependency("accessor",m.NORMAL):r.attributes.normal;o.push(f)}}return Promise.all([Promise.all(s),Promise.all(o)]).then(function(l){let u=l[0],m=l[1];return n&&(r.morphAttributes.position=u),i&&(r.morphAttributes.normal=m),r.morphTargetsRelative=!0,r})}function Rv(r,t){if(r.updateMorphTargets(),t.weights!==void 0)for(let e=0,n=t.weights.length;e<n;e++)r.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){let e=t.extras.targetNames;if(r.morphTargetInfluences.length===e.length){r.morphTargetDictionary={};for(let n=0,i=e.length;n<i;n++)r.morphTargetDictionary[e[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function _v(r){let t=r.extensions&&r.extensions[Y.KHR_DRACO_MESH_COMPRESSION],e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+qh(t.attributes):e=r.indices+":"+qh(r.attributes)+":"+r.mode,e}function qh(r){let t="",e=Object.keys(r).sort();for(let n=0,i=e.length;n<i;n++)t+=e[n]+":"+r[e[n]]+";";return t}function ou(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var au=class{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new yv,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager):this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){let l={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:n,userData:{}};ps(s,l,i),dn(l,i),Promise.all(n._invokeAll(function(u){return u.afterRoot&&u.afterRoot(l)})).then(function(){t(l)})}).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let i=0,s=e.length;i<s;i++){let o=e[i].joints;for(let l=0,u=o.length;l<u;l++)t[o[l]].isBone=!0}for(let i=0,s=t.length;i<s;i++){let o=t[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;let i=n.clone(),s=(o,l)=>{let u=this.associations.get(o);u!=null&&this.associations.set(l,u);for(let[m,f]of o.children.entries())s(f,l.children[m])};return s(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){let i=t(e[n]);if(i)return i}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let n=[];for(let i=0;i<e.length;i++){let s=t(e[i]);s&&n.push(s)}return n}getDependency(t,e){let n=t+":"+e,i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){let n=this,i=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(i.map(function(s,o){return n.getDependency(t,o)})),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],n=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[Y.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(s,o){n.load(THREE.LoaderUtils.resolveURL(e.uri,i.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(n){let i=e.byteLength||0,s=e.byteOffset||0;return n.slice(s,s+i)})}loadAccessor(t){let e=this,n=this.json,i=this.json.accessors[t];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);let s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(o){let l=o[0],u=Yh[i.type],m=ms[i.componentType],f=m.BYTES_PER_ELEMENT,v=f*u,A=i.byteOffset||0,T=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,C=i.normalized===!0,I,P;if(T&&T!==v){let B=Math.floor(A/T),H="THREE.InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+B+":"+i.count,D=e.cache.get(H);D||(I=new m(l,B*T,i.count*T/f),D=new THREE.InterleavedBuffer(I,T/f),e.cache.add(H,D)),P=new THREE.InterleavedBufferAttribute(D,u,A%T/f,C)}else l===null?I=new m(i.count*u):I=new m(l,A,i.count*u),P=new THREE.BufferAttribute(I,u,C);if(i.sparse!==void 0){let B=Yh.SCALAR,H=ms[i.sparse.indices.componentType],D=i.sparse.indices.byteOffset||0,V=i.sparse.values.byteOffset||0,N=new H(o[1],D,i.sparse.count*B),L=new m(o[2],V,i.sparse.count*u);l!==null&&(P=new THREE.BufferAttribute(P.array.slice(),P.itemSize,P.normalized));for(let k=0,Z=N.length;k<Z;k++){let ie=N[k];if(P.setX(ie,L[k*u]),u>=2&&P.setY(ie,L[k*u+1]),u>=3&&P.setZ(ie,L[k*u+2]),u>=4&&P.setW(ie,L[k*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return P})}loadTexture(t){let e=this.json,n=this.options,i=e.textures[t],s=e.images[i.source],o=this.textureLoader;if(s.uri){let l=n.manager.getHandler(s.uri);l!==null&&(o=l)}return this.loadTextureImage(t,s,o)}loadTextureImage(t,e,n){let i=this,s=this.json,o=this.options,l=s.textures[t],u=(e.uri||e.bufferView)+":"+l.sampler;if(this.textureCache[u])return this.textureCache[u];let m=self.URL||self.webkitURL,f=e.uri||"",v=!1;if(e.bufferView!==void 0)f=i.getDependency("bufferView",e.bufferView).then(function(T){v=!0;let C=new Blob([T],{type:e.mimeType});return f=m.createObjectURL(C),f});else if(e.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let A=Promise.resolve(f).then(function(T){return new Promise(function(C,I){let P=C;n.isImageBitmapLoader===!0&&(P=function(B){let H=new THREE.Texture(B);H.needsUpdate=!0,C(H)}),n.load(THREE.LoaderUtils.resolveURL(T,o.path),P,void 0,I)})}).then(function(T){v===!0&&m.revokeObjectURL(f),T.flipY=!1,l.name&&(T.name=l.name);let I=(s.samplers||{})[l.sampler]||{};return T.magFilter=Qh[I.magFilter]||THREE.LinearFilter,T.minFilter=Qh[I.minFilter]||THREE.LinearMipmapLinearFilter,T.wrapS=Kh[I.wrapS]||THREE.RepeatWrapping,T.wrapT=Kh[I.wrapT]||THREE.RepeatWrapping,i.associations.set(T,{textures:t}),T}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",f),null});return this.textureCache[u]=A,A}assignTexture(t,e,n){let i=this;return this.getDependency("texture",n.index).then(function(s){if(n.texCoord!==void 0&&n.texCoord!=0&&!(e==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),i.extensions[Y.KHR_TEXTURE_TRANSFORM]){let o=n.extensions!==void 0?n.extensions[Y.KHR_TEXTURE_TRANSFORM]:void 0;if(o){let l=i.associations.get(s);s=i.extensions[Y.KHR_TEXTURE_TRANSFORM].extendTexture(s,o),i.associations.set(s,l)}}return t[e]=s,s})}assignFinalMaterial(t){let e=t.geometry,n=t.material,i=e.attributes.tangent===void 0,s=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(t.isPoints){let l="THREE.PointsMaterial:"+n.uuid,u=this.cache.get(l);u||(u=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(l,u)),n=u}else if(t.isLine){let l="THREE.LineBasicMaterial:"+n.uuid,u=this.cache.get(l);u||(u=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(u,n),u.color.copy(n.color),this.cache.add(l,u)),n=u}if(i||s||o){let l="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),i&&(l+="derivative-tangents:"),s&&(l+="vertex-colors:"),o&&(l+="flat-shading:");let u=this.cache.get(l);u||(u=n.clone(),s&&(u.vertexColors=!0),o&&(u.flatShading=!0),i&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(l,u),this.associations.set(u,this.associations.get(n))),n=u}n.aoMap&&e.attributes.uv2===void 0&&e.attributes.uv!==void 0&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(t){let e=this,n=this.json,i=this.extensions,s=n.materials[t],o,l={},u=s.extensions||{},m=[];if(u[Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let v=i[Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=v.getMaterialType(),m.push(v.extendParams(l,s,e))}else if(u[Y.KHR_MATERIALS_UNLIT]){let v=i[Y.KHR_MATERIALS_UNLIT];o=v.getMaterialType(),m.push(v.extendParams(l,s,e))}else{let v=s.pbrMetallicRoughness||{};if(l.color=new THREE.Color(1,1,1),l.opacity=1,Array.isArray(v.baseColorFactor)){let A=v.baseColorFactor;l.color.fromArray(A),l.opacity=A[3]}v.baseColorTexture!==void 0&&m.push(e.assignTexture(l,"map",v.baseColorTexture)),l.metalness=v.metallicFactor!==void 0?v.metallicFactor:1,l.roughness=v.roughnessFactor!==void 0?v.roughnessFactor:1,v.metallicRoughnessTexture!==void 0&&(m.push(e.assignTexture(l,"metalnessMap",v.metallicRoughnessTexture)),m.push(e.assignTexture(l,"roughnessMap",v.metallicRoughnessTexture))),o=this._invokeOne(function(A){return A.getMaterialType&&A.getMaterialType(t)}),m.push(Promise.all(this._invokeAll(function(A){return A.extendMaterialParams&&A.extendMaterialParams(t,l)})))}s.doubleSided===!0&&(l.side=THREE.DoubleSide);let f=s.alphaMode||Uc.OPAQUE;if(f===Uc.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,f===Uc.MASK&&(l.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==THREE.MeshBasicMaterial&&(m.push(e.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new THREE.Vector2(1,1),s.normalTexture.scale!==void 0)){let v=s.normalTexture.scale;l.normalScale.set(v,v)}return s.occlusionTexture!==void 0&&o!==THREE.MeshBasicMaterial&&(m.push(e.assignTexture(l,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==THREE.MeshBasicMaterial&&(l.emissive=new THREE.Color().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&o!==THREE.MeshBasicMaterial&&m.push(e.assignTexture(l,"emissiveMap",s.emissiveTexture)),Promise.all(m).then(function(){let v;return o===hs?v=i[Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):v=new o(l),s.name&&(v.name=s.name),v.map&&(v.map.encoding=THREE.sRGBEncoding),v.emissiveMap&&(v.emissiveMap.encoding=THREE.sRGBEncoding),dn(v,s),e.associations.set(v,{materials:t}),s.extensions&&ps(i,v,s),v})}createUniqueName(t){let e=THREE.PropertyBinding.sanitizeNodeName(t||""),n=e;for(let i=1;this.nodeNamesUsed[n];++i)n=e+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){let e=this,n=this.extensions,i=this.primitiveCache;function s(l){return n[Y.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,e).then(function(u){return $h(u,l,e)})}let o=[];for(let l=0,u=t.length;l<u;l++){let m=t[l],f=_v(m),v=i[f];if(v)o.push(v.promise);else{let A;m.extensions&&m.extensions[Y.KHR_DRACO_MESH_COMPRESSION]?A=s(m):A=$h(new THREE.BufferGeometry,m,e),i[f]={primitive:m,promise:A},o.push(A)}}return Promise.all(o)}loadMesh(t){let e=this,n=this.json,i=this.extensions,s=n.meshes[t],o=s.primitives,l=[];for(let u=0,m=o.length;u<m;u++){let f=o[u].material===void 0?Sv(this.cache):this.getDependency("material",o[u].material);l.push(f)}return l.push(e.loadGeometries(o)),Promise.all(l).then(function(u){let m=u.slice(0,u.length-1),f=u[u.length-1],v=[];for(let T=0,C=f.length;T<C;T++){let I=f[T],P=o[T],B,H=m[T];if(P.mode===$t.TRIANGLES||P.mode===$t.TRIANGLE_STRIP||P.mode===$t.TRIANGLE_FAN||P.mode===void 0)B=s.isSkinnedMesh===!0?new THREE.SkinnedMesh(I,H):new THREE.Mesh(I,H),B.isSkinnedMesh===!0&&!B.geometry.attributes.skinWeight.normalized&&B.normalizeSkinWeights(),P.mode===$t.TRIANGLE_STRIP?B.geometry=Zh(B.geometry,THREE.TriangleStripDrawMode):P.mode===$t.TRIANGLE_FAN&&(B.geometry=Zh(B.geometry,THREE.TriangleFanDrawMode));else if(P.mode===$t.LINES)B=new THREE.LineSegments(I,H);else if(P.mode===$t.LINE_STRIP)B=new THREE.Line(I,H);else if(P.mode===$t.LINE_LOOP)B=new THREE.LineLoop(I,H);else if(P.mode===$t.POINTS)B=new THREE.Points(I,H);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+P.mode);Object.keys(B.geometry.morphAttributes).length>0&&Rv(B,s),B.name=e.createUniqueName(s.name||"mesh_"+t),dn(B,s),P.extensions&&ps(i,B,P),e.assignFinalMaterial(B),v.push(B)}for(let T=0,C=v.length;T<C;T++)e.associations.set(v[T],{meshes:t,primitives:T});if(v.length===1)return v[0];let A=new THREE.Group;e.associations.set(A,{meshes:t});for(let T=0,C=v.length;T<C;T++)A.add(v[T]);return A})}loadCamera(t){let e,n=this.json.cameras[t],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?e=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(e=new THREE.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),dn(e,n),Promise.resolve(e)}loadSkin(t){let e=this.json.skins[t],n={joints:e.joints};return e.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then(function(i){return n.inverseBindMatrices=i,n})}loadAnimation(t){let n=this.json.animations[t],i=[],s=[],o=[],l=[],u=[];for(let m=0,f=n.channels.length;m<f;m++){let v=n.channels[m],A=n.samplers[v.sampler],T=v.target,C=T.node!==void 0?T.node:T.id,I=n.parameters!==void 0?n.parameters[A.input]:A.input,P=n.parameters!==void 0?n.parameters[A.output]:A.output;i.push(this.getDependency("node",C)),s.push(this.getDependency("accessor",I)),o.push(this.getDependency("accessor",P)),l.push(A),u.push(T)}return Promise.all([Promise.all(i),Promise.all(s),Promise.all(o),Promise.all(l),Promise.all(u)]).then(function(m){let f=m[0],v=m[1],A=m[2],T=m[3],C=m[4],I=[];for(let B=0,H=f.length;B<H;B++){let D=f[B],V=v[B],N=A[B],L=T[B],k=C[B];if(D===void 0)continue;D.updateMatrix(),D.matrixAutoUpdate=!0;let Z;switch(Mr[k.path]){case Mr.weights:Z=THREE.NumberKeyframeTrack;break;case Mr.rotation:Z=THREE.QuaternionKeyframeTrack;break;case Mr.position:case Mr.scale:default:Z=THREE.VectorKeyframeTrack;break}let ie=D.name?D.name:D.uuid,X=L.interpolation!==void 0?Tv[L.interpolation]:THREE.InterpolateLinear,se=[];Mr[k.path]===Mr.weights?D.traverse(function(me){me.morphTargetInfluences&&se.push(me.name?me.name:me.uuid)}):se.push(ie);let xe=N.array;if(N.normalized){let me=ou(xe.constructor),J=new Float32Array(xe.length);for(let ze=0,Cn=xe.length;ze<Cn;ze++)J[ze]=xe[ze]*me;xe=J}for(let me=0,J=se.length;me<J;me++){let ze=new Z(se[me]+"."+Mr[k.path],V.array,xe,X);L.interpolation==="CUBICSPLINE"&&(ze.createInterpolant=function(or){let Nt=this instanceof THREE.QuaternionKeyframeTrack?iu:Zt;return new Nt(this.times,this.values,this.getValueSize()/3,or)},ze.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),I.push(ze)}}let P=n.name?n.name:"animation_"+t;return new THREE.AnimationClip(P,void 0,I)})}createNodeMesh(t){let e=this.json,n=this,i=e.nodes[t];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(s){let o=n._getNodeRef(n.meshCache,i.mesh,s);return i.weights!==void 0&&o.traverse(function(l){if(!!l.isMesh)for(let u=0,m=i.weights.length;u<m;u++)l.morphTargetInfluences[u]=i.weights[u]}),o})}loadNode(t){let e=this.json,n=this.extensions,i=this,s=e.nodes[t],o=s.name?i.createUniqueName(s.name):"";return function(){let l=[],u=i._invokeOne(function(m){return m.createNodeMesh&&m.createNodeMesh(t)});return u&&l.push(u),s.camera!==void 0&&l.push(i.getDependency("camera",s.camera).then(function(m){return i._getNodeRef(i.cameraCache,s.camera,m)})),i._invokeAll(function(m){return m.createNodeAttachment&&m.createNodeAttachment(t)}).forEach(function(m){l.push(m)}),Promise.all(l)}().then(function(l){let u;if(s.isBone===!0?u=new THREE.Bone:l.length>1?u=new THREE.Group:l.length===1?u=l[0]:u=new THREE.Object3D,u!==l[0])for(let m=0,f=l.length;m<f;m++)u.add(l[m]);if(s.name&&(u.userData.name=s.name,u.name=o),dn(u,s),s.extensions&&ps(n,u,s),s.matrix!==void 0){let m=new THREE.Matrix4;m.fromArray(s.matrix),u.applyMatrix4(m)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return i.associations.has(u)||i.associations.set(u,{}),i.associations.get(u).nodes=t,u})}loadScene(t){let e=this.json,n=this.extensions,i=this.json.scenes[t],s=this,o=new THREE.Group;i.name&&(o.name=s.createUniqueName(i.name)),dn(o,i),i.extensions&&ps(n,o,i);let l=i.nodes||[],u=[];for(let m=0,f=l.length;m<f;m++)u.push(em(l[m],o,e,s));return Promise.all(u).then(function(){let m=f=>{let v=new Map;for(let[A,T]of s.associations)(A instanceof THREE.Material||A instanceof THREE.Texture)&&v.set(A,T);return f.traverse(A=>{let T=s.associations.get(A);T!=null&&v.set(A,T)}),v};return s.associations=m(o),o})}};function em(r,t,e,n){let i=e.nodes[r];return n.getDependency("node",r).then(function(s){if(i.skin===void 0)return s;let o;return n.getDependency("skin",i.skin).then(function(l){o=l;let u=[];for(let m=0,f=o.joints.length;m<f;m++)u.push(n.getDependency("node",o.joints[m]));return Promise.all(u)}).then(function(l){return s.traverse(function(u){if(!u.isMesh)return;let m=[],f=[];for(let v=0,A=l.length;v<A;v++){let T=l[v];if(T){m.push(T);let C=new THREE.Matrix4;o.inverseBindMatrices!==void 0&&C.fromArray(o.inverseBindMatrices.array,v*16),f.push(C)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[v])}u.bind(new THREE.Skeleton(m,f),u.matrixWorld)}),s})}).then(function(s){t.add(s);let o=[];if(i.children){let l=i.children;for(let u=0,m=l.length;u<m;u++){let f=l[u];o.push(em(f,s,e,n))}}return Promise.all(o)})}function Cv(r,t,e){let n=t.attributes,i=new THREE.Box3;if(n.POSITION!==void 0){let l=e.json.accessors[n.POSITION],u=l.min,m=l.max;if(u!==void 0&&m!==void 0){if(i.set(new THREE.Vector3(u[0],u[1],u[2]),new THREE.Vector3(m[0],m[1],m[2])),l.normalized){let f=ou(ms[l.componentType]);i.min.multiplyScalar(f),i.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let s=t.targets;if(s!==void 0){let l=new THREE.Vector3,u=new THREE.Vector3;for(let m=0,f=s.length;m<f;m++){let v=s[m];if(v.POSITION!==void 0){let A=e.json.accessors[v.POSITION],T=A.min,C=A.max;if(T!==void 0&&C!==void 0){if(u.setX(Math.max(Math.abs(T[0]),Math.abs(C[0]))),u.setY(Math.max(Math.abs(T[1]),Math.abs(C[1]))),u.setZ(Math.max(Math.abs(T[2]),Math.abs(C[2]))),A.normalized){let I=ou(ms[A.componentType]);u.multiplyScalar(I)}l.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(l)}r.boundingBox=i;let o=new THREE.Sphere;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,r.boundingSphere=o}function $h(r,t,e){let n=t.attributes,i=[];function s(o,l){return e.getDependency("accessor",o).then(function(u){r.setAttribute(l,u)})}for(let o in n){let l=su[o]||o.toLowerCase();l in r.attributes||i.push(s(n[o],l))}if(t.indices!==void 0&&!r.index){let o=e.getDependency("accessor",t.indices).then(function(l){r.setIndex(l)});i.push(o)}return dn(r,t),Cv(r,t,e),Promise.all(i).then(function(){return t.targets!==void 0?Mv(r,t.targets,e):r})}function Zh(r,t){let e=r.getIndex();if(e===null){let o=[],l=r.getAttribute("position");if(l!==void 0){for(let u=0;u<l.count;u++)o.push(u);r.setIndex(o),e=r.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}let n=e.count-2,i=[];if(t===THREE.TriangleFanDrawMode)for(let o=1;o<=n;o++)i.push(e.getX(0)),i.push(e.getX(o)),i.push(e.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(i.push(e.getX(o)),i.push(e.getX(o+1)),i.push(e.getX(o+2))):(i.push(e.getX(o+2)),i.push(e.getX(o+1)),i.push(e.getX(o)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let s=r.clone();return s.setIndex(i),s}var he={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function tm(r){let t=await fetch(r);if(t.ok)return t.json();throw new Error(t.statusText)}async function Pv(r){if(!r)throw new Error("No basePath supplied");return await tm(`${r}/profilesList.json`)}async function rm(r,t,e=null,n=!0){if(!r)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");let i=await Pv(t),s;if(r.profiles.some(u=>{let m=i[u];return m&&(s={profileId:u,profilePath:`${t}/${m.path}`,deprecated:!!m.deprecated}),!!s}),!s){if(!e)throw new Error("No matching profile name found");let u=i[e];if(!u)throw new Error(`No matching profile name found and default profile "${e}" missing.`);s={profileId:e,profilePath:`${t}/${u.path}`,deprecated:!!u.deprecated}}let o=await tm(s.profilePath),l;if(n){let u;if(r.handedness==="any"?u=o.layouts[Object.keys(o.layouts)[0]]:u=o.layouts[r.handedness],!u)throw new Error(`No matching handedness, ${r.handedness}, in profile ${s.profileId}`);u.assetPath&&(l=s.profilePath.replace("profile.json",u.assetPath))}return{profile:o,assetPath:l}}var Iv={xAxis:0,yAxis:0,button:0,state:he.ComponentState.DEFAULT};function Lv(r=0,t=0){let e=r,n=t;if(Math.sqrt(r*r+t*t)>1){let o=Math.atan2(t,r);e=Math.cos(o),n=Math.sin(o)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:n*.5+.5}}var lu=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===he.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(Iv)}updateFromComponent({xAxis:t,yAxis:e,button:n,state:i}){let{normalizedXAxis:s,normalizedYAxis:o}=Lv(t,e);switch(this.componentProperty){case he.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?s:.5;break;case he.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?o:.5;break;case he.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case he.ComponentProperty.STATE:this.valueNodeProperty===he.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},cu=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(n=>{let i=new lu(e.visualResponses[n]);this.visualResponses[n]=i}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:he.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=he.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){let e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=he.ComponentState.PRESSED:(e.touched||this.values.button>he.ButtonTouchThreshold)&&(this.values.state=he.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===he.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>he.AxisTouchThreshold&&(this.values.state=he.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===he.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>he.AxisTouchThreshold&&(this.values.state=he.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},Ca=class{constructor(t,e,n){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=n,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{let s=this.layoutDescription.components[i];this.components[i]=new cu(i,s)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};var Dv="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Ov="generic-trigger",uu=class extends THREE.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t?this:(this.envMap=t,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(n=>{let{valueNode:i,minNode:s,maxNode:o,value:l,valueNodeProperty:u}=n;!i||(u===he.VisualResponseProperty.VISIBILITY?i.visible=l:u===he.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(s.quaternion,o.quaternion,l),i.position.lerpVectors(s.position,o.position,l)))})}))}};function Bv(r,t){Object.values(r.components).forEach(e=>{let{type:n,touchPointNodeName:i,visualResponses:s}=e;if(n===he.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(i),e.touchPointNode){let o=new THREE.SphereGeometry(.001),l=new THREE.MeshBasicMaterial({color:255}),u=new THREE.Mesh(o,l);e.touchPointNode.add(u)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(s).forEach(o=>{let{valueNodeName:l,minNodeName:u,maxNodeName:m,valueNodeProperty:f}=o;if(f===he.VisualResponseProperty.TRANSFORM){if(o.minNode=t.getObjectByName(u),o.maxNode=t.getObjectByName(m),!o.minNode){console.warn(`Could not find ${u} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${m} in the model`);return}}o.valueNode=t.getObjectByName(l),o.valueNode||console.warn(`Could not find ${l} in the model`)})})}function nm(r,t){Bv(r.motionController,t),r.envMap&&t.traverse(e=>{e.isMesh&&(e.material.envMap=r.envMap,e.material.needsUpdate=!0)}),r.add(t)}var Pa=class{constructor(t=null){this.gltfLoader=t,this.path=Dv,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Rr)}createControllerModel(t){let e=new uu,n=null;return t.addEventListener("connected",i=>{let s=i.data;s.targetRayMode!=="tracked-pointer"||!s.gamepad||rm(s,this.path,Ov).then(({profile:o,assetPath:l})=>{e.motionController=new Ca(s,o,l);let u=this._assetCache[e.motionController.assetUrl];if(u)n=u.scene.clone(),nm(e,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,m=>{this._assetCache[e.motionController.assetUrl]=m,n=m.scene.clone(),nm(e,n)},null,()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),t.addEventListener("disconnected",()=>{e.motionController=null,e.remove(n),n=null}),e}};var du=new THREE.Matrix4,im=new THREE.Vector3,sm=new THREE.Matrix4().identity(),om=new THREE.Matrix4().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(sm.makeRotationY(Math.PI/2),om.makeRotationY(-Math.PI/2));var pi=class{constructor(t,e,n,i,s){this.controller=e,this.handModel=t,this.envMap=null,this.oculusBrowserV14Correction=i==="left"?om:sm;let o;!s||!s.primitive||s.primitive==="sphere"?o=new THREE.SphereGeometry(1,10,10):s.primitive==="box"?o=new THREE.BoxGeometry(1,1,1):s.primitive==="bone"&&(o=new THREE.CylinderGeometry(.5,.75,2.25,10,1).rotateX(-Math.PI/2));let l=new THREE.MeshStandardMaterial;this.handMesh=new THREE.InstancedMesh(o,l,30),this.handMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){let e=this.controller.joints,n=0;for(let i=0;i<this.joints.length;i++){let s=e[this.joints[i]];s.visible&&(im.setScalar(s.jointRadius||.008),du.compose(s.position,s.quaternion,im),du.multiply(this.oculusBrowserV14Correction),this.handMesh.setMatrixAt(i,du),n++)}this.handMesh.count=n,this.handMesh.instanceMatrix.needsUpdate=!0}};var pu=new THREE.Quaternion().identity(),am=new THREE.Quaternion().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(pu.setFromAxisAngle({x:0,y:1,z:0},Math.PI/2),am.setFromAxisAngle({x:1,y:0,z:0},Math.PI).premultiply(pu));var Fv="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",Ia=class{constructor(t,e,n,i){this.controller=e,this.handModel=t,this.oculusBrowserV14Correction=i==="left"?am:pu,this.bones=[];let s=new Rr;s.setPath(n||Fv),s.load(`${i}.glb`,o=>{let l=o.scene.children[0];this.handModel.add(l);let u=l.getObjectByProperty("type","SkinnedMesh");u.frustumCulled=!1,u.castShadow=!0,u.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(f=>{let v=l.getObjectByName(f);v!==void 0?v.jointName=f:console.warn(`Couldn't find ${f} in ${i} hand mesh`),this.bones.push(v)})})}updateMesh(){let t=this.controller.joints;for(let e=0;e<this.bones.length;e++){let n=this.bones[e];if(n){let i=t[n.jointName];if(i.visible){let s=i.position;n&&(n.position.copy(s),n.quaternion.copy(i.quaternion).multiply(this.oculusBrowserV14Correction))}}}}};var hu=class extends THREE.Object3D{constructor(t){super(),this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&this.motionController.updateMesh()}},La=class{constructor(){this.path=null}setPath(t){return this.path=t,this}createHandModel(t,e){let n=new hu(t);return t.addEventListener("connected",i=>{let s=i.data;s.hand&&!n.motionController&&(n.xrInputSource=s,e===void 0||e==="spheres"?n.motionController=new pi(n,t,this.path,s.handedness,{primitive:"sphere"}):e==="boxes"?n.motionController=new pi(n,t,this.path,s.handedness,{primitive:"box"}):e==="bones"?n.motionController=new pi(n,t,this.path,s.handedness,{primitive:"bone"}):e==="mesh"&&(n.motionController=new Ia(n,t,this.path,s.handedness)))}),t.addEventListener("disconnected",()=>{}),n}};var fs=class{constructor(){this.buttons=0;this.moveDistance=0;this.dragDistance=0;this.x=0;this.y=0;this.dx=0;this.dy=0;this.dz=0;this.u=0;this.v=0;this.du=0;this.dv=0;this.canClick=!1;this.dragging=!1;this.ctrl=!1;this.alt=!1;this.shift=!1;this.meta=!1;Object.seal(this)}copy(t){this.buttons=t.buttons,this.moveDistance=t.moveDistance,this.dragDistance=t.dragDistance,this.x=t.x,this.y=t.y,this.dx=t.dx,this.dy=t.dy,this.dz=t.dz,this.u=t.u,this.v=t.v,this.du=t.du,this.dv=t.dv,this.canClick=t.canClick,this.dragging=t.dragging,this.ctrl=t.ctrl,this.alt=t.alt,this.shift=t.shift,this.meta=t.meta}read(t){this.buttons=t.buttons,this.x=t.offsetX,this.y=t.offsetY,this.dx=t.movementX,this.dy=t.movementY,this.dz=0,this.ctrl=t.ctrlKey,this.alt=t.altKey,this.shift=t.shiftKey,this.meta=t.metaKey}};function lm(r){let t=r.attributes.position,e=r.attributes.normal,n=r.attributes.uv;for(let i=0;i<e.count;++i){let s=i*e.itemSize,o=i*e.itemSize+1,l=i*e.itemSize+2,u=e.array[s],m=e.array[o],f=e.array[l],v=Math.abs(u),A=Math.abs(m),T=Math.abs(f),C=t.array[s],I=t.array[o],P=t.array[l],B=Math.abs(C),H=Math.abs(I),D=Math.abs(P),V=i*n.itemSize,N=i*n.itemSize+1,L=n.array[V],k=n.array[N],Z=0,ie=v,X=B;A>ie&&(Z=1,ie=A,X=H),T>ie&&(Z=2,ie=T,X=D),Z===0?C<0?(L=-P,k=I):(L=P,k=I):Z===1?I<0?(L=C,k=-P):(L=C,k=P):P<0?(L=C,k=I):(L=-C,k=I),L=(L/X+1)/8,k=(k/X+1)/6,Z===0?C<0?(L+=0,k+=1/3):(L+=.5,k+=1/3):Z===1?I<0?(L+=.25,k+=0):(L+=.25,k+=2/3):P<0?(L+=.25,k+=1/3):(L+=.75,k+=1/3);let se=n.array;se[V]=L,se[N]=k}}var gs=new THREE.BoxBufferGeometry(1,1,1,1,1,1);gs.name="CubeGeom";var cm=gs.clone();cm.name="InvertedCubeGeom";lm(cm);var mu=class extends THREE.Mesh{constructor(e,n,i,s,o){super(gs,s);this.isCollider=o;this.scale.set(e,n,i)}},pn=class extends mu{constructor(e,n,i,s){super(e,n,i,s,!1);d(this,"isDraggable",!1)}};var hi=class extends Dt{constructor(){super();d(this,"_currentStyle");d(this,"material");this.material=yt({name:"CursorMat",color:16776960}),this.object=new pn(.01,.01,.01,this.material)}get position(){return this.object.position}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,No(this.object)&&!lt(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new THREE.Color(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new THREE.Color(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new THREE.Color(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new THREE.Color(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new THREE.Color(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new THREE.Color(16776960),this.material.needsUpdate=!0;break}}get visible(){return Jn(this)}set visible(e){Ie(this,e)}};var Da=class extends Dt{constructor(e){super();this.element=e;d(this,"_hidden",!1);this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get position(){throw new Error("BaseCursor::get_Position(): Method not implemented.")}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var _r=class extends Dt{constructor(e){super();this.renderer=e;d(this,"system");d(this,"xr",new hi);this.system=new Da(this.renderer.domElement),this.visible=!1}get object(){return this.xr.object}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get position(){return this.object.position}get style(){return this.system.style}get visible(){return this.renderer.xr.isPresenting&&this.xr.visible||!this.renderer.xr.isPresenting&&this.system.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){Ie(this.xr,this.visible&&(this.renderer.xr.isPresenting||document.pointerLockElement!=null))}lookAt(e){this.xr.lookAt(e)}};var Hv=5,Cr=class{constructor(t,e,n,i){this.type=t;this.name=e;this.evtSys=n;d(this,"_cursor");d(this,"_canMoveView",!1);d(this,"_enabled",!1);d(this,"isActive",!1);d(this,"movementDragThreshold",Hv);d(this,"state",new fs);d(this,"lastState",null);d(this,"origin",new THREE.Vector3);d(this,"direction",new THREE.Vector3);d(this,"curHit",null);d(this,"hoveredHit",null);d(this,"_pressedHit",null);d(this,"draggedHit",null);this._cursor=i,this.enabled=!1,this.canMoveView=!1}get pressedHit(){return this._pressedHit}set pressedHit(t){this._pressedHit=t,sn(t)&&!nn(t)&&this.onDragStart()}get canMoveView(){return this._canMoveView}set canMoveView(t){this._canMoveView=t}vibrate(){}get cursor(){return this._cursor}set cursor(t){if(t!==this.cursor){let e=this.cursor,n=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",i=e&&e.object&&e.object.parent;i&&(we,i.remove(e.object)),t&&(t.object.name=n,e instanceof _r?(e.cursor=t,i&&i.add(e.object)):(this._cursor=t,e&&(i&&i.add(t.object),t.style=e.style,t.visible=e.visible)))}}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.cursor&&(this.cursor.visible=t)}get needsUpdate(){return this.enabled&&this.isActive}recheck(){}setEventState(t){this.evtSys.checkPointer(this,t)}updateCursor(t,e,n){this.cursor&&this.cursor.update(t,e,n,this.canMoveView,this.state,this.origin,this.direction)}lastStateUpdate(t){this.lastState?(this.lastState.copy(this.state),t(),this.state.dragDistance=this.lastState.dragDistance):(t(),this.lastState=new fs,this.lastState.copy(this.state))}onZoom(t){this.lastStateUpdate(()=>this.state.dz=t),this.setEventState("move")}onPointerDown(){this.state.dragging=!1,this.state.canClick=!0,this.setEventState("down")}onPointerMove(){this.setEventState("move"),this.state.buttons!==0&&(F(this.pressedHit)||sn(this.pressedHit))&&(this.lastState.buttons===this.state.buttons?(this.state.dragDistance+=this.state.moveDistance,this.state.dragDistance>this.movementDragThreshold&&this.onDragStart()):this.state.dragging&&(this.state.dragging=!1,this.setEventState("dragcancel")))}onDragStart(){let t=this.state.dragging;this.state.dragging=!0,t||this.setEventState("dragstart"),this.state.canClick=!1,this.setEventState("drag")}onPointerUp(){if(this.state.canClick){let e=this.state.buttons;this.state.buttons=this.lastState.buttons,this.setEventState("click"),this.state.buttons=e}this.setEventState("up"),this.state.dragDistance=0;let t=this.state.dragging;this.state.dragging=!1,t&&this.setEventState("dragend")}};var um=new THREE.Box3,Oa=new THREE.Vector3,hn=class extends THREE.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";let t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(e,2))}applyMatrix4(t){let e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let n=new THREE.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceStart",new THREE.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new THREE.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let n=new THREE.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceColorStart",new THREE.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new THREE.InterleavedBufferAttribute(n,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new THREE.WireframeGeometry(t.geometry)),this}fromLineSegments(t){let e=t.geometry;if(e.isGeometry){console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),um.setFromBufferAttribute(e),this.boundingBox.union(um))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere),this.boundingBox===null&&this.computeBoundingBox();let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){let n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let s=0,o=t.count;s<o;s++)Oa.fromBufferAttribute(t,s),i=Math.max(i,n.distanceToSquared(Oa)),Oa.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(Oa));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}};hn.prototype.isLineSegmentsGeometry=!0;var dm=new THREE.Vector3,pm=new THREE.Vector3,Fe=new THREE.Vector4,He=new THREE.Vector4,Ot=new THREE.Vector4,fu=new THREE.Vector3,gu=new THREE.Matrix4,pt=new THREE.Line3,hm=new THREE.Vector3,Jt=new THREE.Box3,Ba=new THREE.Sphere,Bt=new THREE.Vector4;function mm(r,t,e,n){return Bt.set(0,0,-t,1).applyMatrix4(r.projectionMatrix),Bt.multiplyScalar(1/Bt.w),Bt.x=e/n.width,Bt.y=e/n.height,Bt.applyMatrix4(r.projectionMatrixInverse),Bt.multiplyScalar(1/Bt.w),Math.abs(Math.max(Bt.x,Bt.y))}var vs=class extends THREE.Mesh{constructor(t=new hn,e=new Xt({color:Math.random()*16777215})){super(t,e),this.type="LineSegments2"}computeLineDistances(){let t=this.geometry,e=t.attributes.instanceStart,n=t.attributes.instanceEnd,i=new Float32Array(2*e.count);for(let o=0,l=0,u=e.count;o<u;o++,l+=2)dm.fromBufferAttribute(e,o),pm.fromBufferAttribute(n,o),i[l]=l===0?0:i[l-1],i[l+1]=i[l]+dm.distanceTo(pm);let s=new THREE.InstancedInterleavedBuffer(i,2,1);return t.setAttribute("instanceDistanceStart",new THREE.InterleavedBufferAttribute(s,1,0)),t.setAttribute("instanceDistanceEnd",new THREE.InterleavedBufferAttribute(s,1,1)),this}raycast(t,e){t.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let n=t.params.Line2!==void 0&&t.params.Line2.threshold||0,i=t.ray,s=t.camera,o=s.projectionMatrix,l=this.matrixWorld,u=this.geometry,m=this.material,f=m.resolution,v=m.linewidth+n,A=u.attributes.instanceStart,T=u.attributes.instanceEnd,C=-s.near;u.boundingSphere===null&&u.computeBoundingSphere(),Ba.copy(u.boundingSphere).applyMatrix4(l);let I=Math.max(s.near,Ba.distanceToPoint(i.origin)),P=mm(s,I,v,f);if(Ba.radius+=P,t.ray.intersectsSphere(Ba)===!1)return;u.boundingBox===null&&u.computeBoundingBox(),Jt.copy(u.boundingBox).applyMatrix4(l);let B=Math.max(s.near,Jt.distanceToPoint(i.origin)),H=mm(s,B,v,f);if(Jt.max.x+=H,Jt.max.y+=H,Jt.max.z+=H,Jt.min.x-=H,Jt.min.y-=H,Jt.min.z-=H,t.ray.intersectsBox(Jt)!==!1){i.at(1,Ot),Ot.w=1,Ot.applyMatrix4(s.matrixWorldInverse),Ot.applyMatrix4(o),Ot.multiplyScalar(1/Ot.w),Ot.x*=f.x/2,Ot.y*=f.y/2,Ot.z=0,fu.copy(Ot),gu.multiplyMatrices(s.matrixWorldInverse,l);for(let V=0,N=A.count;V<N;V++){Fe.fromBufferAttribute(A,V),He.fromBufferAttribute(T,V),Fe.w=1,He.w=1,Fe.applyMatrix4(gu),He.applyMatrix4(gu);var D=Fe.z>C&&He.z>C;if(D)continue;if(Fe.z>C){let X=Fe.z-He.z,se=(Fe.z-C)/X;Fe.lerp(He,se)}else if(He.z>C){let X=He.z-Fe.z,se=(He.z-C)/X;He.lerp(Fe,se)}Fe.applyMatrix4(o),He.applyMatrix4(o),Fe.multiplyScalar(1/Fe.w),He.multiplyScalar(1/He.w),Fe.x*=f.x/2,Fe.y*=f.y/2,He.x*=f.x/2,He.y*=f.y/2,pt.start.copy(Fe),pt.start.z=0,pt.end.copy(He),pt.end.z=0;let L=pt.closestPointToPointParameter(fu,!0);pt.at(L,hm);let k=THREE.MathUtils.lerp(Fe.z,He.z,L),Z=k>=-1&&k<=1,ie=fu.distanceTo(hm)<v*.5;if(Z&&ie){pt.start.fromBufferAttribute(A,V),pt.end.fromBufferAttribute(T,V),pt.start.applyMatrix4(l),pt.end.applyMatrix4(l);let X=new THREE.Vector3,se=new THREE.Vector3;i.distanceSqToSegment(pt.start,pt.end,se,X),e.push({point:se,pointOnLine:X,distance:i.origin.distanceTo(se),object:this,face:null,faceIndex:V,uv:null,uv2:null})}}}}};vs.prototype.isLineSegments2=!0;var mn=class extends hn{constructor(){super(),this.type="LineGeometry"}setPositions(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return super.setPositions(n),this}setColors(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return super.setColors(n),this}fromLine(t){var e=t.geometry;if(e.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}};mn.prototype.isLineGeometry=!0;var Es=class extends vs{constructor(t=new mn,e=new Xt({color:Math.random()*16777215})){super(t,e),this.type="Line2"}};Es.prototype.isLine2=!0;var fm=new mn;fm.setPositions([0,0,0,0,0,-1]);var Fa=class extends THREE.Object3D{constructor(e,n=1){super();d(this,"line");d(this,"_length",1);this.line=new Es(fm,ih({color:e,linewidth:n})),this.line.computeLineDistances(),this.add(this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var Nv=new Pa,Vv=new La,Uv=new THREE.Matrix4().makeRotationX(-7*Math.PI/9),gm=new THREE.Vector3,vm=new THREE.Vector3,vu=new THREE.Vector3,Eu=new gt([["left",1,0],["left",2,1],["left",3,2],["left",4,3],["right",1,0],["right",2,1],["right",3,2],["right",4,3]]),Em=new Map([["none",15],["left",16],["right",17]]),Ha=class extends Cr{constructor(e,n,i){super("hand",15,e,new hi);this.renderer=n;d(this,"laser",new Fa(ti,.002));d(this,"object",new THREE.Object3D);d(this,"_handedness","none");d(this,"_isHand",!1);d(this,"inputSource",null);d(this,"_gamepad",null);d(this,"controller");d(this,"grip");d(this,"hand");d(this,"onAxisMaxed");d(this,"useHaptics",!0);if(this.object.add(this.controller=this.renderer.xr.getController(i),this.grip=this.renderer.xr.getControllerGrip(i),this.hand=this.renderer.xr.getHand(i)),Ln()&&ad()&&!Ut){let l=!1;this.controller.traverse(u=>{u.name.toLocaleLowerCase().indexOf("oculus")>=0&&(l=!0)}),l&&this.laser.matrix.copy(Uv)}this.controller.add(this.laser),this.grip.add(Nv.createControllerModel(this.controller)),this.hand.add(Vv.createHandModel(this.hand,"mesh")),this.onAxisMaxed=l=>{l.axis===2&&this.evtSys.onFlick(l.value)},this.controller.addEventListener("connected",()=>{let l=this.renderer.xr.getSession();this.inputSource=l.inputSources[i],this.setGamepad(this.inputSource.gamepad),this._isHand=x(this.inputSource.hand),this._handedness=this.inputSource.handedness,this.name=Em.get(this.handedness),this.updateCursorSide(),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this.isActive=!0,this.evtSys.onConnected(this)}),this.controller.addEventListener("disconnected",()=>{this.inputSource=null,this.setGamepad(null),this._isHand=!1,this._handedness="none",this.name=Em.get(this.handedness),this.updateCursorSide(),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this.isActive=!1,this.evtSys.onDisconnected(this),this.isActive=!1});let s=l=>{this.updateState(),this.state.buttons=this.state.buttons|l,this.onPointerDown()},o=l=>{this.updateState(),this.state.buttons=this.state.buttons&~l,this.onPointerUp()};this.controller.addEventListener("selectstart",()=>s(1)),this.controller.addEventListener("selectend",()=>o(1)),this.controller.addEventListener("squeezestart",()=>s(2)),this.controller.addEventListener("squeezeend",()=>o(2))}vibrate(){this._vibrate()}async _vibrate(){if(this._gamepad&&this.useHaptics)try{await Promise.all(this._gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}setGamepad(e){x(this._gamepad)&&F(e)&&(this._gamepad.clearEventListeners(),this._gamepad=null),x(e)&&(x(this._gamepad)?this._gamepad.setPad(e):(this._gamepad=new _a(e),this._gamepad.addEventListener("gamepadaxismaxed",this.onAxisMaxed)))}get gamepad(){return this._gamepad}get gamepadId(){return this._gamepad&&this._gamepad.id}get handedness(){return this._handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){let e=this.cursor.object;if(e){let n=this.handedness==="left"?-1:1;e.scale.set(n,1,1)}}update(){this.enabled&&(this.updateState(),this.onPointerMove())}updateState(){this.lastStateUpdate(()=>{this.laser.getWorldPosition(gm),this.laser.getWorldDirection(vm).multiplyScalar(-1),vu.copy(this.origin).add(this.direction),this.origin.lerp(gm,.9),this.direction.lerp(vm,.9).normalize(),vu.sub(this.origin).sub(this.direction),this.state.moveDistance+=.001*vu.length(),x(this._gamepad)&&x(this.inputSource)&&this.setGamepad(this.inputSource.gamepad)})}isPressed(e){if(!this._gamepad||!Eu.has(this.handedness)||!Eu.get(this.handedness).has(e))return!1;let n=Eu.get(this.handedness).get(e);return this._gamepad.buttons[n].pressed}};var Pr=class extends Cr{constructor(e,n,i,s,o,l){super(e,n,i,l);this.renderer=s;this.camera=o;d(this,"id",null);d(this,"element");d(this,"moveOnUpdate",!1);let u=v=>{this.checkEvent(v)&&(this.readEvent(v),this.onPointerDown())};this.element=this.renderer.domElement,this.element.addEventListener("pointerdown",u);let m=v=>{this.checkEvent(v)&&(this.readEvent(v),this.onPointerMove())};this.element.addEventListener("pointermove",m);let f=v=>{this.checkEvent(v)&&(this.readEvent(v),this.onPointerUp())};this.element.addEventListener("pointerup",f)}get isTracking(){return this.id!=null}checkEvent(e){return e.pointerType===this.type&&e.pointerId===this.id}readEvent(e){if(this.checkEvent(e)){if(this.lastStateUpdate(()=>this.state.read(e)),e.type==="pointermove")if(document.pointerLockElement){let{x:n,y:i}=this.state;this.state.x=et(this.lastState.x+this.state.dx,0,this.element.clientWidth),this.state.y=et(this.lastState.y+this.state.dy,0,this.element.clientHeight),this.state.dx=this.state.x-n,this.state.dy=this.state.y-i}else this.state.dx=this.state.x-this.lastState.x,this.state.dy=this.state.y-this.lastState.y;this.state.moveDistance=Math.sqrt(this.state.dx*this.state.dx+this.state.dy*this.state.dy),this.state.u=Js(Zs(this.state.x,0,this.element.clientWidth),-1,1),this.state.v=Js(Zs(this.state.y,0,this.element.clientHeight),-1,1),this.state.du=2*this.state.dx/this.element.clientWidth,this.state.dv=2*this.state.dy/this.element.clientHeight}}recheck(){this.moveOnUpdate=!0,super.recheck()}update(){let e=Sr(this.renderer,this.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.state.u,-this.state.v,.5).unproject(e).sub(this.origin).normalize(),this.moveOnUpdate&&this.onPointerMove()}onPointerMove(){this.moveOnUpdate=!1,super.onPointerMove()}isPressed(e){let n=1<<e;return this.state.buttons===n}};var ka=class extends Pr{constructor(e,n,i){let s=u=>{u.pointerType==="mouse"&&this.id==null&&(this.id=u.pointerId)},o=u=>{u.pointerType==="mouse"&&this.id!=null&&(this.id=null)},l=n.domElement;l.addEventListener("pointerdown",s),l.addEventListener("pointermove",s);super("mouse",1,e,n,i,new _r(n));d(this,"allowPointerLock");this.element.addEventListener("wheel",u=>{u.preventDefault();let m=-u.deltaY*.5;this.onZoom(m)},{passive:!1}),this.element.addEventListener("contextmenu",u=>{u.preventDefault()}),this.element.addEventListener("pointerup",o),this.element.addEventListener("pointercancel",o),this.allowPointerLock=!1,this.element.addEventListener("click",()=>{this.allowPointerLock&&!this.isPointerLocked&&this.lockPointer()}),this.canMoveView=!0,Object.seal(this)}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}get isPointerLocked(){return document.pointerLockElement!=null}};var fn=new Array,zv=r=>{if(r.pointerType==="touch"){let t=Va(),e=Je(fn,n=>n.id===r.pointerId);e||(e=Je(fn,n=>n.id==null),e.id=r.pointerId,e.state.buttons=1<<t)}},Gv=r=>{if(r.pointerType==="touch"){let t=Je(fn,e=>e.id===r.pointerId);t&&(t.id=null)}};function Va(){let r=0;for(let t of fn)t.isTracking&&++r;return r}var jv=new Map([[0,3],[1,4],[2,5],[3,6],[4,7],[5,8],[6,9],[7,10],[8,11],[9,12],[10,13]]),Na=class extends Pr{constructor(e,n,i,s,o){fn.length===0&&n.domElement.addEventListener("pointerdown",zv);super("touch",jv.get(i),e,n,s,null);d(this,"parent",null);fn.length===0&&n.domElement.addEventListener("pointerup",Gv),this.parent=o,this.canMoveView=!0,Object.seal(this),fn.push(this)}setEventState(e){super.setEventState(e),this.parent&&(e==="down"?this.parent.onDown():e==="up"?this.parent.onUp():e==="move"&&this.parent.onMove())}readEvent(e){if(this.checkEvent(e)){let n=this.state.buttons;super.readEvent(e),this.state.buttons=n}}};function Wv(r,t){let e=t.x-r.x,n=t.y-r.y;return Math.sqrt(e*e+n*n)}var Ua=class extends Cr{constructor(e,n,i){super("touch",14,e,null);this.renderer=n;this.camera=i;d(this,"touches",new Array(10));d(this,"lastPinchDist",0);d(this,"lastPressCount",0);for(let s=0;s<this.touches.length;++s)this.touches[s]=new Na(e,n,s,i,this);this.canMoveView=!0,Object.seal(this)}onDown(){this.updateState(),this.onPointerDown()}onUp(){this.updateState(),this.onPointerUp()}onMove(){this.updateState(),this.onPointerMove();let e=Va();if(e===2){let n=null,i=null;for(let l of this.touches)if(l.isTracking){if(!n)n=l;else if(!i){i=l;break}}let s=Wv(n.state,i.state),o=(s-this.lastPinchDist)*2.5;this.lastPressCount===2&&this.onZoom(o),this.lastPinchDist=s}this.lastPressCount=e}vibrate(){navigator.vibrate(125)}updateState(){this.lastStateUpdate(()=>{this.state.buttons=0,this.state.alt=!1,this.state.ctrl=!1,this.state.shift=!1,this.state.meta=!1,this.state.canClick=!1,this.state.dragging=!1,this.state.dragDistance=0,this.state.moveDistance=0,this.state.x=0,this.state.y=0,this.state.dx=0,this.state.dy=0,this.state.u=0,this.state.v=0,this.state.du=0,this.state.dv=0;let e=1/Va();for(let n of this.touches)n.isTracking&&(this.state.buttons=Math.max(this.state.buttons,n.state.buttons),this.state.alt=this.state.alt||n.state.alt,this.state.ctrl=this.state.ctrl||n.state.ctrl,this.state.shift=this.state.shift||n.state.shift,this.state.meta=this.state.meta||n.state.meta,this.state.canClick=this.state.canClick||n.state.canClick,this.state.dragging=this.state.dragging||n.state.dragging,this.state.dragDistance+=e*n.state.dragDistance,this.state.moveDistance+=e*n.state.moveDistance,this.state.x+=e*n.state.x,this.state.y+=e*n.state.y,this.state.dx+=e*n.state.dx,this.state.dy+=e*n.state.dy,this.state.u+=e*n.state.u,this.state.v+=e*n.state.v,this.state.du+=e*n.state.du,this.state.dv+=e*n.state.dv)})}get canMoveView(){return super.canMoveView}set canMoveView(e){if(this.touches){for(let n of this.touches)n.canMoveView=e;super.canMoveView=e}}get enabled(){return super.enabled}set enabled(e){if(this.touches)for(let n of this.touches)n.enabled=e;super.enabled=e}update(){let e=Sr(this.renderer,this.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.state.u,-this.state.v,.5).unproject(e).sub(this.origin).normalize()}isPressed(e){for(let n of this.touches)if(n.isPressed(e))return!0;return!1}};var za=class extends Pr{constructor(t,e,n){let i=l=>{l.pointerType==="pen"&&this.id==null&&(this.id=l.pointerId)},s=l=>{l.pointerType==="pen"&&this.id!=null&&(this.id=null)},o=e.domElement;o.addEventListener("pointerdown",i),o.addEventListener("pointermove",i),super("pen",2,t,e,n,new _r(e)),o.addEventListener("pointerup",s),o.addEventListener("pointercancel",s),this.canMoveView=!0,Object.seal(this)}};function xu(r,t){x(r)&&r.point.copy(t.direction).multiplyScalar(r.distance).add(t.origin)}var Ga=class extends te{constructor(e){super();this.env=e;d(this,"raycaster",new THREE.Raycaster);d(this,"mouse");d(this,"pen");d(this,"touches");d(this,"hands",new Array);d(this,"pointers");d(this,"localPointerMovedEvt",new Ma);d(this,"hits",new Array);d(this,"infoPressed",!1);d(this,"menuPressed",!1);d(this,"pointerEvents",new Map);this.raycaster.camera=this.env.camera,this.raycaster.layers.set(Sa),this.mouse=new ka(this,this.env.renderer,this.env.camera),this.pen=new za(this,this.env.renderer,this.env.camera),this.touches=new Ua(this,this.env.renderer,this.env.camera);for(let n=0;n<2;++n)this.hands[n]=new Ha(this,this.env.renderer,n);this.pointers=[this.mouse,this.pen,this.touches,...this.hands];for(let n of this.pointers)n.cursor&&we(this.env.stage,n.cursor);window.addEventListener("keydown",n=>{let i=xa(n);n.key==="/"&&(this.infoPressed=i),n.key==="ContextMenu"&&(this.menuPressed=i)}),window.addEventListener("keyup",n=>{n.key==="/"&&(this.infoPressed=!1),n.key==="ContextMenu"&&(this.menuPressed=!1)}),this.env.avatar.evtSys=this,this.checkXRMouse()}onFlick(e){this.env.avatar.onFlick(e)}onConnected(e){this.checkXRMouse()}onDisconnected(e){this.checkXRMouse()}checkXRMouse(){let e=0;for(let i of this.hands.values())i.enabled&&++e;let n=e===0;this.mouse.enabled=n,this.pen.enabled=n,this.touches.enabled=n}checkPointer(e,n){e.isActive=!0,this.fireRay(e);let{curHit:i,hoveredHit:s,pressedHit:o,draggedHit:l}=e,u=ut(i),m=ut(s),f=ut(o),v=ut(l);switch((n==="move"||n==="drag")&&(xu(s,e),xu(o,e),xu(l,e)),n){case"move":{let A=this.getEvent(e,"move",i);this.env.avatar.onMove(A),this.env.cameraControl.onMove(A),x(l)?v.dispatchEvent(A.to3(l)):x(o)?f.dispatchEvent(A.to3(o)):e.state.buttons===0&&(this.checkExit(i,s,e),this.checkEnter(i,s,e),u&&u.dispatchEvent(A.to3(i))),this.localPointerMovedEvt.name=e.name,this.localPointerMovedEvt.set(e.origin.x,e.origin.y,e.origin.z,e.direction.x,e.direction.y,e.direction.z,0,1,0),this.dispatchEvent(this.localPointerMovedEvt)}break;case"down":{let A=this.getEvent(e,"down",i);this.env.avatar.onDown(A),(nn(s)||sn(s))&&(e.pressedHit=s,m.dispatchEvent(A.to3(s)))}break;case"up":{let A=this.getEvent(e,"up",i);this.dispatchEvent(A),e.state.buttons===0&&(x(o)&&(e.pressedHit=null,f.dispatchEvent(A.to3(o))),this.checkExit(i,s,e),this.checkEnter(i,s,e))}break;case"click":{let A=this.getEvent(e,"click",i);this.dispatchEvent(A),nn(i)&&(e.vibrate(),u.dispatchEvent(A.to3(i)))}break;case"dragstart":{let A=this.getEvent(e,"dragstart",o||i);this.dispatchEvent(A),x(o)&&(e.draggedHit=o,f.dispatchEvent(A.to3(o)))}break;case"drag":{let A=this.getEvent(e,"drag",l||i);this.dispatchEvent(A),x(l)&&v.dispatchEvent(A.to3(l))}break;case"dragcancel":{let A=this.getEvent(e,"dragcancel",l||i);this.dispatchEvent(A),x(l)&&(e.draggedHit=null,v.dispatchEvent(A.to3(l)))}break;case"dragend":{let A=this.getEvent(e,"dragend",l||i);this.dispatchEvent(A),x(l)&&(e.draggedHit=null,v.dispatchEvent(A.to3(l)))}break;default:zt(n)}e.updateCursor(this.env.avatar.worldPos,l||o||s||i,2)}getEvent(e,n,i){if(!this.pointerEvents.has(e)){let l=new Map([["move",new dt("move",e)],["enter",new dt("enter",e)],["exit",new dt("exit",e)],["up",new dt("up",e)],["down",new dt("down",e)],["click",new dt("click",e)],["dragstart",new dt("dragstart",e)],["drag",new dt("drag",e)],["dragend",new dt("dragend",e)]]);this.pointerEvents.set(e,l)}let o=this.pointerEvents.get(e).get(n);return o.hit=i,o}checkExit(e,n,i){let s=ut(e),o=ut(n);if(s!==o&&x(o)){i.hoveredHit=null;let l=this.getEvent(i,"exit",n);this.dispatchEvent(l),o.dispatchEvent(l.to3(n))}}checkEnter(e,n,i){let s=ut(e),o=ut(n);if(s!==o&&x(e)){i.hoveredHit=e;let l=this.getEvent(i,"enter",e);this.dispatchEvent(l),s.dispatchEvent(l.to3(e))}}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e){be(this.hits),this.raycaster.ray.origin.copy(e.origin),this.raycaster.ray.direction.copy(e.direction),this.raycaster.intersectObject(this.env.scene,!0,this.hits),e.curHit=null;let n=Number.MAX_VALUE;for(let i of this.hits)rs(i)&&hh(i)&&i.distance<n&&(e.curHit=i,n=i.distance);e.curHit&&e.hoveredHit&&e.curHit.object===e.hoveredHit.object&&(e.hoveredHit=e.curHit)}update(){for(let e of this.pointers)e.needsUpdate&&e.update()}recheckPointers(){for(let e of this.pointers)e.needsUpdate&&e.recheck()}isPressed(e){for(let n of this.pointers)if(n.isPressed(e))return!0;return e===3&&this.menuPressed||e===4&&this.infoPressed}};var Xv=new G("fadecomplete"),ja=class extends te{constructor(e,n=.15){super();d(this,"opacity",1);d(this,"direction",0);d(this,"speed");d(this,"object");d(this,"material");this.material=tn({name:"FaderMaterial",color:0,side:THREE.BackSide}),this.object=new THREE.Mesh(gs,this.material),this.object.name=e,this.object.renderOrder=Number.MAX_VALUE,this.speed=1/n,this.object.layers.enableAll()}async fadeOut(){this.direction!=1&&(this.direction=1,await De(this,"fadecomplete"))}async fadeIn(){this.direction!=-1&&(this.direction=-1,await De(this,"fadecomplete"))}update(e){if(this.direction!==0){let n=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=n),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=et(this.opacity,0,1),this.direction=0,this.dispatchEvent(Xv))}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};function ht(r,t,e,n,i,s){let o=new pn(n,i,s,oh);return o.position.set(r,t,e),o}var Qv=.1,Wa=class extends ur{constructor(){super();d(this,"valueBar");d(this,"value",0);d(this,"targetValue",0);d(this,"object",new THREE.Object3D);d(this,"_enabled",!0);this.valueBar=new pn(0,1,1,sh),this.valueBar.scale.set(0,1,1);let e=new THREE.Object3D;e.scale.set(1,.1,.1),we(this,we(e,this.valueBar),ht(-.5,0,-.05,.01,.1,.01),ht(-.5,0,.05,.01,.1,.01),ht(.5,0,-.05,.01,.1,.01),ht(.5,0,.05,.01,.1,.01),ht(-.5,-.05,0,.01,.01,.1),ht(.5,-.05,0,.01,.01,.1),ht(-.5,.05,0,.01,.01,.1),ht(.5,.05,0,.01,.01,.1),ht(0,-.05,-.05,1,.01,.01),ht(0,.05,-.05,1,.01,.01),ht(0,-.05,.05,1,.01,.01),ht(0,.05,.05,1,.01,.01)),Gh(this,ui)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,Ie(this,Jn(this)||this.enabled))}report(e,n,i){super.report(e,n,i),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+Qv*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,Ie(this,this.enabled&&this.value>0))}};if(!bu()){let r=Element.prototype,t=Document.prototype;"webkitRequestFullscreen"in r?(r.requestFullscreen=r.webkitRequestFullscreen,t.exitFullscreen=t.webkitRequestFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in r?(r.requestFullscreen=r.mozRequestFullScreen,t.exitFullscreen=t.mozCancelFullScreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in r&&(r.requestFullscreen=r.msRequestFullscreen,t.exitFullscreen=t.msExitFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function bu(){return"requestFullscreen"in HTMLElement.prototype}var Kv=typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{},Xa=Kv;var xs=Symbol("@@webxr-polyfill/EventTarget"),er=class{constructor(){this[xs]={listeners:new Map}}addEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let n=this[xs].listeners.get(t)||[];n.push(e),this[xs].listeners.set(t,n)}removeEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let n=this[xs].listeners.get(t)||[];for(let i=n.length;i>=0;i--)n[i]===e&&n.pop()}dispatchEvent(t,e){let n=this[xs].listeners.get(t)||[],i=[];for(let s=0;s<n.length;s++)i[s]=n[s];for(let s of i)s(e);typeof this[`on${t}`]=="function"&&this[`on${t}`](e)}};var Ce=typeof Float32Array!="undefined"?Float32Array:Array;var JP=Math.PI/180;function Ft(){let r=new Ce(16);return Ce!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function xm(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Ir(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function gn(r,t){let e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],l=t[5],u=t[6],m=t[7],f=t[8],v=t[9],A=t[10],T=t[11],C=t[12],I=t[13],P=t[14],B=t[15],H=e*l-n*o,D=e*u-i*o,V=e*m-s*o,N=n*u-i*l,L=n*m-s*l,k=i*m-s*u,Z=f*I-v*C,ie=f*P-A*C,X=f*B-T*C,se=v*P-A*I,xe=v*B-T*I,me=A*B-T*P,J=H*me-D*xe+V*se+N*X-L*ie+k*Z;return J?(J=1/J,r[0]=(l*me-u*xe+m*se)*J,r[1]=(i*xe-n*me-s*se)*J,r[2]=(I*k-P*L+B*N)*J,r[3]=(A*L-v*k-T*N)*J,r[4]=(u*X-o*me-m*ie)*J,r[5]=(e*me-i*X+s*ie)*J,r[6]=(P*V-C*k-B*D)*J,r[7]=(f*k-A*V+T*D)*J,r[8]=(o*xe-l*X+m*Z)*J,r[9]=(n*X-e*xe-s*Z)*J,r[10]=(C*L-I*V+B*H)*J,r[11]=(v*V-f*L-T*H)*J,r[12]=(l*ie-o*se-u*Z)*J,r[13]=(e*se-n*ie+i*Z)*J,r[14]=(I*D-C*N-P*H)*J,r[15]=(f*N-v*D+A*H)*J,r):null}function tr(r,t,e){let n=t[0],i=t[1],s=t[2],o=t[3],l=t[4],u=t[5],m=t[6],f=t[7],v=t[8],A=t[9],T=t[10],C=t[11],I=t[12],P=t[13],B=t[14],H=t[15],D=e[0],V=e[1],N=e[2],L=e[3];return r[0]=D*n+V*l+N*v+L*I,r[1]=D*i+V*u+N*A+L*P,r[2]=D*s+V*m+N*T+L*B,r[3]=D*o+V*f+N*C+L*H,D=e[4],V=e[5],N=e[6],L=e[7],r[4]=D*n+V*l+N*v+L*I,r[5]=D*i+V*u+N*A+L*P,r[6]=D*s+V*m+N*T+L*B,r[7]=D*o+V*f+N*C+L*H,D=e[8],V=e[9],N=e[10],L=e[11],r[8]=D*n+V*l+N*v+L*I,r[9]=D*i+V*u+N*A+L*P,r[10]=D*s+V*m+N*T+L*B,r[11]=D*o+V*f+N*C+L*H,D=e[12],V=e[13],N=e[14],L=e[15],r[12]=D*n+V*l+N*v+L*I,r[13]=D*i+V*u+N*A+L*P,r[14]=D*s+V*m+N*T+L*B,r[15]=D*o+V*f+N*C+L*H,r}function Lr(r,t,e){let n=t[0],i=t[1],s=t[2],o=t[3],l=n+n,u=i+i,m=s+s,f=n*l,v=n*u,A=n*m,T=i*u,C=i*m,I=s*m,P=o*l,B=o*u,H=o*m;return r[0]=1-(T+I),r[1]=v+H,r[2]=A-B,r[3]=0,r[4]=v-H,r[5]=1-(f+I),r[6]=C+P,r[7]=0,r[8]=A+B,r[9]=C-P,r[10]=1-(f+T),r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function Qa(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function Ka(r,t){let e=t[0]+t[5]+t[10],n=0;return e>0?(n=Math.sqrt(e+1)*2,r[3]=.25*n,r[0]=(t[6]-t[9])/n,r[1]=(t[8]-t[2])/n,r[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=Math.sqrt(1+t[0]-t[5]-t[10])*2,r[3]=(t[6]-t[9])/n,r[0]=.25*n,r[1]=(t[1]+t[4])/n,r[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=Math.sqrt(1+t[5]-t[0]-t[10])*2,r[3]=(t[8]-t[2])/n,r[0]=(t[1]+t[4])/n,r[1]=.25*n,r[2]=(t[6]+t[9])/n):(n=Math.sqrt(1+t[10]-t[0]-t[5])*2,r[3]=(t[1]-t[4])/n,r[0]=(t[8]+t[2])/n,r[1]=(t[6]+t[9])/n,r[2]=.25*n),r}function Ya(r,t,e,n,i){let s=1/Math.tan(t/2),o;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(o=1/(n-i),r[10]=(i+n)*o,r[14]=2*i*n*o):(r[10]=-1,r[14]=-2*n),r}function rt(){let r=new Ce(3);return Ce!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Au(r){var t=new Ce(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function Yv(r){let t=r[0],e=r[1],n=r[2];return Math.sqrt(t*t+e*e+n*n)}function Ke(r,t,e){let n=new Ce(3);return n[0]=r,n[1]=t,n[2]=e,n}function yu(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function mi(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function wu(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function qa(r,t){let e=t[0],n=t[1],i=t[2],s=e*e+n*n+i*i;return s>0&&(s=1/Math.sqrt(s),r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s),r}function ys(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function $a(r,t,e){let n=t[0],i=t[1],s=t[2],o=e[0],l=e[1],u=e[2];return r[0]=i*u-s*l,r[1]=s*o-n*u,r[2]=n*l-i*o,r}function En(r,t,e){let n=e[0],i=e[1],s=e[2],o=e[3],l=t[0],u=t[1],m=t[2],f=i*m-s*u,v=s*l-n*m,A=n*u-i*l,T=i*A-s*v,C=s*f-n*A,I=n*v-i*f,P=o*2;return f*=P,v*=P,A*=P,T*=2,C*=2,I*=2,r[0]=l+f+T,r[1]=u+v+C,r[2]=m+A+I,r}function Am(r,t){let e=Ke(r[0],r[1],r[2]),n=Ke(t[0],t[1],t[2]);qa(e,e),qa(n,n);let i=ys(e,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}var ym=Yv;var e4=function(){let r=rt();return function(t,e,n,i,s,o){let l,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,t.length):u=t.length,l=n;l<u;l+=e)r[0]=t[l],r[1]=t[l+1],r[2]=t[l+2],s(r,r,o),t[l]=r[0],t[l+1]=r[1],t[l+2]=r[2];return t}}();function wm(){let r=new Ce(9);return Ce!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function $v(){let r=new Ce(4);return Ce!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Tm(r){let t=new Ce(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function Sm(r,t,e,n){let i=new Ce(4);return i[0]=r,i[1]=t,i[2]=e,i[3]=n,i}function Mm(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function Rm(r,t){let e=t[0],n=t[1],i=t[2],s=t[3],o=e*e+n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),r[0]=e*o,r[1]=n*o,r[2]=i*o,r[3]=s*o),r}var t4=function(){let r=$v();return function(t,e,n,i,s,o){let l,u;for(e||(e=4),n||(n=0),i?u=Math.min(i*e+n,t.length):u=t.length,l=n;l<u;l+=e)r[0]=t[l],r[1]=t[l+1],r[2]=t[l+2],r[3]=t[l+3],s(r,r,o),t[l]=r[0],t[l+1]=r[1],t[l+2]=r[2],t[l+3]=r[3];return t}}();function nt(){let r=new Ce(4);return Ce!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Jv(r,t,e){e=e*.5;let n=Math.sin(e);return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=Math.cos(e),r}function Tu(r,t,e){let n=t[0],i=t[1],s=t[2],o=t[3],l=e[0],u=e[1],m=e[2],f=e[3];return r[0]=n*f+o*l+i*m-s*u,r[1]=i*f+o*u+s*l-n*m,r[2]=s*f+o*m+n*u-i*l,r[3]=o*f-n*l-i*u-s*m,r}function fi(r,t,e,n){let i=t[0],s=t[1],o=t[2],l=t[3],u=e[0],m=e[1],f=e[2],v=e[3],A,T,C,I,P;return T=i*u+s*m+o*f+l*v,T<0&&(T=-T,u=-u,m=-m,f=-f,v=-v),1-T>1e-6?(A=Math.acos(T),C=Math.sin(A),I=Math.sin((1-n)*A)/C,P=Math.sin(n*A)/C):(I=1-n,P=n),r[0]=I*i+P*u,r[1]=I*s+P*m,r[2]=I*o+P*f,r[3]=I*l+P*v,r}function Su(r,t){let e=t[0],n=t[1],i=t[2],s=t[3],o=e*e+n*n+i*i+s*s,l=o?1/o:0;return r[0]=-e*l,r[1]=-n*l,r[2]=-i*l,r[3]=s*l,r}function e1(r,t){let e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[5]-t[7])*n,r[1]=(t[6]-t[2])*n,r[2]=(t[1]-t[3])*n;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);let s=(i+1)%3,o=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[s*3+s]-t[o*3+o]+1),r[i]=.5*n,n=.5/n,r[3]=(t[s*3+o]-t[o*3+s])*n,r[s]=(t[s*3+i]+t[i*3+s])*n,r[o]=(t[o*3+i]+t[i*3+o])*n}return r}function _m(r,t,e,n){let i=.5*Math.PI/180;t*=i,e*=i,n*=i;let s=Math.sin(t),o=Math.cos(t),l=Math.sin(e),u=Math.cos(e),m=Math.sin(n),f=Math.cos(n);return r[0]=s*u*f-o*l*m,r[1]=o*l*f+s*u*m,r[2]=o*u*m-s*l*f,r[3]=o*u*f+s*l*m,r}var Mu=Tm,Cm=Sm,Ja=Mm;var ws=Rm;var d4=function(){let r=rt(),t=Ke(1,0,0),e=Ke(0,1,0);return function(n,i,s){let o=ys(i,s);return o<-.999999?($a(r,t,i),ym(r)<1e-6&&$a(r,e,i),qa(r,r),Jv(n,r,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):($a(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+o,ws(n,n))}}(),p4=function(){let r=nt(),t=nt();return function(e,n,i,s,o,l){return fi(r,n,o,l),fi(t,i,s,l),fi(e,r,t,2*l*(1-l)),e}}(),h4=function(){let r=wm();return function(t,e,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],ws(t,e1(t,r))}}();var ne=Symbol("@@webxr-polyfill/XRRigidTransform"),rr=class{constructor(){if(this[ne]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[ne].matrix=Ir(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[ne].matrix=arguments[0]:(this[ne].position=this._getPoint(arguments[0]),this[ne].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[ne].position=this._getPoint(arguments[0]),this[ne].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[ne].matrix){let t=rt();Qa(t,this[ne].matrix),this[ne].position=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2]});let e=nt();Ka(e,this[ne].matrix),this[ne].orientation=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2],w:e[3]})}else this[ne].matrix=Ir(new Float32Array(16)),Lr(this[ne].matrix,Cm(this[ne].orientation.x,this[ne].orientation.y,this[ne].orientation.z,this[ne].orientation.w),Ke(this[ne].position.x,this[ne].position.y,this[ne].position.z))}_getPoint(t){return t instanceof DOMPointReadOnly?t:DOMPointReadOnly.fromPoint(t)}get matrix(){return this[ne].matrix}get position(){return this[ne].position}get orientation(){return this[ne].orientation}get inverse(){if(this[ne].inverse===null){let t=Ir(new Float32Array(16));gn(t,this[ne].matrix),this[ne].inverse=new rr(t),this[ne].inverse[ne].inverse=this}return this[ne].inverse}};var Ee=Symbol("@@webxr-polyfill/XRSpace");var mt=class{constructor(t=null,e=null){this[Ee]={specialType:t,inputSource:e,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[Ee].specialType}get _inputSource(){return this[Ee].inputSource}_ensurePoseUpdated(t,e){e!=this[Ee].lastFrameId&&(this[Ee].lastFrameId=e,this._onPoseUpdate(t))}_onPoseUpdate(t){this[Ee].specialType=="viewer"&&(this._baseMatrix=t.getBasePoseMatrix())}set _baseMatrix(t){this[Ee].baseMatrix=t,this[Ee].inverseBaseMatrix=null}get _baseMatrix(){return this[Ee].baseMatrix||this[Ee].inverseBaseMatrix&&(this[Ee].baseMatrix=new Float32Array(16),gn(this[Ee].baseMatrix,this[Ee].inverseBaseMatrix)),this[Ee].baseMatrix}set _inverseBaseMatrix(t){this[Ee].inverseBaseMatrix=t,this[Ee].baseMatrix=null}get _inverseBaseMatrix(){return this[Ee].inverseBaseMatrix||this[Ee].baseMatrix&&(this[Ee].inverseBaseMatrix=new Float32Array(16),gn(this[Ee].inverseBaseMatrix,this[Ee].baseMatrix)),this[Ee].inverseBaseMatrix}_getSpaceRelativeTransform(t){if(!this._inverseBaseMatrix||!t._baseMatrix)return null;let e=new Float32Array(16);return tr(e,this._inverseBaseMatrix,t._baseMatrix),new rr(e)}};var t1=1.6,Dr=Symbol("@@webxr-polyfill/XRReferenceSpace"),Ts=["viewer","local","local-floor","bounded-floor","unbounded"];function r1(r){return r==="bounded-floor"||r==="local-floor"}var Ht=class extends mt{constructor(t,e=null){if(!Ts.includes(t))throw new Error(`XRReferenceSpaceType must be one of ${Ts}`);if(super(t),t==="bounded-floor"&&!e)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");r1(t)&&!e&&(e=Ir(new Float32Array(16)),e[13]=t1),this._inverseBaseMatrix=e||Ir(new Float32Array(16)),this[Dr]={type:t,transform:e,originOffset:Ir(new Float32Array(16))}}_transformBasePoseMatrix(t,e){tr(t,this._inverseBaseMatrix,e)}_originOffsetMatrix(){return this[Dr].originOffset}_adjustForOriginOffset(t){let e=new Float32Array(16);gn(e,this[Dr].originOffset),tr(t,e,t)}_getSpaceRelativeTransform(t){let e=super._getSpaceRelativeTransform(t);return this._adjustForOriginOffset(e.matrix),new XRRigidTransform(e.matrix)}getOffsetReferenceSpace(t){let e=new Ht(this[Dr].type,this[Dr].transform,this[Dr].bounds);return tr(e[Dr].originOffset,this[Dr].originOffset,t.matrix),e}};var We=Symbol("@@webxr-polyfill/XR"),n1=["inline","immersive-vr","immersive-ar"],i1={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},s1=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,Ss=class extends er{constructor(t){super(),this[We]={device:null,devicePromise:t,immersiveSession:null,inlineSessions:new Set},t.then(e=>{this[We].device=e})}async isSessionSupported(t){return this[We].device||await this[We].devicePromise,t!="inline"?Promise.resolve(this[We].device.isSessionSupported(t)):Promise.resolve(!0)}async requestSession(t,e){if(!this[We].device){if(t!="inline")throw new Error(s1);await this[We].devicePromise}if(!n1.includes(t))throw new TypeError(`The provided value '${t}' is not a valid enum value of type XRSessionMode`);let n=i1[t],i=n.requiredFeatures.concat(e&&e.requiredFeatures?e.requiredFeatures:[]),s=n.optionalFeatures.concat(e&&e.optionalFeatures?e.optionalFeatures:[]),o=new Set,l=!1;for(let v of i)this[We].device.isFeatureSupported(v)?o.add(v):(console.error(`The required feature '${v}' is not supported`),l=!0);if(l)throw new DOMException("Session does not support some required features","NotSupportedError");for(let v of s)this[We].device.isFeatureSupported(v)?o.add(v):console.log(`The optional feature '${v}' is not supported`);let u=await this[We].device.requestSession(t,o),m=new XRSession(this[We].device,t,u);t=="inline"?this[We].inlineSessions.add(m):this[We].immersiveSession=m;let f=()=>{t=="inline"?this[We].inlineSessions.delete(m):this[We].immersiveSession=null,m.removeEventListener("end",f)};return m.addEventListener("end",f),m}};var _u;if("performance"in Xa)_u=()=>performance.now();else{let r=Date.now();_u=()=>Date.now()-r}var el=_u;var Cu=Symbol("@@webxr-polyfill/XRPose"),xn=class{constructor(t,e){this[Cu]={transform:t,emulatedPosition:e}}get transform(){return this[Cu].transform}get emulatedPosition(){return this[Cu].emulatedPosition}};var Pm=Symbol("@@webxr-polyfill/XRViewerPose"),bn=class extends xn{constructor(t,e,n=!1){super(t,n),this[Pm]={views:e}}get views(){return this[Pm].views}};var Ms=Symbol("@@webxr-polyfill/XRViewport"),An=class{constructor(t){this[Ms]={target:t}}get x(){return this[Ms].target.x}get y(){return this[Ms].target.y}get width(){return this[Ms].target.width}get height(){return this[Ms].target.height}};var Im=["left","right","none"],Or=Symbol("@@webxr-polyfill/XRView"),yn=class{constructor(t,e,n,i){if(!Im.includes(n))throw new Error(`XREye must be one of: ${Im}`);let s=Object.create(null),o=new An(s);this[Or]={device:t,eye:n,viewport:o,temp:s,sessionId:i,transform:e}}get eye(){return this[Or].eye}get projectionMatrix(){return this[Or].device.getProjectionMatrix(this.eye)}get transform(){return this[Or].transform}_getViewport(t){if(this[Or].device.getViewport(this[Or].sessionId,this.eye,t,this[Or].temp))return this[Or].viewport}};var Te=Symbol("@@webxr-polyfill/XRFrame"),Lm="XRFrame access outside the callback that produced it is invalid.",o1="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",a1=0,Br=class{constructor(t,e,n){this[Te]={id:++a1,active:!1,animationFrame:!1,device:t,session:e,sessionId:n}}get session(){return this[Te].session}getViewerPose(t){if(!this[Te].animationFrame)throw new DOMException(o1,"InvalidStateError");if(!this[Te].active)throw new DOMException(Lm,"InvalidStateError");let e=this[Te].device,n=this[Te].session;n[S].viewerSpace._ensurePoseUpdated(e,this[Te].id),t._ensurePoseUpdated(e,this[Te].id);let i=t._getSpaceRelativeTransform(n[S].viewerSpace),s=[];for(let l of n[S].viewSpaces){l._ensurePoseUpdated(e,this[Te].id);let u=t._getSpaceRelativeTransform(l),m=new yn(e,u,l.eye,this[Te].sessionId);s.push(m)}return new bn(i,s,!1)}getPose(t,e){if(!this[Te].active)throw new DOMException(Lm,"InvalidStateError");let n=this[Te].device;if(t._specialType==="target-ray"||t._specialType==="grip")return n.getInputPose(t._inputSource,e,t._specialType);{t._ensurePoseUpdated(n,this[Te].id),e._ensurePoseUpdated(n,this[Te].id);let i=e._getSpaceRelativeTransform(t);return i?new XRPose(i,!1):null}return null}};var Rs=Symbol("@@webxr-polyfill/XRRenderState"),l1=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),Fr=class{constructor(t={}){let e=Object.assign({},l1,t);this[Rs]={config:e}}get depthNear(){return this[Rs].config.depthNear}get depthFar(){return this[Rs].config.depthFar}get inlineVerticalFieldOfView(){return this[Rs].config.inlineVerticalFieldOfView}get baseLayer(){return this[Rs].config.baseLayer}};var tl=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),_s=Symbol("@@webxr-polyfill/xr-compatible");var wn=Symbol("@@webxr-polyfill/XRWebGLLayer"),c1=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Cs=class{constructor(t,e,n={}){let i=Object.assign({},c1,n);if(!(t instanceof Tn))throw new Error("session must be a XRSession");if(t.ended)throw new Error("InvalidStateError");if(e[tl]&&e[_s]!==!0)throw new Error("InvalidStateError");let s=e.getParameter(e.FRAMEBUFFER_BINDING);this[wn]={context:e,config:i,framebuffer:s,session:t}}get context(){return this[wn].context}get antialias(){return this[wn].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[wn].framebuffer}get framebufferWidth(){return this[wn].context.drawingBufferWidth}get framebufferHeight(){return this[wn].context.drawingBufferHeight}get _session(){return this[wn].session}getViewport(t){return t._getViewport(this)}static getNativeFramebufferScaleFactor(t){if(!t)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return t[S].ended?0:1}};var Pu=Symbol("@@webxr-polyfill/XRInputSourceEvent"),nr=class extends Event{constructor(t,e){super(t,e),this[Pu]={frame:e.frame,inputSource:e.inputSource},Object.setPrototypeOf(this,nr.prototype)}get frame(){return this[Pu].frame}get inputSource(){return this[Pu].inputSource}};var Dm=Symbol("@@webxr-polyfill/XRSessionEvent"),kt=class extends Event{constructor(t,e){super(t,e),this[Dm]={session:e.session},Object.setPrototypeOf(this,kt.prototype)}get session(){return this[Dm].session}};var rl=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),ir=class extends Event{constructor(t,e){super(t,e),this[rl]={session:e.session,added:e.added,removed:e.removed},Object.setPrototypeOf(this,ir.prototype)}get session(){return this[rl].session}get added(){return this[rl].added}get removed(){return this[rl].removed}};var S=Symbol("@@webxr-polyfill/XRSession"),Ps=class extends mt{constructor(t){super(t)}get eye(){return this._specialType}_onPoseUpdate(t){this._inverseBaseMatrix=t.getBaseViewMatrix(this._specialType)}},Tn=class extends er{constructor(t,e,n){super();let i=e!="inline",s=new Fr({inlineVerticalFieldOfView:i?null:Math.PI*.5});this[S]={device:t,mode:e,immersive:i,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:n,activeRenderState:s,pendingRenderState:null,viewerSpace:new Ht("viewer"),viewSpaces:[],currentInputSources:[]},i?this[S].viewSpaces.push(new Ps("left"),new Ps("right")):this[S].viewSpaces.push(new Ps("none")),this[S].onDeviceFrame=()=>{if(this[S].ended||this[S].suspended||(this[S].deviceFrameHandle=null,this[S].startDeviceFrameLoop(),this[S].pendingRenderState!==null&&(this[S].activeRenderState=new Fr(this[S].pendingRenderState),this[S].pendingRenderState=null,this[S].activeRenderState.baseLayer&&this[S].device.onBaseLayerSet(this[S].id,this[S].activeRenderState.baseLayer)),this[S].activeRenderState.baseLayer===null))return;let o=new Br(t,this,this[S].id),l=this[S].currentFrameCallbacks=this[S].frameCallbacks;this[S].frameCallbacks=[],o[Te].active=!0,o[Te].animationFrame=!0,this[S].device.onFrameStart(this[S].id,this[S].activeRenderState),this._checkInputSourcesChange();let u=el();for(let m=0;m<l.length;m++)try{!l[m].cancelled&&typeof l[m].callback=="function"&&l[m].callback(u,o)}catch(f){console.error(f)}this[S].currentFrameCallbacks=null,o[Te].active=!1,this[S].device.onFrameEnd(this[S].id)},this[S].startDeviceFrameLoop=()=>{this[S].deviceFrameHandle===null&&(this[S].deviceFrameHandle=this[S].device.requestAnimationFrame(this[S].onDeviceFrame))},this[S].stopDeviceFrameLoop=()=>{let o=this[S].deviceFrameHandle;o!==null&&(this[S].device.cancelAnimationFrame(o),this[S].deviceFrameHandle=null)},this[S].onPresentationEnd=o=>{if(o!==this[S].id){this[S].suspended=!1,this[S].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[S].ended=!0,this[S].stopDeviceFrameLoop(),t.removeEventListener("@@webxr-polyfill/vr-present-end",this[S].onPresentationEnd),t.removeEventListener("@@webxr-polyfill/vr-present-start",this[S].onPresentationStart),t.removeEventListener("@@webxr-polyfill/input-select-start",this[S].onSelectStart),t.removeEventListener("@@webxr-polyfill/input-select-end",this[S].onSelectEnd),this.dispatchEvent("end",new kt("end",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-end",this[S].onPresentationEnd),this[S].onPresentationStart=o=>{o!==this[S].id&&(this[S].suspended=!0,this[S].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-start",this[S].onPresentationStart),this[S].onSelectStart=o=>{o.sessionId===this[S].id&&this[S].dispatchInputSourceEvent("selectstart",o.inputSource)},t.addEventListener("@@webxr-polyfill/input-select-start",this[S].onSelectStart),this[S].onSelectEnd=o=>{o.sessionId===this[S].id&&(this[S].dispatchInputSourceEvent("selectend",o.inputSource),this[S].dispatchInputSourceEvent("select",o.inputSource))},t.addEventListener("@@webxr-polyfill/input-select-end",this[S].onSelectEnd),this[S].onSqueezeStart=o=>{o.sessionId===this[S].id&&this[S].dispatchInputSourceEvent("squeezestart",o.inputSource)},t.addEventListener("@@webxr-polyfill/input-squeeze-start",this[S].onSqueezeStart),this[S].onSqueezeEnd=o=>{o.sessionId===this[S].id&&(this[S].dispatchInputSourceEvent("squeezeend",o.inputSource),this[S].dispatchInputSourceEvent("squeeze",o.inputSource))},t.addEventListener("@@webxr-polyfill/input-squeeze-end",this[S].onSqueezeEnd),this[S].dispatchInputSourceEvent=(o,l)=>{let u=new Br(t,this,this[S].id),m=new nr(o,{frame:u,inputSource:l});u[Te].active=!0,this.dispatchEvent(o,m),u[Te].active=!1},this[S].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[S].activeRenderState}get environmentBlendMode(){return this[S].device.environmentBlendMode||"opaque"}async requestReferenceSpace(t){if(this[S].ended)return;if(!Ts.includes(t))throw new TypeError(`XRReferenceSpaceType must be one of ${Ts}`);if(!this[S].device.doesSessionSupportReferenceSpace(this[S].id,t))throw new DOMException(`The ${t} reference space is not supported by this session.`,"NotSupportedError");if(t==="viewer")return this[S].viewerSpace;let e=await this[S].device.requestFrameOfReferenceTransform(t);if(t==="bounded-floor")throw e?this[S].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${t} reference space yet.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new Ht(t,e)}requestAnimationFrame(t){if(this[S].ended)return;let e=++this[S].frameHandle;return this[S].frameCallbacks.push({handle:e,callback:t,cancelled:!1}),e}cancelAnimationFrame(t){let e=this[S].frameCallbacks,n=e.findIndex(i=>i&&i.handle===t);n>-1&&(e[n].cancelled=!0,e.splice(n,1)),e=this[S].currentFrameCallbacks,e&&(n=e.findIndex(i=>i&&i.handle===t),n>-1&&(e[n].cancelled=!0))}get inputSources(){return this[S].device.getInputSources()}async end(){if(!this[S].ended)return this[S].immersive&&(this[S].ended=!0,this[S].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[S].onPresentationStart),this[S].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[S].onPresentationEnd),this[S].device.removeEventListener("@@webxr-polyfill/input-select-start",this[S].onSelectStart),this[S].device.removeEventListener("@@webxr-polyfill/input-select-end",this[S].onSelectEnd),this.dispatchEvent("end",new kt("end",{session:this}))),this[S].stopDeviceFrameLoop(),this[S].device.endSession(this[S].id)}updateRenderState(t){if(this[S].ended){let n="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(n)}if(t.baseLayer&&t.baseLayer._session!==this){let n="Called updateRenderState with a base layer that was created by a different session.";throw new Error(n)}if(t.inlineVerticalFieldOfView!==null&&t.inlineVerticalFieldOfView!==void 0)if(this[S].immersive){let n="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(n)}else t.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,t.inlineVerticalFieldOfView));if(this[S].pendingRenderState===null){let n=this[S].activeRenderState;this[S].pendingRenderState={depthNear:n.depthNear,depthFar:n.depthFar,inlineVerticalFieldOfView:n.inlineVerticalFieldOfView,baseLayer:n.baseLayer}}Object.assign(this[S].pendingRenderState,t)}_checkInputSourcesChange(){let t=[],e=[],n=this.inputSources,i=this[S].currentInputSources;for(let s of n)i.includes(s)||t.push(s);for(let s of i)n.includes(s)||e.push(s);(t.length>0||e.length>0)&&this.dispatchEvent("inputsourceschange",new ir("inputsourceschange",{session:this,added:t,removed:e})),this[S].currentInputSources.length=0;for(let s of n)this[S].currentInputSources.push(s)}};var Hr=Symbol("@@webxr-polyfill/XRInputSource"),Sn=class{constructor(t){this[Hr]={impl:t,gripSpace:new mt("grip",this),targetRaySpace:new mt("target-ray",this)}}get handedness(){return this[Hr].impl.handedness}get targetRayMode(){return this[Hr].impl.targetRayMode}get gripSpace(){let t=this[Hr].impl.targetRayMode;return t==="gaze"||t==="screen"?null:this[Hr].gripSpace}get targetRaySpace(){return this[Hr].targetRaySpace}get profiles(){return this[Hr].impl.profiles}get gamepad(){return this[Hr].impl.gamepad}};var Iu=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Mn=class extends Event{constructor(t,e){super(t,e),this[Iu]={referenceSpace:e.referenceSpace,transform:e.transform||null},Object.setPrototypeOf(this,Mn.prototype)}get referenceSpace(){return this[Iu].referenceSpace}get transform(){return this[Iu].transform}};var nl={XRSystem:Ss,XRSession:Tn,XRSessionEvent:kt,XRFrame:Br,XRView:yn,XRViewport:An,XRViewerPose:bn,XRWebGLLayer:Cs,XRSpace:mt,XRReferenceSpace:Ht,XRReferenceSpaceEvent:Mn,XRInputSource:Sn,XRInputSourceEvent:nr,XRInputSourcesChangeEvent:ir,XRRenderState:Fr,XRRigidTransform:rr,XRPose:xn};var Lu=r=>typeof r.prototype.makeXRCompatible=="function"?!1:(r.prototype.makeXRCompatible=function(){return this[_s]=!0,Promise.resolve()},!0),Du=r=>{let t=r.prototype.getContext;r.prototype.getContext=function(e,n){let i=t.call(this,e,n);return i&&(i[tl]=!0,n&&"xrCompatible"in n&&(i[_s]=n.xrCompatible)),i}};var Om=r=>!!(r.ImageBitmapRenderingContext&&r.createImageBitmap),Bm=r=>{var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(r.navigator.userAgent||r.navigator.vendor||r.opera),t},Fm=r=>{r.style.display="block",r.style.position="absolute",r.style.width=r.style.height="1px",r.style.top=r.style.left="0px"};var Qm=Gf(Hm());var Rn=class extends er{constructor(t){super(),this.global=t,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(t,e){throw new Error("Not implemented")}isSessionSupported(t){throw new Error("Not implemented")}isFeatureSupported(t){throw new Error("Not implemented")}async requestSession(t,e){throw new Error("Not implemented")}requestAnimationFrame(t){throw new Error("Not implemented")}onFrameStart(t){throw new Error("Not implemented")}onFrameEnd(t){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(t,e){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(t,e){}cancelAnimationFrame(t){throw new Error("Not implemented")}endSession(t){throw new Error("Not implemented")}getViewport(t,e,n,i){throw new Error("Not implemented")}getProjectionMatrix(t){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(t){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(t,e,n){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var u1={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},d1={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},p1={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},km={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},h1={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},m1={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},f1={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Fu={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},g1={"Daydream Controller":u1,"Gear VR Controller":m1,"HTC Vive Focus Controller":d1,"Oculus Go Controller":p1,"Oculus Touch (Right)":km,"Oculus Touch (Left)":km,"OpenVR Gamepad":h1,"Spatial Controller (Spatial Interaction Source) 045E-065A":Fu,"Spatial Controller (Spatial Interaction Source) 045E-065D":f1,"Windows Mixed Reality (Right)":Fu,"Windows Mixed Reality (Left)":Fu},Nm=g1;var Vm=Ke(.155,-.465,-.15),v1=Ke(-.155,-.465,-.15),E1=Ke(0,0,-.25),x1=Ke(0,0,.05),Um=Ke(-.08,.14,.08),zm=.4,b1=.4,A1=.61,y1=.175,w1=.12,T1=.87,Gm=180/Math.PI;function S1(r,t,e){function n(u,m,f){return u<m?m:u>f?f:u}var i=t[0]*t[0],s=t[1]*t[1],o=t[2]*t[2],l=t[3]*t[3];if(e==="XYZ")r[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),l-i-s+o),r[1]=Math.asin(n(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),r[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),l+i-s-o);else if(e==="YXZ")r[0]=Math.asin(n(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),r[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),l-i-s+o),r[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),l-i+s-o);else if(e==="ZXY")r[0]=Math.asin(n(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),r[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),l-i-s+o),r[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),l-i+s-o);else if(e==="ZYX")r[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),l-i-s+o),r[1]=Math.asin(n(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),r[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),l+i-s-o);else if(e==="YZX")r[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),l-i+s-o),r[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),l+i-s-o),r[2]=Math.asin(n(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else if(e==="XZY")r[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),l-i+s-o),r[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),l+i-s-o),r[2]=Math.asin(n(2*(t[2]*t[3]-t[0]*t[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var Is=class{constructor(){this.hand="right",this.headElbowOffset=Vm,this.controllerQ=nt(),this.lastControllerQ=nt(),this.headQ=nt(),this.headPos=rt(),this.elbowPos=rt(),this.wristPos=rt(),this.time=null,this.lastTime=null,this.rootQ=nt(),this.position=rt()}setHandedness(t){this.hand!=t&&(this.hand=t,this.hand=="left"?this.headElbowOffset=v1:this.headElbowOffset=Vm)}update(t,e){this.time=el(),t&&(Ja(this.lastControllerQ,this.controllerQ),Ja(this.controllerQ,t)),e&&(Qa(this.headPos,e),Ka(this.headQ,e));let n=this.getHeadYawOrientation_(),i=this.quatAngle_(this.lastControllerQ,this.controllerQ),s=(this.time-this.lastTime)/1e3;i/s>A1?fi(this.rootQ,this.rootQ,n,Math.min(i/y1,1)):Ja(this.rootQ,n);let l=Ke(0,0,-1);En(l,l,this.controllerQ);let u=ys(l,[0,1,0]),m=this.clamp_((u-w1)/T1,0,1),f=Mu(this.rootQ);Su(f,f),Tu(f,f,this.controllerQ);let v=this.elbowPos;yu(v,this.headPos),mi(v,v,this.headElbowOffset);let A=Au(Um);wu(A,A,m),mi(v,v,A);let C=this.quatAngle_(f,nt())*Gm,I=1-Math.pow(C/180,4);sssss;let P=zm,B=1-zm,H=I*(P+B*m*b1),D=nt();fi(D,D,f,H);let V=Su(nt(),D),N=Mu(f);Tu(N,N,V);let L=this.wristPos;yu(L,x1),En(L,L,D),mi(L,L,E1),En(L,L,N),mi(L,L,v);let k=Au(Um);wu(k,k,m),mi(this.position,this.wristPos,k),En(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let t=rt();return S1(t,this.headQ,"YXZ"),_m(nt(),0,t[1]*Gm,0)}clamp_(t,e,n){return Math.min(Math.max(t,e),n)}quatAngle_(t,e){let n=[0,0,-1],i=[0,0,-1];return En(n,n,t),En(i,i,e),Am(n,i)}};var Ue=Symbol("@@webxr-polyfill/XRRemappedGamepad"),jm={pressed:!1,touched:!1,value:0};Object.freeze(jm);var Hu=class{constructor(t,e,n){if(n||(n={}),n.userAgentOverrides){for(let m in n.userAgentOverrides)if(navigator.userAgent.includes(m)){let f=n.userAgentOverrides[m];for(let v in f)v in n?Object.assign(n[v],f[v]):n[v]=f[v];break}}let i=new Array(n.axes&&n.axes.length?n.axes.length:t.axes.length),s=new Array(n.buttons&&n.buttons.length?n.buttons.length:t.buttons.length),o=null;if(n.gripTransform){let m=n.gripTransform.orientation||[0,0,0,1];o=Ft(),Lr(o,ws(m,m),n.gripTransform.position||[0,0,0])}let l=null;if(n.targetRayTransform){let m=n.targetRayTransform.orientation||[0,0,0,1];l=Ft(),Lr(l,ws(m,m),n.targetRayTransform.position||[0,0,0])}let u=n.profiles;n.displayProfiles&&e.displayName in n.displayProfiles&&(u=n.displayProfiles[e.displayName]),this[Ue]={gamepad:t,map:n,profiles:u||[t.id],mapping:n.mapping||t.mapping,axes:i,buttons:s,gripTransform:o,targetRayTransform:l},this._update()}_update(){let t=this[Ue].gamepad,e=this[Ue].map,n=this[Ue].axes;for(let s=0;s<n.length;++s)e.axes&&s in e.axes?e.axes[s]===null?n[s]=0:n[s]=t.axes[e.axes[s]]:n[s]=t.axes[s];if(e.axes&&e.axes.invert)for(let s of e.axes.invert)s<n.length&&(n[s]*=-1);let i=this[Ue].buttons;for(let s=0;s<i.length;++s)e.buttons&&s in e.buttons?e.buttons[s]===null?i[s]=jm:i[s]=t.buttons[e.buttons[s]]:i[s]=t.buttons[s]}get id(){return""}get _profiles(){return this[Ue].profiles}get index(){return-1}get connected(){return this[Ue].gamepad.connected}get timestamp(){return this[Ue].gamepad.timestamp}get mapping(){return this[Ue].mapping}get axes(){return this[Ue].axes}get buttons(){return this[Ue].buttons}get hapticActuators(){return this[Ue].gamepad.hapticActuators}},Ls=class{constructor(t,e,n=0,i=-1){this.polyfill=t,this.display=e,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new Sn(this),this.lastPosition=rt(),this.emulatedPosition=!1,this.basePoseMatrix=Ft(),this.outputMatrix=Ft(),this.primaryButtonIndex=n,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=i,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(t){this.nativeGamepad!==t&&(this.nativeGamepad=t,t?this.gamepad=new Hu(t,this.display,Nm[t.id]):this.gamepad=null),this.handedness=t.hand===""?"none":t.hand,this.gamepad&&this.gamepad._update(),t.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!t.pose.hasPosition):t.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let t=this.nativeGamepad.pose,e=t.position,n=t.orientation;if(!e&&!n)return;e?(this.lastPosition[0]=e[0],this.lastPosition[1]=e[1],this.lastPosition[2]=e[2]):t.hasPosition?e=this.lastPosition:(this.armModel||(this.armModel=new Is),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(n,this.polyfill.getBasePoseMatrix()),e=this.armModel.getPosition()),Lr(this.basePoseMatrix,n,e)}else xm(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(t,e){switch(this.updateBasePoseMatrix(),e){case"target-ray":t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Ue].targetRayTransform&&tr(this.outputMatrix,this.outputMatrix,this.gamepad[Ue].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Ue].gripTransform&&tr(this.outputMatrix,this.outputMatrix,this.gamepad[Ue].gripTransform);break;default:return null}return t._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var UI=Symbol("@@webxr-polyfill/WebVRDevice"),Ds=!1,Wm={highRefreshRate:!0},Xm={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},M1=0,ku=class{constructor(t,e,n={}){if(this.mode=t,this.enabledFeatures=e,this.outputContext=null,this.immersive=t=="immersive-vr"||t=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++M1,this.modifiedCanvasLayer=!1,this.outputContext&&!Ds){let i=n.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(i)}}},_n=class extends Rn{constructor(t,e){let{canPresent:n}=e.capabilities;super(t),this.display=e,this.frame=new t.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=n,this.baseModelMatrix=Ft(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),t.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=t.navigator&&"getGamepads"in t.navigator,this.HAS_BITMAP_SUPPORT=Om(t)}get depthNear(){return this.display.depthNear}set depthNear(t){this.display.depthNear=t}get depthFar(){return this.display.depthFar}set depthFar(t){this.display.depthFar=t}onBaseLayerSet(t,e){let n=this.sessions.get(t),i=e.context.canvas;if(n.immersive){let s=this.display.getEyeParameters("left"),o=this.display.getEyeParameters("right");i.width=Math.max(s.renderWidth,o.renderWidth)*2,i.height=Math.max(s.renderHeight,o.renderHeight),this.display.requestPresent([{source:i,attributes:Wm}]).then(()=>{!Ds&&!this.global.document.body.contains(i)&&(n.modifiedCanvasLayer=!0,this.global.document.body.appendChild(i),Fm(i)),n.baseLayer=e})}else n.baseLayer=e}isSessionSupported(t){return!(t=="immersive-ar"||t=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(t){switch(t){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let n=t=="immersive-vr";if(n){let s=this.global.document.createElement("canvas");if(!Ds){let o=s.getContext("webgl")}await this.display.requestPresent([{source:s,attributes:Wm}])}let i=new ku(t,e,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(i.id,i),n&&(this.immersiveSession=i,this.dispatchEvent("@@webxr-polyfill/vr-present-start",i.id)),Promise.resolve(i.id)}requestAnimationFrame(t){return this.display.requestAnimationFrame(t)}getPrimaryButtonIndex(t){let e=0,n=t.id.toLowerCase();for(let i in Xm)if(n.includes(i)){e=Xm[i];break}return Math.min(e,t.buttons.length-1)}onFrameStart(t,e){this.display.depthNear=e.depthNear,this.display.depthFar=e.depthFar,this.display.getFrameData(this.frame);let n=this.sessions.get(t);if(n.immersive&&this.CAN_USE_GAMEPAD){let i=this.gamepadInputSources;this.gamepadInputSources={};let s=this.global.navigator.getGamepads();for(let o=0;o<s.length;++o){let l=s[o];if(l&&l.displayId>0){let u=i[o];if(u||(u=new Ls(this,this.display,this.getPrimaryButtonIndex(l))),u.updateFromGamepad(l),this.gamepadInputSources[o]=u,u.primaryButtonIndex!=-1){let m=l.buttons[u.primaryButtonIndex].pressed;m&&!u.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:n.id,inputSource:u.inputSource}):!m&&u.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:n.id,inputSource:u.inputSource}),u.primaryActionPressed=m}if(u.primarySqueezeButtonIndex!=-1){let m=l.buttons[u.primarySqueezeButtonIndex].pressed;m&&!u.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:n.id,inputSource:u.inputSource}):!m&&u.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:n.id,inputSource:u.inputSource}),u.primarySqueezeActionPressed=m}}}}if(!Ds&&!n.immersive&&n.baseLayer){let i=n.baseLayer.context.canvas;Ya(this.frame.leftProjectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){let e=this.sessions.get(t);if(!(e.ended||!e.baseLayer)){if(e.outputContext&&!(e.immersive&&!this.display.capabilities.hasExternalDisplay)){let n=e.immersive&&this.display.capabilities.hasExternalDisplay,i=e.baseLayer.context.canvas,s=n?i.width/2:i.width,o=i.height;if(!Ds){let l=e.outputContext.canvas,u=l.width,m=l.height,f=e.renderContext;this.HAS_BITMAP_SUPPORT?i.transferToImageBitmap?f.transferFromImageBitmap(i.transferToImageBitmap()):this.global.createImageBitmap(i,0,0,s,o,{resizeWidth:u,resizeHeight:m}).then(v=>f.transferFromImageBitmap(v)):f.drawImage(i,0,0,s,o,0,0,u,m)}}e.immersive&&e.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(t){this.display.cancelAnimationFrame(t)}async endSession(t){let e=this.sessions.get(t);if(!e.ended){if(e.immersive)return this.display.exitPresent();e.ended=!0}}doesSessionSupportReferenceSpace(t,e){let n=this.sessions.get(t);return n.ended?!1:n.enabledFeatures.has(e)}requestStageBounds(){if(this.display.stageParameters){let t=this.display.stageParameters.sizeX,e=this.display.stageParameters.sizeZ,n=[];return n.push(-t/2),n.push(-e/2),n.push(t/2),n.push(-e/2),n.push(t/2),n.push(e/2),n.push(-t/2),n.push(e/2),n}return null}async requestFrameOfReferenceTransform(t,e){return(t==="local-floor"||t==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(t){if(t==="left")return this.frame.leftProjectionMatrix;if(t==="right")return this.frame.rightProjectionMatrix;if(t==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(t,e,n,i){let s=this.sessions.get(t),{width:o,height:l}=n.context.canvas;if(!s.immersive)return i.x=i.y=0,i.width=o,i.height=l,!0;if(e==="left"||e==="none")i.x=0;else if(e==="right")i.x=o/2;else return!1;return i.y=0,i.width=o/2,i.height=l,!0}getBasePoseMatrix(){let{position:t,orientation:e}=this.frame.pose;return!t&&!e?this.baseModelMatrix:(t||(t=this.tempVec3,t[0]=t[1]=t[2]=0),Lr(this.baseModelMatrix,e,t),this.baseModelMatrix)}getBaseViewMatrix(t){if(t==="left"||t==="none")return this.frame.leftViewMatrix;if(t==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let t=[];for(let e in this.gamepadInputSources)t.push(this.gamepadInputSources[e].inputSource);return t}getInputPose(t,e,n){if(!e)return null;for(let i in this.gamepadInputSources){let s=this.gamepadInputSources[i];if(s.inputSource===t)return s.getXRPose(e,n)}return null}onWindowResize(){}onVRDisplayPresentChange(t){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){let n=e.baseLayer.context.canvas;document.body.removeChild(n),n.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}};var Os=class extends _n{constructor(t,e){let n=new Qm.default(e||{});super(t,n),this.display=n,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var R1=!1,_1=0,Nu=class{constructor(t,e){this.mode=t,this.enabledFeatures=e,this.ended=null,this.baseLayer=null,this.id=++_1}},Bs=class extends Rn{constructor(t){super(t),this.sessions=new Map,this.projectionMatrix=Ft(),this.identityMatrix=Ft()}onBaseLayerSet(t,e){let n=this.sessions.get(t);n.baseLayer=e}isSessionSupported(t){return t=="inline"}isFeatureSupported(t){switch(t){case"viewer":return!0;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let n=new Nu(t,e);return this.sessions.set(n.id,n),Promise.resolve(n.id)}requestAnimationFrame(t){return window.requestAnimationFrame(t)}cancelAnimationFrame(t){window.cancelAnimationFrame(t)}onFrameStart(t,e){if(R1)return;let n=this.sessions.get(t);if(n.baseLayer){let i=n.baseLayer.context.canvas;Ya(this.projectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){}async endSession(t){let e=this.sessions.get(t);e.ended=!0}doesSessionSupportReferenceSpace(t,e){let n=this.sessions.get(t);return n.ended?!1:n.enabledFeatures.has(e)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(t,e){return null}getProjectionMatrix(t){return this.projectionMatrix}getViewport(t,e,n,i){let s=this.sessions.get(t),{width:o,height:l}=n.context.canvas;return i.x=i.y=0,i.width=o,i.height=l,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(t){return this.identityMatrix}getInputSources(){return[]}getInputPose(t,e,n){return null}onWindowResize(){}};var C1=async function(r){let t=null;if("getVRDisplays"in r.navigator)try{let e=await r.navigator.getVRDisplays();e&&e.length&&(t=new _n(r,e[0]))}catch{}return t},Km=async function(r,t){if(t.webvr){let n=await C1(r);if(n)return n}let e=Bm(r);return e&&t.cardboard||!e&&t.allowCardboardOnDesktop?(r.VRFrameData||(r.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Os(r,t.cardboardConfig)):new Bs(r)};var P1={global:Xa,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},il=["navigator","HTMLCanvasElement","WebGLRenderingContext"],Fs=class{constructor(t={}){this.config=Object.freeze(Object.assign({},P1,t)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(t){if(!il.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${il}`);for(let e of Object.keys(nl))t[e]!==void 0?console.warn(`${e} already defined on global.`):t[e]=nl[e];Lu(t.WebGLRenderingContext)&&(Du(t.HTMLCanvasElement),t.OffscreenCanvas&&Du(t.OffscreenCanvas),t.WebGL2RenderingContext&&Lu(t.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let t=Km(this.global,this.config);this.xr=new nl.XRSystem(t),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(t){if(!il.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${il}`);if(t.navigator.xr&&"supportsSession"in t.navigator.xr&&!("isSessionSupported"in t.navigator.xr)){let e=t.navigator.xr.supportsSession;t.navigator.xr.isSessionSupported=function(n){return e.call(this,n).then(()=>!0).catch(()=>!1)},t.navigator.xr.supportsSession=function(n){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),e.call(this,n)}}}};navigator.xr||(console.info("Polyfilling WebXR API"),new Fs);var ol=class extends G{constructor(e,n,i,s,o){super(e);this.mode=n;this.session=i;this.referenceSpaceType=s;this.sessionMode=o}},al=class extends ol{constructor(t,e,n,i){super("sessionstarted",t,e,n,i)}},ll=class extends ol{constructor(t,e,n,i){super("sessionstopped",t,e,n,i)}},sl=new Map([["VR",{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],["AR",{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),cl=class extends te{constructor(e,n,i,s){super();this.renderer=e;this.camera=n;this.fullscreenElement=i;this.enableFullResolution=s;d(this,"_currentMode","None");d(this,"buttons",new Map);d(this,"currentSession",null);d(this,"screenUI",null);d(this,"wasVisible",new Map);d(this,"lastWidth",0);d(this,"lastHeight",0);this.addEventListener("sessionstarted",o=>{o.sessionMode==="inline"&&(this.camera.fov=o.session.renderState.inlineVerticalFieldOfView*180/Math.PI)}),this.addEventListener("sessionstopped",o=>{o.sessionMode==="inline"&&(this.camera.fov=50)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.refresh()}setUI(e,n,i,s){this.screenUI=e,this.buttons.set(n.mode,n),this.buttons.set(i.mode,i),s&&(this.buttons.set(s.mode,s),s.available=Hi());for(let o of this.buttons.values())this.wasVisible.set(o,o.visible),o.addEventListener("click",this.toggleMode.bind(this,o.mode));n.available=!Mt()&&bu(),i.available=Ks()}get visible(){return Rt(this.renderer.domElement)}set visible(e){_e(this.renderer.domElement,e),this.screenUI&&_e(this.screenUI,e,"grid")}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){let e=this.renderer.domElement.clientWidth,n=this.renderer.domElement.clientHeight;e>0&&n>0&&(e!==this.lastWidth||n!==this.lastHeight)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,n,!1),this.camera.aspect=e/n,this.camera.updateProjectionMatrix(),this.lastWidth=e,this.lastHeight=n)}}getMetrics(){let e=this.renderer.domElement.clientWidth,n=this.renderer.domElement.clientHeight,i=this.renderer.getPixelRatio(),s=this.camera.fov;return{width:e,height:n,pixelRatio:i,fov:s}}setMetrics(e,n,i,s){this.renderer.setPixelRatio(i),this.renderer.setSize(e,n,!1),this.camera.aspect=e/n,this.camera.fov=s,this.camera.updateProjectionMatrix()}async refresh(){let e=!1;try{if(Hi()){let n=this.renderer.getContext();ae(n.makeXRCompatible)&&(await n.makeXRCompatible(),e=!0)}}catch{console.warn("WebXR is not available on this system.")}await Promise.all(Array.from(this.buttons.values()).filter(n=>n.available&&n.mode!=="Fullscreen").map(async n=>{let i=sl.get(n.mode);if(n.available=x(i),n.available){let s=e&&navigator.xr&&await navigator.xr.isSessionSupported(i.sessionMode),o=!Hi()&&Il()&&i.sessionMode==="immersive-vr"&&i.referenceSpaceType==="local-floor";n.available=s||o}}))}async toggleMode(e){e==="Fullscreen"?await this.toggleFullscreen():e!=="None"&&await this.toggleXR(e)}async start(e){e!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return document.fullscreen}async startFullscreen(){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),this.setActive("Fullscreen"),this.dispatchEvent(new al("Fullscreen",null,null,null)))}async stopFullscreen(){this.isFullscreen&&(await document.exitFullscreen(),this.setActive("None"),this.dispatchEvent(new ll("Fullscreen",null,null,null)))}async toggleFullscreen(){this.isFullscreen?await this.stopFullscreen():await this.startFullscreen()}async toggleXR(e){let n=sl.get(e);if(x(n)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.set(0,0,0),this.camera.quaternion.identity();try{let i=await navigator.xr.requestSession(n.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=i,this.renderer.xr.setReferenceSpaceType(n.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let s=XRWebGLLayer.getNativeFramebufferScaleFactor(i);this.renderer.xr.setFramebufferScaleFactor(s)}this.renderer.xr.setSession(i)}catch(i){console.error(`Couldn't start session type '${n.sessionMode}'. Reason: ${i&&i.message||i||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,n=sl.get(this.currentMode),i=this.currentSession;if(i.supportedFrameRates){let s=Math.max(...i.supportedFrameRates);console.log("Changing framerate to",s),i.updateTargetFrameRate(s)}this.dispatchEvent(new al(e,i,n.referenceSpaceType,n.sessionMode))}onSessionEnded(){let e=this.currentMode,n=sl.get(this.currentMode),i=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive("None"),this.dispatchEvent(new ll(e,i,n.referenceSpaceType,n.sessionMode))}setActive(e){for(let n of this.buttons.values())n.active=n.mode===e,n.visible=this.wasVisible.get(n)&&(e==="None"||n.mode===e||e==="Fullscreen");this._currentMode=e}};var Ym=new THREE.Vector3(0,1,0),Xe=2048,gi=Xe/2,I1=[1,0,2,3,4,5],sr={rows:3,columns:4,indices:[[-1,2,-1,-1],[0,5,1,4],[-1,3,-1,-1]],rotations:[[0,Math.PI,0,0],[0,0,0,0],[0,Math.PI,0,0]]},Vu=new THREE.Color(0),ul=class{constructor(t){this.env=t;d(this,"rt",new THREE.WebGLCubeRenderTarget(Xe));d(this,"rtScene",new THREE.Scene);d(this,"rtCamera",new THREE.CubeCamera(.01,10,this.rt));d(this,"_rotation",new THREE.Quaternion);d(this,"layerRotation",new THREE.Quaternion().identity());d(this,"stageRotation",new THREE.Quaternion().identity());d(this,"images",null);d(this,"canvases",new Array(6));d(this,"contexts",new Array(6));d(this,"cube");d(this,"flipped");d(this,"flipper");d(this,"curImagePath",null);d(this,"layer",null);d(this,"wasVisible",!1);d(this,"wasWebXRLayerAvailable",null);d(this,"stageHeading",0);d(this,"rotationNeedsUpdate",!1);d(this,"imageNeedsUpdate",!1);d(this,"webXRLayerEnabled",!0);d(this,"visible",!0);this.webXRLayerEnabled&&(this.webXRLayerEnabled=this.env.hasXRCompositionLayers),this.env.scene.background=Vu;for(let e=0;e<this.canvases.length;++e){let n=this.canvases[e]=Jr(Xe,Xe);this.contexts[e]=n.getContext("2d")}for(let e=0;e<sr.rows;++e){let n=sr.indices[e],i=sr.rotations[e];for(let s=0;s<sr.columns;++s){let o=n[s];if(o>-1){let l=this.contexts[o],u=i[s];u>0&&(u%2,l.translate(gi,gi),l.rotate(u),l.translate(-gi,-gi))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=Jr(Xe,Xe),this.flipper=this.flipped.getContext("2d"),this.flipper.fillStyle=Vu.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-Xe,0),this.setImages("",this.canvases),Object.seal(this)}setImage(t,e){if(t!==this.curImagePath){let n=e.width/sr.columns,i=e.height/sr.rows;for(let s=0;s<sr.rows;++s){let o=sr.indices[s];for(let l=0;l<sr.columns;++l){let u=o[l];u>-1&&this.contexts[u].drawImage(e,l*n,s*i,n,i,0,0,Xe,Xe)}}this.setImages(t,this.canvases)}}setImages(t,e){(t!==this.curImagePath||e!==this.images)&&(this.curImagePath=t,e!==this.images&&(x(this.cube)&&Tr(this.cube),this.images=e,this.rtScene.background=this.cube=new THREE.CubeTexture(this.images),this.cube.name="SkyboxInput")),this.updateImages()}updateImages(){this.cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(t){let{x:e,y:n,z:i,w:s}=this._rotation;if($p(t))this._rotation.copy(t);else if(Zp(t))this._rotation.setFromEuler(t);else if(lt(t))if(t.length===4&&ce(t[0])&&ce(t[1])&&ce(t[2])&&ce(t[3]))this._rotation.fromArray(t);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else pd(t)?this._rotation.setFromAxisAngle(Ym,t):(x(t)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==e||this._rotation.y!==n||this._rotation.z!==i||this._rotation.w!==s}update(t){if(this.cube){let e=this.webXRLayerEnabled&&this.env.renderer.xr.isPresenting&&x(t)&&x(this.env.xrBinding);if(e!==this.wasWebXRLayerAvailable){if(e){let n=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:n,layout:"mono",isStatic:!1,viewPixelWidth:Xe,viewPixelHeight:Xe}),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.destroy(),this.layer=null);this.imageNeedsUpdate=this.rotationNeedsUpdate=!0}if(this.env.scene.background=this.layer?null:this.visible?this.rt.texture:Vu,this.layer?((this.visible!==this.wasVisible||this.layer.needsRedraw)&&(this.imageNeedsUpdate=!0),this.env.avatar.heading!==this.stageHeading&&(this.rotationNeedsUpdate=!0,this.stageHeading=this.env.avatar.heading,this.stageRotation.setFromAxisAngle(Ym,this.env.avatar.heading))):this.rotationNeedsUpdate=this.imageNeedsUpdate=this.imageNeedsUpdate||this.rotationNeedsUpdate,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.layer?(this.layerRotation.multiply(this.stageRotation),this.layer.orientation=new DOMPointReadOnly(this.layerRotation.x,this.layerRotation.y,this.layerRotation.z,this.layerRotation.w)):this.rtCamera.quaternion.copy(this.layerRotation)),this.imageNeedsUpdate)if(this.layer){let n=this.env.renderer.getContext(),i=this.env.xrBinding.getSubImage(this.layer,t),s=this.cube.images;this.flipper.fillRect(0,0,Xe,Xe),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.bindTexture(n.TEXTURE_CUBE_MAP,i.colorTexture);for(let o=0;o<s.length;++o){if(this.visible){let l=s[I1[o]];this.flipper.drawImage(l,0,0,l.width,l.height,0,0,Xe,Xe)}n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.flipped)}n.bindTexture(n.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible,this.wasWebXRLayerAvailable=e}}};var Uu=class extends Gi{constructor(){super();d(this,"frame",null);Object.seal(this)}set(e,n,i){super.set(e,n),this.frame=i}},Hs,dl=class{constructor(t){this.renderer=t;d(this,"tickHandlers",new Array);d(this,"_onTick");d(this,"lt",-1);zs(this,Hs,!1);let e=new Uu,n=0;this._onTick=(i,s)=>{this.lt>=0&&(n=i-this.lt,e.set(i,n,s),this.tick(e)),this.lt=i}}get isRunning(){return Us(this,Hs)}restart(){this.stop(),this.start()}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){Ge(this.tickHandlers,t)}setAnimationLoop(t){this.renderer.setAnimationLoop(t),Gs(this,Hs,x(t))}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(t){for(let e of this.tickHandlers)e(t)}};Hs=new WeakMap;var pl=new THREE.PerspectiveCamera,qm=new THREE.Vector4,zu=new THREE.Vector4,$m=15,L1=Ad($m);_t(q("#frontBuffer",Vn("absolute"),Qr(0),Yr(0),Et("100%"),jt("100%"),mr(0),fr(0),Rd(0),Nd("none")));var hl=class extends te{constructor(e,n,i,s){super();this.fetcher=n;this.defaultAvatarHeight=i;d(this,"baseLayer");d(this,"layers",new Array);d(this,"layerSortOrder",new Map);d(this,"fader");d(this,"fadeDepth",0);d(this,"cursor3D",new di);d(this,"camera",new THREE.PerspectiveCamera(50,1,.01,1e3));d(this,"scene",new THREE.Scene);d(this,"stage",At("Stage"));d(this,"ambient",new THREE.AmbientLight(16777215,.5));d(this,"sun",new THREE.DirectionalLight(16777215,.75));d(this,"ground",new THREE.GridHelper(L1,$m,12632256,8421504));d(this,"foreground",At("Foreground"));d(this,"loadingBar",new Wa);d(this,"renderer");d(this,"timer");d(this,"worldUISpace");d(this,"skybox");d(this,"avatar");d(this,"cameraControl");d(this,"screenControl");d(this,"eventSystem");d(this,"_xrBinding",null);d(this,"_xrMediaBinding",null);d(this,"_hasXRMediaLayers",null);d(this,"_hasXRCompositionLayers",null);Gn(e)&&(e.style.backgroundColor="black"),this.renderer=new THREE.WebGLRenderer({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.tabIndex=1,this.cameraControl=new Ta(this.camera),this.screenControl=new cl(this.renderer,this.camera,this.renderer.domElement.parentElement,s),this.fader=new ja("ViewFader"),this.worldUISpace=new Ea("WorldUISpace",.2,20,.125),this.avatar=new wa(this.renderer,this.camera,this.fader,i),this.eventSystem=new Ga(this),this.skybox=new ul(this),this.timer=new dl(this.renderer),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let o=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",o),this.screenControl.addEventListener("sessionstopped",o),o(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),this.timer.addTickHandler(l=>this.update(l)),we(this.scene,this.sun,this.ambient,we(this.stage,this.ground,this.camera,this.avatar,...this.eventSystem.hands),this.foreground,we(this.worldUISpace,this.loadingBar)),this.timer.start(),globalThis.env=this}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.screenControl.visible){let n=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&x(n)?(this._xrMediaBinding=new XRMediaBinding(n),console.log("Media binding created")):this._xrMediaBinding=null);let i=n&&this.renderer.xr.getBaseLayer();i!==this.baseLayer&&(x(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),x(i)&&(this.baseLayer=i,this.addWebXRLayer(i,0))),this.screenControl.resize(),this.eventSystem.update(),this.cameraControl.update(e.dt),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeading,e.dt),this.fader.update(e.dt),rh(e.dt),this.loadingBar.update(e.sdt),this.preRender(e),this.skybox.update(e.frame);let s=Sr(this.renderer,this.camera);if(s!==this.camera){let o=s;o.layers.mask=this.camera.layers.mask;for(let l=0;l<o.cameras.length;++l){let u=o.cameras[l];u.layers.mask=this.camera.layers.mask,u.layers.enable(l+1),o.layers.enable(l+1)}}if(this.renderer.clear(),this.renderer.render(this.scene,this.camera),!this.renderer.xr.isPresenting)qm.copy(zu),this.renderer.getViewport(zu);else if(Ln()&&!ld()){pl.projectionMatrix.copy(this.camera.projectionMatrix),pl.position.copy(s.position),pl.quaternion.copy(s.quaternion);let o=this.renderer.getRenderTarget();this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(qm),this.renderer.clear(),this.renderer.render(this.scene,pl),this.renderer.setViewport(zu),this.renderer.setRenderTarget(o),this.renderer.xr.isPresenting=!0}}}preRender(e){}async onQuitting(){this.dispatchEvent(new G("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!Ut||cd.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&ae(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&ae(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,n){this.layers.push(e),this.layerSortOrder.set(e,n),zr(this.layers,i=>-this.layerSortOrder.get(i)),this.updateLayers()}removeWebXRLayer(e){this.layerSortOrder.delete(e),Ge(this.layers,e),this.updateLayers()}updateLayers(){let e=this.xrSession;x(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new G("sceneclearing")),Tr(this.foreground),this.dispatchEvent(new G("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(ui),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){--this.fadeDepth,this.fadeDepth===0&&(await this.fader.fadeOut(),this.camera.layers.set(Sa),this.skybox.visible=!0,await this.fader.fadeIn())}async loadModel(e,n){let s=await new Rr().loadAsync(e,o=>{n.report(o.loaded,o.total,e)});return s.scene.traverse(o=>{if(No(o)){o.isCollider=!0;let l=o.material;l.side=THREE.FrontSide,l.needsUpdate=!0}}),s.scene}async load3DCursor(e,n){let s=(await this.loadModel(e,n)).children.slice(0);for(let o of s)this.cursor3D.add(o.name,o);this.eventSystem.refreshCursors(),this.dispatchEvent(new G("newcursorloaded"))}async load(e){await this.load3DCursor("/models/Cursors.glb",e)}};var ml=class{constructor(t,e,n){this.name=t;this.callback=e;if(!ae(e))throw new Error("A function instance is required for this parameter");this.opts=n,Object.freeze(this)}applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function Zm(r,t){return new ml("click",r,t)}function vi(r,t){return new ml("input",r,t)}_t(q(".input-range-with-number",je("grid"),ao("column"),Pd("5px"),hr("1fr auto")));var Gu=class extends te{constructor(...e){super();this.element=ve(Ae("input-range-with-number"),this.rangeInput=np(...e),this.numberInput=rp()),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder,this.numberInput.addEventListener("input",()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}),this.rangeInput.addEventListener("input",()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new G("input"))})}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}};function ju(...r){return new Gu(...r)}var fl=class{constructor(t,...e){this.name=t;this.properties=e}};function Jm(r,...t){return new fl(r,...t)}_t(q("dl",je("grid"),ao("row"),hr("auto 1fr"),mr("1em")),q("dt",Xr(1),Kr("right"),kd("1em")),q("dd",Kr("left"),Xr(2),Dd("0")),q("dl > span, dl > div",Xr(1,3)),q("dl .alert",Et("20em")));var D1="DefaultPropertyGroup"+vt(16),gl=class{constructor(...t){this.rowGroups=new Map;this.element=Kd(...this.createElements(t))}append(...t){de(this.element,...this.createElements(t))}createElements(t){return t.flatMap(e=>this.createGroups(e).flatMap(Pn))}createGroups(t){let e=D1,n=new Array;return t instanceof fl?(e=t.name,n.push(...t.properties.map(i=>this.createRow(i)))):n.push(this.createRow(t)),this.rowGroups.has(e)||this.rowGroups.set(e,[]),this.rowGroups.get(e).push(...n),n}createRow(t){if(lt(t)){let[e,...n]=t,i=Zd(e);for(let s of n)if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement){s.id.length===0&&(s.id=vt(10)),i.htmlFor=s.id;break}return[Yd(i),Qd(...n)]}else return oe(t)||ce(t)||Le(t)||Bl(t)?[ve($d(t))]:[t]}setGroupVisible(t,e){let n=this.rowGroups.get(t);if(n)for(let i of n)for(let s of i)if($l(s))for(let o of s.elements)_e(o,e);else($r(s)||s instanceof HTMLElement)&&_e(s,e)}};var vl=class{constructor(t,e){this.name=t;this._level=0;this.maxLevel=0;this.analyzer=wp(this.name,e,{fftSize:32,minDecibels:-70}),this.buffer=new Uint8Array(this.analyzer.frequencyBinCount)}dispose(){re(this.analyzer)}get level(){return this.analyzer.getByteFrequencyData(this.buffer),this._level=Math.max(...this.buffer),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this._level}get input(){return this.analyzer}get output(){return this.analyzer}};var ef="micFields"+vt(8),El=class extends Zn{constructor(e){super("Configure devices");this.env=e;d(this,"micLookup",null);d(this,"spkrLookup",null);d(this,"microphones");d(this,"micScenario");d(this,"activity");d(this,"micVolumeControl");d(this,"spkrVolumeControl",null);d(this,"ready",null);d(this,"speakers",null);d(this,"properties");d(this,"testSpkrButton");d(this,"useHeadphones");d(this,"headphoneWarning");d(this,"timer",new no(30));d(this,"_showMic",!0);this.cancelButton.style.display="none";let n=this.env.audio.loadBasicClip("test-audio","/audio/test-clip.mp3",.5);de(this.container,ct(Fd("max-content"))),de(this.contentArea,this.properties=new gl(Jm(ef,"Input",["Microphones",this.microphones=Jl(vi(async()=>{let i=this.microphones.value,s=this.micLookup.get(i);await this.env.audio.devices.setAudioInputDevice(s)}))],["Input level",this.micScenario=Jd()],["Volume",this.micVolumeControl=ju(Wl(0),jl(100),Ql(1),Nn(0),vi(()=>{e.audio.input.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],"Output"))),this.env.audio.devices.addEventListener("audioinputchanged",i=>{this.microphones.value=i.audio&&i.audio.deviceId||""}),tt&&(this.properties.append(["Speakers",this.speakers=Jl(vi(async()=>{let i=this.speakers.value,s=this.spkrLookup.get(i);await this.env.audio.devices.setAudioOutputDevice(s)}))]),this.env.audio.devices.addEventListener("audiooutputchanged",i=>{this.speakers.value=i.device&&i.device.deviceId||""})),this.properties.append(["Using headphones",this.useHeadphones=tp(vi(()=>{this.env.audio.useHeadphones=this.useHeadphones.checked,_e(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block")})),this.testSpkrButton=mo("Test",kn("Test audio"),ct(Od("0.5em")),Zm(async()=>{an(this.testSpkrButton,!1,"secondary"),await n,await this.env.audio.playClipThrough("test-audio"),an(this.testSpkrButton,!0,"secondary")}))],this.headphoneWarning=ve(Ae("alert alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones."),["Volume",this.spkrVolumeControl=ju(Wl(0),jl(100),Ql(1),Nn(0),vi(()=>e.audio.audioDestination.volume=this.spkrVolumeControl.valueAsNumber/100))]),this.activity=new vl("device-settings-dialog-activity",this.env.audio.audioCtx),this.timer.addTickHandler(()=>{this.micScenario.value=this.activity.level})}async load(){await this.env.audio.ready,await this.env.audio.devices.ready;let e=await this.env.audio.devices.getAudioInputDevices();if(this.micLookup=Cl(e,n=>n.deviceId),de(this.microphones,fo(Nn(""),"NONE"),...e.map(n=>fo(Nn(n.deviceId),n.label))),tt){let n=await this.env.audio.devices.getAudioOutputDevices();this.spkrLookup=Cl(n,i=>i.deviceId),de(this.speakers,...n.map(i=>fo(Nn(i.deviceId),i.label)))}xt(this.env.audio.input,this.activity)}async onShowing(){this.ready===null&&(this.ready=this.load()),await this.ready;let e=await this.env.audio.devices.getAudioInputDevice();if(this.microphones.value=e&&e.deviceId||"",this.micVolumeControl.valueAsNumber=this.env.audio.input.gain.value*100,tt){let n=await this.env.audio.devices.getAudioOutputDevice();this.speakers.value=n&&n.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.env.audio.audioDestination.volume*100,this.useHeadphones.checked=this.env.audio.useHeadphones,_e(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block"),this.timer.start(),await super.onShowing()}onClosed(){this.timer.stop(),super.onClosed()}get showMic(){return this._showMic}set showMic(e){e!==this.showMic&&(this._showMic=e,this.properties.setGroupVisible(ef,this.showMic))}};var Wu=class extends G{constructor(e){super("roomjoined");this.roomName=e}},xl=class extends hl{constructor(e,n,i,s,o,l,u){super(e,n,o,l);this.screenUISpace=new ia;this.envAudioToggleEvt=new G("environmentaudiotoggled");this._currentRoom=null;this._testSpaceLayout=!1;this.countTick=0;this.fpses=new Array;this.avgFPS=0;this.compassImage=new ai(this,"Horizon",new xo),this.compassImage.mesh.renderOrder=5,this.clockImage=new ai(this,"Clock",new Ao),this.clockImage.mesh.renderOrder=5,u=u||{};let m=u.JS_EXT||".js";this.DEBUG=u.DEBUG||!1,this.apps=new ma(this,m),this.apps.addEventListener("apploading",v=>{v.preLoadTask=this.fadeOut().then(()=>{this.clearScene(),this.avatar.reset()})}),this.apps.addEventListener("apploaded",v=>{v.app.addEventListener("joinroom",A=>{A.roomName!==this._currentRoom&&(this._currentRoom=A.roomName,this.dispatchEvent(new Wu(A.roomName)))})}),this.apps.addEventListener("appshown",async v=>{this.lobbyButton.visible=v.appName!=="menu",await this.fadeIn()}),this.audio=new Bo(Qp),this.audio.setAudioProperties(1,4,"exponential"),this.audioPlayer=new Fo(this.audio.audioCtx),this.videoPlayer=new da(this,this.audio.audioCtx),this.videoPlayer.object.visible=!1,this.interactionAudio=new na(this.audio,this.eventSystem),this.confirmationDialog=new ra(this,i),this.devicesDialog=new El(this),de(this.renderer.domElement.parentElement,this.screenUISpace,this.confirmationDialog,this.devicesDialog),this.uiButtons=new Ho(this.fetcher,s,20),this.settingsButton=new oi(this.uiButtons,"ui","settings"),this.quitButton=new oi(this.uiButtons,"ui","quit"),this.lobbyButton=new oi(this.uiButtons,"ui","lobby"),this.muteMicButton=new ln(this.uiButtons,"microphone","mute","unmute"),this.muteEnvAudioButton=new ln(this.uiButtons,"environment-audio","mute","unmute"),this.vrButton=new os(this.uiButtons,"VR"),this.fullscreenButton=new os(this.uiButtons,"Fullscreen"),this.xrUI=new sa,this.xrUI.addItem(this.clockImage,{x:-1,y:1,scale:1}),this.xrUI.addItem(this.quitButton,{x:1,y:1,scale:.5}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.settingsButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.muteMicButton,{x:-.84,y:-1,scale:.5}),this.xrUI.addItem(this.muteEnvAudioButton,{x:-.68,y:-1,scale:.5}),this.xrUI.addItem(this.lobbyButton,{x:-.473,y:-1,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.fullscreenButton,{x:1,y:-1,scale:.5}),this.worldUISpace.add(this.xrUI),de(this.screenUISpace.topRowLeft,this.compassImage,this.clockImage),de(this.screenUISpace.topRowRight,this.quitButton),de(this.screenUISpace.bottomRowLeft,this.settingsButton,this.muteMicButton,this.muteEnvAudioButton,this.lobbyButton),de(this.screenUISpace.bottomRowRight,this.fullscreenButton,this.vrButton),jn.isAvailable&&ki()&&(this.batteryImage=new ai(this,"Battery",new jn),this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,scale:1}),de(this.screenUISpace.topRowRight,this.batteryImage)),this.vrButton.visible=Ln()&&Ks()||Mt(),this.lobbyButton.visible=!1,this.muteMicButton.visible=!1,this.screenControl.setUI(this.screenUISpace,this.fullscreenButton,this.vrButton),this.refreshSpaceUI(),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.lobbyButton.addEventListener("click",()=>this.withConfirmation("Confirm return to lobby","Are you sure you want to return to the lobby?",()=>this.dispatchEvent(new G("home")))),this.settingsButton.addEventListener("click",async()=>{let v=this.screenControl.currentMode,A=this.renderer.xr.isPresenting;A&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),A&&await this.screenControl.start(v)});let f=()=>this.refreshSpaceUI();this.screenControl.addEventListener("sessionstarted",f),this.screenControl.addEventListener("sessionstopped",f),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.avatar.addEventListener("avatarmoved",v=>this.audio.setUserPose(this.audio.localUserID,v.px,v.py,v.pz,v.fx,v.fy,v.fz,v.ux,v.uy,v.uz))}get currentRoom(){return this._currentRoom}refreshSpaceUI(){this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.clockImage.isVisible=this.xrUI.visible||this.DEBUG}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e,this.refreshSpaceUI())}preRender(e){if(super.preRender(e),this.audio.update(),this.videoPlayer.update(e.dt,e.frame),this.compassImage.image.setPitchAndHeading($s(this.avatar.worldPitch),$s(this.avatar.worldHeading)),this.DEBUG){let n=Math.round(e.fps);if(this.avgFPS+=n/100,this.fpses.push(n),this.fpses.length>100){let i=this.fpses.shift();this.avgFPS-=i/100}++this.countTick%100===0&&(this.clockImage.image.fps=this.avgFPS)}this.confirmationDialog.update(e.dt);for(let n of this.apps)n.update(e)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,n,i){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,n)&&i(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){_c(this.quitButton,!e,"primary"),_c(this.lobbyButton,!e,"primary")}async load(e){await to(e,n=>super.load(n),n=>this.uiButtons.load(n),n=>this.audio.loadBasicClip("footsteps","/audio/TransitionFootstepAudio.mp3",.5,n),n=>this.interactionAudio.load("enter","/audio/basic_enter.mp3",.25,n),n=>this.interactionAudio.load("exit","/audio/basic_exit.mp3",.25,n),n=>this.interactionAudio.load("error","/audio/basic_error.mp3",.25,n),n=>this.interactionAudio.load("click","/audio/vintage_radio_button_pressed.mp3",1,n))}};var i6=xl;export{i6 as default};
//# sourceMappingURL=index.min.js.map
