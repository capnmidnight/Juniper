var Oa=Object.create;var gr=Object.defineProperty;var Na=Object.getOwnPropertyDescriptor;var Ua=Object.getOwnPropertyNames;var za=Object.getPrototypeOf,Va=Object.prototype.hasOwnProperty;var Be=(n=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(n,{get:(e,t)=>(typeof require!="undefined"?require:e)[t]}):n)(function(n){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});var Ga=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),$e=(n,e)=>{for(var t in e)gr(n,t,{get:e[t],enumerable:!0})},ja=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ua(e))!Va.call(n,o)&&o!==t&&gr(n,o,{get:()=>e[o],enumerable:!(r=Na(e,o))||r.enumerable});return n};var No=(n,e,t)=>(t=n!=null?Oa(za(n)):{},ja(e||!n||!n.__esModule?gr(t,"default",{value:n,enumerable:!0}):t,n));var uo=Ga((Bg,so)=>{"use strict";var h={};h.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};h.localCName=h.generateIdentifier();h.splitLines=function(n){return n.trim().split(`
`).map(e=>e.trim())};h.splitSections=function(n){return n.split(`
m=`).map((t,r)=>(r>0?"m="+t:t).trim()+`\r
`)};h.getDescription=function(n){let e=h.splitSections(n);return e&&e[0]};h.getMediaSections=function(n){let e=h.splitSections(n);return e.shift(),e};h.matchPrefix=function(n,e){return h.splitLines(n).filter(t=>t.indexOf(e)===0)};h.parseCandidate=function(n){let e;n.indexOf("a=candidate:")===0?e=n.substring(12).split(" "):e=n.substring(10).split(" ");let t={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let r=8;r<e.length;r+=2)switch(e[r]){case"raddr":t.relatedAddress=e[r+1];break;case"rport":t.relatedPort=parseInt(e[r+1],10);break;case"tcptype":t.tcpType=e[r+1];break;case"ufrag":t.ufrag=e[r+1],t.usernameFragment=e[r+1];break;default:t[e[r]]===void 0&&(t[e[r]]=e[r+1]);break}return t};h.writeCandidate=function(n){let e=[];e.push(n.foundation);let t=n.component;t==="rtp"?e.push(1):t==="rtcp"?e.push(2):e.push(t),e.push(n.protocol.toUpperCase()),e.push(n.priority),e.push(n.address||n.ip),e.push(n.port);let r=n.type;return e.push("typ"),e.push(r),r!=="host"&&n.relatedAddress&&n.relatedPort&&(e.push("raddr"),e.push(n.relatedAddress),e.push("rport"),e.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(e.push("ufrag"),e.push(n.usernameFragment||n.ufrag)),"candidate:"+e.join(" ")};h.parseIceOptions=function(n){return n.substr(14).split(" ")};h.parseRtpMap=function(n){let e=n.substr(9).split(" "),t={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),t.name=e[0],t.clockRate=parseInt(e[1],10),t.channels=e.length===3?parseInt(e[2],10):1,t.numChannels=t.channels,t};h.writeRtpMap=function(n){let e=n.payloadType;n.preferredPayloadType!==void 0&&(e=n.preferredPayloadType);let t=n.channels||n.numChannels||1;return"a=rtpmap:"+e+" "+n.name+"/"+n.clockRate+(t!==1?"/"+t:"")+`\r
`};h.parseExtmap=function(n){let e=n.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}};h.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`};h.parseFmtp=function(n){let e={},t,r=n.substr(n.indexOf(" ")+1).split(";");for(let o=0;o<r.length;o++)t=r[o].trim().split("="),e[t[0].trim()]=t[1];return e};h.writeFmtp=function(n){let e="",t=n.payloadType;if(n.preferredPayloadType!==void 0&&(t=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){let r=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?r.push(o+"="+n.parameters[o]):r.push(o)}),e+="a=fmtp:"+t+" "+r.join(";")+`\r
`}return e};h.parseRtcpFb=function(n){let e=n.substr(n.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}};h.writeRtcpFb=function(n){let e="",t=n.payloadType;return n.preferredPayloadType!==void 0&&(t=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(r=>{e+="a=rtcp-fb:"+t+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),e};h.parseSsrcMedia=function(n){let e=n.indexOf(" "),t={ssrc:parseInt(n.substr(7,e-7),10)},r=n.indexOf(":",e);return r>-1?(t.attribute=n.substr(e+1,r-e-1),t.value=n.substr(r+1)):t.attribute=n.substr(e+1),t};h.parseSsrcGroup=function(n){let e=n.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(t=>parseInt(t,10))}};h.getMid=function(n){let e=h.matchPrefix(n,"a=mid:")[0];if(e)return e.substr(6)};h.parseFingerprint=function(n){let e=n.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}};h.getDtlsParameters=function(n,e){let t=h.matchPrefix(n+e,"a=fingerprint:");return{role:"auto",fingerprints:t.map(h.parseFingerprint)}};h.writeDtlsParameters=function(n,e){let t="a=setup:"+e+`\r
`;return n.fingerprints.forEach(r=>{t+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),t};h.parseCryptoLine=function(n){let e=n.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}};h.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?h.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`};h.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;let e=n.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}};h.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")};h.getCryptoParameters=function(n,e){return h.matchPrefix(n+e,"a=crypto:").map(h.parseCryptoLine)};h.getIceParameters=function(n,e){let t=h.matchPrefix(n+e,"a=ice-ufrag:")[0],r=h.matchPrefix(n+e,"a=ice-pwd:")[0];return t&&r?{usernameFragment:t.substr(12),password:r.substr(10)}:null};h.writeIceParameters=function(n){let e="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(e+=`a=ice-lite\r
`),e};h.parseRtpParameters=function(n){let e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=h.splitLines(n)[0].split(" ");for(let o=3;o<r.length;o++){let i=r[o],a=h.matchPrefix(n,"a=rtpmap:"+i+" ")[0];if(a){let s=h.parseRtpMap(a),u=h.matchPrefix(n,"a=fmtp:"+i+" ");switch(s.parameters=u.length?h.parseFmtp(u[0]):{},s.rtcpFeedback=h.matchPrefix(n,"a=rtcp-fb:"+i+" ").map(h.parseRtcpFb),e.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(s.name.toUpperCase());break;default:break}}}return h.matchPrefix(n,"a=extmap:").forEach(o=>{e.headerExtensions.push(h.parseExtmap(o))}),e};h.writeRtpDescription=function(n,e){let t="";t+="m="+n+" ",t+=e.codecs.length>0?"9":"0",t+=" UDP/TLS/RTP/SAVPF ",t+=e.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,t+=`c=IN IP4 0.0.0.0\r
`,t+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(o=>{t+=h.writeRtpMap(o),t+=h.writeFmtp(o),t+=h.writeRtcpFb(o)});let r=0;return e.codecs.forEach(o=>{o.maxptime>r&&(r=o.maxptime)}),r>0&&(t+="a=maxptime:"+r+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(o=>{t+=h.writeExtmap(o)}),t};h.parseRtpEncodingParameters=function(n){let e=[],t=h.parseRtpParameters(n),r=t.fecMechanisms.indexOf("RED")!==-1,o=t.fecMechanisms.indexOf("ULPFEC")!==-1,i=h.matchPrefix(n,"a=ssrc:").map(l=>h.parseSsrcMedia(l)).filter(l=>l.attribute==="cname"),a=i.length>0&&i[0].ssrc,s,u=h.matchPrefix(n,"a=ssrc-group:FID").map(l=>l.substr(17).split(" ").map(d=>parseInt(d,10)));u.length>0&&u[0].length>1&&u[0][0]===a&&(s=u[0][1]),t.codecs.forEach(l=>{if(l.name.toUpperCase()==="RTX"&&l.parameters.apt){let p={ssrc:a,codecPayloadType:parseInt(l.parameters.apt,10)};a&&s&&(p.rtx={ssrc:s}),e.push(p),r&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},e.push(p))}}),e.length===0&&a&&e.push({ssrc:a});let c=h.matchPrefix(n,"b=");return c.length&&(c[0].indexOf("b=TIAS:")===0?c=parseInt(c[0].substr(7),10):c[0].indexOf("b=AS:")===0?c=parseInt(c[0].substr(5),10)*1e3*.95-50*40*8:c=void 0,e.forEach(l=>{l.maxBitrate=c})),e};h.parseRtcpParameters=function(n){let e={},t=h.matchPrefix(n,"a=ssrc:").map(i=>h.parseSsrcMedia(i)).filter(i=>i.attribute==="cname")[0];t&&(e.cname=t.value,e.ssrc=t.ssrc);let r=h.matchPrefix(n,"a=rtcp-rsize");e.reducedSize=r.length>0,e.compound=r.length===0;let o=h.matchPrefix(n,"a=rtcp-mux");return e.mux=o.length>0,e};h.writeRtcpParameters=function(n){let e="";return n.reducedSize&&(e+=`a=rtcp-rsize\r
`),n.mux&&(e+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(e+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),e};h.parseMsid=function(n){let e,t=h.matchPrefix(n,"a=msid:");if(t.length===1)return e=t[0].substr(7).split(" "),{stream:e[0],track:e[1]};let r=h.matchPrefix(n,"a=ssrc:").map(o=>h.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(r.length>0)return e=r[0].value.split(" "),{stream:e[0],track:e[1]}};h.parseSctpDescription=function(n){let e=h.parseMLine(n),t=h.matchPrefix(n,"a=max-message-size:"),r;t.length>0&&(r=parseInt(t[0].substr(19),10)),isNaN(r)&&(r=65536);let o=h.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:e.fmt,maxMessageSize:r};let i=h.matchPrefix(n,"a=sctpmap:");if(i.length>0){let a=i[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:r}}};h.writeSctpDescription=function(n,e){let t=[];return n.protocol!=="DTLS/SCTP"?t=["m="+n.kind+" 9 "+n.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:t=["m="+n.kind+" 9 "+n.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&t.push("a=max-message-size:"+e.maxMessageSize+`\r
`),t.join("")};h.generateSessionId=function(){return Math.random().toString().substr(2,21)};h.writeSessionBoilerplate=function(n,e,t){let r,o=e!==void 0?e:2;return n?r=n:r=h.generateSessionId(),`v=0\r
o=`+(t||"thisisadapterortc")+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`};h.getDirection=function(n,e){let t=h.splitLines(n);for(let r=0;r<t.length;r++)switch(t[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return t[r].substr(2);default:}return e?h.getDirection(e):"sendrecv"};h.getKind=function(n){return h.splitLines(n)[0].split(" ")[0].substr(2)};h.isRejected=function(n){return n.split(" ",2)[1]==="0"};h.parseMLine=function(n){let t=h.splitLines(n)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}};h.parseOLine=function(n){let t=h.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}};h.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;let e=h.splitLines(n);for(let t=0;t<e.length;t++)if(e[t].length<2||e[t].charAt(1)!=="=")return!1;return!0};typeof so=="object"&&(so.exports=h)});function Ka(n){return n}function Uo(n,e,t){let r=0,o=n.length,i=Math.floor((r+o)/2),a=!1;for(;r<o&&i<n.length;){let s=n[i],u=S(s)?null:t(s);m(u)&&e<u?o=i:(e===u&&(a=!0),r=i+1),i=Math.floor((r+o)/2)}return a||(i+=.5),i}function fr(n,e,t){t=t||Ka;let r=t(e);return Uo(n,r,t)}function qe(n,e){return n.splice(e,1)[0]}function ae(n){return n.splice(0)}function zo(n,e){for(let t=0;t<n.length;++t)if(n[t]!==e[t])return t;return-1}function Et(n,e,t){n.splice(t,0,e)}function X(n,e){let t=n.indexOf(e);return t>-1?(qe(n,t),!0):!1}function Vo(n,...e){for(let t of e)for(let r of n)if(t(r))return r;return null}function Go(n,e,t,r){let o;return W(t)?o=t:se(t)&&(r=t),S(r)&&(r=!0),$a(n,e,o,r)}function $a(n,e,t,r){let o=fr(n,e,t),i=o%1===0;return o=o|0,(!i||r)&&Et(n,e,o),o}var Je=class{constructor(e){this.value=e;this._forward=new Array;this._reverse=new Array}connectSorted(e,t){m(t)?(Go(this._forward,e,r=>t(r.value)),e._reverse.push(this)):this.connectTo(e)}connectTo(e){this.connectAt(e,this._forward.length)}connectAt(e,t){Et(this._forward,e,t),e._reverse.push(this)}disconnectFrom(e){X(this._forward,e),X(e._reverse,this)}isConnectedTo(e){return this._forward.indexOf(e)>=0||this._reverse.indexOf(e)>=0}flatten(){let e=new Set,t=[this];for(;t.length>0;){let r=t.shift();m(r)&&!e.has(r)&&(e.add(r),t.push(...r._forward))}return Array.from(e)}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var Mt=class extends Je{connectTo(e){super.connectTo(e)}connectAt(e,t){super.connectAt(e,t)}connectSorted(e,t){super.connectSorted(e,t)}disconnectFrom(e){super.disconnectFrom(e)}isConnectedTo(e){return super.isConnectedTo(e)}flatten(){return super.flatten()}get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};var jo=class{constructor(e){this.items=new Map;this.defaultItems=new Array;if(m(e))for(let[t,r]of e)this.add(t,r)}add(e,t){if(S(e))this.defaultItems.push(t);else{let r=this.items.get(e);S(r)&&this.items.set(e,r=[]),r.push(t)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let e of this.defaultItems)yield e;for(let e of this.items.values())for(let t of e)yield t}has(e){return m(e)?this.items.has(e):this.defaultItems.length>0}get(e){return S(e)?this.defaultItems:this.items.get(e)||[]}count(e){if(S(e))return this.defaultItems.length;let t=this.get(e);return m(t)?t.length:0}get size(){let e=this.defaultItems.length;for(let t of this.items.values())e+=t.length;return e}delete(e){return S(e)?ae(this.defaultItems).length>0:this.items.delete(e)}remove(e,t){if(S(e))X(this.defaultItems,t);else{let r=this.items.get(e);m(r)&&(X(r,t),r.length===0&&this.items.delete(e))}}clear(){this.items.clear(),ae(this.defaultItems)}};var bt=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(e,t,r){if(W(t)){let o=this.listeners.get(e);o||(o=new Array,this.listeners.set(e,o)),o.find(i=>i===t)||(o.push(t),r&&this.listenerOptions.set(t,r))}}removeEventListener(e,t){if(W(t)){let r=this.listeners.get(e);r&&this.removeListener(r,t)}}clearEventListeners(e){for(let[t,r]of this.listeners)if(S(e)||e===t){for(let o of r)this.removeEventListener(e,o);ae(r),this.listeners.delete(t)}}removeListener(e,t){let r=e.findIndex(o=>o===t);r>=0&&(qe(e,r),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(e){let t=this.listeners.get(e.type);if(t)for(let r of t){let o=this.listenerOptions.get(r);m(o)&&!se(o)&&o.once&&this.removeListener(t,r),r.call(this,e)}return!e.defaultPrevented}},we=class extends Event{get type(){return super.type}constructor(e){super(e)}},U=class extends bt{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(t){this.bubblers.add(t)}removeBubbler(t){this.bubblers.delete(t)}addEventListener(t,r,o){super.addEventListener(t,r,o)}removeEventListener(t,r){super.removeEventListener(t,r)}clearEventListeners(t){return super.clearEventListeners(t)}addScopedEventListener(t,r,o,i){this.scopes.has(t)||this.scopes.set(t,[]),this.scopes.get(t).push([r,o]),this.addEventListener(r,o,i)}removeScope(t){let r=this.scopes.get(t);if(r){this.scopes.delete(t);for(let[o,i]of r)this.removeEventListener(o,i)}}dispatchEvent(t){if(!super.dispatchEvent(t))return!1;for(let r of this.bubblers)if(!r.dispatchEvent(t))return!1;return!0}};var ue=class{constructor(e,t,r=!0){this._resolve=null;this._reject=null;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;let o=Ct,i=Ct;W(e)&&(o=e),W(t)&&(i=t),se(e)?r=e:se(t)&&(r=t),this.resolve=a=>{m(this._resolve)&&this._resolve(a)},this.reject=a=>{m(this._reject)&&this._reject(a)},this.promise=new Promise((a,s)=>{this._resolve=u=>{o(u)&&(this._result=u,this._finished=!0,a(u))},this._reject=u=>{i(u)&&(this._error=u,this._finished=!0,s(u))}}),r&&this.start()}get result(){if(m(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}start(){this._started=!0}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var Ko=class{constructor(e,t,r){this.callback=null;this.promise=new Promise((o,i)=>{this.callback=(...a)=>{e(...a)?o(t(...a)):i(r(...a))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};function xr(n){let e=new ue(n),t=setInterval(()=>{n()&&(clearInterval(t),e.resolve())},100);return e}var Ya=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,yt=navigator.userAgent.match(Ya),vt=!!yt,ap=vt&&{major:parseFloat(yt[1]),minor:parseFloat(yt[2]),patch:parseFloat(yt[3])},sp=vt&&/pacific/i.test(navigator.userAgent),up=vt&&/quest/i.test(navigator.userAgent),cp=vt&&/quest 2/i.test(navigator.userAgent);var lp=!("Document"in globalThis);var Qa=298.257223563,Xa=6378137;var wr=1/Qa,Bt=1-wr,T=wr/(2-wr),Fp=Xa/(1+T)*(1+T*T/4+T*T*T*T/64),Lt=Math.sqrt(1-Bt*Bt),$=1-Bt*Bt,mp=Lt*Lt/(1-Lt*Lt),dp=1-$*(.25+$*(3/64+5*$/256)),hp=$*(3/8+$*(3/32+45*$/1024)),gp=$*$*(15/256+$*45/1024),fp=$*$*$*(35/3072),xp=[T/2-2*T*T/3+37*T*T*T/96,T*T/48+T*T*T/15,17*T*T*T/480],wp=[2*T-2*T*T/3,7*T*T/3-8*T*T*T/5,56*T*T*T/15];var Rt=1e-6,Ye=typeof Float32Array<"u"?Float32Array:Array,Sr=Math.random;var Tp=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var _={};$e(_,{add:()=>os,angle:()=>Cs,bezier:()=>xs,ceil:()=>is,clone:()=>es,copy:()=>ns,create:()=>$o,cross:()=>hs,dist:()=>_s,distance:()=>Xo,div:()=>Ps,divide:()=>Qo,dot:()=>ti,equals:()=>Ls,exactEquals:()=>vs,floor:()=>as,forEach:()=>Ws,fromValues:()=>ts,hermite:()=>fs,inverse:()=>ms,len:()=>Is,length:()=>qo,lerp:()=>gs,max:()=>us,min:()=>ss,mul:()=>Rs,multiply:()=>Yo,negate:()=>Fs,normalize:()=>ds,random:()=>ws,rotateX:()=>Es,rotateY:()=>Ms,rotateZ:()=>bs,round:()=>cs,scale:()=>ls,scaleAndAdd:()=>ps,set:()=>rs,sqrDist:()=>As,sqrLen:()=>Hs,squaredDistance:()=>Zo,squaredLength:()=>ei,str:()=>ys,sub:()=>Bs,subtract:()=>Jo,transformMat3:()=>Ts,transformMat4:()=>Ss,transformQuat:()=>ks,zero:()=>Ds});function $o(){var n=new Ye(3);return Ye!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function es(n){var e=new Ye(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function qo(n){var e=n[0],t=n[1],r=n[2];return Math.hypot(e,t,r)}function ts(n,e,t){var r=new Ye(3);return r[0]=n,r[1]=e,r[2]=t,r}function ns(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function rs(n,e,t,r){return n[0]=e,n[1]=t,n[2]=r,n}function os(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function Jo(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function Yo(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function Qo(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}function is(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n}function as(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n}function ss(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n}function us(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n}function cs(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n}function ls(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function ps(n,e,t,r){return n[0]=e[0]+t[0]*r,n[1]=e[1]+t[1]*r,n[2]=e[2]+t[2]*r,n}function Xo(n,e){var t=e[0]-n[0],r=e[1]-n[1],o=e[2]-n[2];return Math.hypot(t,r,o)}function Zo(n,e){var t=e[0]-n[0],r=e[1]-n[1],o=e[2]-n[2];return t*t+r*r+o*o}function ei(n){var e=n[0],t=n[1],r=n[2];return e*e+t*t+r*r}function Fs(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function ms(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}function ds(n,e){var t=e[0],r=e[1],o=e[2],i=t*t+r*r+o*o;return i>0&&(i=1/Math.sqrt(i)),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function ti(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function hs(n,e,t){var r=e[0],o=e[1],i=e[2],a=t[0],s=t[1],u=t[2];return n[0]=o*u-i*s,n[1]=i*a-r*u,n[2]=r*s-o*a,n}function gs(n,e,t,r){var o=e[0],i=e[1],a=e[2];return n[0]=o+r*(t[0]-o),n[1]=i+r*(t[1]-i),n[2]=a+r*(t[2]-a),n}function fs(n,e,t,r,o,i){var a=i*i,s=a*(2*i-3)+1,u=a*(i-2)+i,c=a*(i-1),l=a*(3-2*i);return n[0]=e[0]*s+t[0]*u+r[0]*c+o[0]*l,n[1]=e[1]*s+t[1]*u+r[1]*c+o[1]*l,n[2]=e[2]*s+t[2]*u+r[2]*c+o[2]*l,n}function xs(n,e,t,r,o,i){var a=1-i,s=a*a,u=i*i,c=s*a,l=3*i*s,p=3*u*a,d=u*i;return n[0]=e[0]*c+t[0]*l+r[0]*p+o[0]*d,n[1]=e[1]*c+t[1]*l+r[1]*p+o[1]*d,n[2]=e[2]*c+t[2]*l+r[2]*p+o[2]*d,n}function ws(n,e){e=e||1;var t=Sr()*2*Math.PI,r=Sr()*2-1,o=Math.sqrt(1-r*r)*e;return n[0]=Math.cos(t)*o,n[1]=Math.sin(t)*o,n[2]=r*e,n}function Ss(n,e,t){var r=e[0],o=e[1],i=e[2],a=t[3]*r+t[7]*o+t[11]*i+t[15];return a=a||1,n[0]=(t[0]*r+t[4]*o+t[8]*i+t[12])/a,n[1]=(t[1]*r+t[5]*o+t[9]*i+t[13])/a,n[2]=(t[2]*r+t[6]*o+t[10]*i+t[14])/a,n}function Ts(n,e,t){var r=e[0],o=e[1],i=e[2];return n[0]=r*t[0]+o*t[3]+i*t[6],n[1]=r*t[1]+o*t[4]+i*t[7],n[2]=r*t[2]+o*t[5]+i*t[8],n}function ks(n,e,t){var r=t[0],o=t[1],i=t[2],a=t[3],s=e[0],u=e[1],c=e[2],l=o*c-i*u,p=i*s-r*c,d=r*u-o*s,g=o*d-i*p,f=i*l-r*d,w=r*p-o*l,D=a*2;return l*=D,p*=D,d*=D,g*=2,f*=2,w*=2,n[0]=s+l+g,n[1]=u+p+f,n[2]=c+d+w,n}function Es(n,e,t,r){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function Ms(n,e,t,r){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function bs(n,e,t,r){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function Cs(n,e){var t=n[0],r=n[1],o=n[2],i=e[0],a=e[1],s=e[2],u=Math.sqrt(t*t+r*r+o*o),c=Math.sqrt(i*i+a*a+s*s),l=u*c,p=l&&ti(n,e)/l;return Math.acos(Math.min(Math.max(p,-1),1))}function Ds(n){return n[0]=0,n[1]=0,n[2]=0,n}function ys(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function vs(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}function Ls(n,e){var t=n[0],r=n[1],o=n[2],i=e[0],a=e[1],s=e[2];return Math.abs(t-i)<=Rt*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(r-a)<=Rt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(o-s)<=Rt*Math.max(1,Math.abs(o),Math.abs(s))}var Bs=Jo,Rs=Yo,Ps=Qo,_s=Xo,As=Zo,Is=qo,Hs=ei,Ws=function(){var n=$o();return function(e,t,r,o,i,a){var s,u;for(t||(t=3),r||(r=0),o?u=Math.min(o*t+r,e.length):u=e.length,s=r;s<u;s+=t)n[0]=e[s],n[1]=e[s+1],n[2]=e[s+2],i(n,n,a),e[s]=n[0],e[s+1]=n[1],e[s+2]=n[2];return e}}();function Ct(){return!0}var kr=2*Math.PI;function ni(n){return(n%kr+kr)%kr}function Er(n,e,t){return Math.min(t,Math.max(e,n))}function Tr(n){return n*Math.PI/180}function Mr(n,e,t){return n*(t-e)+e}function ri(n,e,t){return(1-t)*n+t*e}var Qe=class extends U{constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(t,r,o,i){this.soFar=t,this.total=r,this.msg=o,this.est=i;for(let a of this.attached)a.report(t,r,o,i)}attach(t){this.attached.push(t),t.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(t){this.report(0,1,t||"starting")}end(t){this.report(1,1,t||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,ae(this.attached)}};var Xe=class extends Qe{constructor(t,r){super();this.i=t;this.prog=r}report(t,r,o,i){super.report(t,r,o,i),this.prog.update(this.i,t,r,o)}};var Ze=class{constructor(e){this.prog=e;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new Xe(t,this)}addSubProgress(e){e=e||1,this.weightTotal+=e,this.subProgressWeights.push(e),this.subProgressValues.push(0);let t=new Xe(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(e,t,r,o){if(this.prog){this.subProgressValues[e]=t/r;let i=0;for(let c=0;c<this.subProgressWeights.length;++c)i+=this.subProgressValues[c]*this.subProgressWeights[c];let a=performance.now(),s=a-this.start,u=this.start-a+s*this.weightTotal/i;this.prog.report(i,this.weightTotal,o,u)}}};function Cr(n,e){return new br(e,n).subProgressCallbacks}var br=class extends Ze{constructor(e,t){super(t);for(let r of e)this.addSubProgress(r)}};async function Ns(n,e){let t=new Array(e.length),r=new Array(e.length);for(let a=0;a<e.length;++a){let s=e[a];t[a]=s[0],r[a]=s[1]}let o=Cr(n,t),i=new Array(e.length);for(let a=0;a<e.length;++a)i[a]=r[a](o[a]);return await Promise.all(i)}function oi(n,...e){let t=e.map(r=>[1,r]);return Ns(n,t)}function Pt(n,e,t){return typeof n===e||n instanceof t}function W(n){return Pt(n,"function",Function)}function se(n){return Pt(n,"boolean",Boolean)}function O(n){return Pt(n,"number",Number)}function Fe(n){return m(n)&&Pt(n,"object",Object)}function Se(n){return n instanceof Array}function Re(n,e){throw new Error((e||"Unexpected object: ")+n)}function S(n){return n==null}function m(n){return!S(n)}function ii(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Q(n,e){let t=globalThis,r=t[n];if(S(r)){if(S(e))throw new Error(`No value ${n} found`);r=e(),t[n]=r}return r}var Dr=class{constructor(){this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(e,t){this.t=e,this.dt=t,this.sdt=ri(this.sdt,t,.01),t>0&&(this.fps=1e3/t)}},_t=class extends Dr{constructor(){super(),Object.seal(this)}};var Pe=class{constructor(e){this.timer=null;this.lt=-1;this.tickHandlers=new Array;this._targetFPS=null;this.targetFPS=e;let t=new _t,r=0;this.onTick=o=>{this.lt>=0&&(r=o-this.lt,t.set(o,r),this.tick(t)),this.lt=o}}get targetFPS(){return this._targetFPS}set targetFPS(e){this._targetFPS=e}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){X(this.tickHandlers,e)}tick(e){for(let t of this.tickHandlers)t(e)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var At=class extends Pe{constructor(e){super(e)}start(){this.timer=setInterval(()=>this.onTick(performance.now()),this.targetFrameTime)}stop(){this.timer&&(clearInterval(this.timer),super.stop())}get targetFPS(){return super.targetFPS}set targetFPS(e){super.targetFPS=e,this.isRunning&&this.restart()}};function yr(n){let e=new Map;for(let[t,r]of n)e.set(r,t);return e}var Us=new Map([[1,"KiB"],[2,"MiB"],[3,"GiB"],[4,"TiB"]]),zs=new Map([[1,"KB"],[2,"MB"],[3,"GB"],[4,"TB"]]),Gm=yr(Us),jm=yr(zs);var ai=304.79999999999995,$m=ai*3,Vs=10*100,Gs=ai*16.5,js=Gs*40,qm=Vs*1e3,Jm=js*8,si=2.54*4,ui=si*3,Ym=ui*3,Ks=ui*16.5,$s=Ks*40,Qm=100*1e3,Xm=$s*8,vr=4*3,qs=vr*3,et=100/2.54,Js=vr*16.5,Ys=Js*40,Zm=et*1e3,ed=Ys*8,td=3*3,Qs=100/si,Xs=3*16.5,Zs=Xs*40,nd=Qs*1e3,rd=Zs*8,ci=et/vr,eu=16.5*40,od=ci*1e3,id=eu*8,tu=et/qs,nu=16.5/3,ru=nu*40,ad=tu*1e3,sd=ru*8,li=16.5/ci,pi=li*40,ud=pi*8,cd=1e3/li,ld=40*8,ou=1e3/pi,pd=8/ou;function Fi(n){return n/et}function mi(n){return n*et}function Lr(n){return m(n)&&n.length>0?parseFloat(n):null}var di=class{constructor(e,t){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;e!==void 0&&(this._url=new URL(e,t),this.rehydrate())}rehydrate(){m(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),m(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),m(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),m(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),m(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),m(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),m(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),m(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[e,t]of this._query)this._url.searchParams.set(e,t);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=Lr(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((e,t)=>this._query.set(t,e))}refresh(){if(this._url===null){if(m(this._protocol)&&(m(this._host)||m(this._hostName))){if(m(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=Lr(this._url.port),this.rehydrate(),!1;if(m(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(m(this._pathName)&&m(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return m(this._url)}base(e){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=e,this.refresh(),this}protocol(e){return this._protocol=e,this.refresh()&&(this._url.protocol=e),this}host(e){return this._host=e,this.refresh()&&(this._url.host=e,this._hostName=this._url.hostname,this._port=Lr(this._url.port)),this}hostName(e){return this._hostName=e,this.refresh()&&(this._url.hostname=e,this._host=`${this._url.hostname}:${this._url.port}`),this}port(e){return this._port=e,this.refresh()&&(this._url.port=e.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(e){return this._userName=e,this.refresh()&&(this._url.username=e),this}password(e){return this._password=e,this.refresh()&&(this._url.password=e),this}path(e){return this._pathName=e,this.refresh()&&(this._url.pathname=e),this}pathPop(e){return e=e||/\/[^\/]+\/?$/,this.path(this._pathName.replace(e,""))}pathPush(e){let t=this._pathName;return t.endsWith("/")||(t+="/"),t+=e,this.path(t)}query(e,t){return this._query.set(e,t),this.refresh()&&this._url.searchParams.set(e,t),this}hash(e){return this._hash=e,this.refresh()&&(this._url.hash=e),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function Br(n,...e){if(!Fe(n))return!1;n=n;for(let t of e){if(!(t in n))return!1;let r=n[t];if(!W(r))return!1}return!0}function iu(n){return Br(n,"dispose")}function au(n){return Br(n,"destroy")}function su(n){return Br(n,"close")}function hi(n){iu(n)&&n.dispose(),su(n)&&n.close(),au(n)&&n.destroy()}var uu="AudioContext"in globalThis,fi=uu&&"AudioListener"in globalThis,Gd=fi&&"setPosition"in AudioListener.prototype,jd=fi&&"positionX"in AudioListener.prototype,Kd=W(HTMLMediaElement.prototype.captureStream)||W(HTMLMediaElement.prototype.mozCaptureStream);function xi(n){return m(n)&&n.node instanceof AudioNode}function wi(n){return m(n)&&n.input instanceof AudioNode&&n.output instanceof AudioNode}var me=Q("Juniper:Audio:connections",()=>new Map),Rr=Q("Juniper:Audio:names",()=>new Map);function Si(n){return wi(n)?n.output:xi(n)?n.node:n}function Ti(n){if(S(n))return;let e=null;Se(n)?n.length===2?e=n[1]:e=n[2]:e=n;let t=null;return wi(e)?t=e.input:xi(e)?t=e.node:t=e,t}function ki(n){return Se(n)?n.length===2?[n[0]]:[n[0],n[1]]:[]}function cu(n){return m(n)&&m(n.context)}function lu(n,e){Rr.set(e,n)}function It(n){Rr.delete(n),cu(n)&&pu(n)}function tt(n,e){let t=Si(n),r=Ti(e),o=ki(e);if(S(r))throw new Error("Must have a target to connect to");r instanceof AudioParam?t.connect(r,o[0]):r instanceof AudioNode?t.connect(r,o[0],o[1]):Re(r),me.has(t)||me.set(t,new Set);let i=me.get(t);return i.has(r)?!1:(i.add(r),!0)}function pu(n,e){let t=Si(n),r=Ti(e),o=ki(e);if(S(r)?t.disconnect():r instanceof AudioParam?t.disconnect(r,o[0]):r instanceof AudioNode?t.disconnect(r,o[0],o[1]):Re(r),!me.has(t))return!1;let i=me.get(t),a=!1;return S(r)?(a=i.size>0,i.clear()):i.has(r)&&(a=!0,i.delete(r)),i.size===0&&me.delete(t),a}function Fu(){let n=new Map;function e(t){n.has(t)||n.set(t,new Mt(t))}for(let t of Rr.keys())e(t);for(let[t,r]of me){e(t);for(let o of r)e(o)}for(let[t,r]of me){let o=n.get(t);for(let i of r)n.has(i)&&o.connectTo(n.get(i))}return Array.from(n.values())}globalThis.getAudioGraph=Fu;function Ei(n,e,...t){lu(n,e);for(let r of t)m(r)&&tt(e,r);return e}function Mi(n,e,t,...r){return Ei(n,new AnalyserNode(e,t),...r)}function bi(n,e,t,...r){return Ei(n,e.createMediaStreamSource(t),...r)}var q=class extends Error{constructor(e,t){let r=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=r}},de=class extends Error{constructor(e="A timeout occurred."){let t=new.target.prototype;super(e),this.__proto__=t}},Z=class extends Error{constructor(e="An abort occurred."){let t=new.target.prototype;super(e),this.__proto__=t}},Ht=class extends Error{constructor(e,t){let r=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=r}},Wt=class extends Error{constructor(e,t){let r=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=r}},Ot=class extends Error{constructor(e,t){let r=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=r}},Nt=class extends Error{constructor(e){let t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}},Ut=class extends Error{constructor(e,t){let r=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=r}};var _e=class{constructor(e,t,r){this.statusCode=e,this.statusText=t,this.content=r}},he=class{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}};var F;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(F||(F={}));var ee=class{constructor(){}log(e,t){}};ee.instance=new ee;var mu="6.0.6",M=class{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,r){if(!(e in t))throw new Error(`Unknown ${r} value: ${e}.`)}},C=class{static get isBrowser(){return typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return typeof self=="object"&&"importScripts"in self}static get isReactNative(){return typeof window=="object"&&typeof window.document>"u"}static get isNode(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}};function ge(n,e){let t="";return Vt(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${du(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function du(n){let e=new Uint8Array(n),t="";return e.forEach(r=>{t+=`0x${r<16?"0":""}${r.toString(16)} `}),t.substr(0,t.length-1)}function Vt(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function Gt(n,e,t,r,o,i,a){let s={};if(o){let d=await o();d&&(s={Authorization:`Bearer ${d}`})}let[u,c]=te();s[u]=c,n.log(F.Trace,`(${e} transport) sending data. ${ge(i,a.logMessageContent)}.`);let l=Vt(i)?"arraybuffer":"text",p=await t.post(r,{content:i,headers:{...s,...a.headers},responseType:l,timeout:a.timeout,withCredentials:a.withCredentials});n.log(F.Trace,`(${e} transport) request complete. Response status: ${p.statusCode}.`)}function Ci(n){return n===void 0?new Te(F.Information):n===null?ee.instance:n.log!==void 0?n:new Te(n)}var zt=class{constructor(e,t){this._subject=e,this._observer=t}dispose(){let e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}},Te=class{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){let r=`[${new Date().toISOString()}] ${F[e]}: ${t}`;switch(e){case F.Critical:case F.Error:this.out.error(r);break;case F.Warning:this.out.warn(r);break;case F.Information:this.out.info(r);break;default:this.out.log(r);break}}}};function te(){let n="X-SignalR-User-Agent";return C.isNode&&(n="User-Agent"),[n,hu(mu,gu(),xu(),fu())]}function hu(n,e,t,r){let o="Microsoft SignalR/",i=n.split(".");return o+=`${i[0]}.${i[1]}`,o+=` (${n}; `,e&&e!==""?o+=`${e}; `:o+="Unknown OS; ",o+=`${t}`,r?o+=`; ${r}`:o+="; Unknown Runtime Version",o+=")",o}function gu(){if(C.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function fu(){if(C.isNode)return process.versions.node}function xu(){return C.isNode?"NodeJS":"Browser"}function Pr(n){return n.stack?n.stack:n.message?n.message:`${n}`}function Di(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}var jt=class extends he{constructor(e){if(super(),this._logger=e,typeof fetch>"u"){let t=typeof __webpack_require__=="function"?__non_webpack_require__:Be;this._jar=new(t("tough-cookie")).CookieJar,this._fetchType=t("node-fetch"),this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(Di());if(typeof AbortController>"u"){let t=typeof __webpack_require__=="function"?__non_webpack_require__:Be;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new Z;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let t=new this._abortControllerType,r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new Z});let o=null;if(e.timeout){let u=e.timeout;o=setTimeout(()=>{t.abort(),this._logger.log(F.Warning,"Timeout from HTTP request."),r=new de},u)}let i;try{i=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(u){throw r||(this._logger.log(F.Warning,`Error from HTTP request. ${u}.`),u)}finally{o&&clearTimeout(o),e.abortSignal&&(e.abortSignal.onabort=null)}if(!i.ok){let u=await yi(i,"text");throw new q(u||i.statusText,i.status)}let s=await yi(i,e.responseType);return new _e(i.status,i.statusText,s)}getCookieString(e){let t="";return C.isNode&&this._jar&&this._jar.getCookies(e,(r,o)=>t=o.join("; ")),t}};function yi(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=n.text();break}return t}var Kt=class extends he{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new Z):e.method?e.url?new Promise((t,r)=>{let o=new XMLHttpRequest;o.open(e.method,e.url,!0),o.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type","text/plain;charset=UTF-8");let i=e.headers;i&&Object.keys(i).forEach(a=>{o.setRequestHeader(a,i[a])}),e.responseType&&(o.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{o.abort(),r(new Z)}),e.timeout&&(o.timeout=e.timeout),o.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),o.status>=200&&o.status<300?t(new _e(o.status,o.statusText,o.response||o.responseText)):r(new q(o.response||o.responseText||o.statusText,o.status))},o.onerror=()=>{this._logger.log(F.Warning,`Error from HTTP request. ${o.status}: ${o.statusText}.`),r(new q(o.statusText,o.status))},o.ontimeout=()=>{this._logger.log(F.Warning,"Timeout from HTTP request."),r(new de)},o.send(e.content||"")}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}};var $t=class extends he{constructor(e){if(super(),typeof fetch<"u"||C.isNode)this._httpClient=new jt(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new Kt(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new Z):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}};var A=class{static write(e){return`${e}${A.RecordSeparator}`}static parse(e){if(e[e.length-1]!==A.RecordSeparator)throw new Error("Message is incomplete.");let t=e.split(A.RecordSeparator);return t.pop(),t}};A.RecordSeparatorCode=30;A.RecordSeparator=String.fromCharCode(A.RecordSeparatorCode);var qt=class{writeHandshakeRequest(e){return A.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,r;if(Vt(e)){let s=new Uint8Array(e),u=s.indexOf(A.RecordSeparatorCode);if(u===-1)throw new Error("Message is incomplete.");let c=u+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(s.slice(0,c))),r=s.byteLength>c?s.slice(c).buffer:null}else{let s=e,u=s.indexOf(A.RecordSeparator);if(u===-1)throw new Error("Message is incomplete.");let c=u+1;t=s.substring(0,c),r=s.length>c?s.substring(c):null}let o=A.parse(t),i=JSON.parse(o[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[r,i]}};var E;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close"})(E||(E={}));var Jt=class{constructor(){this.observers=[]}next(e){for(let t of this.observers)t.next(e)}error(e){for(let t of this.observers)t.error&&t.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new zt(this,e)}};var wu=30*1e3,Su=15*1e3,k;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(k||(k={}));var ke=class{constructor(e,t,r,o){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(F.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},M.isRequired(e,"connection"),M.isRequired(t,"logger"),M.isRequired(r,"protocol"),this.serverTimeoutInMilliseconds=wu,this.keepAliveIntervalInMilliseconds=Su,this._logger=t,this._protocol=r,this.connection=e,this._reconnectPolicy=o,this._handshakeProtocol=new qt,this.connection.onreceive=i=>this._processIncomingData(i),this.connection.onclose=i=>this._connectionClosed(i),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=k.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:E.Ping})}static create(e,t,r,o){return new ke(e,t,r,o)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==k.Disconnected&&this._connectionState!==k.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==k.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=k.Connecting,this._logger.log(F.Debug,"Starting HubConnection.");try{await this._startInternal(),C.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=k.Connected,this._connectionStarted=!0,this._logger.log(F.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=k.Disconnected,this._logger.log(F.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;let e=new Promise((t,r)=>{this._handshakeResolver=t,this._handshakeRejecter=r});await this.connection.start(this._protocol.transferFormat);try{let t={protocol:this._protocol.name,version:this._protocol.version};if(this._logger.log(F.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(t)),this._logger.log(F.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError}catch(t){throw this._logger.log(F.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){let e=this._startPromise;this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){return this._connectionState===k.Disconnected?(this._logger.log(F.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===k.Disconnecting?(this._logger.log(F.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=k.Disconnecting,this._logger.log(F.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(F.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(e)))}stream(e,...t){let[r,o]=this._replaceStreamingParams(t),i=this._createStreamInvocation(e,t,o),a,s=new Jt;return s.cancelCallback=()=>{let u=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],a.then(()=>this._sendWithProtocol(u))},this._callbacks[i.invocationId]=(u,c)=>{if(c){s.error(c);return}else u&&(u.type===E.Completion?u.error?s.error(new Error(u.error)):s.complete():s.next(u.item))},a=this._sendWithProtocol(i).catch(u=>{s.error(u),delete this._callbacks[i.invocationId]}),this._launchStreams(r,a),s}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){let[r,o]=this._replaceStreamingParams(t),i=this._sendWithProtocol(this._createInvocation(e,t,!0,o));return this._launchStreams(r,i),i}invoke(e,...t){let[r,o]=this._replaceStreamingParams(t),i=this._createInvocation(e,t,!1,o);return new Promise((s,u)=>{this._callbacks[i.invocationId]=(l,p)=>{if(p){u(p);return}else l&&(l.type===E.Completion?l.error?u(new Error(l.error)):s(l.result):u(new Error(`Unexpected message type: ${l.type}`)))};let c=this._sendWithProtocol(i).catch(l=>{u(l),delete this._callbacks[i.invocationId]});this._launchStreams(r,c)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();let r=this._methods[e];if(!!r)if(t){let o=r.indexOf(t);o!==-1&&(r.splice(o,1),r.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){let t=this._protocol.parseMessages(e,this._logger);for(let r of t)switch(r.type){case E.Invocation:this._invokeClientMethod(r);break;case E.StreamItem:case E.Completion:{let o=this._callbacks[r.invocationId];if(o){r.type===E.Completion&&delete this._callbacks[r.invocationId];try{o(r)}catch(i){this._logger.log(F.Error,`Stream callback threw error: ${Pr(i)}`)}}break}case E.Ping:break;case E.Close:{this._logger.log(F.Information,"Close message received from server.");let o=r.error?new Error("Server returned an error on close: "+r.error):void 0;r.allowReconnect===!0?this.connection.stop(o):this._stopPromise=this._stopInternal(o);break}default:this._logger.log(F.Warning,`Invalid message type: ${r.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,r;try{[r,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(o){let i="Error parsing handshake response: "+o;this._logger.log(F.Error,i);let a=new Error(i);throw this._handshakeRejecter(a),a}if(t.error){let o="Server returned handshake error: "+t.error;this._logger.log(F.Error,o);let i=new Error(o);throw this._handshakeRejecter(i),i}else this._logger.log(F.Debug,"Server handshake complete.");return this._handshakeResolver(),r}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===k.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(e){let t=this._methods[e.target.toLowerCase()];if(t){try{t.forEach(r=>r.apply(this,e.arguments))}catch(r){this._logger.log(F.Error,`A callback for the method ${e.target.toLowerCase()} threw error '${r}'.`)}if(e.invocationId){let r="Server requested a response, which is not supported in this version of the client.";this._logger.log(F.Error,r),this._stopPromise=this._stopInternal(new Error(r))}}else this._logger.log(F.Warning,`No client method with the name '${e.target}' found.`)}_connectionClosed(e){this._logger.log(F.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new Error("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===k.Disconnecting?this._completeClose(e):this._connectionState===k.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===k.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=k.Disconnected,this._connectionStarted=!1,C.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(F.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){let t=Date.now(),r=0,o=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(r++,0,o);if(i===null){this._logger.log(F.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=k.Reconnecting,e?this._logger.log(F.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(F.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(a=>a.apply(this,[e]))}catch(a){this._logger.log(F.Error,`An onreconnecting callback called with error '${e}' threw error '${a}'.`)}if(this._connectionState!==k.Reconnecting){this._logger.log(F.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;i!==null;){if(this._logger.log(F.Information,`Reconnect attempt number ${r} will start in ${i} ms.`),await new Promise(a=>{this._reconnectDelayHandle=setTimeout(a,i)}),this._reconnectDelayHandle=void 0,this._connectionState!==k.Reconnecting){this._logger.log(F.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=k.Connected,this._logger.log(F.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(a=>a.apply(this,[this.connection.connectionId]))}catch(a){this._logger.log(F.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${a}'.`)}return}catch(a){if(this._logger.log(F.Information,`Reconnect attempt failed because of error '${a}'.`),this._connectionState!==k.Reconnecting){this._logger.log(F.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===k.Disconnecting&&this._completeClose();return}o=a instanceof Error?a:new Error(a.toString()),i=this._getNextRetryDelay(r++,Date.now()-t,o)}}this._logger.log(F.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${r} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,r){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:r})}catch(o){return this._logger.log(F.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${o}'.`),null}}_cancelCallbacksWithError(e){let t=this._callbacks;this._callbacks={},Object.keys(t).forEach(r=>{let o=t[r];try{o(null,e)}catch(i){this._logger.log(F.Error,`Stream 'error' callback called with '${e}' threw error: ${Pr(i)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,r,o){if(r)return o.length!==0?{arguments:t,streamIds:o,target:e,type:E.Invocation}:{arguments:t,target:e,type:E.Invocation};{let i=this._invocationId;return this._invocationId++,o.length!==0?{arguments:t,invocationId:i.toString(),streamIds:o,target:e,type:E.Invocation}:{arguments:t,invocationId:i.toString(),target:e,type:E.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(let r in e)e[r].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r)))},error:o=>{let i;o instanceof Error?i=o.message:o&&o.toString?i=o.toString():i="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r,i)))},next:o=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(r,o)))}})}}_replaceStreamingParams(e){let t=[],r=[];for(let o=0;o<e.length;o++){let i=e[o];if(this._isObservable(i)){let a=this._invocationId;this._invocationId++,t[a]=i,r.push(a.toString()),e.splice(o,1)}}return[t,r]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,r){let o=this._invocationId;return this._invocationId++,r.length!==0?{arguments:t,invocationId:o.toString(),streamIds:r,target:e,type:E.StreamInvocation}:{arguments:t,invocationId:o.toString(),target:e,type:E.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:E.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:E.StreamItem}}_createCompletionMessage(e,t,r){return t?{error:t,invocationId:e,type:E.Completion}:{invocationId:e,result:r,type:E.Completion}}};var Tu=[0,2e3,1e4,3e4,null],nt=class{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Tu}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}};var J=class{};J.Authorization="Authorization";J.Cookie="Cookie";var v;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(v||(v={}));var L;(function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"})(L||(L={}));var Yt=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};var rt=class{constructor(e,t,r,o){this._httpClient=e,this._accessTokenFactory=t,this._logger=r,this._pollAbort=new Yt,this._options=o,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}async connect(e,t){if(M.isRequired(e,"url"),M.isRequired(t,"transferFormat"),M.isIn(t,L,"transferFormat"),this._url=e,this._logger.log(F.Trace,"(LongPolling transport) Connecting."),t===L.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[r,o]=te(),i={[r]:o,...this._options.headers},a={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};t===L.Binary&&(a.responseType="arraybuffer");let s=await this._getAccessToken();this._updateHeaderToken(a,s);let u=`${e}&_=${Date.now()}`;this._logger.log(F.Trace,`(LongPolling transport) polling: ${u}.`);let c=await this._httpClient.get(u,a);c.statusCode!==200?(this._logger.log(F.Error,`(LongPolling transport) Unexpected response code: ${c.statusCode}.`),this._closeError=new q(c.statusText||"",c.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,a)}async _getAccessToken(){return this._accessTokenFactory?await this._accessTokenFactory():null}_updateHeaderToken(e,t){if(e.headers||(e.headers={}),t){e.headers[J.Authorization]=`Bearer ${t}`;return}e.headers[J.Authorization]&&delete e.headers[J.Authorization]}async _poll(e,t){try{for(;this._running;){let r=await this._getAccessToken();this._updateHeaderToken(t,r);try{let o=`${e}&_=${Date.now()}`;this._logger.log(F.Trace,`(LongPolling transport) polling: ${o}.`);let i=await this._httpClient.get(o,t);i.statusCode===204?(this._logger.log(F.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):i.statusCode!==200?(this._logger.log(F.Error,`(LongPolling transport) Unexpected response code: ${i.statusCode}.`),this._closeError=new q(i.statusText||"",i.statusCode),this._running=!1):i.content?(this._logger.log(F.Trace,`(LongPolling transport) data received. ${ge(i.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(i.content)):this._logger.log(F.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(o){this._running?o instanceof de?this._logger.log(F.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=o,this._running=!1):this._logger.log(F.Trace,`(LongPolling transport) Poll errored after shutdown: ${o.message}`)}}}finally{this._logger.log(F.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?Gt(this._logger,"LongPolling",this._httpClient,this._url,this._accessTokenFactory,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(F.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(F.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);let e={},[t,r]=te();e[t]=r;let o={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials},i=await this._getAccessToken();this._updateHeaderToken(o,i),await this._httpClient.delete(this._url,o),this._logger.log(F.Trace,"(LongPolling transport) DELETE request sent.")}finally{this._logger.log(F.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(F.Trace,e),this.onclose(this._closeError)}}};var Qt=class{constructor(e,t,r,o){this._httpClient=e,this._accessTokenFactory=t,this._logger=r,this._options=o,this.onreceive=null,this.onclose=null}async connect(e,t){if(M.isRequired(e,"url"),M.isRequired(t,"transferFormat"),M.isIn(t,L,"transferFormat"),this._logger.log(F.Trace,"(SSE transport) Connecting."),this._url=e,this._accessTokenFactory){let r=await this._accessTokenFactory();r&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`)}return new Promise((r,o)=>{let i=!1;if(t!==L.Text){o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let a;if(C.isBrowser||C.isWebWorker)a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{let s=this._httpClient.getCookieString(e),u={};u.Cookie=s;let[c,l]=te();u[c]=l,a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...u,...this._options.headers}})}try{a.onmessage=s=>{if(this.onreceive)try{this._logger.log(F.Trace,`(SSE transport) data received. ${ge(s.data,this._options.logMessageContent)}.`),this.onreceive(s.data)}catch(u){this._close(u);return}},a.onerror=s=>{i?this._close():o(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},a.onopen=()=>{this._logger.log(F.Information,`SSE connected to ${this._url}`),this._eventSource=a,i=!0,r()}}catch(s){o(s);return}})}async send(e){return this._eventSource?Gt(this._logger,"SSE",this._httpClient,this._url,this._accessTokenFactory,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}};var Xt=class{constructor(e,t,r,o,i,a){this._logger=r,this._accessTokenFactory=t,this._logMessageContent=o,this._webSocketConstructor=i,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=a}async connect(e,t){if(M.isRequired(e,"url"),M.isRequired(t,"transferFormat"),M.isIn(t,L,"transferFormat"),this._logger.log(F.Trace,"(WebSockets transport) Connecting."),this._accessTokenFactory){let r=await this._accessTokenFactory();r&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`)}return new Promise((r,o)=>{e=e.replace(/^http/,"ws");let i,a=this._httpClient.getCookieString(e),s=!1;if(C.isNode){let u={},[c,l]=te();u[c]=l,a&&(u[J.Cookie]=`${a}`),i=new this._webSocketConstructor(e,void 0,{headers:{...u,...this._headers}})}i||(i=new this._webSocketConstructor(e)),t===L.Binary&&(i.binaryType="arraybuffer"),i.onopen=u=>{this._logger.log(F.Information,`WebSocket connected to ${e}.`),this._webSocket=i,s=!0,r()},i.onerror=u=>{let c=null;typeof ErrorEvent<"u"&&u instanceof ErrorEvent?c=u.error:c="There was an error with the transport",this._logger.log(F.Information,`(WebSockets transport) ${c}.`)},i.onmessage=u=>{if(this._logger.log(F.Trace,`(WebSockets transport) data received. ${ge(u.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(u.data)}catch(c){this._close(c);return}},i.onclose=u=>{if(s)this._close(u);else{let c=null;typeof ErrorEvent<"u"&&u instanceof ErrorEvent?c=u.error:c="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(c))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(F.Trace,`(WebSockets transport) sending data. ${ge(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(F.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}};var vi=100,Zt=class{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,M.isRequired(e,"url"),this._logger=Ci(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let r=null,o=null;if(C.isNode&&typeof Be<"u"){let i=typeof __webpack_require__=="function"?__non_webpack_require__:Be;r=i("ws"),o=i("eventsource")}!C.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:C.isNode&&!t.WebSocket&&r&&(t.WebSocket=r),!C.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:C.isNode&&!t.EventSource&&typeof o<"u"&&(t.EventSource=o),this._httpClient=t.httpClient||new $t(this._logger),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||L.Binary,M.isIn(e,L,"transferFormat"),this._logger.log(F.Debug,`Starting connection with transfer format '${L[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){let t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(F.Error,t),await this._stopPromise,Promise.reject(new Error(t))}else if(this._connectionState!=="Connected"){let t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(F.Error,t),Promise.reject(new Error(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new ot(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(F.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(F.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(F.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(F.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===v.WebSockets)this.transport=this._constructTransport(v.WebSockets),await this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let r=null,o=0;do{if(r=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new Error("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(t=r.url),r.accessToken){let i=r.accessToken;this._accessTokenFactory=()=>i}o++}while(r.url&&o<vi);if(o===vi&&r.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,r,e)}this.transport instanceof rt&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(F.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(r){return this._logger.log(F.Error,"Failed to start the connection: "+r),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(r)}}async _getNegotiationResponse(e){let t={};if(this._accessTokenFactory){let a=await this._accessTokenFactory();a&&(t[J.Authorization]=`Bearer ${a}`)}let[r,o]=te();t[r]=o;let i=this._resolveNegotiateUrl(e);this._logger.log(F.Debug,`Sending negotiation request: ${i}.`);try{let a=await this._httpClient.post(i,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(a.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${a.statusCode}'`));let s=JSON.parse(a.content);return(!s.negotiateVersion||s.negotiateVersion<1)&&(s.connectionToken=s.connectionId),s}catch(a){let s="Failed to complete negotiation with the server: "+a;return a instanceof q&&a.statusCode===404&&(s=s+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(F.Error,s),Promise.reject(new Nt(s))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,r,o){let i=this._createConnectUrl(e,r.connectionToken);if(this._isITransport(t)){this._logger.log(F.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(i,o),this.connectionId=r.connectionId;return}let a=[],s=r.availableTransports||[],u=r;for(let c of s){let l=this._resolveTransportOrError(c,t,o);if(l instanceof Error)a.push(`${c.transport} failed:`),a.push(l);else if(this._isITransport(l)){if(this.transport=l,!u){try{u=await this._getNegotiationResponse(e)}catch(p){return Promise.reject(p)}i=this._createConnectUrl(e,u.connectionToken)}try{await this._startTransport(i,o),this.connectionId=u.connectionId;return}catch(p){if(this._logger.log(F.Error,`Failed to start the transport '${c.transport}': ${p}`),u=void 0,a.push(new Ot(`${c.transport} failed: ${p}`,v[c.transport])),this._connectionState!=="Connecting"){let d="Failed to select transport before stop() was called.";return this._logger.log(F.Debug,d),Promise.reject(new Error(d))}}}}return a.length>0?Promise.reject(new Ut(`Unable to connect to the server with any of the available transports. ${a.join(" ")}`,a)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case v.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Xt(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case v.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Qt(this._httpClient,this._accessTokenFactory,this._logger,this._options);case v.LongPolling:return new rt(this._httpClient,this._accessTokenFactory,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.transport.onclose=r=>this._stopConnection(r),this.transport.connect(e,t)}_resolveTransportOrError(e,t,r){let o=v[e.transport];if(o==null)return this._logger.log(F.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(ku(t,o))if(e.transferFormats.map(a=>L[a]).indexOf(r)>=0){if(o===v.WebSockets&&!this._options.WebSocket||o===v.ServerSentEvents&&!this._options.EventSource)return this._logger.log(F.Debug,`Skipping transport '${v[o]}' because it is not supported in your environment.'`),new Ht(`'${v[o]}' is not supported in your environment.`,o);this._logger.log(F.Debug,`Selecting transport '${v[o]}'.`);try{return this._constructTransport(o)}catch(a){return a}}else return this._logger.log(F.Debug,`Skipping transport '${v[o]}' because it does not support the requested transfer format '${L[r]}'.`),new Error(`'${v[o]}' does not support ${L[r]}.`);else return this._logger.log(F.Debug,`Skipping transport '${v[o]}' because it was disabled by the client.`),new Wt(`'${v[o]}' is disabled by the client.`,o)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(F.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(F.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(F.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(F.Error,`Connection disconnected with error '${e}'.`):this._logger.log(F.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(F.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(F.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!C.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let t=window.document.createElement("a");return t.href=e,this._logger.log(F.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){let t=e.indexOf("?"),r=e.substring(0,t===-1?e.length:t);return r[r.length-1]!=="/"&&(r+="/"),r+="negotiate",r+=t===-1?"":e.substring(t),r.indexOf("negotiateVersion")===-1&&(r+=t===-1?"?":"&",r+="negotiateVersion="+this._negotiateVersion),r}};function ku(n,e){return!n||(e&n)!==0}var ot=class{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new Ae,this._transportResult=new Ae,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new Ae),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new Ae;let e=this._transportResult;this._transportResult=void 0;let t=typeof this._buffer[0]=="string"?this._buffer.join(""):ot._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(r){e.reject(r)}}}static _concatBuffers(e){let t=e.map(i=>i.byteLength).reduce((i,a)=>i+a),r=new Uint8Array(t),o=0;for(let i of e)r.set(new Uint8Array(i),o),o+=i.byteLength;return r.buffer}},Ae=class{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}};var Eu="json",en=class{constructor(){this.name=Eu,this.version=1,this.transferFormat=L.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=ee.instance);let r=A.parse(e),o=[];for(let i of r){let a=JSON.parse(i);if(typeof a.type!="number")throw new Error("Invalid payload.");switch(a.type){case E.Invocation:this._isInvocationMessage(a);break;case E.StreamItem:this._isStreamItemMessage(a);break;case E.Completion:this._isCompletionMessage(a);break;case E.Ping:break;case E.Close:break;default:t.log(F.Information,"Unknown message type '"+a.type+"' ignored.");continue}o.push(a)}return o}writeMessage(e){return A.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}};var Mu={trace:F.Trace,debug:F.Debug,info:F.Information,information:F.Information,warn:F.Warning,warning:F.Warning,error:F.Error,critical:F.Critical,none:F.None};function bu(n){let e=Mu[n.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${n}`)}var it=class{configureLogging(e){if(M.isRequired(e,"logging"),Cu(e))this.logger=e;else if(typeof e=="string"){let t=bu(e);this.logger=new Te(t)}else this.logger=new Te(e);return this}withUrl(e,t){return M.isRequired(e,"url"),M.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...t}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return M.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new nt(e):this.reconnectPolicy=e:this.reconnectPolicy=new nt,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let t=new Zt(this.url,e);return ke.create(t,this.logger||ee.instance,this.protocol||new en,this.reconnectPolicy)}};function Cu(n){return n.log!==void 0}var Bi=!0,Ri=!0;function at(n,e,t){let r=n.match(e);return r&&r.length>=t&&parseInt(r[t],10)}function ce(n,e,t){if(!n.RTCPeerConnection)return;let r=n.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(a,s){if(a!==e)return o.apply(this,arguments);let u=c=>{let l=t(c);l&&(s.handleEvent?s.handleEvent(l):s(l))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(s,u),o.apply(this,[a,u])};let i=r.removeEventListener;r.removeEventListener=function(a,s){if(a!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(s))return i.apply(this,arguments);let u=this._eventMap[e].get(s);return this._eventMap[e].delete(s),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[a,u])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function Pi(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Bi=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function _i(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Ri=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function tn(){if(typeof window=="object"){if(Bi)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ie(n,e){!Ri||console.warn(n+" is deprecated, please use "+e+" instead.")}function Ai(n){let e={browser:null,version:null};if(typeof n>"u"||!n.navigator)return e.browser="Not a browser.",e;let{navigator:t}=n;if(t.mozGetUserMedia)e.browser="firefox",e.version=at(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)e.browser="chrome",e.version=at(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=at(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function Li(n){return Object.prototype.toString.call(n)==="[object Object]"}function Ar(n){return Li(n)?Object.keys(n).reduce(function(e,t){let r=Li(n[t]),o=r?Ar(n[t]):n[t],i=r&&!Object.keys(o).length;return o===void 0||i?e:Object.assign(e,{[t]:o})},{}):n}function _r(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?_r(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(o=>{_r(n,n.get(o),t)})}))}function Ir(n,e,t){let r=t?"outbound-rtp":"inbound-rtp",o=new Map;if(e===null)return o;let i=[];return n.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&i.push(a)}),i.forEach(a=>{n.forEach(s=>{s.type===r&&s.trackId===a.id&&_r(n,s,o)})}),o}var on={};$e(on,{fixNegotiationNeeded:()=>Vr,shimAddTrackRemoveTrack:()=>zr,shimAddTrackRemoveTrackWithNative:()=>Wi,shimGetDisplayMedia:()=>Hi,shimGetSendersWithDtmf:()=>Or,shimGetStats:()=>Nr,shimGetUserMedia:()=>nn,shimMediaStream:()=>Hr,shimOnTrack:()=>Wr,shimPeerConnection:()=>rn,shimSenderReceiverGetStats:()=>Ur});var Ii=tn;function nn(n,e){let t=n&&n.navigator;if(!t.mediaDevices)return;let r=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;let u={};return Object.keys(s).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;let l=typeof s[c]=="object"?s[c]:{ideal:s[c]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);let p=function(d,g){return d?d+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(l.ideal!==void 0){u.optional=u.optional||[];let d={};typeof l.ideal=="number"?(d[p("min",c)]=l.ideal,u.optional.push(d),d={},d[p("max",c)]=l.ideal,u.optional.push(d)):(d[p("",c)]=l.ideal,u.optional.push(d))}l.exact!==void 0&&typeof l.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[p("",c)]=l.exact):["min","max"].forEach(d=>{l[d]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[p(d,c)]=l[d])})}),s.advanced&&(u.optional=(u.optional||[]).concat(s.advanced)),u},o=function(s,u){if(e.version>=61)return u(s);if(s=JSON.parse(JSON.stringify(s)),s&&typeof s.audio=="object"){let c=function(l,p,d){p in l&&!(d in l)&&(l[d]=l[p],delete l[p])};s=JSON.parse(JSON.stringify(s)),c(s.audio,"autoGainControl","googAutoGainControl"),c(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=r(s.audio)}if(s&&typeof s.video=="object"){let c=s.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});let l=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!l)){delete s.video.facingMode;let p;if(c.exact==="environment"||c.ideal==="environment"?p=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(p=["front"]),p)return t.mediaDevices.enumerateDevices().then(d=>{d=d.filter(f=>f.kind==="videoinput");let g=d.find(f=>p.some(w=>f.label.toLowerCase().includes(w)));return!g&&d.length&&p.includes("back")&&(g=d[d.length-1]),g&&(s.video.deviceId=c.exact?{exact:g.deviceId}:{ideal:g.deviceId}),s.video=r(s.video),Ii("chrome: "+JSON.stringify(s)),u(s)})}s.video=r(s.video)}return Ii("chrome: "+JSON.stringify(s)),u(s)},i=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(s,u,c){o(s,l=>{t.webkitGetUserMedia(l,u,p=>{c&&c(i(p))})})};if(t.getUserMedia=a.bind(t),t.mediaDevices.getUserMedia){let s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(u){return o(u,c=>s(c).then(l=>{if(c.audio&&!l.getAudioTracks().length||c.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return l},l=>Promise.reject(i(l))))}}}function Hi(n,e){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&!!n.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(r){return e(r).then(o=>{let i=r.video&&r.video.width,a=r.video&&r.video.height,s=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:s||3}},i&&(r.video.mandatory.maxWidth=i),a&&(r.video.mandatory.maxHeight=a),n.navigator.mediaDevices.getUserMedia(r)})}}}function Hr(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function Wr(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});let e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",o=>{let i;n.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(s=>s.track&&s.track.id===o.track.id):i={track:o.track};let a=new Event("track");a.track=o.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[r.stream],this.dispatchEvent(a)}),r.stream.getTracks().forEach(o=>{let i;n.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(s=>s.track&&s.track.id===o.id):i={track:o};let a=new Event("track");a.track=o,a.receiver=i,a.transceiver={receiver:i},a.streams=[r.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ce(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Or(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){let e=function(o,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=o.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:o}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let o=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(s,u){let c=o.apply(this,arguments);return c||(c=e(this,s),this._senders.push(c)),c};let i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(s){i.apply(this,arguments);let u=this._senders.indexOf(s);u!==-1&&this._senders.splice(u,1)}}let t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],t.apply(this,[i]),i.getTracks().forEach(a=>{this._senders.push(e(this,a))})};let r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(a=>{let s=this._senders.find(u=>u.track===a);s&&this._senders.splice(this._senders.indexOf(s),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){let e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){let r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Nr(n){if(!n.RTCPeerConnection)return;let e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){let[r,o,i]=arguments;if(arguments.length>0&&typeof r=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof r!="function"))return e.apply(this,[]);let a=function(u){let c={};return u.result().forEach(p=>{let d={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(g=>{d[g]=p.stat(g)}),c[d.id]=d}),c},s=function(u){return new Map(Object.keys(u).map(c=>[c,u[c]]))};if(arguments.length>=2){let u=function(c){o(s(a(c)))};return e.apply(this,[u,r])}return new Promise((u,c)=>{e.apply(this,[function(l){u(s(a(l)))},c])}).then(o,i)}}function Ur(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){let t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i});let r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){let i=r.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){let i=this;return this._pc.getStats().then(a=>Ir(a,i.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){let t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){let o=t.apply(this,[]);return o.forEach(i=>i._pc=this),o}),ce(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){let o=this;return this._pc.getStats().then(i=>Ir(i,o.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;let e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){let r=arguments[0],o,i,a;return this.getSenders().forEach(s=>{s.track===r&&(o?a=!0:o=s)}),this.getReceivers().forEach(s=>(s.track===r&&(i?a=!0:i=s),s.track===r)),a||o&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Wi(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};let e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,s){if(!s)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let u=e.apply(this,arguments);return this._shimmedLocalStreams[s.id]?this._shimmedLocalStreams[s.id].indexOf(u)===-1&&this._shimmedLocalStreams[s.id].push(u):this._shimmedLocalStreams[s.id]=[s,u],u};let t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(p=>p.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});let s=this.getSenders();t.apply(this,arguments);let u=this.getSenders().filter(c=>s.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(u)};let r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};let o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(s=>{let u=this._shimmedLocalStreams[s].indexOf(a);u!==-1&&this._shimmedLocalStreams[s].splice(u,1),this._shimmedLocalStreams[s].length===1&&delete this._shimmedLocalStreams[s]}),o.apply(this,arguments)}}function zr(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Wi(n);let t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){let l=t.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(p=>this._reverseStreams[p.id])};let r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(p=>{if(this.getSenders().find(g=>g.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){let p=new n.MediaStream(l.getTracks());this._streams[l.id]=p,this._reverseStreams[p.id]=l,l=p}r.apply(this,[l])};let o=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},n.RTCPeerConnection.prototype.addTrack=function(l,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(w=>w===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let f=this._streams[p.id];if(f)f.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let w=new n.MediaStream([l]);this._streams[p.id]=w,this._reverseStreams[w.id]=p,this.addStream(w)}return this.getSenders().find(w=>w.track===l)};function i(c,l){let p=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{let g=c._reverseStreams[d],f=c._streams[g.id];p=p.replace(new RegExp(f.id,"g"),g.id)}),new RTCSessionDescription({type:l.type,sdp:p})}function a(c,l){let p=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{let g=c._reverseStreams[d],f=c._streams[g.id];p=p.replace(new RegExp(g.id,"g"),f.id)}),new RTCSessionDescription({type:l.type,sdp:p})}["createOffer","createAnswer"].forEach(function(c){let l=n.RTCPeerConnection.prototype[c],p={[c](){let d=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[f=>{let w=i(this,f);d[0].apply(null,[w])},f=>{d[1]&&d[1].apply(null,f)},arguments[2]]):l.apply(this,arguments).then(f=>i(this,f))}};n.RTCPeerConnection.prototype[c]=p[c]});let s=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?s.apply(this,arguments):(arguments[0]=a(this,arguments[0]),s.apply(this,arguments))};let u=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){let c=u.get.apply(this);return c.type===""?c:i(this,c)}}),n.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(l._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(w=>l.track===w)&&(d=this._streams[g])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function rn(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),!!n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let r=n.RTCPeerConnection.prototype[t],o={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=o[t]})}function Vr(n,e){ce(n,"negotiationneeded",t=>{let r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}var un={};$e(un,{shimAddTransceiver:()=>Jr,shimCreateAnswer:()=>Xr,shimCreateOffer:()=>Qr,shimGetDisplayMedia:()=>Oi,shimGetParameters:()=>Yr,shimGetUserMedia:()=>an,shimOnTrack:()=>Gr,shimPeerConnection:()=>sn,shimRTCDataChannel:()=>qr,shimReceiverGetStats:()=>Kr,shimRemoveStream:()=>$r,shimSenderGetStats:()=>jr});function an(n,e){let t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(o,i,a){Ie("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(o).then(i,a)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){let o=function(a,s,u){s in a&&!(u in a)&&(a[u]=a[s],delete a[s])},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),o(a.audio,"autoGainControl","mozAutoGainControl"),o(a.audio,"noiseSuppression","mozNoiseSuppression")),i(a)},r&&r.prototype.getSettings){let a=r.prototype.getSettings;r.prototype.getSettings=function(){let s=a.apply(this,arguments);return o(s,"mozAutoGainControl","autoGainControl"),o(s,"mozNoiseSuppression","noiseSuppression"),s}}if(r&&r.prototype.applyConstraints){let a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(s){return this.kind==="audio"&&typeof s=="object"&&(s=JSON.parse(JSON.stringify(s)),o(s,"autoGainControl","mozAutoGainControl"),o(s,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[s])}}}}function Oi(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||!n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){let o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function Gr(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function sn(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){let i=n.RTCPeerConnection.prototype[o],a={[o](){return arguments[0]=new(o==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[o]=a[o]});let t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){let[i,a,s]=arguments;return r.apply(this,[i||null]).then(u=>{if(e.version<53&&!a)try{u.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;u.forEach((l,p)=>{u.set(p,Object.assign({},l,{type:t[l.type]||l.type}))})}return u}).then(a,s)}}function jr(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;let e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){let o=e.apply(this,[]);return o.forEach(i=>i._pc=this),o});let t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){let o=t.apply(this,arguments);return o._pc=this,o}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Kr(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;let e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){let r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r}),ce(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $r(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){Ie("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function qr(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function Jr(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;let e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1],o=r&&"sendEncodings"in r;o&&r.sendEncodings.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let i=e.apply(this,arguments);if(o){let{sender:a}=i,s=a.getParameters();(!("encodings"in s)||s.encodings.length===1&&Object.keys(s.encodings[0]).length===0)&&(s.encodings=r.sendEncodings,a.sendEncodings=r.sendEncodings,this.setParametersPromises.push(a.setParameters(s).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return i})}function Yr(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;let e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){let r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Qr(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;let e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Xr(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;let e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var cn={};$e(cn,{shimAudioContext:()=>ao,shimCallbacksAPI:()=>to,shimConstraints:()=>Ni,shimCreateOfferLegacy:()=>io,shimGetUserMedia:()=>no,shimLocalStreamsAPI:()=>Zr,shimRTCIceServerUrls:()=>ro,shimRemoteStreamsAPI:()=>eo,shimTrackEventTransceiver:()=>oo});function Zr(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){let e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(o=>e.call(this,o,r)),r.getVideoTracks().forEach(o=>e.call(this,o,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...o){return o&&o.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);let o=t.getTracks();this.getSenders().forEach(i=>{o.includes(i.track)&&this.removeTrack(i)})})}}function eo(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);let i=new Event("addstream");i.stream=o,this.dispatchEvent(i)})})}});let e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){let r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);let a=new Event("addstream");a.stream=i,r.dispatchEvent(a)})}),e.apply(r,arguments)}}}function to(n){if(typeof n!="object"||!n.RTCPeerConnection)return;let e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,o=e.setLocalDescription,i=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(c,l){let p=arguments.length>=2?arguments[2]:arguments[0],d=t.apply(this,[p]);return l?(d.then(c,l),Promise.resolve()):d},e.createAnswer=function(c,l){let p=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[p]);return l?(d.then(c,l),Promise.resolve()):d};let s=function(u,c,l){let p=o.apply(this,[u]);return l?(p.then(c,l),Promise.resolve()):p};e.setLocalDescription=s,s=function(u,c,l){let p=i.apply(this,[u]);return l?(p.then(c,l),Promise.resolve()):p},e.setRemoteDescription=s,s=function(u,c,l){let p=a.apply(this,[u]);return l?(p.then(c,l),Promise.resolve()):p},e.addIceCandidate=s}function no(n){let e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){let t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=o=>r(Ni(o))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(r,o,i){e.mediaDevices.getUserMedia(r).then(o,i)}.bind(e))}function Ni(n){return n&&n.video!==void 0?Object.assign({},n,{video:Ar(n.video)}):n}function ro(n){if(!n.RTCPeerConnection)return;let e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,o){if(r&&r.iceServers){let i=[];for(let a=0;a<r.iceServers.length;a++){let s=r.iceServers[a];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(Ie("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,i.push(s)):i.push(r.iceServers[a])}r.iceServers=i}return new e(r,o)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function oo(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function io(n){let e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);let o=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveAudio===!0&&!o&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);let i=this.getTransceivers().find(a=>a.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function ao(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var co={};$e(co,{removeExtmapAllowMixed:()=>pn,shimAddIceCandidateNullOrEmpty:()=>pt,shimConnectionState:()=>ln,shimMaxMessageSize:()=>ct,shimParameterlessSetLocalDescription:()=>Ft,shimRTCIceCandidate:()=>ut,shimSendThrowTypeError:()=>lt});var st=No(uo());function ut(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;let e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){let o=new e(r),i=st.default.parseCandidate(r.candidate),a=Object.assign(o,i);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,ce(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function ct(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});let t=function(s){if(!s||!s.sdp)return!1;let u=st.default.splitSections(s.sdp);return u.shift(),u.some(c=>{let l=st.default.parseMLine(c);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},r=function(s){let u=s.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;let c=parseInt(u[1],10);return c!==c?-1:c},o=function(s){let u=65536;return e.browser==="firefox"&&(e.version<57?s===-1?u=16384:u=2147483637:e.version<60?u=e.version===57?65535:65536:u=2147483637),u},i=function(s,u){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);let l=st.default.matchPrefix(s.sdp,"a=max-message-size:");return l.length>0?c=parseInt(l[0].substr(19),10):e.browser==="firefox"&&u!==-1&&(c=2147483637),c},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){let{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){let u=r(arguments[0]),c=o(u),l=i(arguments[0],u),p;c===0&&l===0?p=Number.POSITIVE_INFINITY:c===0||l===0?p=Math.max(c,l):p=Math.min(c,l);let d={};Object.defineProperty(d,"maxMessageSize",{get(){return p}}),this._sctp=d}return a.apply(this,arguments)}}function lt(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,o){let i=r.send;r.send=function(){let s=arguments[0],u=s.length||s.size||s.byteLength;if(r.readyState==="open"&&o.sctp&&u>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}let t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){let o=t.apply(this,arguments);return e(o,this),o},ce(n,"datachannel",r=>(e(r.channel,r.target),r))}function ln(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;let e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{let r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{let i=o.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;let a=new Event("connectionstatechange",o);i.dispatchEvent(a)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function pn(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;let t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let i=o.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&o instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:o.type,sdp:i}):o.sdp=i}return t.apply(this,arguments)}}function pt(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;let t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ft(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;let t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return t.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer";break}return o.sdp||o.type!=="offer"&&o.type!=="answer"?t.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>t.apply(this,[a]))})}var Du=No(uo());function Ui({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let t=tn,r=Ai(n),o={browserDetails:r,commonShim:co,extractVersion:at,disableLog:Pi,disableWarnings:_i,sdp:Du};switch(r.browser){case"chrome":if(!on||!rn||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),o;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),o;t("adapter.js shimming chrome."),o.browserShim=on,pt(n,r),Ft(n,r),nn(n,r),Hr(n,r),rn(n,r),Wr(n,r),zr(n,r),Or(n,r),Nr(n,r),Ur(n,r),Vr(n,r),ut(n,r),ln(n,r),ct(n,r),lt(n,r),pn(n,r);break;case"firefox":if(!un||!sn||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),o;t("adapter.js shimming firefox."),o.browserShim=un,pt(n,r),Ft(n,r),an(n,r),sn(n,r),Gr(n,r),$r(n,r),jr(n,r),Kr(n,r),qr(n,r),Jr(n,r),Yr(n,r),Qr(n,r),Xr(n,r),ut(n,r),ln(n,r),ct(n,r),lt(n,r);break;case"safari":if(!cn||!e.shimSafari)return t("Safari shim is not included in this adapter release."),o;t("adapter.js shimming safari."),o.browserShim=cn,pt(n,r),Ft(n,r),ro(n,r),io(n,r),to(n,r),Zr(n,r),eo(n,r),oo(n,r),no(n,r),ao(n,r),ut(n,r),ct(n,r),lt(n,r),pn(n,r);break;default:t("Unsupported browser!");break}return o}var yu=Ui({window:typeof window>"u"?void 0:window}),zi=yu;var Fn=class{t=0;p=_.create();f=_.set(_.create(),0,0,-1);u=_.set(_.create(),0,1,0);o=_.create();constructor(){Object.seal(this)}set(e,t,r,o,i,a,s,u,c){this.setPosition(e,t,r),this.setOrientation(o,i,a,s,u,c)}setPosition(e,t,r){_.set(this.p,e,t,r)}setOrientation(e,t,r,o,i,a){_.set(this.f,e,t,r),_.set(this.u,o,i,a)}setOffset(e,t,r){_.set(this.o,e,t,r)}copy(e){_.copy(this.p,e.p),_.copy(this.f,e.f),_.copy(this.u,e.u),_.copy(this.o,e.o)}};var He=(x=>(x[x.LocalUser=0]="LocalUser",x[x.Mouse=1]="Mouse",x[x.Pen=2]="Pen",x[x.Touch0=3]="Touch0",x[x.Touch1=4]="Touch1",x[x.Touch2=5]="Touch2",x[x.Touch3=6]="Touch3",x[x.Touch4=7]="Touch4",x[x.Touch5=8]="Touch5",x[x.Touch6=9]="Touch6",x[x.Touch7=10]="Touch7",x[x.Touch8=11]="Touch8",x[x.Touch9=12]="Touch9",x[x.Touch10=13]="Touch10",x[x.Touches=14]="Touches",x[x.MotionController=15]="MotionController",x[x.MotionControllerLeft=16]="MotionControllerLeft",x[x.MotionControllerRight=17]="MotionControllerRight",x[x.RemoteUser=18]="RemoteUser",x))(He||{});var Me=class extends Event{constructor(t){super(t);this.eventType=t}},mn=class extends Me{constructor(t){super("error");this.error=t}};var dn=class extends Me{constructor(){super("serverConnected")}},hn=class extends Me{constructor(){super("serverDisconnected")}};var gn=class extends Me{constructor(t,r){super(t);this.userID=r}},fn=class extends gn{constructor(t,r){super("roomJoined",t);this.pose=r}},xn=class extends gn{constructor(e){super("roomLeft",e)}},fe=class extends Me{constructor(t,r){super(t);this.user=r}},wn=class extends fe{constructor(t,r){super("userJoined",t);this.source=r}},We=class extends fe{constructor(e){super("userLeft",e)}};var Sn=class extends fe{constructor(t,r,o){super(t,r);this.muted=o}},Tn=class extends Sn{constructor(e,t){super("audioMuteStatusChanged",e,t)}},kn=class extends Sn{constructor(e,t){super("videoMuteStatusChanged",e,t)}};var En=class extends fe{constructor(t,r,o,i,a){super(t,i);this.kind=r;this.op=o;this.stream=a}},Mn=class extends En{constructor(e,t,r,o){super(e,t,"added",r,o)}},bn=class extends En{constructor(e,t,r,o){super(e,t,"removed",r,o)}},Cn=class extends Mn{constructor(e,t){super("audioAdded","audio",e,t)}},Dn=class extends bn{constructor(e,t){super("audioRemoved","audio",e,t)}},yn=class extends Mn{constructor(e,t){super("videoAdded","video",e,t)}},vn=class extends bn{constructor(e,t){super("videoRemoved","video",e,t)}},Ln=class extends fe{constructor(t,r){super(t,r);this.pose=new Fn}},Bn=class extends Ln{constructor(t){super("userPosed",t);this.height=0}},Rn=class extends Ln{constructor(t){super("userPointer",t);this.name=18}},Pn=class extends fe{constructor(t,r){super("chat",t);this.text=r}};async function Vi(n,e,t,r,o,i,a){e()===o?await xr(()=>e()===r):(e()===i&&await xr(()=>e()===a),e()===a&&await t())}function lo(n,e,t){return Vi(n,e,t,"Connected","Connecting","Disconnecting","Disconnected")}function po(n,e,t){return Vi(n,e,t,"Disconnected","Disconnecting","Connecting","Connected")}var _n="local-user";var Oe=class{constructor(e,t){this.name=e;this.analyzer=Mi(this.name,t,{fftSize:32,minDecibels:-70}),this.buffer=new Uint8Array(this.analyzer.frequencyBinCount)}_level=0;maxLevel=0;analyzer;buffer;dispose(){It(this.analyzer)}get level(){return this.analyzer.getByteFrequencyData(this.buffer),this._level=Math.max(...this.buffer),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this._level}get input(){return this.analyzer}get output(){return this.analyzer}};var An=class{constructor(e,t,r,o,i,a,s,u,c,l,p){this.input=t;this.output=r;this.min=o;this.max=i;this.threshold=a;this.attack=s;this.decay=u;this.sustain=c;this.hold=l;this.release=p;this.curLength=0;this.timer=null;this._enabled=!0;this.shouldRun=!1;this.activity=new Oe("remote-audio-activity",e),tt(this.input,this.activity),this.timer=new At(30),this.timer.addTickHandler(d=>this.update(d))}update(e){if(this.enabled){let t=this.activity.level;t>=this.threshold&&this.time>=this.length&&(this.time=0),this.time+=e.dt,this.time>this.length&&(this.time=this.length),t>=this.threshold&&this.holding&&(this.time=this.holdStart),this.output.gain.value=this.gain}}get enabled(){return this._enabled}setEnabled(e){this._enabled=e,this.refresh()}start(){this.shouldRun=!0,this.refresh()}stop(){this.shouldRun=!1,this.refresh()}refresh(){if(this.timer!=null){let e=this.shouldRun&&this.enabled;e!==this.timer.isRunning&&(e?this.timer.start():(this.timer.stop(),this.output.gain.value=1))}}get length(){return this.attack+this.decay+this.hold+this.release}get time(){return this.length-this.curLength}set time(e){this.curLength=this.length-e}get attackStart(){return 0}get attackEnd(){return this.attackStart+this.attack}get decayStart(){return this.attackEnd}get decayEnd(){return this.decayStart+this.decay}get holdStart(){return this.decayEnd}get holdEnd(){return this.holdStart+this.hold}get releaseStart(){return this.holdEnd}get releaseEnd(){return this.releaseStart+this.release}get attacking(){return this.attackStart<=this.time&&this.time<this.attackEnd}get decaying(){return this.decayStart<=this.time&&this.time<this.decayEnd}get holding(){return this.holdStart<=this.time&&this.time<this.holdEnd}get releasing(){return this.releaseStart<this.time&&this.time<this.releaseEnd}get pAttack(){return(this.time-this.attackStart)/this.attack}get pDecay(){return(this.time-this.decayStart)/this.decay}get pRelease(){return(this.time-this.releaseStart)/this.release}get value(){return this.attacking?1-this.pAttack:this.decaying?this.sustain*this.pDecay:this.holding?this.sustain:this.releasing?this.sustain+(1-this.sustain)*this.pRelease:1}get gain(){return Mr(this.value,this.min,this.max)}};var Fo=class{constructor(){this.locks=new Set}isLocked(e){return this.locks.has(e)}isUnlocked(e){return!this.locks.has(e)}lock(e){this.locks.add(e)}unlock(e){this.locks.delete(e)}async withSkipLock(e,t){if(this.isUnlocked(e)){this.lock(e);try{await t()}finally{this.unlock(e)}}}},ne=class extends we{constructor(t,r){super(t);this.user=r}},mo=class extends ne{constructor(t,r){super("iceError",t);this.address=r.address,this.errorCode=r.errorCode,this.errorText=r.errorText,this.port=r.port,this.url=r.url,Object.seal(this)}},ho=class extends ne{constructor(t,r){super("iceCandidate",t);this.candidate=r}},go=class extends ne{constructor(t,r){super("offer",t);this.offer=r}},fo=class extends ne{constructor(t,r){super("answer",t);this.answer=r}},xo=class extends ne{constructor(e){super("streamNeeded",e)}},wo=class extends ne{constructor(t,r,o){super("trackAdded",t);this.track=r;this.stream=o}},So=class extends ne{constructor(t,r){super("trackMuted",t);this.track=r}},To=class extends ne{constructor(t,r,o){super("trackRemoved",t);this.track=r;this.stream=o}},Gi=new Set;var In=class extends U{constructor(t,r,o,i){super();this.userID=t;this.userName=r;this.confirmReceipt=i;this.userPosedEvt=new Bn(this);this.userPointerEvt=new Rn(this);this.sendPoseBuffer=new Float32Array(12);this.sendPointerBuffer=new Float32Array(12);this.sendInvocationCompleteBuffer=new Float32Array(2);this.transceivers=new Array;this.invocationCount=0;this.invocations=new Map;this.locks=new Fo;this.channel=null;this.gotOffer=!1;this.disposed=!1;this.trackSent=!1;this.sendPoseBuffer[0]=2,this.sendPointerBuffer[0]=1,this.sendInvocationCompleteBuffer[0]=3,this.connection=new RTCPeerConnection(o),this.connection.addEventListener("icecandidateerror",s=>{this.dispatchEvent(new mo(this,s))}),this.connection.addEventListener("icecandidate",async s=>{s.candidate&&this.dispatchEvent(new ho(this,s.candidate))}),this.connection.addEventListener("negotiationneeded",async()=>{if(this.trackSent||this.gotOffer){let s=Gi.has(this.userID),u=await this.connection.createOffer({iceRestart:s});s||Gi.add(this.userID),await this.connection.setLocalDescription(u),this.dispatchEvent(new go(this,this.connection.localDescription.toJSON()))}}),this.connection.addEventListener("datachannel",s=>{this.setChannel(s.channel)}),this.connection.addEventListener("track",async s=>{let u=s.transceiver,c=s.track,l=Vo(s.streams,g=>{let f=g.getTracks();for(let w of f)if(w===c)return!0;return!1});this.transceivers.indexOf(u)===-1&&this.transceivers.push(u);let p=()=>{this.dispatchEvent(new So(this,c))},d=()=>{c.removeEventListener("ended",d),c.removeEventListener("mute",p),X(this.transceivers,u),this.dispatchEvent(new To(this,c,l))};c.addEventListener("ended",d),c.addEventListener("mute",p),this.dispatchEvent(new wo(this,c,l)),this.trackSent?this.setChannel(this.connection.createDataChannel("poses",{ordered:!1,maxRetransmits:0})):this.start()});let a=!1;this.connection.addEventListener("connectionstatechange",()=>{this.connection.connectionState==="failed"&&a?this.dispatchEvent(new We(this)):this.connection.connectionState==="connected"&&(a=!0)}),Object.seal(this)}dispose(){if(!this.disposed){this.channel&&(this.channel.close(),this.channel=null);for(let t of this.transceivers)t.stop();ae(this.transceivers),this.connection.close(),this.disposed=!0}}setChannel(t){this.channel=t,this.channel.binaryType="arraybuffer",this.channel.addEventListener("message",r=>{if(ii(r.data)){let o=new Float32Array(r.data),i=o[0],a=o[1];if(i===3){let s=this.invocations.get(a);s&&s()}else this.channel&&this.channel.readyState==="open"&&(i===2?this.recvPose(o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11]):this.recvPointer(o[11],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10]),a>=0&&(this.sendInvocationCompleteBuffer[1]=a,this.channel.send(this.sendInvocationCompleteBuffer)))}})}recvPose(t,r,o,i,a,s,u,c,l,p){this.userPosedEvt.pose.set(t,r,o,i,a,s,u,c,l),this.userPosedEvt.height=p,this.dispatchEvent(this.userPosedEvt)}sendPose(t,r,o,i,a,s,u,c,l,p){return this.sendMessage(2,t,r,o,i,a,s,u,c,l,p)}recvPointer(t,r,o,i,a,s,u,c,l,p){this.userPointerEvt.name=t,this.userPointerEvt.pose.set(r,o,i,a,s,u,c,l,p),this.dispatchEvent(this.userPointerEvt)}sendPointer(t,r,o,i,a,s,u,c,l,p){return this.sendMessage(1,r,o,i,a,s,u,c,l,p,t)}async sendMessage(t,r,o,i,a,s,u,c,l,p,d){this.channel&&this.channel.readyState==="open"&&this.locks.withSkipLock(t,async()=>{let g=t===2?this.sendPoseBuffer:this.sendPointerBuffer,f=++this.invocationCount;if(g[1]=f,g[2]=r,g[3]=o,g[4]=i,g[5]=a,g[6]=s,g[7]=u,g[8]=c,g[9]=l,g[10]=p,g[11]=d,!this.confirmReceipt)this.channel.send(g);else{let w=new ue,D=setTimeout(w.reject,100,"timeout"),z=()=>{clearTimeout(D),w.resolve()};this.invocations.set(f,z),this.channel.send(g);try{await w}catch(P){P!=="timeout"&&console.error(P)}finally{this.invocations.delete(f)}}})}async addIceCandidate(t){await this.connection.addIceCandidate(t)}async acceptOffer(t){await this.connection.setRemoteDescription(t),this.gotOffer=!0;let r=await this.connection.createAnswer();await this.connection.setLocalDescription(r),this.dispatchEvent(new fo(this,this.connection.localDescription.toJSON()))}async acceptAnswer(t){await this.connection.setRemoteDescription(t)}start(){this.trackSent||(this.trackSent=!0,this.dispatchEvent(new xo(this)))}sendStream(t){for(let r of t.getTracks())this.trackSent?this.connection.addTrack(r,t):this.transceivers.push(this.connection.addTransceiver(r,{streams:[t]}))}};var ko=window.location.hostname==="localhost"||/\bdebug\b/.test(window.location.search),Eo=Q("Juniper:Sockets",()=>new Array);function Wn(...n){console.log("New connection",...n);let e=new WebSocket(...n);return Eo.push(e),e}Wn.CLOSED=WebSocket.CLOSED;Wn.CLOSING=WebSocket.CLOSING;Wn.CONNECTING=WebSocket.CONNECTING;Wn.OPEN=WebSocket.OPEN;Object.assign(window,{sockets:{list:()=>Eo,kill:()=>{for(let n of Eo)n.close()}}});var Hn=class extends U{constructor(t,r,o=!0,i=!1){super();this.audio=t;this.signalRPath=r;this.autoSetPosition=o;this.needsVideoDevice=i;ko&&console.log(zi);let a=new it().withAutomaticReconnect();a.withUrl(this.signalRPath,v.WebSockets),this.hub=a.build(),this.audio.devices.addEventListener("audioinputchanged",u=>this.onAudioInputChanged(u)),this.hub.onclose(()=>{this.lastRoom=null,this.lastUserID=null,this.setConferenceState("Disconnected")}),this.hub.onreconnecting(u=>{this.dispatchEvent(new mn(u))}),this.hub.onreconnected(async()=>{this.lastRoom=null,this.lastUserID=null,this.setConferenceState("Disconnected"),await this.identify(this.localUserName),await this.join(this.roomName)}),this.hub.on("userJoined",this.onUserJoined.bind(this)),this.hub.on("iceReceived",this.onIceReceived.bind(this)),this.hub.on("offerReceived",this.onOfferReceived.bind(this)),this.hub.on("answerReceived",this.onAnswerReceived.bind(this)),this.hub.on("userLeft",u=>{let c=this.users.get(u);c&&this.onUserLeft(c)}),this.hub.on("userPosed",(u,c,l,p,d,g,f,w,D,z,P)=>{let x=this.users.get(u);x&&x.recvPose(c,l,p,d,g,f,w,D,z,P)}),this.hub.on("userPointer",(u,c,l,p,d,g,f,w,D,z,P)=>{let x=this.users.get(u);x&&x.recvPointer(c,l,p,d,g,f,w,D,z,P)}),this.hub.on("chat",(u,c)=>{let l=this.users.get(u);l&&this.dispatchEvent(new Pn(l,c))}),this.remoteGainDecay=new An(this.audio.audioCtx,this.audio.audioDestination.remoteUserInput,this.audio.localAutoControlledGain,.05,1,.25,0,250,.25,1e3,250),this.remoteGainDecay.setEnabled(!this.audio.useHeadphones),this.audio.addEventListener("useheadphonestoggled",()=>{this.remoteGainDecay.setEnabled(!this.audio.useHeadphones),this.restartStream()});let s=()=>{this.conferenceState==="Connected"&&this.toRoom("leave")};window.addEventListener("beforeunload",s),window.addEventListener("unload",s),window.addEventListener("pagehide",s),this.localStream=this.audio.devices.currentStream,Object.seal(this)}toggleLogging(){ko=!ko}_isAudioMuted=null;get isAudioMuted(){return this._isAudioMuted}_isVideoMuted=null;get isVideoMuted(){return this._isVideoMuted}_localUserID=_n;get localUserID(){return this._localUserID}_localUserName=null;get localUserName(){return this._localUserName}_roomName=null;get roomName(){return this._roomName}_conferenceState="Disconnected";_hasAudioPermission=!1;get hasAudioPermission(){return this._hasAudioPermission}_hasVideoPermission=!1;get hasVideoPermission(){return this._hasVideoPermission}lastRoom=null;lastUserID=null;users=new Map;localStreamIn=null;hub;remoteGainDecay;_ready=null;get ready(){return this._ready===null&&(this._ready=this.startInternal()),this._ready}async startInternal(){await this.audio.ready,await this.audio.devices.startPreferredAudioInput(),this.localStream=this.audio.devices.currentStream}get connectionState(){switch(this.hub.state){case k.Connected:return"Connected";case k.Connecting:case k.Reconnecting:return"Connecting";case k.Disconnected:return"Disconnected";case k.Disconnecting:return"Disconnecting";default:Re(this.hub.state)}}get echoControl(){return this.remoteGainDecay}get isConnected(){return this.connectionState==="Connected"}get conferenceState(){return this._conferenceState}get isConferenced(){return this.conferenceState==="Connected"}setConferenceState(t){this._conferenceState=t}disposed=!1;dispose(){this.disposed||(this.leave(),this.disconnect(),this.disposed=!0)}err(t,...r){console.warn(t,...r)}async toServer(t,...r){return await this.hub.invoke(t,...r)}async toRoom(t,...r){this.isConnected&&await this.hub.invoke(t,this.localUserID,this.roomName,...r)}async toUser(t,r,...o){this.isConnected&&await this.hub.invoke(t,this.localUserID,r,...o)}async connect(){await this.ready,await lo("Connecting",()=>this.connectionState,async()=>{await this.hub.start(),this.dispatchEvent(new dn)})}async join(t){this.lastRoom!==null&&t!==this.lastRoom&&await this.leave(),await lo(`Joining room ${t}`,()=>this.conferenceState,async()=>{this.setConferenceState("Connecting"),this._roomName=t,await this.toServer("join",this.roomName),this.lastRoom=this.roomName,this.setConferenceState("Connected");let r=this.audio.setLocalUserID(this.localUserID);this.dispatchEvent(new fn(this.localUserID,r.pose)),await this.toRoom("greetEveryone",this.localUserName)})}async identify(t){this.localUserID===_n&&(this._localUserID=null),this._localUserID=this.localUserID||await this.toServer("getNewUserID"),this._localUserName=t,this.localUserID&&this.localUserID!==this.lastUserID&&this.isConnected&&(this.lastUserID=this.localUserID,await this.toServer("identify",this.localUserID))}async leave(){await po(`Leaving room ${this.lastRoom}`,()=>this.conferenceState,async()=>{this.setConferenceState("Disconnecting"),await this.toRoom("leave")});for(let t of this.users.values())this.onUserLeft(t);this._roomName=this.lastRoom=null,this.setConferenceState("Disconnected"),this.dispatchEvent(new xn(this.localUserID))}async disconnect(){this.conferenceState!=="Disconnected"&&await this.leave(),await po("Disconnecting",()=>this.connectionState,async()=>{await this.hub.stop(),this._localUserID=this.lastUserID=_n,this.audio.setLocalUserID(this.localUserID),this.dispatchEvent(new hn)})}async onUserJoined(t,r){if(this.users.has(t))this.users.get(t).start();else{this.users.size===0&&this.remoteGainDecay.start();let o=await this.getRTCConfiguration(),i=new In(t,r,o,!0);this.users.set(i.userID,i),i.addEventListener("iceError",this.onIceError.bind(this)),i.addEventListener("iceCandidate",this.onIceCandidate.bind(this)),i.addEventListener("offer",this.onOfferCreated.bind(this)),i.addEventListener("answer",this.onAnswerCreated.bind(this)),i.addEventListener("streamNeeded",this.onStreamNeeded.bind(this)),i.addEventListener("trackAdded",this.onTrackAdded.bind(this)),i.addEventListener("trackMuted",this.onTrackMuted.bind(this)),i.addEventListener("trackRemoved",this.onTrackRemoved.bind(this)),i.addEventListener("userLeft",s=>this.onUserLeft(s.user)),i.addEventListener("userPosed",s=>{this.onRemoteUserPosed(s);let{p:u,f:c,u:l}=s.pose;this.audio.setUserPose(s.user.userID,u[0],u[1],u[2],c[0],c[1],c[2],l[0],l[1],l[2])}),i.addEventListener("userPointer",s=>this.onRemoteUserPosed(s)),this.toUser("greet",i.userID,this.localUserName);let a=this.audio.createUser(i.userID,i.userName);this.dispatchEvent(new wn(i,a))}}async getRTCConfiguration(){return await this.toServer("getRTCConfiguration",this.localUserID)}onIceError(t){this.err("icecandidateerror",this.localUserName,t.user.userName,`${t.url} [${t.errorCode}]: ${t.errorText}`)}async onIceCandidate(t){await this.sendIce(t.user.userID,t.candidate)}async onIceReceived(t,r){try{let o=this.users.get(t);if(o){let i=JSON.parse(r);await o.addIceCandidate(i)}}catch(o){this.err("iceReceived",`${o.message} [${t}] (${r})`)}}async onOfferCreated(t){await this.sendOffer(t.user.userID,t.offer)}async onOfferReceived(t,r){try{let o=this.users.get(t);if(o){let i=JSON.parse(r);await o.acceptOffer(i)}}catch(o){this.err("offerReceived",o.message)}}async onAnswerCreated(t){await this.sendAnswer(t.user.userID,t.answer)}async onAnswerReceived(t,r){try{let o=this.users.get(t);if(o){let i=JSON.parse(r);await o.acceptAnswer(i)}}catch(o){this.err("answerReceived",o.message)}}onStreamNeeded(t){t.user.sendStream(this.audio.output.stream)}onTrackAdded(t){t.track.kind==="audio"?(this.audio.setUserStream(t.user.userID,t.user.userName,t.stream),this.dispatchEvent(new Cn(t.user,t.stream))):t.track.kind==="video"&&this.dispatchEvent(new yn(t.user,t.stream))}onTrackMuted(t){t.track.kind==="audio"?this.dispatchEvent(new Tn(t.user,t.track.muted)):t.track.kind==="video"&&this.dispatchEvent(new kn(t.user,t.track.muted))}onTrackRemoved(t){t.track.kind==="audio"?(this.audio.setUserStream(t.user.userID,t.user.userName,null),this.dispatchEvent(new Dn(t.user,t.stream))):t.track.kind==="video"&&this.dispatchEvent(new vn(t.user,t.stream))}onUserLeft(t){t.dispose(),this.users.delete(t.userID),this.users.size===0&&this.remoteGainDecay.stop(),this.audio.removeUser(t.userID),this.dispatchEvent(new We(t))}async sendIce(t,r){await this.toUser("sendIce",t,JSON.stringify(r))}async sendOffer(t,r){await this.toUser("sendOffer",t,JSON.stringify(r))}async sendAnswer(t,r){await this.toUser("sendAnswer",t,JSON.stringify(r))}async setLocalPose(t,r,o,i,a,s,u,c,l,p){this.autoSetPosition&&this.audio.setUserPose(this.localUserID,t,r,o,i,a,s,u,c,l),this.conferenceState==="Connected"&&await Promise.all(Array.from(this.users.values()).map(d=>d.sendPose(t,r,o,i,a,s,u,c,l,p)))}async setLocalPointer(t,r,o,i,a,s,u,c,l,p){this.conferenceState==="Connected"&&await Promise.all(Array.from(this.users.values()).map(d=>d.sendPointer(t,r,o,i,a,s,u,c,l,p)))}onRemoteUserPosed(t){let r=this.audio.getUserOffset(t.user.userID);r&&t.pose.setOffset(r[0],r[1],r[2])}chat(t){this.conferenceState==="Connected"&&this.toRoom("chat",t)}userExists(t){return this.users.has(t)}getUserNames(){return Array.from(this.users.values()).map(t=>[t.userID,t.userName])}async onAudioInputChanged(t){let r=t.audio&&t.audio.deviceId;await this.startStream(r,this.audio.useHeadphones)}async startStream(t,r){t?this.localStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:t,echoCancellation:!r,autoGainControl:!0,noiseSuppression:!0}}):this.localStream=null}async restartStream(){this.localStream=null,await this.startStream(this.audio.devices.preferredAudioOutputID,this.audio.useHeadphones)}get localStream(){return this.localStreamIn&&this.localStreamIn.mediaStream||null}set localStream(t){t!==this.localStream&&(this.localStreamIn&&(It(this.localStreamIn),this.localStreamIn=null),this.audio.devices.currentStream=t,t&&(this.localStreamIn=bi("local-mic",this.audio.audioCtx,t,this.audio)))}isMediaMuted(t){for(let r of this.audio.output.stream.getTracks())if(r.kind===t)return!r.enabled;return!0}setMediaMuted(t,r){for(let o of this.audio.output.stream.getTracks())o.kind===t&&(o.enabled=!r)}get audioMuted(){return this.isMediaMuted("audio")}set audioMuted(t){this.setMediaMuted("audio",t)}get videoMuted(){return this.isMediaMuted("video")}set videoMuted(t){this.setMediaMuted("video",t)}};function ji(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var Ne=class{constructor(e,t,r=null){this.value=e;this.desc=t;this.value=e,this.desc=t,this.props=r||{}}contains(e){return e instanceof Ne?this.contains(e.value):this.value.indexOf(e)>=0}};var Ki=new Ne("\u2B50","Star");var mt=new THREE.Vector3;function On(n){return mt.copy(n),mt.y=0,mt.normalize(),ni(Math.atan2(mt.x,mt.z))}var Ue=new THREE.Vector3,$i=0,vu=new THREE.Vector3,Nn=new THREE.Vector3,qi=new THREE.Vector3,Un=new THREE.Quaternion,Ji=0,Lu=0;function Bu(n,e){let t=n-e,r=t+2*Math.PI,o=t-2*Math.PI,i=Math.abs(t),a=Math.abs(r),s=Math.abs(o);return i<a&&i<s?t:a<s?r:o}var zn=class extends THREE.Object3D{constructor(t,r,o,i,a=1){super();this.minDistance=r;this.heightOffset=i;this.speed=a;this.name=t,this.lerp=this.minAngle>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minAngle=Tr(o),this.maxAngle=Math.PI-this.minAngle,Object.seal(this)}copy(t,r=!0){return super.copy(t,r),this.name=t.name+ ++Lu,this.lerp=t.lerp,this.maxDistance=t.maxDistance,this.minAngle=t.minAngle,this.maxAngle=t.maxAngle,this}update(t,r,o,i){i*=.001,this.clampTo(this.lerp,t,r,this.minDistance,this.maxDistance,o,this.minAngle,this.maxAngle,i)}reset(t,r,o){this.clampTo(!1,t,r,0,0,o,0,0,0)}clampTo(t,r,o,i,a,s,u,c,l){Ue.copy(o),Ue.y-=this.heightOffset*r,$i=s,this.getWorldPosition(Nn),this.getWorldDirection(qi),Ji=On(qi),Un.identity();let p=!t,d=!t;if(t){let g=vu.copy(Ue).sub(Nn).length();i<g&&(g<a&&Ue.lerpVectors(Nn,Ue,this.speed*l),p=!0);let f=Bu($i,Ji),w=Math.abs(f);u<w&&(w<c?Un.setFromAxisAngle(this.up,f*this.speed*l):Un.setFromAxisAngle(this.up,f),d=!0)}(p||d)&&(p&&this.position.add(Ue.sub(Nn)),d&&this.quaternion.multiply(Un))}};function Yi(n){let e=n.attributes.position,t=n.attributes.normal,r=n.attributes.uv;for(let o=0;o<t.count;++o){let i=o*t.itemSize,a=o*t.itemSize+1,s=o*t.itemSize+2,u=t.array[i],c=t.array[a],l=t.array[s],p=Math.abs(u),d=Math.abs(c),g=Math.abs(l),f=e.array[i],w=e.array[a],D=e.array[s],z=Math.abs(f),P=Math.abs(w),x=Math.abs(D),K=o*r.itemSize,Le=o*r.itemSize+1,y=r.array[K],B=r.array[Le],V=0,R=p,N=z;d>R&&(V=1,R=d,N=P),g>R&&(V=2,R=g,N=x),V===0?f<0?(y=-D,B=w):(y=D,B=w):V===1?w<0?(y=f,B=-D):(y=f,B=D):D<0?(y=f,B=w):(y=-f,B=w),y=(y/N+1)/8,B=(B/N+1)/6,V===0?f<0?(y+=0,B+=1/3):(y+=.5,B+=1/3):V===1?w<0?(y+=.25,B+=0):(y+=.25,B+=2/3):D<0?(y+=.25,B+=1/3):(y+=.75,B+=1/3);let G=r.array;G[K]=y,G[Le]=B}}var Mo=new THREE.BoxBufferGeometry(1,1,1,1,1,1);Mo.name="CubeGeom";var bo=Mo.clone();bo.name="InvertedCubeGeom";Yi(bo);var j=class extends THREE.Mesh{constructor(e,t,r,o){super(Mo,o),this.scale.set(e,t,r)}},Qi=class extends THREE.Mesh{constructor(e,t,r,o){super(bo,o),this.scale.set(e,t,r)}};THREE.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new THREE.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};THREE.ShaderLib.line={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var le=class extends THREE.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.line.uniforms),vertexShader:THREE.ShaderLib.line.vertexShader,fragmentShader:THREE.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}};le.prototype.isLineMaterial=!0;var Co=Q("Juniper:Three:Materials",()=>new Map);function Ru(n,e){e in n&&delete n[e]}function Vn(n,e,t){let r=`${n}_${Object.keys(t).map(o=>`${o}:${t[o]}`).join(",")}`;return Co.has(r)||(Ru(t,"name"),Co.set(r,new e(t))),Co.get(r)}function Pu(n){return Object.assign(n,{transparent:!0})}function dt(n){return Vn("solid",THREE.MeshBasicMaterial,n)}function Xi(n){return Vn("solidTransparent",THREE.MeshBasicMaterial,Pu(n))}function Gn(n){return Vn("lit",THREE.MeshStandardMaterial,n)}function Zi(n){return Vn("line2",le,n)}var _u=255,Do=65280;var Au=16711680;var ea=16776960,Iu=12632256;var ta=dt({color:_u}),na=dt({color:Do});var ra=dt({color:Au});var yo=Gn({color:Iu});var ze=class{constructor(e,t,r,...o){this.key=e;this.value=t;this.bySetAttribute=r;this.tags=o.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(e){let t=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(e.tagName)>-1||t))console.warn(`Element ${e.tagName} does not support Attribute ${this.key}`);else if(t){let o=this.key.substring(5);e.dataset[o]=this.value}else this.key==="style"?Object.assign(e.style,this.value):this.key==="classList"?this.value.forEach(o=>e.classList.add(o)):this.bySetAttribute?e.setAttribute(this.key,this.value):this.key in e?e[this.key]=this.value:this.value===!1?e.removeAttribute(this.key):this.value===!0?e.setAttribute(this.key,""):e.setAttribute(this.key,this.value)}};function oa(n){return new ze("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function ia(n){return new ze("width",n,!1,"canvas","embed","iframe","img","input","object","video")}function aa(n){return Fe(n)?n.element instanceof Node:!1}function Hu(n){return Fe(n)&&"elements"in n&&n.elements instanceof Array}function ht(n){return aa(n)?n.element:n}function Wu(n){return Fe(n)&&"applyToElement"in n&&W(n.applyToElement)}function sa(n,e,t="block"){n=ht(n),n.style.display=e?t:"none"}function ua(n){return n=ht(n),n.style.display!=="none"}function Ou(n,...e){n=ht(n);for(let t of e)m(t)&&(t instanceof Node?n.append(t):aa(t)?n.append(ht(t)):Hu(t)?n.append(...t.elements.map(ht)):Wu(t)?t.applyToElement(n):n.append(document.createTextNode(t.toLocaleString())));return n}function Nu(n,...e){let t=null;for(let r of e)if(r instanceof ze&&r.key==="id"){t=document.getElementById(r.value);break}return t==null&&(t=document.createElement(n)),Ou(t,...e),t}function ca(...n){return Nu("canvas",...n)}function vo(n){return m(n)&&n.isMesh}function Uu(n){return m(n)&&n.isMaterial}function la(n){return Uu(n)&&n.type==="MeshBasicMaterial"}function pa(n){return m(n)&&n.isObject3D}function Lo(n){return m(n)&&pa(n.object)}function be(n){return Lo(n)?n.object:n}function Ce(n,e){return n=be(n),n.visible=e,e}function Fa(n){return n=be(n),n.visible}function ma(n){for(n=be(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function b(n,...e){let t=e.filter(m).map(be);return t.length>0&&be(n).add(...t),n}function da(n,...e){let t=new THREE.Object3D;return t.name=n,b(t,...e),t}var Ve=new THREE.Vector3;function jn(n,e,t,r){Ve.crossVectors(e,n),n.crossVectors(Ve,e),Ve.normalize(),n.normalize(),e.normalize(),r.set(Ve.x,n.x,-e.x,t.x,Ve.y,n.y,-e.y,t.y,Ve.z,n.z,-e.z,t.z,0,0,0,1)}var Bo="Juniper:ThreeJS:EventSystem:RayTarget",Ro=class extends U{constructor(t){super();this.object=t;this.meshes=new Array;this._disabled=!1;this._clickable=!1;this._draggable=!1;this.object.userData[Bo]=this}addMesh(t){return t.userData[Bo]=this,this.meshes.push(t),this}get disabled(){return this._disabled}set disabled(t){this._disabled=t}get enabled(){return!this.disabled}set enabled(t){this.disabled=!t}get clickable(){return this._clickable}set clickable(t){this._clickable=t}get draggable(){return this._draggable}set draggable(t){this._draggable=t}};function zu(n){return n instanceof Ro}function Vu(n){return m(n)&&O(n.distance)&&n.point instanceof THREE.Vector3&&(n.object===null||n.object instanceof THREE.Object3D)}function gt(n){return n?zu(n)?n:((Vu(n)||Lo(n))&&(n=n.object),n&&n.userData[Bo]):null}var Po=new THREE.Vector3,ft=new THREE.Vector3,ha=new THREE.Quaternion,xe=class{constructor(){this._object=null;this._visible=!0;this._style="default"}get object(){return this._object}set object(e){this._object=e}get style(){return this._style}set style(e){this._style=e}get visible(){return this._visible}set visible(e){this._visible=e}update(e,t,r,o,i,a,s,u){t&&t.face?(this.position.copy(t.point),t.object.getWorldQuaternion(ha),Po.copy(t.face.normal).applyQuaternion(ha),ft.copy(Po).multiplyScalar(.02),this.position.add(ft),ft.copy(Po).multiplyScalar(10).add(this.position)):(this.position.copy(a).multiplyScalar(r).add(i),ft.copy(e)),this.object.parent.worldToLocal(this.position),this.lookAt(ft);let c=gt(t);this.style=c?c.enabled?c.draggable?u?"grabbing":"move":c.clickable?"pointer":"default":"not-allowed":o?s===1?"grabbing":"grab":"default"}lookAt(e){}};var Ge=class extends xe{constructor(){super();this.material=dt({name:"CursorMat",color:16776960}),this.object=new j(.01,.01,.01,this.material)}get position(){return this.object.position}get style(){return this._currentStyle}set style(t){if(this._currentStyle=t,vo(this.object)&&!Se(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new THREE.Color(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new THREE.Color(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new THREE.Color(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new THREE.Color(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new THREE.Color(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new THREE.Color(16776960),this.material.needsUpdate=!0;break}}get visible(){return Fa(this)}set visible(t){Ce(this,t)}};var Kn=class extends xe{constructor(t){super();this.element=t;this._hidden=!1;this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get position(){throw new Error("BaseCursor::get_Position(): Method not implemented.")}get style(){return super.style}set style(t){super.style=t,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(t){super.visible=t,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var $n=class extends xe{constructor(t){super();this.renderer=t;this.xr=new Ge;this.system=new Kn(this.renderer.domElement),this.visible=!1}get object(){return this.xr.object}get cursor(){return this.xr}set cursor(t){this.xr=t,this._refresh()}get position(){return this.object.position}get style(){return this.system.style}get visible(){return this.renderer.xr.isPresenting&&this.xr.visible||!this.renderer.xr.isPresenting&&this.system.visible}set visible(t){super.visible=t,this._refresh()}set style(t){this.system.style=t,this.xr.style=t,this._refresh()}_refresh(){Ce(this.xr,this.visible&&(this.renderer.xr.isPresenting||document.pointerLockElement!=null))}lookAt(t){this.xr.lookAt(t)}};var ju=5,qn=class{constructor(e,t,r,o){this.type=e;this.name=t;this.env=r;this._canMoveView=!1;this._enabled=!1;this.canClick=!1;this._buttons=0;this.lastButtons=0;this.moveDistance=0;this._dragging=!1;this.wasDragging=!1;this.dragDistance=0;this.isActive=!1;this.origin=new THREE.Vector3;this.direction=new THREE.Vector3;this.curHit=null;this.hoveredHit=null;this._pressedHit=null;this.draggedHit=null;this._cursor=o,this.cursor&&(this.cursor.visible=!1),this.canMoveView=!1}get pressedHit(){return this._pressedHit}set pressedHit(e){this._pressedHit=e;let t=gt(e);t&&t.draggable&&!t.clickable&&this.onDragStart()}get canMoveView(){return this._canMoveView}set canMoveView(e){this._canMoveView=e}vibrate(){}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let t=this.cursor,r=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",o=t&&t.object&&t.object.parent;o&&o.remove(t.object),e&&(e.object.name=r,t instanceof $n?(t.cursor=e,o&&b(o,t)):(this._cursor=e,t&&(o&&b(o,e),e.style=t.style,e.visible=t.visible)))}}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}get buttons(){return this._buttons}get dragging(){return this._dragging}set dragging(e){this._dragging=e,this.dragDistance=0}get needsUpdate(){return this.enabled&&this.isActive}setEventState(e){this.env.eventSystem.checkPointer(this,e)}update(){this.needsUpdate&&(this.onUpdate(),this.lastButtons=this.buttons,this.wasDragging=this.dragging)}updateCursor(e,t,r){this.cursor&&this.cursor.update(e,t,r,this.canMoveView,this.origin,this.direction,this.buttons,this.dragging)}onPointerDown(){this.dragging=!1,this.canClick=!0,this.env.avatar.setMode(this),this.setEventState("down")}onPointerMove(){if(this.setEventState("move"),this.buttons!==0){let e=gt(this.pressedHit);(!e||e.draggable)&&(this.buttons===this.lastButtons?(this.dragDistance+=this.moveDistance,this.dragDistance>ju&&this.onDragStart()):this.dragging&&(this.dragging=!1,this.setEventState("dragcancel")))}}onDragStart(){this.dragging=!0,this.wasDragging||this.setEventState("dragstart"),this.canClick=!1,this.setEventState("drag")}onPointerUp(){if(this.canClick){let e=this.buttons;this._buttons=this.lastButtons,this.setEventState("click"),this._buttons=e}this.setEventState("up"),this.dragging=!1,this.wasDragging&&this.setEventState("dragend")}};var ga=new THREE.Box3,Jn=new THREE.Vector3,De=class extends THREE.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new THREE.Float32BufferAttribute(e,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(t,2))}applyMatrix4(e){let t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let r=new THREE.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new THREE.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new THREE.InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let r=new THREE.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new THREE.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceColorEnd",new THREE.InterleavedBufferAttribute(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new THREE.WireframeGeometry(e.geometry)),this}fromLineSegments(e){let t=e.geometry;if(t.isGeometry){console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),ga.setFromBufferAttribute(t),this.boundingBox.union(ga))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){let r=this.boundingSphere.center;this.boundingBox.getCenter(r);let o=0;for(let i=0,a=e.count;i<a;i++)Jn.fromBufferAttribute(e,i),o=Math.max(o,r.distanceToSquared(Jn)),Jn.fromBufferAttribute(t,i),o=Math.max(o,r.distanceToSquared(Jn));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};De.prototype.isLineSegmentsGeometry=!0;var fa=new THREE.Vector3,xa=new THREE.Vector3,I=new THREE.Vector4,H=new THREE.Vector4,re=new THREE.Vector4,_o=new THREE.Vector3,Ao=new THREE.Matrix4,Y=new THREE.Line3,wa=new THREE.Vector3,pe=new THREE.Box3,Yn=new THREE.Sphere,oe=new THREE.Vector4;function Sa(n,e,t,r){return oe.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),oe.multiplyScalar(1/oe.w),oe.x=t/r.width,oe.y=t/r.height,oe.applyMatrix4(n.projectionMatrixInverse),oe.multiplyScalar(1/oe.w),Math.abs(Math.max(oe.x,oe.y))}var xt=class extends THREE.Mesh{constructor(e=new De,t=new le({color:Math.random()*16777215})){super(e,t),this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,o=new Float32Array(2*t.count);for(let a=0,s=0,u=t.count;a<u;a++,s+=2)fa.fromBufferAttribute(t,a),xa.fromBufferAttribute(r,a),o[s]=s===0?0:o[s-1],o[s+1]=o[s]+fa.distanceTo(xa);let i=new THREE.InstancedInterleavedBuffer(o,2,1);return e.setAttribute("instanceDistanceStart",new THREE.InterleavedBufferAttribute(i,1,0)),e.setAttribute("instanceDistanceEnd",new THREE.InterleavedBufferAttribute(i,1,1)),this}raycast(e,t){e.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let r=e.params.Line2!==void 0&&e.params.Line2.threshold||0,o=e.ray,i=e.camera,a=i.projectionMatrix,s=this.matrixWorld,u=this.geometry,c=this.material,l=c.resolution,p=c.linewidth+r,d=u.attributes.instanceStart,g=u.attributes.instanceEnd,f=-i.near;u.boundingSphere===null&&u.computeBoundingSphere(),Yn.copy(u.boundingSphere).applyMatrix4(s);let w=Math.max(i.near,Yn.distanceToPoint(o.origin)),D=Sa(i,w,p,l);if(Yn.radius+=D,e.ray.intersectsSphere(Yn)===!1)return;u.boundingBox===null&&u.computeBoundingBox(),pe.copy(u.boundingBox).applyMatrix4(s);let z=Math.max(i.near,pe.distanceToPoint(o.origin)),P=Sa(i,z,p,l);if(pe.max.x+=P,pe.max.y+=P,pe.max.z+=P,pe.min.x-=P,pe.min.y-=P,pe.min.z-=P,e.ray.intersectsBox(pe)!==!1){o.at(1,re),re.w=1,re.applyMatrix4(i.matrixWorldInverse),re.applyMatrix4(a),re.multiplyScalar(1/re.w),re.x*=l.x/2,re.y*=l.y/2,re.z=0,_o.copy(re),Ao.multiplyMatrices(i.matrixWorldInverse,s);for(let K=0,Le=d.count;K<Le;K++){I.fromBufferAttribute(d,K),H.fromBufferAttribute(g,K),I.w=1,H.w=1,I.applyMatrix4(Ao),H.applyMatrix4(Ao);var x=I.z>f&&H.z>f;if(x)continue;if(I.z>f){let N=I.z-H.z,G=(I.z-f)/N;I.lerp(H,G)}else if(H.z>f){let N=H.z-I.z,G=(H.z-f)/N;H.lerp(I,G)}I.applyMatrix4(a),H.applyMatrix4(a),I.multiplyScalar(1/I.w),H.multiplyScalar(1/H.w),I.x*=l.x/2,I.y*=l.y/2,H.x*=l.x/2,H.y*=l.y/2,Y.start.copy(I),Y.start.z=0,Y.end.copy(H),Y.end.z=0;let y=Y.closestPointToPointParameter(_o,!0);Y.at(y,wa);let B=THREE.MathUtils.lerp(I.z,H.z,y),V=B>=-1&&B<=1,R=_o.distanceTo(wa)<p*.5;if(V&&R){Y.start.fromBufferAttribute(d,K),Y.end.fromBufferAttribute(g,K),Y.start.applyMatrix4(s),Y.end.applyMatrix4(s);let N=new THREE.Vector3,G=new THREE.Vector3;o.distanceSqToSegment(Y.start,Y.end,G,N),t.push({point:G,pointOnLine:N,distance:o.origin.distanceTo(G),object:this,face:null,faceIndex:K,uv:null,uv2:null})}}}}};xt.prototype.isLineSegments2=!0;var ye=class extends De{constructor(){super(),this.type="LineGeometry"}setPositions(e){for(var t=e.length-3,r=new Float32Array(2*t),o=0;o<t;o+=3)r[2*o]=e[o],r[2*o+1]=e[o+1],r[2*o+2]=e[o+2],r[2*o+3]=e[o+3],r[2*o+4]=e[o+4],r[2*o+5]=e[o+5];return super.setPositions(r),this}setColors(e){for(var t=e.length-3,r=new Float32Array(2*t),o=0;o<t;o+=3)r[2*o]=e[o],r[2*o+1]=e[o+1],r[2*o+2]=e[o+2],r[2*o+3]=e[o+3],r[2*o+4]=e[o+4],r[2*o+5]=e[o+5];return super.setColors(r),this}fromLine(e){var t=e.geometry;if(t.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}};ye.prototype.isLineGeometry=!0;var wt=class extends xt{constructor(e=new ye,t=new le({color:Math.random()*16777215})){super(e,t),this.type="Line2"}};wt.prototype.isLine2=!0;var Ta=new ye;Ta.setPositions([0,0,0,0,0,-1]);var Qn=class extends THREE.Object3D{constructor(t,r=1){super();this._length=1;this.line=new wt(Ta,Zi({color:t,linewidth:r})),this.line.computeLineDistances(),b(this,this.line)}get length(){return this._length}set length(t){this._length=t,this.line.scale.set(1,1,t)}};var Xn=class extends qn{constructor(t,r,o,i,a){super("remote",18,t,a||new Ge);this.pTarget=new THREE.Vector3;this.qTarget=new THREE.Quaternion().identity();this.laser=new Qn(o?Do:ea,.002),this.laser.length=30;let s=new j(.05,.05,.05,yo);b(s,this.laser);let u=new j(.05,.05,.05,yo);this.object=da(`remote:${r}:${He[i]}`,s,u),i===1?s.position.set(0,0,-.2):(i===15||i===16||i===17)&&u.position.set(0,0,.2),this.cursor.object.name=`${this.object.name}:cursor`}setState(t,r,o,i,a){this.origin.copy(r),this.direction.copy(o),this.cursor.visible=!0,this.env.eventSystem.fireRay(this),this.updateCursor(t,this.curHit,3),r.add(a),this.curHit&&o.copy(this.curHit.point).sub(r).normalize(),jn(i,o,r,ka),$u.copy(this.object.parent.matrixWorld).invert().multiply(ka).decompose(this.pTarget,this.qTarget,Ku)}onUpdate(){}animate(t){this.object.position.lerp(this.pTarget,t*.01),this.object.quaternion.slerp(this.qTarget,t*.01)}isPressed(t){return!1}},Ku=new THREE.Vector3,$u=new THREE.Matrix4,ka=new THREE.Matrix4;var Zn="HTMLCanvasElement"in globalThis,b1="HTMLImageElement"in globalThis,Ea=!1,er=!Ea&&"OffscreenCanvas"in globalThis,Ma=!Ea&&"createImageBitmap"in globalThis;function tr(n){return Zn&&n instanceof HTMLCanvasElement}function ba(n){return er&&n instanceof OffscreenCanvas}function Ca(n){return Ma&&n instanceof ImageBitmap}function qu(n,e){let t=n.getContext("2d");if(S(t))throw new Error("Could not create 2d context for canvas");t.drawImage(e,0,0)}function Ju(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var Yu=er&&Ju(),nr=Yu&&Zu||Zn&&Io||null,Da=Zn?Io:nr;function Qu(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var C1=er&&Qu();function Xu(){if(!Zn&&!er)return!1;try{return nr(1,1).getContext("bitmaprenderer")!=null}catch{return!1}}var D1=Ma&&Xu();function Zu(n,e){return new OffscreenCanvas(n,e)}function Io(n,e){return ca(ia(n),oa(e))}function ya(n){let e=Io(n.width,n.height);return qu(e,n),e}function va(n,e,t,r=1){return e=Math.floor(e*r),t=Math.floor(t*r),n.width!=e||n.height!=t?(n.width=e,n.height=t,!0):!1}function ec(n){return m(n.textBaseline)}function tc(n,e,t,r=1){let o=n.imageSmoothingEnabled,i=n.textBaseline,a=n.textAlign,s=n.font,u=va(n.canvas,e,t,r);return u&&(n.imageSmoothingEnabled=o,n.textBaseline=i,n.textAlign=a,n.font=s),u}function Ho(n,e,t,r=1){return ec(n)?tc(n,e,t,r):va(n.canvas,e,t,r)}var L1=Q("juniper::loadedFonts",()=>[]);function La(n){let e=[];return n.fontStyle&&n.fontStyle!=="normal"&&e.push(n.fontStyle),n.fontVariant&&n.fontVariant!=="normal"&&e.push(n.fontVariant),n.fontWeight&&n.fontWeight!=="normal"&&e.push(n.fontWeight),e.push(`${n.fontSize}px`),e.push(n.fontFamily),e.join(" ")}var rr=class extends U{constructor(t,r,o){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new we("redrawn");this.element=null;m(o)&&m(o.scale)&&(this._scale=o.scale),this._canvas=Da(t,r),this._g=this.canvas.getContext("2d"),tr(this._canvas)&&(this.element=this._canvas)}fillRect(t,r,o,i,a,s){this.g.fillStyle=t,this.g.fillRect(r+s,o+s,i-2*s,a-2*s)}drawText(t,r,o,i){this.g.textAlign=i,this.g.strokeText(t,r,o),this.g.fillText(t,r,o)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(t){this.scale!==t&&(this._scale=t,this.redraw())}get visible(){return this._visible}set visible(t){this.visible!==t&&(this.wasVisible=this._visible,this._visible=t,this.redraw())}};var St=class extends rr{trueWidth=null;trueHeight=null;trueFontSize=null;dx=null;_minWidth=null;_maxWidth=null;_minHeight=null;_maxHeight=null;_freezeDimensions=!1;_dimensionsFrozen=!1;_bgFillColor=null;_bgStrokeColor=null;_bgStrokeSize=null;_textStrokeColor=null;_textStrokeSize=null;_textFillColor="black";_textDirection="horizontal";_wrapWords=!0;_fontStyle="normal";_fontVariant="normal";_fontWeight="normal";_fontFamily="sans-serif";_fontSize=20;_padding;_value=null;constructor(e){super(10,10,e),m(e)&&(m(e.minWidth)&&(this._minWidth=e.minWidth),m(e.maxWidth)&&(this._maxWidth=e.maxWidth),m(e.minHeight)&&(this._minHeight=e.minHeight),m(e.maxHeight)&&(this._maxHeight=e.maxHeight),m(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),m(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),m(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),m(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),m(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),m(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),m(e.value)&&(this._value=e.value),m(e.textFillColor)&&(this._textFillColor=e.textFillColor),m(e.textDirection)&&(this._textDirection=e.textDirection),m(e.wrapWords)&&(this._wrapWords=e.wrapWords),m(e.fontStyle)&&(this._fontStyle=e.fontStyle),m(e.fontVariant)&&(this._fontVariant=e.fontVariant),m(e.fontWeight)&&(this._fontWeight=e.fontWeight),m(e.fontFamily)&&(this._fontFamily=e.fontFamily),m(e.fontSize)&&(this._fontSize=e.fontSize),m(e.padding)&&(O(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),S(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get wrapWords(){return this._wrapWords}set wrapWords(e){this.wrapWords!==e&&(this._wrapWords=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}draw(e,t,r){this.canvas.width>0&&this.canvas.height>0&&e.drawImage(this.canvas,t,r,this.width,this.height)}split(e){return this.wrapWords?e.split(" ").join(`
`).replace(/\r\n/,`
`).split(`
`):e.replace(/\r\n/,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value){let e=this.split(this.value),t=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let o=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,i=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,a=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,s=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,u=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,c=t?s:i,l=t?u:a,p=t?i:s,d=t?a:u,g=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let f=!1,w=!1,D=1e4,z=0;this.trueFontSize=Er(this.fontSize*this.scale,z,D);let P=null,x=Number.MAX_VALUE;do{let y=this.fontSize;this._fontSize=this.trueFontSize;let B=La(this);this._fontSize=y,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=B,this.trueWidth=0,this.trueHeight=0;for(let V of e){let R=this.g.measureText(V);this.trueWidth=Math.max(this.trueWidth,R.width),this.trueHeight+=this.trueFontSize,O(R.actualBoundingBoxLeft)&&O(R.actualBoundingBoxRight)&&O(R.actualBoundingBoxAscent)&&O(R.actualBoundingBoxDescent)&&(o||(this.trueWidth=R.actualBoundingBoxLeft+R.actualBoundingBoxRight,this.trueHeight=R.actualBoundingBoxAscent+R.actualBoundingBoxDescent,this.dx=(R.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(o){let V=this.trueWidth-c,R=this.trueWidth-l,N=this.trueHeight-p,G=this.trueHeight-d,Aa=Math.abs(V),Ia=Math.abs(R),Ha=Math.abs(N),Wa=Math.abs(G);f=R>1||G>1,w=V<-1&&N<-1;let Oo=Math.min(Aa,Math.min(Ia,Math.min(Ha,Wa)));Oo<x&&(x=Oo,P=this.g.font),(f||w)&&g.indexOf(this.g.font)>-1&&P&&(this.g.font=P,f=!1,w=!1),f?(D=this.trueFontSize,this.trueFontSize=(z+this.trueFontSize)/2):w&&(z=this.trueFontSize,this.trueFontSize=(this.trueFontSize+D)/2)}g.push(this.g.font)}while(f||w);o&&(this.trueWidth<c?this.trueWidth=c:this.trueWidth>l&&(this.trueWidth=l),this.trueHeight<p?this.trueHeight=p:this.trueHeight>d&&(this.trueHeight=d));let K=this.trueWidth+this.scale*(this.padding.right+this.padding.left),Le=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{Ho(this.g,K,Le)}catch(y){throw console.error(y),y}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let r=.5*(e.length-1);for(let o=0;o<e.length;++o){let i=e[o],a=(o-r)*this.trueFontSize,s=this.dx+this.trueWidth/2+this.scale*this.padding.left,u=a+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(i,s,u),this.textFillColor&&this.g.fillText(i,s,u)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let o=this.bgStrokeSize/2;this.g.strokeRect(o,o,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(t){let o=nr(this.canvas.height,this.canvas.width),i=o.getContext("2d");i?(i.translate(o.width/2,o.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?i.rotate(Math.PI/2):this.textDirection==="vertical-right"&&i.rotate(-Math.PI/2),i.translate(-this.canvas.width/2,-this.canvas.height/2),i.drawImage(this.canvas,0,0),Ho(this.g,o.width,o.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(o,0,0)}return!0}else return!1}};var Ba=Q("Juniper:ScaledItems",()=>new Map);function Ra(n){let e=Ba.get(n);e&&(Ba.delete(n),e.dispose())}function Tt(n){let e=new Array,t=new Set;for(e.push(n);e.length>0;){let r=e.shift();r&&!t.has(r)&&(t.add(r),r.isMesh&&e.push(r.material,r.geometry),r.isMaterial&&e.push(...Object.values(r)),r.isObject3D&&(e.push(...r.children),r.clear(),Ra(r)),Se(r)&&e.push(...r),hi(r))}t.clear()}var nc=new THREE.Matrix4,or=new THREE.Vector3;function Wo(n,e,t,r,o){nc.copy(n.matrixWorld).invert().multiply(e.matrixWorld).decompose(or,r,o),t.set(or.x,or.y,or.z,1)}var ir=new THREE.PlaneBufferGeometry(1,1,1,1);ir.name="PlaneGeom";var Pa=class extends THREE.Mesh{constructor(e,t,r){super(ir,r),this.scale.set(e,t,1)}};var ar=new THREE.Vector4,sr=new THREE.Quaternion,je=new THREE.Vector3,rc=0,Ke=class extends THREE.Object3D{constructor(t,r,o,i=null){super();this.isStatic=o;this.lastMatrixWorld=new THREE.Matrix4;this.layer=null;this.tryWebXRLayers=!0;this.wasUsingLayer=!1;this._imageWidth=0;this._imageHeight=0;this.lastImage=null;this.lastWidth=null;this.lastHeight=null;this.stereoLayoutName="mono";this.env=null;this.mesh=null;this.webXRLayersEnabled=!0;this.sizeMode="none";if(t){this.setEnvAndName(t,r);let a=la(i)?i:Xi(Object.assign({},i,{name:this.name}));this.mesh=new THREE.Mesh(ir,a),b(this,this.mesh)}}dispose(){Tt(this.layer)}setImageSize(t,r){if(t!==this._imageWidth||r!==this._imageHeight){let{objectWidth:o,objectHeight:i}=this;this._imageWidth=t,this._imageHeight=r,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=o:this.objectHeight=i)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(t){this.scale.set(t,this.scale.y=t/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(t){this.scale.set(this.imageAspectRatio*t,t,1)}get pixelDensity(){let t=mi(this.objectWidth);return this.imageWidth/t}set pixelDensity(t){let r=this.imageWidth/t,o=Fi(r);this.objectWidth=o}setEnvAndName(t,r){this.env=t,this.name=r,this.tryWebXRLayers&&=this.env&&this.env.hasXRCompositionLayers}copy(t,r=!0){super.copy(t,r),this.setImageSize(t.imageWidth,t.imageHeight),this.setEnvAndName(t.env,t.name+ ++rc);for(let o=this.children.length-1;o>=0;--o){let i=this.children[o];i.parent instanceof Ke&&i instanceof THREE.Mesh&&(i.removeFromParent(),this.mesh=new THREE.Mesh(i.geometry,i.material))}return S(this.mesh)&&(this.mesh=t.mesh.clone(),b(this,this.mesh)),this}get needsLayer(){if(!ma(this)||S(this.mesh.material.map)||S(this.mesh.material.map.image))return!1;let t=this.mesh.material.map.image;return t instanceof HTMLVideoElement?!t.paused||t.currentTime>0:!0}removeWebXRLayer(){if(m(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer);let t=this.layer;this.layer=null,setTimeout(()=>{t.destroy(),this.mesh.visible=!0},100)}}setTextureMap(t){return Ca(t)&&(t=ya(t)),ba(t)&&(t=t),t instanceof HTMLVideoElement?(this.mesh.material.map=new THREE.VideoTexture(t),this.setImageSize(t.videoWidth,t.videoHeight)):(this.mesh.material.map=new THREE.Texture(t),this.setImageSize(t.width,t.height),this.mesh.material.map.needsUpdate=!0),this.mesh.material.needsUpdate=!0,this.mesh.material.map}async loadTextureMap(t,r,o){let{content:i}=await t.get(r).progress(o).image(),a=this.setTextureMap(i);a.name=r}updateTexture(){let t=this.mesh.material.map.image;O(t.width)&&O(t.height)&&(this.imageWidth!==t.width||this.imageHeight!==t.height)&&(this.mesh.material.map.dispose(),this.mesh.material.map=new THREE.Texture(t),this.mesh.material.needsUpdate=!0,this.setImageSize(t.width,t.height)),this.mesh.material.map.needsUpdate=!0}update(t,r){if(this.mesh.material.map&&this.mesh.material.map.image){let o=this.mesh.material.map instanceof THREE.VideoTexture,a=this.tryWebXRLayers&&this.webXRLayersEnabled&&m(r)&&(o&&m(this.env.xrMediaBinding)||!o&&m(this.env.xrBinding))&&this.needsLayer,s=a!==this.wasUsingLayer,u=this.mesh.material.map.image!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate,c=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=a,this.lastImage=this.mesh.material.map.image,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(s||c)&&((!a||c)&&this.layer&&this.removeWebXRLayer(),a)){let l=this.env.referenceSpace;Wo(this.env.stage,this.mesh,ar,sr,je),this.lastMatrixWorld.copy(this.matrixWorld);let p=new XRRigidTransform(ar,sr),d=je.x/2,g=je.y/2,f=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(o){let w=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.mesh.material.map.image,{space:l,layout:f,invertStereo:w,transform:p,width:d,height:g})}else this.layer=this.env.xrBinding.createQuadLayer({space:l,layout:f,textureType:"texture",isStatic:this.isStatic,viewPixelWidth:this.imageWidth,viewPixelHeight:this.imageHeight,transform:p,width:d,height:g});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(u||this.layer.needsRedraw){let l=this.env.gl,p=this.env.xrBinding.getSubImage(this.layer,r);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0),l.bindTexture(l.TEXTURE_2D,p.colorTexture),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.mesh.material.map.image),l.generateMipmap(l.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null)}zo(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(Wo(this.env.stage,this.mesh,ar,sr,je),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.transform=new XRRigidTransform(ar,sr),this.layer.width=je.x/2,this.layer.height=je.y/2)}}}};var oc={type:"redrawn"},ur=class extends Ke{constructor(t,r,o,i){super(t,r,!1,i);this._onRedrawn=this.onRedrawn.bind(this),this.image=o}get object(){return this}get element(){return tr(this.image.canvas)?this.image.canvas:null}onRedrawn(){this.updateTexture(),this.dispatchEvent(oc)}get image(){return this._image}set image(t){this.image&&this.image.removeEventListener("redrawn",this._onRedrawn),this._image=t,this.image&&(this.image.addEventListener("redrawn",this._onRedrawn),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(t,r=!0){return super.copy(t,r),this.image=t.image,this}get isVisible(){return ua(this)}set isVisible(t){sa(this,t,"inline-block"),Ce(this,t),Ce(this.mesh,t),this.image.visible=t}};var cr=class extends ur{constructor(e,t,r,o){let i;r instanceof St?i=r:i=new St(r),super(e,t,i,o)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var ve=new THREE.Vector3,ie=new THREE.Vector3,lr=new THREE.Vector3,kt=new THREE.Vector3,pr=new THREE.Vector3,_a=new THREE.Matrix4,ic=Math.PI/2,ac={fontFamily:ji(),fontSize:20,fontWeight:"bold",textFillColor:"#ffffff",textStrokeColor:"#000000",textStrokeSize:.01,wrapWords:!1,padding:{top:.025,right:.05,bottom:.025,left:.05},maxHeight:.2},Fr=class extends THREE.Object3D{constructor(t,r,o,i,a){super();this.env=t;this.defaultAvatarHeight=a;this.avatar=null;this.isInstructor=!1;this.pointers=new Map;this.head=null;this.body=null;this.pTarget=new THREE.Vector3;this.pEnd=new THREE.Vector3;this.qTarget=new THREE.Quaternion().identity();this.qEnd=new THREE.Quaternion().identity();this.headFollower=null;this._headSize=1;this._headPulse=1;this.height=this.defaultAvatarHeight,this.name=r.userName,this.nameTag=new cr(this.env,`nameTag-${r.userName}-${r.userID}`,Object.assign({},ac,i)),this.nameTag.position.y=.25,this.userName=r.userName,b(this,this.nameTag),r.addEventListener("userPosed",s=>this.setPose(s.pose,s.height)),r.addEventListener("userPointer",s=>{this.setPointer(this.env.avatar.worldPos,s.name,s.pose)}),this.activity=new Oe(`remote-user-activity-${r.userName}-${r.userID}`,this.env.audio.audioCtx),o.addEventListener("sourceadded",s=>{tt(s.source,this.activity)})}dispose(){for(let t of this.pointers.keys())this.removeArm(t);this.activity.dispose()}get headSize(){return this._headSize}set headSize(t){this._headSize=t,this.refreshHead()}get headPulse(){return this._headPulse}set headPulse(t){this._headPulse=t,this.refreshHead()}refreshHead(){this.head&&this.head.scale.setScalar(this.headSize*this.headPulse)}get userName(){return this.nameTag.image.value}set userName(t){if(t){let r=t.match(/^(?:((?:student|instructor))_)?([^<>{}"]+)$/i);r&&(r.length===2?this.nameTag.image.value=r[1]:r.length===3?(this.isInstructor=r[1]&&r[1].toLocaleLowerCase()==="instructor",this.isInstructor?this.nameTag.image.value=Ki.value+r[2]:this.nameTag.image.value=r[2]):this.nameTag.image.value="???")}}setAvatar(t){this.avatar&&(this.remove(this.avatar),this.head=null,this.body=null),t&&(this.avatar=t,this.avatar.traverse(r=>{r.name==="Head"?this.head=r:r.name==="Body"&&(this.body=r)}),this.head&&this.body&&(this.headFollower=new zn("AvatarBody",.05,ic,0,5),b(this.body.parent,b(this.headFollower,b(this.body,this.nameTag)))),b(this,this.avatar))}removeArm(t){let r=this.pointers.get(t);r&&(this.body.remove(r.object),this.pointers.delete(t),r.cursor&&this.env.stage.remove(r.cursor.object))}refreshCursors(){for(let t of this.pointers.values())t.cursor&&(t.cursor=this.env.cursor3D.clone())}update(t){if(this.headPulse=.2*this.activity.level+1,this.pEnd.lerp(this.pTarget,t*.01),this.qEnd.slerp(this.qTarget,t*.01),this.head&&this.body){this.head.position.copy(this.pEnd),this.head.quaternion.copy(this.qEnd),this.head.getWorldPosition(ve),this.head.getWorldDirection(ie);let r=On(ie);this.headFollower.update(ve.y-this.parent.position.y,ve,r,t);let o=this.height/this.defaultAvatarHeight;this.headSize=o,this.body.scale.setScalar(o),ie.copy(this.env.avatar.worldPos),this.body.worldToLocal(ie),ie.sub(this.body.position).normalize().multiplyScalar(.25),this.nameTag.position.set(0,-.25,0).add(ie)}else this.position.copy(this.pEnd),this.quaternion.copy(this.qEnd);for(let r of this.pointers.values())r.animate(t);this.nameTag.lookAt(this.env.avatar.worldPos)}setPose(t,r){kt.fromArray(t.o),ve.fromArray(t.p).add(kt),ie.fromArray(t.f),lr.fromArray(t.u),jn(lr,ie,ve,_a),_a.decompose(this.pTarget,this.qTarget,this.scale),this.height=r}setPointer(t,r,o){let i=this.pointers.get(r);i||(i=new Xn(this.env,this.userName,this.isInstructor,r,this.env.cursor3D&&this.env.cursor3D.clone()),this.pointers.set(r,i),b(this.body,i),i.cursor&&b(this.env.stage,i.cursor),r===1?(this.removeArm(15),this.removeArm(16),this.removeArm(17)):(r===15||r===16||r===17)&&(this.removeArm(1),this.removeArm(2),this.removeArm(3),this.removeArm(4),this.removeArm(5),this.removeArm(6),this.removeArm(7),this.removeArm(8),this.removeArm(9),this.removeArm(10),this.removeArm(11),this.removeArm(12),this.removeArm(13),this.removeArm(14))),ve.fromArray(o.p),ie.fromArray(o.f),lr.fromArray(o.u),kt.fromArray(o.o),r===1&&this.body?pr.set(.2,-.6,0).applyQuaternion(this.body.quaternion):He[r].startsWith("Touch")&&this.body?pr.set(0,-.5,0).applyQuaternion(this.body.quaternion):pr.setScalar(0),kt.add(pr),i.setState(t,ve,ie,lr,kt)}};var mr=class extends THREE.Object3D{constructor(t){super();this.color=t;this.center=null;m(this.color)&&(this.center=new j(.5,.5,.5,Gn({color:this.color})),b(this,this.center)),this.xp=new j(1,.1,.1,ra),this.yp=new j(.1,1,.1,na),this.zn=new j(.1,.1,1,ta),this.xp.position.x=1,this.yp.position.y=1,this.zn.position.z=-1,b(this,this.xp,this.yp,this.zn)}copy(t,r=!0){return super.copy(t,r),this.color=t.color,this.center=new j(.5,.5,.5,Gn({color:t.color})),this}get size(){return this.xp.scale.x}set size(t){m(this.center)&&this.center.scale.setScalar(t),this.xp.scale.setScalar(.1*t),this.yp.scale.setScalar(.1*t),this.zn.scale.setScalar(.1*t),this.xp.scale.x=this.yp.scale.y=this.zn.scale.z=t,this.xp.position.x=this.yp.position.y=t,this.zn.position.z=-t}};var dr=class extends U{constructor(t){super();this.env=t}};var hr=class extends dr{users=new Map;remoteUsers=new THREE.Object3D;conference=null;defaultAvatarHeight=1.75;avatarModel=null;avatarNameTagFont=null;hubName=null;userType=null;userName=null;meetingID=null;roomName=null;constructor(e){super(e)}get ready(){return this.conference&&this.conference.ready}async init(e){if(this.defaultAvatarHeight=e.get("defaultAvatarHeight"),!this.defaultAvatarHeight)throw new Error("Missing defaultAvatarHeight parameter");if(this.hubName=e.get("hub"),!this.hubName)throw new Error("Missing hub parameter");if(this.avatarNameTagFont=e.get("nameTagFont"),!this.avatarNameTagFont)throw new Error("Missing nameTagFont parameter");this.env.avatar.addEventListener("avatarmoved",r=>this.conference.setLocalPose(r.px,r.py,r.pz,r.fx,r.fy,r.fz,r.ux,r.uy,r.uz,r.height)),this.env.eventSystem.addEventListener("objectMoved",r=>{this.conference.setLocalPointer(r.name,r.px,r.py,r.pz,r.fx,r.fy,r.fz,r.ux,r.uy,r.uz)}),this.env.addEventListener("newcursorloaded",()=>{for(let r of this.users.values())r.refreshCursors()}),this.env.addEventListener("roomjoined",r=>this.join(r.roomName)),this.env.addEventListener("sceneclearing",()=>this.env.foreground.remove(this.remoteUsers)),this.env.addEventListener("scenecleared",()=>b(this.env.foreground,this.remoteUsers)),this.env.muteMicButton.visible=!0,this.env.muteMicButton.addEventListener("click",async()=>{this.conference.audioMuted=this.env.muteMicButton.active=!this.conference.audioMuted}),this.remoteUsers.name="Remote Users",this.env.audio.offsetRadius=1.25,this.conference=new Hn(this.env.audio,this.hubName,!1);let t=r=>{this.env.avatar.name=r.userID};this.conference.addEventListener("roomJoined",t),this.conference.addEventListener("roomLeft",t),this.conference.addEventListener("userJoined",r=>{let o=new Fr(this.env,r.user,r.source,this.avatarNameTagFont,this.defaultAvatarHeight),i=this.avatarModel?this.avatarModel.clone():new mr(16776960);o.setAvatar(i),o.userName=r.user.userName,this.users.set(r.user.userID,o),b(this.remoteUsers,o),this.env.audio.playClip("join")}),this.conference.addEventListener("userNameChanged",r=>{let o=this.users.get(r.user.userID);o&&(o.userName=r.newUserName)}),this.conference.addEventListener("userLeft",r=>{let o=this.users.get(r.user.userID);o&&(this.remoteUsers.remove(o),this.users.delete(r.user.userID),Tt(o),this.env.audio.playClip("leave"))})}async show(e){b(this.env.foreground,this.remoteUsers),m(this.env.currentRoom)&&await this.join(this.env.currentRoom)}dispose(){this.env.foreground.remove(this.remoteUsers)}async loadAvatar(e,t){this.avatarModel=await this.env.loadModel(e,t),this.avatarModel=this.avatarModel.children[0];for(let r of this.users.keys()){let o=this.users.get(r),i=o.avatar;o.setAvatar(this.avatarModel.clone()),Tt(i)}}async setConferenceInfo(e,t,r){this.userType=e,this.userName=t,this.meetingID=r,await this.checkConference()}async join(e){this.roomName=e,await this.checkConference()}async checkConference(){if(m(this.userType)&&m(this.userName)&&m(this.meetingID)&&m(this.roomName)){let e=`${this.roomName}_${this.meetingID}`.toLocaleLowerCase(),t=`${this.userType}_${this.userName}`;this.conference.roomName!==e&&(await this.conference.connect(),await this.conference.identify(t),await this.conference.join(e))}}async load(e){await oi(e,t=>this.env.audio.loadBasicClip("join","/audio/door_open.mp3",.25,t),t=>this.env.audio.loadBasicClip("leave","/audio/door_close.mp3",.25,t),t=>this.loadAvatar("/models/Avatar.glb",t))}update(e){for(let t of this.users.values())t.update(e.dt)}};var rS=hr;export{rS as default};
//# sourceMappingURL=index.min.js.map
