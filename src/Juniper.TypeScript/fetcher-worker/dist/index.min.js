var ue=Object.defineProperty;var pe=(n,e,t)=>e in n?ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var a=(n,e,t)=>(pe(n,typeof e!="symbol"?e+"":e,t),t);function M(n,e,t){return typeof n===e||n instanceof t}function g(n){return M(n,"function",Function)}function E(n){return M(n,"string",String)}function U(n){return M(n,"boolean",Boolean)}function w(n){return M(n,"number",Number)}function T(n){return n instanceof Array}function j(n,e){throw new Error((e||"Unexpected object: ")+n)}function f(n){return n==null}function u(n){return!f(n)}function le(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int8Array||n instanceof Uint16Array||n instanceof Int16Array||n instanceof Uint32Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof Float64Array||"BigUint64Array"in globalThis&&n instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&n instanceof globalThis.BigInt64Array}function ce(n){return n&&typeof ArrayBuffer!="undefined"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function $(n){return E(n)||le(n)||n instanceof Blob||n instanceof FormData||ce(n)||n instanceof ReadableStream||"Document"in globalThis&&n instanceof Document}function k(n,e){return n.splice(e,1)[0]}function v(n){return n.splice(0)}var J=new WeakMap,Q=class{constructor(){a(this,"listeners",new Map);a(this,"listenerOptions",new Map);J.set(this,this.listeners)}addEventListener(e,t,r){if(g(t)){let o=this.listeners.get(e);o||(o=new Array,this.listeners.set(e,o)),o.find(s=>s===t)||(o.push(t),r&&this.listenerOptions.set(t,r))}}removeEventListener(e,t){if(g(t)){let r=this.listeners.get(e);r&&this.removeListener(r,t)}}removeListener(e,t){let r=e.findIndex(o=>o===t);r>=0&&(k(e,r),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(e){let t=this.listeners.get(e.type);if(t)for(let r of t){let o=this.listenerOptions.get(r);u(o)&&!U(o)&&o.once&&this.removeListener(t,r),r.call(this,e)}return!e.defaultPrevented}},R=class extends Event{get type(){return super.type}constructor(e){super(e)}},y=class extends Q{constructor(){super(...arguments);a(this,"bubblers",new Set);a(this,"scopes",new WeakMap)}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,t,r){super.addEventListener(e,t,r)}removeEventListener(e,t){super.removeEventListener(e,t)}addScopedEventListener(e,t,r,o){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([t,r]),this.addEventListener(t,r,o)}removeScope(e){let t=this.scopes.get(e);if(t){this.scopes.delete(e);for(let[r,o]of t)this.removeEventListener(r,o)}}clearEventListeners(e){let t=J.get(this);for(let[r,o]of t)(f(e)||e===r)&&(v(o),t.delete(r))}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;for(let t of this.bubblers)if(!t.dispatchEvent(e))return!1;return!0}};function Y(n,...e){for(let t of e)if(u(t))for(let[r,o]of t)n.set(r,o);return n}var ge=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,S=navigator.userAgent.match(ge),F=!!S,Ht=F&&{major:parseFloat(S[1]),minor:parseFloat(S[2]),patch:parseFloat(S[3])},zt=F&&/pacific/i.test(navigator.userAgent),qt=F&&/quest/i.test(navigator.userAgent),Gt=F&&/quest 2/i.test(navigator.userAgent);var Xt=!("Document"in globalThis);var Te=298.257223563,be=6378137;var K=1/Te,V=1-K,p=K/(2-K),Jt=be/(1+p)*(1+p*p/4+p*p*p*p/64),B=Math.sqrt(1-V*V),h=1-V*V,Qt=B*B/(1-B*B),Zt=1-h*(.25+h*(3/64+5*h/256)),Yt=h*(3/8+h*(3/32+45*h/1024)),er=h*h*(15/256+h*45/1024),tr=h*h*h*(35/3072),rr=[p/2-2*p*p/3+37*p*p*p/96,p*p/48+p*p*p/15,17*p*p*p/480],nr=[2*p-2*p*p/3,7*p*p/3-8*p*p*p/5,56*p*p*p/15];var an=2*Math.PI;var x=class{constructor(){a(this,"attached",new Array);a(this,"soFar",null);a(this,"total",null);a(this,"msg",null);a(this,"est",null)}report(e,t,r,o){this.soFar=e,this.total=t,this.msg=r,this.est=o;for(let s of this.attached)s.report(e,t,r,o)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}end(){this.report(1,1,"done"),this.soFar=null,this.total=null,this.msg=null,this.est=null,v(this.attached)}};var N=class extends x{constructor(e,t){super();this.i=e;this.prog=t}report(e,t,r,o){super.report(e,t,r,o),this.prog.update(this.i,e,t,r)}};var _=class{constructor(e){this.prog=e;a(this,"weightTotal",0);a(this,"start");a(this,"subProgressCallbacks",new Array);a(this,"subProgressWeights",new Array);a(this,"subProgressValues",new Array);this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new N(t,this)}addSubProgress(e){e=e||1,this.weightTotal+=e,this.subProgressWeights.push(e),this.subProgressValues.push(0);let t=new N(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(e,t,r,o){if(this.prog){this.subProgressValues[e]=t/r;let s=0;for(let m=0;m<this.subProgressWeights.length;++m)s+=this.subProgressValues[m]*this.subProgressWeights[m];let i=performance.now(),l=i-this.start,c=this.start-i+l*this.weightTotal/s;this.prog.report(s,this.weightTotal,o,c)}}};function P(n){return u(n)&&g(n.report)&&g(n.attach)&&g(n.end)}function te(n){return new re(n)}var re=class extends _{pop(e){return this.addSubProgress(e)}};var C=class extends y{constructor(e){super();this.worker=e;a(this,"taskCounter",0);a(this,"invocations",new Map);C.isSupported||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",t=>{let r=t.data;switch(r.type){case"event":this.propogateEvent(r);break;case"progress":this.progressReport(r);break;case"return":this.methodReturned(r);break;case"error":this.invocationError(r);break;default:j(r)}})}postMessage(e,t){e.type!=="methodCall"&&j(e.type),t?this.worker.postMessage(e,t):this.worker.postMessage(e)}dispose(){this.worker.terminate()}propogateEvent(e){let t=new R(e.eventName);this.dispatchEvent(Object.assign(t,e.data))}progressReport(e){let t=this.invocations.get(e.taskID),{onProgress:r}=t;r&&r.report(e.soFar,e.total,e.msg,e.est)}methodReturned(e){let t=this.removeInvocation(e.taskID),{resolve:r}=t;r(e.returnValue)}invocationError(e){let t=this.removeInvocation(e.taskID),{reject:r,methodName:o}=t;r(new Error(`${o} failed. Reason: ${e.errorMessage}`))}removeInvocation(e){let t=this.invocations.get(e);return this.invocations.delete(e),t}callMethod(e,t,r,o){if(!C.isSupported)return Promise.reject(new Error("Workers are not supported on this system."));let s=null,i=null;P(t)&&(o=t,t=null,r=null),P(r)&&!o&&(o=r,r=null),T(t)&&(s=t),T(r)&&(i=r);let l=this.taskCounter++;return new Promise((c,m)=>{let b={onProgress:o,resolve:c,reject:m,methodName:e};this.invocations.set(l,b);let d=null;u(t)?d={type:"methodCall",taskID:l,methodName:e,params:s}:d={type:"methodCall",taskID:l,methodName:e},this.postMessage(d,i)})}},A=C;a(A,"isSupported","Worker"in globalThis);var oe=class extends y{constructor(e,t){super();a(this,"scriptPath");a(this,"taskCounter");a(this,"workers");this.scriptPath=e.scriptPath;let r=-1,o=e.workers,s=null;if(w(o)?r=o:u(o)?(this.taskCounter=o.curTaskCounter,s=o.workers,r=s.length):r=navigator.hardwareConcurrency||4,r<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(r),f(s)){this.taskCounter=0;for(let i=0;i<r;++i)this.workers[i]=new t(new Worker(this.scriptPath,{type:"module"}))}else for(let i=0;i<r;++i)this.workers[i]=new t(s[i]);for(let i of this.workers)i.addBubbler(this)}dispose(){for(let e of this.workers)e.dispose();v(this.workers)}callMethod(e,t,r,o){if(!A.isSupported)return Promise.reject(new Error("Workers are not supported on this system."));let s=null,i=null;return P(t)&&(o=t,t=null,r=null),P(r)&&!o&&(o=r,r=null),T(t)&&(s=t),T(r)&&(i=r),this.nextWorker().callMethod(e,s,i,o)}nextWorker(){let t=this.taskCounter++%this.workers.length;return this.workers[t]}};a(oe,"isSupported","Worker"in globalThis);var se=class extends x{constructor(e,t){super();this.server=e;this.taskID=t}report(e,t,r,o){let s={type:"progress",taskID:this.taskID,soFar:e,total:t,msg:r,est:o};this.server.postMessage(s)}},H=class{constructor(e){this.self=e;a(this,"methods",new Map);this.self.addEventListener("message",t=>{let r=t.data;this.callMethod(r)})}postMessage(e,t){u(t)?this.self.postMessage(e,t):this.self.postMessage(e)}callMethod(e){let t=this.methods.get(e.methodName);if(t)try{T(e.params)?t(e.taskID,...e.params):u(e.params)?t(e.taskID,e.params):t(e.taskID)}catch(r){this.onError(e.taskID,`method invocation error: ${e.methodName}(${r.message||r})`)}else this.onError(e.taskID,`method not found: ${e.methodName}`)}onError(e,t){let r={type:"error",taskID:e,errorMessage:t};this.postMessage(r)}onReturn(e,t,r){let o=null;if(t===void 0?o={type:"return",taskID:e}:o={type:"return",taskID:e,returnValue:t},u(r)){let s=r(t);this.postMessage(o,s)}else this.postMessage(o)}onEvent(e,t,r,o){let s=null;if(u(r)?s={type:"event",eventName:e,data:r(t)}:s={type:"event",eventName:e},s.data!==void 0&&u(o)){let i=o(s.data);this.postMessage(s,i)}else this.postMessage(s)}addMethodInternal(e,t,r){if(this.methods.has(e))throw new Error(`${e} method has already been mapped.`);this.methods.set(e,async(o,...s)=>{let i=new se(this,o);try{let l=await t(...s,i);this.onReturn(o,l,r)}catch(l){console.error(l),this.onError(o,l.message||l)}})}addFunction(e,t,r){this.addMethodInternal(e,t,r)}addVoidFunction(e,t){this.addMethodInternal(e,t)}addMethod(e,t,r,o){this.addFunction(e,r.bind(t),o)}addVoidMethod(e,t,r){this.addVoidFunction(e,r.bind(t))}addEvent(e,t,r,o){e.addEventListener(t,s=>this.onEvent(t,s,r,o))}};var z=class{async translateResponse(e,t){let{status:r,content:o,contentType:s,contentLength:i,fileName:l,headers:c,date:m}=await e;return{status:r,content:await t(o),contentType:s,contentLength:i,fileName:l,headers:c,date:m}}};function q(n,e,t,r,o,s){return new Promise((i,l)=>{let c=!s;s&&s.then(()=>c=!0);let m=!1,b=o;function d(){b&&m&&i()}function W(D){return()=>{c&&l(`${D} (${e.status})`)}}t.addEventListener("loadstart",()=>{c&&!m&&r&&r.report(0,1,n)}),t.addEventListener("progress",D=>{if(c&&!m){let I=D;r&&r.report(I.loaded,Math.max(I.loaded,I.total),n),I.loaded===I.total&&(b=!0,d())}}),t.addEventListener("load",()=>{c&&!m&&(r&&r.report(1,1,n),m=!0,d())}),t.addEventListener("error",W("error")),t.addEventListener("abort",W("abort")),t.addEventListener("timeout",W("timeout"))})}function ie(n,e,t,r,o,s,i){if(n.open(t,r),n.responseType=e,n.timeout=o,s)for(let[l,c]of s)n.setRequestHeader(l,c);u(i)?n.send(i):n.send()}function L(n,e,t){if(!n.has(e))return null;let r=n.get(e);try{let o=t(r);return n.delete(e),o}catch(o){console.warn(e,o)}return null}var Pe=/filename=\"(.+)\"(;|$)/;function ae(n){let e=n.getAllResponseHeaders().split(/[\r\n]+/).map(o=>{let s=o.split(": "),i=s.shift(),l=s.join(": ");return[i,l]}).filter(o=>o[0].length>0),t=new Map(e);return{status:n.status,content:n.response,contentType:L(t,"content-type",o=>o),contentLength:L(t,"content-length",parseFloat),fileName:L(t,"content-disposition",o=>{if(u(o)){let s=o.match(Pe);if(u(s))return s[1]}return null}),date:L(t,"date",o=>new Date(o)),headers:t}}var G=class extends z{constructor(){super(...arguments);this.defaultPostHeaders=new Map}setRequestVerificationToken(e){this.defaultPostHeaders.set("RequestVerificationToken",e)}async headOrGetXHR(e,t,r,o){let s=new XMLHttpRequest,i=q(`requesting: ${r.path}`,s,s,o,!0);return ie(s,t,e,r.path,r.timeout,r.headers),await i,ae(s)}getXHR(e,t,r){return this.headOrGetXHR("GET",e,t,r)}head(e){return this.headOrGetXHR("HEAD","",e,null)}async postXHR(e,t,r){let o=null,s=Y(new Map,this.defaultPostHeaders,t.headers);if(t.body instanceof FormData&&u(s)){let b=new Array;for(let d of s.keys())d.toLowerCase()==="content-type"&&b.push(d);for(let d of b)s.delete(d)}$(t.body)&&!E(t.body)?o=t.body:u(t.body)&&(o=JSON.stringify(t.body));let i=te(r),l=new XMLHttpRequest,c=u(o)?q("uploading",l,l.upload,i.pop(),!1):Promise.resolve(),m=q("saving",l,l,i.pop(),!0,c);return ie(l,e,"POST",t.path,t.timeout,s,o),await c,await m,ae(l)}getBlob(e,t){return this.getXHR("blob",e,t)}postObjectForBlob(e,t){return this.postXHR("blob",e,t)}getBuffer(e,t){return this.getXHR("arraybuffer",e,t)}postObjectForBuffer(e,t){return this.postXHR("arraybuffer",e,t)}getText(e,t){return this.getXHR("text",e,t)}postObjectForText(e,t){return this.postXHR("text",e,t)}async getObject(e,t){return(await this.getXHR("json",e,t)).content}async postObjectForObject(e,t){return(await this.postXHR("json",e,t)).content}postObject(e,t){return this.postXHR("",e,t)}getFile(e,t){return this.translateResponse(this.getBlob(e,t),URL.createObjectURL)}postObjectForFile(e,t){return this.translateResponse(this.postObjectForBlob(e,t),URL.createObjectURL)}getXml(e,t){return this.translateResponse(this.getXHR("document",e,t),r=>r.documentElement)}postObjectForXml(e,t){return this.translateResponse(this.postXHR("document",e,t),r=>r.documentElement)}getImageBitmap(e,t){return this.translateResponse(this.getBlob(e,t),createImageBitmap)}async postObjectForImageBitmap(e,t){return this.translateResponse(this.postObjectForBlob(e,t),createImageBitmap)}};var X=class extends H{constructor(e){super(e);let t=new G;Ie(this,t)}};function O(n){return[n.content]}function Ie(n,e){n.addVoidMethod("setRequestVerificationToken",e,e.setRequestVerificationToken),n.addMethod("getBuffer",e,e.getBuffer,O),n.addMethod("postObjectForBuffer",e,e.postObjectForBuffer,O),n.addMethod("getImageBitmap",e,e.getImageBitmap,O),n.addMethod("postObjectForImageBitmap",e,e.postObjectForImageBitmap,O),n.addMethod("getObject",e,e.getObject),n.addMethod("getFile",e,e.getFile),n.addMethod("getText",e,e.getText),n.addMethod("postObject",e,e.postObject),n.addMethod("postObjectForObject",e,e.postObjectForObject),n.addMethod("postObjectForFile",e,e.postObjectForFile),n.addMethod("postObjectForText",e,e.postObjectForText),n.addMethod("head",e,e.head)}globalThis.server=new X(globalThis);
//# sourceMappingURL=index.min.js.map
