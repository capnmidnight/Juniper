var ht=Object.defineProperty;var pt=(s,t,e)=>t in s?ht(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var i=(s,t,e)=>(pt(s,typeof t!="symbol"?t+"":t,e),e);function k(s,t,e){return typeof s===t||s instanceof e}function g(s){return k(s,"function",Function)}function P(s){return k(s,"string",String)}function H(s){return k(s,"boolean",Boolean)}function T(s){return k(s,"number",Number)}function x(s){return s instanceof Array}function $(s,t){throw new Error((t||"Unexpected object: ")+s)}function d(s){return s==null}function c(s){return!d(s)}function ut(s){return s instanceof Uint8Array||s instanceof Uint8ClampedArray||s instanceof Int8Array||s instanceof Uint16Array||s instanceof Int16Array||s instanceof Uint32Array||s instanceof Int32Array||s instanceof Float32Array||s instanceof Float64Array||"BigUint64Array"in globalThis&&s instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&s instanceof globalThis.BigInt64Array}function lt(s){return s&&typeof ArrayBuffer!="undefined"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function K(s){return P(s)||ut(s)||s instanceof Blob||s instanceof FormData||lt(s)||s instanceof ReadableStream||"Document"in globalThis&&s instanceof Document}function F(s,t){return s.splice(t,1)[0]}function w(s){return s.splice(0)}var Q=new WeakMap,Z=class{constructor(){i(this,"listeners",new Map);i(this,"listenerOptions",new Map);Q.set(this,this.listeners)}addEventListener(t,e,r){if(g(e)){let o=this.listeners.get(t);o||(o=new Array,this.listeners.set(t,o)),o.find(n=>n===e)||(o.push(e),r&&this.listenerOptions.set(e,r))}}removeEventListener(t,e){if(g(e)){let r=this.listeners.get(t);r&&this.removeListener(r,e)}}removeListener(t,e){let r=t.findIndex(o=>o===e);r>=0&&(F(t,r),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let r of e){let o=this.listenerOptions.get(r);c(o)&&!H(o)&&o.once&&this.removeListener(e,r),r.call(this,t)}return!t.defaultPrevented}},_=class extends Event{get type(){return super.type}constructor(t){super(t)}},b=class extends Z{constructor(){super(...arguments);i(this,"bubblers",new Set);i(this,"scopes",new WeakMap)}addBubbler(t){this.bubblers.add(t)}removeBubbler(t){this.bubblers.delete(t)}addEventListener(t,e,r){super.addEventListener(t,e,r)}removeEventListener(t,e){super.removeEventListener(t,e)}addScopedEventListener(t,e,r,o){this.scopes.has(t)||this.scopes.set(t,[]),this.scopes.get(t).push([e,r]),this.addEventListener(e,r,o)}removeScope(t){let e=this.scopes.get(t);if(e){this.scopes.delete(t);for(let[r,o]of e)this.removeEventListener(r,o)}}clearEventListeners(t){let e=Q.get(this);for(let[r,o]of e)(d(t)||t===r)&&(w(o),e.delete(r))}dispatchEvent(t){if(!super.dispatchEvent(t))return!1;for(let e of this.bubblers)if(!e.dispatchEvent(t))return!1;return!0}};function tt(s,...t){for(let e of t)if(c(e))for(let[r,o]of e)s.set(r,o);return s}var xt=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,A=navigator.userAgent.match(xt),B=!!A,Ve=B&&{major:parseFloat(A[1]),minor:parseFloat(A[2]),patch:parseFloat(A[3])},Xe=B&&/pacific/i.test(navigator.userAgent),Ge=B&&/quest/i.test(navigator.userAgent),qe=B&&/quest 2/i.test(navigator.userAgent);var Je=!("Document"in globalThis);var yt=298.257223563,wt=6378137;var U=1/yt,E=1-U,h=U/(2-U),Qe=wt/(1+h)*(1+h*h/4+h*h*h*h/64),R=Math.sqrt(1-E*E),f=1-E*E,Ze=R*R/(1-R*R),Ye=1-f*(.25+f*(3/64+5*f/256)),tr=f*(3/8+f*(3/32+45*f/1024)),er=f*f*(15/256+f*45/1024),rr=f*f*f*(35/3072),sr=[h/2-2*h*h/3+37*h*h*h/96,h*h/48+h*h*h/15,17*h*h*h/480],or=[2*h-2*h*h/3,7*h*h/3-8*h*h*h/5,56*h*h*h/15];var j;(function(s){s[s.Northern=0]="Northern",s[s.Southern=1]="Southern"})(j||(j={}));var os=2*Math.PI;var v=class{constructor(){i(this,"attached",new Array);i(this,"soFar",null);i(this,"total",null);i(this,"msg",null);i(this,"est",null)}report(t,e,r,o){this.soFar=t,this.total=e,this.msg=r,this.est=o;for(let n of this.attached)n.report(t,e,r,o)}attach(t){this.attached.push(t),t.report(this.soFar,this.total,this.msg,this.est)}end(){this.report(1,1,"done"),this.soFar=null,this.total=null,this.msg=null,this.est=null,w(this.attached)}};var C=class extends v{constructor(t,e){super();i(this,"i");i(this,"prog");this.i=t,this.prog=e}report(t,e,r,o){super.report(t,e,r,o),this.prog.update(this.i,t,e,r)}};var I=class{constructor(t){i(this,"prog");i(this,"weightTotal",0);i(this,"start");i(this,"subProgressCallbacks",new Array);i(this,"subProgressWeights",new Array);i(this,"subProgressValues",new Array);this.prog=t,this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new C(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new C(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,r,o){if(this.prog){this.subProgressValues[t]=e/r;let n=0;for(let l=0;l<this.subProgressWeights.length;++l)n+=this.subProgressValues[l]*this.subProgressWeights[l];let a=performance.now(),p=a-this.start,u=this.start-a+p*this.weightTotal/n;this.prog.report(n,this.weightTotal,o,u)}}};function M(s){return c(s)&&g(s.report)&&g(s.attach)&&g(s.end)}function rt(s){return new st(s)}var st=class extends I{pop(t){return this.addSubProgress(t)}};var N=class extends b{constructor(t){super();i(this,"worker");i(this,"taskCounter",0);i(this,"invocations",new Map);this.worker=t,N.isSupported||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",e=>{let r=e.data;switch(r.type){case"event":this.propogateEvent(r);break;case"progress":this.progressReport(r);break;case"return":this.methodReturned(r);break;case"error":this.invocationError(r);break;default:$(r)}})}postMessage(t,e){t.type!=="methodCall"&&$(t.type),e?this.worker.postMessage(t,e):this.worker.postMessage(t)}dispose(){this.worker.terminate()}propogateEvent(t){let e=new _(t.eventName);this.dispatchEvent(Object.assign(e,t.data))}progressReport(t){let e=this.invocations.get(t.taskID),{onProgress:r}=e;r&&r.report(t.soFar,t.total,t.msg,t.est)}methodReturned(t){let e=this.removeInvocation(t.taskID),{resolve:r}=e;r(t.returnValue)}invocationError(t){let e=this.removeInvocation(t.taskID),{reject:r,methodName:o}=e;r(new Error(`${o} failed. Reason: ${t.errorMessage}`))}removeInvocation(t){let e=this.invocations.get(t);return this.invocations.delete(t),e}callMethod(t,e,r,o){if(!N.isSupported)return Promise.reject(new Error("Workers are not supported on this system."));let n=null,a=null;M(e)&&(o=e,e=null,r=null),M(r)&&!o&&(o=r,r=null),x(e)&&(n=e),x(r)&&(a=r);let p=this.taskCounter++;return new Promise((u,l)=>{let y={onProgress:o,resolve:u,reject:l,methodName:t};this.invocations.set(p,y);let m=null;c(e)?m={type:"methodCall",taskID:p,methodName:t,params:n}:m={type:"methodCall",taskID:p,methodName:t},this.postMessage(m,a)})}},O=N;i(O,"isSupported","Worker"in globalThis);var nt=class extends b{constructor(t,e){super();i(this,"scriptPath");i(this,"taskCounter");i(this,"workers");this.scriptPath=t.scriptPath;let r=-1,o=t.workers,n=null;if(T(o)?r=o:c(o)?(this.taskCounter=o.curTaskCounter,n=o.workers,r=n.length):r=navigator.hardwareConcurrency||4,r<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(r),d(n)){this.taskCounter=0;for(let a=0;a<r;++a)this.workers[a]=new e(new Worker(this.scriptPath,{type:"module"}))}else for(let a=0;a<r;++a)this.workers[a]=new e(n[a]);for(let a of this.workers)a.addBubbler(this)}dispose(){for(let t of this.workers)t.dispose();w(this.workers)}callMethod(t,e,r,o){if(!O.isSupported)return Promise.reject(new Error("Workers are not supported on this system."));let n=null,a=null;return M(e)&&(o=e,e=null,r=null),M(r)&&!o&&(o=r,r=null),x(e)&&(n=e),x(r)&&(a=r),this.nextWorker().callMethod(t,n,a,o)}nextWorker(){let e=this.taskCounter++%this.workers.length;return this.workers[e]}};i(nt,"isSupported","Worker"in globalThis);var it=class extends v{constructor(t,e){super();i(this,"server");i(this,"taskID");this.server=t,this.taskID=e}report(t,e,r,o){let n={type:"progress",taskID:this.taskID,soFar:t,total:e,msg:r,est:o};this.server.postMessage(n)}},V=class{constructor(t){i(this,"self");i(this,"methods",new Map);this.self=t,this.self.addEventListener("message",e=>{let r=e.data;this.callMethod(r)})}postMessage(t,e){c(e)?this.self.postMessage(t,e):this.self.postMessage(t)}callMethod(t){let e=this.methods.get(t.methodName);if(e)try{x(t.params)?e(t.taskID,...t.params):c(t.params)?e(t.taskID,t.params):e(t.taskID)}catch(r){this.onError(t.taskID,`method invocation error: ${t.methodName}(${r.message||r})`)}else this.onError(t.taskID,`method not found: ${t.methodName}`)}onError(t,e){let r={type:"error",taskID:t,errorMessage:e};this.postMessage(r)}onReturn(t,e,r){let o=null;if(e===void 0?o={type:"return",taskID:t}:o={type:"return",taskID:t,returnValue:e},c(r)){let n=r(e);this.postMessage(o,n)}else this.postMessage(o)}onEvent(t,e,r,o){let n=null;if(c(r)?n={type:"event",eventName:t,data:r(e)}:n={type:"event",eventName:t},n.data!==void 0&&c(o)){let a=o(n.data);this.postMessage(n,a)}else this.postMessage(n)}addMethodInternal(t,e,r){if(this.methods.has(t))throw new Error(`${t} method has already been mapped.`);this.methods.set(t,async(o,...n)=>{let a=new it(this,o);try{let p=await e(...n,a);this.onReturn(o,p,r)}catch(p){console.error(p),this.onError(o,p.message||p)}})}addFunction(t,e,r){this.addMethodInternal(t,e,r)}addVoidFunction(t,e){this.addMethodInternal(t,e)}addMethod(t,e,r,o){this.addFunction(t,r.bind(e),o)}addVoidMethod(t,e,r){this.addVoidFunction(t,r.bind(e))}addEvent(t,e,r,o){t.addEventListener(e,n=>this.onEvent(e,n,r,o))}};var X=class{async translateResponse(t,e){let{status:r,content:o,contentType:n,contentLength:a,fileName:p,headers:u,date:l}=await t;return{status:r,content:await e(o),contentType:n,contentLength:a,fileName:p,headers:u,date:l}}};function G(s,t,e,r,o,n){return new Promise((a,p)=>{let u=!n;n&&n.then(()=>u=!0);let l=!1,y=o;function m(){y&&l&&a()}function z(W){return()=>{u&&p(`${W} (${t.status})`)}}e.addEventListener("loadstart",()=>{u&&!l&&r&&r.report(0,1,s)}),e.addEventListener("progress",W=>{if(u&&!l){let S=W;r&&r.report(S.loaded,Math.max(S.loaded,S.total),s),S.loaded===S.total&&(y=!0,m())}}),e.addEventListener("load",()=>{u&&!l&&(r&&r.report(1,1,s),l=!0,m())}),e.addEventListener("error",z("error")),e.addEventListener("abort",z("abort")),e.addEventListener("timeout",z("timeout"))})}function at(s,t,e,r,o,n,a){if(s.open(e,r),s.responseType=t,s.timeout=o,n)for(let[p,u]of n)s.setRequestHeader(p,u);c(a)?s.send(a):s.send()}function D(s,t,e){if(!s.has(t))return null;let r=s.get(t);try{let o=e(r);return s.delete(t),o}catch(o){console.warn(t,o)}return null}var St=/filename=\"(.+)\"(;|$)/;function ct(s){let t=s.getAllResponseHeaders().split(/[\r\n]+/).map(o=>{let n=o.split(": "),a=n.shift(),p=n.join(": ");return[a,p]}).filter(o=>o[0].length>0),e=new Map(t);return{status:s.status,content:s.response,contentType:D(e,"content-type",o=>o),contentLength:D(e,"content-length",parseFloat),fileName:D(e,"content-disposition",o=>{if(c(o)){let n=o.match(St);if(c(n))return n[1]}return null}),date:D(e,"date",o=>new Date(o)),headers:e}}var q=class extends X{constructor(){super(...arguments);i(this,"defaultPostHeaders",new Map)}setRequestVerificationToken(t){this.defaultPostHeaders.set("RequestVerificationToken",t)}async headOrGetXHR(t,e,r,o){let n=new XMLHttpRequest,a=G(`requesting: ${r.path}`,n,n,o,!0);return at(n,e,t,r.path,r.timeout,r.headers),await a,ct(n)}getXHR(t,e,r){return this.headOrGetXHR("GET",t,e,r)}head(t){return this.headOrGetXHR("HEAD","",t,null)}async postXHR(t,e,r){let o=null,n=tt(new Map,this.defaultPostHeaders,e.headers);if(e.body instanceof FormData&&c(n)){let y=new Array;for(let m of n.keys())m.toLowerCase()==="content-type"&&y.push(m);for(let m of y)n.delete(m)}K(e.body)&&!P(e.body)?o=e.body:c(e.body)&&(o=JSON.stringify(e.body));let a=rt(r),p=new XMLHttpRequest,u=c(o)?G("uploading",p,p.upload,a.pop(),!1):Promise.resolve(),l=G("saving",p,p,a.pop(),!0,u);return at(p,t,"POST",e.path,e.timeout,n,o),await u,await l,ct(p)}getBlob(t,e){return this.getXHR("blob",t,e)}postObjectForBlob(t,e){return this.postXHR("blob",t,e)}getBuffer(t,e){return this.getXHR("arraybuffer",t,e)}postObjectForBuffer(t,e){return this.postXHR("arraybuffer",t,e)}getText(t,e){return this.getXHR("text",t,e)}postObjectForText(t,e){return this.postXHR("text",t,e)}async getObject(t,e){return(await this.getXHR("json",t,e)).content}async postObjectForObject(t,e){return(await this.postXHR("json",t,e)).content}postObject(t,e){return this.postXHR("",t,e)}getFile(t,e){return this.translateResponse(this.getBlob(t,e),URL.createObjectURL)}postObjectForFile(t,e){return this.translateResponse(this.postObjectForBlob(t,e),URL.createObjectURL)}getXml(t,e){return this.translateResponse(this.getXHR("document",t,e),r=>r.documentElement)}postObjectForXml(t,e){return this.translateResponse(this.postXHR("document",t,e),r=>r.documentElement)}getImageBitmap(t,e){return this.translateResponse(this.getBlob(t,e),createImageBitmap)}async postObjectForImageBitmap(t,e){return this.translateResponse(this.postObjectForBlob(t,e),createImageBitmap)}};var J=class extends V{constructor(t){super(t);let e=new q;kt(this,e)}};function L(s){return[s.content]}function kt(s,t){s.addVoidMethod("setRequestVerificationToken",t,t.setRequestVerificationToken),s.addMethod("getBuffer",t,t.getBuffer,L),s.addMethod("postObjectForBuffer",t,t.postObjectForBuffer,L),s.addMethod("getImageBitmap",t,t.getImageBitmap,L),s.addMethod("postObjectForImageBitmap",t,t.postObjectForImageBitmap,L),s.addMethod("getObject",t,t.getObject),s.addMethod("getFile",t,t.getFile),s.addMethod("getText",t,t.getText),s.addMethod("postObject",t,t.postObject),s.addMethod("postObjectForObject",t,t.postObjectForObject),s.addMethod("postObjectForFile",t,t.postObjectForFile),s.addMethod("postObjectForText",t,t.postObjectForText),s.addMethod("head",t,t.head)}globalThis.server=new J(globalThis);
//# sourceMappingURL=index.min.js.map
